<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>MathLingo - Vai Encarar?</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap"
        rel="stylesheet" />

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ["Nunito", "sans-serif"] },
                    colors: {
                        brand: {
                            green: "#58CC02",
                            greenDark: "#46A302",
                            blue: "#1CB0F6",
                            blueDark: "#1899D6",
                            purple: "#CE82FF",
                            purpleDark: "#A568CC",
                            red: "#FF4B4B",
                            redDark: "#EA2B2B",
                            yellow: "#FFC800",
                            yellowDark: "#E5B400",
                            orange: "#FF9600",
                            orangeDark: "#CC7A00",
                            magenta: "#FF2E93",
                            magentaDark: "#D11873",
                            text: "#4B4B4B",
                            bg: "#F7F9FA",
                        },
                    },
                    boxShadow: {
                        card: "0 4px 0 #E5E5E5",
                        btn: "0 4px 0 rgba(0,0,0,0.2)",
                    },
                    animation: {
                        "fade-in": "fadeIn 0.4s ease-out forwards",
                        "pop-in": "popIn 0.3s ease-out forwards",
                    },
                    keyframes: {
                        fadeIn: {
                            "0%": { opacity: "0", transform: "translateY(10px)" },
                            "100%": { opacity: "1", transform: "translateY(0)" },
                        },
                        popIn: {
                            "0%": { transform: "scale(0)" },
                            "80%": { transform: "scale(1.1)" },
                            "100%": { transform: "scale(1)" },
                        },
                    },
                },
            },
        };
    </script>

    <style>
        body {
            background-color: #f7f9fa;
            color: #4b4b4b;
            -webkit-tap-highlight-color: transparent;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Classes utilit√°rias para widgets */
        .btn-game {
            transition: all 0.1s;
            border-bottom-width: 4px;
        }

        .btn-game:active {
            transform: translateY(4px);
            border-bottom-width: 0;
        }

        /* Estilos de conte√∫do */
        .lesson-content h3 {
            color: #1cb0f6;
            font-weight: 800;
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .lesson-content p {
            margin-bottom: 1rem;
            line-height: 1.6;
            font-size: 1.1rem;
        }

        .lesson-content ul,
        .lesson-content ol {
            margin-bottom: 1rem;
            padding-left: 1.5rem;
        }

        .lesson-content li {
            margin-bottom: 0.5rem;
        }

        input[type="range"] {
            accent-color: currentColor;
        }
    </style>
</head>

<body class="h-screen flex flex-col overflow-hidden font-sans">
    <header
        class="bg-white border-b-2 border-gray-200 h-16 md:h-20 flex items-center justify-between px-4 md:px-8 z-50 shrink-0">
        <div class="flex items-center gap-4">
            <button id="btn-back" class="hidden text-gray-400 hover:bg-gray-100 p-2 rounded-xl transition-colors"
                onclick="app.goBack()">
                <i class="fas fa-chevron-left text-2xl"></i>
            </button>
            <div id="logo-area" class="flex items-center gap-3 cursor-pointer" onclick="app.navigate('home')">
                <div class="w-10 h-10 bg-brand-green rounded-xl relative overflow-hidden shadow-sm">
                    <div class="absolute top-1 left-1 w-3 h-3 bg-white rounded-full opacity-40"></div>
                    <div class="absolute bottom-1 right-1 w-4 h-4 bg-brand-greenDark rounded-full"></div>
                </div>
                <h1 class="text-2xl font-extrabold text-brand-green tracking-tight hidden md:block">
                    MathLingo
                </h1>
            </div>
        </div>

        <div class="flex items-center gap-4 font-bold text-gray-400">
            <div class="hidden md:flex items-center gap-2 text-brand-red bg-red-50 px-3 py-1 rounded-xl">
                <i class="fas fa-fire animate-pulse"></i> <span>50</span>
            </div>
            <div class="flex items-center gap-2 text-brand-blue bg-blue-50 px-3 py-1 rounded-xl">
                <i class="fas fa-gem"></i> <span>3200</span>
            </div>
        </div>
    </header>

    <main id="main-container" class="flex-1 overflow-y-auto no-scrollbar p-4 w-full max-w-5xl mx-auto relative"></main>

    <script>
        // ---------------------------------------------------------
        // 1. CONFIGURA√á√ÉO DO FIREBASE (COLE A SUA AQUI!)
        // ---------------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyBYNxFdJ3M8Uw1oewupUXKXxppSRd2HiRY",
            authDomain: "mathligo.firebaseapp.com",
            projectId: "mathligo",
            storageBucket: "mathligo.firebasestorage.app",
            messagingSenderId: "852191827758",
            appId: "1:852191827758:web:5f1365bb919b81eb808cbf",
        };

        // Inicializa o Firebase com seguran√ßa
        let auth, db, provider;
        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            provider = new firebase.auth.GoogleAuthProvider();
        } catch (e) {
            console.warn(
                "Firebase n√£o configurado ou erro de conex√£o. O modo Convidado funcionar√°.",
                e
            );
        }

        // --- TEMAS POR N√çVEL ---
        const LEVEL_THEMES = {
            //Ensino Fundamental
            "6¬∫ Ano": {
                main: "bg-[#58cc02]",
                text: "text-[#58cc02]",
                border: "border-[#58cc02]",
                borderDark: "border-[#46a302]",
                light: "bg-green-50",
                ring: "ring-green-100",
                gradient: "from-green-400 to-green-600",
            },
            "7¬∫ Ano": {
                main: "bg-[#1cb0f6]",
                text: "text-[#1cb0f6]",
                border: "border-[#1cb0f6]",
                borderDark: "border-[#1899d6]",
                light: "bg-blue-50",
                ring: "ring-blue-100",
                gradient: "from-blue-400 to-blue-600",
            },
            "8¬∫ Ano": {
                main: "bg-[#ce82ff]",
                text: "text-[#ce82ff]",
                border: "border-[#ce82ff]",
                borderDark: "border-[#a568cc]",
                light: "bg-purple-50",
                ring: "ring-purple-100",
                gradient: "from-purple-400 to-purple-600",
            },
            "9¬∫ Ano": {
                main: "bg-[#ff4b4b]",
                text: "text-[#ff4b4b]",
                border: "border-[#ff4b4b]",
                borderDark: "border-[#ea2b2b]",
                light: "bg-red-50",
                ring: "ring-red-100",
                gradient: "from-red-400 to-red-600",
            },
            // Ensino M√©dio
            "1¬∫ Ano EM": {
                main: "bg-[#FF9600]",
                text: "text-[#FF9600]",
                border: "border-[#FF9600]",
                borderDark: "border-[#CC7A00]",
                light: "bg-orange-50",
                ring: "ring-orange-100",
                gradient: "from-orange-400 to-orange-600",
            },
            "2¬∫ Ano EM": {
                main: "bg-[#FFC800]",
                text: "text-[#E5B400]",
                border: "border-[#FFC800]",
                borderDark: "border-[#E5B400]",
                light: "bg-yellow-50",
                ring: "ring-yellow-100",
                gradient: "from-yellow-400 to-yellow-600",
            },
            "3¬∫ Ano EM": {
                main: "bg-[#FF2E93]",
                text: "text-[#FF2E93]",
                border: "border-[#FF2E93]",
                borderDark: "border-[#D11873]",
                light: "bg-pink-50",
                ring: "ring-pink-100",
                gradient: "from-pink-400 to-pink-600",
            },
        };
        // 1. ESTRUTURA CURRICULAR
        const CURRICULO = {
            "6¬∫ Ano": {
                "Unidade 1: A Hist√≥ria e Evolu√ß√£o dos N√∫meros": [
                    "A Necessidade Humana de Contar e Registrar",
                    "Sistema Eg√≠pcio: O Princ√≠pio Aditivo e seus S√≠mbolos",
                    "Sistema Babil√¥nico: A Base 60 (Sexagesimal) e o Princ√≠pio Posicional",
                    "Conex√£o Hist√≥rica: Por que a hora tem 60 minutos e o c√≠rculo 360 graus?",
                    "Sistema Romano: Regras Aditivas, Subtrativas e Multiplicativas (milhares)",
                    "Sistema Maia: Introdu√ß√£o √† Base Vigesimal e a inven√ß√£o do Zero",
                    "Sistema Decimal: Base 10, Valor Posicional e Classes/Ordens",
                    "Leitura e Escrita de Grandes N√∫meros (Bilh√µes e Trilh√µes)",
                    "A Reta Num√©rica Natural: Ordem, Sucessor e Antecessor",
                    "N√∫meros Pares e √çmpares (Paridade)",
                ],
                "Unidade 2: Opera√ß√µes Fundamentais I (Campo Aditivo)": [
                    "Adi√ß√£o: Ideias (Juntar e Acrescentar)",
                    "Propriedades da Adi√ß√£o: Comutativa, Associativa e Elemento Neutro",
                    "Subtra√ß√£o: Ideias (Tirar, Completar e Comparar)",
                    "Rela√ß√£o Inversa entre Adi√ß√£o e Subtra√ß√£o (Prova Real)",
                    "Express√µes Num√©ricas Simples (Adi√ß√£o/Subtra√ß√£o com Par√™nteses)",
                    "Resolu√ß√£o de Problemas envolvendo Adi√ß√£o e Subtra√ß√£o",
                ],
                "Unidade 3: Geometria Instrumental e Primitivos": [
                    "Ponto, Reta e Plano: No√ß√µes Intuitivas e Representa√ß√£o",
                    "Posi√ß√µes Relativas de Retas: Paralelas, Concorrentes e Perpendiculares",
                    "Semirretas e Segmentos de Reta",
                    "Uso da R√©gua: Medi√ß√£o e Tra√ßado de Segmentos",
                    "Uso do Compasso: Transporte de Medidas e Constru√ß√£o de C√≠rculos",
                    "√Çngulos: Conceito de Abertura e Giro",
                    "Uso do Transferidor: Medindo e Construindo √Çngulos",
                    "Classifica√ß√£o de √Çngulos (Agudo, Reto, Obtuso, Raso, Nulo e Completo)",
                ],
                "Unidade 4: Opera√ß√µes Fundamentais II (Campo Multiplicativo)": [
                    "Multiplica√ß√£o: Ideia de Adi√ß√£o de Parcelas Iguais",
                    "Multiplica√ß√£o: Ideia de Disposi√ß√£o Retangular (√Årea inicial)",
                    "Multiplica√ß√£o: Ideia de Combinat√≥ria (√Årvore de Possibilidades)",
                    "Algoritmo da Multiplica√ß√£o (1, 2 e mais algarismos)",
                    "Propriedade Distributiva da Multiplica√ß√£o",
                    "Divis√£o Euclidiana: Ideias (Repartir Igualmente e Medir/Caber)",
                    "Nomenclatura da Divis√£o e a Rela√ß√£o Fundamental (D = d.q + r)",
                    "Divis√£o Exata vs N√£o Exata",
                    "Divis√£o por 10, 100 e 1000 (C√°lculo Mental)",
                    "Express√µes Num√©ricas com as 4 Opera√ß√µes e Sinais de Associa√ß√£o",
                ],
                "Unidade 5: Potencia√ß√£o e Radicia√ß√£o": [
                    "Potencia√ß√£o: Conceito, Base e Expoente",
                    "O Quadrado de um N√∫mero e a √Årea do Quadrado (Geometria)",
                    "O Cubo de um N√∫mero e o Volume do Cubo",
                    "Propriedades Essenciais: Expoente 1 e Expoente 0",
                    "Pot√™ncias de Base 10 e Decomposi√ß√£o de N√∫meros",
                    "Raiz Quadrada Exata: Opera√ß√£o Inversa da Potencia√ß√£o",
                    "Raiz Quadrada Geom√©trica (Lado do quadrado dada a √°rea)",
                    "Ordem de Resolu√ß√£o em Express√µes Num√©ricas Complexas",
                ],
                "Unidade 6: M√∫ltiplos e Divisores": [
                    "M√∫ltiplos de um N√∫mero Natural (Sequ√™ncias)",
                    "Divisores e Fatores de um N√∫mero",
                    "Crit√©rios de Divisibilidade (2, 5 e 10)",
                    "Crit√©rios de Divisibilidade (3 e 9)",
                    "Crit√©rios de Divisibilidade (4, 6 e 8)",
                    "N√∫meros Primos e Compostos",
                    "Crivo de Erat√≥stenes",
                    "Decomposi√ß√£o em Fatores Primos (Fatora√ß√£o)",
                    "MDC (M√°ximo Divisor Comum): Divisores comuns e M√©todo Pr√°tico",
                    "MMC (M√≠nimo M√∫ltiplo Comum): M√∫ltiplos comuns e M√©todo Pr√°tico",
                    "Problemas de Encontro (MMC) e de Reparti√ß√£o (MDC)",
                ],
                "Unidade 7: Fra√ß√µes - Parte I": [
                    "O Conceito Parte-Todo",
                    "Elementos da Fra√ß√£o: Numerador e Denominador",
                    "Leitura e Classifica√ß√£o (Pr√≥pria, Impr√≥pria e Aparente)",
                    "N√∫meros Mistos: Convers√£o para Fra√ß√£o Impr√≥pria e vice-versa",
                    "Fra√ß√£o como Quociente (Divis√£o)",
                    "Fra√ß√£o como Operador (Fra√ß√£o de uma quantidade)",
                    "Fra√ß√µes Equivalentes: Amplia√ß√£o e Simplifica√ß√£o",
                    "Fra√ß√£o Irredut√≠vel",
                    "Compara√ß√£o de Fra√ß√µes (Mesmo denominador vs Denominadores diferentes)",
                ],
                "Unidade 8: Fra√ß√µes - Parte II (Opera√ß√µes)": [
                    "Adi√ß√£o e Subtra√ß√£o com Denominadores Iguais",
                    "Adi√ß√£o e Subtra√ß√£o com Denominadores Diferentes (Uso do MMC)",
                    "Multiplica√ß√£o de N√∫mero Natural por Fra√ß√£o",
                    "Multiplica√ß√£o de Fra√ß√£o por Fra√ß√£o (√Årea de ret√¢ngulo fracion√°rio)",
                    "Divis√£o de Fra√ß√µes (Ideia de quantas vezes cabe)",
                    "Potencia√ß√£o e Raiz Quadrada de Fra√ß√µes",
                ],
                "Unidade 9: N√∫meros Decimais e Sistema Monet√°rio": [
                    "Fra√ß√µes Decimais e a Escrita com V√≠rgula",
                    "Ordens Decimais: D√©cimos, Cent√©simos e Mil√©simos",
                    "Compara√ß√£o e Ordena√ß√£o de Decimais na Reta Num√©rica",
                    "Adi√ß√£o e Subtra√ß√£o de Decimais (V√≠rgula sob v√≠rgula)",
                    "Multiplica√ß√£o de Decimais (Natural x Decimal e Decimal x Decimal)",
                    "Divis√£o com Decimais (Igualar casas e eliminar v√≠rgula)",
                    "Divis√£o de Natural com Quociente Decimal",
                    "Sistema Monet√°rio Brasileiro: Problemas de troco e custo",
                ],
                "Unidade 10: Formas Geom√©tricas e Transforma√ß√µes": [
                    "Pol√≠gonos: Elementos (Lado, V√©rtice, √Çngulo interno) e Nomenclatura",
                    "Tri√¢ngulos: Classifica√ß√£o quanto aos Lados e √Çngulos",
                    "Quadril√°teros: Paralelogramos e Trap√©zios (Defini√ß√µes b√°sicas)",
                    "S√≥lidos Geom√©tricos: Poliedros (Prismas/Pir√¢mides) vs Corpos Redondos",
                    "Planifica√ß√£o de S√≥lidos",
                    "Vistas Ortogonais (Frente, Superior e Lateral)",
                    "Malhas Quadriculadas: Localiza√ß√£o (Pares Ordenados)",
                    "Transforma√ß√µes na Malha: Amplia√ß√£o e Redu√ß√£o (Homotetia intuitiva)",
                    "Transforma√ß√µes na Malha: Simetria de Reflex√£o",
                ],
                "Unidade 11: Introdu√ß√£o √† √Ålgebra": [
                    "Sequ√™ncias Repetitivas e Recursivas (Figurais e Num√©ricas)",
                    "Identifica√ß√£o de Padr√µes e Regularidades",
                    "A Vari√°vel: A Letra como N√∫mero Desconhecido",
                    "Senten√ßas Matem√°ticas e o Conceito de Igualdade (Equil√≠brio)",
                    "C√°lculo do Valor Desconhecido (Opera√ß√£o Inversa)",
                    "Generaliza√ß√£o Simples (Ex: Dobro de um n√∫mero mais 5)",
                ],
                "Unidade 12: Grandezas e Estat√≠stica": [
                    "Medidas de Comprimento (Unidades e Convers√µes lineares)",
                    "Conceito de Per√≠metro e √Årea (Contagem de quadradinhos e F√≥rmulas simples)",
                    "Medidas de Massa (kg, g, mg, t)",
                    "Medidas de Tempo (h, min, s) e Opera√ß√µes com tempo",
                    "Medidas de Volume (cm¬≥, dm¬≥, m¬≥)",
                    "Tipos de Vari√°veis (Qualitativas e Quantitativas)",
                    "Tabelas de Frequ√™ncia",
                    "Gr√°ficos de Colunas e Barras (Constru√ß√£o e Leitura)",
                    "Gr√°ficos Pict√≥ricos",
                ],
            },

            "7¬∫ Ano": {
                "Unidade 1: N√∫meros Inteiros (Z) - O Conjunto": [
                    "N√∫meros Negativos no Cotidiano (Temperatura, Saldo, Altitude)",
                    "A Reta Num√©rica Inteira e a Simetria em rela√ß√£o ao Zero",
                    "M√≥dulo ou Valor Absoluto",
                    "N√∫meros Opostos ou Sim√©tricos",
                    "Compara√ß√£o e Ordena√ß√£o de Inteiros",
                ],
                "Unidade 2: Opera√ß√µes em Z": [
                    "Adi√ß√£o de Inteiros: Sinais Iguais vs Sinais Diferentes",
                    "Propriedades da Adi√ß√£o em Z",
                    "Subtra√ß√£o de Inteiros: Adicionando o Oposto",
                    "Elimina√ß√£o de Par√™nteses e Simplifica√ß√£o de Sinais",
                    "Multiplica√ß√£o de Inteiros e Regra de Sinais",
                    "Divis√£o Exata de Inteiros",
                    "Potencia√ß√£o em Z: Base Negativa, Expoente Par/√çmpar",
                    "Raiz Quadrada Exata de Inteiros (e a impossibilidade de raiz de negativo)",
                    "Express√µes Num√©ricas em Z",
                ],
                "Unidade 3: N√∫meros Racionais (Q)": [
                    "A Necessidade de Amplia√ß√£o (Q)",
                    "Racionais na Reta Num√©rica (Densidade)",
                    "Representa√ß√£o Decimal: Decimal Exato vs D√≠zima Peri√≥dica",
                    "Fra√ß√£o Geratriz (Simples e Composta)",
                    "M√≥dulo e Sim√©trico em Q",
                    "Compara√ß√£o de N√∫meros Racionais",
                ],
                "Unidade 4: Opera√ß√µes em Q": [
                    "Adi√ß√£o e Subtra√ß√£o de Racionais (Forma Fracion√°ria e Decimal)",
                    "Multiplica√ß√£o de Racionais e Regra de Sinais",
                    "Divis√£o de Racionais (Inverso multiplicativo)",
                    "Potencia√ß√£o de Racionais (Expoente inteiro negativo)",
                    "Raiz Quadrada em Q",
                    "Express√µes Num√©ricas Envolvendo Z e Q",
                ],
                "Unidade 5: Introdu√ß√£o √† √Ålgebra Formal": [
                    "Linguagem Alg√©brica: Vari√°veis e Inc√≥gnitas",
                    "Valor Num√©rico de uma Express√£o Alg√©brica",
                    "Equa√ß√µes do 1¬∫ Grau: Conceito de Raiz e Conjunto Universo",
                    "Princ√≠pios de Equival√™ncia (Aditivo e Multiplicativo)",
                    "Resolu√ß√£o de Equa√ß√µes Simples (ax + b = c)",
                    "Equa√ß√µes com Par√™nteses (Propriedade Distributiva)",
                    "Equa√ß√µes com Denominadores (MMC)",
                    "Resolu√ß√£o de Problemas via Equa√ß√µes",
                ],
                "Unidade 6: Inequa√ß√µes do 1¬∫ Grau": [
                    "Conceito de Desigualdade e Sinais (>, <, ‚â•, ‚â§)",
                    "Propriedades das Desigualdades (Invers√£o ao multiplicar por negativo)",
                    "Resolu√ß√£o de Inequa√ß√µes",
                    "Representa√ß√£o da Solu√ß√£o na Reta Num√©rica",
                ],
                "Unidade 7: Raz√£o, Propor√ß√£o e Regra de Tr√™s": [
                    "Conceito de Raz√£o e Grandezas Especiais (Velocidade, Escala, Densidade)",
                    "Conceito de Propor√ß√£o e Propriedade Fundamental",
                    "Grandezas Diretamente Proporcionais (GDP)",
                    "Grandezas Inversamente Proporcionais (GIP)",
                    "Regra de Tr√™s Simples (Direta e Inversa)",
                    "Divis√£o em Partes Proporcionais",
                ],
                "Unidade 8: Porcentagem e Matem√°tica Financeira": [
                    "Porcentagem como Raz√£o Centesimal",
                    "C√°lculo de Porcentagem de uma Quantia",
                    "Taxa Percentual",
                    "Aumentos e Descontos Sucessivos",
                    "Juros Simples (J = C.i.t) e Montante",
                ],
                "Unidade 9: Geometria - √Çngulos e Retas": [
                    "√Çngulos Complementares e Suplementares",
                    "√Çngulos Adjacentes e Opostos pelo V√©rtice (OPV)",
                    "Bissetriz de um √Çngulo (Constru√ß√£o Geom√©trica)",
                    "Retas Paralelas Cortadas por Transversal",
                    "√Çngulos Correspondentes, Alternos e Colaterais",
                ],
                "Unidade 10: Geometria - Tri√¢ngulos e Pol√≠gonos": [
                    "Soma dos √Çngulos Internos de um Tri√¢ngulo",
                    "Teorema do √Çngulo Externo",
                    "Classifica√ß√£o de Tri√¢ngulos (Lados e √Çngulos)",
                    "Condi√ß√£o de Exist√™ncia de um Tri√¢ngulo (Desigualdade Triangular)",
                    "Pol√≠gonos: Convexos vs C√¥ncavos",
                    "Soma dos √Çngulos Internos de Pol√≠gonos (Generaliza√ß√£o)",
                ],
                "Unidade 11: Simetria e Plano Cartesiano": [
                    "Plano Cartesiano: Eixos, Origem e Quadrantes",
                    "Coordenadas Inteiras e Racionais",
                    "Simetria de Reflex√£o (Axial)",
                    "Simetria de Transla√ß√£o",
                    "Simetria de Rota√ß√£o",
                    "Constru√ß√£o de Figuras Sim√©tricas no Plano",
                ],
                "Unidade 12: Medidas de √Årea e Volume": [
                    "√Årea do Quadrado e Ret√¢ngulo",
                    "√Årea do Paralelogramo e Tri√¢ngulo",
                    "√Årea do Trap√©zio e Losango",
                    "Volume de Blocos Retangulares (Paralelep√≠pedos)",
                    "Convers√£o de Unidades de √Årea e Volume ($m^2, m^3$ e Litros)",
                ],
                "Unidade 13: Estat√≠stica": [
                    "M√©dia Aritm√©tica Simples",
                    "M√©dia Aritm√©tica Ponderada",
                    "Amplitude de um conjunto de dados",
                    "Gr√°ficos de Setores (Pizza): Constru√ß√£o e Interpreta√ß√£o (uso de %)",
                ],
            },

            "8¬∫ Ano": {
                "Unidade 1: C√°lculo Alg√©brico - Mon√¥mios": [
                    "Revis√£o: Vari√°veis e Generaliza√ß√£o",
                    "Mon√¥mios: Coeficiente e Parte Literal",
                    "Grau de um Mon√¥mio",
                    "Mon√¥mios Semelhantes",
                    "Adi√ß√£o e Subtra√ß√£o de Mon√¥mios",
                    "Multiplica√ß√£o de Mon√¥mios (Propriedades de Pot√™ncia)",
                    "Divis√£o de Mon√¥mios",
                    "Potencia√ß√£o de Mon√¥mios",
                ],
                "Unidade 2: Polin√¥mios": [
                    "Defini√ß√£o e Classifica√ß√£o (Bin√¥mio, Trin√¥mio)",
                    "Grau de um Polin√¥mio",
                    "Polin√¥mio Reduzido",
                    "Adi√ß√£o e Subtra√ß√£o de Polin√¥mios",
                    "Multiplica√ß√£o de Polin√¥mio por Mon√¥mio",
                    "Multiplica√ß√£o de Polin√¥mio por Polin√¥mio",
                    "Divis√£o de Polin√¥mio por Mon√¥mio",
                ],
                "Unidade 3: Produtos Not√°veis": [
                    "Quadrado da Soma de Dois Termos (Interpreta√ß√£o Geom√©trica e Alg√©brica)",
                    "Quadrado da Diferen√ßa de Dois Termos",
                    "Produto da Soma pela Diferen√ßa de Dois Termos",
                    "Cubo da Soma e Cubo da Diferen√ßa (Intro)",
                    "Quadrado do Trin√¥mio (Aprofundamento)",
                ],
                "Unidade 4: Fatora√ß√£o Alg√©brica": [
                    "Fator Comum em Evid√™ncia",
                    "Fatora√ß√£o por Agrupamento",
                    "Diferen√ßa de Dois Quadrados",
                    "Trin√¥mio Quadrado Perfeito",
                    "Soma e Diferen√ßa de Cubos (Opcional/Aprofundamento)",
                ],
                "Unidade 5: Fra√ß√µes Alg√©bricas": [
                    "Defini√ß√£o e Condi√ß√£o de Exist√™ncia",
                    "Simplifica√ß√£o de Fra√ß√µes Alg√©bricas (Uso da Fatora√ß√£o)",
                    "Adi√ß√£o e Subtra√ß√£o (MMC de Polin√¥mios)",
                    "Multiplica√ß√£o e Divis√£o de Fra√ß√µes Alg√©bricas",
                ],
                "Unidade 6: Sistemas de Equa√ß√µes do 1¬∫ Grau": [
                    "Equa√ß√£o Linear com duas inc√≥gnitas (Solu√ß√µes infinitas/Gr√°fico de Reta)",
                    "Sistemas 2x2: Conceito de Solu√ß√£o Simult√¢nea",
                    "M√©todo da Substitui√ß√£o",
                    "M√©todo da Adi√ß√£o",
                    "Interpreta√ß√£o Geom√©trica do Sistema (Retas concorrentes, paralelas, coincidentes)",
                    "Classifica√ß√£o (SPD, SPI, SI)",
                    "Resolu√ß√£o de Problemas Contextualizados",
                ],
                "Unidade 7: Geometria - Tri√¢ngulos (Pontos Not√°veis e Congru√™ncia)": [
                    "Revis√£o: Elementos do Tri√¢ngulo",
                    "Mediana e Baricentro (Centro de Gravidade)",
                    "Bissetriz e Incentro (C√≠rculo Inscrito)",
                    "Altura e Ortocentro",
                    "Mediatriz e Circuncentro (C√≠rculo Circunscrito)",
                    "Conceito de Congru√™ncia de Figuras Planas",
                    "Casos de Congru√™ncia de Tri√¢ngulos (LAL, LLL, ALA, LAAo)",
                    "Propriedades do Tri√¢ngulo Is√≥sceles e Equil√°tero",
                ],
                "Unidade 8: Geometria - Quadril√°teros": [
                    "Soma dos √Çngulos Internos de Quadril√°teros",
                    "Paralelogramos: Propriedades (Lados, √Çngulos, Diagonais)",
                    "Ret√¢ngulos: Propriedades espec√≠ficas",
                    "Losangos: Propriedades espec√≠ficas",
                    "Quadrados: A uni√£o das propriedades",
                    "Trap√©zios: Classifica√ß√£o e Propriedades",
                    "Base M√©dia do Trap√©zio e do Tri√¢ngulo",
                ],
                "Unidade 9: C√≠rculo e Circunfer√™ncia": [
                    "Diferen√ßa entre C√≠rculo (Regi√£o) e Circunfer√™ncia (Contorno)",
                    "Elementos: Raio, Corda, Di√¢metro, Arco, Flecha",
                    "Posi√ß√µes Relativas: Reta e Circunfer√™ncia (Tangente, Secante, Externa)",
                    "Propriedade da Reta Tangente (Perpendicular ao raio)",
                    "Posi√ß√µes Relativas entre duas Circunfer√™ncias",
                    "√Çngulo Central e √Çngulo Inscrito (Rela√ß√£o de Medidas)",
                    "O N√∫mero Pi",
                    "Comprimento da Circunfer√™ncia e √Årea do C√≠rculo",
                ],
                "Unidade 10: Estat√≠stica e Probabilidade": [
                    "Princ√≠pio Fundamental da Contagem (PFC)",
                    "Espa√ßo Amostral e Evento",
                    "Probabilidade Te√≥rica (Laplace)",
                    "M√©dia, Moda e Mediana (Medidas de Tend√™ncia Central)",
                    "Gr√°ficos de Linhas e Histogramas",
                    "Medidas de Dispers√£o: Amplitude e no√ß√µes de Desvio Padr√£o",
                ],
            },

            "9¬∫ Ano": {
                "Unidade 1: Potencia√ß√£o e Radicia√ß√£o em R": [
                    "Revis√£o: Conjuntos Num√©ricos e N√∫meros Irracionais",
                    "A Reta Real e Intervalos",
                    "Pot√™ncia com Expoente Inteiro e Fracion√°rio",
                    "Nota√ß√£o Cient√≠fica e Ordem de Grandeza (F√≠sica)",
                    "Propriedades dos Radicais (Produto, Quociente, Raiz de Raiz)",
                    "Simplifica√ß√£o de Radicais (Extra√ß√£o de Fatores)",
                    "Opera√ß√µes com Radicais (Soma de semelhantes, Multiplica√ß√£o)",
                    "Racionaliza√ß√£o de Denominadores",
                ],
                "Unidade 2: Equa√ß√µes do 2¬∫ Grau": [
                    "Defini√ß√£o e Forma Geral (ax¬≤ + bx + c = 0)",
                    "Resolu√ß√£o de Equa√ß√µes Incompletas (Isolamento e Fatora√ß√£o)",
                    "Dedu√ß√£o da F√≥rmula Resolutiva (Completar Quadrados)",
                    "F√≥rmula de Bhaskara",
                    "O Discriminante (Delta) e a Natureza das Ra√≠zes",
                    "Rela√ß√µes de Soma e Produto (Girard)",
                    "Forma Fatorada da Equa√ß√£o do 2¬∫ Grau",
                    "Equa√ß√µes Biquadradas e Irracionais (Redut√≠veis ao 2¬∫ grau)",
                    "Sistemas de Equa√ß√µes envolvendo 2¬∫ Grau",
                ],
                "Unidade 3: Introdu√ß√£o √†s Fun√ß√µes": [
                    "No√ß√£o de Fun√ß√£o: Depend√™ncia entre Grandezas",
                    "Representa√ß√£o: Diagramas, Tabelas e Gr√°ficos",
                    "Dom√≠nio, Contradom√≠nio e Imagem",
                    "Fun√ß√£o Afim (1¬∫ Grau): Lei de Forma√ß√£o (ax+b)",
                    "Fun√ß√£o Afim: Gr√°fico (Reta), Coeficientes, Zero e Sinal",
                    "Fun√ß√£o Quadr√°tica (2¬∫ Grau): Lei de Forma√ß√£o",
                    "Fun√ß√£o Quadr√°tica: Gr√°fico (Par√°bola), V√©rtice e Zeros",
                ],
                "Unidade 4: Geometria - Semelhan√ßa e Teorema de Tales": [
                    "Raz√£o entre Segmentos e Segmentos Proporcionais",
                    "Feixe de Retas Paralelas",
                    "Teorema de Tales e Aplica√ß√µes",
                    "Teorema da Bissetriz Interna",
                    "Semelhan√ßa de Pol√≠gonos e Raz√£o de Semelhan√ßa",
                    "Casos de Semelhan√ßa de Tri√¢ngulos (AA, LAL, LLL)",
                    "Rela√ß√£o entre Per√≠metros e √Åreas de Figuras Semelhantes",
                ],
                "Unidade 5: Tri√¢ngulo Ret√¢ngulo e Trigonometria": [
                    "Rela√ß√µes M√©tricas no Tri√¢ngulo Ret√¢ngulo (Proje√ß√µes)",
                    "Teorema de Pit√°goras: Demonstra√ß√£o e Aplica√ß√µes",
                    "Aplica√ß√µes: Diagonal do Quadrado/Cubo e Altura do Tri√¢ngulo Equil√°tero",
                    "Raz√µes Trigonom√©tricas: Seno, Cosseno e Tangente",
                    "Tabela de √Çngulos Not√°veis (30¬∫, 45¬∫, 60¬∫)",
                    "Resolu√ß√£o de Problemas com Tri√¢ngulos Ret√¢ngulos",
                ],
                "Unidade 6: Rela√ß√µes na Circunfer√™ncia e Pol√≠gonos Regulares": [
                    "Rela√ß√µes M√©tricas na Circunfer√™ncia (Cordas, Secantes, Tangentes)",
                    "Pol√≠gonos Regulares Inscritos e Circunscritos",
                    "Rela√ß√£o entre Lado, Raio e Ap√≥tema (Tri√¢ngulo, Quadrado, Hex√°gono)",
                    "C√°lculo de √Åreas de Pol√≠gonos Regulares",
                ],
                "Unidade 7: √Åreas de Figuras Circulares": [
                    "Revis√£o: √Årea do C√≠rculo",
                    "√Årea do Setor Circular (Regra de tr√™s com √¢ngulo)",
                    "√Årea da Coroa Circular",
                    "√Årea do Segmento Circular",
                ],
                "Unidade 8: Probabilidade e Combinat√≥ria": [
                    "√Årvore de Possibilidades e Princ√≠pio Multiplicativo (Revis√£o)",
                    "Eventos Dependentes e Independentes",
                    "Probabilidade da Uni√£o de Eventos",
                    "Probabilidade Condicional (Introdu√ß√£o intuitiva)",
                ],
            },

            "1¬∫ Ano EM": {
                "Unidade 1: L√≥gica e Conjuntos": [
                    "L√≥gica Matem√°tica: Proposi√ß√µes, Conectivos e Tabelas-Verdade",
                    "Teoria dos Conjuntos: Representa√ß√£o e Subconjuntos",
                    "Opera√ß√µes: Uni√£o, Intersec√ß√£o, Diferen√ßa e Complementar",
                    "Conjuntos Num√©ricos (N, Z, Q, I, R) e Intervalos Reais",
                    "Problemas envolvendo Cardinalidade (Diagrama de Venn)",
                ],
                "Unidade 2: Fun√ß√µes - Conceitos Fundamentais": [
                    "Defini√ß√£o rigorosa de Fun√ß√£o",
                    "Dom√≠nio, Contradom√≠nio e Imagem",
                    "An√°lise Gr√°fica: Crescimento, Decrescimento, Sinais",
                    "Tipologia: Injetora, Sobrejetora e Bijetora",
                    "Fun√ß√£o Par e Fun√ß√£o √çmpar",
                    "Fun√ß√£o Composta",
                    "Fun√ß√£o Inversa",
                ],
                "Unidade 3: Fun√ß√£o Afim (Estudo Completo)": [
                    "Defini√ß√£o e Gr√°fico",
                    "Coeficientes Angular (Taxa de Varia√ß√£o) e Linear",
                    "Zero da Fun√ß√£o e Equa√ß√£o do 1¬∫ Grau",
                    "Estudo do Sinal",
                    "Inequa√ß√µes do 1¬∫ Grau (Simples, Produto e Quociente)",
                ],
                "Unidade 4: Fun√ß√£o Quadr√°tica (Estudo Completo)": [
                    "Defini√ß√£o e Concavidade da Par√°bola",
                    "Ra√≠zes e F√≥rmula de Bhaskara",
                    "V√©rtice: M√°ximos e M√≠nimos e Conjunto Imagem",
                    "Forma Can√¥nica e Fatorada",
                    "Estudo do Sinal da Fun√ß√£o Quadr√°tica",
                    "Inequa√ß√µes do 2¬∫ Grau (Produto e Quociente)",
                ],
                "Unidade 5: Fun√ß√£o Modular": [
                    "M√≥dulo de um N√∫mero Real (Defini√ß√£o Geom√©trica)",
                    "Fun√ß√£o Modular B√°sica e Gr√°fico",
                    "Transla√ß√µes e Transforma√ß√µes de Gr√°ficos Modulares",
                    "Equa√ß√µes Modulares",
                    "Inequa√ß√µes Modulares",
                ],
                "Unidade 6: Fun√ß√£o Exponencial": [
                    "Revis√£o de Potencia√ß√£o e Propriedades",
                    "Fun√ß√£o Exponencial: Defini√ß√£o, Gr√°fico e Ass√≠ntota",
                    "Equa√ß√µes Exponenciais (Igualdade de Bases e Vari√°vel Auxiliar)",
                    "Inequa√ß√µes Exponenciais",
                    "Aplica√ß√µes: Crescimento Populacional e Decaimento Radioativo",
                ],
                "Unidade 7: Fun√ß√£o Logar√≠tmica": [
                    "Defini√ß√£o de Logaritmo",
                    "Condi√ß√£o de Exist√™ncia",
                    "Propriedades Operat√≥rias (Produto, Quociente, Pot√™ncia)",
                    "Mudan√ßa de Base",
                    "Fun√ß√£o Logar√≠tmica: Gr√°fico, Dom√≠nio e Imagem",
                    "Equa√ß√µes Logar√≠tmicas",
                    "Inequa√ß√µes Logar√≠tmicas",
                    "Aplica√ß√µes: Escala Richter, pH, Decib√©is",
                ],
                "Unidade 8: Sequ√™ncias e Progress√µes": [
                    "Defini√ß√£o de Sequ√™ncia e Lei de Forma√ß√£o",
                    "Progress√£o Aritm√©tica (PA): Termo Geral, Propriedades e Soma",
                    "Progress√£o Geom√©trica (PG): Termo Geral e Propriedades",
                    "Soma de PG Finita e Infinita (S√©ries Geom√©tricas)",
                    "Matem√°tica Financeira: Juros Compostos e S√©ries Uniformes",
                ],
            },

            "2¬∫ Ano EM": {
                "Unidade 1: Trigonometria - Ciclo e Fun√ß√µes": [
                    "Medidas de Arcos: Graus e Radianos",
                    "Ciclo Trigonom√©trico e Arcos C√¥ngruos",
                    "Seno, Cosseno e Tangente no Ciclo",
                    "Rela√ß√£o Fundamental e Auxiliares (Sec, Cossec, Cotg)",
                    "Redu√ß√£o ao 1¬∫ Quadrante e Simetrias",
                    "Fun√ß√µes Seno e Cosseno: Gr√°ficos, Per√≠odo e Imagem",
                    "Fun√ß√£o Tangente: Gr√°fico e Dom√≠nio",
                    "Transforma√ß√µes Gr√°ficas (y = a + b.sen(cx + d))",
                ],
                "Unidade 2: Identidades, Transforma√ß√µes e Equa√ß√µes": [
                    "F√≥rmulas de Adi√ß√£o e Subtra√ß√£o de Arcos",
                    "Arco Duplo e Arco Metade",
                    "Transforma√ß√£o em Produto (F√≥rmulas de Werner - Prostaferese)",
                    "Equa√ß√µes Trigonom√©tricas em R",
                    "Inequa√ß√µes Trigonom√©tricas (Visualiza√ß√£o no Ciclo)",
                ],
                "Unidade 3: An√°lise Combinat√≥ria": [
                    "Princ√≠pio Fundamental da Contagem (PFC)",
                    "Fatorial e suas propriedades",
                    "Arranjos Simples",
                    "Permuta√ß√£o Simples e com Repeti√ß√£o",
                    "Permuta√ß√£o Circular",
                    "Combina√ß√£o Simples e Propriedades",
                    "Tri√¢ngulo de Pascal",
                    "Bin√¥mio de Newton (Termo Geral)",
                ],
                "Unidade 4: Probabilidade": [
                    "Defini√ß√£o Cl√°ssica (Laplace)",
                    "Probabilidade da Uni√£o e Eventos Mutuamente Exclusivos",
                    "Probabilidade Condicional",
                    "Eventos Independentes e Regra do Produto",
                    "Lei Binomial da Probabilidade",
                ],
                "Unidade 5: Matrizes e Determinantes": [
                    "Matrizes: Defini√ß√£o, Tipos Especiais e Igualdade",
                    "Opera√ß√µes Matriciais (Soma, Subtra√ß√£o, Produto por Escalar, Produto Matricial)",
                    "Matriz Inversa e Transposta",
                    "Determinantes: Defini√ß√£o e Regra de Sarrus (2x2, 3x3)",
                    "Teorema de Laplace e Regra de Chi√≥",
                    "Propriedades dos Determinantes",
                ],
                "Unidade 6: Sistemas Lineares": [
                    "Equa√ß√£o Linear e Sistema Linear",
                    "Classifica√ß√£o quanto √†s solu√ß√µes (SPD, SPI, SI)",
                    "Regra de Cramer",
                    "Escalonamento de Sistemas (M√©todo de Gauss)",
                    "Discuss√£o de Sistemas Lineares (Param√©tricos)",
                ],
                "Unidade 7: Geometria Espacial de Posi√ß√£o": [
                    "Axiomas e Postulados (Euclides/Hilbert)",
                    "Posi√ß√µes Relativas: Reta-Reta, Reta-Plano, Plano-Plano",
                    "Perpendicularismo e Ortogonalidade no Espa√ßo",
                    "Proje√ß√µes Ortogonais",
                    "Dist√¢ncias e √Çngulos no Espa√ßo (Diedros)",
                ],
            },

            "3¬∫ Ano EM": {
                "Unidade 1: Geometria Espacial - Poliedros e Prismas": [
                    "Poliedros: Defini√ß√£o, Elementos e Rela√ß√£o de Euler",
                    "Poliedros Regulares (Plat√£o)",
                    "Prismas: Defini√ß√£o, Classifica√ß√£o e Sec√ß√£o",
                    "√Årea Lateral e Total de Prismas",
                    "Volume de Prismas (Princ√≠pio de Cavalieri)",
                    "Paralelep√≠pedo e Cubo (Diagonais)",
                ],
                "Unidade 2: Geometria Espacial - Pir√¢mides e Corpos Redondos": [
                    "Pir√¢mides: Elementos, Ap√≥tema e √Åreas",
                    "Volume de Pir√¢mides",
                    "Tronco de Pir√¢mide",
                    "Cilindro: Elementos, Sec√ß√£o Meridiana, √Åreas e Volume",
                    "Cone: Elementos, √Åreas e Volume",
                    "Tronco de Cone",
                    "Esfera: Elementos, √Årea da Superf√≠cie e Volume",
                    "Partes da Esfera (Fuso e Cunha)",
                ],
                "Unidade 3: Geometria Anal√≠tica - Ponto e Reta": [
                    "Coordenadas no Plano e Dist√¢ncia entre Pontos",
                    "Ponto M√©dio e Baricentro do Tri√¢ngulo",
                    "Condi√ß√£o de Alinhamento de 3 Pontos",
                    "Equa√ß√£o Geral e Reduzida da Reta",
                    "Coeficiente Angular e Inclina√ß√£o",
                    "Posi√ß√µes Relativas entre Retas (Paralelismo e Perpendicularismo)",
                    "Dist√¢ncia de Ponto a Reta",
                    "√Årea de Pol√≠gonos (M√©todo dos Determinantes)",
                ],
                "Unidade 4: Geometria Anal√≠tica - Circunfer√™ncia e C√¥nicas": [
                    "Equa√ß√£o Reduzida e Geral da Circunfer√™ncia",
                    "Determina√ß√£o de Centro e Raio",
                    "Posi√ß√µes Relativas (Ponto-Circunfer√™ncia, Reta-Circunfer√™ncia)",
                    "Elipse: Defini√ß√£o, Elementos e Equa√ß√£o",
                    "Hip√©rbole: Defini√ß√£o, Elementos e Equa√ß√£o",
                    "Par√°bola: Defini√ß√£o, Elementos e Equa√ß√£o (Foco e Diretriz)",
                ],
                "Unidade 5: N√∫meros Complexos": [
                    "A Unidade Imagin√°ria (i) e Conjunto C",
                    "Forma Alg√©brica (z = a + bi) e Conjugado",
                    "Opera√ß√µes na Forma Alg√©brica e Pot√™ncias de i",
                    "Plano de Argand-Gauss e Interpreta√ß√£o Geom√©trica",
                    "M√≥dulo e Argumento",
                    "Forma Trigonom√©trica (Polar)",
                    "Opera√ß√µes na Forma Trigonom√©trica (Produto e Divis√£o)",
                    "F√≥rmulas de Moivre (Potencia√ß√£o e Radicia√ß√£o)",
                ],
                "Unidade 6: Polin√¥mios e Equa√ß√µes Alg√©bricas": [
                    "Polin√¥mios em C: Grau, Valor Num√©rico e Raiz",
                    "Identidade de Polin√¥mios",
                    "Divis√£o de Polin√¥mios: M√©todo da Chave e Briot-Ruffini",
                    "Teorema do Resto e D'Alembert",
                    "Equa√ß√µes Polinomiais: Teorema Fundamental da √Ålgebra",
                    "Multiplicidade de Ra√≠zes",
                    "Rela√ß√µes de Girard",
                    "Ra√≠zes Complexas Conjugadas",
                ],
                "Unidade 7: Estat√≠stica Inferencial e Revis√£o": [
                    "Medidas de Dispers√£o: Vari√¢ncia e Desvio Padr√£o (Aprofundamento)",
                    "Coeficiente de Varia√ß√£o",
                    "No√ß√µes de Distribui√ß√£o Normal (Curva de Gauss)",
                    "An√°lise de Dados Bivariados (Dispers√£o e Correla√ß√£o intuitiva)",
                ],
            },
        };
        // 2. CONTE√öDO DA TEORIA (COMPLETO)
        const CONTEUDO_TEORIA = {
            //
            // SEXTO ANO
            //

            // =================================================================
            // CONTE√öDO 6¬∫ ANO
            // =================================================================

            // =======================================================
            // UNIDADE 1: HIST√ìRIA E SISTEMAS NUM√âRICOS
            // =======================================================
            "A Necessidade Humana de Contar e Registrar": `
<h3>1. A Primeira Tecnologia Humana ü¶¥</h3>
<p>Antes de inventar a roda ou o fogo, o ser humano precisou inventar o <strong>N√∫mero</strong>. Sem isso, n√£o existiria com√©rcio, constru√ß√£o ou calend√°rios.</p>

<div class="bg-gray-50 p-4 rounded-xl border-l-4 border-gray-500 my-4">
<h4 class="font-bold text-gray-700">üêë O Problema das Ovelhas (Correspond√™ncia Biun√≠voca)</h4>
<p class="text-sm mt-1">Imagine um pastor h√° 10.000 anos. Ele n√£o sabia falar "quarenta e dois". Para controlar o rebanho, ele usava uma pedra para cada ovelha.</p>
<ul class="list-none mt-2 text-sm font-mono text-gray-600">
<li>Saiu ovelha ‚û° P√µe pedra no saco.</li>
<li>Voltou ovelha ‚û° Tira pedra do saco.</li>
<li>Sobrou pedra? ‚û° O lobo comeu uma ovelha!</li>
</ul>
</div>
`,

            "Sistema Eg√≠pcio: O Princ√≠pio Aditivo e seus S√≠mbolos": `
<div class="relative bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200">
<div class="absolute -top-3 left-4 bg-yellow-200 text-yellow-800 text-xs font-bold px-2 py-1 rounded">3.000 a.C.</div>
<h4 class="font-bold text-brand-text mt-2">üá™üá¨ Sistema Eg√≠pcio: O Amontoado</h4>
<p class="text-sm text-gray-700">Eles usavam desenhos (hier√≥glifos) para 1, 10, 100, 1000...</p>

<div class="grid grid-cols-2 gap-4 mt-3 text-sm">
<div>
<strong>Como funciona:</strong><br>
√â <strong>Aditivo</strong>. Voc√™ desenha os s√≠mbolos e soma tudo. A ordem n√£o importa (uma bagun√ßa!).
</div>
<div class="bg-white p-2 rounded border border-yellow-300 text-center">
<span class="text-xs text-gray-400">Para escrever 999:</span><br>
<strong>Voc√™ precisa desenhar 27 s√≠mbolos!</strong> üò±<br>
(9 cordas, 9 calcanhares, 9 bast√µes)
</div>
</div>
<div class="mt-2 text-xs text-red-500 font-bold">üö´ Defeito: N√£o √© posicional. √â dif√≠cil escrever n√∫meros grandes.</div>
</div>
`,

            "Sistema Babil√¥nico: A Base 60 (Sexagesimal) e o Princ√≠pio Posicional": `
<h3>1. Tablets de Argila (Muito antes do iPad) üß±</h3>
<p>Na Mesopot√¢mia (atual Iraque), h√° 4.000 anos, os babil√¥nios escreviam pressionando um estilete em argila mole. Chamamos isso de escrita <strong>Cuneiforme</strong> (forma de cunha).</p>

<p>Eles eram pr√°ticos e usavam apenas <strong>DOIS s√≠mbolos</strong> para escrever qualquer n√∫mero:</p>

<div class="flex justify-center gap-8 my-6">
<div class="text-center group cursor-pointer hover:scale-110 transition-transform">
<div class="text-5xl font-black text-brand-orange leading-none">Y</div>
<div class="text-xs font-bold text-gray-600 mt-2 bg-orange-100 px-2 py-1 rounded">O Cravo (Vale 1)</div>
</div>
<div class="text-center group cursor-pointer hover:scale-110 transition-transform">
<div class="text-5xl font-black text-brand-blue leading-none">&lt;</div>
<div class="text-xs font-bold text-gray-600 mt-2 bg-blue-100 px-2 py-1 rounded">A Asna (Vale 10)</div>
</div>
</div>

<p>Para escrever n√∫meros pequenos (at√© 59), era parecido com o sistema romano: s√≥ juntar tudo.</p>
<div class="bg-white p-4 rounded-xl text-center font-mono text-xl border-2 border-gray-200 shadow-sm my-4">
&lt;&lt;&lt;YYY <span class="text-gray-400 mx-2">‚ûî</span> 10+10+10+1+1+1 = <strong class="text-brand-text">33</strong>
</div>

<h3>2. O Segredo do 60 (Base Sexagesimal) üï∞Ô∏è</h3>
<p>N√≥s contamos de 10 em 10 (Base 10). Eles contavam de <strong>60 em 60</strong>.</p>

<div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm shadow-sm">
<strong>ü§î Por que 60?</strong>
<p class="mt-1 text-yellow-900">Porque 60 √© um n√∫mero m√°gico! Ele √© divis√≠vel por 1, 2, 3, 4, 5, 6, 10, 12, 15, 20 e 30. Isso facilitava muito o com√©rcio e a divis√£o de terras sem usar n√∫meros quebrados!</p>
</div>

<h3>3. A Grande Inven√ß√£o: O Valor Posicional ü™ë</h3>
<p>Aqui eles deram um salto genial. O mesmo s√≠mbolo pode valer 1 ou 60, dependendo da "cadeira" onde ele senta.</p>

<div class="bg-blue-50 p-4 rounded-xl border-2 border-brand-blue my-6 relative overflow-hidden">
<div class="absolute top-0 right-0 bg-brand-blue text-white text-[10px] font-bold px-2 py-1 rounded-bl-lg uppercase">Decifrando o C√≥digo</div>

<p class="text-center text-sm text-blue-800 mb-4 font-bold">Imagine o n√∫mero escrito assim:</p>

<div class="flex items-center justify-center gap-2 md:gap-6 font-mono text-lg">
<div class="flex flex-col items-center bg-white p-2 rounded-lg shadow-sm border border-blue-200 w-24">
<span class="text-brand-purple font-black text-3xl mb-1">Y</span>
<div class="w-full h-px bg-gray-200 mb-1"></div>
<span class="text-[10px] uppercase font-bold text-gray-400">Grupo de 60</span>
<span class="text-xs font-bold text-brand-purple">1 x 60</span>
</div>

<div class="text-2xl text-gray-300 font-black">+</div>

<div class="flex flex-col items-center bg-white p-2 rounded-lg shadow-sm border border-blue-200 w-24">
<span class="text-brand-orange font-black text-3xl mb-1">&lt;Y</span>
<div class="w-full h-px bg-gray-200 mb-1"></div>
<span class="text-[10px] uppercase font-bold text-gray-400">Grupo de 1</span>
<span class="text-xs font-bold text-brand-orange">10 + 1</span>
</div>

<div class="text-2xl text-gray-300 font-black">=</div>

<div class="flex flex-col items-center justify-center">
<span class="font-black text-4xl text-brand-green">71</span>
</div>
</div>
</div>
`,

            "Conex√£o Hist√≥rica: Por que a hora tem 60 minutos e o c√≠rculo 360 graus?": `
<h3>1. Uma Heran√ßa de 5.000 Anos üèõÔ∏è</h3>
<p>Voc√™ j√° notou que quase tudo no mundo usa a base 10 (dinheiro, metros, quilos), mas o Tempo e os √Çngulos usam a <strong>Base 60</strong>?</p>
<p>Isso n√£o √© teimosia! √â uma heran√ßa dos <strong>Sum√©rios e Babil√¥nios</strong> (povos da antiga Mesopot√¢mia). Eles criaram esse sistema porque o n√∫mero 60 √© "m√°gico" para fazer contas de cabe√ßa.</p>

<h3>2. A Batalha das Bases: 10 vs 60 ü•ä</h3>
<p>Por que eles escolheram 60 e n√£o 10 ou 100? A resposta est√° na <strong>Divis√£o</strong>. O n√∫mero 60 √© o rei da divis√£o sem deixar quebradinhos (decimais).</p>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
<div class="bg-gray-100 p-4 rounded-xl border-2 border-gray-300 opacity-80">
<h4 class="font-bold text-gray-500 uppercase text-xs mb-2">Base 10 (Nossos Dedos)</h4>
<p class="text-sm mb-2">O n√∫mero 10 s√≥ tem <strong>2 divisores</strong> (al√©m do 1 e 10):</p>
<div class="flex gap-2 justify-center">
<span class="bg-white px-3 py-1 rounded shadow text-sm font-bold">2</span>
<span class="bg-white px-3 py-1 rounded shadow text-sm font-bold">5</span>
</div>
<p class="text-xs text-red-500 mt-2 font-bold">Tente dividir 10 por 3... d√° 3,333... (Quebrado!)</p>
</div>

<div class="bg-blue-50 p-4 rounded-xl border-2 border-brand-blue shadow-lg transform md:scale-105">
<h4 class="font-bold text-brand-blue uppercase text-xs mb-2">Base 60 (Babil√¥nios)</h4>
<p class="text-sm mb-2">O n√∫mero 60 tem <strong>10 divisores</strong> importantes!</p>
<div class="flex flex-wrap gap-2 justify-center">
<span class="bg-white px-2 py-1 rounded shadow text-xs font-bold text-brand-blue">2</span>
<span class="bg-white px-2 py-1 rounded shadow text-xs font-bold text-brand-blue">3</span>
<span class="bg-white px-2 py-1 rounded shadow text-xs font-bold text-brand-blue">4</span>
<span class="bg-white px-2 py-1 rounded shadow text-xs font-bold text-brand-blue">5</span>
<span class="bg-white px-2 py-1 rounded shadow text-xs font-bold text-brand-blue">6</span>
<span class="bg-white px-2 py-1 rounded shadow text-xs font-bold text-brand-blue">10</span>
<span class="bg-white px-2 py-1 rounded shadow text-xs font-bold text-brand-blue">12</span>
<span class="bg-white px-2 py-1 rounded shadow text-xs font-bold text-brand-blue">15</span>
<span class="bg-white px-2 py-1 rounded shadow text-xs font-bold text-brand-blue">20</span>
<span class="bg-white px-2 py-1 rounded shadow text-xs font-bold text-brand-blue">30</span>
</div>
<p class="text-xs text-brand-green mt-2 font-bold">Divide por 3? Sim (20). Por 4? Sim (15). Perfeito para com√©rcio!</p>
</div>
</div>

<h3>3. Por que o C√≠rculo tem 360 Graus? ‚òÄÔ∏è</h3>
<p>Os antigos astr√¥nomos observavam o Sol se mover no c√©u. Eles notaram que o Sol levava aproximadamente <strong>360 dias</strong> para voltar √† mesma posi√ß√£o (um ano).</p>

<div class="relative w-64 h-64 mx-auto my-6">
<div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-4xl animate-pulse">‚òÄÔ∏è</div>
<div class="absolute inset-0 border-2 border-dashed border-yellow-400 rounded-full opacity-50"></div>
<div class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-blue-500 w-4 h-4 rounded-full"></div>

<div class="absolute bottom-4 left-0 right-0 text-center bg-white/90 p-2 rounded shadow-sm text-xs text-gray-600">
<strong>1 Grau</strong> ‚âà Passo do Sol em <strong>1 Dia</strong>
</div>
</div>

<p>Como eles amavam a base 60, fizeram a conta: $6 \\times 60 = 360$. Era um n√∫mero perfeito! Pr√≥ximo dos 365 dias do ano e super f√°cil de dividir em fatias.</p>

<h3>4. E o Rel√≥gio? üï∞Ô∏è</h3>
<p>Quando inventaram os rel√≥gios mec√¢nicos, precisavam dividir a hora. Se usassem base 10 (1 hora = 100 minutos), seria um pesadelo:</p>

<ul class="list-none space-y-2 bg-yellow-50 p-4 rounded-xl border border-yellow-200 text-sm">
<li>‚ùå <strong>No Rel√≥gio Decimal (100 min):</strong><br> Um ter√ßo de hora seria 33,333... minutos. Dif√≠cil de marcar no mostrador!</li>
<li class="border-t border-yellow-200 pt-2">‚úÖ <strong>No Rel√≥gio Babil√¥nico (60 min):</strong><br> Um ter√ßo de hora s√£o exatos <strong>20 minutos</strong>. Metade s√£o <strong>30</strong>. Um quarto s√£o <strong>15</strong>.</li>
</ul>

<p>Por isso, at√© hoje, a matem√°tica do tempo e da geometria fala "Babil√¥nico"!</p>
`,

            "Sistema Romano: Regras Aditivas, Subtrativas e Multiplicativas (milhares)": `
<div class="relative bg-red-50 p-4 rounded-xl border-2 border-red-200">
<div class="absolute -top-3 left-4 bg-red-200 text-red-800 text-xs font-bold px-2 py-1 rounded">Imp√©rio Romano</div>
<h4 class="font-bold text-brand-text mt-2">üèõÔ∏è Sistema Romano: A L√≥gica R√≠gida</h4>
<p class="text-sm text-gray-700">Usavam letras: I, V, X, L, C, D, M.</p>

<div class="mt-3 text-sm">
<strong>A Inova√ß√£o:</strong> Eles criaram a <strong>Subtra√ß√£o</strong> na escrita.<br>
VI = 6 (5 + 1) <span class="text-gray-400">|</span> IV = 4 (5 - 1).
</div>

<div class="bg-white p-3 rounded mt-3 border border-red-100 shadow-sm">
<p class="text-xs font-bold text-brand-text mb-1">üß† Desafio Mental:</p>
<p class="text-sm">Tente calcular <strong>CXIV $\\times$ XLII</strong> sem converter para o nosso sistema.</p>
<p class="text-brand-red font-black mt-1">√â quase imposs√≠vel!</p>
</div>
<div class="mt-2 text-xs text-red-500 font-bold">üö´ Defeito: N√£o tem ZERO. P√©ssimo para fazer contas.</div>
</div>
`,

            "Sistema Maia: Introdu√ß√£o √† Base Vigesimal e a inven√ß√£o do Zero": `
<div class="relative bg-green-50 p-4 rounded-xl border-2 border-green-200">
<div class="absolute -top-3 left-4 bg-green-200 text-green-800 text-xs font-bold px-2 py-1 rounded">Am√©rica Central</div>
<h4 class="font-bold text-brand-text mt-2">üåΩ Sistema Maia: Os G√™nios Esquecidos</h4>
<p class="text-sm text-gray-700">Enquanto os romanos sofriam, os Maias j√° tinham inventado o <strong>ZERO</strong> (uma concha)!</p>

<ul class="list-disc list-inside mt-2 text-sm text-gray-600">
<li><strong>Base 20:</strong> Contavam os dedos das m√£os e dos p√©s.</li>
<li><strong>Posicional:</strong> O valor mudava dependendo da altura do s√≠mbolo.</li>
</ul>
<div class="mt-2 text-xs text-brand-green font-bold">‚úÖ Vantagem: Tinham o Zero e valor posicional!</div>
</div>

<div class="bg-white p-3 rounded-xl border-l-4 border-brand-purple shadow-sm mt-4">
<strong class="text-brand-purple block mb-1">2. O Mundo n√£o √© s√≥ Base 10</strong>
<p class="text-xs text-gray-600">
Estudar os Maias (Base 20) nos prepara para entender:
<br>‚Ä¢ <strong>Computadores:</strong> Usam Base 2 (Bin√°rio).
<br>‚Ä¢ <strong>Rel√≥gios:</strong> Usam Base 60 (Sexagesimal, heran√ßa dos Babil√¥nios).
</p>
</div>
`,

            "Sistema Decimal: Base 10, Valor Posicional e Classes/Ordens": `
<h3>O Campe√£o: Sistema Indo-Ar√°bico üèÜ</h3>
<p>Nascido na √çndia e divulgado pelos √Årabes, √© o sistema perfeito porque usa apenas 10 s√≠mbolos (0 a 9) para escrever <strong>qualquer n√∫mero do universo</strong>.</p>

<div class="bg-gray-800 text-white p-4 rounded-xl text-center mt-4 mb-4">
<p class="text-sm uppercase tracking-widest font-bold text-gray-400 mb-2">O Segredo do Sucesso</p>
<div class="text-2xl font-mono">Valor Posicional</div>
<p class="text-xs mt-2 text-gray-300">O "3" em <strong>3</strong>00 vale cem vezes mais que o "3" em <strong>3</strong>.</p>
</div>

<p>Na matem√°tica, para n√£o nos perdermos em n√∫meros gigantes, n√≥s organizamos os algarismos em <strong>Ordens</strong> e <strong>Classes</strong>. √â como organizar um condom√≠nio.</p>

[WIDGET:interactive_place_value_extended]
`,

            "Leitura e Escrita de Grandes N√∫meros (Bilh√µes e Trilh√µes)": `
<h3>O Endere√ßo dos N√∫meros üèòÔ∏è</h3>
<p>Tente ler este n√∫mero r√°pido: <strong>23849281</strong>.</p>
<p>Dif√≠cil, n√©? Agora tente este: <strong>23 849 281</strong>.</p>

<div class="bg-white p-4 rounded-xl border-l-4 border-brand-blue shadow-sm my-4">
<h4 class="font-bold text-brand-blue mb-2">ü™ë 1. As Ordens (O Lugar Individual)</h4>
<p class="text-sm text-gray-600">Cada d√≠gito senta em uma cadeira numerada. A contagem come√ßa sempre da <strong>DIREITA para a ESQUERDA</strong>.</p>
</div>

<div class="bg-white p-4 rounded-xl border-l-4 border-brand-purple shadow-sm my-4">
<h4 class="font-bold text-brand-purple mb-2">üè¢ 2. As Classes (Os Apartamentos)</h4>
<p class="text-sm text-gray-600">A cada <strong>3 Ordens</strong>, formamos uma Classe (Unidades, Milhares, Milh√µes...).</p>
</div>

[WIDGET:interactive_class_order_explorer]
`,

            "A Reta Num√©rica Natural: Ordem, Sucessor e Antecessor": `
<h3>1. A Estrada dos N√∫meros üõ£Ô∏è</h3>
<p>Imagine uma estrada que tem come√ßo (no zero), mas n√£o tem fim. Cada n√∫mero tem sua "casa" fixa nela, sempre √† mesma dist√¢ncia um do outro. Isso √© a <strong>Reta Num√©rica</strong>.</p>

<div class="bg-blue-50 p-3 rounded-lg border-l-4 border-brand-blue text-sm text-center my-4">
<strong>Regra de Ouro:</strong><br>
Na reta, quem est√° √† <strong>DIREITA</strong> √© sempre <strong>MAIOR</strong>.
</div>

<p>O conjunto dos N√∫meros Naturais ($\\mathbb{N}$) √© infinito. A seta na ponta da reta indica que ela nunca acaba!</p>

[WIDGET:interactive_number_line_explorer]

<h3>2. Antecessor e Sucessor</h3>
<p>Todo n√∫mero natural tem seus vizinhos. Eles moram exatamente ao lado:</p>

<ul class="list-none space-y-2 mt-2">
<li class="flex items-center gap-3 bg-gray-50 p-3 rounded-lg border border-gray-200">
<span class="text-2xl">üëà</span>
<div>
<strong>Antecessor:</strong> O vizinho da esquerda. √â o n√∫mero menos 1.<br>
<span class="text-xs text-gray-500">Ex: O antecessor de 15 √© 14.</span>
</div>
</li>
<li class="flex items-center gap-3 bg-gray-50 p-3 rounded-lg border border-gray-200">
<span class="text-2xl">üëâ</span>
<div>
<strong>Sucessor:</strong> O vizinho da direita. √â o n√∫mero mais 1.<br>
<span class="text-xs text-gray-500">Ex: O sucessor de 15 √© 16.</span>
</div>
</li>
</ul>

<div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow mt-6 text-sm shadow-sm">
<h4 class="font-bold text-yellow-700 mb-1 flex items-center gap-2"><i class="fas fa-exclamation-triangle"></i> A Exce√ß√£o do Zero</h4>
<p>Nos N√∫meros Naturais ($\\mathbb{N}$), o <strong>Zero</strong> √© o √∫nico que n√£o tem antecessor. Ele √© o in√≠cio da estrada!</p>
<p class="text-xs text-yellow-600 mt-1 italic">(O antecessor dele seria o -1, mas ele mora em outro conjunto que veremos no 7¬∫ ano).</p>
</div>
`,

            "N√∫meros Pares e √çmpares (Paridade)": `
<h3>1. O Baile dos N√∫meros üíÉüï∫</h3>
<p>Imagine um baile. Se todos conseguirem formar pares para dan√ßar e n√£o sobrar ningu√©m, dizemos que o n√∫mero de pessoas √© <strong>PAR</strong>.</p>
<p>Se, ao formar os casais, sobrar uma pessoa sozinha (o "solit√°rio"), dizemos que o n√∫mero √© <strong>√çMPAR</strong>.</p>

<div class="flex justify-center gap-8 my-6">
<div class="text-center group">
<div class="flex gap-1 justify-center mb-2">
<div class="w-4 h-4 rounded-full bg-brand-blue"></div>
<div class="w-4 h-4 rounded-full bg-brand-blue"></div>
</div>
<div class="flex gap-1 justify-center">
<div class="w-4 h-4 rounded-full bg-brand-blue"></div>
<div class="w-4 h-4 rounded-full bg-brand-blue"></div>
</div>
<p class="text-xs font-bold text-brand-blue mt-2">4 (Par)</p>
</div>

<div class="w-px bg-gray-300"></div>

<div class="text-center group">
<div class="flex gap-1 justify-center mb-2">
<div class="w-4 h-4 rounded-full bg-brand-orange"></div>
<div class="w-4 h-4 rounded-full bg-brand-orange"></div>
</div>
<div class="flex gap-1 justify-center">
<div class="w-4 h-4 rounded-full bg-brand-orange"></div>
<div class="w-4 h-4 rounded-full bg-gray-200 border border-gray-400 opacity-50"></div>
</div>
<p class="text-xs font-bold text-brand-orange mt-2">3 (√çmpar)</p>
<p class="text-[10px] text-gray-500">Sobrou um!</p>
</div>
</div>

[WIDGET:interactive_parity_visualizer]

<h3>2. A Regra do Final (O D√≠gito M√°gico) ü™Ñ</h3>
<p>E se o n√∫mero for gigante, tipo <strong>1.458.932</strong>? Voc√™ n√£o vai desenhar um milh√£o de bolinhas!</p>
<p>Basta olhar para o <strong>√öLTIMO ALGARISMO</strong> (o da direita, na casa das unidades).</p>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-4">
<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue shadow-sm">
<h4 class="font-bold text-brand-blue mb-2">√â PAR se terminar em:</h4>
<div class="flex justify-around font-mono font-black text-xl text-brand-text">
<span>0</span> <span>2</span> <span>4</span> <span>6</span> <span>8</span>
</div>
</div>
<div class="bg-orange-50 p-4 rounded-xl border-l-4 border-brand-orange shadow-sm">
<h4 class="font-bold text-brand-orange mb-2">√â √çMPAR se terminar em:</h4>
<div class="flex justify-around font-mono font-black text-xl text-brand-text">
<span>1</span> <span>3</span> <span>5</span> <span>7</span> <span>9</span>
</div>
</div>
</div>

<h3>3. A Qu√≠mica da Paridade ‚öóÔ∏è</h3>
<p>O que acontece se somarmos dois n√∫meros Pares? E dois √çmpares?</p>
<ul class="list-none space-y-2 mt-2 text-sm text-gray-700">
<li>üîµ + üîµ = üîµ (Par + Par = Par)</li>
<li>üü† + üü† = üîµ (√çmpar + √çmpar = Par) <span class="text-xs text-gray-400">Pera√≠, o queee? Sim! Os dois "sobrados" se juntam e formam um novo par!</span></li>
<li>üîµ + üü† = üü† (Par + √çmpar = √çmpar)</li>
</ul>

<p>Teste essa "qu√≠mica" no laborat√≥rio abaixo:</p>

[WIDGET:interactive_parity_lab]

<h3>4. Desafio do Goleiro ü•Ö</h3>
<p>Voc√™ √© o goleiro. N√∫meros v√£o ser chutados no gol. Defenda dizendo se s√£o Pares ou √çmpares antes que o tempo acabe!</p>

[WIDGET:interactive_parity_game]
`,

            // =======================================================
            // UNIDADE 2: OPERA√á√ïES (CAMPO ADITIVO)
            // =======================================================
            "Adi√ß√£o: Ideias (Juntar e Acrescentar)": `
<h3>Adi√ß√£o: O Poder da Uni√£o ‚ûï</h3>
<p>A adi√ß√£o √© a opera√ß√£o mais natural que existe. Ela serve para <strong>juntar</strong> quantidades ou <strong>acrescentar</strong> algo ao que voc√™ j√° tem.</p>

<div class="bg-green-50 p-4 rounded-xl border-2 border-green-200 shadow-sm my-4">
<h4 class="font-bold text-brand-green mb-4 flex items-center gap-2">
<i class="fas fa-magic"></i> Superpoderes (Propriedades)
</h4>

<div class="mb-4">
<p class="text-sm font-bold text-gray-700 mb-2">üîÑ Comutativa: A ordem n√£o importa!</p>
<div class="flex items-center justify-center gap-4 bg-white p-3 rounded-lg border border-green-100 font-mono">
<span>10 + 2</span> <span class="text-gray-300">=</span> <span class="font-bold text-brand-green">12</span> <span class="text-gray-300">=</span> <span>2 + 10</span>
</div>
</div>

<div class="mb-4">
<p class="text-sm font-bold text-gray-700 mb-2">ü§ù Associativa: Voc√™ escolhe quem somar primeiro.</p>
<div class="font-mono bg-white p-2 rounded text-center text-sm border border-green-100">
(10 + 2) + 5 = <strong>17</strong> = 10 + (2 + 5)
</div>
</div>
</div>

[WIDGET:interactive_addition_vertical]

<div class="bg-yellow-50 p-3 rounded-lg border-l-4 border-brand-yellow mt-4 text-sm">
<strong>‚ö†Ô∏è Dica de Mestre:</strong> Ao armar a conta, o segredo √© o alinhamento! Unidade embaixo de Unidade, Dezena embaixo de Dezena.
</div>
`,

            "Propriedades da Adi√ß√£o: Comutativa, Associativa e Elemento Neutro": `
<h3>1. O Segredo dos Matem√°ticos Pregui√ßosos üò¥</h3>
<p>Voc√™ j√° viu algu√©m somar de cabe√ßa super r√°pido? O segredo n√£o √© ser um g√™nio, √© usar as <strong>Propriedades da Adi√ß√£o</strong>. Elas s√£o como "trapa√ßas oficiais" do jogo da matem√°tica que permitem facilitar a conta.</p>

<h3>2. Propriedade Comutativa (O Teletransporte) üîÑ</h3>
<p>A palavra "comutar" significa <strong>trocar</strong>. Na adi√ß√£o, a ordem das parcelas n√£o altera a soma. Tanto faz se voc√™ cal√ßa o t√™nis esquerdo ou o direito primeiro; no final, voc√™ est√° cal√ßado!</p>

<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm text-center">
<p class="text-lg font-mono font-bold text-brand-blue mb-2">A + B = B + A</p>
<p class="text-sm text-gray-600">"A ordem dos fatores n√£o altera o produto" (ops, aqui √© soma, mas a l√≥gica √© a mesma!)</p>
</div>

<p>Experimente trocar os n√∫meros de lugar e veja se o resultado muda:</p>

[WIDGET:interactive_commutative_swap]

<h3>3. Propriedade Associativa (As Panelinhas) ü§ù</h3>
<p>Quando temos tr√™s ou mais n√∫meros, n√£o conseguimos somar tudo de uma vez. O c√©rebro precisa fazer duplas (associa√ß√µes). Essa propriedade diz que <strong>tanto faz quem voc√™ junta primeiro</strong>.</p>

<div class="flex flex-col gap-2 my-4">
<div class="bg-white p-3 rounded-lg border border-gray-200 shadow-sm flex justify-between items-center">
<span>(10 + 2) + 5</span>
<span>‚ûú</span>
<span><strong>12</strong> + 5 = <strong class="text-brand-green">17</strong></span>
</div>
<div class="bg-white p-3 rounded-lg border border-gray-200 shadow-sm flex justify-between items-center">
<span>10 + (2 + 5)</span>
<span>‚ûú</span>
<span>10 + <strong>7</strong> = <strong class="text-brand-green">17</strong></span>
</div>
</div>

<p>Mova os par√™nteses (o escudo de prote√ß√£o) e veja a m√°gica:</p>

[WIDGET:interactive_associative_brackets]

<h3>4. Elemento Neutro (O Fantasma) üëª</h3>
<p>Existe um n√∫mero que n√£o fede nem cheira na adi√ß√£o. Ele √© "neutro". Se voc√™ somar ele a qualquer coisa, nada acontece.</p>
<p>Quem √© ele? O <strong>ZERO</strong>.</p>

<div class="bg-gray-800 text-white p-4 rounded-xl text-center shadow-lg my-4">
<span class="text-4xl">500 + 0 = 500</span>
<p class="text-xs text-gray-400 mt-2 uppercase tracking-widest">O Zero √© o "Elemento Neutro"</p>
</div>

[WIDGET:interactive_identity_hero]

<h3>5. Desafio das Propriedades üèÜ</h3>
<p>Agora √© com voc√™! Identifique qual propriedade est√° sendo usada em cada ficha. Arraste (ou clique) para classificar corretamente.</p>

[WIDGET:interactive_property_sorter]
`,

            "Subtra√ß√£o: Ideias (Tirar, Completar e Comparar)": `
<h3>Subtra√ß√£o: A Arte de Retirar ‚ûñ</h3>
<p>A subtra√ß√£o √© o inverso da adi√ß√£o. Ela √© usada em tr√™s situa√ß√µes cl√°ssicas:</p>

<ol class="list-none space-y-2 font-medium text-gray-700 text-sm mt-4">
<li class="flex items-center gap-2"><div class="bg-red-400 w-3 h-3 rounded-full"></div> Retirar: "Tenho 10 reais e gastei 4."</li>
<li class="flex items-center gap-2"><div class="bg-orange-400 w-3 h-3 rounded-full"></div> Completar: "Tenho 4, quanto falta para 10?"</li>
<li class="flex items-center gap-2"><div class="bg-purple-400 w-3 h-3 rounded-full"></div> Comparar: "Eu tenho 10 anos, voc√™ tem 4. Sou quantos anos mais velho?"</li>
</ol>

<div class="bg-red-50 p-4 rounded-xl border-2 border-red-200 my-4">
<h4 class="font-bold text-brand-red mb-2">üèóÔ∏è A Estrutura (Nomenclatura)</h4>
<ul class="list-disc list-inside text-sm">
<li><strong>Minuendo:</strong> O valor total que voc√™ tem.</li>
<li><strong>Subtraendo:</strong> O quanto voc√™ vai tirar.</li>
<li><strong>Resto ou Diferen√ßa:</strong> O resultado.</li>
</ul>
</div>

[WIDGET:interactive_subtraction_vertical]
`,

            "Rela√ß√£o Inversa entre Adi√ß√£o e Subtra√ß√£o (Prova Real)": `
<h3>1. O Bot√£o "Desfazer" da Matem√°tica ‚Ü©Ô∏è</h3>
<p>Voc√™ sabe quando voc√™ erra algo no computador e aperta <strong>CTRL+Z</strong> (Desfazer)? A matem√°tica tamb√©m tem isso!</p>
<p>A Adi√ß√£o e a Subtra√ß√£o s√£o <strong>Opera√ß√µes Inversas</strong>. O que uma faz, a outra desfaz.</p>

<div class="flex justify-center gap-4 my-6">
<div class="bg-blue-50 p-4 rounded-xl border-2 border-brand-blue text-center w-1/2">
<div class="text-3xl mb-2">üèóÔ∏è</div>
<strong class="text-brand-blue block">Adi√ß√£o</strong>
<span class="text-xs text-gray-500">Constr√≥i / Sobe</span>
</div>
<div class="bg-orange-50 p-4 rounded-xl border-2 border-brand-orange text-center w-1/2">
<div class="text-3xl mb-2">üí£</div>
<strong class="text-brand-orange block">Subtra√ß√£o</strong>
<span class="text-xs text-gray-500">Desfaz / Desce</span>
</div>
</div>

<p>Veja no elevador abaixo. Se voc√™ subir e depois descer a mesma quantidade, voc√™ volta para o in√≠cio!</p>

[WIDGET:interactive_elevator_inverse]

<h3>2. A Prova Real: O Modo Detetive üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
<p>Como ter certeza absoluta de que sua conta est√° certa sem olhar o gabarito? Fazendo a <strong>Prova Real</strong>.</p>

<div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm">
<strong>A Regra:</strong> Pegue o resultado e fa√ßa a opera√ß√£o contr√°ria com um dos n√∫meros. Se der o outro n√∫mero, voc√™ acertou!
</div>

<div class="flex flex-col items-center gap-4 my-6 font-mono text-xl">
<div class="flex items-center gap-4 bg-white p-3 rounded-lg border border-gray-200 opacity-50">
<span>10</span> <span class="text-brand-blue font-bold">+ 5</span> <span>=</span> <span class="text-brand-green font-black">15</span>
</div>
<div class="text-2xl text-gray-300">‚¨áÔ∏è Invertendo...</div>
<div class="flex items-center gap-4 bg-white p-3 rounded-lg border-2 border-brand-green shadow-md">
<span class="text-brand-green font-black">15</span> <span class="text-brand-orange font-bold">- 5</span> <span>=</span> <span>10</span>
</div>
<p class="text-xs text-green-600 font-bold mt-1">Voltou para o 10? Ent√£o est√° certo! ‚úÖ</p>
</div>

<h3>3. Miss√£o: Cena do Crime üö®</h3>
<p>Um c√°lculo foi feito. Sua miss√£o √© montar a Prova Real para verificar se o resultado √© verdadeiro ou falso.</p>

[WIDGET:interactive_crime_scene]

<h3>4. O Mist√©rio do N√∫mero Escondido üì¶</h3>
<p>√Äs vezes, o n√∫mero some no meio da conta: $\\square + 8 = 20$.</p>
<p>Para descobrir quem √© o quadradinho, usamos a opera√ß√£o inversa: "Se eu tinha algo, ganhei 8 e fiquei com 20, ent√£o eu tinha $20 - 8$".</p>

[WIDGET:interactive_mystery_box]
`,

            "Express√µes Num√©ricas Simples (Adi√ß√£o/Subtra√ß√£o com Par√™nteses)": `
<h3>1. A Fila do Recreio (Ordem Natural) üö∂‚Äç‚ôÇÔ∏èüö∂‚Äç‚ôÄÔ∏è</h3>
<p>Imagine uma fila para comprar lanche. Quem chega primeiro, √© atendido primeiro, certo? Na matem√°tica, Adi√ß√£o ($+$) e Subtra√ß√£o ($-$) t√™m a mesma for√ßa. Nenhuma manda mais que a outra.</p>

<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm text-sm">
<strong>Regra da Fila:</strong> Quando s√≥ temos $+$ e $-$, resolvemos sempre da <strong>ESQUERDA</strong> para a <strong>DIREITA</strong> (como lemos um texto).
</div>

<div class="flex flex-col items-center gap-2 my-4 font-mono text-xl">
<div class="bg-white p-3 rounded-lg border border-gray-200">
<span class="text-brand-blue font-bold">10 - 4</span> + 3
</div>
<div class="text-2xl text-gray-300">‚Üì</div>
<div class="bg-white p-3 rounded-lg border border-gray-200">
<span class="text-brand-green font-bold">6</span> + 3 = <strong>9</strong>
</div>
</div>

<div class="bg-red-50 p-3 rounded-lg border-2 border-red-200 text-xs text-red-700 text-center font-bold">
‚õî Se voc√™ fizesse (4+3) primeiro, daria 7. E 10 - 7 = 3. <br>Resposta errada! Respeite a fila!
</div>

<h3>2. O Cart√£o VIP: Par√™nteses ( ) üé´</h3>
<p>√Äs vezes, queremos furar a fila. Para isso, usamos os <strong>Par√™nteses</strong>. Eles s√£o como um escudo de prote√ß√£o ou um Cart√£o VIP.</p>
<p><strong>Regra de Ouro:</strong> Quem est√° dentro do par√™nteses √© resolvido PRIMEIRO, n√£o importa onde esteja.</p>

<div class="flex flex-col md:flex-row items-center gap-6 justify-center my-6">

<div class="bg-gray-50 p-4 rounded-xl text-center opacity-60">
<p class="text-xs font-bold uppercase text-gray-400 mb-2">Sem VIP</p>
<div class="font-mono text-lg">20 - 5 + 2</div>
<div class="text-brand-text font-black text-2xl mt-1">17</div>
<p class="text-[10px] mt-1">(20-5=15, depois +2)</p>
</div>

<div class="bg-purple-50 p-4 rounded-xl text-center border-2 border-brand-purple transform scale-110 shadow-lg">
<p class="text-xs font-bold uppercase text-brand-purple mb-2">Com VIP</p>
<div class="font-mono text-lg">20 - <span class="text-brand-purple font-bold">(5 + 2)</span></div>
<div class="text-brand-purple font-black text-2xl mt-1">13</div>
<p class="text-[10px] mt-1">(5+2=7, depois 20-7)</p>
</div>

</div>

<h3>3. A Mudan√ßa de Destino üõ£Ô∏è</h3>
<p>Veja como o mesmo conjunto de n√∫meros pode ter resultados totalmente diferentes apenas movendo o "escudo".</p>
<p>Observe a express√£o: $15 - 5 + 3$.</p>

[WIDGET:interactive_associative_brackets]

<h3>4. Desafio: O Mestre dos Par√™nteses üõ°Ô∏è</h3>
<p>O resultado da conta abaixo est√° correto, mas faltam os par√™nteses! Sua miss√£o √© colocar o escudo no lugar certo para que a igualdade seja verdadeira.</p>

[WIDGET:interactive_bracket_master]
`,

            "Resolu√ß√£o de Problemas envolvendo Adi√ß√£o e Subtra√ß√£o": `
<h3>1. O Detetive Matem√°tico üïµÔ∏è‚Äç‚ôÄÔ∏è</h3>
<p>Resolver um problema n√£o √© s√≥ fazer conta. √â desvendar um mist√©rio! O texto te d√° pistas e voc√™ precisa descobrir qual ferramenta usar: a <strong>Adi√ß√£o (+)</strong> ou a <strong>Subtra√ß√£o (-)</strong>.</p>

<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm">
<h4 class="font-bold text-brand-blue mb-2">O M√©todo de 3 Passos:</h4>
<ol class="list-decimal list-inside text-sm text-gray-700 space-y-2">
<li><strong>Ler:</strong> Entenda a hist√≥ria (n√£o pule direto para os n√∫meros!).</li>
<li><strong>Traduzir:</strong> Encontre as "Palavras-Chave".</li>
<li><strong>Resolver:</strong> Arme a conta e verifique se a resposta faz sentido.</li>
</ol>
</div>

<h3>2. O Dicion√°rio Secreto üìñ</h3>
<p>Existem palavras que "entregam" qual conta fazer. Voc√™ consegue identificar a qual time elas pertencem?</p>

[WIDGET:interactive_word_sorter]

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
<div class="bg-green-50 p-4 rounded-xl border-2 border-green-200">
<strong class="text-brand-green block mb-2"><i class="fas fa-plus-circle"></i> Time da Soma</strong>
<ul class="text-xs text-gray-600 space-y-1">
<li>"Ganhou", "Recebeu", "Achou"</li>
<li>"Juntou", "Acrescentou"</li>
<li>"Total", "Ao todo"</li>
<li>"Mais que" (cuidado com o contexto!)</li>
</ul>
</div>
<div class="bg-red-50 p-4 rounded-xl border-2 border-red-200">
<strong class="text-brand-red block mb-2"><i class="fas fa-minus-circle"></i> Time da Subtra√ß√£o</strong>
<ul class="text-xs text-gray-600 space-y-1">
<li>"Perdeu", "Gastou", "Deu"</li>
<li>"Diferen√ßa", "Resto", "Sobrou"</li>
<li>"A mais", "A menos" (Compara√ß√£o)</li>
<li>"Quanto falta?"</li>
</ul>
</div>
</div>

<h3>3. Cuidado: A Pegadinha do "A Mais" ‚ö†Ô∏è</h3>
<p>Essa √© a casca de banana mais famosa! Leia com aten√ß√£o:</p>

<div class="bg-white p-4 rounded-xl border-2 border-brand-text shadow-md my-4 relative overflow-hidden">
<div class="absolute top-0 right-0 bg-brand-text text-white text-[10px] px-2 py-1 font-bold">CASO REAL</div>
<p class="font-medium text-gray-800 mb-2">"Jo√£o tem 10 figurinhas. Maria tem 4 <strong>a mais</strong> que Jo√£o. Quantas Maria tem?"</p>
<div class="text-brand-green font-bold text-sm">Conta de MAIS (+): 10 + 4 = 14.</div>
<div class="w-full h-px bg-gray-200 my-2"></div>
<p class="font-medium text-gray-800 mb-2">"Jo√£o tem 10. Maria tem 14. Quantas Maria tem <strong>a mais</strong> que Jo√£o?"</p>
<div class="text-brand-red font-bold text-sm">Conta de MENOS (-): 14 - 10 = 4.</div>
</div>

<p class="text-xs text-gray-500 italic text-center">Quando a pergunta √© "Qual a diferen√ßa?" ou "Quanto a mais?", √© sempre uma compara√ß√£o (Subtra√ß√£o)!</p>

<h3>4. Desafio do Mercado üõí</h3>
<p>Voc√™ tem um or√ßamento limitado e uma lista de desejos. Ser√° que o dinheiro d√°? Precisa calcular o troco!</p>

[WIDGET:interactive_market_rpg]
`,

            // =======================================================
            // UNIDADE 3: GEOMETRIA INSTRUMENTAL
            // =======================================================
            "Ponto, Reta e Plano: No√ß√µes Intuitivas e Representa√ß√£o": `
<h3>Os √Åtomos da Geometria ‚öõÔ∏è</h3>
<p>Tudo na geometria √© feito de tr√™s elementos invis√≠veis. N√≥s n√£o definimos o que eles s√£o, apenas <strong>aceitamos</strong> que eles existem.</p>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6 text-center">
<div class="bg-white p-4 rounded-xl border-b-4 border-brand-purple shadow-sm group">
<div class="w-4 h-4 bg-brand-purple rounded-full mx-auto mb-2"></div>
<h4 class="font-bold text-brand-purple uppercase text-sm mb-1">1. O Ponto</h4>
<p class="text-xs text-gray-500 mb-2">Uma localiza√ß√£o exata. Sem tamanho.</p>
<div class="bg-purple-50 text-purple-800 text-[10px] font-bold py-1 px-2 rounded inline-block">Letra Mai√∫scula (A)</div>
</div>

<div class="bg-white p-4 rounded-xl border-b-4 border-brand-blue shadow-sm group">
<div class="w-full h-0.5 bg-brand-blue mx-auto mb-4 mt-2"></div>
<h4 class="font-bold text-brand-blue uppercase text-sm mb-1">2. A Reta</h4>
<p class="text-xs text-gray-500 mb-2">Uma linha esticada infinita. Nunca termina.</p>
<div class="bg-blue-50 text-blue-800 text-[10px] font-bold py-1 px-2 rounded inline-block">Letra min√∫scula (r)</div>
</div>

<div class="bg-white p-4 rounded-xl border-b-4 border-brand-green shadow-sm group">
<div class="w-10 h-6 border-2 border-brand-green bg-green-50 mx-auto mb-2 transform -skew-x-12"></div>
<h4 class="font-bold text-brand-green uppercase text-sm mb-1">3. O Plano</h4>
<p class="text-xs text-gray-500 mb-2">Uma superf√≠cie lisa infinita.</p>
<div class="bg-green-50 text-green-800 text-[10px] font-bold py-1 px-2 rounded inline-block">Letra Grega (Œ±)</div>
</div>
</div>

[WIDGET:interactive_geometry_canvas]
`,

            "Posi√ß√µes Relativas de Retas: Paralelas, Concorrentes e Perpendiculares": `
<h3>1. A Dan√ßa das Retas üíÉ</h3>
<p>Imagine que as retas s√£o como estradas infinitas em um plano (como uma folha de papel gigante). Dependendo de como elas s√£o desenhadas, elas podem se comportar de tr√™s formas.</p>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6">

<div class="bg-blue-50 p-4 rounded-xl border-b-4 border-brand-blue shadow-sm hover:-translate-y-1 transition-transform group text-center">
<div class="h-16 flex items-center justify-center gap-4 mb-2">
<div class="h-full w-1 bg-brand-blue transform -rotate-12"></div>
<div class="h-full w-1 bg-brand-blue transform -rotate-12"></div>
</div>
<h4 class="font-bold text-brand-blue uppercase text-sm mb-1">Paralelas</h4>
<p class="text-xs text-gray-600">Como trilhos de trem. Elas nunca se cruzam, n√£o importa o quanto voc√™ as estique.</p>
</div>

<div class="bg-orange-50 p-4 rounded-xl border-b-4 border-brand-orange shadow-sm hover:-translate-y-1 transition-transform group text-center">
<div class="h-16 flex items-center justify-center relative mb-2">
<div class="h-full w-1 bg-brand-orange absolute transform rotate-12"></div>
<div class="h-full w-1 bg-brand-orange absolute transform -rotate-12"></div>
</div>
<h4 class="font-bold text-brand-orange uppercase text-sm mb-1">Concorrentes</h4>
<p class="text-xs text-gray-600">Como a letra X. Elas se cruzam em um √∫nico ponto (o "encontro").</p>
</div>

<div class="bg-purple-50 p-4 rounded-xl border-b-4 border-brand-purple shadow-sm hover:-translate-y-1 transition-transform group text-center">
<div class="h-16 flex items-center justify-center relative mb-2">
<div class="h-full w-1 bg-brand-purple absolute"></div>
<div class="w-full h-1 bg-brand-purple absolute"></div>
<div class="w-4 h-4 border border-purple-400 absolute top-1/2 left-1/2 -mt-4"></div>
</div>
<h4 class="font-bold text-brand-purple uppercase text-sm mb-1">Perpendiculares</h4>
<p class="text-xs text-gray-600">Um tipo especial de concorrente. Elas formam uma cruz perfeita (90¬∞ ou √Çngulo Reto).</p>
</div>
</div>

<h3>2. Laborat√≥rio de √Çngulos üìê</h3>
<p>Use o controle deslizante para girar a reta vermelha e descobrir como a rela√ß√£o muda.</p>

[WIDGET:interactive_lines_lab]

<div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm shadow-sm">
<strong>üí° Dica Visual:</strong>
<ul class="list-disc list-inside mt-1 text-gray-700">
<li><strong>Paralelas (//):</strong> S√≠mbolo de "igual" deitado ou em p√©.</li>
<li><strong>Perpendiculares (‚ä•):</strong> Um "T" de cabe√ßa para baixo.</li>
</ul>
</div>

<h3>3. Desafio da Cidade üèôÔ∏è</h3>
<p>Voc√™ √© o Engenheiro de Tr√¢nsito da cidade MathVille. Olhe o mapa e responda r√°pido para ganhar medalhas!</p>

[WIDGET:interactive_city_challenge]
`,

            "Semirretas e Segmentos de Reta": `
<h3>1. Cortando o Infinito ‚úÇÔ∏è</h3>
<p>Voc√™ lembra da <strong>Reta</strong>? Ela √© aquela linha teimosa que nunca termina, nem para a esquerda, nem para a direita. Mas o que acontece se pegarmos uma tesoura e cortarmos ela?</p>

<h3>2. A Semirreta (A Lanterna) üî¶</h3>
<p>Se voc√™ marcar um ponto na reta, voc√™ cria um <strong>come√ßo</strong>. Ela nasce ali e corre para o infinito em apenas uma dire√ß√£o.</p>

<div class="bg-orange-50 p-4 rounded-xl border-l-4 border-brand-orange my-4 shadow-sm flex items-center gap-4">
<div class="text-3xl">üèπ</div>
<div>
<strong>A Met√°fora:</strong><br>
Pense na luz de uma lanterna ou no voo de uma flecha. Tem um ponto de partida, mas segue em frente "para sempre" (matematicamente falando).
</div>
</div>

<div class="flex justify-center my-4 font-mono text-xl text-brand-text">
<span class="font-bold">Nota√ß√£o:</span> $\\vec{AB}$ (Come√ßa em A, passa por B)
</div>

<h3>3. O Segmento de Reta (O Barbante) üß∂</h3>
<p>Agora, imagine que voc√™ corta a reta em <strong>DOIS</strong> lugares. Voc√™ ficou com um peda√ßo na m√£o. Isso √© um Segmento.</p>
<p>Ele √© o "filho comportado" da geometria: tem come√ßo e tem fim.</p>

<div class="bg-green-50 p-4 rounded-xl border-l-4 border-brand-green my-4 shadow-sm text-sm">
<strong>üåü O Grande Diferencial:</strong><br>
O Segmento √© o √∫nico que podemos <strong>MEDIR</strong>. Voc√™ n√£o pode medir uma reta (ela √© infinita!), mas pode medir um segmento com uma r√©gua.
</div>

<div class="flex justify-center my-4 font-mono text-xl text-brand-text">
<span class="font-bold">Nota√ß√£o:</span> $\\overline{AB}$ (O peda√ßo entre A e B)
</div>

<h3>4. Laborat√≥rio de Cortes üß™</h3>
<p>Pegue sua "tesoura matem√°tica" e transforme uma Reta Infinita em um Segmento finito. Tente criar as tr√™s formas!</p>

[WIDGET:interactive_line_cutter]

<h3>5. Desafio da Medida üìè</h3>
<p>J√° que o Segmento de Reta √© o √∫nico que tem tamanho, vamos medir! Use a r√©gua virtual para descobrir o comprimento dos objetos.</p>

[WIDGET:interactive_segment_ruler]

<h3>Resumo Visual</h3>
<div class="grid grid-cols-1 gap-2 mt-4 text-center text-sm font-bold text-gray-600">
<div class="bg-gray-100 p-2 rounded border border-gray-300 flex items-center justify-between px-4">
<span>Reta</span>
<span class="font-mono text-lg">‚Üê‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Üí</span>
<span class="text-xs font-normal">Sem fim</span>
</div>
<div class="bg-orange-100 p-2 rounded border border-orange-300 flex items-center justify-between px-4">
<span class="text-brand-orange">Semirreta</span>
<span class="font-mono text-lg text-brand-orange">‚óè‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Üí</span>
<span class="text-xs font-normal">Um fim</span>
</div>
<div class="bg-green-100 p-2 rounded border border-green-300 flex items-center justify-between px-4">
<span class="text-brand-green">Segmento</span>
<span class="font-mono text-lg text-brand-green">‚óè‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚óè</span>
<span class="text-xs font-normal">Dois fins</span>
</div>
</div>
`,

            "Uso da R√©gua: Medi√ß√£o e Tra√ßado de Segmentos": `
<h3>1. A Ferramenta do Construtor üìè</h3>
<p>A r√©gua n√£o serve s√≥ para fazer linhas retas. Ela √© um instrumento de <strong>Medida de Comprimento</strong>. Sem ela, casas ficariam tortas e roupas n√£o serviriam!</p>

<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm">
<h4 class="font-bold text-brand-blue mb-2">üîç Anatomia da R√©gua</h4>
<ul class="list-none space-y-2 text-sm text-gray-700">
<li><strong>Tra√ßos Grandes (cm):</strong> Marcam os Cent√≠metros (0, 1, 2...). √â como os passos de um gigante.</li>
<li><strong>Tra√ßos Pequenos (mm):</strong> Marcam os Mil√≠metros. S√£o os passinhos de formiga entre os cent√≠metros.</li>
</ul>
<div class="mt-2 text-xs font-mono bg-white p-2 rounded border border-blue-200 text-center">
1 cm = 10 mm
</div>
</div>

<h3>2. O Erro Mais Comum do Mundo üö´</h3>
<p>Muitas pessoas erram a medida por um motivo bobo: elas come√ßam a medir da <strong>ponta do objeto</strong> (o pl√°stico) em vez do <strong>tra√ßo do zero</strong>.</p>

<div class="flex flex-col items-center gap-4 my-6">
<div class="relative w-64 h-16 bg-red-100 border-2 border-red-300 rounded-lg flex items-center justify-center opacity-60">
<div class="absolute top-2 left-2 text-red-500 font-bold text-xs"><i class="fas fa-times"></i> ERRADO</div>
<div class="w-40 h-2 bg-gray-600 rounded"></div>
<div class="absolute bottom-0 w-full h-6 bg-yellow-200 border-t border-gray-400 flex items-end px-1" style="left: -10px;">
<span class="text-[8px]">Pl√°stico</span>
<div class="h-2 w-px bg-black ml-2"></div><span class="text-[8px]">0</span>
</div>
</div>

<div class="relative w-64 h-16 bg-green-100 border-2 border-green-400 rounded-lg flex items-center justify-center transform scale-105 shadow-md">
<div class="absolute top-2 left-2 text-green-600 font-bold text-xs"><i class="fas fa-check"></i> CERTO</div>
<div class="w-40 h-2 bg-gray-600 rounded"></div>
<div class="absolute bottom-0 w-full h-6 bg-yellow-200 border-t border-gray-400 flex items-end px-4">
<div class="h-3 w-px bg-black absolute left-[38px]"></div><span class="text-[10px] absolute left-[36px] bottom-3 font-bold">0</span>
</div>
</div>
</div>

<p><strong>Miss√£o:</strong> Arraste a r√©gua virtual para medir o l√°pis. Lembre-se: O zero √© o in√≠cio!</p>

[WIDGET:interactive_virtual_ruler]

<h3>3. E se a r√©gua estiver quebrada? üß©</h3>
<p>Imagine que sua r√©gua quebrou e o zero sumiu. Voc√™ ainda pode medir! Basta usar a matem√°tica:</p>

<div class="bg-yellow-50 p-4 rounded-xl border border-yellow-300 text-center my-4 font-mono text-sm md:text-base">
<p class="mb-2 font-bold text-yellow-800">F√≥rmula da R√©gua Quebrada:</p>
<div class="bg-white p-2 rounded shadow-sm inline-block">
Medida = Ponto Final - Ponto Inicial
</div>
<p class="mt-2 text-gray-600 text-xs">Ex: Come√ßou no 2cm e terminou no 5cm?<br><strong>5 - 2 = 3 cm.</strong></p>
</div>

<h3>4. Desafio: Tra√ßo Perfeito ‚úçÔ∏è</h3>
<p>Agora voc√™ vai desenhar. Uma linha vai crescer e voc√™ precisa clicar em <strong>PARAR</strong> no momento exato em que ela atingir o tamanho pedido. Voc√™ tem olhos de √°guia?</p>

[WIDGET:interactive_precision_game]
`,

            "Uso do Compasso: Transporte de Medidas e Constru√ß√£o de C√≠rculos": `
<h3>1. O "Copiador" Anal√≥gico ü¶µ</h3>
<p>Muitos acham que o compasso serve apenas para fazer c√≠rculos. Mas, na Gr√©cia Antiga, ele era usado principalmente para <strong>roubar dist√¢ncias</strong>.</p>

<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm text-sm">
<strong>O Problema da R√©gua:</strong> R√©guas podem ter erros de impress√£o ou escalas diferentes.
<br><strong>A Solu√ß√£o do Compasso:</strong> Ele "congela" uma abertura. Se voc√™ abre as pernas do compasso do tamanho de um segmento, voc√™ pode levar essa medida para qualquer lugar do universo!
</div>

<h3>2. Transporte de Medidas (Copy & Paste) üìã</h3>
<p>Imagine que voc√™ tem um segmento $AB$ e quer desenhar um segmento $CD$ exatamente do mesmo tamanho em outra folha, mas sem olhar os n√∫meros da r√©gua.</p>
<p><strong>O Algoritmo de Euclides:</strong></p>
<ol class="list-decimal list-inside space-y-2 text-sm text-gray-700 bg-white p-4 rounded-xl border border-gray-200">
<li>Coloque a <strong>ponta seca</strong> (ferro) no ponto A.</li>
<li>Abra o compasso at√© a ponta do grafite tocar no ponto B. (Agora a medida est√° "presa" no compasso).</li>
<li>Sem fechar as pernas, leve a ponta seca para o novo ponto C.</li>
<li>Risque um arco. Onde ele cortar a reta, ser√° o ponto D!</li>
</ol>

<p>Tente fazer isso virtualmente agora:</p>

[WIDGET:interactive_compass_transport]

<h3>3. A Anatomia do C√≠rculo ‚≠ï</h3>
<p>Quando giramos o compasso, criamos a figura perfeita.</p>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
<div class="bg-gray-50 p-4 rounded-xl text-center border-2 border-brand-purple">
<div class="text-3xl mb-2">üìç</div>
<h4 class="font-bold text-brand-purple uppercase text-xs">O Centro</h4>
<p class="text-xs text-gray-600">Onde voc√™ fura o papel com a ponta de metal. Ele n√£o faz parte do desenho, mas manda nele.</p>
</div>
<div class="bg-gray-50 p-4 rounded-xl text-center border-2 border-brand-orange">
<div class="text-3xl mb-2">üìè</div>
<h4 class="font-bold text-brand-orange uppercase text-xs">O Raio</h4>
<p class="text-xs text-gray-600">A abertura das pernas do compasso. √â a dist√¢ncia constante do centro at√© a borda.</p>
</div>
</div>

<p>Explore a ferramenta livre para desenhar c√≠rculos de v√°rios tamanhos:</p>

[WIDGET:interactive_geometry_tools]

<h3>4. Desafio da Ros√°cea (Geometria Sagrada) üå∏</h3>
<p>Voc√™ sabia que com a mesma abertura do compasso voc√™ pode dividir o c√≠rculo em 6 partes iguais e criar flores?</p>
<p><strong>Miss√£o:</strong> Clique nos pontos certos para completar a Flor da Vida!</p>

[WIDGET:interactive_compass_rosette]
`,

            "√Çngulos: Conceito de Abertura e Giro": `
<h3>O Que √© um √Çngulo? üìê</h3>
<p>Muitas pessoas acham que √¢ngulo √© apenas "o canto da mesa". Mas na matem√°tica, √¢ngulo √© <strong>GIRO</strong>.</p>

<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm flex items-center gap-4">
<div class="text-3xl">üï∞Ô∏è</div>
<div>
<strong>A Defini√ß√£o Din√¢mica:</strong><br>
Imagine os ponteiros de um rel√≥gio come√ßando juntos ao meio-dia. Quando um deles anda, o espa√ßo que se abre entre eles √© o <strong>√Çngulo</strong>.
</div>
</div>

[WIDGET:interactive_angle_maker]

<div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow mt-6 text-sm shadow-sm">
<h4 class="font-bold text-yellow-700 mb-1 flex items-center gap-2"><i class="fas fa-eye"></i> Ilus√£o de √ìtica</h4>
<p><strong>O tamanho das retas N√ÉO importa!</strong></p>
<p class="mt-1 text-gray-600">Voc√™ pode esticar os lados do √¢ngulo at√© o infinito, mas se a <strong>abertura</strong> (o giro) for a mesma, o √¢ngulo √© o mesmo.</p>
</div>
`,

            "Uso do Transferidor: Medindo e Construindo √Çngulos": `
<h3>1. A R√©gua Redonda üìè</h3>
<p>Para medir linhas retas, usamos a r√©gua. Para medir giros (√¢ngulos), a r√©gua precisa ser curva! Apresento o <strong>Transferidor</strong>.</p>

<div class="bg-white p-4 rounded-xl border-2 border-brand-blue shadow-sm my-4 flex flex-col items-center">
<div class="relative w-48 h-24 mb-2">
<div class="absolute inset-0 border-t-[16px] border-l-[16px] border-r-[16px] border-brand-blue rounded-t-full opacity-20"></div>
<div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-1 h-3 bg-black"></div>
<div class="absolute bottom-0 left-2 right-2 h-px bg-black"></div>
</div>
<ul class="text-sm text-gray-700 list-disc list-inside w-full px-4">
<li><strong>Centro (F√©):</strong> O pontinho ou risquinho no meio da base.</li>
<li><strong>Linha de F√© (Zero):</strong> A linha reta na parte de baixo que aponta para o $0^{\\circ}$.</li>
</ul>
</div>

<h3>2. O Mist√©rio das Duas Filas üî¢</h3>
<p>Por que o transferidor tem duas fileiras de n√∫meros? Uma cresce para a direita, a outra para a esquerda.</p>

<div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm">
<strong>üí° O Segredo:</strong> Olhe para onde o zero est√°!
<ul class="mt-2 space-y-2">
<li>üëâ Se o zero est√° na <strong>DIREITA</strong>, use a escala de dentro (anti-hor√°rio).</li>
<li>üëà Se o zero est√° na <strong>ESQUERDA</strong>, use a escala de fora (hor√°rio).</li>
</ul>
</div>

<h3>3. Treino de Leitura üßê</h3>
<p>O erro mais comum √© confundir 60¬∞ com 120¬∞. Lembre-se: se o √¢ngulo √© fechadinho (agudo), o n√∫mero tem que ser pequeno!</p>
<p>Tente ler o √¢ngulo abaixo. Se errar a escala, eu te aviso!</p>

[WIDGET:interactive_protractor_reader]

<h3>4. Construindo √Çngulos: O Passo a Passo ‚úçÔ∏è</h3>
<ol class="list-decimal list-inside space-y-3 bg-white p-5 rounded-xl border border-gray-200 text-sm text-gray-700 shadow-sm my-6">
<li>Desenhe uma reta (ser√° a base).</li>
<li>Coloque o <strong>Centro</strong> do transferidor na ponta da reta (v√©rtice).</li>
<li>Alinhe a <strong>Linha do Zero</strong> com a reta.</li>
<li>Fa√ßa um pontinho no papel na dire√ß√£o do √¢ngulo que voc√™ quer (ex: 50¬∞).</li>
<li>Tire o transferidor e ligue os pontos com a r√©gua.</li>
</ol>

<h3>5. Desafio: Artilharia Geom√©trica üí£</h3>
<p>Voc√™ √© o comandante do tanque. Ajuste a inclina√ß√£o do canh√£o no √¢ngulo exato para acertar o alvo inimigo!</p>

[WIDGET:interactive_cannon_game]
`,

            "Classifica√ß√£o de √Çngulos (Agudo, Reto, Obtuso, Raso, Nulo e Completo)": `
<h3>1. A Fam√≠lia dos √Çngulos üìê</h3>
<p>Os √¢ngulos s√£o classificados pelo tamanho da sua abertura (o "giro"). Imagine que voc√™ est√° abrindo um leque ou uma tesoura.</p>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">

<div class="bg-green-50 p-4 rounded-xl border-l-4 border-brand-green shadow-sm hover:scale-105 transition-transform cursor-default">
<div class="flex justify-between items-center mb-2">
<h4 class="font-bold text-brand-green uppercase text-sm"><i class="fas fa-compress-arrows-alt"></i> Agudo</h4>
<span class="bg-white text-green-600 text-[10px] font-bold px-2 py-1 rounded border border-green-200">0¬∞ < x < 90¬∞</span>
</div>
<p class="text-xs text-gray-600">O "fechadinho". √â menor que o canto da mesa. Lembra a ponta de uma fatia de pizza fina.</p>
</div>

<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue shadow-sm hover:scale-105 transition-transform cursor-default">
<div class="flex justify-between items-center mb-2">
<h4 class="font-bold text-brand-blue uppercase text-sm"><i class="far fa-square"></i> Reto</h4>
<span class="bg-white text-blue-600 text-[10px] font-bold px-2 py-1 rounded border border-blue-200">Exatos 90¬∞</span>
</div>
<p class="text-xs text-gray-600">O "quadrado". √â o canto perfeito da parede, do caderno, da TV. Marcamos com um quadradinho (‚òê).</p>
</div>

<div class="bg-orange-50 p-4 rounded-xl border-l-4 border-brand-orange shadow-sm hover:scale-105 transition-transform cursor-default">
<div class="flex justify-between items-center mb-2">
<h4 class="font-bold text-brand-orange uppercase text-sm"><i class="fas fa-expand-arrows-alt"></i> Obtuso</h4>
<span class="bg-white text-orange-600 text-[10px] font-bold px-2 py-1 rounded border border-orange-200">90¬∞ < x < 180¬∞</span>
</div>
<p class="text-xs text-gray-600">O "abert√£o". Passou de 90¬∞, mas n√£o deitou totalmente. Lembra uma cadeira de praia reclinada.</p>
</div>

<div class="bg-purple-50 p-4 rounded-xl border-l-4 border-brand-purple shadow-sm hover:scale-105 transition-transform cursor-default">
<div class="flex justify-between items-center mb-2">
<h4 class="font-bold text-brand-purple uppercase text-sm"><i class="fas fa-ruler-horizontal"></i> Raso</h4>
<span class="bg-white text-purple-600 text-[10px] font-bold px-2 py-1 rounded border border-purple-200">Exatos 180¬∞</span>
</div>
<p class="text-xs text-gray-600">A meia-volta. Os lados ficam opostos, formando uma linha reta perfeita. O horizonte.</p>
</div>

</div>

<h3>2. Os Extremos: Tudo ou Nada üîÑ</h3>
<p>E quando o rel√≥gio marca meio-dia em ponto? Os ponteiros est√£o juntos.</p>

<ul class="list-none space-y-2 mb-6">
<li class="flex items-center gap-3 bg-gray-50 p-3 rounded-lg border border-gray-200">
<span class="text-2xl">üåë</span>
<div>
<strong>√Çngulo Nulo (0¬∞):</strong> N√£o saiu do lugar. Os lados est√£o sobrepostos e n√£o houve giro.
</div>
</li>
<li class="flex items-center gap-3 bg-gray-50 p-3 rounded-lg border border-gray-200">
<span class="text-2xl">üåï</span>
<div>
<strong>√Çngulo Completo (360¬∞):</strong> Deu a volta inteira e parou no mesmo lugar.
</div>
</li>
</ul>

<h3>3. O Radar de √Çngulos üì°</h3>
<p>Gire o ponteiro para ver as regi√µes coloridas. Note que o <strong>Reto</strong> e o <strong>Raso</strong> s√£o linhas finas (valores exatos), enquanto o <strong>Agudo</strong> e o <strong>Obtuso</strong> s√£o fatias grandes.</p>

[WIDGET:interactive_angle_regions]

<h3>4. Dojo dos √Çngulos ü•ã</h3>
<p>Sensei Geometria diz: "Seja r√°pido como um ninja!". Identifique o √¢ngulo correto antes que o tempo acabe.</p>

[WIDGET:interactive_angle_dojo]
`,

            // =======================================================
            // UNIDADE 4: OPERA√á√ïES (CAMPO MULTIPLICATIVO)
            // =======================================================

            "Multiplica√ß√£o: Ideia de Adi√ß√£o de Parcelas Iguais": `
<h3>1. O Atalho Matem√°tico ‚ö°</h3>
<p>Imagine que voc√™ vai comprar 5 pacotes de figurinhas. Cada pacote custa R$ 2,00. Para saber o total, voc√™ poderia somar:</p>

<div class="text-center font-mono text-xl my-4 text-gray-400">
2 + 2 + 2 + 2 + 2 = <span class="text-brand-blue font-bold">10</span>
</div>

<p>Funciona? Sim. Mas e se fossem 100 pacotes? A conta ficaria gigante! üò±</p>
<p>A matem√°tica criou um atalho para somar <strong>parcelas iguais</strong>: a <strong>Multiplica√ß√£o</strong> ($\\times$ ou $\\cdot$).</p>

<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 flex flex-col items-center">
<p class="text-xs font-bold text-blue-800 uppercase mb-2">A Tradu√ß√£o</p>
<div class="text-lg">
<span class="font-bold text-brand-purple">5</span> vezes o n√∫mero <span class="font-bold text-brand-orange">2</span>
</div>
<div class="text-3xl font-black text-brand-blue mt-2">5 √ó 2 = 10</div>
</div>

<h3>2. A Organiza√ß√£o Retangular (O Chocolate) üç´</h3>
<p>A melhor forma de ver a multiplica√ß√£o √© organizando as coisas em linhas e colunas, como uma barra de chocolate ou uma cartela de ovos.</p>
<p>Mexa nos controles abaixo para ver como a soma se transforma:</p>

[WIDGET:interactive_multiplication_builder]

<h3>3. Os Nomes dos Personagens üè∑Ô∏è</h3>
<p>Na adi√ß√£o, chamamos de "parcelas". Na multiplica√ß√£o, eles ganham nomes novos:</p>

<div class="flex justify-center gap-2 my-6 font-mono text-xl md:text-2xl">
<div class="flex flex-col items-center">
<span class="text-brand-purple font-bold">4</span>
<span class="text-[10px] text-gray-400 uppercase font-sans">Fator</span>
</div>
<span class="text-gray-400">√ó</span>
<div class="flex flex-col items-center">
<span class="text-brand-orange font-bold">3</span>
<span class="text-[10px] text-gray-400 uppercase font-sans">Fator</span>
</div>
<span class="text-gray-400">=</span>
<div class="flex flex-col items-center">
<span class="text-brand-green font-black">12</span>
<span class="text-[10px] text-gray-400 uppercase font-sans">Produto</span>
</div>
</div>

<div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200 text-center text-sm text-yellow-900 italic">
"A ordem dos fatores n√£o altera o produto."<br>
(3 fileiras de 4 √© igual a 4 fileiras de 3!)
</div>

<h3>4. Desafio do Ritmo ü•Å</h3>
<p>Multiplicar √© como pular degraus. Se √© $4 \\times 3$, voc√™ pula de 3 em 3, quatro vezes. Tente acertar o ritmo!</p>

[WIDGET:interactive_rhythm_multiplier]
`,

            "Multiplica√ß√£o: Ideia de Disposi√ß√£o Retangular (√Årea inicial)": `
<h3>1. O Segredo do Cinema üé¨</h3>
<p>Imagine que voc√™ entrou numa sala de cinema gigante. Voc√™ precisa saber quantos lugares existem, mas o filme j√° vai come√ßar. Voc√™ vai contar cadeira por cadeira? 1, 2, 3... 150?</p>
<p>Claro que n√£o! Voc√™ usa a <strong>Disposi√ß√£o Retangular</strong>.</p>

<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm text-sm">
<strong>A T√©cnica Ninja:</strong>
<br>Basta contar quantas cadeiras tem em uma <strong>LINHA</strong> (horizontal) e quantas tem em uma <strong>COLUNA</strong> (vertical). Depois, √© s√≥ multiplicar!
</div>

<div class="flex flex-col items-center gap-4 my-6">
<div class="grid grid-cols-5 gap-1 p-2 bg-gray-800 rounded-lg shadow-lg">
${Array(15)
                    .fill(
                        '<div class="w-6 h-6 bg-red-600 rounded-t-lg mx-auto opacity-80"></div>'
                    )
                    .join("")}
</div>
<div class="font-mono text-lg bg-white p-2 rounded border border-gray-200">
3 fileiras $\\times$ 5 cadeiras = <strong>15 lugares</strong>
</div>
</div>

<h3>2. Laborat√≥rio de Ret√¢ngulos üß™</h3>
<p>Mexa nos controles para criar salas de diferentes tamanhos e veja a multiplica√ß√£o acontecer em tempo real.</p>

[WIDGET:interactive_multiplication_grid]

<h3>3. A Origem da "√Årea" üü•</h3>
<p>Essa ideia n√£o serve s√≥ para contar objetos. Ela serve para medir o ch√£o!</p>
<p>Quando dizemos que um quarto tem <strong>12 metros quadrados ($m^2$)</strong>, estamos dizendo que cabem 12 quadradinhos de 1 metro no ch√£o dele. Pode ser um quarto de $3m \\times 4m$ ou de $2m \\times 6m$.</p>

<div class="flex justify-center gap-6 my-4 text-center text-xs font-bold text-gray-500">
<div>
<div class="w-24 h-16 border-2 border-brand-orange bg-orange-50 grid grid-cols-4 grid-rows-3 gap-px mb-1">
${Array(12).fill('<div class="bg-orange-200/50"></div>').join("")}
</div>
3 x 4 = 12
</div>
<div>
<div class="w-32 h-12 border-2 border-brand-purple bg-purple-50 grid grid-cols-6 grid-rows-2 gap-px mb-1">
 ${Array(12).fill('<div class="bg-purple-200/50"></div>').join("")}
</div>
2 x 6 = 12
</div>
</div>

<h3>4. Desafio do Jardineiro üåª</h3>
<p>O cliente encomendou um jardim com um n√∫mero exato de flores. Voc√™ consegue construir o canteiro retangular perfeito para caber todas elas?</p>

[WIDGET:interactive_garden_builder]
`,

            "Multiplica√ß√£o: Ideia de Combinat√≥ria (√Årvore de Possibilidades)": `
<h3>1. O Dilema do Guarda-Roupa üëïüëñ</h3>
<p>Imagine que voc√™ vai sair, mas n√£o sabe o que vestir. Voc√™ tem <strong>2 camisetas</strong> e <strong>3 cal√ßas</strong>. De quantas formas diferentes voc√™ pode se vestir?</p>

<p>Voc√™ n√£o precisa vestir tudo de uma vez para descobrir! Podemos criar um mapa mental chamado <strong>√Årvore de Possibilidades</strong>.</p>

<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm">
<strong>üå≥ Como funciona a √Årvore:</strong>
<ul class="list-disc list-inside mt-2 text-gray-700">
<li>O tronco √© VOC√ä.</li>
<li>Os galhos grossos s√£o as primeiras escolhas (Camisetas).</li>
<li>Os galhos finos s√£o as segundas escolhas (Cal√ßas).</li>
</ul>
</div>

<p>Veja a √°rvore crescendo e conte as pontinhas dos galhos (as folhas):</p>

[WIDGET:interactive_combinatorics]

<h3>2. O Segredo da Multiplica√ß√£o ‚úñÔ∏è</h3>
<p>Desenhar √°rvores demora muito se voc√™ tiver muitas roupas. E se voc√™ tivesse 10 camisetas e 20 cal√ßas? O papel n√£o daria!</p>
<p>A√≠ entra a m√°gica da multiplica√ß√£o. O <strong>Princ√≠pio Fundamental da Contagem</strong> diz:</p>

<div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 text-center my-6 shadow-sm">
<p class="text-xs text-gray-500 font-bold uppercase mb-2">F√≥rmula da Combina√ß√£o</p>
<div class="text-xl md:text-2xl font-mono font-bold text-gray-700">
<span class="text-brand-blue">Op√ß√µes do Tipo A</span>
<span class="text-gray-400 mx-2">√ó</span>
<span class="text-brand-orange">Op√ß√µes do Tipo B</span>
<span class="text-gray-400 mx-2">=</span>
<span class="text-brand-green">Total de Combina√ß√µes</span>
</div>
<div class="mt-4 bg-white p-2 rounded-lg inline-block border border-yellow-100">
2 Camisetas $\\times$ 3 Cal√ßas = <strong>6 Looks</strong>
</div>
</div>

<h3>3. A F√°brica de Sobremesas üç¶</h3>
<p>Vamos aplicar isso em algo mais gostoso. Imagine uma sorveteria onde voc√™ escolhe a Casquinha, o Sabor e a Cobertura.</p>
<p>Mude as op√ß√µes e veja como o n√∫mero total de combina√ß√µes explode rapidamente!</p>

[WIDGET:interactive_ice_cream_builder]

<h3>4. Desafio R√°pido: O Calculista de Combos üßÆ</h3>
<p>Voc√™ consegue calcular o total de possibilidades mentalmente antes do tempo acabar?</p>

[WIDGET:interactive_combo_challenge]
`,

            "Algoritmo da Multiplica√ß√£o (1, 2 e mais algarismos)": `
<h3>Multiplica√ß√£o: Acelere seus C√°lculos üèéÔ∏è</h3>
<p>Somar $12+12+12+12+12$ cansa. A <strong>Multiplica√ß√£o</strong> √© o atalho para somar parcelas iguais rapidamente.</p>

<div class="bg-purple-50 p-4 rounded-xl border-l-4 border-brand-purple shadow-sm my-4">
<h4 class="font-bold text-brand-purple mb-2">üöø O Truque do "Chuveirinho" (Distributiva)</h4>
<p class="text-sm text-gray-600 mb-2">Como fazer $4 \\times 12$ de cabe√ßa? Quebre o n√∫mero!</p>

<div class="flex items-center justify-center gap-2 font-mono text-lg bg-white p-2 rounded border border-purple-100">
<span class="font-bold text-brand-purple">4</span>¬†
<span>√ó</span>¬†
<span>(10 + 2)</span>
<span>=</span>
<span class="text-gray-400 text-sm">(4√ó10) + (4√ó2)</span>
<span>=</span>
<strong>48</strong>
</div>
</div>

[WIDGET:interactive_multiplication_vertical]
`,

            "Propriedade Distributiva da Multiplica√ß√£o": `
<h3>1. O Pesadelo da Tabuada Gigante üò±</h3>
<p>Imagine que voc√™ precisa calcular <strong>$4 \\times 13$</strong> de cabe√ßa. A tabuada tradicional s√≥ vai at√© o 10. E agora?</p>
<p>Voc√™ n√£o precisa ser um g√™nio, voc√™ s√≥ precisa de uma marreta! üî®</p>
<p>A <strong>Propriedade Distributiva</strong> diz que podemos quebrar o n√∫mero grande em peda√ßos menores, multiplicar cada peda√ßo e somar tudo no final.</p>

<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-center">
<p class="text-sm font-bold text-blue-900 mb-2">A L√≥gica:</p>
<p class="font-mono text-lg">13 √© igual a <strong class="text-brand-blue">10 + 3</strong></p>
<p class="mt-2 text-sm text-gray-600">Ent√£o, $4 \\times 13$ √© o mesmo que:</p>
<p class="font-mono text-lg font-bold text-brand-text mt-1">$(4 \\times 10) + (4 \\times 3)$</p>
</div>

<h3>2. O "Chuveirinho" üöø</h3>
<p>No Brasil, chamamos essa regra carinhosamente de "Chuveirinho". O n√∫mero de fora joga √°gua (multiplica) em <strong>TODO MUNDO</strong> que est√° dentro dos par√™nteses.</p>

[WIDGET:interactive_distributive_shower]

<h3>3. A Prova Geom√©trica (Cortando Chocolate) üç´</h3>
<p>Por que isso funciona? Imagine uma barra de chocolate. Se voc√™ quebr√°-la em duas partes, a quantidade total de chocolate continua a mesma, certo?</p>
<p>Na matem√°tica: <strong>√Årea Total = √Årea da Parte 1 + √Årea da Parte 2</strong>.</p>

[WIDGET:interactive_distributive_area]

<div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 my-4 text-sm shadow-sm">
<h4 class="font-bold text-yellow-800 mb-1"><i class="fas fa-lightbulb"></i> Dica Ninja</h4>
<p>Sempre tente quebrar o n√∫mero em <strong>Dezenas</strong> (10, 20, 30...) e <strong>Unidades</strong>. Multiplicar por 10 √© muito f√°cil!</p>
<ul class="list-disc list-inside mt-2 text-gray-700">
<li>$6 \\times 12$ &rarr; Fa√ßa $6 \\times 10$ e $6 \\times 2$.</li>
<li>$5 \\times 105$ &rarr; Fa√ßa $5 \\times 100$ e $5 \\times 5$.</li>
</ul>
</div>

<h3>4. Desafio Ninja do C√°lculo Mental ü•∑</h3>
<p>Voc√™ consegue identificar a melhor estrat√©gia para resolver essas contas r√°pido? Escolha o "corte" certo!</p>

[WIDGET:interactive_mental_math_ninja]
`,

            "Divis√£o Euclidiana: Ideias (Repartir Igualmente e Medir/Caber)": `
<h3>Divis√£o: O Juiz Justo ‚öñÔ∏è</h3>
<p>A Divis√£o serve para duas coisas: <strong>Repartir</strong> em partes iguais ou <strong>Medir</strong> (quantos cabem?).</p>

<div class="bg-red-50 p-4 rounded-xl border-2 border-red-200 my-4 shadow-sm">
<h4 class="font-bold text-brand-red mb-3">üîë O Algoritmo de Euclides</h4>
<div class="text-sm text-gray-600 space-y-1 mb-4">
<p>üì¶ <strong>Dividendo (D):</strong> O total que voc√™ tem.</p>
<p>üî™ <strong>Divisor (d):</strong> Em quantas partes vai cortar.</p>
<p>üéÅ <strong>Quociente (q):</strong> Quanto cada um ganha.</p>
<p>üí∞ <strong>Resto (r):</strong> O que sobrou.</p>
</div>
<div class="mt-3 pt-2 border-t border-red-200 text-center font-mono font-bold text-brand-text text-sm">
Prova Real: Dividendo = Divisor √ó Quociente + Resto
</div>
</div>

[WIDGET:interactive_division_vertical]

<div class="bg-gray-800 text-white p-4 rounded-xl text-center mt-6 shadow-lg">
<h4 class="font-bold text-red-400 mb-1 uppercase tracking-widest text-xs"><i class="fas fa-skull"></i> Pecado Matem√°tico</h4>
<p class="text-lg font-bold">NUNCA DIVIDA POR ZERO!</p>
<p class="text-xs text-gray-400 mt-1">Se voc√™ tem 10 balas para 0 pessoas... a pergunta n√£o faz sentido.</p>
</div>
`,

            "Nomenclatura da Divis√£o e a Rela√ß√£o Fundamental (D = d.q + r)": `
<h3>1. O Tesouro do Capit√£o Barbareta üè¥‚Äç‚ò†Ô∏è</h3>
<p>Imagine que o Capit√£o tem um saco com moedas de ouro e precisa dividir igualmente entre seus marujos. Cada parte dessa hist√≥ria tem um nome matem√°tico:</p>

<div class="grid grid-cols-2 md:grid-cols-4 gap-4 my-6 text-center">
<div class="bg-yellow-50 p-3 rounded-xl border-b-4 border-yellow-400 group hover:-translate-y-1 transition-transform">
<div class="text-3xl mb-2">üí∞</div>
<strong class="text-yellow-800 text-sm uppercase block mb-1">Dividendo (D)</strong>
<p class="text-xs text-gray-500">O Tesouro Total.<br>O n√∫mero que ser√° dividido.</p>
</div>
<div class="bg-blue-50 p-3 rounded-xl border-b-4 border-brand-blue group hover:-translate-y-1 transition-transform">
<div class="text-3xl mb-2">üè¥‚Äç‚ò†Ô∏è</div>
<strong class="text-brand-blue text-sm uppercase block mb-1">Divisor (d)</strong>
<p class="text-xs text-gray-500">Os Marujos.<br>Em quantas partes vamos dividir.</p>
</div>
<div class="bg-green-50 p-3 rounded-xl border-b-4 border-brand-green group hover:-translate-y-1 transition-transform">
<div class="text-3xl mb-2">ü§ù</div>
<strong class="text-brand-green text-sm uppercase block mb-1">Quociente (q)</strong>
<p class="text-xs text-gray-500">A Parte de Cada um.<br>O resultado da conta.</p>
</div>
<div class="bg-red-50 p-3 rounded-xl border-b-4 border-brand-red group hover:-translate-y-1 transition-transform">
<div class="text-3xl mb-2">ü™ô</div>
<strong class="text-brand-red text-sm uppercase block mb-1">Resto (r)</strong>
<p class="text-xs text-gray-500">A Sobra.<br>O que fica no saco do Capit√£o.</p>
</div>
</div>

<h3>2. A Rela√ß√£o Fundamental (O Segredo) üóùÔ∏è</h3>
<p>Se juntarmos as moedas de todos os marujos e somarmos com o que sobrou no saco, temos que ter o tesouro original de volta!</p>

<div class="bg-gray-800 text-white p-4 rounded-xl text-center shadow-lg my-4 font-mono text-lg md:text-xl">
D = d √ó q + r
</div>
<p class="text-center text-xs text-gray-400 italic mb-6">"Dividendo √© igual ao Divisor vezes Quociente mais Resto"</p>

<p>Veja essa m√°gica acontecendo visualmente:</p>

[WIDGET:interactive_division_relation]

<h3>3. A Lei do Resto (A Regra de Ouro) ‚ö†Ô∏è</h3>
<p>O Capit√£o √© esperto. Se sobrar moeda suficiente para dar mais uma para cada marujo, ele tem que dar!</p>

<div class="bg-red-50 p-4 rounded-xl border-l-4 border-brand-red my-4 shadow-sm">
<h4 class="font-bold text-brand-red mb-1 flex items-center gap-2"><i class="fas fa-exclamation-circle"></i> Regra Obrigat√≥ria</h4>
<p class="text-sm text-gray-700">O Resto (r) <strong>SEMPRE</strong> tem que ser menor que o Divisor (d).</p>
<p class="text-xs text-red-500 mt-1 font-bold">Se $r \\ge d$, a conta est√° errada (incompleta)!</p>
</div>

<h3>4. Detetive de Contas üïµÔ∏è</h3>
<p>Analise as divis√µes abaixo. Algumas s√£o mentirosas! Use a Rela√ß√£o Fundamental e a Lei do Resto para descobrir a verdade.</p>

[WIDGET:interactive_division_detective]
`,

            "Divis√£o Exata vs N√£o Exata": `
            <h3>1. O Mist√©rio da Sobra üç™</h3>
            <p>Imagine que voc√™ tem um pacote de bolachas e quer dividir igualmente entre seus amigos. Existem dois finais poss√≠veis para essa hist√≥ria:</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-green-50 p-4 rounded-xl border-t-4 border-brand-green shadow-sm">
                    <h4 class="font-bold text-brand-green uppercase text-sm mb-2"><i class="fas fa-check-circle"></i> Divis√£o Exata</h4>
                    <p class="text-sm text-gray-700">O saco fica vazio. Todo mundo recebe a mesma quantidade e <strong>Resto = 0</strong>.</p>
                    <div class="mt-2 text-center font-mono font-bold bg-white p-2 rounded">20 √∑ 5 = 4 (Resto 0)</div>
                </div>
                <div class="bg-orange-50 p-4 rounded-xl border-t-4 border-brand-orange shadow-sm">
                    <h4 class="font-bold text-brand-orange uppercase text-sm mb-2"><i class="fas fa-exclamation-circle"></i> Divis√£o N√£o Exata</h4>
                    <p class="text-sm text-gray-700">Sobram bolachas no saco! N√£o d√° para dar mais uma para ningu√©m sem quebrar. <strong>Resto > 0</strong>.</p>
                    <div class="mt-2 text-center font-mono font-bold bg-white p-2 rounded">22 √∑ 5 = 4 (Resto 2)</div>
                </div>
            </div>

            <h3>2. Laborat√≥rio de Sobras üß™</h3>
            <p>Use o simulador para tentar agrupar as bolinhas. Se sobrar alguma fora dos grupos, a divis√£o √© <strong>N√£o Exata</strong>.</p>

            [WIDGET:interactive_remainder_visualizer]

            <h3>3. O Que Fazer com o Resto? ü§î</h3>
            <p>No 6¬∫ ano, trabalhando com N√∫meros Naturais ($\\mathbb{N}$), o resto √© simplesmente o que sobra. Mas aten√ß√£o √† regra de ouro:</p>
            
            <div class="bg-red-50 p-4 rounded-xl border-2 border-red-200 text-center my-4">
                <p class="font-bold text-red-800 text-lg">O Resto NUNCA pode ser igual ou maior que o Divisor!</p>
                <p class="text-xs text-red-600 mt-1">Se sobrar 5 e o divisor for 5, d√° para dividir mais uma vez!</p>
            </div>

            <h3>4. Desafio: Separador de Contas üè≠</h3>
            <p>Voc√™ √© o chefe da f√°brica. As contas est√£o passando na esteira. Classifique r√°pido: √© Exata ou N√£o Exata?</p>

            [WIDGET:interactive_division_sorter]
        `,

            "Divis√£o por 10, 100 e 1000 (C√°lculo Mental)": `
            <h3>1. O Segredo dos Zeros ü§´</h3>
            <p>Voc√™ sabia que dividir por 10, 100 ou 1000 n√£o precisa de papel e caneta? √â tudo uma quest√£o de empurrar a v√≠rgula!</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm text-sm">
                <strong>Regra de Ouro:</strong><br>
                Na divis√£o, o n√∫mero diminui. A v√≠rgula anda para a <strong>ESQUERDA</strong> (üëà).
                <br>O n√∫mero de passos √© igual ao n√∫mero de <strong>ZEROS</strong>.
            </div>

            <ul class="list-none space-y-3 mt-4">
                <li class="flex items-center gap-3 bg-white p-3 rounded-lg border border-gray-200">
                    <span class="text-2xl font-bold text-brand-green">√∑ 10</span>
                    <div>
                        <strong>1 Zero:</strong> A v√≠rgula pula <strong>1 casa</strong> para a esquerda.<br>
                        <span class="font-mono text-gray-500">250,0 ‚ûú 25,0</span>
                    </div>
                </li>
                <li class="flex items-center gap-3 bg-white p-3 rounded-lg border border-gray-200">
                    <span class="text-2xl font-bold text-brand-blue">√∑ 100</span>
                    <div>
                        <strong>2 Zeros:</strong> A v√≠rgula pula <strong>2 casas</strong> para a esquerda.<br>
                        <span class="font-mono text-gray-500">345,0 ‚ûú 3,45</span>
                    </div>
                </li>
                <li class="flex items-center gap-3 bg-white p-3 rounded-lg border border-gray-200">
                    <span class="text-2xl font-bold text-brand-purple">√∑ 1000</span>
                    <div>
                        <strong>3 Zeros:</strong> A v√≠rgula pula <strong>3 casas</strong> para a esquerda.<br>
                        <span class="font-mono text-gray-500">5000,0 ‚ûú 5,0</span>
                    </div>
                </li>
            </ul>

            <h3>2. O Pulo da V√≠rgula (Visualizador) üê∏</h3>
            <p>E quando o n√∫mero acaba? A gente completa com zeros! Veja a m√°gica acontecendo:</p>

            [WIDGET:interactive_decimal_jump]

            <h3>3. Cuidado com o Zero Invis√≠vel üëª</h3>
            <p>Todo n√∫mero inteiro tem uma v√≠rgula escondida no final dele.</p>
            <p class="text-center font-mono text-xl bg-gray-100 p-2 rounded my-2">15 √© igual a <strong>15,0</strong></p>
            <p>Ent√£o, $15 \\div 10 = 1,5$.</p>

            <h3>4. Desafio: Zero Hero ü¶∏‚Äç‚ôÇÔ∏è</h3>
            <p>Teste seus reflexos! Os n√∫meros est√£o caindo. Divida-os mentalmente e selecione a resposta correta antes que explodam!</p>

            [WIDGET:interactive_zero_hero]
        `,

            "Express√µes Num√©ricas com as 4 Opera√ß√µes e Sinais de Associa√ß√£o": `
            <h3>1. O Caos da Internet ü§Ø</h3>
            <p>Voc√™ j√° viu aqueles desafios que deixam todo mundo brigando nos coment√°rios? Tipo este:</p>
            
            <div class="flex justify-center my-6">
                <div class="bg-gray-800 text-white font-mono text-3xl p-6 rounded-xl shadow-lg border-4 border-gray-600 tracking-widest">
                    2 + 3 √ó 4 = ?
                </div>
            </div>

            <p>Muitos respondem 20 (porque somam $2+3=5$ e depois multiplicam). Mas a resposta certa √© <strong>14</strong>. Por que? Porque na matem√°tica, algumas opera√ß√µes s√£o "mais fortes" que outras.</p>

            <h3>2. A Hierarquia Militar (Quem manda mais?) üéñÔ∏è</h3>
            <p>As opera√ß√µes t√™m patentes. Um General n√£o espera pelo Soldado. Quem tem a patente maior, √© resolvido primeiro!</p>

            <div class="space-y-3 mt-4">
                <div class="flex items-center bg-orange-50 p-3 rounded-xl border-l-8 border-brand-orange shadow-sm">
                    <div class="text-3xl mr-4">‚öîÔ∏è</div>
                    <div>
                        <h4 class="font-bold text-brand-orange uppercase text-xs tracking-widest">N√≠vel 1: Os Generais</h4>
                        <p class="font-bold text-gray-700">Multiplica√ß√£o (√ó) e Divis√£o (√∑)</p>
                        <p class="text-xs text-gray-500">Eles s√£o fortes. Resolva-os antes de somar ou subtrair.</p>
                    </div>
                </div>

                <div class="flex items-center bg-green-50 p-3 rounded-xl border-l-8 border-brand-green shadow-sm">
                    <div class="text-3xl mr-4">üõ°Ô∏è</div>
                    <div>
                        <h4 class="font-bold text-brand-green uppercase text-xs tracking-widest">N√≠vel 2: Os Soldados</h4>
                        <p class="font-bold text-gray-700">Adi√ß√£o (+) e Subtra√ß√£o (-)</p>
                        <p class="text-xs text-gray-500">S√£o a base. S√≥ agem quando os chefes terminam.</p>
                    </div>
                </div>
            </div>

            <div class="bg-blue-50 p-4 rounded-xl border-2 border-blue-200 mt-4 text-sm text-center">
                <strong>Empate?</strong> Se aparecerem opera√ß√µes do mesmo n√≠vel (ex: $10 \\div 2 \\times 5$), quem ganha? <br>
                A regra √©: <strong>Da ESQUERDA para a DIREITA</strong> (como ler um livro).
            </div>

            <h3>3. As √Åreas VIP (Sinais de Associa√ß√£o) üöß</h3>
            <p>Se voc√™ quer que a soma aconte√ßa antes da multiplica√ß√£o, voc√™ precisa proteg√™-la. Os sinais de associa√ß√£o funcionam como <strong>Escudos</strong>. Resolvemos sempre de <strong>dentro para fora</strong>.</p>

            <div class="flex flex-col md:flex-row justify-center items-center gap-4 my-8">
                
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 bg-orange-100 border-4 border-orange-300 rounded-full flex items-center justify-center text-2xl font-black text-orange-800 shadow-sm animate-pulse z-20">
                        ( )
                    </div>
                    <span class="text-xs font-bold text-orange-600 mt-2 uppercase tracking-widest">1¬∫ Par√™nteses</span>
                </div>

                <div class="text-gray-300 text-2xl hidden md:block">‚ûú</div>

                <div class="flex flex-col items-center">
                    <div class="w-20 h-20 bg-purple-100 border-4 border-purple-300 rounded-xl flex items-center justify-center text-2xl font-black text-purple-800 shadow-sm z-10">
                        [ ]
                    </div>
                    <span class="text-xs font-bold text-purple-600 mt-2 uppercase tracking-widest">2¬∫ Colchetes</span>
                </div>

                <div class="text-gray-300 text-2xl hidden md:block">‚ûú</div>

                <div class="flex flex-col items-center">
                    <div class="w-24 h-24 bg-blue-100 border-4 border-blue-300 rounded-xl flex items-center justify-center text-3xl font-black text-blue-800 shadow-sm z-0">
                        { }
                    </div>
                    <span class="text-xs font-bold text-blue-600 mt-2 uppercase tracking-widest">3¬∫ Chaves</span>
                </div>

            </div>

            <h3>4. Treino de Foco üéØ</h3>
            <p>N√£o tente resolver tudo de cabe√ßa! Clique na parte da conta que deve ser feita agora.</p>

            [WIDGET:interactive_expression_collapse]

            <h3>5. Esquadr√£o Antibombas üí£</h3>
            <p>A bomba vai explodir! Corte os fios (resolva as opera√ß√µes) na ordem correta para salvar o dia.</p>

            [WIDGET:interactive_bomb_defuse]
        `,

            // =======================================================
            // UNIDADE 5: POTENCIA√á√ÉO E RADICIA√á√ÉO
            // =======================================================
            "Potencia√ß√£o: Conceito, Base e Expoente": `
<h3>Potencia√ß√£o: A Multiplica√ß√£o Turbo üöÄ</h3>
<p>Se a multiplica√ß√£o √© uma soma r√°pida ($5+5+5$), a <strong>Potencia√ß√£o</strong> √© uma multiplica√ß√£o r√°pida! Ela acontece quando queremos multiplicar um n√∫mero por ele mesmo v√°rias vezes.</p>

<div class="bg-purple-50 p-6 rounded-xl border-2 border-purple-200 my-6 relative overflow-hidden">
<div class="flex items-center justify-center gap-8">
<div class="text-center relative group">
<div class="text-6xl font-black text-brand-purple relative z-10">5</div>
<span class="text-xs font-bold text-purple-400 uppercase tracking-widest mt-2 block">Base</span>
</div>

<div class="text-center relative group self-start -mt-4">
<div class="text-4xl font-black text-brand-orange relative z-10">3</div>
<span class="text-xs font-bold text-orange-400 uppercase tracking-widest mt-1 block">Expoente</span>
</div>
</div>

<div class="mt-6 text-center">
<div class="inline-block bg-white border-2 border-purple-100 px-4 py-2 rounded-lg font-mono text-lg shadow-sm text-gray-600">
<span class="text-brand-purple font-bold">5</span>¬†
<span class="text-gray-300">√ó</span>¬†
<span class="text-brand-purple font-bold">5</span>¬†
<span class="text-gray-300">√ó</span>¬†
<span class="text-brand-purple font-bold">5</span>¬†
<span class="text-gray-300">=</span>¬†
<span class="text-brand-text font-black">125</span>
</div>
</div>
</div>

[WIDGET:interactive_power_visualizer]

<div class="bg-red-50 p-4 rounded-xl border-l-4 border-brand-red mt-6 mb-6 shadow-sm">
<h4 class="font-bold text-brand-red flex items-center gap-2 text-lg">
<i class="fas fa-exclamation-triangle"></i> A Armadilha Mortal
</h4>
<p class="font-bold text-brand-red mt-2 text-lg">N√ÉO ESCUTE SEU C√âREBRO!</p>
<ul class="mt-2 space-y-1 text-sm text-gray-600">
<li>‚ùå <span class="line-through decoration-brand-red">2 x 3 = 6</span> (Isso √© multiplica√ß√£o comum).</li>
<li>‚úÖ <strong>2 x 2 x 2 = 8</strong> (Isso √© pot√™ncia!).</li>
</ul>
</div>
`,

            "O Quadrado de um N√∫mero e a √Årea do Quadrado (Geometria)": `
            <h3>1. Por que chamamos de "Quadrado"? üü•</h3>
            <p>Voc√™ j√° se perguntou por que o expoente <strong>2</strong> tem um apelido especial? Dizemos "Tr√™s ao <strong>quadrado</strong>" ($3^2$) e n√£o "Tr√™s na segunda".</p>
            <p>O motivo √© geom√©trico! Se voc√™ pegar um n√∫mero e multiplicar por ele mesmo, voc√™ est√° calculando a <strong>√Årea de um Quadrado</strong> com aquele lado.</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm text-center">
                <p class="text-sm text-gray-600 mb-1">A F√≥rmula da √Årea</p>
                <p class="font-mono text-2xl font-bold text-brand-blue">√Årea = Lado √ó Lado = L¬≤</p>
            </div>

            [WIDGET:interactive_square_concept]

            <h3>2. A Grande Confus√£o: $x^2$ vs $2x$ ‚ö†Ô∏è</h3>
            <p>Este √© o erro n√∫mero 1 em provas: achar que elevar ao quadrado √© multiplicar por 2.</p>
            <ul class="list-none space-y-2 mt-2 bg-red-50 p-4 rounded-xl border border-red-200 text-sm">
                <li class="flex items-center gap-2">
                    <i class="fas fa-times text-red-500 text-xl"></i>
                    <span><strong>Errado:</strong> $4^2 = 4 \\times 2 = 8$ (Isso √© o dobro!)</span>
                </li>
                <li class="flex items-center gap-2">
                    <i class="fas fa-check text-green-500 text-xl"></i>
                    <span><strong>Certo:</strong> $4^2 = 4 \\times 4 = 16$ (Isso √© o quadrado!)</span>
                </li>
            </ul>
            <p class="text-xs text-gray-500 mt-2 italic text-center">Um quadrado de lado 4 tem 16 quadradinhos dentro, n√£o 8!</p>

            <h3>3. Quadrados Perfeitos ‚ú®</h3>
            <p>Os n√∫meros que s√£o resultado de um quadrado (1, 4, 9, 16, 25, 36...) s√£o chamados de <strong>Quadrados Perfeitos</strong>. Eles s√£o os √∫nicos n√∫meros que conseguem formar um quadrado exato sem sobrar tijolos.</p>

            <h3>4. Desafio: Defesa Geom√©trica üõ°Ô∏è</h3>
            <p>Blocos quadrados est√£o caindo do c√©u! Eles mostram a <strong>√ÅREA</strong>. Voc√™ precisa clicar no bot√£o com o <strong>LADO</strong> certo para destru√≠-los antes que esmaguem sua base.</p>

            [WIDGET:interactive_square_defense]
        `,

            "O Cubo de um N√∫mero e o Volume do Cubo": `
            <h3>1. Por que chamamos de "Cubo"? üßä</h3>
            <p>Na aula passada, vimos que $5^2$ √© um "Quadrado" porque forma um quadrado visualmente. Adivinha o que acontece quando elevamos √† terceira pot√™ncia?</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-center">
                <span class="text-4xl font-black text-brand-blue">n¬≥</span>
                <p class="text-sm text-gray-600 mt-2">L√™-se: <strong>"n ao cubo"</strong></p>
            </div>

            <p>Isso acontece porque multiplicamos o n√∫mero por ele mesmo <strong>3 vezes</strong> (Comprimento $\\times$ Largura $\\times$ Altura), criando um objeto 3D!</p>

            <h3>2. Construindo Cubos (Camada por Camada) üèóÔ∏è</h3>
            <p>Para calcular $3^3$ (tr√™s ao cubo), imagine que estamos construindo um pr√©dio:</p>
            <ul class="list-disc list-inside text-sm text-gray-700 bg-white p-4 rounded-xl border border-gray-200 mb-4">
                <li>A base √© um quadrado de $3 \\times 3$ (√Årea = 9).</li>
                <li>Precisamos subir 3 andares iguais a esse.</li>
                <li>Total: 3 camadas de 9 tijolos = 27 tijolos!</li>
            </ul>

            <p>Mexa no controle abaixo. Veja como o cubo cresce explosivamente comparado ao quadrado.</p>

            [WIDGET:interactive_3d_cube_builder]

            <h3>3. Volume: O Espa√ßo Ocupado üì¶</h3>
            <p>O <strong>Volume</strong> de um cubo √© o espa√ßo que ele ocupa. A f√≥rmula √© simples:</p>

            <div class="bg-gray-800 text-white p-4 rounded-xl text-center shadow-lg my-4">
                <div class="font-mono text-2xl font-bold mb-2">V = a¬≥</div>
                <div class="font-mono text-lg text-gray-400">V = a $\\times$ a $\\times$ a</div>
                <p class="text-xs text-brand-yellow mt-2 uppercase tracking-widest">Onde "a" √© a aresta (lado)</p>
            </div>

            <div class="grid grid-cols-2 gap-4 my-4">
                <div class="bg-purple-50 p-3 rounded-lg border border-purple-200 text-center">
                    <strong>1¬≥</strong>
                    <div class="text-xs text-gray-500">1 x 1 x 1</div>
                    <div class="text-xl font-black text-brand-purple">1</div>
                </div>
                <div class="bg-orange-50 p-3 rounded-lg border border-orange-200 text-center">
                    <strong>2¬≥</strong>
                    <div class="text-xs text-gray-500">2 x 2 x 2</div>
                    <div class="text-xl font-black text-brand-orange">8</div>
                </div>
                <div class="bg-green-50 p-3 rounded-lg border border-green-200 text-center">
                    <strong>3¬≥</strong>
                    <div class="text-xs text-gray-500">3 x 3 x 3</div>
                    <div class="text-xl font-black text-brand-green">27</div>
                </div>
                <div class="bg-blue-50 p-3 rounded-lg border border-blue-200 text-center">
                    <strong>4¬≥</strong>
                    <div class="text-xs text-gray-500">4 x 4 x 4</div>
                    <div class="text-xl font-black text-brand-blue">64</div>
                </div>
            </div>

            <h3>4. Desafio: A Corrida C√∫bica üèéÔ∏è</h3>
            <p>Voc√™ precisa calcular o volume r√°pido para abastecer seu carro. Se errar, o motor para!</p>

            [WIDGET:interactive_cube_race]
        `,

            "Propriedades Essenciais: Expoente 1 e Expoente 0": `
            <h3>1. Expoente 1: O Espelho ü™û</h3>
            <p>Essa √© a regra mais f√°cil do mundo. O expoente diz quantas vezes o n√∫mero aparece na multiplica√ß√£o. Se o expoente √© <strong>1</strong>, o n√∫mero aparece apenas uma vez.</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-center">
                <span class="text-3xl font-mono font-bold text-brand-text">a<sup class="text-brand-blue">1</sup> = a</span>
                <p class="text-sm text-gray-600 mt-2">Todo n√∫mero elevado a 1 √© igual a ele mesmo.</p>
            </div>
            
            <div class="flex justify-center gap-4 font-bold text-gray-500 mb-6">
                <span>5¬π = 5</span>
                <span>|</span>
                <span>100¬π = 100</span>
                <span>|</span>
                <span>x¬π = x</span>
            </div>

            <h3>2. Expoente 0: O Grande Mist√©rio ü§Ø</h3>
            <p>Quanto √© <strong>$5^0$</strong>? Se voc√™ respondeu "Zero", CUIDADO! üö®</p>
            <p>A matem√°tica n√£o inventa regras do nada. Existe um padr√£o l√≥gico. Se voc√™ descer a escada das pot√™ncias, voc√™ sempre <strong>divide pela base</strong>.</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 my-4 shadow-sm">
                <h4 class="font-bold text-yellow-900 mb-2">A L√≥gica da Escada:</h4>
                <p class="text-sm text-gray-700">Vamos usar a base 2. A cada degrau que descemos, dividimos por 2.</p>
            </div>

            [WIDGET:interactive_exponent_pattern]

            <div class="text-center font-black text-2xl text-brand-green bg-green-50 p-4 rounded-xl border-2 border-green-200 my-6">
                Todo n√∫mero (n√£o nulo) elevado a ZERO vale 1.
            </div>

            <h3>3. Cuidado com a Base Zero ‚ò†Ô∏è</h3>
            <p>N√£o confunda as coisas:</p>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-2 bg-white p-4 rounded-xl border border-gray-200 shadow-sm">
                <li>$5^0 = 1$ (O expoente zero transforma em 1).</li>
                <li>$0^5 = 0$ (Zero vezes zero vezes zero... d√° zero).</li>
                <li>$0^0$ = <strong>Indeterminado</strong> (√â um bug na matem√°tica! N√£o tem resposta no 6¬∫ ano).</li>
            </ul>

            <h3>4. Desafio: Reator de Pot√™ncias ‚ö°</h3>
            <p>As pot√™ncias v√£o aparecer no reator. Voc√™ precisa clicar r√°pido no resultado correto para gerar energia!</p>

            [WIDGET:interactive_power_reaction]
        `,

            "Pot√™ncias de Base 10 e Decomposi√ß√£o de N√∫meros": `
            <h3>1. A M√°gica dos Zeros üé©</h3>
            <p>Os cientistas s√£o pregui√ßosos (do jeito bom). Eles odeiam escrever n√∫meros gigantes como <strong>1.000.000.000</strong>. Por isso, inventaram um atalho usando o n√∫mero 10.</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm text-sm">
                <strong>O Segredo do Expoente:</strong><br>
                Na base 10, o expoente diz exatamente <strong>quantos zeros</strong> colocar depois do n√∫mero 1.
                <br>Ex: $10^3$ = 1 com 3 zeros = 1.000.
            </div>

            <p>Veja como os n√∫meros crescem r√°pido quando aumentamos o expoente:</p>

            [WIDGET:interactive_power10_explorer]

            <h3>2. Decomposi√ß√£o: O DNA do N√∫mero üß¨</h3>
            <p>Qualquer n√∫mero, por maior que seja, √© feito de pedacinhos somados. Chamamos isso de <strong>Decomposi√ß√£o</strong>.</p>
            <p>Por exemplo, o n√∫mero <strong>3.452</strong> n√£o √© um bloco s√≥lido. Ele √©:</p>
            
            <ul class="list-none space-y-2 bg-gray-50 p-4 rounded-xl border border-gray-200 font-mono text-sm my-4">
                <li>3 pacotes de 1000 ($3 \\times 10^3$)</li>
                <li>+ 4 pacotes de 100 ($4 \\times 10^2$)</li>
                <li>+ 5 pacotes de 10 ($5 \\times 10^1$)</li>
                <li>+ 2 unidades ($2 \\times 10^0$)</li>
            </ul>

            <p>Use a "Mesa de Disseca√ß√£o" abaixo para ver o que tem dentro de qualquer n√∫mero:</p>

            [WIDGET:interactive_number_dissector]

            <h3>3. A Regra do $10^0$ e $10^1$</h3>
            <p>Dois casos especiais que voc√™ precisa decorar:</p>
            <div class="grid grid-cols-2 gap-4 my-4 text-center">
                <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                    <strong class="text-brand-orange text-xl block mb-1">$10^1$</strong>
                    <span class="text-xs text-gray-600">√â o pr√≥prio 10.<br>(1 zero)</span>
                </div>
                <div class="bg-green-50 p-3 rounded-lg border border-green-200">
                    <strong class="text-brand-green text-xl block mb-1">$10^0$</strong>
                    <span class="text-xs text-gray-600">√â igual a <strong>1</strong>.<br>(Nenhum zero!)</span>
                </div>
            </div>

            <h3>4. Miss√£o Espacial: Dobra Espacial üöÄ</h3>
            <p>Voc√™ √© o piloto. Para chegar aos planetas distantes, voc√™ precisa calibrar o motor da nave na pot√™ncia de 10 correta. Se errar os zeros, voc√™ se perde no espa√ßo!</p>

            [WIDGET:interactive_scientific_mission]
        `,

            "Raiz Quadrada Exata: Opera√ß√£o Inversa da Potencia√ß√£o": `
<h3>Raiz Quadrada: O Detetive Matem√°tico üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
<p>A Raiz √© a opera√ß√£o <strong>inversa</strong> da pot√™ncia. √â como o "Desfazer" do computador.</p>

<div class="bg-green-50 p-4 rounded-xl border-2 border-green-200 text-center my-4 shadow-sm">
<p class="text-brand-green font-bold text-lg mb-1">‚ùì A Pergunta do Detetive:</p>
<p class="text-gray-700 italic">"Qual n√∫mero, multiplicado por ele mesmo, d√° 36?"</p>

<div class="mt-4 flex justify-center items-center gap-4 font-mono text-xl">
<span class="bg-white px-3 py-1 rounded border border-green-300 text-brand-green font-bold">?</span>
<span>√ó</span>
<span class="bg-white px-3 py-1 rounded border border-green-300 text-brand-green font-bold">?</span>
<span>= 36</span>
</div>

<p class="mt-3 font-bold text-brand-text">Resposta: 6! (Pois $6 \\times 6 = 36$)</p>
</div>

[WIDGET:interactive_pythagoras_calc]
`,

            "Raiz Quadrada Geom√©trica (Lado do quadrado dada a √°rea)": `
            <h3>1. O Problema do Piso üü¶</h3>
            <p>Imagine que voc√™ comprou <strong>25 pisos quadrados</strong> de 1 metro cada. Voc√™ quer montar um quadrado perfeito no ch√£o. Qual ser√° o tamanho do lado desse quadrado?</p>

            <div class="flex justify-center gap-8 my-6 items-center">
                <div class="text-center">
                    <p class="text-xs font-bold text-gray-400 uppercase mb-2">Potencia√ß√£o (Ida)</p>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        Tenho o Lado (5)<br>
                        Quero a √Årea ($5^2$)<br>
                        <strong>Resultado: 25</strong>
                    </div>
                </div>
                <div class="text-2xl text-gray-300">‚ö°</div>
                <div class="text-center">
                    <p class="text-xs font-bold text-gray-400 uppercase mb-2">Radicia√ß√£o (Volta)</p>
                    <div class="bg-green-50 p-3 rounded-lg border border-green-200">
                        Tenho a √Årea (25)<br>
                        Quero o Lado ($\\sqrt{25}$)<br>
                        <strong>Resultado: 5</strong>
                    </div>
                </div>
            </div>

            <h3>2. Por que chama "Raiz Quadrada"? üå±</h3>
            <p>O nome n√£o √© coincid√™ncia! Calcular a raiz quadrada de um n√∫mero √© literalmente responder √† pergunta: <em>"Se esse n√∫mero fosse a √°rea de um quadrado, quanto mediria o lado?"</em></p>

            [WIDGET:interactive_geometric_root]

            <div class="bg-red-50 p-4 rounded-xl border-l-4 border-brand-red my-6 text-sm shadow-sm">
                <h4 class="font-bold text-brand-red flex items-center gap-2"><i class="fas fa-exclamation-triangle"></i> O Erro Cl√°ssico</h4>
                <p>Muitos alunos acham que $\\sqrt{16}$ √© a metade ($16 \\div 2 = 8$). <strong>ERRADO!</strong></p>
                <p class="mt-1 text-gray-600">Um quadrado de lado 8 teria √°rea $8 \\times 8 = 64$.<br>A raiz de 16 √© <strong>4</strong>, pois $4 \\times 4 = 16$.</p>
            </div>

            <h3>3. Desafio do Arquiteto üë∑</h3>
            <p>O cliente comprou o piso e te deu a √Årea Total. Sua miss√£o √© construir o cercado quadrado do tamanho exato.</p>

            [WIDGET:interactive_root_challenge]
        `,

            "Ordem de Resolu√ß√£o em Express√µes Num√©ricas Complexas": `
            <h3>1. A Hierarquia Suprema üëë</h3>
            <p>Em express√µes gigantes, n√£o existe democracia. Existe uma hierarquia militar rigorosa! Se voc√™ desobedecer a um superior, a conta inteira desmorona.</p>
            
            <p>Temos dois tipos de hierarquia: a dos <strong>S√≠mbolos</strong> (quem protege quem) e a das <strong>Opera√ß√µes</strong> (quem √© mais forte).</p>

            [WIDGET:interactive_hierarchy_pyramid]

            <h3>2. A Regra da Cebola (Sinais de Associa√ß√£o) üßÖ</h3>
            <p>Quando temos muitos escudos, resolvemos sempre <strong>de dentro para fora</strong>.</p>
            <ul class="list-none space-y-2 text-sm bg-gray-50 p-4 rounded-xl border border-gray-200">
                <li>1¬∫ <strong>( ) Par√™nteses:</strong> O miolo. Resolva tudo aqui dentro primeiro.</li>
                <li>2¬∫ <strong>[ ] Colchetes:</strong> O meio. S√≥ resolve quando n√£o houver mais par√™nteses.</li>
                <li>3¬∫ <strong>{ } Chaves:</strong> A borda. √â o √∫ltimo escudo a cair.</li>
            </ul>

            <p>Veja a anima√ß√£o de como os escudos v√£o desaparecendo:</p>

            [WIDGET:interactive_nested_explorer]

            <h3>3. Pot√™ncias e Ra√≠zes: Os Novos Chefes üí™</h3>
            <p>Lembra que a multiplica√ß√£o ganhava da soma? Agora, a <strong>Potencia√ß√£o</strong> e a <strong>Radicia√ß√£o</strong> ganham da multiplica√ß√£o!</p>
            
            <div class="bg-red-50 p-4 rounded-xl border-l-4 border-brand-red my-4 shadow-sm text-sm">
                <strong>O Erro Cl√°ssico:</strong><br>
                Em $2 \\cdot 3^2$, muita gente faz $6^2 = 36$. <strong>ERRADO!</strong><br>
                Primeiro a pot√™ncia: $3^2 = 9$. Depois a multiplica√ß√£o: $2 \\cdot 9 = 18$.
            </div>

            <h3>4. Desafio: Esquadr√£o Antibombas üí£</h3>
            <p>Voc√™ tem uma express√£o inst√°vel. Voc√™ precisa cortar o "fio" certo (escolher a opera√ß√£o correta) para resolver. Se tentar somar antes de multiplicar ou ignorar um par√™ntese... <strong>BOOM!</strong></p>

            [WIDGET:interactive_bomb_defusal]
        `,

            // =======================================================
            // UNIDADE 6: M√öLTIPLOS E DIVISORES
            // =======================================================
            "M√∫ltiplos de um N√∫mero Natural (Sequ√™ncias)": `
<h3>M√∫ltiplos: O Salto Infinito üöÄ</h3>
<p>Imagine um sapo numa estrada de n√∫meros. Ele come√ßa no zero e d√° pulos sempre do mesmo tamanho. Onde ele pisa?</p>

<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue shadow-sm mt-4">
<h4 class="font-bold text-brand-blue mb-2">Defini√ß√£o:</h4>
<p class="text-sm text-gray-700">M√∫ltiplo de um n√∫mero √© o resultado da multiplica√ß√£o dele por qualquer n√∫mero natural. √â a <strong>Tabuada Infinita</strong>.</p>
<div class="mt-2 font-mono bg-white p-2 rounded border border-blue-100 text-center">
M(3) = {0, 3, 6, 9, 12, 15, ...}
</div>
</div>

[WIDGET:interactive_multiples_game]
`,

            "Divisores e Fatores de um N√∫mero": `
            <h3>1. Os Arquitetos dos N√∫meros üèóÔ∏è</h3>
            <p>Imagine que voc√™ tem <strong>12 blocos de Lego</strong>. De quantas formas diferentes voc√™ pode organiz√°-los para formar um ret√¢ngulo perfeito (sem buracos)?</p>
            <p>Voc√™ pode fazer uma fila √∫nica de 12, ou duas filas de 6, ou tr√™s filas de 4. Essas "medidas" dos lados s√£o os <strong>Fatores</strong> (ou Divisores) de 12.</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm text-sm">
                <strong>Defini√ß√£o Dupla:</strong>
                <ul class="list-disc list-inside mt-2 text-gray-700">
                    <li><strong>Fatores:</strong> S√£o os n√∫meros que multiplicamos. ($3 \\times 4 = 12$).</li>
                    <li><strong>Divisores:</strong> S√£o os n√∫meros que dividem o total com <strong>Resto Zero</strong>. ($12 \\div 3 = 4$).</li>
                </ul>
                <p class="mt-2 text-center font-bold text-brand-blue">Eles s√£o os mesmos n√∫meros!</p>
            </div>

            <h3>2. Laborat√≥rio de Ret√¢ngulos üü¶</h3>
            <p>Descubra todos os fatores de um n√∫mero ajustando a altura e largura do ret√¢ngulo. Tente encontrar todas as formas poss√≠veis!</p>

            [WIDGET:interactive_factor_rectangles]

            <h3>3. A Estrat√©gia do Arco-√çris üåà</h3>
            <p>Para n√£o esquecer nenhum divisor, usamos a t√©cnica dos pares. Os divisores sempre andam de m√£os dadas (o pequeno com o grande).</p>
            <p>Comece pelas pontas ($1 \\times \\text{Ele Mesmo}$) e v√° fechando o cerco.</p>

            [WIDGET:interactive_factor_rainbow]

            <h3>4. Desafio: Chuva de Divisores ‚òî</h3>
            <p>Selecione o n√∫mero alvo e proteja sua base! Capture apenas os n√∫meros que s√£o divisores exatos. Se pegar um intruso, voc√™ perde pontos!</p>

            [WIDGET:interactive_falling_divisors]
        `,

            "Crit√©rios de Divisibilidade (2, 5 e 10)": `
<h3>O Superpoder do Raio-X Matem√°tico ü¶∏‚Äç‚ôÇÔ∏è</h3>
<p>Voc√™ n√£o precisa fazer a conta para saber se um n√∫mero divide por outro. Basta olhar as regras:</p>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-4 text-center">
<div class="bg-green-50 p-4 rounded-xl border-t-4 border-brand-green shadow-sm">
<h4 class="font-bold text-brand-green uppercase text-sm mb-1">Por 2</h4>
<p class="text-xs text-gray-600 font-bold">PAR (0, 2, 4, 6, 8)</p>
</div>
<div class="bg-orange-50 p-4 rounded-xl border-t-4 border-brand-orange shadow-sm">
<h4 class="font-bold text-brand-orange uppercase text-sm mb-1">Por 5</h4>
<p class="text-xs text-gray-600 font-bold">Final 0 ou 5</p>
</div>
<div class="bg-purple-50 p-4 rounded-xl border-t-4 border-brand-purple shadow-sm">
<h4 class="font-bold text-brand-purple uppercase text-sm mb-1">Por 10</h4>
<p class="text-xs text-gray-600 font-bold">Final 0</p>
</div>
</div>

[WIDGET:interactive_divisibility_game]
`,

            "Crit√©rios de Divisibilidade (3 e 9)": `
            <h3>1. A M√°gica da Soma ‚ú®</h3>
            <p>Para o 2, 5 e 10, n√≥s olhamos para o <em>fim</em> do n√∫mero. Mas o <strong>3</strong> e o <strong>9</strong> s√£o mais exigentes. Eles querem saber a "alma" do n√∫mero.</p>
            
            <p>A regra √© surpreendente: <strong>N√£o importa o tamanho do n√∫mero, importa a SOMA dos seus algarismos.</strong></p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm">
                <h4 class="font-bold text-brand-blue mb-2">A Regra do 3:</h4>
                <p class="text-sm text-gray-700">Se a <strong>soma dos algarismos</strong> for um n√∫mero da tabuada do 3, ent√£o o n√∫mero gigante tamb√©m √©!</p>
                <div class="mt-2 bg-white p-2 rounded border border-blue-200 font-mono text-center">
                    123 $\\rightarrow$ 1 + 2 + 3 = <strong>6</strong> (Sim!)
                </div>
            </div>

            <h3>2. O Laborat√≥rio de Fus√£o ‚öóÔ∏è</h3>
            <p>Vamos testar essa regra. Digite qualquer n√∫mero e veja ele ser desmontado:</p>

            [WIDGET:interactive_digit_sum_explorer]

            <h3>3. A Regra do 9 (O Irm√£o Rico) üíé</h3>
            <p>O n√∫mero 9 segue a mesma l√≥gica do 3, mas √© mais seletivo. A soma tem que dar 9, 18, 27...</p>
            
            <div class="flex flex-col md:flex-row gap-4 my-4">
                <div class="bg-white p-4 rounded-xl border-2 border-brand-purple flex-1 text-center">
                    <span class="text-2xl">ü§î</span>
                    <p class="text-xs font-bold text-gray-400 uppercase mt-2">Curiosidade</p>
                    <p class="text-sm text-gray-600 mt-1">Todo n√∫mero divis√≠vel por <strong>9</strong> tamb√©m √© divis√≠vel por <strong>3</strong>.</p>
                </div>
                <div class="bg-white p-4 rounded-xl border-2 border-brand-orange flex-1 text-center">
                    <span class="text-2xl">‚ö†Ô∏è</span>
                    <p class="text-xs font-bold text-gray-400 uppercase mt-2">Cuidado</p>
                    <p class="text-sm text-gray-600 mt-1">Nem todo n√∫mero divis√≠vel por <strong>3</strong> √© divis√≠vel por <strong>9</strong>! (Ex: 6, 12, 15).</p>
                </div>
            </div>

            <h3>4. Desafio Ninja: Corte os M√∫ltiplos ‚öîÔ∏è</h3>
            <p>N√∫meros v√£o pular na tela. Use seu dedo (ou mouse) como uma espada e corte apenas os que s√£o <strong>divis√≠veis por 3</strong>. Cuidado para n√£o cortar as bombas (n√∫meros errados)!</p>

            [WIDGET:interactive_fruit_ninja_divisibility]
        `,

            "Crit√©rios de Divisibilidade (4, 6 e 8)": `
            <h3>1. A Regra do Combo (Por 6) üçîüçü</h3>
            <p>O n√∫mero 6 n√£o √© um n√∫mero primo. Ele √© filho do 2 e do 3 ($2 \\times 3 = 6$).</p>
            <p>Por isso, para um n√∫mero agradar o 6, ele precisa agradar o pai e a m√£e ao mesmo tempo! Ele precisa passar em <strong>dois testes</strong>:</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 shadow-sm">
                <h4 class="font-bold text-yellow-800 mb-2">üìã Checklist do 6:</h4>
                <ul class="space-y-2 text-sm text-gray-700">
                    <li class="flex items-center gap-2">
                        <span class="bg-green-100 text-green-700 px-2 rounded font-bold">1¬∫</span>
                        Ser PAR (Terminar em 0, 2, 4, 6, 8).
                    </li>
                    <li class="flex items-center gap-2">
                        <span class="bg-blue-100 text-blue-700 px-2 rounded font-bold">2¬∫</span>
                        A soma dos algarismos ser divis√≠vel por 3.
                    </li>
                </ul>
            </div>

            <p>Tente abrir o cofre do 6 testando alguns n√∫meros:</p>

            [WIDGET:interactive_rule_6_lock]

            <h3>2. O Scanner de Final (Por 4 e 8) üîé</h3>
            <p>Para o 4 e o 8, o tamanho total do n√∫mero n√£o importa. O segredo est√° na cauda!</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-red-50 p-4 rounded-xl border-2 border-brand-red text-center relative overflow-hidden">
                    <div class="text-4xl mb-2">üçÄ</div>
                    <h4 class="font-bold text-brand-red uppercase text-sm mb-1">Por 4</h4>
                    <p class="text-xs text-gray-600 mb-2">Olhe apenas os <strong>2 √∫ltimos</strong> d√≠gitos.</p>
                    <div class="bg-white p-2 rounded border border-red-200 text-xs font-mono">
                        1.3<strong>24</strong> (24 divide por 4?) ‚úÖ
                    </div>
                </div>

                <div class="bg-purple-50 p-4 rounded-xl border-2 border-brand-purple text-center relative overflow-hidden">
                    <div class="text-4xl mb-2">üé±</div>
                    <h4 class="font-bold text-brand-purple uppercase text-sm mb-1">Por 8</h4>
                    <p class="text-xs text-gray-600 mb-2">Olhe apenas os <strong>3 √∫ltimos</strong> d√≠gitos.</p>
                    <div class="bg-white p-2 rounded border border-purple-200 text-xs font-mono">
                        5.<strong>008</strong> (008 divide por 8?) ‚úÖ
                    </div>
                </div>
            </div>

            <p>Use o Scanner Matem√°tico para ignorar a parte in√∫til do n√∫mero:</p>

            [WIDGET:interactive_tail_scanner]

            <div class="bg-gray-100 p-3 rounded-lg border border-gray-300 text-sm text-gray-600 text-center mt-4">
                <strong>Dica Extra para o 8:</strong> Se o n√∫mero terminar em 000, ele tamb√©m √© divis√≠vel por 8!
            </div>

            <h3>3. Desafio da F√°brica üè≠</h3>
            <p>As caixas est√£o chegando na esteira. Voc√™ precisa direcionar cada n√∫mero para o caminh√£o de reciclagem correto (4, 6 ou 8). Seja r√°pido!</p>

            [WIDGET:interactive_factory_sorter]
        `,

            "N√∫meros Primos e Compostos": `
<h3>Os √Åtomos da Matem√°tica ‚öõÔ∏è</h3>
<p><strong>N√∫meros Primos:</strong> S√£o os blocos fundamentais. S√≥ podem ser divididos por 1 e por eles mesmos (ex: 2, 3, 5, 7, 11...).</p>
<p><strong>N√∫meros Compostos:</strong> S√£o feitos multiplicando primos. T√™m mais de dois divisores (ex: 4, 6, 8, 9...).</p>

<div class="bg-gray-100 p-3 rounded-lg border border-gray-200 flex items-center gap-3 my-4">
<span class="text-2xl">üêë</span>
<div class="text-xs text-gray-600">
<strong>A Ovelha Negra (2):</strong><br>
O n√∫mero 2 √© o √∫nico primo que √© <strong>PAR</strong>. Todos os outros primos s√£o √≠mpares.
</div>
</div>

<h3>O Crivo de Erat√≥stenes üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
<p>Use a t√©cnica da elimina√ß√£o para encontrar todos os primos:</p>

[WIDGET:interactive_primes_sieve]
`,

            "Decomposi√ß√£o em Fatores Primos (Fatora√ß√£o)": `
            <h3>1. O DNA dos N√∫meros üß¨</h3>
            <p>Voc√™ sabia que todo n√∫mero composto tem uma "receita secreta"? Ele √© formado pela multiplica√ß√£o de n√∫meros primos espec√≠ficos. Isso √© t√£o importante que chamamos de <strong>Teorema Fundamental da Aritm√©tica</strong>.</p>
            
            <p>Por exemplo, o n√∫mero <strong>12</strong> n√£o √© apenas 12. Ele √© feito de $2 \\times 2 \\times 3$.</p>
            <p>Fatorar √© desmontar o n√∫mero at√© encontrar essas pe√ßas fundamentais (os n√∫meros primos).</p>

            <h3>2. O M√©todo da √Årvore de Fatores üå≥</h3>
            <p>Imagine que o n√∫mero √© o tronco de uma √°rvore. N√≥s vamos separ√°-lo em galhos (multiplica√ß√µes) at√© chegarmos nas folhas (n√∫meros primos), que n√£o podem mais ser separados.</p>

            <div class="bg-green-50 p-4 rounded-xl border-l-4 border-brand-green my-4 text-sm">
                <strong>Regra:</strong> Se o n√∫mero for composto, quebre ele em dois. Se for primo, circule (ele √© uma folha).
            </div>

            [WIDGET:interactive_factor_tree]

            <h3>3. O Dispositivo Pr√°tico (A Barra Vertical) üìè</h3>
            <p>Para n√∫meros maiores, usamos um m√©todo mais organizado. Tra√ßamos uma linha vertical e vamos dividindo o n√∫mero apenas por <strong>divisores primos</strong> (2, 3, 5, 7, 11...), come√ßando sempre pelo menor poss√≠vel.</p>

            <p>Tente "descer a escada" da fatora√ß√£o escolhendo o primo correto:</p>

            [WIDGET:interactive_prime_climber]

            <h3>4. Desafio: O Scanner de N√∫meros üî¨</h3>
            <p>Voc√™ √© um cientista matem√°tico. O sistema vai te dar um n√∫mero e voc√™ precisa identificar qual √© a combina√ß√£o de primos que cria esse n√∫mero. Seja r√°pido!</p>

            [WIDGET:interactive_dna_scanner]
        `,

            "MDC (M√°ximo Divisor Comum): Divisores comuns e M√©todo Pr√°tico": `
            <h3>1. O Maior Peda√ßo Comum üß©</h3>
            <p>Imagine que voc√™ tem duas fitas: uma de **12 metros** e outra de **18 metros**. Voc√™ quer cort√°-las em peda√ßos <strong>iguais</strong> e do <strong>maior tamanho poss√≠vel</strong>, sem sobrar nada.</p>
            
            <p>Se cortar de 2 em 2 metros, d√° certo? Sim (12√∑2=6, 18√∑2=9).<br>
            Se cortar de 3 em 3 metros, d√° certo? Sim (12√∑3=4, 18√∑3=6).<br>
            Mas qual √© o <strong>MAIOR</strong> corte poss√≠vel?</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4">
                <strong>O Conceito:</strong> O MDC √© o maior n√∫mero que consegue dividir dois (ou mais) n√∫meros ao mesmo tempo, deixando resto zero.
            </div>

            [WIDGET:interactive_mdc_visualizer]

            <h3>2. O M√©todo Pr√°tico (Fatora√ß√£o Simult√¢nea) üìù</h3>
            <p>Ficar testando n√∫meros demora muito. Existe um jeito r√°pido: a <strong>Decomposi√ß√£o Simult√¢nea</strong>.</p>
            <p>A regra de ouro √©: <em>"Se o n√∫mero primo dividir todo mundo da linha, ele ganha uma estrelinha ‚≠ê. O MDC √© a multiplica√ß√£o das estrelinhas."</em></p>

            [WIDGET:interactive_mdc_method]

            <h3>3. Para que serve isso na vida? ü§î</h3>
            <p>O MDC resolve problemas de <strong>divis√£o sem sobras</strong> e <strong>espa√ßamento igual</strong>. O exemplo mais cl√°ssico √© colocar pisos (azulejos) em uma sala.</p>

            <div class="bg-gray-100 p-4 rounded-xl text-center border-2 border-gray-300 my-4">
                <p class="text-sm font-bold text-gray-500 uppercase">Situa√ß√£o Real</p>
                <p class="text-gray-700">"Tenho um banheiro de $200cm \\times 240cm$. Quero usar o maior piso quadrado poss√≠vel sem precisar cortar nenhum. Qual tamanho compro?"</p>
                <p class="text-brand-purple font-black mt-2">Resposta: MDC(200, 240)</p>
            </div>

            <h3>4. Desafio: Mestre dos Azulejos üë∑</h3>
            <p>Voc√™ foi contratado para reformar o piso. Escolha o tamanho exato do azulejo para cobrir a √°rea azul sem deixar buracos e sem cortar pe√ßas!</p>

            [WIDGET:interactive_tile_master]
        `,

            "MMC (M√≠nimo M√∫ltiplo Comum): M√∫ltiplos comuns e M√©todo Pr√°tico": `
            <h3>1. O Vidente Matem√°tico üîÆ</h3>
            <p>Se o MDC serve para dividir o passado (o que j√° temos), o <strong>MMC</strong> serve para prever o <strong>FUTURO</strong>.</p>
            <p>Imagine dois cometas passando pela Terra. Um passa a cada 4 anos, o outro a cada 6 anos. Se eles passaram hoje, quando passar√£o juntos novamente?</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm text-sm">
                <strong>O Conceito:</strong> O MMC √© o <strong>menor</strong> n√∫mero (diferente de zero) que faz parte da tabuada dos dois n√∫meros ao mesmo tempo. √â o primeiro ponto de encontro.
            </div>

            <h3>2. A Corrida dos M√∫ltiplos üèÉ‚Äç‚ôÇÔ∏è</h3>
            <p>Vamos visualizar isso como pulos em uma estrada. O Sapo Verde pula de 4 em 4. O Sapo Laranja pula de 6 em 6.</p>
            
            [WIDGET:interactive_mmc_visualizer]

            <p>Veja que eles se encontram no 12, no 24, no 36... O <strong>12</strong> √© o primeiro (o M√≠nimo)!</p>

            <h3>3. O M√©todo Pr√°tico (A Grade) üèóÔ∏è</h3>
            <p>Ficar desenhando retas demora muito. Para n√∫meros grandes, usamos a <strong>Decomposi√ß√£o Simult√¢nea</strong>.</p>
            <p>√â parecido com a fatora√ß√£o, mas fazemos com dois (ou mais) n√∫meros ao mesmo tempo, lado a lado.</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 text-center my-4">
                <p class="text-xs font-bold text-yellow-800 uppercase mb-2">Algoritmo</p>
                <ol class="list-decimal list-inside text-sm text-gray-700 text-left mx-auto max-w-xs space-y-1">
                    <li>Coloque os n√∫meros lado a lado.</li>
                    <li>Divida pelo menor <strong>primo</strong> poss√≠vel que sirva para ALGU√âM.</li>
                    <li>Se n√£o der para dividir um deles, apenas <strong>copie</strong> ele para baixo.</li>
                    <li>Continue at√© tudo virar 1.</li>
                    <li>Multiplique todos os primos da direita!</li>
                </ol>
            </div>

            [WIDGET:interactive_mmc_decomposition_tool]

            <h3>4. Desafio: A Enfermeira Organizada üíä</h3>
            <p>Pacientes tomam rem√©dios em horas diferentes. Voc√™ precisa calcular o hor√°rio exato em que o alarme vai tocar para os dois rem√©dios juntos!</p>

            [WIDGET:interactive_mmc_scheduler]
        `,

            "Problemas de Encontro (MMC) e de Reparti√ß√£o (MDC)": `
            <h3>1. O Grande Dilema: "Quando" ou "Quanto"? ü§î</h3>
            <p>Voc√™ j√° leu um problema de matem√°tica e ficou sem saber se usava MMC ou MDC? Calma! Existe um segredo para descobrir. Voc√™ precisa agir como um detetive e procurar as pistas no texto.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-brand-purple shadow-sm">
                    <h4 class="font-bold text-brand-purple mb-2 flex items-center gap-2"><i class="fas fa-clock"></i> Pistas do MMC</h4>
                    <p class="text-sm text-gray-700 mb-2">Usamos quando queremos saber sobre o <strong>TEMPO</strong> ou <strong>ENCONTROS FUTUROS</strong>.</p>
                    <ul class="text-xs text-gray-600 list-disc list-inside font-bold">
                        <li>"Quando acontecer√° novamente?"</li>
                        <li>"De quanto em quanto tempo?"</li>
                        <li>"Coincid√™ncia"</li>
                        <li>"Simultaneamente"</li>
                    </ul>
                </div>

                <div class="bg-orange-50 p-4 rounded-xl border-l-4 border-brand-orange shadow-sm">
                    <h4 class="font-bold text-brand-orange mb-2 flex items-center gap-2"><i class="fas fa-box-open"></i> Pistas do MDC</h4>
                    <p class="text-sm text-gray-700 mb-2">Usamos quando queremos <strong>DIVIDIR</strong> coisas em <strong>GRUPOS IGUAIS</strong>.</p>
                    <ul class="text-xs text-gray-600 list-disc list-inside font-bold">
                        <li>"Maior tamanho poss√≠vel"</li>
                        <li>"Dividir em partes iguais"</li>
                        <li>"N√£o sobrar nada"</li>
                        <li>"M√°ximo de grupos"</li>
                    </ul>
                </div>
            </div>

            <h3>2. O Encontro dos Corredores (MMC) üèÉ‚Äç‚ôÇÔ∏è</h3>
            <p>Imagine dois amigos correndo em uma pista circular. O <strong>Azul</strong> completa a volta em 4 minutos. O <strong>Vermelho</strong> completa em 6 minutos. Eles saem juntos. Quando v√£o se cruzar na linha de chegada de novo?</p>
            <p>Isso √© um problema de <strong>M√∫ltiplos</strong>! Veja a linha do tempo:</p>

            [WIDGET:interactive_timeline_runner]

            <h3>3. A F√°brica de Kits de Festa (MDC) üéÅ</h3>
            <p>Agora imagine que voc√™ tem <strong>20 balas</strong> e <strong>12 pirulitos</strong>. Voc√™ quer montar sacolinhas surpresa para o seu anivers√°rio.
            <br>Regras:
            <br>1. Todas as sacolinhas devem ser iguais.
            <br>2. N√£o pode sobrar doce fora da sacola.
            <br>3. Voc√™ quer o <strong>M√ÅXIMO</strong> de sacolinhas poss√≠vel.</p>

            <p>Isso √© um problema de <strong>Divisores</strong>! Vamos testar:</p>

            [WIDGET:interactive_gift_factory]

            <h3>4. Desafio do Detetive üïµÔ∏è</h3>
            <p>Leia o problema e decida r√°pido: √© um caso para o Agente MMC ou para o Agente MDC?</p>

            [WIDGET:interactive_problem_sorter]
        `,

            // =======================================================
            // UNIDADE 7: FRA√á√ïES - PARTE I
            // =======================================================
            "O Conceito Parte-Todo": `
<h3>O Problema da Pizza üçï</h3>
<p>A fra√ß√£o nasce quando um n√∫mero natural n√£o √© suficiente. Precisamos de peda√ßos!</p>

<div class="bg-blue-50 p-6 rounded-xl border-2 border-blue-200 my-6 relative text-center">
<div class="text-5xl font-black text-brand-orange">3</div>
<div class="w-16 h-1 bg-gray-400 rounded-full mx-auto my-1"></div>
<div class="text-5xl font-black text-brand-blue">8</div>

<div class="mt-4 text-sm text-gray-600">
<span class="text-brand-orange font-bold">Numerador:</span> Quantos eu comi.<br>
<span class="text-brand-blue font-bold">Denominador:</span> O corte total da pizza.
</div>
</div>

[WIDGET:interactive_pizza_fractions]
`,

            "Elementos da Fra√ß√£o: Numerador e Denominador": `
            <h3>1. O Pr√©dio de Dois Andares üè¢</h3>
            <p>Uma fra√ß√£o n√£o √© um monstro de duas cabe√ßas. √â apenas um n√∫mero escrito em forma de pr√©dio, com dois andares separados por um tra√ßo (o tra√ßo de fra√ß√£o).</p>

            <div class="flex justify-center gap-8 my-6 items-center">
                <div class="flex flex-col items-center">
                    <div class="bg-blue-100 text-brand-blue font-black text-4xl p-4 rounded-t-xl border-2 border-brand-blue w-24 text-center">3</div>
                    <div class="h-2 w-32 bg-gray-800 rounded"></div>
                    <div class="bg-orange-100 text-brand-orange font-black text-4xl p-4 rounded-b-xl border-2 border-brand-orange w-24 text-center">4</div>
                </div>
                <div class="text-sm text-gray-600">
                    <p class="mb-4">‚¨ÖÔ∏è <strong>Numerador</strong> (Nuvem, fica em cima)</p>
                    <p class="mt-4">‚¨ÖÔ∏è <strong>Denominador</strong> (Debaixo, sustenta tudo)</p>
                </div>
            </div>

            <h3>2. O Denominador (O Chefe do Tamanho) üìè</h3>
            <p>O n√∫mero de baixo √© o <strong>Denominador</strong>. O nome dele vem de "Denominar" (dar nome).</p>
            <p>Ele decide em <strong>quantas partes iguais</strong> o inteiro foi cortado. Quanto maior o denominador, menor √© o peda√ßo! (Pense: √© melhor dividir uma pizza com 2 amigos ou com 100?)</p>

            <h3>3. O Numerador (O Contador) üëÜ</h3>
            <p>O n√∫mero de cima √© o <strong>Numerador</strong>. O nome vem de "Numerar" (contar).</p>
            <p>Ele conta <strong>quantas partes</strong> n√≥s pegamos, pintamos ou comemos.</p>

            <h3>4. Laborat√≥rio de Anatomia üî¨</h3>
            <p>Mexa nos controles para ver quem manda no qu√™. Perceba que mudar o Denominador muda o <em>tamanho</em> da fatia, mas mudar o Numerador s√≥ muda a <em>quantidade</em>.</p>

            [WIDGET:interactive_fraction_anatomy]

            <h3>5. Desafio R√°pido: Quem √© Quem? ‚ö°</h3>
            <p>N√£o deixe seu c√©rebro travar! Eu vou pedir uma parte e voc√™ clica nela o mais r√°pido poss√≠vel.</p>

            [WIDGET:interactive_fraction_role_quiz]
        `,

            "Leitura e Classifica√ß√£o (Pr√≥pria, Impr√≥pria e Aparente)": `
            <h3>1. O Nome e Sobrenome da Fra√ß√£o üó£Ô∏è</h3>
            <p>Ler uma fra√ß√£o √© f√°cil: o n√∫mero de cima (Numerador) a gente l√™ normal. O n√∫mero de baixo (Denominador) d√° o nome da fam√≠lia.</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm">
                <strong>As Regras do Nome:</strong>
                <ul class="mt-2 space-y-1 text-gray-700">
                    <li>2 a 9: Tem nomes especiais (meio, ter√ßo, quarto... nono).</li>
                    <li>10, 100, 1000: D√©cimo, Cent√©simo, Mil√©simo.</li>
                    <li>Todo o resto: L√™ o n√∫mero e adiciona a palavra m√°gica <strong>"AVOS"</strong>.</li>
                </ul>
            </div>

            <p>Teste o tradutor autom√°tico para aprender a falar "matematiqu√™s":</p>

            [WIDGET:interactive_fraction_reader]

            <h3>2. As Tr√™s Personalidades das Fra√ß√µes üé≠</h3>
            <p>Dependendo do tamanho da cabe√ßa (Numerador) em rela√ß√£o ao corpo (Denominador), a fra√ß√£o recebe um apelido:</p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6">
                
                <div class="bg-green-50 p-4 rounded-xl border-t-4 border-brand-green text-center shadow-sm">
                    <div class="text-3xl mb-2">üë∂</div>
                    <h4 class="font-bold text-brand-green uppercase text-xs">Pr√≥pria</h4>
                    <p class="text-xs text-gray-500 mt-1">O de cima √© <strong>MENOR</strong> que o de baixo.</p>
                    <p class="font-mono font-bold mt-2 text-brand-text">1/4, 2/3</p>
                    <span class="text-[10px] bg-white px-2 py-1 rounded border border-green-200 mt-2 inline-block">Menor que 1 Inteiro</span>
                </div>

                <div class="bg-orange-50 p-4 rounded-xl border-t-4 border-brand-orange text-center shadow-sm">
                    <div class="text-3xl mb-2">ü§Ø</div>
                    <h4 class="font-bold text-brand-orange uppercase text-xs">Impr√≥pria</h4>
                    <p class="text-xs text-gray-500 mt-1">O de cima √© <strong>MAIOR</strong> (ou igual) ao de baixo.</p>
                    <p class="font-mono font-bold mt-2 text-brand-text">5/4, 3/2</p>
                    <span class="text-[10px] bg-white px-2 py-1 rounded border border-orange-200 mt-2 inline-block">Mais que 1 Inteiro</span>
                </div>

                <div class="bg-purple-50 p-4 rounded-xl border-t-4 border-brand-purple text-center shadow-sm">
                    <div class="text-3xl mb-2">üïµÔ∏è</div>
                    <h4 class="font-bold text-brand-purple uppercase text-xs">Aparente</h4>
                    <p class="text-xs text-gray-500 mt-1">√â uma divis√£o exata! O de cima √© m√∫ltiplo do de baixo.</p>
                    <p class="font-mono font-bold mt-2 text-brand-text">8/4, 10/2</p>
                    <span class="text-[10px] bg-white px-2 py-1 rounded border border-purple-200 mt-2 inline-block">√â um N√∫mero Inteiro</span>
                </div>

            </div>

            <h3>3. Visualizando o Transbordo üåä</h3>
            <p>Quando a fra√ß√£o √© <strong>Impr√≥pria</strong>, ela n√£o cabe em uma √∫nica pizza. Ela precisa de mais pizzas!</p>
            <p>Aumente o numerador no simulador abaixo e veja o que acontece quando ele passa do denominador.</p>

            [WIDGET:interactive_fraction_shaper]

            <h3>4. Jogo da Reciclagem ‚ôªÔ∏è</h3>
            <p>As fra√ß√µes est√£o caindo na esteira! Arraste cada uma para a caixa correta antes que o tempo acabe.</p>

            [WIDGET:interactive_fraction_sorter]
        `,

            "N√∫meros Mistos: Convers√£o para Fra√ß√£o Impr√≥pria e vice-versa": `
            <h3>1. O Que √© um N√∫mero Misto? ü•™</h3>
            <p>Imagine que voc√™ pediu pizzas para a turma. Voc√™s comeram 2 pizzas inteiras e mais 3 peda√ßos da terceira. Como escrevemos isso?</p>
            <p>Podemos escrever de dois jeitos:</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-4">
                <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue shadow-sm">
                    <h4 class="font-bold text-brand-blue uppercase text-xs mb-1">N√∫mero Misto</h4>
                    <p class="text-sm text-gray-700">Mistura <strong>Inteiro</strong> com <strong>Fra√ß√£o</strong>.</p>
                    <div class="font-mono text-3xl font-black text-brand-text mt-2 flex items-center gap-2">
                        2 <span class="text-xl">$\\frac{3}{8}$</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">L√™-se: "Dois inteiros e tr√™s oitavos".</p>
                </div>

                <div class="bg-orange-50 p-4 rounded-xl border-l-4 border-brand-orange shadow-sm">
                    <h4 class="font-bold text-brand-orange uppercase text-xs mb-1">Fra√ß√£o Impr√≥pria</h4>
                    <p class="text-sm text-gray-700">Conta apenas os <strong>peda√ßos</strong> (o de cima √© maior).</p>
                    <div class="font-mono text-3xl font-black text-brand-text mt-2">
                        $\\frac{19}{8}$
                    </div>
                    <p class="text-xs text-gray-500 mt-1">L√™-se: "Dezenove oitavos".</p>
                </div>
            </div>

            <p>√â a mesma quantidade de comida! Veja a m√°gica acontecendo:</p>

            [WIDGET:interactive_mixed_visualizer]

            <h3>2. Misto ‚ûú Impr√≥pria (O Ciclo da Multiplica√ß√£o) üîÑ</h3>
            <p>Como transformar $2 \\frac{3}{8}$ em fra√ß√£o sem desenhar? Usamos a regra do "Rel√≥gio":</p>
            
            <ol class="list-none space-y-2 bg-white p-4 rounded-xl border border-gray-200 text-sm font-bold text-gray-600 my-4">
                <li>1. Multiplica o de baixo pelo inteiro ($8 \\times 2 = 16$).</li>
                <li>2. Soma com o de cima ($16 + 3 = 19$).</li>
                <li>3. Mant√©m o denominador ($19/8$).</li>
            </ol>

            <div class="text-center font-mono text-lg bg-gray-100 p-2 rounded-lg">
                $\\frac{\\text{baixo} \\times \\text{inteiro} + \\text{cima}}{\\text{baixo}}$
            </div>

            <h3>3. Impr√≥pria ‚ûú Misto (A Divis√£o Real) ‚ûó</h3>
            <p>E o contr√°rio? Se tenho 19 fatias, quantas pizzas inteiras d√°?</p>
            <p>Basta <strong>DIVIDIR</strong> o de cima pelo de baixo:</p>

            <ul class="list-disc list-inside text-sm text-gray-700 mt-2">
                <li>O resultado (Quociente) s√£o os <strong>Inteiros</strong>.</li>
                <li>O que sobra (Resto) √© o novo <strong>Numerador</strong>.</li>
            </ul>

            <h3>4. Desafio: O Entregador de Pizzas üõµ</h3>
            <p>A cozinha mandou as fatias todas soltas. Sua miss√£o √© empacotar em caixas inteiras para entrega!</p>

            [WIDGET:interactive_pizza_packer]
        `,

            "Fra√ß√£o como Quociente (Divis√£o)": `
            <h3>1. A Identidade Secreta ü•∏</h3>
            <p>Olhe bem para o s√≠mbolo da divis√£o: <strong>√∑</strong>.</p>
            <p>Voc√™ percebeu que ele √© uma fra√ß√£o? A bolinha de cima √© o numerador, a barra √© o tra√ßo, e a bolinha de baixo √© o denominador!</p>
            
            <div class="bg-blue-50 p-6 rounded-xl border-l-4 border-brand-blue my-6 text-center text-xl font-medium text-gray-700">
                <p>Toda fra√ß√£o √©, na verdade, uma <strong>divis√£o</strong> que ficou com pregui√ßa de ser calculada.</p>
            </div>

            <p>Quando escrevemos $\\frac{3}{4}$, estamos dizendo matematicamente: <strong>"Quero dividir 3 inteiros para 4 pessoas"</strong>.</p>

            <h3>2. O Transformador ü§ñ</h3>
            <p>Qualquer fra√ß√£o pode mudar de forma. Ela pode sair do "Modo Fra√ß√£o", entrar no "Modo Conta" e terminar no "Modo Decimal".</p>
            <p>Veja a transforma√ß√£o acontecendo:</p>

            [WIDGET:interactive_division_transformer]

            <h3>3. Situa√ß√µes Reais: O Chocolate üç´</h3>
            <p>Se voc√™ tem 3 barras de chocolate para dividir entre 4 amigos, ningu√©m vai ganhar uma barra inteira (porque $3 < 4$).</p>
            <ul class="list-disc list-inside text-sm text-gray-600 mt-2 bg-white p-4 rounded-xl border border-gray-200">
                <li><strong>Na Fra√ß√£o:</strong> Cada um ganha $\\frac{3}{4}$ da barra.</li>
                <li><strong>Na Divis√£o:</strong> $3 \\div 4 = 0,75$.</li>
                <li><strong>Na Vida Real:</strong> Cada um ganha 75% da barra (ou 3 quadradinhos de 4).</li>
            </ul>

            <h3>4. Desafio da Conex√£o üîó</h3>
            <p>As pe√ßas se perderam! Sua miss√£o √© conectar a Fra√ß√£o com sua Divis√£o correspondente. Limpe o tabuleiro!</p>

            [WIDGET:interactive_connection_game]
        `,

            "Fra√ß√£o como Operador (Fra√ß√£o de uma quantidade)": `
<h3>O Segredo da Palavra "DE" üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
<p>Na matem√°tica, "de" significa <strong>MULTIPLICA√á√ÉO</strong>.</p>

<div class="bg-white p-4 rounded-xl border-2 border-brand-blue shadow-sm my-4">
<h4 class="font-bold text-brand-blue mb-2">O Algoritmo M√°gico ‚ú®</h4>
<ol class="list-decimal list-inside text-sm text-gray-600">
<li><strong>Divida</strong> pelo de baixo (descubra quanto vale 1 peda√ßo).</li>
<li><strong>Multiplique</strong> pelo de cima (pegue os peda√ßos que voc√™ quer).</li>
</ol>
</div>

[WIDGET:interactive_fraction_operator]
`,

            "Fra√ß√µes Equivalentes: Amplia√ß√£o e Simplifica√ß√£o": `
<h3>O Mestre dos Disfarces ü•∏</h3>
<p>Voc√™ sabia que $\\frac{1}{2}$ e $\\frac{2}{4}$ s√£o o mesmo n√∫mero? √â a mesma quantidade de pizza, s√≥ cortada diferente.</p>

<div class="bg-blue-50 p-6 rounded-xl border-l-4 border-brand-blue my-4 flex flex-col items-center">
<strong>A Regra de Ouro:</strong>
<p class="text-sm mt-2 text-center">Para mudar a roupa da fra√ß√£o sem mudar o valor, multiplique ou divida em cima e embaixo pelo <strong>MESMO n√∫mero</strong>.</p>
</div>

[WIDGET:interactive_fraction_wall]
`,

            "Fra√ß√£o Irredut√≠vel": `
            <h3>1. A Forma Mais Pura üíé</h3>
            <p>Imagina que tens uma pedra bruta e queres encontrar o diamante escondido l√° dentro. Na matem√°tica, fra√ß√µes como $\\frac{50}{100}$ s√£o pedras brutas. Elas s√£o "pesadas" e cheias de n√∫meros grandes desnecess√°rios.</p>
            <p>A <strong>Fra√ß√£o Irredut√≠vel</strong> √© o diamante. √â a forma mais simples, leve e elegante de escrever aquela quantidade. ($\\frac{1}{2}$)</p>

            <div class="bg-green-50 p-4 rounded-xl border-l-4 border-brand-green my-4 text-sm shadow-sm">
                <strong>Defini√ß√£o:</strong> Uma fra√ß√£o √© irredut√≠vel quando o Numerador e o Denominador n√£o podem mais ser divididos pelo mesmo n√∫mero (o √∫nico divisor comum √© 1).
            </div>

            <h3>2. A M√°quina de Simplificar ‚öôÔ∏è</h3>
            <p>Para simplificar, usamos a regra de ouro: <strong>Dividir em cima e em baixo pelo MESMO n√∫mero.</strong></p>
            <p>Podemos fazer isso aos poucos (passo a passo) ou de uma vez s√≥ (usando o MDC). Experimenta colocar uma fra√ß√£o "gorda" na m√°quina e faz√™-la "emagrecer":</p>

            [WIDGET:interactive_simplification_machine]

            <h3>3. O Atalho do MDC üöÄ</h3>
            <p>Se n√£o quiseres ficar a dividir por 2, depois por 2, depois por 3... podes usar um super-ataque!</p>
            <p>Se dividires o numerador e o denominador diretamente pelo <strong>MDC (M√°ximo Divisor Comum)</strong> deles, chegas √† fra√ß√£o irredut√≠vel num √∫nico salto!</p>

            <div class="font-mono text-center bg-gray-100 p-3 rounded-lg border border-gray-300 my-4">
                Exemplo: $\\frac{12}{18}$<br>
                MDC(12, 18) = 6<br>
                $12 \\div 6 = 2$<br>
                $18 \\div 6 = 3$<br>
                Resultado: <strong>$\\frac{2}{3}$</strong>
            </div>

            <h3>4. Desafio: A Mina de Diamantes ‚õèÔ∏è</h3>
            <p>√âs um ge√≥logo matem√°tico! Usa as picaretas certas (divisores) para partir as rochas at√© sobrar apenas o diamante irredut√≠vel.</p>

            [WIDGET:interactive_diamond_mine]
        `,

            "Compara√ß√£o de Fra√ß√µes (Mesmo denominador vs Denominadores diferentes)": `
            <h3>1. O Duelo: Quem √© Maior? ‚öîÔ∏è</h3>
            <p>Comparar fra√ß√µes √© descobrir quem ganha na quantidade. √â f√°cil quando falamos de n√∫meros inteiros (10 √© maior que 5), mas com fra√ß√µes, as apar√™ncias enganam!</p>

            <h3>2. Mesmo Denominador (Terreno Plano) üü¢</h3>
            <p>Se o n√∫mero de baixo (Denominador) √© igual, os peda√ßos t√™m o <strong>mesmo tamanho</strong>. A luta √© justa!</p>
            <p>Basta olhar para o n√∫mero de cima (Numerador): quem pegou mais peda√ßos, ganha.</p>
            
            <div class="flex justify-center gap-8 my-4 text-xl font-mono font-bold">
                <div class="text-brand-green">3/8</div>
                <div class="text-gray-400">&lt;</div>
                <div class="text-brand-green">5/8</div>
            </div>
            <p class="text-center text-xs text-gray-500 mb-6">Como os peda√ßos s√£o iguais (oitavos), 5 √© maior que 3.</p>

            <h3>3. Denominadores Diferentes (Terreno Acidentado) ‚õ∞Ô∏è</h3>
            <p>Quem √© maior: $\\frac{1}{2}$ ou $\\frac{3}{5}$? Agora complicou! Os peda√ßos t√™m tamanhos diferentes.</p>
            <p>N√£o podemos comparar laranjas com bananas. Precisamos usar o <strong>MMC</strong> para deixar os denominadores iguais ou usar o <strong>Truque da Multiplica√ß√£o Cruzada</strong>.</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm shadow-sm">
                <strong>‚ö° O Golpe Ninja (Cruzado):</strong>
                <br>Multiplique o denominador de um pelo numerador do outro.
                <br>$\\frac{1}{2}$ vs $\\frac{3}{5}$ ‚ûú $1 \\times 5 = 5$ e $2 \\times 3 = 6$.
                <br>Como $6 > 5$, ent√£o $\\frac{3}{5}$ √© maior!
            </div>

            <p>Teste suas hip√≥teses na Balan√ßa de Fra√ß√µes:</p>

            [WIDGET:interactive_fraction_balance]

            <h3>4. Batalha de Fra√ß√µes (War) üÉè</h3>
            <p>Desafie o computador! Voc√™s v√£o virar cartas com fra√ß√µes. Voc√™ precisa clicar na carta <strong>MAIOR</strong> para ganhar a rodada.</p>

            [WIDGET:interactive_fraction_war]
        `,

            // =======================================================
            // UNIDADE 8: FRA√á√ïES - PARTE II
            // =======================================================

            "Adi√ß√£o e Subtra√ß√£o com Denominadores Iguais": `
            <h3>1. A Regra do "Sobrenome" üìõ</h3>
            <p>Imagine que voc√™ vai somar frutas: <strong>2 Bananas + 3 Bananas</strong>. O resultado √© <strong>5 Bananas</strong>.</p>
            <p>Na fra√ß√£o, o denominador √© o "Sobrenome" (o tipo da coisa). Se os denominadores s√£o iguais, √© tudo a mesma fruta!</p>
            
            <div class="bg-green-50 p-4 rounded-xl border-l-4 border-brand-green my-4 text-center">
                <p class="font-bold text-gray-700">Mantra da Soma F√°cil:</p>
                <p class="text-lg font-mono mt-2">"Conserva o de baixo e soma o de cima."</p>
            </div>

            <h3>2. Visualizando na Pizza üçï</h3>
            <p>Se voc√™ comeu $\\frac{1}{8}$ no almo√ßo e $\\frac{2}{8}$ no jantar, voc√™ n√£o mudou o corte da pizza (ela continua dividida em 8). Voc√™ s√≥ aumentou a quantidade de fatias.</p>

            [WIDGET:interactive_fraction_same_denom]

            <div class="bg-red-50 p-4 rounded-xl border-2 border-red-200 mt-4 text-sm text-center">
                <strong class="text-brand-red">‚ö†Ô∏è ERRO GRAVE:</strong>
                <br>Nunca, jamais, em hip√≥tese alguma, some os denominadores!
                <br>$\\frac{1}{8} + \\frac{2}{8} \\neq \\frac{3}{16}$. (Isso diminuiria o tamanho da fatia!)
            </div>
        `,

            "Adi√ß√£o e Subtra√ß√£o com Denominadores Diferentes (Uso do MMC)": `
<h3>A Regra do Sobrenome üìõ</h3>
<p>Voc√™ n√£o pode somar "2 Bananas + 3 Laranjas". Na fra√ß√£o, o denominador √© o sobrenome. Se forem diferentes, precisamos traduzir!</p>

<div class="bg-blue-50 p-6 rounded-xl border-l-4 border-brand-blue my-6">
<h4 class="font-bold text-brand-blue mb-2">üõ†Ô∏è A Estrat√©gia do Tradutor (MMC)</h4>
<ol class="list-decimal list-inside space-y-3 text-sm text-gray-700 font-medium">
<li>Ache o <strong>MMC</strong> dos denominadores.</li>
<li><strong>O Mantra:</strong> "Divide pelo de baixo, multiplica pelo de cima."</li>
<li>Agora que os "sobrenomes" s√£o iguais, pode somar!</li>
</ol>
</div>

[WIDGET:interactive_fraction_addition]
`,

            "Multiplica√ß√£o de N√∫mero Natural por Fra√ß√£o": `
            <h3>1. O Pedido Repetido üìù</h3>
            <p>Multiplicar um n√∫mero natural por uma fra√ß√£o √© apenas uma <strong>adi√ß√£o repetida</strong>.</p>
            <p>Se voc√™ pede "3 vezes uma fatia de $\\frac{1}{6}$", voc√™ est√° fazendo: $\\frac{1}{6} + \\frac{1}{6} + \\frac{1}{6}$.</p>

            <div class="flex justify-center items-center gap-4 my-6 font-mono text-xl font-bold">
                <div class="text-brand-purple">3</div>
                <div>√ó</div>
                <div class="flex flex-col items-center">
                    <span>2</span>
                    <div class="w-full h-0.5 bg-gray-600"></div>
                    <span>7</span>
                </div>
                <div>=</div>
                <div class="flex flex-col items-center">
                    <span class="text-brand-purple">3</span>√ó2
                    <div class="w-full h-0.5 bg-gray-600"></div>
                    <span>7</span>
                </div>
                <div>=</div>
                <div class="flex flex-col items-center text-brand-green">
                    <span>6</span>
                    <div class="w-full h-0.5 bg-gray-600"></div>
                    <span>7</span>
                </div>
            </div>

            <h3>2. O Gar√ßom Matem√°tico ü§µ</h3>
            <p>Use o simulador para fazer pedidos repetidos e ver como as fatias se acumulam para formar inteiros.</p>

            [WIDGET:interactive_natural_mult_fraction]

            <p class="text-sm text-gray-500 italic mt-2">Dica: O denominador n√£o muda porque o tamanho da fatia servida √© sempre o mesmo.</p>
        `,

            "Multiplica√ß√£o de Fra√ß√£o por Fra√ß√£o (√Årea de ret√¢ngulo fracion√°rio)": `
<h3>Multiplica√ß√£o: A Via Expressa üöÖ</h3>
<p>Esque√ßa o MMC! Aqui √© direto: o de cima com o de cima, o de baixo com o de baixo.</p>

<div class="inline-flex items-center gap-3 font-mono text-xl bg-white p-3 rounded-lg border border-green-100 shadow-sm my-4">
<div class="flex flex-col text-center">2<span class="border-t-2 border-gray-400 w-full block"></span>3</div>
<span class="text-gray-400">√ó</span>
<div class="flex flex-col text-center">4<span class="border-t-2 border-gray-400 w-full block"></span>5</div>
<span class="text-gray-400">=</span>
<div class="flex flex-col text-center text-brand-green font-black">8<span class="border-t-2 border-gray-400 w-full block"></span>15</div>
</div>

[WIDGET:interactive_fraction_mult]
`,

            "Divis√£o de Fra√ß√µes (Ideia de quantas vezes cabe)": `
<h3>Divis√£o: A Regra da Cambalhota ü§∏‚Äç‚ôÇÔ∏è</h3>
<p>Dividir por uma fra√ß√£o √© multiplicar pelo inverso dela.</p>

<div class="bg-orange-50 p-6 rounded-xl border-l-4 border-brand-orange my-4">
<ol class="list-decimal list-inside space-y-2 text-sm text-gray-700">
<li><strong>Mantenha</strong> a primeira fra√ß√£o igual.</li>
<li><strong>Troque</strong> o sinal para Multiplicar (x).</li>
<li><strong>INVERTA</strong> a segunda fra√ß√£o (ela d√° uma cambalhota!).</li>
</ol>
</div>

[WIDGET:interactive_fraction_div]
`,

            "Potencia√ß√£o e Raiz Quadrada de Fra√ß√µes": `
            <h3>1. Justi√ßa para Todos! ‚öñÔ∏è</h3>
            <p>A Potencia√ß√£o e a Raiz s√£o muito justas. O que acontece com o de cima, <strong>TEM</strong> que acontecer com o de baixo.</p>
            <p>Chamamos isso de "Propriedade Distributiva da Pot√™ncia/Raiz em rela√ß√£o √† Divis√£o".</p>

            <h3>2. A M√°quina de Pot√™ncia ‚ö°</h3>
            <p>Quando elevamos uma fra√ß√£o ao quadrado, elevamos o numerador E o denominador.</p>
            
            <div class="bg-white p-4 rounded-xl border-2 border-brand-purple text-center my-4">
                <div class="text-xl font-mono">
                    $(\\frac{2}{3})^2 = \\frac{2^2}{3^2} = \\frac{4}{9}$
                </div>
                <p class="text-xs text-gray-400 mt-2">Os par√™nteses s√£o obrigat√≥rios! Sem eles, o expoente s√≥ pegaria o de cima.</p>
            </div>

            <h3>3. A M√°quina de Raiz üå±</h3>
            <p>A raiz quadrada tamb√©m se separa. Tiramos a raiz de cima e a raiz de baixo.</p>

            [WIDGET:interactive_power_root_machine]

            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow mt-6 text-sm">
                <strong>üí° Dica Visual:</strong>
                <br>Imagine que o tra√ßo da fra√ß√£o quebra o expoente (ou a raiz) em dois pedacinhos menores, um para cada andar do pr√©dio.
            </div>
        `,

            // =======================================================
            // UNIDADE 9: N√öMEROS DECIMAIS
            // =======================================================
            "Fra√ß√µes Decimais e a Escrita com V√≠rgula": `
<h3>O Poder da V√≠rgula üöß</h3>
<p>Ela √© o muro que separa o "Mundo dos Inteiros" do "Mundo dos Peda√ßos".</p>
<p>Voc√™ sabia que $\\frac{1}{2}$ e $0,5$ s√£o o mesmo n√∫mero? Para transformar fra√ß√£o em decimal, basta dividir!</p>

[WIDGET:interactive_fraction_decimal_converter]
`,

            "Ordens Decimais: D√©cimos, Cent√©simos e Mil√©simos": `
            <h3>1. O Microsc√≥pio dos N√∫meros üî¨</h3>
            <p>Entre o 0 e o 1, existe um universo inteiro! Se voc√™ pegar uma r√©gua e der um zoom, vai ver os mil√≠metros. Se der mais zoom, ver√° coisas ainda menores.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6 text-center">
                <div class="bg-blue-50 p-4 rounded-xl border-t-4 border-brand-blue shadow-sm">
                    <h4 class="font-bold text-brand-blue text-lg">D√©cimo (0,1)</h4>
                    <p class="text-xs text-gray-600 mt-1">Dividir por 10.</p>
                    <div class="w-full h-4 bg-gray-200 mt-2 rounded overflow-hidden">
                        <div class="h-full bg-brand-blue w-[10%]"></div>
                    </div>
                </div>
                <div class="bg-orange-50 p-4 rounded-xl border-t-4 border-brand-orange shadow-sm">
                    <h4 class="font-bold text-brand-orange text-lg">Cent√©simo (0,01)</h4>
                    <p class="text-xs text-gray-600 mt-1">Dividir por 100.</p>
                    <div class="w-full h-4 bg-gray-200 mt-2 rounded overflow-hidden">
                        <div class="h-full bg-brand-orange w-[1%]"></div>
                    </div>
                </div>
                <div class="bg-green-50 p-4 rounded-xl border-t-4 border-brand-green shadow-sm">
                    <h4 class="font-bold text-brand-green text-lg">Mil√©simo (0,001)</h4>
                    <p class="text-xs text-gray-600 mt-1">Dividir por 1.000.</p>
                    <div class="w-full h-4 bg-gray-200 mt-2 rounded overflow-hidden">
                        <div class="h-full bg-brand-green w-[0.1%]"></div>
                    </div>
                </div>
            </div>

            <p>Explore o zoom infinito para entender o tamanho real de cada casa:</p>

            [WIDGET:interactive_decimal_zoom]

            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow mt-4 text-sm shadow-sm">
                <strong>üí° Curiosidade:</strong> O <strong>Cent√©simo</strong> √© a base do nosso dinheiro (Centavos = Cent√©simos de Real). O <strong>Mil√©simo</strong> √© usado no pre√ßo da gasolina!
            </div>
        `,

            "Compara√ß√£o e Ordena√ß√£o de Decimais na Reta Num√©rica": `
<h3>Quem √© Maior? (A Pegadinha) ‚öñÔ∏è</h3>
<p>Qual n√∫mero √© maior: <strong>0,5</strong> ou <strong>0,12</strong>?</p>

<div class="bg-red-50 p-4 rounded-xl border-l-4 border-brand-red my-4 text-sm shadow-sm">
<strong>üö´ O Erro Comum:</strong> "12 √© maior que 5, ent√£o 0,12 ganha". <strong>ERRADO!</strong>
<br>Complete com zeros: 0,50 √© maior que 0,12.
</div>

[WIDGET:interactive_decimal_align]
`,

            "Adi√ß√£o e Subtra√ß√£o de Decimais (V√≠rgula sob v√≠rgula)": `
<h3>A Regra dos Bot√µes üëî</h3>
<p>Imagine que voc√™ est√° abotoando uma camisa. Se errar o primeiro bot√£o, tudo fica torto. Na soma de decimais, a regra √©: <strong>V√≠rgula embaixo de V√≠rgula!</strong></p>

[WIDGET:interactive_decimal_add_sub]
`,

            "Multiplica√ß√£o de Decimais (Natural x Decimal e Decimal x Decimal)": `
<h3>Multiplica√ß√£o: O Esconde-Esconde üôà</h3>
<ol class="list-decimal list-inside space-y-2 mt-4 bg-white p-4 rounded-xl border border-gray-200 text-sm">
<li><strong>Esconda a v√≠rgula:</strong> Multiplique como se fossem naturais.</li>
<li><strong>Conte as casas:</strong> Quantos n√∫meros haviam depois da v√≠rgula no total?</li>
<li><strong>Devolva no final:</strong> O resultado precisa ter o mesmo n√∫mero total de casas.</li>
</ol>

[WIDGET:interactive_decimal_mult]
`,

            "Divis√£o com Decimais (Igualar casas e eliminar v√≠rgula)": `
            <h3>1. A Fobia da V√≠rgula üò±</h3>
            <p>Ningu√©m gosta de dividir com v√≠rgula. A boa not√≠cia √©: <strong>Voc√™ n√£o precisa!</strong></p>
            <p>Existe um truque matem√°tico legalizado: Se voc√™ multiplicar o dividendo e o divisor pelo mesmo n√∫mero (10, 100, 1000...), o resultado da divis√£o n√£o muda, mas a v√≠rgula some.</p>

            <div class="bg-white p-4 rounded-xl border-2 border-brand-purple my-4 shadow-sm">
                <h4 class="font-bold text-brand-purple mb-2">O Algoritmo de 3 Passos:</h4>
                <ol class="list-decimal list-inside text-sm text-gray-700 space-y-2">
                    <li><strong>Conte</strong> quem tem mais casas decimais.</li>
                    <li><strong>Iguale</strong> as casas do outro n√∫mero adicionando ZEROS.</li>
                    <li><strong>Corte</strong> a v√≠rgula dos dois e divida como se fossem naturais!</li>
                </ol>
            </div>

            <p>Pratique essa t√©cnica no equalizador abaixo:</p>

            [WIDGET:interactive_division_equalizer]
        `,

            "Divis√£o de Natural com Quociente Decimal": `
            <h3>1. Quando a Conta N√£o Fecha üö™</h3>
            <p>Antigamente, quando sobrava resto, a conta acabava. Agora, n√≥s somos teimosos! Queremos dividir at√© o fim.</p>
            
            <p>Exemplo: Dividir <strong>R$ 5,00</strong> para <strong>2 pessoas</strong>.</p>
            
            <div class="flex justify-center items-center gap-4 my-6 font-mono text-xl">
                <div class="text-center">
                    <div class="font-bold text-brand-text">5</div>
                    <div class="text-gray-400 text-xs">Sobrou 1</div>
                </div>
                <div class="text-3xl text-gray-300">‚ûú</div>
                <div class="text-center bg-gray-100 p-2 rounded">
                    <span class="text-sm font-sans font-bold text-brand-blue block mb-1">A Regra da Troca</span>
                    <p class="text-base">Troco 1 unidade por <strong>10 d√©cimos</strong>.</p>
                    <p class="text-xs text-gray-500">(Coloco a v√≠rgula na resposta e um zero no resto)</p>
                </div>
            </div>

            <p>Agora temos 10 d√©cimos para dividir por 2, que d√° 5 d√©cimos. Resultado: <strong>2,5</strong>.</p>
        `,

            "Sistema Monet√°rio Brasileiro: Problemas de troco e custo": `
            <h3>1. Matem√°tica no Bolso üí∞</h3>
            <p>Saber calcular troco √© quest√£o de sobreviv√™ncia! O nosso dinheiro (Real - R$) √© um sistema decimal. A parte inteira s√£o os Reais, e a parte decimal (cent√©simos) s√£o os Centavos.</p>

            <div class="grid grid-cols-2 gap-4 my-4">
                <div class="bg-green-50 p-3 rounded-lg border border-green-200 text-center">
                    <span class="text-2xl">üíµ</span>
                    <strong class="block text-green-800 text-sm mt-1">Parte Inteira</strong>
                    <span class="text-xs text-gray-500">Notas e Moeda de 1 real</span>
                </div>
                <div class="bg-orange-50 p-3 rounded-lg border border-orange-200 text-center">
                    <span class="text-2xl">ü™ô</span>
                    <strong class="block text-orange-800 text-sm mt-1">Parte Decimal</strong>
                    <span class="text-xs text-gray-500">Moedas (0,05 a 0,50)</span>
                </div>
            </div>

            <h3>2. O Desafio do Caixa üè™</h3>
            <p>Voc√™ √© o operador de caixa hoje. O cliente pagou e voc√™ precisa devolver o troco exato usando o menor n√∫mero de notas poss√≠vel. N√£o erre, ou o patr√£o desconta do seu sal√°rio!</p>

            [WIDGET:interactive_cash_register]
        `,

            // =======================================================
            // UNIDADE 10: FORMAS GEOM√âTRICAS
            // =======================================================

            "Pol√≠gonos: Elementos (Lado, V√©rtice, √Çngulo interno) e Nomenclatura": `
<h3>Pol√≠gonos: O Clube VIP üé©</h3>
<p>Para ser um Pol√≠gono, a figura precisa ser fechada e feita apenas de retas que n√£o se cruzam.</p>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-4">
<div class="bg-green-50 p-4 rounded-xl border-2 border-green-200">
<h4 class="font-bold text-brand-green">Convexo</h4>
<p class="text-xs text-gray-600 mt-1">Todos os bicos apontam para fora.</p>
</div>
<div class="bg-purple-50 p-4 rounded-xl border-2 border-purple-200">
<h4 class="font-bold text-brand-purple">C√¥ncavo</h4>
<p class="text-xs text-gray-600 mt-1">Tem uma "caverna" ou entrada (parece mordido).</p>
</div>
</div>

[WIDGET:interactive_poly_types]
`,

            "Tri√¢ngulos: Classifica√ß√£o quanto aos Lados e √Çngulos": `
    <h3>1. O Cl√£ dos Tr√™s Lados üî∫</h3>
    <p>O tri√¢ngulo √© a forma mais r√≠gida e forte da natureza. Mas nem todos s√£o iguais. Eles t√™m "sobrenomes" baseados em suas caracter√≠sticas.</p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
        <div class="bg-blue-50 p-4 rounded-xl border-t-4 border-brand-blue shadow-sm">
            <h4 class="font-bold text-brand-blue mb-2"><i class="fas fa-ruler"></i> Pelos Lados (Pernas)</h4>
            <ul class="text-sm text-gray-700 space-y-2">
                <li><strong>Equil√°tero:</strong> O Perfeito. 3 lados iguais (e 3 √¢ngulos de 60¬∞).</li>
                <li><strong>Is√≥sceles:</strong> O Sim√©trico. 2 lados iguais (como um chap√©u de festa).</li>
                <li><strong>Escaleno:</strong> O Diferent√£o. 3 lados diferentes (totalmente torto).</li>
            </ul>
        </div>

        <div class="bg-orange-50 p-4 rounded-xl border-t-4 border-brand-orange shadow-sm">
            <h4 class="font-bold text-brand-orange mb-2"><i class="fas fa-drafting-compass"></i> Pelos √Çngulos (Abertura)</h4>
            <ul class="text-sm text-gray-700 space-y-2">
                <li><strong>Ret√¢ngulo:</strong> Tem um √¢ngulo de 90¬∞ (canto reto). √â o pai do Teorema de Pit√°goras.</li>
                <li><strong>Acut√¢ngulo:</strong> Todos os √¢ngulos s√£o agudos (fechados, < 90¬∞).</li>
                <li><strong>Obtus√¢ngulo:</strong> Tem um √¢ngulo obtuso (abert√£o, > 90¬∞).</li>
            </ul>
        </div>
    </div>

    <h3>2. Desafio da Separa√ß√£o üóëÔ∏è</h3>
    <p>As pe√ßas se misturaram na f√°brica! Sua miss√£o √© arrastar cada tri√¢ngulo para a caixa correta antes que a esteira pare.</p>

    [WIDGET:interactive_triangle_sorter]
`,

            "Quadril√°teros: Paralelogramos e Trap√©zios (Defini√ß√µes b√°sicas)": `
    <h3>1. A Fam√≠lia dos 4 Lados üü¶</h3>
    <p>Todo mundo que tem 4 lados √© um Quadril√°tero. Mas essa fam√≠lia se divide em dois times principais, dependendo de quantos pares de lados s√£o paralelos (como trilhos de trem).</p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
        <div class="bg-gray-50 p-4 rounded-xl border-l-4 border-gray-400">
            <strong class="text-gray-700 block mb-2">üöÇ Trap√©zios (1 Par Paralelo)</strong>
            <p class="text-sm text-gray-600">Eles t√™m apenas um par de lados paralelos (as bases). O outro par se cruzaria se fosse esticado.</p>
            <div class="flex justify-center mt-2">
                 <svg width="60" height="40" class="fill-gray-300"><path d="M10,35 L50,35 L40,5 L20,5 Z"/></svg>
            </div>
        </div>
        
        <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue">
            <strong class="text-brand-blue block mb-2">üöÜ Paralelogramos (2 Pares Paralelos)</strong>
            <p class="text-sm text-gray-600">S√£o mais organizados. O lado de cima √© paralelo ao de baixo, e o da esquerda √© paralelo ao da direita.</p>
            <div class="flex justify-center mt-2">
                 <svg width="60" height="40" class="fill-brand-blue opacity-50"><path d="M10,35 L50,35 L60,5 L20,5 Z"/></svg>
            </div>
        </div>
    </div>

    <h3>2. √Årvore Geneal√≥gica üå≥</h3>
    <p>Dentro dos Paralelogramos, temos os "Nobres":</p>
    <ul class="list-disc list-inside text-sm text-gray-700 bg-white p-4 rounded-xl border border-gray-200">
        <li><strong>Ret√¢ngulo:</strong> Tem 4 √¢ngulos retos (90¬∞).</li>
        <li><strong>Losango:</strong> Tem 4 lados iguais.</li>
        <li><strong>Quadrado:</strong> √â o rei! Tem 4 √¢ngulos retos E 4 lados iguais.</li>
    </ul>

    <h3>3. Laborat√≥rio de Formas üõ†Ô∏è</h3>
    <p>Arraste os v√©rtices para transformar um quadrado em um losango, trap√©zio ou uma forma maluca qualquer!</p>

    [WIDGET:interactive_quad_lab]
`,

            "S√≥lidos Geom√©tricos: Poliedros (Prismas/Pir√¢mides) vs Corpos Redondos": `
<h3>O Grande Duelo: Quem Rola? üé≥</h3>
<p>Dividimos os s√≥lidos em dois times. O crit√©rio √© o "Teste da Ladeira".</p>

<ul class="list-none space-y-2 text-sm text-gray-700 my-4">
<li>üõë <strong>Poliedros:</strong> N√£o rolam. T√™m faces planas. (Ex: Caixas, Dados).</li>
<li>üåÄ <strong>Corpos Redondos:</strong> Rolam. T√™m curvas. (Ex: Bolas, Latas).</li>
</ul>

<div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 text-center">
<div class="font-mono font-black text-brand-text mb-2">Rela√ß√£o de Euler</div>
V + F = A + 2
<p class="text-xs text-gray-500 mt-1">"Vamos Fazer Amor a Dois"</p>
</div>

[WIDGET:interactive_solids_viewer]
`,

            "Planifica√ß√£o de S√≥lidos": `
    <h3>1. Descascando a Matem√°tica üì¶</h3>
    <p>Imagine que voc√™ tem uma caixa de papel√£o e quer abri-la para que fique totalmente plana no ch√£o. Isso √© <strong>Planifica√ß√£o</strong>.</p>
    <p>Todo s√≥lido geom√©trico (3D) √© feito de faces planas (2D) costuradas pelas arestas.</p>

    <h3>2. O Segredo do Cubo üé≤</h3>
    <p>O cubo tem 6 faces quadradas. Existem 11 formas diferentes de desenhar a planifica√ß√£o de um cubo (a cruz √© a mais famosa).</p>

    <div class="bg-gray-800 p-6 rounded-xl text-center shadow-lg my-6">
        <h4 class="text-white font-bold mb-4 uppercase text-xs tracking-widest">Simulador de Abertura</h4>
        [WIDGET:interactive_solid_unfolder]
        <p class="text-gray-400 text-xs mt-4">Arraste o slider para abrir ou fechar a caixa!</p>
    </div>

    <h3>3. Desafio Mental üß†</h3>
    <p>Se voc√™ fechar a planifica√ß√£o abaixo, qual face ficar√° oposta √† face azul? Tente visualizar na sua mente!</p>
    <div class="flex justify-center my-4">
        <div class="grid grid-cols-4 gap-1 w-32">
            <div></div><div class="w-6 h-6 bg-blue-500 border border-white"></div><div></div><div></div>
            <div class="w-6 h-6 bg-gray-300 border border-white"></div><div class="w-6 h-6 bg-gray-300 border border-white"></div><div class="w-6 h-6 bg-gray-300 border border-white"></div><div class="w-6 h-6 bg-red-500 border border-white"></div>
            <div></div><div class="w-6 h-6 bg-gray-300 border border-white"></div><div></div><div></div>
        </div>
    </div>
    <p class="text-center text-xs text-gray-500 italic">(Resposta: A face vermelha!)</p>
`,

            "Vistas Ortogonais (Frente, Superior e Lateral)": `
    <h3>1. O Olhar do Drone e do Arquiteto üèóÔ∏è</h3>
    <p>Para construir um pr√©dio ou uma pe√ßa de motor, n√£o podemos desenhar em 3D (pode confundir). Desenhamos as <strong>Vistas</strong> separadas.</p>
    
    <div class="flex justify-around text-center my-6 text-sm font-bold text-gray-600">
        <div class="bg-blue-50 p-3 rounded-lg border-b-4 border-brand-blue w-24">
            üëÅÔ∏è<br>Frente<br>(Frontal)
        </div>
        <div class="bg-green-50 p-3 rounded-lg border-b-4 border-brand-green w-24">
            üöÅ<br>Cima<br>(Superior)
        </div>
        <div class="bg-orange-50 p-3 rounded-lg border-b-4 border-brand-orange w-24">
            üëâ<br>Lado<br>(Lateral)
        </div>
    </div>

    <h3>2. Treino de Visualiza√ß√£o üëì</h3>
    <p>Observe a pe√ßa amarela abaixo. Tente imaginar como ela fica se voc√™ olhar de cima (como um drone) ou de frente.</p>
    <p>Selecione a vista correta no jogo para provar que voc√™ tem vis√£o espacial!</p>

    [WIDGET:interactive_view_matcher]
`,

            "Malhas Quadriculadas: Localiza√ß√£o (Pares Ordenados)": `
    <h3>1. O Mapa do Tesouro üó∫Ô∏è</h3>
    <p>Para encontrar qualquer coisa em um mapa, precisamos de dois n√∫meros: um para andar de lado (Horizontal) e outro para subir (Vertical).</p>
    <p>Chamamos isso de <strong>Par Ordenado</strong>: $(x, y)$.</p>
    
    <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-center">
        <strong class="text-xl font-mono text-brand-text">(3, 5)</strong>
        <div class="flex justify-center gap-8 mt-2 text-xs font-bold text-gray-500 uppercase">
            <span>1¬∫: Corra 3</span>
            <span>2¬∫: Pule 5</span>
        </div>
        <p class="mt-2 text-sm">A ordem importa! (3, 5) √© diferente de (5, 3).</p>
    </div>

    <h3>2. Pixel Art: Desenhando com N√∫meros üé®</h3>
    <p>Os computadores usam pares ordenados para desenhar na tela. Cada ponto √© um pixel.</p>
    <p><strong>Desafio:</strong> Pinte os pixels nas coordenadas corretas para revelar o desenho secreto!</p>

    [WIDGET:interactive_coordinate_artist]
`,

            "Transforma√ß√µes na Malha: Amplia√ß√£o e Redu√ß√£o (Homotetia intuitiva)": `
    <h3>1. A M√°quina de Xerox üì†</h3>
    <p>Ampliar uma figura na malha quadriculada √© f√°cil: basta multiplicar o tamanho de <strong>TODOS</strong> os lados pelo mesmo n√∫mero.</p>
    <p>Se voc√™ dobrar a largura mas esquecer da altura, a figura fica "gorda" e distorcida. Para manter a forma (semelhan√ßa), tudo tem que crescer junto.</p>

    [WIDGET:interactive_grid_scaler] `,

            "Transforma√ß√µes na Malha: Simetria de Reflex√£o": `
    <h3>1. O Mundo do Espelho ü™û</h3>
    <p>A Simetria de Reflex√£o acontece quando uma figura √© "copiada" para o outro lado de uma linha (o eixo de simetria), mas invertida.</p>
    <p>A regra √©: se um ponto est√° a 2 quadradinhos da linha, seu reflexo tamb√©m deve estar a 2 quadradinhos, do outro lado.</p>

    <h3>2. Desafio do Pintor Sim√©trico üñåÔ∏è</h3>
    <p>Pinte no lado esquerdo e veja o reflexo aparecer magicamente na direita. Tente desenhar um rosto!</p>

    [WIDGET:interactive_reflection_painter]
`,

            // =======================================================
            // UNIDADE 11: INTRODU√á√ÉO √Ä √ÅLGEBRA
            // =======================================================
            "Sequ√™ncias Repetitivas e Recursivas (Figurais e Num√©ricas)": `
<h3>A Balan√ßa da Igualdade ‚öñÔ∏è</h3>
<p>Na √°lgebra, o sinal de igual ($=$) n√£o √© um bot√£o de resultado. Ele significa que os dois lados pesam a mesma coisa.</p>
<p>Se voc√™ tira algo de um lado, tem que tirar do outro para manter o equil√≠brio.</p>

[WIDGET:interactive_equality_balance]
`,

            "Identifica√ß√£o de Padr√µes e Regularidades": `
            <h3>1. O Detetive de Padr√µes üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
            <p>Voc√™ sabia que a matem√°tica √© a ci√™ncia dos padr√µes? Antes de usarmos n√∫meros ou letras, n√≥s observamos o mundo. As esta√ß√µes do ano, as fases da lua, os azulejos da parede... tudo segue uma regra!</p>
            
            <p>Se voc√™ consegue descobrir a regra, voc√™ consegue <strong>prever o futuro</strong> da sequ√™ncia.</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4">
                <strong>Exemplo Visual:</strong>
                <br>üü¶ üî¥ üü¶ üî¥ üü¶ ... 
                <br>Qual √© o pr√≥ximo? <strong>üî¥ (Vermelho)</strong>, claro!
            </div>

            <h3>2. Sequ√™ncias Num√©ricas üî¢</h3>
            <p>Com n√∫meros √© a mesma coisa. Olhe para esta fila: <strong>2, 4, 6, 8...</strong></p>
            <p>Qual a regra? "Somar 2 ao anterior". Logo, o pr√≥ximo √© 10.</p>

            <h3>3. Desafio dos Padr√µes üß©</h3>
            <p>Analise a sequ√™ncia, descubra a "lei" secreta e arraste o pr√≥ximo item correto para completar.</p>

            [WIDGET:interactive_pattern_sequencer]
        `,

            "A Vari√°vel: A Letra como N√∫mero Desconhecido": `
            <h3>1. A Caixa Misteriosa üì¶</h3>
            <p>Imagine que voc√™ tem uma caixa fechada com bombons dentro. Voc√™ n√£o sabe quantos bombons t√™m l√°, ent√£o voc√™ escreve um r√≥tulo na caixa: <strong>"X"</strong>.</p>
            <p>Na matem√°tica, a letra (vari√°vel) √© exatamente isso: uma caixa (um lugar) que guarda um n√∫mero que a gente ainda n√£o sabe, ou que pode mudar.</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 text-center my-4">
                <span class="text-4xl">üì¶ = x</span>
                <p class="text-sm text-gray-600 mt-2">"X" n√£o √© uma letra de ler. √â um c√≥digo para "N√∫mero Escondido".</p>
            </div>

            <h3>2. A M√°quina de Transformar ‚öôÔ∏è</h3>
            <p>As vari√°veis adoram entrar em m√°quinas matem√°ticas (fun√ß√µes). Se a m√°quina diz <strong>"x + 2"</strong>, significa: "Pegue o que estiver na caixa X e some 2".</p>
            <p>Teste a m√°quina abaixo. Mude o valor de X e veja o resultado (Y) mudar automaticamente!</p>

            [WIDGET:interactive_variable_machine]

            <h3>3. Por que usamos letras? ü§î</h3>
            <p>Porque √© mais f√°cil escrever $2x$ do que "Duas vezes a quantidade misteriosa que est√° dentro da caixa". √â uma abrevia√ß√£o inteligente!</p>
        `,

            "Senten√ßas Matem√°ticas e o Conceito de Igualdade (Equil√≠brio)": `
            <h3>1. A Matem√°tica √© uma Linguagem üó£Ô∏è</h3>
            <p>Assim como no portugu√™s escrevemos frases ("O c√©u √© azul"), na matem√°tica escrevemos senten√ßas ("$2 + 3 = 5$").</p>
            <p>As senten√ßas podem ser:</p>
            <ul class="list-disc list-inside text-sm text-gray-700 bg-white p-4 rounded-xl border border-gray-200 mb-4">
                <li><strong>Verdadeiras:</strong> $5 + 5 = 10$ (Sim!)</li>
                <li><strong>Falsas:</strong> $2 + 2 = 5$ (Mentira!)</li>
                <li><strong>Abertas:</strong> $x + 2 = 5$ (Depende... quem √© x?)</li>
            </ul>

            <h3>2. O Princ√≠pio da Balan√ßa ‚öñÔ∏è</h3>
            <p>O sinal de igual ($=$) √© o centro de uma balan√ßa. Para ela ficar parada, o peso do lado esquerdo tem que ser <strong>id√™ntico</strong> ao do lado direito.</p>
            <p>Se voc√™ colocar um peso extra na esquerda, a balan√ßa desequilibra. Para arrumar, voc√™ precisa colocar o mesmo peso na direita.</p>

            <h3>3. Desafio do Equil√≠brio üèãÔ∏è</h3>
            <p>Descubra qual peso est√° faltando para a balan√ßa ficar reta!</p>

            [WIDGET:interactive_simple_balance]
        `,

            "C√°lculo do Valor Desconhecido (Opera√ß√£o Inversa)": `
<h3>A Chave Mestra: Opera√ß√£o Inversa üóùÔ∏è</h3>
<p>Para descobrir o valor do $x$, precisamos deix√°-lo sozinho. Usamos a opera√ß√£o contr√°ria para "desgrudar" os n√∫meros dele.</p>

<div class="grid grid-cols-2 gap-4 my-4 text-center font-bold text-white text-xs">
<div class="bg-brand-green p-2 rounded shadow-sm">+ Vira -</div>
<div class="bg-brand-red p-2 rounded shadow-sm">- Vira +</div>
<div class="bg-brand-purple p-2 rounded shadow-sm">√ó Vira √∑</div>
<div class="bg-brand-orange p-2 rounded shadow-sm">√∑ Vira √ó</div>
</div>

[WIDGET:interactive_equation_steps]
`,

            "Generaliza√ß√£o Simples (Ex: Dobro de um n√∫mero mais 5)": `
            <h3>1. Tradutor Universal üåç‚ûúüìê</h3>
            <p>A matem√°tica √© uma l√≠ngua universal. Se voc√™ escreve $2x + 1$, um japon√™s, um americano e um brasileiro entendem a mesma coisa.</p>
            <p>Aprender √°lgebra √© aprender a traduzir do "Portugu√™s" para o "Matematiqu√™s".</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                    <strong class="block text-gray-500 text-xs uppercase mb-1">Portugu√™s</strong>
                    <p class="font-medium">"O dobro de um n√∫mero"</p>
                </div>
                <div class="bg-blue-50 p-4 rounded-xl border border-brand-blue">
                    <strong class="block text-blue-500 text-xs uppercase mb-1">Matematiqu√™s</strong>
                    <p class="font-mono font-bold text-xl text-brand-blue">2x</p>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                    <strong class="block text-gray-500 text-xs uppercase mb-1">Portugu√™s</strong>
                    <p class="font-medium">"Um n√∫mero mais 5"</p>
                </div>
                <div class="bg-blue-50 p-4 rounded-xl border border-brand-blue">
                    <strong class="block text-blue-500 text-xs uppercase mb-1">Matematiqu√™s</strong>
                    <p class="font-mono font-bold text-xl text-brand-blue">x + 5</p>
                </div>
            </div>

            <h3>2. Desafio da Tradu√ß√£o üó£Ô∏è</h3>
            <p>Eu falo a frase, voc√™ escolhe a express√£o alg√©brica correta. Cuidado com as pegadinhas!</p>

            [WIDGET:interactive_algebra_translation_challenge]
        `,

            // =======================================================
            // UNIDADE 12: GRANDEZAS E ESTAT√çSTICA
            // =======================================================

            "Medidas de Comprimento (Unidades e Convers√µes lineares)": `
            <h3>1. O Mundo em Linha Reta üìè</h3>
            <p>Comprimento √© a dist√¢ncia entre dois pontos. √â uma medida de <strong>1 Dimens√£o</strong> (s√≥ tem tamanho, n√£o tem largura nem altura).</p>
            <p>A unidade principal √© o <strong>Metro (m)</strong>. Mas nem tudo cabe no metro: para coisas muito pequenas usamos os <em>Subm√∫ltiplos</em> e para coisas grandes os <em>M√∫ltiplos</em>.</p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6 text-center">
                <div class="bg-blue-50 p-4 rounded-xl border-b-4 border-brand-blue shadow-sm group">
                    <div class="text-4xl mb-2 group-hover:scale-125 transition-transform">üêú</div>
                    <strong class="text-brand-blue block uppercase text-sm tracking-wider">Pequenos</strong>
                    <p class="text-xs text-gray-500 mt-1">Mil√≠metros (mm) e Cent√≠metros (cm).<br>Para l√°pis, telas e insetos.</p>
                </div>
                <div class="bg-green-50 p-4 rounded-xl border-b-4 border-brand-green shadow-sm transform scale-105 z-10 group">
                    <div class="text-4xl mb-2 group-hover:scale-125 transition-transform">üö∂</div>
                    <strong class="text-brand-green block uppercase text-sm tracking-wider">M√©dios (Base)</strong>
                    <p class="text-xs text-gray-500 mt-1">Metro (m).<br>Para alturas, casas e tecidos.</p>
                </div>
                <div class="bg-orange-50 p-4 rounded-xl border-b-4 border-brand-orange shadow-sm group">
                    <div class="text-4xl mb-2 group-hover:scale-125 transition-transform">üöó</div>
                    <strong class="text-brand-orange block uppercase text-sm tracking-wider">Grandes</strong>
                    <p class="text-xs text-gray-500 mt-1">Quil√¥metro (km).<br>Para estradas e viagens.</p>
                </div>
            </div>

            <h3>2. A Escada M√©trica (O Pulo da V√≠rgula) ü™ú</h3>
            <p>Como transformar km em m? Imagine uma escada. Cada degrau que voc√™ desce, voc√™ multiplica por 10 (ganha um zero ou a v√≠rgula anda para a direita). Cada degrau que sobe, divide por 10.</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm shadow-sm">
                <strong>Regra Ninja:</strong>
                <br>Descer a escada = N√∫mero aumenta (x10)
                <br>Subir a escada = N√∫mero diminui (√∑10)
            </div>

            <p>Brinque com a escada abaixo. Coloque um n√∫mero em qualquer degrau e veja ele se transformar!</p>

            [WIDGET:interactive_metric_staircase]

            <h3>3. Desafio do Engenheiro: A Ponte Quebrada üåâ</h3>
            <p>Precisamos consertar a ponte para o carro passar. O buraco tem um tamanho espec√≠fico, mas as pe√ßas na loja est√£o com unidades misturadas!</p>
            <p>Voc√™ consegue encontrar a pe√ßa equivalente?</p>

            [WIDGET:interactive_bridge_builder]
        `,

            "Conceito de Per√≠metro e √Årea (Contagem de quadradinhos e F√≥rmulas simples)": `
<h3>√Årea vs Per√≠metro üü•</h3>
<p><strong>Per√≠metro:</strong> √â a cerca. A soma de todos os lados (1D).<br>
<strong>√Årea:</strong> √â o gramado. O espa√ßo de dentro (2D).</p>

<div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow text-sm shadow-sm my-4">
<strong>A Regra do Quadrado:</strong><br>
Se voc√™ dobra o lado de um quadrado, a √°rea <strong>QUADRUPLICA</strong>!
</div>

[WIDGET:interactive_perimeter_area_explorer]
`,

            "Medidas de Massa (kg, g, mg, t)": `
            <h3>1. Massa ou Peso? üèãÔ∏è‚Äç‚ôÄÔ∏è</h3>
            <p>No dia a dia, a gente fala "Vou me pesar". Mas na ci√™ncia, o correto √© <strong>Massa</strong>! Massa √© a quantidade de mat√©ria que um corpo tem. O peso muda se voc√™ for para a Lua (menos gravidade), mas sua massa continua a mesma!</p>
            
            <p>A unidade base √© o <strong>Grama (g)</strong>. Para facilitar a vida, usamos prefixos para quantidades maiores ou menores.</p>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 my-6 text-center">
                <div class="bg-gray-50 p-3 rounded-xl border-b-4 border-gray-400 shadow-sm group hover:-translate-y-1 transition-all">
                    <div class="text-3xl mb-2">üíä</div>
                    <strong class="text-gray-600 block uppercase text-xs tracking-wider">Miligrama (mg)</strong>
                    <p class="text-[10px] text-gray-500 mt-1">Coisas min√∫sculas.<br>Rem√©dios, penas.</p>
                </div>
                
                <div class="bg-blue-50 p-3 rounded-xl border-b-4 border-brand-blue shadow-sm group hover:-translate-y-1 transition-all">
                    <div class="text-3xl mb-2">üçé</div>
                    <strong class="text-brand-blue block uppercase text-xs tracking-wider">Grama (g)</strong>
                    <p class="text-[10px] text-gray-500 mt-1">Base.<br>Frutas, celular.</p>
                </div>

                <div class="bg-orange-50 p-3 rounded-xl border-b-4 border-brand-orange shadow-sm group hover:-translate-y-1 transition-all">
                    <div class="text-3xl mb-2">üêà</div>
                    <strong class="text-brand-orange block uppercase text-xs tracking-wider">Quilograma (kg)</strong>
                    <p class="text-[10px] text-gray-500 mt-1">1.000 gramas.<br>Pessoas, sacos de arroz.</p>
                </div>

                <div class="bg-purple-50 p-3 rounded-xl border-b-4 border-brand-purple shadow-sm group hover:-translate-y-1 transition-all">
                    <div class="text-3xl mb-2">üêò</div>
                    <strong class="text-brand-purple block uppercase text-xs tracking-wider">Tonelada (t)</strong>
                    <p class="text-[10px] text-gray-500 mt-1">1.000 quilos.<br>Carros, caminh√µes.</p>
                </div>
            </div>

            <h3>2. A Regra do 1.000 (Convers√£o) üîÑ</h3>
            <p>Diferente do metro (que pula de 10 em 10), as unidades de massa mais usadas pulam de <strong>1.000 em 1.000</strong>.</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm shadow-sm flex flex-col gap-2">
                <div class="flex items-center gap-2">
                    <span class="font-bold text-brand-purple">1 t</span> 
                    <i class="fas fa-arrow-right text-gray-400"></i> 
                    <span class="font-bold text-brand-orange">1.000 kg</span>
                    <span class="text-xs text-gray-500">(Do Grande pro M√©dio: Multiplica)</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="font-bold text-brand-orange">1 kg</span> 
                    <i class="fas fa-arrow-right text-gray-400"></i> 
                    <span class="font-bold text-brand-blue">1.000 g</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="font-bold text-brand-blue">1 g</span> 
                    <i class="fas fa-arrow-right text-gray-400"></i> 
                    <span class="font-bold text-gray-600">1.000 mg</span>
                </div>
            </div>

            <p>Use a balan√ßa digital abaixo para pesar objetos diferentes e ver a convers√£o autom√°tica!</p>

            [WIDGET:interactive_mass_scale]

            <h3>3. Desafio: Equilibre a Balan√ßa ‚öñÔ∏è</h3>
            <p>Para vender no mercado antigo, usavam-se balan√ßas de dois pratos. O objetivo √© fazer os dois lados ficarem com a mesma massa.</p>
            <p><strong>Cuidado:</strong> Misturamos kg com g. Voc√™ precisa converter mentalmente!</p>

            [WIDGET:interactive_balance_game]
        `,

            "Medidas de Tempo (h, min, s) e Opera√ß√µes com tempo": `
<h3>1. O "Extraterrestre" Base 60 üëΩ</h3>
<p>Quase tudo na matem√°tica usa a Base 10 (contamos com os dedos). Mas o tempo √© rebelde! Ele usa a <strong>Base 60</strong> (Sistema Sexagesimal), uma heran√ßa dos antigos Babil√¥nios.</p>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6 text-center">
    <div class="bg-purple-50 p-4 rounded-xl border-b-4 border-brand-purple shadow-sm">
        <div class="text-4xl mb-2">‚è±Ô∏è</div>
        <strong class="text-brand-purple block text-sm">1 Minuto</strong>
        <p class="text-xs text-gray-500 font-bold mt-1">= 60 Segundos</p>
    </div>
    <div class="bg-blue-50 p-4 rounded-xl border-b-4 border-brand-blue shadow-sm scale-110 z-10">
        <div class="text-4xl mb-2">üï∞Ô∏è</div>
        <strong class="text-brand-blue block text-sm">1 Hora</strong>
        <p class="text-xs text-gray-500 font-bold mt-1">= 60 Minutos</p>
        <p class="text-[10px] text-gray-400">= 3.600 Segundos</p>
    </div>
    <div class="bg-orange-50 p-4 rounded-xl border-b-4 border-brand-orange shadow-sm">
        <div class="text-4xl mb-2">üìÖ</div>
        <strong class="text-brand-orange block text-sm">1 Dia</strong>
        <p class="text-xs text-gray-500 font-bold mt-1">= 24 Horas</p>
    </div>
</div>

<h3>2. A "M√°gica do Vai Um" no Tempo üé©</h3>
<p>Somar tempo n√£o √© igual somar dinheiro. Se voc√™ tem <strong>50 min + 20 min</strong>, o resultado n√£o √© "70 minutos" no rel√≥gio.</p>

<div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm shadow-sm">
    <strong>A Regra do 60:</strong><br>
    O rel√≥gio √© um balde que s√≥ aguenta at√© 59.
    <br>Chegou no 60? O balde transborda e vira <strong>+1</strong> na unidade maior (minuto vira hora).
</div>

<p>Veja a m√°gica acontecendo na calculadora de tempo abaixo. Tente somar valores que passem de 60!</p>

[WIDGET:interactive_time_calculator]

<h3>3. Subtra√ß√£o: O Pedido de Empr√©stimo üè¶</h3>
<p>Imagine que voc√™ quer fazer: <strong>3h 10min - 1h 40min</strong>.</p>
<p>Voc√™ n√£o pode tirar 40 de 10. Voc√™ precisa bater na porta da "Hora" e pedir emprestado.</p>
<p>‚ö†Ô∏è <strong>Cuidado:</strong> A hora empresta <strong>1</strong>, mas esse 1 vale <strong>60 minutos</strong> para voc√™!</p>

<h3>4. Desafio: O Viajante do Tempo ‚è≥</h3>
<p>Voc√™ √© um agente temporal. Para consertar a linha do tempo, voc√™ precisa calcular a dura√ß√£o exata das viagens ou a hora de chegada.</p>

[WIDGET:interactive_chronos_quest]
`,

            "Medidas de Volume (cm¬≥, dm¬≥, m¬≥)": `
<h3>O Mundo em 3D üßä</h3>
<p>Volume √© quanto espa√ßo um objeto ocupa. Calculamos multiplicando as tr√™s dimens√µes: $C \\times L \\times A$.</p>

[WIDGET:interactive_volume_cube]
`,

            "Tipos de Vari√°veis (Qualitativas e Quantitativas)": `
            <h3>1. O Que √© uma Vari√°vel? üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
            <p>Em estat√≠stica, quando fazemos uma pesquisa, as perguntas que fazemos s√£o chamadas de <strong>Vari√°veis</strong>. A resposta para essas perguntas pode variar de pessoa para pessoa (por isso o nome!).</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-6">
                
                <div class="bg-purple-50 p-6 rounded-2xl border-b-4 border-brand-purple shadow-sm hover:scale-105 transition-transform">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-full bg-brand-purple flex items-center justify-center text-white font-bold text-xl">A</div>
                        <h4 class="font-black text-brand-purple text-lg uppercase">Qualitativa</h4>
                    </div>
                    <p class="text-sm text-gray-700 font-bold mb-2">Expressa uma QUALIDADE.</p>
                    <p class="text-sm text-gray-600">A resposta √© uma <strong>palavra</strong> ou categoria. N√£o faz sentido fazer conta de "menos" ou "vezes" com ela.</p>
                    <div class="mt-3 flex flex-wrap gap-2">
                        <span class="px-2 py-1 bg-white border border-purple-200 rounded text-xs text-purple-700">Cor dos Olhos</span>
                        <span class="px-2 py-1 bg-white border border-purple-200 rounded text-xs text-purple-700">Esporte Favorito</span>
                    </div>
                </div>

                <div class="bg-orange-50 p-6 rounded-2xl border-b-4 border-brand-orange shadow-sm hover:scale-105 transition-transform">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-full bg-brand-orange flex items-center justify-center text-white font-bold text-xl">B</div>
                        <h4 class="font-black text-brand-orange text-lg uppercase">Quantitativa</h4>
                    </div>
                    <p class="text-sm text-gray-700 font-bold mb-2">Expressa uma QUANTIDADE.</p>
                    <p class="text-sm text-gray-600">A resposta √© um <strong>n√∫mero</strong>. Podemos ordenar, somar e tirar m√©dias.</p>
                    <div class="mt-3 flex flex-wrap gap-2">
                        <span class="px-2 py-1 bg-white border border-orange-200 rounded text-xs text-orange-700">Altura</span>
                        <span class="px-2 py-1 bg-white border border-orange-200 rounded text-xs text-orange-700">N√∫mero de Irm√£os</span>
                    </div>
                </div>

            </div>

            <h3>2. Analisando um Perfil üÜî</h3>
            <p>Imagine a ficha de um personagem de RPG ou o perfil de uma rede social. Cada dado ali √© um tipo de vari√°vel.</p>
            <p>Clique nos campos do cart√£o abaixo para descobrir se s√£o Qualitativas ou Quantitativas:</p>

            [WIDGET:interactive_variable_inspector]

            <h3>3. O Detalhe: Ordinal vs Nominal üìè</h3>
            <p>Dentro das <strong>Qualitativas</strong> (Palavras), existe uma diferen√ßa importante:</p>
            <ul class="list-none space-y-2 mt-2 bg-white p-4 rounded-xl border-2 border-gray-100">
                <li class="flex items-start gap-3">
                    <span class="text-2xl">üìõ</span>
                    <div>
                        <strong class="text-brand-text">Nominal (Nomes):</strong> N√£o existe ordem. <br>
                        <em class="text-xs text-gray-500">Ex: Cor (Azul n√£o √© "maior" que Vermelho), Bairro, Animal de estima√ß√£o.</em>
                    </div>
                </li>
                <li class="flex items-start gap-3 border-t border-gray-100 pt-2">
                    <span class="text-2xl">ü•á</span>
                    <div>
                        <strong class="text-brand-text">Ordinal (Ordem):</strong> Existe uma hierarquia.<br>
                        <em class="text-xs text-gray-500">Ex: Medalhas (Ouro, Prata, Bronze), Tamanho de Roupa (P, M, G), Escolaridade.</em>
                    </div>
                </li>
            </ul>

            <h3>4. O Detalhe: Discreta vs Cont√≠nua üî¢</h3>
            <p>Dentro das <strong>Quantitativas</strong> (N√∫meros), tamb√©m temos dois times:</p>
            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm">
                <strong>Dica Ninja:</strong> Tente usar v√≠rgula.
                <ul class="list-disc list-inside mt-2">
                    <li><strong>Discreta (Contagem):</strong> N√∫meros inteiros. N√£o d√° pra ter "2,5 irm√£os". (D√° saltos).</li>
                    <li><strong>Cont√≠nua (Medida):</strong> Aceita v√≠rgula. Altura (1,75m), Peso (60,5kg). (Flui direto).</li>
                </ul>
            </div>

            <h3>5. Desafio: O Separador de Dados ‚ôªÔ∏è</h3>
            <p>Voc√™ trabalha no Departamento de Estat√≠stica. Os dados est√£o chegando misturados na esteira. Separe-os r√°pido!</p>

            [WIDGET:interactive_data_sorter]
        `,

            "Tabelas de Frequ√™ncia": `
<h3>1. O Caos vs. A Ordem üå™Ô∏è‚û°Ô∏èüìä</h3>
<p>Imagine que voc√™ perguntou para a sua turma qual √© o sabor de pizza favorito deles e anotou tudo r√°pido num papel:</p>
<div class="bg-gray-100 p-3 rounded-lg font-mono text-xs text-gray-500 mb-4 border border-gray-300">
Mussarela, Calabresa, Mussarela, Frango, Calabresa, Calabresa, Mussarela, Frango, Mussarela...
</div>
<p>Ler essa lista cansa, n√©? √â a√≠ que entra a <strong>Tabela de Frequ√™ncia</strong>. Ela serve para organizar dados bagun√ßados.</p>

<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm">
<h4 class="font-bold text-brand-blue mb-2">üîç O Vocabul√°rio do Estat√≠stico</h4>
<ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
<li><strong>Vari√°vel:</strong> O que estamos pesquisando (Ex: Sabor da Pizza).</li>
<li><strong>Frequ√™ncia (Absoluta):</strong> Quantas vezes aquela resposta apareceu. √â a contagem pura.</li>
<li><strong>Tabela:</strong> O quadro onde guardamos isso tudo.</li>
</ul>
</div>

<h3>2. A T√©cnica dos Tracinhos (Tally) üß±</h3>
<p>Antes de colocar o n√∫mero final, costumamos usar tracinhos para n√£o perder a conta enquanto os dados chegam. A cada 5 votos, fechamos um "pacotinho".</p>

<p>Veja como a m√°gica da organiza√ß√£o acontece. Clique nos itens bagun√ßados para organiz√°-los na tabela:</p>

[WIDGET:interactive_tally_sorter]

<h3>3. Desafio: O Pesquisador √Ågil üìã</h3>
<p>Voc√™ foi contratado para fazer uma pesquisa na sa√≠da do cinema. As pessoas v√£o passar r√°pido e dar a opini√£o delas. Voc√™ consegue registrar tudo na tabela sem perder a conta?</p>

[WIDGET:interactive_survey_game]
`,

            "Gr√°ficos de Colunas e Barras (Constru√ß√£o e Leitura)": `
<h3>Uma Imagem vale mil N√∫meros üìä</h3>
<p>Gr√°ficos contam hist√≥rias. O de colunas √© √≥timo para comparar quantidades ("Quem ganhou?").</p>

[WIDGET:interactive_charts_demo]
`,

            "Gr√°ficos Pict√≥ricos": `
<h3>1. Quando a Matem√°tica vira Arte üé®</h3>
<p>Os <strong>Gr√°ficos Pict√≥ricos</strong> (ou Pictogramas) s√£o os gr√°ficos mais divertidos! Em vez de usar barras ou linhas chatas, eles usam <strong>desenhos</strong> (√≠cones) para representar os n√∫meros.</p>

<div class="flex justify-center gap-4 my-6">
    <div class="text-center">
        <span class="text-4xl">üçéüçéüçé</span>
        <p class="text-xs text-gray-500 font-bold mt-1">3 Ma√ß√£s</p>
    </div>
    <div class="text-2xl text-gray-300">vs</div>
    <div class="text-center">
        <div class="w-8 h-16 bg-blue-200 border border-blue-400 mx-auto"></div>
        <p class="text-xs text-gray-500 font-bold mt-1">Barra</p>
    </div>
</div>

<p>Eles s√£o √≥timos para comparar quantidades rapidamente, mas exigem aten√ß√£o de detetive para n√£o cair em armadilhas!</p>

<h3>2. A Chave Secreta (Legenda) üóùÔ∏è</h3>
<p>O segredo de todo pictograma √© a <strong>Legenda</strong>. Nem sempre um desenho vale 1 unidade!</p>

<div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm shadow-sm">
    <h4 class="font-bold text-yellow-900 mb-2">‚ö†Ô∏è Cuidado com a Escala!</h4>
    <p>Um desenho de um carro üöó pode representar <strong>100 carros</strong> vendidos. Se voc√™ vir 3 desenhos, n√£o s√£o 3 carros, s√£o 300!</p>
</div>

<p>Use o laborat√≥rio abaixo para entender como a legenda muda tudo:</p>

[WIDGET:interactive_pictogram_legend]

<h3>3. Fra√ß√µes no Desenho üç∞</h3>
<p>E se aparecer apenas <strong>metade</strong> de um desenho? Significa que temos metade do valor da legenda.</p>
<ul class="list-disc list-inside bg-white p-4 rounded-xl border border-gray-200 text-sm text-gray-600 space-y-2 mb-6">
    <li>Se üç™ = 10 biscoitos...</li>
    <li>Ent√£o meia üç™ = 5 biscoitos!</li>
</ul>

<h3>4. Desafio da Colheita üöú</h3>
<p>A fazenda MathFarm precisa da sua ajuda para contar a produ√ß√£o. Olhe os desenhos, verifique a legenda e calcule o total correto.</p>

[WIDGET:interactive_pictogram_harvest]
`,

            //
            // S√âTIMO ANO
            //

            // =================================================================
            // CONTE√öDO 7¬∫ ANO
            // =================================================================

            // =======================================================
            // UNIDADE 1: N√∫meros Inteiros (Z) - O Conjunto
            // =======================================================

            "N√∫meros Negativos no Cotidiano (Temperatura, Saldo, Altitude)": `
            <h3>1. Al√©m do Zero ‚ùÑÔ∏è</h3>
            <p>At√© agora, o zero era o "nada". Mas e se voc√™ dever dinheiro ao banco? E se estiver mergulhando no mar? E se a temperatura cair abaixo de zero?</p>
            <p>Para isso, criamos os <strong>N√∫meros Negativos</strong>. Eles representam falta, profundidade ou d√≠vida. O conjunto de todos eles (positivos, negativos e o zero) chama-se <strong>N√∫meros Inteiros ($\\mathbb{Z}$)</strong>.</p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6 text-center">
                <div class="bg-red-50 p-4 rounded-xl border-t-4 border-brand-red shadow-sm hover:scale-105 transition-transform">
                    <div class="text-4xl mb-2">ü•∂</div>
                    <strong class="text-brand-red block uppercase text-sm tracking-wider">Temperatura</strong>
                    <p class="text-xs text-gray-600 mt-1">Abaixo de zero √© negativo.<br>-5¬∞C √© muito frio!</p>
                </div>
                <div class="bg-blue-50 p-4 rounded-xl border-t-4 border-brand-blue shadow-sm hover:scale-105 transition-transform">
                    <div class="text-4xl mb-2">üåä</div>
                    <strong class="text-brand-blue block uppercase text-sm tracking-wider">Altitude</strong>
                    <p class="text-xs text-gray-600 mt-1">O n√≠vel do mar √© 0.<br>Mergulhadores v√£o para o negativo.</p>
                </div>
                <div class="bg-green-50 p-4 rounded-xl border-t-4 border-brand-green shadow-sm hover:scale-105 transition-transform">
                    <div class="text-4xl mb-2">üí∏</div>
                    <strong class="text-brand-green block uppercase text-sm tracking-wider">Saldo</strong>
                    <p class="text-xs text-gray-600 mt-1">Dinheiro na conta (+) vs D√≠vida (-).<br>Devendo R$ 10 = -10.</p>
                </div>
            </div>

            <h3>2. O Elevador do Mundo üè¢</h3>
            <p>Imagine um pr√©dio onde o T√©rreo √© o Zero. Os andares para cima s√£o positivos. Os subsolos (garagem) s√£o negativos.</p>
            
            [WIDGET:interactive_context_scroller]
        `,

            "A Reta Num√©rica Inteira e a Simetria em rela√ß√£o ao Zero": `
            <h3>1. O Espelho M√°gico ü™û</h3>
            <p>A Reta Num√©rica agora cresce para os dois lados! O Zero √© o centro do universo (a origem). Para a direita, tudo √© igual ao que voc√™ j√° conhece. Para a esquerda, √© um <strong>Mundo Espelhado</strong>.</p>

            <div class="bg-gray-800 text-white p-4 rounded-xl text-center my-6 shadow-lg border-b-4 border-gray-900">
                <div class="flex justify-between items-center text-xs uppercase font-bold text-gray-400 mb-2 px-4">
                    <span>Negativos (Esquerda)</span>
                    <span>Origem</span>
                    <span>Positivos (Direita)</span>
                </div>
                <div class="text-2xl md:text-3xl font-mono tracking-widest text-brand-yellow">
                    ... -3, -2, -1, <span class="text-white text-4xl">0</span>, +1, +2, +3 ...
                </div>
            </div>

            <h3>2. Caminhando na Reta üö∂‚Äç‚ôÇÔ∏è</h3>
            <p>Observe que o n√∫mero -3 est√° √† mesma dist√¢ncia do zero que o +3. Eles s√£o reflexos um do outro.</p>

            [WIDGET:interactive_mirror_walk]
        `,

            "M√≥dulo ou Valor Absoluto": `
            <h3>1. O GPS da Matem√°tica üìç</h3>
            <p>Imagine que voc√™ andou 5 passos para frente (+5). Voc√™ cansou? Sim.</p>
            <p>Agora imagine que voc√™ andou 5 passos para tr√°s (-5). Voc√™ cansou menos? N√£o! Voc√™ andou a <strong>mesma dist√¢ncia</strong>.</p>
            
            <div class="bg-blue-50 p-6 rounded-xl border-l-4 border-brand-blue my-6 shadow-sm">
                <h4 class="font-bold text-brand-blue mb-2">Defini√ß√£o de M√≥dulo:</h4>
                <p class="text-gray-700 text-sm">O <strong>M√≥dulo</strong> (representado por duas barras |x|) √© a dist√¢ncia do n√∫mero at√© o zero. 
                <br><br>
                <span class="bg-white px-2 py-1 rounded font-mono font-bold text-brand-blue">Dist√¢ncia nunca √© negativa!</span></p>
            </div>

            <ul class="space-y-2 text-center font-mono text-xl font-bold text-gray-600 mb-6">
                <li>|+5| = 5</li>
                <li>|-5| = 5</li>
                <li>|0| = 0</li>
            </ul>

            <h3>2. O Tanque de Combust√≠vel ‚õΩ</h3>
            <p>O carro gasta gasolina indo para a cidade vizinha (+) ou voltando (-). O tanque n√£o quer saber a dire√ß√£o, s√≥ a dist√¢ncia!</p>

            [WIDGET:interactive_absolute_fuel]
        `,

            "N√∫meros Opostos ou Sim√©tricos": `
            <h3>1. Os Irm√£os G√™meos üëØ</h3>
            <p>Dois n√∫meros s√£o chamados de <strong>Opostos</strong> (ou Sim√©tricos) quando eles moram na mesma dist√¢ncia do zero, mas em lados opostos da rua.</p>
            
            <div class="grid grid-cols-2 gap-4 my-4">
                <div class="bg-green-100 p-3 rounded-lg text-center border-2 border-green-300">
                    <span class="block text-xs text-green-700 font-bold uppercase">O Her√≥i</span>
                    <span class="text-2xl font-black text-green-600">+10</span>
                </div>
                <div class="bg-red-100 p-3 rounded-lg text-center border-2 border-red-300">
                    <span class="block text-xs text-red-700 font-bold uppercase">O Anti-Her√≥i</span>
                    <span class="text-2xl font-black text-red-600">-10</span>
                </div>
            </div>

            <div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 text-center my-4 text-sm font-medium text-yellow-900">
                <strong>A Regra da Aniquila√ß√£o:</strong><br>
                Se voc√™ somar dois opostos, eles desaparecem!<br>
                <span class="font-mono text-lg mt-1 block">(+5) + (-5) = 0</span>
            </div>

            <h3>2. Desafio do Equil√≠brio ‚öñÔ∏è</h3>
            <p>Encontre os pares opostos para limpar o tabuleiro. Se voc√™ clicar em n√∫meros que n√£o s√£o sim√©tricos, voc√™ perde pontos!</p>

            [WIDGET:interactive_opposite_match]
        `,

            "Compara√ß√£o e Ordena√ß√£o de Inteiros": `
            <h3>1. Quem √© Maior? ü§î</h3>
            <p>Essa √© a parte que engana o c√©rebro! Nos n√∫meros positivos, 10 √© maior que 1. Mas nos negativos, a l√≥gica inverte.</p>
            
            <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-brand-purple my-4 shadow-sm text-sm">
                <strong>Regra de Ouro:</strong><br>
                Na reta num√©rica, o n√∫mero que estiver mais √† <strong>DIREITA</strong> √© sempre maior.
                <br>O n√∫mero que estiver mais √† <strong>ESQUERDA</strong> √© sempre menor.
            </div>

            <div class="flex flex-col gap-2 my-6">
                <div class="bg-white p-3 rounded-lg border border-gray-200 flex justify-between items-center">
                    <span>Positivos:</span>
                    <span class="font-bold text-green-600">5 > 2</span>
                    <span class="text-xs text-gray-400"> (5 tem mais valor)</span>
                </div>
                <div class="bg-white p-3 rounded-lg border border-gray-200 flex justify-between items-center">
                    <span>Negativos:</span>
                    <span class="font-bold text-red-600">-2 > -5</span>
                    <span class="text-xs text-gray-400"> (Dever 2 √© "melhor" que dever 5)</span>
                </div>
            </div>

            <h3>2. Duelo de Temperatura üå°Ô∏è</h3>
            <p>Pense no frio: <strong>-1¬∞C</strong> √© frio, mas <strong>-20¬∞C</strong> √© muito mais frio (menor temperatura). Portanto, -1 √© maior que -20.</p>

            [WIDGET:interactive_integer_battle]
        `,

            // =======================================================
            // UNIDADE 2: Opera√ß√µes em Z
            // =======================================================

            "Adi√ß√£o de Inteiros: Sinais Iguais vs Sinais Diferentes": `
<h3>1. O Duelo dos Sinais ‚öîÔ∏è</h3>
<p>Somar n√∫meros inteiros √© como uma batalha entre dois ex√©rcitos: o <strong>Ex√©rcito Positivo (Azul)</strong> e o <strong>Ex√©rcito Negativo (Vermelho)</strong>.</p>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
    <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue shadow-sm">
        <h4 class="font-bold text-brand-blue mb-2">ü§ù Sinais Iguais (Aliados)</h4>
        <p class="text-sm text-gray-700">Se os sinais s√£o iguais, eles n√£o brigam! Eles se juntam.</p>
        <ul class="mt-2 text-sm font-mono bg-white p-2 rounded border border-blue-100">
            <li>(+3) + (+2) = <strong>+5</strong> (Ganhei e Ganhei)</li>
            <li>(-3) + (-2) = <strong>-5</strong> (Devo e Devo)</li>
        </ul>
        <p class="text-xs text-brand-blue mt-2 font-bold">Regra: SOMA e mant√©m o sinal.</p>
    </div>

    <div class="bg-red-50 p-4 rounded-xl border-l-4 border-brand-red shadow-sm">
        <h4 class="font-bold text-brand-red mb-2">‚öîÔ∏è Sinais Diferentes (Inimigos)</h4>
        <p class="text-sm text-gray-700">Eles se anulam! Um soldado positivo elimina um negativo. Quem tiver mais soldados, vence a batalha.</p>
        <ul class="mt-2 text-sm font-mono bg-white p-2 rounded border border-red-100">
            <li>(+5) + (-2) = <strong>+3</strong> (Positivo venceu)</li>
            <li>(+2) + (-5) = <strong>-3</strong> (Negativo venceu)</li>
        </ul>
        <p class="text-xs text-brand-red mt-2 font-bold">Regra: SUBTRAI e usa o sinal do maior.</p>
    </div>
</div>

<h3>2. Simulador de Batalha üõ°Ô∏è</h3>
<p>Coloque os soldados na arena e veja quem sobra no final!</p>

[WIDGET:interactive_integer_battle]
`,

            "Propriedades da Adi√ß√£o em Z": `
<h3>Os Superpoderes da Adi√ß√£o ‚ú®</h3>
<p>No conjunto Z, a adi√ß√£o ganha uma propriedade nova muito importante: o Elemento Oposto.</p>

<ul class="list-none space-y-3 my-6">
    <li class="bg-white p-4 rounded-xl border-2 border-gray-100 shadow-sm flex items-center gap-4">
        <div class="text-3xl">üîÑ</div>
        <div>
            <strong class="text-brand-purple">Comutativa</strong>
            <p class="text-sm text-gray-600">A ordem n√£o importa. <br><code class="text-brand-purple font-bold">(-5) + (+2) = (+2) + (-5)</code></p>
        </div>
    </li>
    <li class="bg-white p-4 rounded-xl border-2 border-gray-100 shadow-sm flex items-center gap-4">
        <div class="text-3xl">üëª</div>
        <div>
            <strong class="text-brand-blue">Elemento Neutro (Zero)</strong>
            <p class="text-sm text-gray-600">Somar zero n√£o muda nada. <br><code class="text-brand-blue font-bold">(-10) + 0 = -10</code></p>
        </div>
    </li>
    <li class="bg-white p-4 rounded-xl border-2 border-gray-100 shadow-sm flex items-center gap-4">
        <div class="text-3xl">üí•</div>
        <div>
            <strong class="text-brand-red">Elemento Oposto (Sim√©trico)</strong>
            <p class="text-sm text-gray-600">Todo n√∫mero tem um "g√™meo do mal". Se somados, eles somem! <br><code class="text-brand-red font-bold">(+4) + (-4) = 0</code></p>
        </div>
    </li>
</ul>

<h3>Desafio de Mem√≥ria: Propriedades üß†</h3>
<p>Conecte a conta com a propriedade que ela representa!</p>

[WIDGET:interactive_properties_memory]
`,

            "Subtra√ß√£o de Inteiros: Adicionando o Oposto": `
<h3>O Disfarce da Subtra√ß√£o üé≠</h3>
<p>Em Z, a subtra√ß√£o √© apenas uma adi√ß√£o disfar√ßada. Subtrair um n√∫mero √© a mesma coisa que <strong>SOMAR o seu OPOSTO</strong>.</p>

<div class="bg-yellow-50 p-6 rounded-xl border-2 border-yellow-200 text-center my-6 shadow-sm">
    <p class="text-sm text-gray-500 font-bold uppercase mb-2">A Transforma√ß√£o</p>
    <div class="text-2xl font-mono font-bold text-gray-700">
        (+5) <span class="text-brand-red">-</span> (-2)
    </div>
    <div class="text-3xl my-2 text-gray-300">‚¨áÔ∏è</div>
    <div class="text-2xl font-mono font-black text-brand-blue">
        (+5) <span class="text-brand-green">+</span> (+2)
    </div>
    <p class="text-xs text-yellow-800 mt-4 italic">"Menos com Menos d√° Mais"</p>
</div>

<h3>Laborat√≥rio de Transforma√ß√£o ‚öóÔ∏è</h3>
<p>Clique na opera√ß√£o para transformar a subtra√ß√£o em adi√ß√£o e resolver a conta.</p>

[WIDGET:interactive_subtraction_transform]
`,

            "Elimina√ß√£o de Par√™nteses e Simplifica√ß√£o de Sinais": `
<h3>Limpando a Bagun√ßa üßπ</h3>
<p>Muitos sinais juntos confundem a cabe√ßa (ex: $+(-5)$ ou $-(-3)$). Para simplificar, usamos a "Regra do Choque":</p>

<div class="grid grid-cols-2 gap-4 my-6">
    <div class="bg-green-100 p-4 rounded-xl text-center border-2 border-green-300">
        <div class="text-2xl mb-1">üëç + üëç</div>
        <strong class="text-green-700">Sinais Iguais</strong>
        <p class="text-4xl font-black text-green-600 mt-2">+</p>
        <p class="text-xs text-green-800 mt-1">+(+) vira + <br> -(-) vira +</p>
    </div>
    <div class="bg-red-100 p-4 rounded-xl text-center border-2 border-red-300">
        <div class="text-2xl mb-1">üëé + üëç</div>
        <strong class="text-red-700">Sinais Diferentes</strong>
        <p class="text-4xl font-black text-red-600 mt-2">-</p>
        <p class="text-xs text-red-800 mt-1">+(-) vira - <br> -(+) vira -</p>
    </div>
</div>

<h3>Esmagador de Sinais üî®</h3>
<p>Seus inimigos s√£o os par√™nteses. Esmague os sinais duplos para simplificar a express√£o!</p>

[WIDGET:interactive_sign_smasher]
`,

            "Multiplica√ß√£o de Inteiros e Regra de Sinais": `
<h3>A Regra do Amigo ü§ù</h3>
<p>Na multiplica√ß√£o e divis√£o, a regra √© r√≠gida e n√£o depende de quem √© maior.</p>

<div class="bg-white p-6 rounded-xl border-2 border-brand-blue shadow-lg my-6">
    <ul class="space-y-4 font-bold text-lg text-gray-700">
        <li class="flex items-center gap-3">
            <span class="bg-green-100 text-green-700 p-2 rounded">üòÑ + üòÑ</span> 
            <span>O amigo do meu amigo √© meu... <strong>AMIGO (+)</strong></span>
        </li>
        <li class="flex items-center gap-3">
            <span class="bg-red-100 text-red-700 p-2 rounded">üò° + üò°</span> 
            <span>O inimigo do meu inimigo √© meu... <strong>AMIGO (+)</strong></span>
        </li>
        <li class="flex items-center gap-3">
            <span class="bg-gray-100 text-gray-700 p-2 rounded">üòÑ + üò°</span> 
            <span>O amigo do meu inimigo √© meu... <strong>INIMIGO (-)</strong></span>
        </li>
    </ul>
</div>

<h3>Desafio: Calculadora Quebrada üßÆ</h3>
<p>A calculadora s√≥ funciona se voc√™ acertar o sinal antes! Tente resolver r√°pido.</p>

[WIDGET:interactive_mult_speed_run]
`,

            "Divis√£o Exata de Inteiros": `
            <h3>1. A Regra dos Sinais (O Retorno) üîÑ</h3>
            <p>A divis√£o √© a melhor amiga da multiplica√ß√£o. Elas compartilham a mesma casa e as mesmas regras!</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm text-sm">
                <strong>Regra de Ouro:</strong><br>
                A regra de sinais da divis√£o √© <strong>ID√äNTICA</strong> √† da multiplica√ß√£o:
                <ul class="mt-2 space-y-1 list-none">
                    <li>‚úÖ Sinais Iguais (+ com +) ou (- com -) = <strong>Resultado Positivo (+)</strong></li>
                    <li>‚ùå Sinais Diferentes (+ com -) ou (- com +) = <strong>Resultado Negativo (-)</strong></li>
                </ul>
            </div>

            <p>Use o laborat√≥rio abaixo para ver como os sinais interagem:</p>

            [WIDGET:interactive_integer_division_lab]

            <h3>2. O Perigo do Zero üö´</h3>
            <p>Podemos dividir zero por qualquer coisa ($0 \\div 5 = 0$). Mas <strong>NUNCA</strong> podemos dividir <strong>POR</strong> zero.</p>
            <div class="bg-red-100 border-2 border-red-400 text-red-700 p-3 rounded-xl font-bold text-center my-4 text-xs uppercase tracking-widest">
                <i class="fas fa-skull-crossbones"></i> $5 \\div 0$ = Imposs√≠vel
            </div>

            <h3>3. Desafio: Separador de Cargas ‚ö°</h3>
            <p>Caixas com divis√µes est√£o caindo. Sua miss√£o √© envi√°-las para o cont√™iner correto: <strong>Positivo (+)</strong> ou <strong>Negativo (-)</strong>. N√£o deixe a carga explodir!</p>

            [WIDGET:interactive_sign_sorter]
        `,

            "Potencia√ß√£o em Z: Base Negativa, Expoente Par/√çmpar": `
<h3>O Mist√©rio da Base Negativa üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
<p>Quando elevamos um n√∫mero negativo, o expoente decide o destino do sinal.</p>

<div class="flex flex-col md:flex-row gap-4 my-6">
    <div class="flex-1 bg-green-50 p-4 rounded-xl border-t-4 border-green-500 text-center shadow-sm">
        <h4 class="font-bold text-green-700 uppercase text-sm mb-2">Expoente PAR (2, 4, 6...)</h4>
        <div class="text-3xl font-mono font-black text-gray-700 mb-2">(-2)¬≤</div>
        <p class="text-sm text-gray-600">(-2) . (-2) = <strong class="text-brand-green">+4</strong></p>
        <p class="text-xs text-green-600 mt-2 font-bold">Sempre POSITIVO! üòä</p>
    </div>

    <div class="flex-1 bg-red-50 p-4 rounded-xl border-t-4 border-red-500 text-center shadow-sm">
        <h4 class="font-bold text-red-700 uppercase text-sm mb-2">Expoente √çMPAR (1, 3, 5...)</h4>
        <div class="text-3xl font-mono font-black text-gray-700 mb-2">(-2)¬≥</div>
        <p class="text-sm text-gray-600">(-2).(-2).(-2) = <strong class="text-brand-red">-8</strong></p>
        <p class="text-xs text-red-600 mt-2 font-bold">Mant√©m o sinal da base! üòê</p>
    </div>
</div>

<div class="bg-yellow-50 p-3 rounded-lg border-2 border-yellow-200 text-center text-sm font-bold text-yellow-800">
    ‚ö†Ô∏è Cuidado! <span class="font-mono text-lg ml-2">-2¬≤ ‚â† (-2)¬≤</span><br>
    Sem par√™nteses, o sinal n√£o √© elevado! (-4 vs +4)
</div>

[WIDGET:interactive_power_switch]
`,

            "Raiz Quadrada Exata de Inteiros (e a impossibilidade de raiz de negativo)": `
            <h3>1. A Pergunta Inversa ‚Ü©Ô∏è</h3>
            <p>Se a pot√™ncia pergunta "Quanto √© esse n√∫mero vezes ele mesmo?", a Raiz Quadrada pergunta: <strong>"Quem foi que gerou esse quadrado?"</strong>.</p>
            
            <div class="flex justify-center gap-8 my-6 items-center font-mono text-xl">
                <div class="text-center">
                    <div class="text-brand-purple font-bold">(-3)¬≤</div>
                    <div class="text-xs text-gray-400">Pot√™ncia</div>
                    <div class="text-brand-text font-black">9</div>
                </div>
                <div class="text-2xl text-gray-300">‚ö°</div>
                <div class="text-center">
                    <div class="text-brand-orange font-bold">‚àö9</div>
                    <div class="text-xs text-gray-400">Raiz</div>
                    <div class="text-brand-text font-black">3</div>
                </div>
            </div>

            <p><strong>Obs:</strong> Embora $(-3) \\times (-3) = 9$, quando usamos o s√≠mbolo $\\sqrt{9}$, queremos apenas a resposta positiva (o valor absoluto).</p>

            <h3>2. A Zona Proibida: Raiz de Negativo ‚õî</h3>
            <p>Aqui est√° o maior "Bug" do conjunto dos Inteiros ($\\mathbb{Z}$).</p>
            <p>Quanto vale $\\sqrt{-4}$?</p>
            <ul class="list-disc list-inside bg-white p-4 rounded-xl border-2 border-gray-200 text-sm text-gray-700 space-y-2 mb-4">
                <li>Tente <strong>+2</strong>: $(+2) \\times (+2) = +4$ (N√£o deu -4).</li>
                <li>Tente <strong>-2</strong>: $(-2) \\times (-2) = +4$ (Tamb√©m deu +4!).</li>
            </ul>
            <p class="font-bold text-brand-red text-center">N√£o existe nenhum n√∫mero inteiro que, multiplicado por ele mesmo, d√™ negativo!</p>

            [WIDGET:interactive_root_explorer]

            <h3>3. Desafio: O Detector de Erros üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
            <p>O sistema foi invadido por c√°lculos falsos. Voc√™ precisa identificar quais ra√≠zes <strong>EXISTEM</strong> e quais s√£o <strong>IMPOSS√çVEIS</strong> em $\\mathbb{Z}$.</p>

            [WIDGET:interactive_root_imposter]
        `,

            "Express√µes Num√©ricas em Z": `
<h3>O Chefe Final: Express√µes üéÆ</h3>
<p>Agora misturamos tudo! Lembre-se da hierarquia militar (PEMDAS), mas agora com sinais negativos.</p>

<ol class="list-decimal list-inside space-y-2 bg-white p-4 rounded-xl border border-gray-200 text-sm font-bold text-gray-600 my-4 shadow-sm">
    <li>Pot√™ncias e Ra√≠zes</li>
    <li>Multiplica√ß√£o e Divis√£o (Regra de Sinais!)</li>
    <li>Adi√ß√£o e Subtra√ß√£o (Batalha de Ex√©rcitos)</li>
</ol>

<h3>Puzzle Matem√°tico üß©</h3>
<p>Arraste os passos para colocar a resolu√ß√£o da express√£o na ordem correta.</p>

[WIDGET:interactive_expression_sort]
`,

            // =======================================================
            // UNIDADE 3: N√∫meros Racionais (Q)
            // =======================================================

            "A Necessidade de Amplia√ß√£o (Q)": `
<h3>1. O Problema da Pizza üçï</h3>
<p>No mundo dos Inteiros ($\\mathbb{Z}$), a vida √© feita de n√∫meros cheios: -2, -1, 0, 1, 2... Mas o que acontece se voc√™ tem 1 pizza para dividir entre 2 amigos?</p>
<p>A conta $1 \\div 2$ n√£o tem resposta em $\\mathbb{Z}$. N√£o existe "inteiro" que resolva isso. Foi preciso criar um novo universo: os <strong>N√∫meros Racionais ($\\mathbb{Q}$)</strong>.</p>

<div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm text-sm">
<strong>Defini√ß√£o:</strong><br>
Racional √© todo n√∫mero que pode ser escrito como uma <strong>fra√ß√£o</strong> $\\frac{a}{b}$ (onde $a$ e $b$ s√£o inteiros e $b$ n√£o √© zero).
<br><em>Q vem de "Quociente" (resultado da divis√£o).</em>
</div>

<p>Isso inclui:</p>
<ul class="list-disc list-inside text-sm text-gray-700 space-y-1 ml-2">
<li>Os Inteiros (ex: $3 = \\frac{3}{1}$)</li>
<li>Decimais Exatos (ex: $0,5 = \\frac{1}{2}$)</li>
<li>D√≠zimas Peri√≥dicas (ex: $0,333... = \\frac{1}{3}$)</li>
</ul>
`,

            "Racionais na Reta Num√©rica (Densidade)": `
<h3>O Universo Infinito entre o 0 e o 1 üåå</h3>
<p>Nos inteiros, entre o 0 e o 1, n√£o existe ningu√©m. √â um salto vazio.</p>
<p>Nos racionais, entre o 0 e o 1 existe o $1/2$. Entre o 0 e o $1/2$, existe o $1/4$. Entre eles, o $1/8$...</p>

<div class="bg-purple-50 p-4 rounded-xl border-2 border-purple-200 my-4 text-center">
<p class="font-bold text-brand-purple mb-1">Propriedade da Densidade</p>
<p class="text-sm">"Entre dois n√∫meros racionais quaisquer, <strong>SEMPRE</strong> existe outro n√∫mero racional."</p>
</div>

<p>N√£o importa o quanto voc√™ d√™ zoom na reta, ela nunca fica vazia. √â como poeira de estrelas!</p>

[WIDGET:interactive_rational_zoom]
`,

            "Representa√ß√£o Decimal: Decimal Exato vs D√≠zima Peri√≥dica": `
<h3>A Transforma√ß√£o ü§ñ</h3>
<p>Toda fra√ß√£o √© uma divis√£o esperando para acontecer. Quando voc√™ divide o numerador pelo denominador, duas coisas podem acontecer:</p>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
<div class="bg-green-50 p-4 rounded-xl border-l-4 border-brand-green shadow-sm">
<h4 class="font-bold text-brand-green uppercase text-sm mb-2">1. Decimal Exato</h4>
<p class="text-sm">A conta termina. O resto chega a zero.</p>
<div class="bg-white p-2 rounded mt-2 font-mono text-center">
1/2 = <strong>0,5</strong> (Fim)
</div>
</div>

<div class="bg-orange-50 p-4 rounded-xl border-l-4 border-brand-orange shadow-sm">
<h4 class="font-bold text-brand-orange uppercase text-sm mb-2">2. D√≠zima Peri√≥dica</h4>
<p class="text-sm">A conta nunca acaba! Um padr√£o de n√∫meros come√ßa a se repetir para sempre (o per√≠odo).</p>
<div class="bg-white p-2 rounded mt-2 font-mono text-center">
1/3 = <strong>0,333...</strong> (Infinito)
</div>
</div>
</div>

<h3>Jogo da Classifica√ß√£o üè≠</h3>
<p>Voc√™ consegue prever se a fra√ß√£o vai dar um decimal finito ou infinito? Tente a sorte!</p>

[WIDGET:interactive_decimal_sorter]
`,

            "Fra√ß√£o Geratriz (Simples e Composta)": `
<h3>O Caminho de Volta ‚Ü©Ô∏è</h3>
<p>Se $1 \\div 3 = 0,333...$, como transformamos $0,333...$ de volta em $1/3$?</p>
<p>A fra√ß√£o que "gera" a d√≠zima chama-se <strong>Fra√ß√£o Geratriz</strong>. Usamos um truque de √°lgebra para encontr√°-la.</p>

<div class="bg-white p-4 rounded-xl border-2 border-brand-blue my-4 shadow-sm text-sm">
<strong>O Truque do 9:</strong><br>
1. Chame o n√∫mero de X.<br>
2. Multiplique por 10, 100 ou 1000 para "pular" a v√≠rgula.<br>
3. Subtraia as equa√ß√µes para matar a parte infinita!
</div>

<p>Parece complicado? Use o laborat√≥rio abaixo para ver a m√°gica passo a passo:</p>

[WIDGET:interactive_generating_fraction]
`,

            "M√≥dulo e Sim√©trico em Q": `
<h3>O Espelho da Matem√°tica ü™û</h3>
<p>Imagine que o Zero √© um espelho. Para cada n√∫mero positivo, existe um "g√™meo" negativo do outro lado, exatamente √† mesma dist√¢ncia.</p>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
<div class="bg-white p-4 rounded-xl border-l-4 border-brand-blue shadow-sm">
<strong>Sim√©trico (Oposto):</strong>
<p class="text-sm text-gray-600">√â o mesmo n√∫mero com sinal trocado.</p>
<p class="font-mono mt-1">Oposto de <span class="text-brand-blue">-2,5</span> √© <span class="text-brand-blue">+2,5</span></p>
</div>
<div class="bg-white p-4 rounded-xl border-l-4 border-brand-purple shadow-sm">
<strong>M√≥dulo (Valor Absoluto):</strong>
<p class="text-sm text-gray-600">√â a dist√¢ncia at√© o zero. <strong>Sempre positivo!</strong></p>
<p class="font-mono mt-1">|-3/4| = <span class="text-brand-purple">3/4</span></p>
</div>
</div>

[WIDGET:interactive_rational_mirror]
`,

            "Compara√ß√£o de N√∫meros Racionais": `
<h3>Quem √© Maior? ‚öñÔ∏è</h3>
<p>Comparar inteiros √© f√°cil ($5 > 2$). Mas e fra√ß√µes negativas?</p>
<p><strong>Regra de Ouro:</strong> Na reta num√©rica, quem est√° mais √† <strong>DIREITA</strong> √© sempre maior.</p>

<ul class="list-disc list-inside text-sm text-gray-700 bg-gray-50 p-4 rounded-xl border border-gray-200 space-y-2 mb-4">
<li>Positivo √© sempre maior que Negativo.</li>
<li>Entre dois negativos, o "menos negativo" (mais perto do zero) ganha.</li>
<li>Dica: Transforme tudo em decimal para comparar dinheiro! ($-1/2 = -0,50$ vs $-0,60$)</li>
</ul>

<p>Desafie o computador na Batalha dos Racionais:</p>

[WIDGET:interactive_rational_battle]
`,

            // =======================================================
            // UNIDADE 4: Opera√ß√µes em Q
            // =======================================================

            "Adi√ß√£o e Subtra√ß√£o de Racionais (Forma Fracion√°ria e Decimal)": `
            <h3>1. O Grande Encontro: Fra√ß√µes e Decimais ü§ù</h3>
            <p>Nos Racionais ($\\mathbb{Q}$), voc√™ vai encontrar n√∫meros com v√≠rgula e fra√ß√µes na mesma festa. Para somar ou subtrair, a regra de ouro √©: <strong>Fale a mesma l√≠ngua!</strong></p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue shadow-sm">
                    <h4 class="font-bold text-brand-blue mb-2">Equipe Fra√ß√£o</h4>
                    <p class="text-sm text-gray-700">Se escolher fra√ß√µes, o <strong>MMC</strong> √© o rei. Os denominadores (a parte de baixo) precisam ser iguais antes de juntar.</p>
                </div>
                <div class="bg-green-50 p-4 rounded-xl border-l-4 border-brand-green shadow-sm">
                    <h4 class="font-bold text-brand-green mb-2">Equipe Decimal</h4>
                    <p class="text-sm text-gray-700">Se escolher decimais, a regra √© <strong>V√≠rgula embaixo de V√≠rgula</strong>. Preencha buracos com zeros!</p>
                </div>
            </div>

            <h3>2. Sinais: A Batalha Submarina ‚öì</h3>
            <p>Lembra dos Inteiros ($\\mathbb{Z}$)? Aqui vale a mesma regra: Sinais iguais somam, sinais diferentes subtraem e conserva o sinal do maior.</p>
            <p>Imagine um submarino. N√∫meros positivos fazem ele subir, negativos fazem ele descer (profundidade). Onde ele vai parar?</p>

            [WIDGET:interactive_submarine_mission]
        `,

            "Multiplica√ß√£o de Racionais e Regra de Sinais": `
            <h3>1. A Multiplica√ß√£o √© Direta üèπ</h3>
            <p>Diferente da soma, na multiplica√ß√£o de fra√ß√µes n√£o precisamos de MMC! √â o sonho de todo estudante:</p>
            
            <div class="bg-yellow-50 p-4 rounded-xl border-2 border-brand-yellow text-center my-4 font-mono text-lg font-bold text-yellow-800">
                (Cima √ó Cima) / (Baixo √ó Baixo)
            </div>

            <p>Se forem decimais? Multiplique como se n√£o houvesse v√≠rgula. No final, conte quantas casas decimais tinham os dois n√∫meros juntos e devolva para o resultado.</p>

            <h3>2. O Jogo dos Sinais (Regra do Amigo) üé≠</h3>
            <p>Na multiplica√ß√£o e divis√£o, usamos a regra do "Amigo do meu Amigo":</p>
            <ul class="list-none space-y-2 mt-2 text-sm bg-white p-4 rounded-xl border border-gray-200">
                <li><span class="text-green-500 font-black">+</span> com <span class="text-green-500 font-black">+</span> = <span class="text-green-500 font-black">+</span> (Amigo do Amigo √© meu Amigo)</li>
                <li><span class="text-red-500 font-black">-</span> com <span class="text-red-500 font-black">-</span> = <span class="text-green-500 font-black">+</span> (Inimigo do Inimigo √© meu Amigo)</li>
                <li><span class="text-green-500 font-black">+</span> com <span class="text-red-500 font-black">-</span> = <span class="text-red-500 font-black">-</span> (Amigo do Inimigo √© meu Inimigo)</li>
            </ul>

            <h3>3. Desafio do Franco-Atirador üéØ</h3>
            <p>Ajuste o sinal e o valor para acertar o alvo na reta num√©rica. Cuidado: multiplicar por n√∫meros menores que 1 (ex: 0,5) faz o resultado diminuir!</p>

            [WIDGET:interactive_sniper_math]
        `,

            "Divis√£o de Racionais (Inverso multiplicativo)": `
            <h3>1. A Cambalhota M√°gica ü§∏‚Äç‚ôÇÔ∏è</h3>
            <p>Dividir por uma fra√ß√£o √© uma dor de cabe√ßa... a menos que voc√™ saiba o segredo: <strong>Multiplicar pelo Inverso</strong>.</p>
            
            <div class="bg-purple-50 p-6 rounded-xl border-l-4 border-brand-purple my-4">
                <h4 class="font-bold text-brand-purple mb-2">O Ritual de 3 Passos:</h4>
                <ol class="list-decimal list-inside space-y-2 text-sm text-gray-700">
                    <li><strong>Mantenha</strong> a primeira fra√ß√£o quieta.</li>
                    <li><strong>Troque</strong> o sinal de dividir (√∑) por multiplicar (√ó).</li>
                    <li><strong>Inverta</strong> (d√™ uma cambalhota) na segunda fra√ß√£o. O que est√° embaixo sobe!</li>
                </ol>
            </div>

            <h3>2. Chef de Cozinha: A Receita Invertida üç≥</h3>
            <p>Ajude o Chef a ajustar as receitas. Voc√™ precisa clicar na segunda fra√ß√£o para "grelh√°-la" (inverter) no momento certo!</p>

            [WIDGET:interactive_kitchen_flip]
        `,

            "Potencia√ß√£o de Racionais (Expoente inteiro negativo)": `
            <h3>1. O Elevador de Expoentes üõó</h3>
            <p>Quando elevamos uma fra√ß√£o, o expoente "chove" em todo mundo: no numerador e no denominador. <br>Ex: $(\\frac{2}{3})^2 = \\frac{4}{9}$.</p>

            <h3>2. O Medo do Expoente Negativo üò±</h3>
            <p>O que significa $2^{-3}$? Um n√∫mero negativo? <strong>N√ÉO!</strong></p>
            <p>O sinal de menos no expoente √© uma ordem: <strong>"Inverta a base!"</strong>. Quem est√° em cima vai para o por√£o, quem est√° no por√£o sobe.</p>

            <div class="flex items-center justify-center gap-4 my-6 text-2xl font-bold font-mono bg-gray-800 text-white p-4 rounded-xl shadow-lg">
                <span>(A/B)</span><sup class="text-red-400">-n</sup>
                <span>‚û°</span>
                <span>(B/A)</span><sup class="text-green-400">+n</sup>
            </div>

            <p>Use o simulador de elevador para entender como o andar negativo inverte as coisas:</p>

            [WIDGET:interactive_exponent_elevator]
        `,

            "Raiz Quadrada em Q": `
            <h3>1. Raiz de Cima e Raiz de Baixo üå±</h3>
            <p>Tirar a raiz quadrada de uma fra√ß√£o √© simples: voc√™ tira a raiz do teto (numerador) e a raiz do ch√£o (denominador) separadamente.</p>
            
            <div class="text-center my-4 font-mono text-xl bg-green-50 p-3 rounded-lg border border-green-200 inline-block">
                ‚àö<span style="text-decoration: overline"> (4/9) </span> = ‚àö4 / ‚àö9 = <strong>2/3</strong>
            </div>

            <h3>2. O Perigo dos Decimais ‚ö†Ô∏è</h3>
            <p>Quanto √© $\\sqrt{0,9}$? Se voc√™ disse 0,3... errou! $0,3 \\times 0,3 = 0,09$.</p>
            <p>Para tirar raiz de decimal, a dica ninja √©: <strong>Transforme em Fra√ß√£o</strong> primeiro!</p>

            [WIDGET:interactive_root_builder]
        `,

            "Express√µes Num√©ricas Envolvendo Z e Q": `
    <h3>1. A Ordem Suprema (PEMDAS) üëë</h3>
    <p>Quando misturamos inteiros, fra√ß√µes, pot√™ncias e par√™nteses, vira uma salada mista. Mas existe uma lei que n√£o pode ser quebrada:</p>

    <div class="space-y-2 my-4">
        <div class="flex items-center bg-red-100 p-2 rounded-lg border-l-4 border-red-500">
            <span class="font-black text-red-700 mr-2">1¬∫</span> Pot√™ncias e Ra√≠zes (Os Reis)
        </div>
        <div class="flex items-center bg-orange-100 p-2 rounded-lg border-l-4 border-orange-500">
            <span class="font-black text-orange-700 mr-2">2¬∫</span> Multiplica√ß√£o e Divis√£o (Os Generais)
        </div>
        <div class="flex items-center bg-green-100 p-2 rounded-lg border-l-4 border-green-500">
            <span class="font-black text-green-700 mr-2">3¬∫</span> Adi√ß√£o e Subtra√ß√£o (Os Soldados)
        </div>
    </div>

    <h3>2. Desafio: A Torre das Opera√ß√µes üóº</h3>
    <p>Uma express√£o num√©rica gigante vai aparecer. Voc√™ precisa clicar na opera√ß√£o que deve ser resolvida <strong>AGORA</strong>. Se errar a ordem, a torre cai!</p>

    [WIDGET:interactive_ops_tower]
`,

            // =======================================================
            // UNIDADE 5: Introdu√ß√£o √† √Ålgebra Formal
            // =======================================================

            "Linguagem Alg√©brica: Vari√°veis e Inc√≥gnitas": `
            <h3>1. O Idioma Secreto da Matem√°tica üïµÔ∏è‚Äç‚ôÄÔ∏è</h3>
            <p>At√© agora, a matem√°tica usava apenas n√∫meros. Mas e quando n√£o sabemos o valor de algo? Usamos uma <strong>Letra</strong>!</p>
            <p>Na √Ålgebra, as letras podem ter duas personalidades:</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-brand-purple shadow-sm">
                    <h4 class="font-bold text-brand-purple uppercase text-sm mb-2"><i class="fas fa-mask"></i> A Inc√≥gnita</h4>
                    <p class="text-sm text-gray-700">√â um n√∫mero <strong>desconhecido</strong> que precisamos descobrir. √â como um tesouro enterrado num local fixo.</p>
                    <div class="mt-2 bg-white p-2 rounded text-center font-mono">x + 5 = 10 (O x s√≥ pode ser 5)</div>
                </div>

                <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue shadow-sm">
                    <h4 class="font-bold text-brand-blue uppercase text-sm mb-2"><i class="fas fa-random"></i> A Vari√°vel</h4>
                    <p class="text-sm text-gray-700">√â um n√∫mero que <strong>pode mudar</strong>. Varia dependendo da situa√ß√£o.</p>
                    <div class="mt-2 bg-white p-2 rounded text-center font-mono">y = 2x (Se x muda, y muda)</div>
                </div>
            </div>

            <h3>2. Tradutor Portugu√™s ‚ÜîÔ∏è Matematiqu√™s üó£Ô∏è</h3>
            <p>Para resolver problemas, voc√™ precisa ser fluente nessa l√≠ngua. Vamos treinar a tradu√ß√£o?</p>

            [WIDGET:interactive_algebra_translator]
        `,

            "Valor Num√©rico de uma Express√£o Alg√©brica": `
            <h3>1. A M√°quina de Substitui√ß√£o ü§ñ</h3>
            <p>Uma express√£o alg√©brica √© como uma receita de bolo onde os ingredientes s√£o letras. O <strong>Valor Num√©rico</strong> √© o resultado do bolo quando voc√™ troca as letras por n√∫meros reais.</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 my-4 text-center">
                <p class="text-xs font-bold text-gray-400 uppercase mb-2">Express√£o:</p>
                <div class="text-3xl font-mono font-black text-brand-text mb-2">3x + 2</div>
                <p class="text-sm text-gray-600">Se <strong>x = 4</strong>, ent√£o fazemos: <br><strong>3 ¬∑ 4 + 2 = 12 + 2 = 14</strong>.</p>
            </div>

            <h3>2. Cuidado com o Sinal! ‚ö†Ô∏è</h3>
            <p>Quando a letra vale um n√∫mero negativo, coloque-a sempre entre <strong>PAR√äNTESES</strong> para n√£o errar o sinal.</p>
            <p>Exemplo: $x^2$ para $x = -3$.<br>
            Correto: $(-3)^2 = 9$.<br>
            Errado: $-3^2 = -9$.</p>

            <h3>3. Desafio da M√°quina üè≠</h3>
            <p>Configure a m√°quina com o valor de X e veja o que sai do outro lado!</p>

            [WIDGET:interactive_substitution_machine]
        `,

            "Equa√ß√µes do 1¬∫ Grau: Conceito de Raiz e Conjunto Universo": `
            <h3>1. A Balan√ßa da Verdade ‚öñÔ∏è</h3>
            <p>Uma equa√ß√£o √© uma pergunta. O sinal de igual ($=$) diz que o lado esquerdo tem o mesmo valor que o lado direito.</p>
            <p>A <strong>Raiz</strong> √© a chave que abre a equa√ß√£o (o valor de X que torna a igualdade verdadeira).</p>
            <p>O <strong>Conjunto Universo (U)</strong> s√£o todos os n√∫meros dispon√≠veis para testar. O <strong>Conjunto Solu√ß√£o (S)</strong> √© a resposta certa.</p>

            <h3>2. O Teste das Chaves üóùÔ∏è</h3>
            <p>Vamos testar qual chave abre o cadeado da equa√ß√£o $2x - 4 = 6$.</p>

            [WIDGET:interactive_key_tester]
        `,

            "Princ√≠pios de Equival√™ncia (Aditivo e Multiplicativo)": `
            <h3>1. A Regra de Ouro da √Ålgebra üåü</h3>
            <p>Imagine uma balan√ßa em equil√≠brio. Se voc√™ adicionar 2kg de um lado, ela desequilibra. Para voltar ao normal, voc√™ deve adicionar 2kg do OUTRO lado tamb√©m.</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm">
                <strong>O Princ√≠pio:</strong><br>
                Tudo o que voc√™ faz em um membro da equa√ß√£o, deve fazer igual no outro.
            </div>

            <h3>2. Academia da Balan√ßa üèãÔ∏è</h3>
            <p>Tente manter a balan√ßa equilibrada adicionando ou tirando pesos.</p>

            [WIDGET:interactive_balance_gym]
        `,

            "Resolu√ß√£o de Equa√ß√µes Simples (ax + b = c)": `
            <h3>1. O Mist√©rio do X üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
            <p>Uma equa√ß√£o √© como uma hist√≥ria de detetive. O <strong>$x$</strong> (ou qualquer letra) √© um n√∫mero mascarado que precisamos descobrir. A equa√ß√£o nos d√° as pistas.</p>
            <p>O formato cl√°ssico √© <strong>$ax + b = c$</strong>. Por exemplo: $2x + 4 = 10$.</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-6 shadow-sm">
                <h4 class="font-bold text-brand-blue mb-2 uppercase text-xs tracking-widest">A Regra de Ouro da Balan√ßa ‚öñÔ∏è</h4>
                <p class="text-sm text-gray-700">O sinal de igual ($=$) significa que os dois lados pesam a mesma coisa. Se voc√™ tira algo de um lado, <strong>TEM</strong> que tirar do outro para manter o equil√≠brio.</p>
            </div>

            <h3>2. A T√©cnica da Cebola (Descascando) üßÖ</h3>
            <p>Para descobrir quem √© o $x$, precisamos deix√°-lo sozinho (isolar o x). Fazemos isso tirando os n√∫meros que est√£o atrapalhando, camada por camada, usando a <strong>Opera√ß√£o Inversa</strong>.</p>
            <p>A ordem importa! √â como se vestir: primeiro a meia, depois o t√™nis. Para tirar (resolver), primeiro tira o t√™nis, depois a meia.</p>

            <ul class="list-none space-y-3 mt-4 mb-6">
                <li class="flex items-center gap-3 bg-white p-3 rounded-lg border border-gray-200 shadow-sm">
                    <span class="w-8 h-8 rounded-full bg-red-100 text-red-600 font-bold flex items-center justify-center">1</span>
                    <div>
                        <strong>Tire as Sobras (+ ou -):</strong><br>
                        Se est√° somando ($+4$), passa para o outro lado subtraindo ($-4$).
                    </div>
                </li>
                <li class="flex items-center gap-3 bg-white p-3 rounded-lg border border-gray-200 shadow-sm">
                    <span class="w-8 h-8 rounded-full bg-green-100 text-green-600 font-bold flex items-center justify-center">2</span>
                    <div>
                        <strong>Divida o Grupo ($ax$):</strong><br>
                        Se o n√∫mero est√° grudado no x ($2x$ √© $2 \\cdot x$), ele passa dividindo ($\\div 2$).
                    </div>
                </li>
            </ul>

            <p>Veja essa m√°gica acontecendo passo a passo no visualizador abaixo:</p>

            [WIDGET:interactive_equation_steps]

            <h3>3. Desafio: O Cofre Matem√°tico üîê</h3>
            <p>Agora √© sua vez. Voc√™ precisa descobrir o valor de $x$ para destrancar o cofre. Cuidado: calcule mentalmente ou use um papel!</p>

            [WIDGET:interactive_equation_safe_cracker]
        `,

            "Equa√ß√µes com Par√™nteses (Propriedade Distributiva)": `
            <h3>1. O Chuveirinho üöø</h3>
            <p>Quando temos um n√∫mero multiplicando par√™nteses, ele deve "molhar" (multiplicar) todo mundo que est√° dentro.</p>
            <p>A regra √©: $a(b + c) = ab + ac$.</p>

            <div class="bg-orange-50 p-4 rounded-xl border-l-4 border-brand-orange my-4 text-center font-mono text-lg">
                2(x + 3) &rarr; 2¬∑x + 2¬∑3 &rarr; <strong>2x + 6</strong>
            </div>

            <h3>2. Treino de Pontaria üèπ</h3>
            <p>Seja r√°pido e distribua as flechas (multiplicadores) nos alvos certos!</p>

            [WIDGET:interactive_archer_distributive]
        `,

            "Equa√ß√µes com Denominadores (MMC)": `
            <h3>1. O Esmagador de Fra√ß√µes üî®</h3>
            <p>Ningu√©m gosta de fra√ß√µes em equa√ß√µes. A boa not√≠cia √© que podemos elimin√°-las!</p>
            <p>O segredo √© multiplicar a equa√ß√£o INTEIRA pelo <strong>MMC</strong> dos denominadores. Isso corta a parte de baixo e deixa a conta linear.</p>

            <h3>2. Destrua os Denominadores</h3>
            <p>Escolha o n√∫mero certo para multiplicar e veja as fra√ß√µes desaparecerem.</p>

            [WIDGET:interactive_fraction_crusher]
        `,

            "Resolu√ß√£o de Problemas via Equa√ß√µes": `
            <h3>1. O M√©todo do Detetive üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
            <p>Problemas matem√°ticos s√£o mist√©rios escritos em portugu√™s que precisam ser traduzidos para "matematiqu√™s".</p>
            <div class="bg-gray-50 p-4 rounded-xl border-l-4 border-gray-500 my-4 text-sm font-medium">
                <strong>O Roteiro:</strong>
                <ol class="list-decimal list-inside mt-2 space-y-1">
                    <li>Identifique o desconhecido e chame de <strong>X</strong>.</li>
                    <li>Traduza as frases para opera√ß√µes (+, -, *, /).</li>
                    <li>Monte a igualdade (=).</li>
                    <li>Resolva a equa√ß√£o!</li>
                </ol>
            </div>

            <h3>2. Casos Reais üìÅ</h3>
            <p>Voc√™ foi contratado para resolver casos complexos. Leia o depoimento das testemunhas e encontre o n√∫mero culpado.</p>

            [WIDGET:interactive_detective_rpg]
        `,

            // =======================================================
            // UNIDADE 6: Inequa√ß√µes do 1¬∫ Grau
            // =======================================================

            "Conceito de Desigualdade e Sinais (>, <, ‚â•, ‚â§)": `
            <h3>1. A Balan√ßa Desequilibrada ‚öñÔ∏è</h3>
            <p>Na equa√ß√£o, a balan√ßa est√° parada (igualdade). Na <strong>Inequa√ß√£o</strong>, um lado √© mais pesado que o outro!</p>
            <p>Usamos 4 s√≠mbolos principais para mostrar quem ganha:</p>

            <div class="grid grid-cols-2 gap-4 my-6">
                <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue shadow-sm">
                    <strong class="text-brand-blue text-2xl block mb-2">></strong>
                    <span class="text-xs font-bold uppercase text-gray-400">Maior que</span>
                    <p class="text-sm text-gray-600">5 > 2</p>
                </div>
                <div class="bg-orange-50 p-4 rounded-xl border-l-4 border-brand-orange shadow-sm">
                    <strong class="text-brand-orange text-2xl block mb-2"><</strong>
                    <span class="text-xs font-bold uppercase text-gray-400">Menor que</span>
                    <p class="text-sm text-gray-600">2 < 5</p>
                </div>
                <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-brand-purple shadow-sm">
                    <strong class="text-brand-purple text-2xl block mb-2">‚â•</strong>
                    <span class="text-xs font-bold uppercase text-gray-400">Maior ou Igual</span>
                    <p class="text-sm text-gray-600">Pode empatar!</p>
                </div>
                <div class="bg-green-50 p-4 rounded-xl border-l-4 border-brand-green shadow-sm">
                    <strong class="text-brand-green text-2xl block mb-2">‚â§</strong>
                    <span class="text-xs font-bold uppercase text-gray-400">Menor ou Igual</span>
                    <p class="text-sm text-gray-600">Pode empatar!</p>
                </div>
            </div>

            <h3>2. A Regra do Jacar√© üêä</h3>
            <p>Se voc√™ confundir os lados, lembre-se: <strong>A boca do jacar√© sempre quer comer o n√∫mero maior!</strong></p>

            [WIDGET:interactive_inequality_signs]

            <h3>3. Desafio Ninja dos Sinais ü•∑</h3>
            <p>Os n√∫meros v√£o cair r√°pido. Voc√™ consegue dizer quem √© maior antes do tempo acabar?</p>

            [WIDGET:interactive_sign_ninja]
        `,

            "Propriedades das Desigualdades (Invers√£o ao multiplicar por negativo)": `
            <h3>1. O Mundo Invertido üôÉ</h3>
            <p>As inequa√ß√µes funcionam quase igual √†s equa√ß√µes. Voc√™ pode somar, subtrair, multiplicar e dividir...</p>
            <p><strong>MAS CUIDADO!</strong> Existe uma armadilha mortal.</p>

            <div class="bg-red-50 p-4 rounded-xl border-2 border-brand-red my-4 shadow-sm relative overflow-hidden">
                <div class="absolute top-0 right-0 bg-brand-red text-white text-[10px] font-bold px-2 py-1 uppercase">Perigo</div>
                <h4 class="font-bold text-brand-red mb-2">A Regra de Ouro</h4>
                <p class="text-sm text-gray-700">Sempre que voc√™ multiplicar ou dividir os dois lados por um <strong>N√öMERO NEGATIVO</strong>, o sinal da desigualdade <strong>INVERTE</strong> (vira para o outro lado).</p>
            </div>

            <h3>2. Por que isso acontece? ü§î</h3>
            <p>Imagine a reta num√©rica. O 5 est√° √† direita do 2 (5 > 2). Mas se multiplicarmos por -1, vamos para o "mundo espelhado".</p>
            <p>O -5 est√° √† ESQUERDA do -2. Logo, -5 < -2.</p>

            <div class="flex justify-center my-6">
                <div class="bg-gray-800 text-white p-4 rounded-xl text-center font-mono text-lg shadow-lg">
                    <div>4 > 2</div>
                    <div class="text-xs text-gray-400 my-1">Multiplicando por (-1)</div>
                    <div class="text-brand-yellow font-bold text-2xl animate-pulse">-4 < -2</div>
                </div>
            </div>

            <p>Use o laborat√≥rio abaixo para testar essa invers√£o:</p>

            [WIDGET:interactive_inequality_flip]
        `,

            "Resolu√ß√£o de Inequa√ß√µes": `
            <h3>1. Isolando o X üèùÔ∏è</h3>
            <p>Resolver $2x + 4 > 10$ √© descobrir quais valores o X pode ter para a senten√ßa ser verdadeira.</p>
            <p>O processo √© o mesmo da equa√ß√£o: joga n√∫mero pra l√°, letra pra c√°. S√≥ fique atento se precisar passar um negativo dividindo!</p>

            <h3>2. Treino Guiado üèãÔ∏è‚Äç‚ôÄÔ∏è</h3>
            <p>Vamos resolver juntos uma inequa√ß√£o passo a passo. Observe como o sinal se comporta.</p>

            [WIDGET:interactive_inequality_solver]
        `,

            "Representa√ß√£o da Solu√ß√£o na Reta Num√©rica": `
            <h3>1. Pintando a Estrada üõ£Ô∏è</h3>
            <p>Diferente da equa√ß√£o, onde a resposta √© um ponto (x=3), na inequa√ß√£o a resposta √© um <strong>trecho infinito</strong> da reta (x > 3).</p>

            <h3>2. A Bolinha: Aberta ou Fechada? ‚ö™‚ö´</h3>
            <p>O detalhe mais importante √© o come√ßo do intervalo:</p>
            
            <ul class="space-y-2 mt-4">
                <li class="flex items-center gap-3 bg-white p-3 rounded-lg border border-gray-200">
                    <div class="w-6 h-6 rounded-full border-2 border-brand-blue bg-white"></div>
                    <div>
                        <strong class="text-brand-blue">Bolinha Aberta (‚ö™)</strong>
                        <p class="text-xs text-gray-500">Usamos para <strong>></strong> ou <strong><</strong>. O n√∫mero n√£o entra na festa.</p>
                    </div>
                </li>
                <li class="flex items-center gap-3 bg-white p-3 rounded-lg border border-gray-200">
                    <div class="w-6 h-6 rounded-full border-2 border-brand-blue bg-brand-blue"></div>
                    <div>
                        <strong class="text-brand-blue">Bolinha Fechada (‚ö´)</strong>
                        <p class="text-xs text-gray-500">Usamos para <strong>‚â•</strong> ou <strong>‚â§</strong>. O n√∫mero est√° inclu√≠do!</p>
                    </div>
                </li>
            </ul>

            <h3>3. Desafio do Pintor üé®</h3>
            <p>Leia a inequa√ß√£o e pinte a reta num√©rica corretamente. Aten√ß√£o para a bolinha!</p>

            [WIDGET:interactive_interval_painter]
        `,

            // =======================================================
            // UNIDADE 7: Raz√£o, Propor√ß√£o e Regra de Tr√™s
            // =======================================================

            "Conceito de Raz√£o e Grandezas Especiais (Velocidade, Escala, Densidade)": `
    <h3>1. O Que √© Raz√£o? ‚ûó</h3>
    <p>A Raz√£o √© a compara√ß√£o entre dois n√∫meros atrav√©s da divis√£o. Ela responde √† pergunta: <em>"Quantas vezes o n√∫mero A cabe no n√∫mero B?"</em> ou <em>"Qual a rela√ß√£o entre eles?"</em>.</p>
    
    <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm text-sm">
        <strong>A F√≥rmula M√°gica:</strong><br>
        Escrevemos como fra√ß√£o $\\frac{a}{b}$ ou como divis√£o $a : b$.<br>
        O de cima chama-se <strong>Antecedente</strong> e o de baixo <strong>Consequente</strong>.
    </div>

    <h3>2. O Laborat√≥rio de Po√ß√µes üß™</h3>
    <p>Imagine uma po√ß√£o m√°gica. A receita diz: "Para cada 1 gota de Sangue de Drag√£o (Vermelho), use 3 gotas de L√°grima de Unic√≥rnio (Azul)".</p>
    <p>A raz√£o √© <strong>1 para 3</strong> ($1:3$ ou $\\frac{1}{3}$). Se voc√™ errar essa mistura, a po√ß√£o explode!</p>

    [WIDGET:interactive_ratio_potions]

    <h3>3. Raz√µes Especiais no Mundo Real üåç</h3>
    <p>Algumas raz√µes s√£o t√£o famosas que ganharam nomes pr√≥prios:</p>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6">
        <div class="bg-white p-4 rounded-xl border-b-4 border-brand-orange shadow-sm text-center">
            <div class="text-3xl mb-2">üèéÔ∏è</div>
            <h4 class="font-bold text-brand-orange uppercase text-xs">Velocidade M√©dia</h4>
            <p class="text-xs text-gray-500 mt-1">Dist√¢ncia √∑ Tempo</p>
            <p class="font-mono text-xs font-bold mt-1">km/h</p>
        </div>
        <div class="bg-white p-4 rounded-xl border-b-4 border-brand-purple shadow-sm text-center">
            <div class="text-3xl mb-2">üó∫Ô∏è</div>
            <h4 class="font-bold text-brand-purple uppercase text-xs">Escala</h4>
            <p class="text-xs text-gray-500 mt-1">Tamanho Desenho √∑ Real</p>
            <p class="font-mono text-xs font-bold mt-1">1:100</p>
        </div>
        <div class="bg-white p-4 rounded-xl border-b-4 border-brand-green shadow-sm text-center">
            <div class="text-3xl mb-2">üèôÔ∏è</div>
            <h4 class="font-bold text-brand-green uppercase text-xs">Densidade Demogr√°fica</h4>
            <p class="text-xs text-gray-500 mt-1">Pessoas √∑ √Årea</p>
            <p class="font-mono text-xs font-bold mt-1">hab/km¬≤</p>
        </div>
    </div>
`,

            "Conceito de Propor√ß√£o e Propriedade Fundamental": `
    <h3>1. A Igualdade de Raz√µes ‚öñÔ∏è</h3>
    <p>Uma <strong>Propor√ß√£o</strong> acontece quando duas raz√µes diferentes contam a mesma hist√≥ria. √â uma igualdade: $\\frac{a}{b} = \\frac{c}{d}$.</p>
    <p>L√™-se: "A est√° para B, assim como C est√° para D".</p>

    <h3>2. A Propriedade Fundamental (O X da Quest√£o) ‚ùå</h3>
    <p>Como saber se duas fra√ß√µes formam uma propor√ß√£o? Usamos o "Poder do X" (multiplica√ß√£o cruzada).</p>
    
    <div class="bg-yellow-50 p-4 rounded-xl border-2 border-brand-yellow my-4 text-center">
        <p class="text-sm text-gray-600 mb-2">O produto dos extremos √© igual ao produto dos meios.</p>
        <div class="font-mono text-xl md:text-2xl font-black text-brand-text">
            $\\frac{a}{b} = \\frac{c}{d} \\iff a \\cdot d = b \\cdot c$
        </div>
    </div>

    <p>Teste voc√™ mesmo! Encontre o n√∫mero que falta para equilibrar a balan√ßa da propor√ß√£o.</p>

    [WIDGET:interactive_proportion_balance]
`,

            "Grandezas Diretamente Proporcionais (GDP)": `
    <h3>1. Amigos Insepar√°veis ü§ù</h3>
    <p>Duas grandezas s√£o <strong>Diretamente Proporcionais</strong> quando elas "andam juntas".</p>
    <ul class="list-none space-y-2 bg-green-50 p-4 rounded-xl border border-green-200 text-sm mt-4">
        <li class="flex items-center gap-2"><i class="fas fa-arrow-up text-green-600"></i> Se uma DOBRA, a outra DOBRA.</li>
        <li class="flex items-center gap-2"><i class="fas fa-arrow-down text-red-500"></i> Se uma cai pela METADE, a outra cai pela METADE.</li>
    </ul>

    <h3>2. O Exemplo da Padaria ü•ñ</h3>
    <p>Quanto mais farinha voc√™ usa, mais p√£es voc√™ faz. N√£o tem segredo!</p>
    <p>Observe o gr√°fico abaixo. Grandezas Diretas sempre formam uma <strong>Reta</strong> que nasce no zero.</p>

    [WIDGET:interactive_gdp_graph]
`,

            "Grandezas Inversamente Proporcionais (GIP)": `
    <h3>1. A Gangorra Matem√°tica üé¢</h3>
    <p>Duas grandezas s√£o <strong>Inversamente Proporcionais</strong> quando uma faz o oposto da outra.</p>
    <ul class="list-none space-y-2 bg-orange-50 p-4 rounded-xl border border-orange-200 text-sm mt-4">
        <li class="flex items-center gap-2">üîÑ Se uma DOBRA, a outra cai pela METADE.</li>
        <li class="flex items-center gap-2">‚ö° Exemplo cl√°ssico: <strong>Velocidade e Tempo</strong>.</li>
    </ul>

    <div class="bg-gray-800 text-white p-4 rounded-xl shadow-lg my-4 text-center">
        <p class="text-xs uppercase font-bold text-gray-400">Regra de Ouro</p>
        <p class="text-lg">Quanto mais r√°pido voc√™ corre, <strong>menos tempo</strong> demora para chegar!</p>
    </div>

    <p>Observe o gr√°fico. Grandezas Inversas formam uma <strong>Curva</strong> (Hip√©rbole).</p>

    [WIDGET:interactive_gip_graph]
`,

            "Regra de Tr√™s Simples (Direta e Inversa)": `
    <h3>1. A Ferramenta Suprema üõ†Ô∏è</h3>
    <p>A Regra de Tr√™s serve para descobrir um valor desconhecido quando temos 3 n√∫meros relacionados.</p>
    <p>O segredo n√£o √© a conta, √© a <strong>PERGUNTA</strong>: "√â direta ou inversa?".</p>

    <h3>2. O Grande Duelo ‚öîÔ∏è</h3>
    <p>Se voc√™ errar a pergunta, erra a conta. Vamos treinar seu instinto de detetive.</p>

    [WIDGET:interactive_rule_three_quiz]

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
        <div class="bg-blue-50 p-4 rounded-xl border-t-4 border-brand-blue">
            <h4 class="font-bold text-brand-blue text-sm uppercase mb-2">Direta (Cruzada)</h4>
            <p class="text-xs text-gray-600">Multiplica em X ($a \\cdot x = b \\cdot c$).<br>Ex: Receita de bolo, Compras.</p>
        </div>
        <div class="bg-orange-50 p-4 rounded-xl border-t-4 border-brand-orange">
            <h4 class="font-bold text-brand-orange text-sm uppercase mb-2">Inversa (Reta)</h4>
            <p class="text-xs text-gray-600">Multiplica em Linha ($a \\cdot b = c \\cdot x$).<br>Ex: Pedreiros vs Tempo, Torneiras vs Tempo.</p>
        </div>
    </div>
`,

            "Divis√£o em Partes Proporcionais": `
    <h3>1. A Partilha Justa üí∞</h3>
    <p>Dividir igualmente √© f√°cil. Mas e se um amigo trabalhou mais que o outro? Ou se um investiu mais dinheiro?</p>
    <p>A <strong>Divis√£o Proporcional</strong> garante que quem tem "mais pontos" receba uma fatia maior do bolo.</p>

    <h3>2. O Ba√∫ do Tesouro üè¥‚Äç‚ò†Ô∏è</h3>
    <p>O Capit√£o Barba-Ruiva precisa dividir 100 moedas de ouro entre dois piratas, baseado na for√ßa deles. Ajude o capit√£o a n√£o causar um motim!</p>

    [WIDGET:interactive_treasure_split]

    <div class="bg-white p-4 rounded-xl border border-gray-200 mt-4 shadow-sm">
        <h4 class="font-bold text-gray-700 text-sm mb-2">O Algoritmo da Partilha:</h4>
        <ol class="list-decimal list-inside text-xs text-gray-600 space-y-1">
            <li>Some os "pesos" das partes (ex: idade, pontos).</li>
            <li>Divida o total pelo "soma dos pesos" (ache a Constante K).</li>
            <li>Multiplique a Constante K pelo peso de cada um.</li>
        </ol>
    </div>
`,

            // =======================================================
            // UNIDADE 8: Porcentagem e Matem√°tica Financeira
            // =======================================================

            "Porcentagem como Raz√£o Centesimal": `
            <h3>1. A Linguagem do "Por Cento" %</h3>
            <p>Voc√™ j√° parou para pensar que o s√≠mbolo <strong>%</strong> parece uma fra√ß√£o distorcida? A barra virou um tra√ßo inclinado e os dois zeros viraram bolinhas.</p>
            <p>Porcentagem nada mais √© do que uma fra√ß√£o onde o denominador (o n√∫mero de baixo) √© sempre <strong>100</strong>.</p>

            <div class="flex justify-center gap-8 my-6 items-center text-2xl font-black text-brand-blue">
                <div>30%</div>
                <div class="text-gray-300">=</div>
                <div class="flex flex-col items-center">
                    <span>30</span>
                    <div class="w-full h-1 bg-brand-blue rounded"></div>
                    <span>100</span>
                </div>
                <div class="text-gray-300">=</div>
                <div>0,30</div>
            </div>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm shadow-sm">
                <strong>O Truque Mental:</strong><br>
                Falar "por cento" √© literalmente dizer "dividido por cem".<br>
                50 por cento = 50 a cada 100.
            </div>

            <h3>2. Visualizando o Cento üíØ</h3>
            <p>Imagine um quadrado dividido em 100 pedacinhos. Cada quadradinho vale 1%. Brinque com o visualizador para entender a conex√£o entre Fra√ß√£o, Decimal e Porcentagem.</p>

            [WIDGET:interactive_percent_grid]
        `,

            "C√°lculo de Porcentagem de uma Quantia": `
            <h3>1. A Palavra M√°gica "DE" üé©</h3>
            <p>Na matem√°tica, quando queremos calcular uma parte de algo (como 20% <strong>DE</strong> 500), a preposi√ß√£o "de" vira uma conta de <strong>MULTIPLICA√á√ÉO</strong>.</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 text-center my-6">
                <p class="text-sm text-gray-500 font-bold uppercase mb-2">O Algoritmo do Desconto</p>
                <div class="text-xl font-mono text-brand-text">
                    20% <span class="text-brand-red font-black">de</span> 500<br>
                    ‚¨á<br>
                    <span class="text-brand-blue">0,20</span> <span class="text-brand-red font-black">√ó</span> 500 = <strong>100</strong>
                </div>
            </div>

            <h3>2. Truques de Mestre (C√°lculo Mental) üß†</h3>
            <ul class="list-none space-y-2 mb-6">
                <li class="bg-white p-3 rounded-lg border border-gray-200 shadow-sm">
                    <strong>10%:</strong> Basta voltar a v√≠rgula uma casa para a esquerda.<br>
                    <span class="text-xs text-gray-500">10% de 250 = 25.</span>
                </li>
                <li class="bg-white p-3 rounded-lg border border-gray-200 shadow-sm">
                    <strong>50%:</strong> √â a metade de tudo.<br>
                    <span class="text-xs text-gray-500">50% de 80 = 40.</span>
                </li>
                <li class="bg-white p-3 rounded-lg border border-gray-200 shadow-sm">
                    <strong>20%:</strong> √â 10% vezes 2.<br>
                    <span class="text-xs text-gray-500">10% de 60 √© 6... ent√£o 20% √© 12!</span>
                </li>
            </ul>

            <h3>3. Desafio do Shopping üõçÔ∏è</h3>
            <p>Voc√™ est√° no shopping e viu promo√ß√µes incr√≠veis. Mas voc√™ precisa calcular o pre√ßo final r√°pido antes que acabem o estoque!</p>

            [WIDGET:interactive_discount_game]
        `,

            "Taxa Percentual": `
            <h3>Como descobrir a taxa? üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
            <p>√Äs vezes sabemos o valor da parte e o valor do todo, mas queremos saber qual √© a porcentagem.</p>
            <p>Exemplo: "Acertei 15 quest√µes de 20. Qual minha taxa de acerto?"</p>

            <div class="bg-green-50 p-4 rounded-xl border-l-4 border-brand-green my-4">
                <h4 class="font-bold text-brand-green mb-2">A F√≥rmula da Fra√ß√£o</h4>
                <ol class="list-decimal list-inside text-sm text-gray-700 space-y-1">
                    <li>Monte a fra√ß√£o: $\\frac{\\text{Parte}}{\\text{Todo}}$ ($\\frac{15}{20}$)</li>
                    <li>Divida o de cima pelo de baixo ($15 \\div 20 = 0,75$)</li>
                    <li>Multiplique por 100 para virar % ($0,75 \\times 100 = 75\%$)</li>
                </ol>
            </div>
        `,

            "Aumentos e Descontos Sucessivos": `
            <h3>1. A Armadilha Matem√°tica ü™§</h3>
            <p>Se uma loja aumenta o pre√ßo em 10% e depois d√° um desconto de 10%, o pre√ßo volta ao normal?</p>
            <p class="text-center text-2xl font-black text-brand-red my-4 animate-pulse">N√ÉO!</p>
            
            <p>Isso acontece porque o segundo c√°lculo √© feito sobre o <strong>valor novo</strong>, n√£o sobre o original.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                    <strong class="text-brand-blue block mb-1">Passo 1 (Aumento)</strong>
                    <p class="text-sm">R$ 100 + 10% = <strong>R$ 110</strong></p>
                </div>
                <div class="bg-red-50 p-4 rounded-xl border border-red-200">
                    <strong class="text-brand-red block mb-1">Passo 2 (Desconto)</strong>
                    <p class="text-sm">Tirar 10% de R$ 110 (que √© R$ 11).</p>
                    <p class="text-sm font-bold mt-1">110 - 11 = R$ 99</p>
                </div>
            </div>
            
            <p class="text-center text-xs text-gray-500 italic">Voc√™ saiu no preju√≠zo de R$ 1,00!</p>
        `,

            "Juros Simples (J = C.i.t) e Montante": `
            <h3>1. O Dinheiro que Cresce üå±</h3>
            <p>Juros √© o "aluguel" que voc√™ paga pelo dinheiro emprestado, ou o lucro que voc√™ recebe por deixar seu dinheiro investido.</p>
            <p>No <strong>Juro Simples</strong>, o lucro √© sempre calculado sobre o valor inicial (Capital). √â como uma √°rvore que d√° sempre a mesma quantidade de frutos todo m√™s.</p>

            <div class="bg-gray-800 text-white p-6 rounded-2xl shadow-lg my-6 relative overflow-hidden">
                <div class="absolute -right-4 -top-4 text-6xl opacity-20">üí∞</div>
                <h4 class="font-mono text-2xl font-bold text-center mb-4 text-brand-yellow">J = C . i . t</h4>
                <ul class="text-sm space-y-2">
                    <li><span class="text-brand-yellow font-bold">J</span> = Juros ($$)</li>
                    <li><span class="text-blue-300 font-bold">C</span> = Capital (Dinheiro inicial)</li>
                    <li><span class="text-green-300 font-bold">i</span> = Taxa (√≠ndice, em decimal)</li>
                    <li><span class="text-purple-300 font-bold">t</span> = Tempo</li>
                </ul>
            </div>

            <h3>2. Simulador de Investimento üìà</h3>
            <p>Voc√™ tem um cofrinho m√°gico. Ajuste o valor inicial, a taxa de juros e o tempo para ver quanto dinheiro voc√™ ter√° no final (Montante).</p>

            [WIDGET:interactive_interest_simulator]
        `,

            // =======================================================
            // UNIDADE 9: Geometria - √Çngulos e Retas
            // =======================================================

            "√Çngulos Complementares e Suplementares": `
            <h3>1. O Quebra-Cabe√ßa dos √Çngulos üß©</h3>
            <p>√Äs vezes, dois √¢ngulos se juntam para formar algo especial. Eles trabalham em equipe!</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-blue-50 p-4 rounded-xl border-t-4 border-brand-blue shadow-sm">
                    <h4 class="font-bold text-brand-blue text-lg mb-2"><i class="fas fa-couch"></i> Complementares (90¬∞)</h4>
                    <p class="text-sm text-gray-700">Juntos, eles formam o <strong>Canto Perfeito</strong> (√Çngulo Reto). Pense no canto de uma porta ou de um livro.</p>
                    <div class="mt-2 text-center bg-white p-2 rounded border border-blue-200 font-mono text-brand-blue font-bold">
                        A + B = 90¬∞
                    </div>
                </div>

                <div class="bg-orange-50 p-4 rounded-xl border-t-4 border-brand-orange shadow-sm">
                    <h4 class="font-bold text-brand-orange text-lg mb-2"><i class="fas fa-road"></i> Suplementares (180¬∞)</h4>
                    <p class="text-sm text-gray-700">Juntos, eles formam a <strong>Linha Reta</strong> (√Çngulo Raso). √â como abrir um livro totalmente at√© ficar plano na mesa.</p>
                    <div class="mt-2 text-center bg-white p-2 rounded border border-orange-200 font-mono text-brand-orange font-bold">
                        A + B = 180¬∞
                    </div>
                </div>
            </div>

            <h3>2. Laborat√≥rio de Fus√£o ‚öóÔ∏è</h3>
            <p>Arraste o controle para ver como um √¢ngulo cresce e o outro diminui para manter a soma constante.</p>

            [WIDGET:interactive_angle_combos]

            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm shadow-sm">
                <strong>üí° Dica de Mem√≥ria:</strong>
                <ul class="mt-1 list-disc list-inside">
                    <li><strong>C</strong>omplementar come√ßa com <strong>C</strong> de <strong>C</strong>anto (90¬∞).</li>
                    <li><strong>S</strong>uplementar come√ßa com <strong>S</strong> de <strong>S</strong>uper Aberto (180¬∞).</li>
                </ul>
            </div>
        `,

            "√Çngulos Adjacentes e Opostos pelo V√©rtice (OPV)": `
            <h3>1. Vizinhos de Parede (Adjacentes) üè†</h3>
            <p>Dois √¢ngulos s√£o <strong>Adjacentes</strong> quando eles moram lado a lado. Eles compartilham:</p>
            <ul class="list-none space-y-2 text-sm bg-white p-4 rounded-xl border border-gray-200">
                <li>‚úÖ O mesmo v√©rtice (o ponto de origem).</li>
                <li>‚úÖ Um lado em comum (a "parede" que divide os dois).</li>
                <li>üö´ Mas <strong>N√ÉO</strong> t√™m pontos internos em comum (um n√£o invade a casa do outro).</li>
            </ul>

            <h3>2. O Efeito Tesoura (OPV) ‚úÇÔ∏è</h3>
            <p>Quando duas retas se cruzam formando um X, os √¢ngulos que est√£o de frente um para o outro s√£o chamados de <strong>Opostos pelo V√©rtice (OPV)</strong>.</p>
            
            <div class="bg-purple-50 p-4 rounded-xl border-2 border-brand-purple my-4 text-center">
                <p class="font-bold text-brand-purple text-lg uppercase tracking-widest">A Regra de Ouro</p>
                <p class="text-xl font-black mt-2">√Çngulos O.P.V. s√£o IGUAIS!</p>
                <p class="text-xs text-gray-500 mt-1">Se um mede 50¬∞, o outro tamb√©m mede 50¬∞.</p>
            </div>

            <p>Abra e feche a tesoura virtual para ver os √¢ngulos mudando juntos:</p>

            [WIDGET:interactive_scissors_opv]
        `,

            "Bissetriz de um √Çngulo (Constru√ß√£o Geom√©trica)": `
            <h3>1. O Corte Perfeito üç∞</h3>
            <p>Imagine que voc√™ tem que dividir uma fatia de pizza exatamente ao meio com seu irm√£o. A linha que corta o √¢ngulo em duas partes <strong>iguais</strong> se chama <strong>Bissetriz</strong>.</p>

            <div class="flex items-center gap-4 bg-green-50 p-4 rounded-xl border-l-4 border-brand-green my-4">
                <div class="text-3xl">üó°Ô∏è</div>
                <div>
                    <h4 class="font-bold text-brand-green">Defini√ß√£o:</h4>
                    <p class="text-sm">√â a semirreta que parte do v√©rtice e divide o √¢ngulo em dois √¢ngulos congruentes (mesma medida).</p>
                </div>
            </div>

            <h3>2. Desafio Ninja: O Corte Preciso ü•∑</h3>
            <p>Voc√™ tem um olho bom? Tente acertar a bissetriz exata do √¢ngulo. Quanto mais perto do meio, mais pontos voc√™ ganha!</p>

            [WIDGET:interactive_ninja_bisector]
        `,

            "Retas Paralelas Cortadas por Transversal": `
            <h3>1. Trilhos e Estradas üõ§Ô∏è</h3>
            <p>Imagine dois trilhos de trem (<strong>Retas Paralelas</strong>, que nunca se tocam). Agora imagine uma estrada cruzando esses trilhos (<strong>Reta Transversal</strong>).</p>
            <p>Esse cruzamento cria <strong>8 √¢ngulos</strong> diferentes, mas acredite ou n√£o, existem apenas <strong>2 medidas</strong> nesse desenho todo!</p>

            <div class="relative w-full h-32 bg-gray-100 rounded-xl overflow-hidden border-2 border-gray-300 my-6">
                <div class="absolute top-8 left-0 right-0 h-1 bg-brand-blue"></div>
                <div class="absolute bottom-8 left-0 right-0 h-1 bg-brand-blue"></div>
                <div class="absolute top-0 left-1/3 h-full w-1 bg-brand-red transform rotate-12 origin-center"></div>
                
                <div class="absolute top-2 right-4 text-xs font-bold text-brand-blue">Paralela r</div>
                <div class="absolute bottom-2 right-4 text-xs font-bold text-brand-blue">Paralela s</div>
                <div class="absolute top-2 left-2 text-xs font-bold text-brand-red">Transversal t</div>
            </div>

            <h3>2. As Regras Visuais (Z, F e C) üî°</h3>
            <p>Para n√£o decorar nomes dif√≠ceis, procure por letras no desenho:</p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 my-4">
                <div class="bg-white border-2 border-orange-200 rounded-lg p-3 text-center">
                    <span class="text-4xl font-black text-brand-orange">Z</span>
                    <p class="text-xs font-bold mt-1 text-gray-600">Alternos</p>
                    <p class="text-[10px] text-gray-400">S√£o Iguais (=)</p>
                </div>
                <div class="bg-white border-2 border-green-200 rounded-lg p-3 text-center">
                    <span class="text-4xl font-black text-brand-green">F</span>
                    <p class="text-xs font-bold mt-1 text-gray-600">Correspondentes</p>
                    <p class="text-[10px] text-gray-400">S√£o Iguais (=)</p>
                </div>
                <div class="bg-white border-2 border-purple-200 rounded-lg p-3 text-center">
                    <span class="text-4xl font-black text-brand-purple">C</span>
                    <p class="text-xs font-bold mt-1 text-gray-600">Colaterais</p>
                    <p class="text-[10px] text-gray-400">Somam 180¬∞ (+)</p>
                </div>
            </div>
        `,

            "√Çngulos Correspondentes, Alternos e Colaterais": `
            <h3>1. O Mapa da Cidade üó∫Ô∏è</h3>
            <p>Vamos dar nomes aos bois (ou aos √¢ngulos). Passe o mouse (ou toque) nos bot√µes abaixo para iluminar os pares no mapa e entender a rela√ß√£o.</p>

            [WIDGET:interactive_parallel_city]

            <h3>2. Resumo das Rela√ß√µes</h3>
            <ul class="list-disc list-inside space-y-2 text-sm text-gray-700 bg-gray-50 p-4 rounded-xl border border-gray-200">
                <li><strong>Correspondentes:</strong> Est√£o na "mesma posi√ß√£o" (um dentro, um fora). <span class="text-green-600 font-bold">S√£o Iguais.</span></li>
                <li><strong>Alternos (Z):</strong> Est√£o em lados trocados da transversal. <span class="text-green-600 font-bold">S√£o Iguais.</span></li>
                <li><strong>Colaterais (C):</strong> Est√£o do mesmo lado da transversal (dentro ou fora). <span class="text-brand-red font-bold">Juntos d√£o 180¬∞.</span></li>
            </ul>

            <h3>3. Desafio: Estacionamento Geom√©trico üöó</h3>
            <p>Voc√™ precisa estacionar o carro na vaga certa. Para isso, calcule o valor de <strong>X</strong> usando as regras das paralelas!</p>

            [WIDGET:interactive_angle_parking]
        `,

            // =======================================================
            // UNIDADE 10: Geometria - Tri√¢ngulos e Pol√≠gonos
            // =======================================================

            "Soma dos √Çngulos Internos de um Tri√¢ngulo": `
            <h3>1. A M√°gica dos 180 Graus ü™Ñ</h3>
            <p>N√£o importa se o tri√¢ngulo √© magrinho, gordinho ou torto. Se voc√™ somar os tr√™s √¢ngulos de qualquer tri√¢ngulo do universo, o resultado <strong>SEMPRE</strong> ser√° 180¬∞.</p>
            
            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 shadow-sm">
                <strong>O que √© 180¬∞?</strong><br>
                √â meia volta. √â um √¢ngulo raso. Imagine uma linha reta.
            </div>

            <p>N√£o acredita? Vamos "rasgar" as pontas de um tri√¢ngulo e coloc√°-las juntas. Veja o que acontece:</p>

            [WIDGET:interactive_triangle_180_proof]
        `,

            "Teorema do √Çngulo Externo": `
            <h3>1. O Vizinho Fofoqueiro üèòÔ∏è</h3>
            <p>O √¢ngulo externo √© aquele que fica do lado de fora, formado quando prolongamos um dos lados. Ele tem uma rela√ß√£o curiosa com os √¢ngulos de dentro.</p>

            <div class="bg-blue-50 p-4 rounded-xl border-2 border-brand-blue my-4 text-center">
                <p class="text-sm font-bold text-gray-500 uppercase mb-2">O Teorema</p>
                <p class="text-lg font-bold text-brand-blue">Externo = Interno A + Interno B</p>
                <p class="text-xs text-gray-600 mt-2">(A soma dos dois internos <em>n√£o adjacentes</em>)</p>
            </div>

            <p>Use o laborat√≥rio abaixo para mexer nos √¢ngulos e comprovar a conta:</p>

            [WIDGET:interactive_external_angle]
        `,

            "Classifica√ß√£o de Tri√¢ngulos (Lados e √Çngulos)": `
            <h3>1. O RG do Tri√¢ngulo üÜî</h3>
            <p>Todo tri√¢ngulo tem dois nomes: um baseado no tamanho das suas <strong>Pernas</strong> (Lados) e outro baseado na sua <strong>Abertura</strong> (√Çngulos).</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-brand-purple">
                    <strong class="text-brand-purple block mb-2">üìè Pelos Lados</strong>
                    <ul class="text-sm space-y-1 text-gray-600">
                        <li><strong>Equil√°tero:</strong> 3 lados iguais. (O Perfeito)</li>
                        <li><strong>Is√≥sceles:</strong> 2 lados iguais. (A Torre)</li>
                        <li><strong>Escaleno:</strong> 0 lados iguais. (O Torto)</li>
                    </ul>
                </div>
                <div class="bg-orange-50 p-4 rounded-xl border-l-4 border-brand-orange">
                    <strong class="text-brand-orange block mb-2">üìê Pelos √Çngulos</strong>
                    <ul class="text-sm space-y-1 text-gray-600">
                        <li><strong>Acut√¢ngulo:</strong> Tudo fechadinho (< 90¬∞).</li>
                        <li><strong>Ret√¢ngulo:</strong> Tem um canto reto (90¬∞).</li>
                        <li><strong>Obtus√¢ngulo:</strong> Tem um abert√£o (> 90¬∞).</li>
                    </ul>
                </div>
            </div>

            <h3>2. Laborat√≥rio de Cria√ß√£o üèóÔ∏è</h3>
            <p>Arraste os v√©rtices para criar tri√¢ngulos estranhos e veja como o computador os classifica em tempo real!</p>

            [WIDGET:interactive_triangle_explorer]
        `,

            "Condi√ß√£o de Exist√™ncia de um Tri√¢ngulo (Desigualdade Triangular)": `
            <h3>1. A Regra do Abra√ßo ü´Ç</h3>
            <p>Voc√™ n√£o pode pegar quaisquer tr√™s gravetos e montar um tri√¢ngulo. Se dois gravetos forem muito curtos, eles n√£o conseguem se "abra√ßar" (se tocar) para fechar a forma.</p>

            <div class="bg-red-50 p-4 rounded-xl border-2 border-brand-red my-4 text-center shadow-sm">
                <p class="font-bold text-brand-red text-lg">A Regra de Ouro:</p>
                <p class="text-gray-700 mt-1">Um lado sozinho deve ser sempre <strong>MENOR</strong> que a soma dos outros dois.</p>
                <p class="font-mono text-sm mt-2 bg-white inline-block px-2 py-1 rounded">a < b + c</p>
            </div>

            <h3>2. Desafio do Construtor üë∑</h3>
            <p>Tente fechar o tri√¢ngulo ajustando os tamanhos das barras. Se a barra azul for muito grande, as outras n√£o alcan√ßam!</p>

            [WIDGET:interactive_stick_builder]
        `,

            "Pol√≠gonos: Convexos vs C√¥ncavos": `
            <h3>1. O Teste da Caverna ü¶á</h3>
            <p>Pol√≠gonos s√£o figuras fechadas com linhas retas. Mas eles t√™m personalidades diferentes:</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6 text-center">
                <div class="bg-green-50 p-4 rounded-xl border-b-4 border-brand-green">
                    <div class="text-4xl mb-2">üü¢</div>
                    <strong class="text-brand-green">Convexo</strong>
                    <p class="text-xs text-gray-600 mt-2">"Gordinho". Todas as pontas saem para fora. Se voc√™ esticar um el√°stico em volta, ele toca em tudo.</p>
                </div>
                <div class="bg-purple-50 p-4 rounded-xl border-b-4 border-brand-purple">
                    <div class="text-4xl mb-2">üü£</div>
                    <strong class="text-brand-purple">C√¥ncavo</strong>
                    <p class="text-xs text-gray-600 mt-2">Tem uma "caverna" ou mordida. Uma ponta entra para dentro da figura.</p>
                </div>
            </div>

            <h3>2. Teste do Laser üî´</h3>
            <p>Se voc√™ consegue tra√ßar uma linha reta que entra, sai e entra de novo no pol√≠gono... ele √© <strong>C√¥ncavo</strong>!</p>

            [WIDGET:interactive_poly_cave]
        `,

            "Soma dos √Çngulos Internos de Pol√≠gonos (Generaliza√ß√£o)": `
            <h3>1. O Segredo da Triangula√ß√£o üçï</h3>
            <p>Como saber a soma dos √¢ngulos de um Hex√°gono sem medir um por um? Simples: n√≥s quebramos ele em tri√¢ngulos!</p>
            
            <ul class="list-disc list-inside bg-white p-4 rounded-xl border-2 border-gray-200 text-sm text-gray-700 space-y-2 mb-4">
                <li>Sabemos que 1 tri√¢ngulo = <strong>180¬∞</strong>.</li>
                <li>Se um pol√≠gono cabe 3 tri√¢ngulos, a soma √© $3 \\times 180¬∞$.</li>
            </ul>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue mb-6">
                <strong>A F√≥rmula Geral:</strong><br>
                N√∫mero de Tri√¢ngulos = Lados - 2<br>
                <span class="font-mono text-lg font-bold text-brand-blue">Soma = (n - 2) √ó 180¬∞</span>
            </div>

            [WIDGET:interactive_polygon_slices]
        `,

            // =======================================================
            // UNIDADE 11: Simetria e Plano Cartesiano
            // =======================================================

            "Plano Cartesiano: Eixos, Origem e Quadrantes": `
            <h3>1. O GPS da Matem√°tica üó∫Ô∏è</h3>
            <p>Imagine que voc√™ est√° em uma cidade perfeitamente quadrada. Para encontrar qualquer lugar, voc√™ s√≥ precisa de duas ruas principais que se cruzam no centro.</p>
            <p>Ren√© Descartes, um fil√≥sofo que gostava de olhar moscas voando no teto, criou esse mapa. Chamamos de <strong>Plano Cartesiano</strong>.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-white p-4 rounded-xl border-l-4 border-brand-blue shadow-sm">
                    <h4 class="font-bold text-brand-blue uppercase text-xs mb-2">Eixo X (Abscissas)</h4>
                    <p class="text-sm text-gray-600">√â a linha <strong>Deitada</strong> (Horizontal).<br>Direita √© positivo (+), Esquerda √© negativo (-).</p>
                    <div class="mt-2 w-full h-1 bg-brand-blue relative"><div class="absolute right-0 -top-1.5 text-brand-blue">‚û§</div></div>
                </div>
                <div class="bg-white p-4 rounded-xl border-l-4 border-brand-orange shadow-sm">
                    <h4 class="font-bold text-brand-orange uppercase text-xs mb-2">Eixo Y (Ordenadas)</h4>
                    <p class="text-sm text-gray-600">√â a linha <strong>Em P√©</strong> (Vertical).<br>Cima √© positivo (+), Baixo √© negativo (-).</p>
                    <div class="mt-2 h-8 w-1 bg-brand-orange mx-auto relative"><div class="absolute -top-1.5 -left-1 text-brand-orange">‚ñ≤</div></div>
                </div>
            </div>

            <h3>2. Os 4 Bairros (Quadrantes) üèôÔ∏è</h3>
            <p>Quando as linhas se cruzam na <strong>Origem (0,0)</strong>, elas dividem o mapa em 4 regi√µes. A contagem √© feita no sentido <em>anti-hor√°rio</em> (contra o rel√≥gio).</p>

            [WIDGET:interactive_quadrant_explorer]

            <div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 mt-4 text-center">
                <p class="text-xs font-bold text-yellow-800 uppercase mb-1">Dica de Ouro</p>
                <p class="text-sm text-gray-700">A ordem √© sempre alfab√©tica: <strong>(X, Y)</strong>.<br>Primeiro voc√™ anda para os lados (X), depois sobe ou desce (Y).</p>
            </div>
        `,

            "Coordenadas Inteiras e Racionais": `
            <h3>1. Endere√ßo Exato üìç</h3>
            <p>Todo ponto no plano tem um endere√ßo chamado <strong>Par Ordenado (x, y)</strong>.</p>
            <p>N√£o precisamos usar apenas n√∫meros inteiros (como 1, 2, 3). Podemos usar n√∫meros "quebrados" (racionais), como <strong>1,5</strong> ou <strong>-3,2</strong>. Eles moram nos espa√ßos entre as linhas da grade.</p>

            <h3>2. Jogo: Ca√ßa ao Tesouro üè¥‚Äç‚ò†Ô∏è</h3>
            <p>O radar detectou tesouros escondidos! Olhe as coordenadas no painel e clique no local exato do mapa para desenterr√°-los. Cuidado: alguns est√£o em locais decimais!</p>

            [WIDGET:interactive_coordinate_treasure]
        `,

            "Simetria de Reflex√£o (Axial)": `
            <h3>1. O Mundo do Espelho ü™û</h3>
            <p>A Simetria de Reflex√£o (ou Axial) acontece quando uma figura √© "copiada" para o outro lado de uma linha (o <strong>Eixo de Simetria</strong>), mas invertida.</p>
            <p>A regra de ouro √©: a dist√¢ncia de um ponto at√© o espelho √© igual √† dist√¢ncia do reflexo at√© o espelho.</p>

            <div class="flex justify-center my-6">
                <div class="relative w-40 h-40">
                    <div class="absolute left-1/2 top-0 bottom-0 w-0.5 bg-brand-blue border-l border-dashed border-white"></div>
                    <div class="absolute text-4xl left-2 top-10">b</div>
                    <div class="absolute text-4xl right-2 top-10 transform scale-x-[-1]">b</div>
                    <p class="absolute bottom-0 w-full text-center text-xs text-gray-400">O 'b' vira 'd' no espelho!</p>
                </div>
            </div>

            <h3>2. Desafio do Pintor Sim√©trico üñåÔ∏è</h3>
            <p>O eixo Y (vertical) √© o nosso espelho. Pinte os quadradinhos do lado direito para completar o desenho sim√©trico!</p>

            [WIDGET:interactive_reflection_painter]
        `,

            "Simetria de Transla√ß√£o": `
            <h3>1. O Escorregador üõù</h3>
            <p>Na transla√ß√£o, a figura n√£o gira nem inverte. Ela apenas <strong>desliza</strong> pelo plano.</p>
            <p>N√≥s movemos todos os pontos da figura a mesma dist√¢ncia na mesma dire√ß√£o. √â como mover um √≠cone na √°rea de trabalho do computador.</p>

            <div class="bg-green-50 p-4 rounded-xl border-l-4 border-brand-green my-4 text-sm">
                <strong>Vetor de Transla√ß√£o:</strong><br>
                √â a instru√ß√£o do movimento. Ex: "Ande 3 para a direita e 2 para cima" $(x+3, y+2)$.
            </div>

            <h3>2. Laborat√≥rio de Movimento üéÆ</h3>
            <p>Use os controles para transladar a nave espacial pelo grid. Leve-a at√© a base!</p>

            [WIDGET:interactive_translation_game]
        `,

            "Simetria de Rota√ß√£o": `
            <h3>1. Girando sem Tontura üòµ‚Äçüí´</h3>
            <p>A rota√ß√£o acontece quando giramos uma figura em torno de um ponto fixo (o centro de rota√ß√£o). O tamanho e a forma n√£o mudam, apenas a "pose".</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 flex items-center gap-4">
                <div class="text-3xl">üé°</div>
                <div class="text-sm text-gray-700">Imagine uma roda gigante. As cadeiras giram em torno do eixo central. Um giro completo tem <strong>360¬∞</strong>.</div>
            </div>

            <h3>2. A Regra dos Quadrantes</h3>
            <p>No plano cartesiano, girar <strong>90¬∞</strong> no sentido anti-hor√°rio (esquerda) muda as coordenadas de um jeito especial: $(x, y)$ vira $(-y, x)$.</p>

            <h3>3. Simulador de Giros üîÑ</h3>
            <p>Gire a pe√ßa de Tetris em torno da origem (0,0) e veja o que acontece com seus pontos.</p>

            [WIDGET:interactive_rotation_tetris]
        `,

            "Constru√ß√£o de Figuras Sim√©tricas no Plano": `
            <h3>1. O Grande Arquiteto üìê</h3>
            <p>Agora vamos juntar tudo! Para construir uma figura sim√©trica, voc√™ precisa:</p>
            <ol class="list-decimal list-inside text-sm text-gray-700 bg-white p-4 rounded-xl border border-gray-200 space-y-2 mb-4">
                <li>Identificar os <strong>V√©rtices</strong> (pontas) da figura original.</li>
                <li>Aplicar a transforma√ß√£o (Refletir, Transladar ou Rodar) em cada ponto individualmente.</li>
                <li>Ligar os novos pontos.</li>
            </ol>

            <h3>2. Desafio Final: O Reflexo Perdido üß©</h3>
            <p>Temos metade de uma borboleta (ou nave?). Encontre os pontos sim√©tricos do outro lado do eixo Y para completar o desenho!</p>

            [WIDGET:interactive_symmetry_construction]
        `,

            // =======================================================
            // UNIDADE 12: Medidas de √Årea e Volume
            // =======================================================

            "√Årea do Quadrado e Ret√¢ngulo": `
            <h3>1. Ladrilhando o Ch√£o üüß</h3>
            <p>Calcular a √°rea n√£o √© m√°gica, √© <strong>contagem</strong>. Imagine que voc√™ √© um pedreiro e precisa cobrir o ch√£o com pisos quadrados de tamanho 1x1.</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm shadow-sm">
                <strong>A Regra da Multiplica√ß√£o:</strong><br>
                Em vez de contar um por um (1, 2, 3...), voc√™ conta quantas fileiras existem e multiplica pelo tamanho da fileira.
                <br><br>
                <span class="font-mono text-lg text-brand-blue font-bold">√Årea = Base √ó Altura</span>
            </div>

            <p>Use o simulador abaixo para "ladrilhar" o ret√¢ngulo e ver a f√≥rmula nascer:</p>

            [WIDGET:interactive_tiling_area]

            <h3>2. O Quadrado √© Especial üü¶</h3>
            <p>O quadrado √© um ret√¢ngulo "perfeitinho" onde a base e a altura s√£o iguais (chamamos de Lado).</p>
            <p>Por isso, a f√≥rmula $b \\times h$ vira $L \\times L$ ou <strong>$L^2$</strong>.</p>
        `,

            "√Årea do Paralelogramo e Tri√¢ngulo": `
            <h3>1. A Cirurgia Geom√©trica ‚úÇÔ∏è</h3>
            <p>O Paralelogramo parece um ret√¢ngulo que tomou um vento forte e ficou torto. Mas ele ocupa o mesmo espa√ßo!</p>
            <p>Se voc√™ cortar o tri√¢ngulo que "sobra" na esquerda e colar na direita, ele vira um ret√¢ngulo perfeito. Por isso a f√≥rmula √© a mesma:</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 text-center my-4">
                <span class="font-black text-brand-orange text-xl">√Årea = Base √ó Altura</span>
                <p class="text-xs text-gray-500 mt-1">(Cuidado: A altura √© a linha reta, n√£o o lado torto!)</p>
            </div>

            [WIDGET:interactive_parallelogram_cut]

            <h3>2. O Tri√¢ngulo: A Metade da Laranja üçä</h3>
            <p>Qualquer tri√¢ngulo √© exatamente a <strong>metade</strong> de um ret√¢ngulo (ou paralelogramo) que tem a mesma base e altura.</p>
            <p>Se a √°rea do ret√¢ngulo √© $b \\times h$, a do tri√¢ngulo s√≥ pode ser...</p>
            
            <div class="flex justify-center my-4">
                <div class="bg-gray-800 text-white p-3 rounded-lg font-mono text-xl shadow-lg">
                    $$ A = \\frac{b \\cdot h}{2} $$
                </div>
            </div>

            <p><strong>Desafio Ninja:</strong> Ajuste a base e a altura para atingir a √°rea alvo!</p>

            [WIDGET:interactive_triangle_ninja]
        `,

            "√Årea do Trap√©zio e Losango": `
            <h3>1. O Trap√©zio: M√©dia das Bases üèóÔ∏è</h3>
            <p>O trap√©zio √© estranho: tem um teto pequeno ($b$) e um ch√£o grande ($B$). Qual base usamos para calcular? <strong>A m√©dia das duas!</strong></p>
            <p>Imagine que transformamos o trap√©zio em um ret√¢ngulo que tem uma largura "m√©dia".</p>

            <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-brand-purple my-4">
                <p class="font-bold text-brand-purple mb-1">A F√≥rmula:</p>
                <p>Somamos as bases, dividimos por 2 (m√©dia) e multiplicamos pela altura.</p>
                <div class="font-mono text-center text-lg mt-2 font-black">$$ A = \\frac{(B + b) \\cdot h}{2} $$</div>
            </div>

            <h3>2. O Losango (A Pipa) ü™Å</h3>
            <p>Podemos calcular a √°rea do losango usando suas diagonais (a cruzeta interna).</p>
            <p>Se voc√™ desenhar um ret√¢ngulo em volta do losango, ver√° que o losango ocupa exatamente <strong>metade</strong> da √°rea desse ret√¢ngulo.</p>

            [WIDGET:interactive_rhombus_box]
        `,

            "Volume de Blocos Retangulares (Paralelep√≠pedos)": `
            <h3>1. O Mundo em 3D: Empilhando Fatias üßä</h3>
            <p>At√© agora medimos o ch√£o (√Årea). Agora vamos encher a sala (Volume)!</p>
            <p>Imagine que a √Årea da Base ($A_b$) √© uma fatia de p√£o de forma. Para fazer o volume, n√≥s empilhamos v√°rias fatias at√© chegar na altura ($h$).</p>

            <div class="bg-green-50 p-4 rounded-xl border-2 border-green-200 text-center my-6 shadow-sm">
                <span class="text-xs font-bold text-green-700 uppercase tracking-widest">F√≥rmula Geral</span>
                <div class="text-3xl font-black text-brand-green mt-2">V = $A_b$ √ó h</div>
                <p class="text-sm text-gray-500 mt-2">ou: Comprimento √ó Largura √ó Altura</p>
            </div>

            <p>Use o guindaste para empilhar blocos e entender como o volume cresce:</p>

            [WIDGET:interactive_volume_crane]

            <h3>2. O Cubo M√°gico üé≤</h3>
            <p>No cubo, todas as arestas s√£o iguais. Ent√£o:</p>
            <p class="text-center font-mono font-bold text-xl my-2">V = a √ó a √ó a = a¬≥</p>
        `,

            "Convers√£o de Unidades de √Årea e Volume ($m^2, m^3$ e Litros)": `
            <h3>1. A Pegadinha do Quadrado ‚ö†Ô∏è</h3>
            <p>Voc√™ sabe que $1m = 10dm$. Ent√£o $1m^2 = 10dm^2$, certo? <strong>ERRADO!</strong></p>
            <p>Quando elevamos ao quadrado, a convers√£o tamb√©m eleva ao quadrado. O fator √© <strong>100</strong>.</p>
            
            <div class="grid grid-cols-2 gap-4 my-4 text-center text-sm">
                <div class="bg-gray-100 p-2 rounded border border-gray-300">
                    <strong>Linear (1D)</strong><br>
                    x 10
                </div>
                <div class="bg-blue-100 p-2 rounded border border-brand-blue text-brand-blue font-bold">
                    <strong>√Årea (2D)</strong><br>
                    x 100
                </div>
            </div>

            <p>Veja no microsc√≥pio por que cabem 100 quadradinhos pequenos dentro de um grande:</p>

            [WIDGET:interactive_unit_zoom_2d]

            <h3>2. O Monstro do Volume (3D) üì¶</h3>
            <p>No volume, o salto √© triplo! Para passar de $m^3$ para $dm^3$, multiplicamos por <strong>1.000</strong>.</p>

            <h3>3. A Ponte L√≠quida: dm¬≥ = Litro üíß</h3>
            <p>Essa √© a convers√£o mais importante da vida real:</p>
            <div class="bg-brand-blue text-white p-4 rounded-xl text-center shadow-lg my-4">
                <h4 class="font-black text-2xl mb-1">1 dm¬≥ = 1 Litro</h4>
                <p class="text-xs opacity-90">Uma caixa de 10cm x 10cm x 10cm cabe exatamente 1 Litro de √°gua.</p>
            </div>

            [WIDGET:interactive_liquid_lab]
        `,

            // =======================================================
            // UNIDADE 13: Estat√≠stica
            // =======================================================

            "M√©dia Aritm√©tica Simples": `
            <h3>1. A Arte de Nivelar üß±</h3>
            <p>A M√©dia √© o valor que equilibra tudo. Imagine que voc√™ tem v√°rias pilhas de blocos de alturas diferentes. A m√©dia √© a altura que todas as pilhas teriam se voc√™ distribu√≠sse os blocos igualmente.</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm shadow-sm">
                <strong>A F√≥rmula:</strong><br>
                Soma de todos os valores √∑ Quantidade de valores.
            </div>

            <p>Tente "nivelar" as torres abaixo para encontrar a m√©dia visualmente:</p>

            [WIDGET:interactive_mean_leveler]

            <h3>2. O Ponto de Equil√≠brio ‚öñÔ∏è</h3>
            <p>Se os n√∫meros fossem pesos em uma gangorra, a m√©dia seria exatamente onde voc√™ coloca o apoio (o fulcro) para a gangorra n√£o cair para nenhum lado.</p>
        `,

            "M√©dia Aritm√©tica Ponderada": `
            <h3>1. Quando os Pesos s√£o Diferentes üèãÔ∏è‚Äç‚ôÇÔ∏è</h3>
            <p>Na m√©dia simples, todo mundo vale a mesma coisa. Mas e na escola, quando a <strong>Prova</strong> vale mais que o <strong>Trabalho</strong>?</p>
            <p>Isso √© a M√©dia Ponderada. Alguns n√∫meros s√£o "mais pesados" (t√™m peso maior) e puxam a m√©dia para perto deles.</p>

            <div class="bg-purple-50 p-4 rounded-xl border-2 border-purple-200 my-4 text-center">
                <span class="text-xs font-bold uppercase text-purple-700">Como Calcular:</span>
                <div class="font-mono text-lg mt-2">
                    (Nota √ó Peso + Nota √ó Peso) √∑ Soma dos Pesos
                </div>
            </div>

            <p>Use o simulador de notas para ver como o peso muda tudo:</p>

            [WIDGET:interactive_weighted_grades]
        `,

            "Amplitude de um conjunto de dados": `
            <h3>1. O Tamanho do Salto üèÉ‚Äç‚ôÇÔ∏è</h3>
            <p>A m√©dia conta o centro, mas a <strong>Amplitude</strong> conta a dist√¢ncia. Ela mede o "espalhamento" dos seus dados.</p>
            <p>√â a diferen√ßa entre o <strong>MAIOR</strong> valor (o teto) e o <strong>MENOR</strong> valor (o ch√£o).</p>
            
            <div class="bg-orange-50 p-4 rounded-xl border-l-4 border-brand-orange my-4 text-center font-bold text-brand-text">
                Amplitude = M√°ximo - M√≠nimo
            </div>

            <h3>2. Desafio do Clima ‚òÄÔ∏è‚ùÑÔ∏è</h3>
            <p>Analise as temperaturas da semana e encontre a amplitude t√©rmica. Cuidado para n√£o pegar os n√∫meros do meio!</p>

            [WIDGET:interactive_range_finder]
        `,

            "Gr√°ficos de Setores (Pizza): Constru√ß√£o e Interpreta√ß√£o (uso de %)": `
            <h3>1. Comendo Pelas Bordas üçï</h3>
            <p>O Gr√°fico de Setores (ou Pizza) serve para mostrar <strong>partes de um todo</strong>. O c√≠rculo inteiro representa 100%.</p>
            <p>Para desenhar, precisamos transformar a <strong>Porcentagem (%)</strong> em <strong>Graus (¬∞)</strong>, porque o c√≠rculo tem 360¬∞.</p>

            <div class="bg-green-50 p-4 rounded-xl border-2 border-green-200 my-4 text-sm shadow-sm">
                <strong>A Regra de Ouro:</strong><br>
                1% da Pizza = 3,6 graus.
                <br>
                (Basta multiplicar a porcentagem por 3,6)
            </div>

            <p>Ajuste os ingredientes da pizza e veja como o gr√°fico muda:</p>

            [WIDGET:interactive_pie_maker]
        `,

            //
            // OITAVO ANO
            //

            // =================================================================
            // CONTE√öDO 8¬∫ ANO
            // =================================================================

            // =======================================================
            // UNIDADE 1: C√ÅLCULO ALG√âBRICO - MON√îMIOS
            // =======================================================

            "Revis√£o: Vari√°veis e Generaliza√ß√£o": `
            <h3>1. O Idioma da Matem√°tica üó£Ô∏è</h3>
            <p>At√© agora, voc√™ usou n√∫meros para contar coisas espec√≠ficas (3 ma√ß√£s). A √Ålgebra usa <strong>Vari√°veis</strong> (letras) para falar de coisas gerais.</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm">
                <strong>O que √© a Vari√°vel?</strong><br>
                √â uma caixa fechada. Sabemos que tem um n√∫mero dentro, mas n√£o sabemos qual. Chamamos essa caixa de $x$, $y$ ou $a$.
            </div>

            <p><strong>Generaliza√ß√£o:</strong> Em vez de dizer "2 + 2 = 4", a √°lgebra diz "um n√∫mero mais ele mesmo √© o dobro dele" ($x + x = 2x$).</p>
        `,

            "Mon√¥mios: Coeficiente e Parte Literal": `
            <h3>1. A Anatomia do Mon√¥mio üêú</h3>
            <p>Um <strong>Mon√¥mio</strong> √© um termo alg√©brico "solteiro". Ele n√£o tem somas nem subtra√ß√µes dentro dele, apenas multiplica√ß√µes.</p>
            <p>Ele √© formado por duas partes, como um inseto tem cabe√ßa e corpo:</p>

            <div class="flex justify-center my-6">
                <div class="flex items-center gap-1 font-mono text-5xl font-black">
                    <div class="flex flex-col items-center group">
                        <span class="text-brand-purple">-5</span>
                        <span class="text-[10px] text-gray-400 font-sans font-bold uppercase mt-2 opacity-50 group-hover:opacity-100 transition-opacity">Coeficiente</span>
                    </div>
                    <div class="flex flex-col items-center group">
                        <span class="text-brand-orange">x¬≤y</span>
                        <span class="text-[10px] text-gray-400 font-sans font-bold uppercase mt-2 opacity-50 group-hover:opacity-100 transition-opacity">Parte Literal</span>
                    </div>
                </div>
            </div>

            <p>Mexa nos controles para criar seu pr√≥prio mon√¥mio:</p>
            
            [WIDGET:interactive_monomial_builder]
        `,

            "Grau de um Mon√¥mio": `
            <h3>1. O Peso do Mon√¥mio üèãÔ∏è</h3>
            <p>O grau de um mon√¥mio √© a soma de todos os expoentes da parte literal (as letras).</p>
            
            <div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 my-4 text-sm shadow-sm">
                <strong class="text-yellow-800">Regra de Ouro:</strong><br>
                Se a letra n√£o tem expoente, vale <strong>1</strong> (o expoente invis√≠vel).<br>
                N√∫meros sozinhos (sem letra) t√™m grau <strong>0</strong>.
            </div>

            <p>Exemplo: $3x^2y^3$ &rarr; Soma: $2 + 3 = 5$. √â do 5¬∫ grau.</p>
        `,

            "Mon√¥mios Semelhantes": `
            <h3>1. A Fam√≠lia das Letras üë®‚Äçüë©‚Äçüëß‚Äçüë¶</h3>
            <p>Dois mon√¥mios s√£o <strong>Semelhantes</strong> se tiverem a mesma "Parte Literal" (as mesmas letras com os mesmos expoentes).</p>
            <p>O n√∫mero da frente (coeficiente) n√£o importa. O que define a fam√≠lia √© o "sobrenome" (as letras).</p>

            <div class="grid grid-cols-2 gap-4 my-4">
                <div class="bg-green-50 p-3 rounded-lg border border-green-200 text-center">
                    <span class="text-xl">‚úÖ</span><br>
                    <strong>$2x^2$ e $5x^2$</strong><br>
                    <span class="text-xs text-green-700">Mesma parte literal ($x^2$)</span>
                </div>
                <div class="bg-red-50 p-3 rounded-lg border border-red-200 text-center">
                    <span class="text-xl">‚ùå</span><br>
                    <strong>$2x^2$ e $2x$</strong><br>
                    <span class="text-xs text-red-700">Expoentes diferentes!</span>
                </div>
            </div>

            [WIDGET:interactive_like_terms_sorter]
        `,

            "Adi√ß√£o e Subtra√ß√£o de Mon√¥mios": `
            <h3>1. S√≥ Pode Somar Frutas Iguais üçé</h3>
            <p>Voc√™ pode somar 2 Bananas + 3 Bananas (= 5 Bananas). Mas n√£o pode somar 2 Bananas + 3 Laranjas.</p>
            <p>Na √°lgebra, s√≥ podemos somar ou subtrair <strong>Mon√¥mios Semelhantes</strong>.</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4">
                <p class="font-bold text-brand-blue mb-2">Como fazer:</p>
                <ol class="list-decimal list-inside text-sm text-gray-700 space-y-1">
                    <li>Mant√©m a parte literal (a fruta).</li>
                    <li>Soma/Subtrai os coeficientes (a quantidade).</li>
                </ol>
            </div>

            <p>Use o laborat√≥rio para combinar as pe√ßas:</p>

            [WIDGET:interactive_algebra_tiles_add]
        `,

            "Multiplica√ß√£o de Mon√¥mios (Propriedades de Pot√™ncia)": `
            <h3>1. A Fus√£o Total üí•</h3>
            <p>Na multiplica√ß√£o, tudo se mistura! N√£o precisa ser semelhante.</p>
            <p>Multiplicamos <strong>N√∫mero com N√∫mero</strong> e <strong>Letra com Letra</strong>.</p>
            
            <div class="bg-purple-50 p-4 rounded-xl border-2 border-purple-200 my-4 text-center">
                <p class="text-xs text-purple-800 font-bold uppercase mb-2">Propriedade das Pot√™ncias</p>
                <p class="font-mono text-xl">x·µÉ ¬∑ x·µá = x·µÉ‚Å∫·µá</p>
                <p class="text-sm text-gray-500 mt-1">(Repete a base e SOMA os expoentes)</p>
            </div>

            <p>Exemplo: $(2x^2) \\cdot (3x^3) = 6x^5$.</p>
        `,

            "Divis√£o de Mon√¥mios": `
            <h3>1. O Duelo de Cima e Baixo ‚öîÔ∏è</h3>
            <p>A divis√£o √© uma fra√ß√£o. Dividimos os coeficientes normalmente e usamos a regra da pot√™ncia para as letras.</p>
            
            <div class="bg-orange-50 p-4 rounded-xl border-2 border-orange-200 my-4 text-center">
                <p class="text-xs text-orange-800 font-bold uppercase mb-2">Propriedade das Pot√™ncias</p>
                <p class="font-mono text-xl">x·µÉ √∑ x·µá = x·µÉ‚Åª·µá</p>
                <p class="text-sm text-gray-500 mt-1">(Repete a base e SUBTRAI os expoentes)</p>
            </div>
            
            [WIDGET:interactive_monomial_division]
        `,

            "Potencia√ß√£o de Mon√¥mios": `
            <h3>1. O Chuveirinho da Pot√™ncia üöø</h3>
            <p>Quando um mon√¥mio est√° elevado a uma pot√™ncia, o expoente "chove" em todo mundo que est√° dentro: no n√∫mero e na letra.</p>
            <p><strong>Cuidado:</strong> Pot√™ncia de Pot√™ncia n√≥s MULTIPLICAMOS os expoentes.</p>
            
            <div class="flex justify-center my-6">
                <div class="bg-white p-4 rounded-xl border-2 border-gray-300 font-mono text-xl">
                    $(3x^2)^3 = 3^3 \\cdot x^{2 \\cdot 3} = 27x^6$
                </div>
            </div>
        `,

            // =======================================================
            // UNIDADE 2: POLIN√îMIOS
            // =======================================================

            "Defini√ß√£o e Classifica√ß√£o (Bin√¥mio, Trin√¥mio)": `
            <h3>1. O Trem da √Ålgebra üöÇ</h3>
            <p>Um <strong>Polin√¥mio</strong> √© uma soma de v√°rios mon√¥mios (termos). √â como um trem com v√°rios vag√µes.</p>
            <p>Eles ganham nomes especiais dependendo do n√∫mero de vag√µes (termos n√£o-semelhantes):</p>

            <ul class="space-y-2 mt-4 text-sm text-gray-700">
                <li class="flex items-center gap-2"><span class="bg-blue-100 text-blue-800 px-2 rounded font-bold">1</span> <strong>Mon√¥mio:</strong> $3x$ (Mono = Um)</li>
                <li class="flex items-center gap-2"><span class="bg-green-100 text-green-800 px-2 rounded font-bold">2</span> <strong>Bin√¥mio:</strong> $3x + 2y$ (Bi = Dois)</li>
                <li class="flex items-center gap-2"><span class="bg-orange-100 text-orange-800 px-2 rounded font-bold">3</span> <strong>Trin√¥mio:</strong> $x^2 + 5x + 6$ (Tri = Tr√™s)</li>
                <li class="flex items-center gap-2"><span class="bg-purple-100 text-purple-800 px-2 rounded font-bold">4+</span> <strong>Polin√¥mio:</strong> (Poli = Muitos)</li>
            </ul>
        `,

            "Grau de um Polin√¥mio": `
            <h3>1. Quem √© o L√≠der? üëë</h3>
            <p>Um polin√¥mio √© como uma gangue de termos. O "Chefe" (o Grau) √© determinado pelo termo mais forte, ou seja, aquele que tem o <strong>maior expoente</strong>.</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 shadow-sm">
                <strong>Regra do Chefe:</strong><br>
                Olhe apenas para os expoentes das letras. O maior n√∫mero vence.<br>
                Ex: $3x^4 + 2x^2 - 10$. O grau √© <strong>4</strong>.
            </div>

            <p><strong>Cuidado com os disfarces!</strong> Se tivermos v√°rias letras juntas ($x^2y^3$), somamos os expoentes delas para saber a for√ßa daquele termo.</p>

            [WIDGET:interactive_poly_degree_quiz]
        `,

            "Polin√¥mio Reduzido": `
            <h3>1. A Alquimia Alg√©brica üß™</h3>
            <p>Um polin√¥mio "bagun√ßado" tem termos repetidos espalhados, tipo: $2x + 3y + 4x - y$.</p>
            <p>Para reduzir, precisamos organizar a casa: juntar <strong>Termos Semelhantes</strong> (os que t√™m a mesma parte literal, ou seja, as mesmas letras com os mesmos expoentes).</p>

            <div class="grid grid-cols-2 gap-4 my-4 text-center">
                <div class="bg-green-100 p-2 rounded-lg border border-green-300">
                    <span class="text-2xl">üçé + üçé</span><br>
                    <strong>Pode juntar!</strong><br>
                    $2x + 3x = 5x$
                </div>
                <div class="bg-red-100 p-2 rounded-lg border border-red-300">
                    <span class="text-2xl">üçé + üçå</span><br>
                    <strong>N√£o mistura!</strong><br>
                    $2x + 3y$ (Fica assim)
                </div>
            </div>

            <p>Ajude o Alquimista a organizar as po√ß√µes juntando os frascos iguais:</p>

            [WIDGET:interactive_alchemy_reducer]
        `,

            "Adi√ß√£o e Subtra√ß√£o de Polin√¥mios": `
            <h3>1. Juntando Equipes ü§ù</h3>
            <p>Somar polin√¥mios √© f√°cil: basta tirar os par√™nteses e juntar os semelhantes (Alquimia novamente!).</p>
            
            <h3>2. O Perigo do Sinal de Menos ‚õî</h3>
            <p>Quando vamos <strong>subtrair</strong> um polin√¥mio, o sinal de menos na frente dos par√™nteses funciona como um "Inversor de Humor". Ele troca o sinal de <strong>TODO MUNDO</strong> que est√° l√° dentro.</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 text-center my-4 font-mono text-lg">
                -(3x + 5) <span class="text-gray-400">vira</span> <strong class="text-brand-red">-3x - 5</strong>
            </div>

            [WIDGET:interactive_poly_subtraction_wall]
        `,

            "Multiplica√ß√£o de Polin√¥mio por Mon√¥mio": `
            <h3>1. A Regra do Chuveirinho üöø</h3>
            <p>Lembra da Propriedade Distributiva? Aqui ela reina absoluta. O termo de fora tem que multiplicar <strong>TODOS</strong> os termos de dentro.</p>
            
            <ul class="list-disc list-inside bg-white p-4 rounded-xl border border-gray-200 space-y-2 mb-4 text-sm text-gray-600">
                <li><strong>N√∫mero com N√∫mero:</strong> Multiplica normal ($2 \\cdot 3 = 6$).</li>
                <li><strong>Letra com Letra:</strong> Soma os expoentes ($x^2 \\cdot x^3 = x^5$).</li>
            </ul>

            <p>Visualize isso como a √°rea de ret√¢ngulos unidos:</p>

            [WIDGET:interactive_poly_mult_area]
        `,

            "Multiplica√ß√£o de Polin√¥mio por Polin√¥mio": `
            <h3>1. A Propriedade Distributiva Dupla üëØ‚Äç‚ôÇÔ∏è</h3>
            <p>Para multiplicar $(x + 2) \\cdot (x + 3)$, cada termo do primeiro par√™nteses tem que cumprimentar (multiplicar) cada termo do segundo.</p>
            
            <h3>2. O M√©todo da √Årea (A Caixa) üì¶</h3>
            <p>A melhor forma de visualizar isso √© calcular a √°rea de um ret√¢ngulo dividido. √â infal√≠vel!</p>

            [WIDGET:interactive_poly_box_mult]
        `,

            "Divis√£o de Polin√¥mio por Mon√¥mio": `
            <h3>1. O Cortador de Pizza üçï</h3>
            <p>Dividir um polin√¥mio grande por um mon√¥mio pequeno √© como cortar peda√ßos de pizza. Voc√™ divide <strong>cada termo</strong> de cima pelo termo de baixo, um por um.</p>

            <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-brand-purple my-4 text-sm">
                <strong>O Processo:</strong>
                <ol class="list-decimal list-inside mt-2 space-y-1">
                    <li>Quebre a fra√ß√£o grande em fra√ß√µes pequenas.</li>
                    <li>Divida os n√∫meros.</li>
                    <li>Subtraia os expoentes das letras iguais (propriedade das pot√™ncias).</li>
                </ol>
            </div>

            [WIDGET:interactive_poly_div_splitter]
        `,

            // =======================================================
            // 8¬∫ ANO: UNIDADE 3 - PRODUTOS NOT√ÅVEIS
            // =======================================================

            "Quadrado da Soma de Dois Termos (Interpreta√ß√£o Geom√©trica e Alg√©brica)": `
            <h3>1. O Quadrado M√°gico üü¶</h3>
            <p>Voc√™ j√° viu que $3^2 = 9$. Mas e se o n√∫mero for uma soma, tipo $(x + 5)^2$?</p>
            <p>Muitos alunos erram dizendo que √© $x^2 + 25$. <strong>ISSO EST√Å ERRADO!</strong> Faltou o miolo do sandu√≠che!</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm">
                <strong>A Regra de Ouro:</strong>
                <br>O quadrado do primeiro ($a^2$)
                <br>Mais duas vezes o primeiro pelo segundo ($2ab$)
                <br>Mais o quadrado do segundo ($b^2$).
            </div>

            <p>Veja geometricamente por que esse "2ab" existe. Ele s√£o os dois ret√¢ngulos que completam a √°rea:</p>

            [WIDGET:interactive_square_sum_v2]
        `,

            "Quadrado da Diferen√ßa de Dois Termos": `
            <h3>1. Recortando √Åreas ‚úÇÔ∏è</h3>
            <p>E se for de menos? $(a - b)^2$.</p>
            <p>Imagine que voc√™ tem um quadrado grande ($a^2$) e quer arrancar peda√ßos dele. A regra √© quase igual √† da soma, mas o "miolo" √© subtra√≠do.</p>
            
            <div class="text-center font-mono text-xl bg-gray-100 p-3 rounded-xl border-2 border-gray-300 my-4">
                $(a - b)^2 = a^2 \\mathbf{- 2ab} + b^2$
            </div>

            <p><strong>Por que mais $b^2$?</strong> Porque quando tiramos os dois ret√¢ngulos ($2ab$), acabamos tirando o quadradinho do canto ($b^2$) duas vezes! Precisamos colocar um de volta para corrigir.</p>
        `,

            "Produto da Soma pela Diferen√ßa de Dois Termos": `
            <h3>1. O Truque do Corte e Cola üß©</h3>
            <p>Este √© o produto not√°vel mais elegante. O que acontece se multiplicarmos $(a + b)$ por $(a - b)$?</p>
            <p>O termo do meio se cancela! $+ab$ e $-ab$ somem.</p>

            <div class="bg-green-50 p-4 rounded-xl border-l-4 border-brand-green my-4 text-center">
                <span class="text-lg font-bold text-green-800">Quadrado do 1¬∫ - Quadrado do 2¬∫</span>
                <div class="text-2xl font-mono font-black mt-2 text-brand-green">a¬≤ - b¬≤</div>
            </div>

            <p>Veja a m√°gica acontecer: transformamos uma forma estranha em um ret√¢ngulo perfeito apenas movendo uma pe√ßa.</p>

            [WIDGET:interactive_diff_squares_geom]
        `,

            "Cubo da Soma e Cubo da Diferen√ßa (Intro)": `
            <h3>1. Bem-vindo √† 3¬™ Dimens√£o üßä</h3>
            <p>Quando elevamos ao quadrado, pensamos em √Årea (2D). Quando elevamos ao cubo $(a+b)^3$, pensamos em <strong>Volume (3D)</strong>.</p>
            <p>O "Cub√£o" √© formado por 8 blocos menores:</p>
            <ul class="list-disc list-inside text-sm text-gray-600 bg-white p-4 rounded-xl border border-gray-200">
                <li>1 Cubo Grande ($a^3$)</li>
                <li>3 Placas ($a^2b$)</li>
                <li>3 Barras ($ab^2$)</li>
                <li>1 Cubinho ($b^3$)</li>
            </ul>

            <p>Explore o modelo 3D para ver essas pe√ßas se encaixando:</p>

            [WIDGET:interactive_cube_expansion]
        `,

            "Quadrado do Trin√¥mio (Aprofundamento)": `
            <h3>1. A Expans√£o do Universo üåå</h3>
            <p>E se tivermos 3 termos? $(a + b + c)^2$.</p>
            <p>A l√≥gica geom√©trica continua! Voc√™ ter√° um quadrado gigante dividido em 9 √°reas:</p>
            <ul class="grid grid-cols-3 gap-2 text-center text-xs font-mono font-bold my-4">
                <li class="bg-blue-100 p-2 rounded">a¬≤</li> <li class="bg-gray-100 p-2 rounded">ab</li> <li class="bg-gray-100 p-2 rounded">ac</li>
                <li class="bg-gray-100 p-2 rounded">ab</li> <li class="bg-orange-100 p-2 rounded">b¬≤</li> <li class="bg-gray-100 p-2 rounded">bc</li>
                <li class="bg-gray-100 p-2 rounded">ac</li> <li class="bg-gray-100 p-2 rounded">bc</li> <li class="bg-green-100 p-2 rounded">c¬≤</li>
            </ul>
            <p class="text-center font-bold">Resultado: $a^2 + b^2 + c^2 + 2ab + 2ac + 2bc$</p>
        `,

            // =======================================================
            // 8¬∫ ANO: UNIDADE 4 - FATORA√á√ÉO ALG√âBRICA
            // =======================================================

            "Fator Comum em Evid√™ncia": `
            <h3>1. O Im√£ de N√∫meros üß≤</h3>
            <p>Fatorar √© o contr√°rio de multiplicar. √â descobrir "quem multiplicou todo mundo".</p>
            <p>Olhe para $4x + 6$. O que os dois t√™m em comum? O n√∫mero 2 est√° escondido dentro do 4 e do 6!</p>
            
            <div class="bg-white p-4 rounded-xl border-2 border-brand-purple my-4 flex flex-col items-center">
                <div class="text-xl text-gray-400 mb-2">2¬∑2¬∑x + 2¬∑3</div>
                <div class="text-2xl font-black text-brand-purple">2(2x + 3)</div>
            </div>

            <p>Use o "Extrator de Fatores" para puxar o n√∫mero comum para fora:</p>

            [WIDGET:interactive_factor_extractor]
        `,

            "Fatora√ß√£o por Agrupamento": `
            <h3>1. Formando Duplas ü§ù</h3>
            <p>√Äs vezes n√£o existe um fator comum para todo mundo. Mas se formarmos "panelinhas" (grupos), a m√°gica acontece.</p>
            <p>Exemplo: $ax + ay + bx + by$.</p>
            <ol class="list-decimal list-inside text-sm space-y-2 mt-2">
                <li>Agrupe os "As": $a(x+y)$</li>
                <li>Agrupe os "Bs": $b(x+y)$</li>
                <li>Olha o milagre! O $(x+y)$ apareceu duas vezes. Coloque ele em evid√™ncia!</li>
            </ol>
            <div class="text-center font-black mt-2 text-brand-blue">(x + y)(a + b)</div>

            [WIDGET:interactive_grouping_puzzle]
        `,

            "Diferen√ßa de Dois Quadrados": `
            <h3>1. A Viagem no Tempo ‚è≥</h3>
            <p>Lembra do produto da soma pela diferen√ßa? $a^2 - b^2 = (a+b)(a-b)$.</p>
            <p>Agora vamos fazer o caminho de volta. Sempre que voc√™ vir <strong>Dois Quadrados</strong> se <strong>Subtraindo</strong>, voc√™ pode fatorar.</p>

            <div class="grid grid-cols-2 gap-4 my-4">
                <div class="bg-red-50 p-3 rounded-lg border border-red-200 text-center">
                    <strong class="text-red-700 block text-xs uppercase">Suspeito</strong>
                    <div class="text-xl font-black text-gray-700">$x^2 - 9$</div>
                    <div class="text-[10px] text-gray-500">Tem menos? Tem quadrado?</div>
                </div>
                <div class="bg-green-50 p-3 rounded-lg border border-green-200 text-center">
                    <strong class="text-green-700 block text-xs uppercase">Fatorado</strong>
                    <div class="text-xl font-black text-brand-green">$(x+3)(x-3)$</div>
                </div>
            </div>

            [WIDGET:interactive_squares_detective]
        `,

            "Trin√¥mio Quadrado Perfeito": `
            <h3>1. O Detetive do TQP üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
            <p>Nem todo trin√¥mio √© perfeito. Para ser perfeito, ele tem que ter nascido de um $(a+b)^2$.</p>
            <p><strong>O Teste de DNA:</strong></p>
            <ul class="list-none space-y-2 text-sm bg-white p-4 rounded-xl border border-gray-200">
                <li>1. O primeiro termo tem raiz exata? ($\\sqrt{a^2} = a$)</li>
                <li>2. O √∫ltimo termo tem raiz exata? ($\\sqrt{b^2} = b$)</li>
                <li>3. O meio √© exatamente $2 \\cdot a \\cdot b$?</li>
            </ul>
            <p class="text-center font-bold text-brand-blue mt-2">Se sim, √© Perfeito!</p>
        `,

            "Soma e Diferen√ßa de Cubos (Opcional/Aprofundamento)": `
<h3>1. O Cubo M√°gico Desmontado üßä</h3>
            <p>Quando falamos de $a^3$ e $b^3$, estamos falando de volumes! A express√£o $a^3 - b^3$ significa geometricamente: "Tenho um cubo grande de lado $a$ e arranquei um cubo pequeno de lado $b$ do canto".</p>
            <p>O que sobra dessa subtra√ß√£o n√£o √© uma forma perfeita, mas pode ser fatiada em tr√™s blocos retangulares que, juntos, formam a fatora√ß√£o.</p>

            [WIDGET:interactive_cube_diff_3d]

            <h3>2. As F√≥rmulas G√™meas üëØ</h3>
            <p>Existem duas regras, uma para soma e outra para subtra√ß√£o. Elas s√£o quase id√™nticas, s√≥ mudam os sinais.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue shadow-sm">
                    <h4 class="font-bold text-brand-blue mb-2">Soma de Cubos (+)</h4>
                    <p class="font-mono text-lg">
                        $a^3 + b^3 = (a + b)(a^2 - ab + b^2)$
                    </p>
                </div>
                <div class="bg-orange-50 p-4 rounded-xl border-l-4 border-brand-orange shadow-sm">
                    <h4 class="font-bold text-brand-orange mb-2">Diferen√ßa de Cubos (-)</h4>
                    <p class="font-mono text-lg">
                        $a^3 - b^3 = (a - b)(a^2 + ab + b^2)$
                    </p>
                </div>
            </div>

            <h3>3. A Regra do "S.O.P." (Sinais) üö¶</h3>
            <p>Para n√£o errar o sinal, usamos um truque de mem√≥ria. Olhe para os sinais da f√≥rmula expandida na ordem que aparecem:</p>
            <ul class="list-none space-y-2 bg-gray-100 p-4 rounded-xl font-bold text-gray-600 text-sm">
                <li>1. <span class="text-brand-green">S</span>ame (Mesmo sinal do original)</li>
                <li>2. <span class="text-brand-red">O</span>pposite (Sinal Oposto)</li>
                <li>3. <span class="text-brand-blue">P</span>ositive (Sempre Positivo no fim)</li>
            </ul>

            <p>Teste a m√°quina de sinais para ver o S.O.P. em a√ß√£o:</p>

            [WIDGET:interactive_soap_machine]

            <h3>4. Desafio: Ca√ßador de Cubos ü•∑</h3>
            <p>Antes de fatorar, voc√™ precisa reconhecer quem s√£o os cubos perfeitos ($1, 8, 27, 64, 125...$). Corte apenas os n√∫meros que t√™m raiz c√∫bica exata!</p>

            [WIDGET:interactive_cube_ninja]
`,

            // =======================================================
            // 8¬∫ ANO: UNIDADE 5 - FRA√á√ïES ALG√âBRICAS
            // =======================================================

            "Defini√ß√£o e Condi√ß√£o de Exist√™ncia": `
            <h3>1. O Que √© uma Fra√ß√£o Alg√©brica? üß¨</h3>
            <p>Uma fra√ß√£o s√≥ ganha o t√≠tulo de "Alg√©brica" se tiver uma **letra no denominador** (na parte de baixo).</p>
            
            <div class="grid grid-cols-2 gap-4 my-4 text-center">
                <div class="bg-green-50 p-4 rounded-xl border-2 border-green-200">
                    <span class="text-2xl font-black text-brand-green">$\\frac{2}{x}$</span>
                    <p class="text-xs font-bold text-green-700 mt-2 uppercase">√â Alg√©brica</p>
                    <p class="text-[10px] text-gray-500">Tem letra embaixo!</p>
                </div>
                <div class="bg-red-50 p-4 rounded-xl border-2 border-red-200">
                    <span class="text-2xl font-black text-gray-400">$\\frac{x}{2}$</span>
                    <p class="text-xs font-bold text-gray-500 mt-2 uppercase">N√£o √â</p>
                    <p class="text-[10px] text-gray-400">Embaixo s√≥ tem n√∫mero.</p>
                </div>
            </div>

            <h3>2. A Regra Sagrada: O Denominador Proibido üö´</h3>
            <p>Existe um mandamento supremo na matem√°tica: <strong>"N√£o dividir√°s por zero"</strong>.</p>
            <p>Como temos letras embaixo, precisamos descobrir qual valor elas <strong>N√ÉO</strong> podem assumir, sen√£o o universo matem√°tico explode. Chamamos isso de <strong>Condi√ß√£o de Exist√™ncia (C.E.)</strong>.</p>

            <div class="bg-gray-800 text-white p-4 rounded-xl shadow-lg my-4 text-center">
                <p class="text-sm font-bold text-gray-400 uppercase mb-2">Miss√£o</p>
                <p class="text-lg">Descobrir o valor de $x$ que zera o denominador.</p>
                <div class="font-mono text-brand-yellow text-xl mt-2">Denominador $\\neq$ 0</div>
            </div>

            <p>Use o simulador de perigo para testar valores:</p>

            [WIDGET:interactive_existence_condition]
        `,

            "Simplifica√ß√£o de Fra√ß√µes Alg√©bricas (Uso da Fatora√ß√£o)": `
            <h3>1. A Arte de Cortar (Sem Matar a Matem√°tica) ‚úÇÔ∏è</h3>
            <p>Simplificar √© tornar a fra√ß√£o mais leve. Para isso, precisamos transformar tudo em multiplica√ß√£o (Fatorar) e cortar os "g√™meos" de cima e de baixo.</p>

            <div class="bg-red-50 p-4 rounded-xl border-l-4 border-brand-red my-4 shadow-sm text-sm">
                <strong class="text-brand-red"><i class="fas fa-skull-crossbones"></i> CRIME MATEM√ÅTICO:</strong>
                <br>Voc√™ <strong>N√ÉO</strong> pode cortar termos que est√£o somando ou subtraindo!
                <br>‚ùå $\\frac{x + 2}{2}$ (Cortar o 2? Jamais! O $x$ est√° "colado" nele pela soma).
            </div>

            <h3>2. O Processo de 2 Passos üë£</h3>
            <ol class="list-decimal list-inside space-y-2 bg-white p-4 rounded-xl border border-gray-200 text-sm text-gray-700">
                <li><strong>Fatorar:</strong> Use fator comum, trin√¥mio ou diferen√ßa de quadrados para criar multiplica√ß√µes.</li>
                <li><strong>Cortar:</strong> Elimine os par√™nteses id√™nticos em cima e embaixo.</li>
            </ol>

            <p>Pratique sua pontaria no Dojo de Simplifica√ß√£o:</p>

            [WIDGET:interactive_cancel_ninja]
        `,

            "Adi√ß√£o e Subtra√ß√£o (MMC de Polin√¥mios)": `
            <h3>1. O Retorno do MMC üßü‚Äç‚ôÇÔ∏è</h3>
            <p>Lembra que para somar $\\frac{1}{2} + \\frac{1}{3}$ precis√°vamos do MMC? Com letras √© a mesma coisa!</p>
            <p>Se os denominadores s√£o diferentes (ex: $x$ e $y$), n√£o podemos somar direto. Precisamos criar um denominador comum que sirva para os dois.</p>

            <div class="bg-blue-50 p-4 rounded-xl border-2 border-brand-blue my-4 text-center">
                <p class="text-xs font-bold text-gray-400 uppercase mb-2">Receita do MMC Alg√©brico</p>
                <p class="font-medium text-brand-blue text-sm">"Pegue todos os fatores diferentes, com seus maiores expoentes."</p>
                <div class="mt-2 font-mono bg-white p-2 rounded inline-block text-gray-600 border border-blue-200 text-xs">
                    MMC de (x) e (x+1) = x(x+1)
                </div>
            </div>

            <p>Ajude a construir o denominador perfeito:</p>

            [WIDGET:interactive_poly_lcm_builder]
        `,

            "Multiplica√ß√£o e Divis√£o de Fra√ß√µes Alg√©bricas": `
            <h3>1. Multiplica√ß√£o: O Caminho Reto üõ§Ô∏è</h3>
            <p>Esta √© a opera√ß√£o mais f√°cil! Multiplica-se <strong>Numerador com Numerador</strong> e <strong>Denominador com Denominador</strong>.</p>
            <p><em>Dica de Ouro:</em> Simplifique (corte) antes de multiplicar para evitar contas gigantes.</p>

            <h3>2. Divis√£o: A Cambalhota ü§∏</h3>
            <p>Dividir por uma fra√ß√£o √© o mesmo que multiplicar pelo inverso dela. A regra √©: <strong>"Mant√©m a primeira, inverte a segunda"</strong>.</p>

            <div class="flex justify-center items-center gap-4 my-6 font-mono text-xl">
                <div class="flex flex-col items-center">
                    <span>A</span>
                    <div class="w-full h-0.5 bg-black"></div>
                    <span>B</span>
                </div>
                <div class="text-brand-orange font-bold">√∑</div>
                <div class="flex flex-col items-center group cursor-pointer transition-transform hover:scale-110">
                    <span class="group-hover:text-brand-blue">C</span>
                    <div class="w-full h-0.5 bg-black"></div>
                    <span class="group-hover:text-brand-blue">D</span>
                </div>
                <div class="text-gray-400">‚ûú</div>
                <div class="flex flex-col items-center">
                    <span>A</span>
                    <div class="w-full h-0.5 bg-black"></div>
                    <span>B</span>
                </div>
                <div class="text-brand-green font-bold">√ó</div>
                <div class="flex flex-col items-center">
                    <span class="text-brand-blue font-bold">D</span>
                    <div class="w-full h-0.5 bg-black"></div>
                    <span class="text-brand-blue font-bold">C</span>
                </div>
            </div>

            <p>Use o cart√£o interativo para visualizar a invers√£o:</p>

            [WIDGET:interactive_alg_flip_card]
        `,

            // =======================================================
            // 8¬∫ ANO: UNIDADE 6 - SISTEMAS DE EQUA√á√ÉOD O 1¬∫ GRAU
            // =======================================================

            "Equa√ß√£o Linear com duas inc√≥gnitas (Solu√ß√µes infinitas/Gr√°fico de Reta)": `
            <h3>1. O Jogo das Possibilidades üé≤</h3>
            <p>Imagine a equa√ß√£o: <strong>$x + y = 5$</strong>.</p>
            <p>Qual √© a resposta? Depende! Se $x=1$, ent√£o $y=4$. Se $x=2$, $y=3$. Se $x=0$, $y=5$.</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm">
                <strong>Conceito Chave:</strong><br>
                Uma √∫nica equa√ß√£o com duas letras tem <strong>infinitas solu√ß√µes</strong>. Cada solu√ß√£o √© um <strong>Par Ordenado (x, y)</strong>.
            </div>

            <h3>2. A Reta M√°gica üìâ</h3>
            <p>Se voc√™ desenhar todas as solu√ß√µes poss√≠veis num gr√°fico, elas se alinham perfeitamente formando uma <strong>RETA</strong>.</p>
            <p>Tente encontrar pares que somam o alvo e veja a reta aparecer:</p>

            [WIDGET:interactive_linear_plotter]
        `,

            "Sistemas 2x2: Conceito de Solu√ß√£o Simult√¢nea": `
            <h3>1. O Cruzamento dos Caminhos ‚ùå</h3>
            <p>Um sistema √© quando temos duas regras (equa√ß√µes) ao mesmo tempo. A solu√ß√£o do sistema √© o par $(x, y)$ que obedece √†s <strong>DUAS</strong> regras simultaneamente.</p>

            <div class="flex justify-center my-6">
                <div class="bg-gray-800 text-white p-4 rounded-xl font-mono text-lg shadow-lg">
                    $\\begin{cases} x + y = 10 \\\\ x - y = 2 \\end{cases}$
                </div>
            </div>

            <p>Visualmente, cada equa√ß√£o √© uma estrada (reta). A solu√ß√£o do sistema √© o <strong>cruzamento</strong> (ponto de intersec√ß√£o).</p>
            
            [WIDGET:interactive_system_intersection]
        `,

            "M√©todo da Substitui√ß√£o": `
            <h3>1. O Poder do Disfarce ü•∏</h3>
            <p>O m√©todo da substitui√ß√£o funciona como trocar um apelido pelo nome real.</p>
            <p>Se uma equa√ß√£o diz que $\\color{blue}y = 2x$ (o Y vale o dobro de X), voc√™ pode ir na outra equa√ß√£o e, onde tiver $y$, trocar por $2x$.</p>

            <div class="bg-green-50 p-4 rounded-xl border-2 border-green-200 my-4 text-sm">
                <strong>O Algoritmo:</strong>
                <ol class="list-decimal list-inside mt-2 space-y-1">
                    <li>Isole uma letra em uma equa√ß√£o.</li>
                    <li>Substitua essa letra na OUTRA equa√ß√£o.</li>
                    <li>Resolva a equa√ß√£o simples que sobrou.</li>
                </ol>
            </div>

            <p>Arraste a express√£o para fazer a substitui√ß√£o:</p>

            [WIDGET:interactive_substitution_drag]
        `,

            "M√©todo da Adi√ß√£o": `
            <h3>1. A Balan√ßa Dupla ‚öñÔ∏è</h3>
            <p>O M√©todo da Adi√ß√£o (ou Elimina√ß√£o) √© o favorito dos matem√°ticos. A ideia √© somar as duas equa√ß√µes em p√© (verticalmente) para que uma das letras "zere" (suma).</p>
            
            <p>√Äs vezes, precisamos preparar o terreno multiplicando uma linha inteira por um n√∫mero (geralmente -1) para criar opostos (tipo $+3x$ e $-3x$).</p>

            [WIDGET:interactive_elimination_tactics]
        `,

            "Interpreta√ß√£o Geom√©trica do Sistema (Retas concorrentes, paralelas, coincidentes)": `
            <h3>1. As Tr√™s Posi√ß√µes Relativas üö¶</h3>
            <p>Quando desenhamos duas retas no mesmo plano, s√≥ existem tr√™s coisas que podem acontecer:</p>

            <ul class="list-none space-y-3 my-4">
                <li class="flex items-center gap-3 bg-white p-3 rounded-lg border border-green-200 shadow-sm">
                    <span class="text-2xl">‚ùå</span>
                    <div>
                        <strong class="text-green-700">Concorrentes (SPD)</strong>
                        <p class="text-xs text-gray-500">Cruzam-se em 1 ponto. Tem 1 solu√ß√£o.</p>
                    </div>
                </li>
                <li class="flex items-center gap-3 bg-white p-3 rounded-lg border border-red-200 shadow-sm">
                    <span class="text-2xl">üõ§Ô∏è</span>
                    <div>
                        <strong class="text-red-700">Paralelas (SI)</strong>
                        <p class="text-xs text-gray-500">Nunca se cruzam. N√£o tem solu√ß√£o.</p>
                    </div>
                </li>
                <li class="flex items-center gap-3 bg-white p-3 rounded-lg border border-yellow-200 shadow-sm">
                    <span class="text-2xl">ü§ù</span>
                    <div>
                        <strong class="text-yellow-700">Coincidentes (SPI)</strong>
                        <p class="text-xs text-gray-500">Uma em cima da outra. Infinitas solu√ß√µes.</p>
                    </div>
                </li>
            </ul>

            <p>Mexa nos controles das retas e veja como a classifica√ß√£o muda:</p>

            [WIDGET:interactive_system_classifier]
        `,

            "Classifica√ß√£o (SPD, SPI, SI)": `
            <h3>1. O Encontro das Retas üö¶</h3>
            <p>Um sistema de equa√ß√µes √© como perguntar: "Onde dois caminhos se cruzam?". Cada equa√ß√£o desenha uma linha reta no mapa (Plano Cartesiano).</p>
            <p>Dependendo de como essas linhas s√£o, podemos ter tr√™s finais para essa hist√≥ria:</p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6">
                
                <div class="bg-green-50 p-4 rounded-xl border-b-4 border-green-400 text-center group hover:-translate-y-1 transition-transform">
                    <div class="text-4xl mb-2">‚ùå</div>
                    <h4 class="font-black text-brand-green uppercase text-sm mb-1">SPD</h4>
                    <p class="text-[10px] font-bold text-gray-400 uppercase">Poss√≠vel e Determinado</p>
                    <p class="text-xs text-gray-600 mt-2"><strong>O Cruzamento.</strong><br>As linhas se cortam em UM ponto √∫nico.<br>(1 Solu√ß√£o)</p>
                </div>

                <div class="bg-red-50 p-4 rounded-xl border-b-4 border-red-400 text-center group hover:-translate-y-1 transition-transform">
                    <div class="text-4xl mb-2">üõ§Ô∏è</div>
                    <h4 class="font-black text-brand-red uppercase text-sm mb-1">SI</h4>
                    <p class="text-[10px] font-bold text-gray-400 uppercase">Imposs√≠vel</p>
                    <p class="text-xs text-gray-600 mt-2"><strong>Os Trilhos.</strong><br>As linhas s√£o paralelas e nunca se tocam.<br>(0 Solu√ß√µes)</p>
                </div>

                <div class="bg-purple-50 p-4 rounded-xl border-b-4 border-purple-400 text-center group hover:-translate-y-1 transition-transform">
                    <div class="text-4xl mb-2">üëØ</div>
                    <h4 class="font-black text-brand-purple uppercase text-sm mb-1">SPI</h4>
                    <p class="text-[10px] font-bold text-gray-400 uppercase">Poss√≠vel e Indeterminado</p>
                    <p class="text-xs text-gray-600 mt-2"><strong>O Clone.</strong><br>√â a mesma linha desenhada duas vezes.<br>(Infinitas Solu√ß√µes)</p>
                </div>

            </div>

            <h3>2. Laborat√≥rio de Retas üìà</h3>
            <p>N√£o precisa decorar! Mexa na inclina√ß√£o e na altura das retas abaixo para ver o que acontece com a classifica√ß√£o.</p>

            [WIDGET:interactive_system_classifier]

            <h3>3. Como saber sem desenhar? üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
            <p>Olhe para os coeficientes (os n√∫meros na frente das letras). Imagine o sistema:</p>
            <div class="font-mono text-center bg-gray-800 text-white p-2 rounded mb-4 text-sm">
                ax + by = c<br>
                dx + ey = f
            </div>
            <ul class="list-none space-y-2 text-sm text-gray-700 bg-white p-4 rounded-xl border border-gray-200">
                <li>‚úÖ <strong>SPD:</strong> A inclina√ß√£o √© diferente ($\\frac{a}{d} \\neq \\frac{b}{e}$). Elas v√£o se bater!</li>
                <li>‚õî <strong>SI:</strong> Inclina√ß√£o igual, mas altura diferente. "Mesma dire√ß√£o, ruas diferentes".</li>
                <li>‚ôæÔ∏è <strong>SPI:</strong> Tudo igual (ou m√∫ltiplo). √â a mesma equa√ß√£o disfar√ßada! ($x+y=2$ e $2x+2y=4$).</li>
            </ul>

            <h3>4. Desafio do Analista üíº</h3>
            <p>Classifique os sistemas r√°pido para ganhar a promo√ß√£o!</p>

            [WIDGET:interactive_system_quiz]
        `,

            "Resolu√ß√£o de Problemas Contextualizados": `
            <h3>1. O Detetive Matem√°tico üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
            <p>Sistemas n√£o servem s√≥ para provas. Eles resolvem enigmas da vida real!</p>
            <p>O segredo √© traduzir o portugu√™s para o "Matematiqu√™s":</p>
            
            <div class="grid grid-cols-1 gap-2 my-4 text-sm">
                <div class="bg-gray-50 p-2 rounded border-l-4 border-brand-purple">
                    "A soma de dois n√∫meros √© 20" ‚ûú <strong>x + y = 20</strong>
                </div>
                <div class="bg-gray-50 p-2 rounded border-l-4 border-brand-orange">
                    "No s√≠tio h√° galinhas e vacas. Total de 10 cabe√ßas e 26 p√©s."<br>
                    ‚ûú Cabe√ßas: <strong>G + V = 10</strong><br>
                    ‚ûú P√©s: <strong>2G + 4V = 26</strong>
                </div>
            </div>

            <p>Vamos resolver o mist√©rio dos animais?</p>

            [WIDGET:interactive_logic_detective]
        `,

            // =======================================================
            // 8¬∫ ANO: UNIDADE 7 - Geometria - Tri√¢ngulos (Pontos Not√°veis e Congru√™ncia)
            // =======================================================

            "Revis√£o: Elementos do Tri√¢ngulo": `
            <h3>O Pol√≠gono Mais Forte üí™</h3>
            <p>O tri√¢ngulo √© a √∫nica forma r√≠gida (n√£o deforma). Por isso √© usado em pontes e telhados. Vamos relembrar seus √≥rg√£os vitais:</p>

            <div class="grid grid-cols-2 gap-4 my-6">
                <div class="bg-blue-50 p-3 rounded-xl border-l-4 border-brand-blue">
                    <strong class="text-brand-blue">V√©rtices</strong>
                    <p class="text-xs text-gray-600">Os "cantos" ou pontos de encontro (A, B, C).</p>
                </div>
                <div class="bg-orange-50 p-3 rounded-xl border-l-4 border-brand-orange">
                    <strong class="text-brand-orange">Lados</strong>
                    <p class="text-xs text-gray-600">As linhas que ligam os v√©rtices.</p>
                </div>
                <div class="bg-green-50 p-3 rounded-xl border-l-4 border-brand-green">
                    <strong class="text-brand-green">√Çngulos Internos</strong>
                    <p class="text-xs text-gray-600">A abertura interna. A soma √© sempre 180¬∞!</p>
                </div>
                <div class="bg-purple-50 p-3 rounded-xl border-l-4 border-brand-purple">
                    <strong class="text-brand-purple">√Çngulos Externos</strong>
                    <p class="text-xs text-gray-600">O que falta para completar 180¬∞ com o interno vizinho.</p>
                </div>
            </div>
        `,

            "Mediana e Baricentro (Centro de Gravidade)": `
            <h3>1. O Ponto de Equil√≠brio ‚öñÔ∏è</h3>
            <p>A <strong>Mediana</strong> √© uma linha justa: ela sai de um v√©rtice e vai exatamente para o <strong>MEIO</strong> do lado oposto, dividindo-o em dois peda√ßos iguais.</p>
            <p>Todo tri√¢ngulo tem 3 medianas. O ponto onde elas se cruzam √© o <strong>BARICENTRO</strong> (G).</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 text-center my-4 shadow-sm">
                <p class="text-sm font-bold text-yellow-800">‚ú® Super Poder do Baricentro</p>
                <p class="text-xs text-gray-600 mt-1">Ele √© o Centro de Gravidade. Se voc√™ cortar um tri√¢ngulo de papel√£o e colocar o dedo no Baricentro, ele fica equilibrado!</p>
            </div>

            <p>Tente equilibrar o tri√¢ngulo encontrando o Baricentro:</p>

            [WIDGET:interactive_triangle_balancer]
        `,

            "Bissetriz e Incentro (C√≠rculo Inscrito)": `
            <h3>1. Dividindo √Çngulos üçï</h3>
            <p>A <strong>Bissetriz</strong> √© a linha que divide um √¢ngulo exatamente no meio.</p>
            <p>O encontro das 3 bissetrizes √© o <strong>INCENTRO</strong> (I). Ele √© o centro de um c√≠rculo que cabe perfeitamente <em>dentro</em> do tri√¢ngulo (Inscrito).</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm">
                <strong>Mn√™mico Ninja:</strong><br>
                <span class="text-brand-blue font-black">B</span>issetriz ‚ûî <span class="text-brand-blue font-black">I</span>ncentro<br>
                (O famoso "BI" da geometria).
            </div>
        `,

            "Altura e Ortocentro": `
            <h3>1. A Medida da Altura üìè</h3>
            <p>A <strong>Altura</strong> √© a linha que sai de um v√©rtice e desce fazendo um √¢ngulo de 90¬∞ (perpendicular) com o ch√£o (lado oposto).</p>
            <p>O encontro das alturas √© o <strong>ORTOCENTRO</strong> (H).</p>

            <div class="bg-red-50 p-4 rounded-xl border-2 border-red-200 my-4 text-sm text-center">
                <i class="fas fa-exclamation-triangle text-brand-red text-2xl mb-2"></i><br>
                <strong>Aten√ß√£o!</strong><br>
                Em tri√¢ngulos "tortos" (Obtus√¢ngulos), o Ortocentro pode ficar <strong>FORA</strong> do tri√¢ngulo!
            </div>
        `,

            "Mediatriz e Circuncentro (C√≠rculo Circunscrito)": `
            <h3>1. A Justi√ßa dos Lados ‚öîÔ∏è</h3>
            <p>A <strong>Mediatriz</strong> n√£o sai do v√©rtice! Ela passa pelo meio do lado fazendo 90¬∞.</p>
            <p>O encontro das mediatrizes √© o <strong>CIRCUNCENTRO</strong> (C). Ele √© o centro de um c√≠rculo que passa <em>por fora</em> dos v√©rtices (Circunscrito).</p>

            <h3>2. Laborat√≥rio dos Pontos Not√°veis üß™</h3>
            <p>Mova os v√©rtices e troque as linhas para ver a m√°gica acontecer. Observe como o Ortocentro e o Circuncentro podem fugir!</p>

            [WIDGET:interactive_triangle_centers]
        `,

            "Conceito de Congru√™ncia de Figuras Planas": `
            <h3>G√™meos Geom√©tricos üëØ‚Äç‚ôÄÔ∏è</h3>
            <p>Na geometria, n√£o dizemos "iguais", dizemos <strong>CONGRUENTES</strong>. Duas figuras s√£o congruentes quando t√™m exatamente o mesmo tamanho e forma.</p>
            <p><strong>O Teste da Superposi√ß√£o:</strong> Se voc√™ recortar uma figura e colocar em cima da outra, elas se encaixam perfeitamente?</p>
        `,

            "Casos de Congru√™ncia de Tri√¢ngulos (LAL, LLL, ALA, LAAo)": `
            <h3>O C√≥digo Secreto do DNA üß¨</h3>
            <p>Para clonar um tri√¢ngulo, voc√™ n√£o precisa medir tudo (3 lados e 3 √¢ngulos). Bastam 3 informa√ß√µes chave!</p>
            
            <div class="space-y-4 my-6">
                <div class="bg-white p-3 rounded-xl border-l-4 border-brand-blue shadow-sm">
                    <strong class="text-brand-blue">LLL (Lado-Lado-Lado)</strong>
                    <p class="text-xs">Se os 3 lados s√£o iguais, os tri√¢ngulos s√£o clones.</p>
                </div>
                <div class="bg-white p-3 rounded-xl border-l-4 border-brand-orange shadow-sm">
                    <strong class="text-brand-orange">LAL (Lado-√Çngulo-Lado)</strong>
                    <p class="text-xs">Dois lados e o √¢ngulo <em>entre eles</em> (o recheio do sandu√≠che).</p>
                </div>
                <div class="bg-white p-3 rounded-xl border-l-4 border-brand-green shadow-sm">
                    <strong class="text-brand-green">ALA (√Çngulo-Lado-√Çngulo)</strong>
                    <p class="text-xs">Um lado e os dois √¢ngulos vizinhos a ele.</p>
                </div>
            </div>

            <p>Use a <strong>M√°quina de Clonagem</strong> para testar os casos:</p>

            [WIDGET:interactive_congruence_machine]
        `,

            "Propriedades do Tri√¢ngulo Is√≥sceles e Equil√°tero": `
            <h3>1. Tri√¢ngulo Is√≥sceles (Pernas Iguais) ü¶µ</h3>
            <p>Se tem 2 lados iguais, tem 2 √¢ngulos da base iguais. √â como uma barraca de camping sim√©trica.</p>

            <h3>2. Tri√¢ngulo Equil√°tero (A Perfei√ß√£o) üíé</h3>
            <p>Tudo igual! 3 lados iguais e 3 √¢ngulos de 60¬∞.</p>

            <div class="bg-purple-50 p-4 rounded-xl border-2 border-purple-200 my-4 shadow-sm text-center">
                <strong>O Fen√¥meno do Alinhamento</strong>
                <p class="text-xs text-gray-600 mt-2">No tri√¢ngulo Equil√°tero, a Mediana, Altura, Bissetriz e Mediatriz s√£o <strong>A MESMA LINHA</strong>! Todos os pontos not√°veis (G, I, H, C) ficam no mesmo lugar.</p>
            </div>

            [WIDGET:interactive_triangle_properties]
        `,

            // =======================================================
            // 8¬∫ ANO: UNIDADE 8 - Geometria - Quadril√°teros
            // =======================================================

            "Soma dos √Çngulos Internos de Quadril√°teros": `
            <h3>1. O Segredo dos Tri√¢ngulos üìê</h3>
            <p>Voc√™ lembra que a soma dos √¢ngulos de um tri√¢ngulo √© sempre 180¬∞? Pois bem, qualquer quadril√°tero (convexo) pode ser dividido em <strong>dois tri√¢ngulos</strong> tra√ßando uma diagonal.</p>
            
            <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-brand-purple my-4 text-sm shadow-sm">
                <strong>A Conta M√°gica:</strong><br>
                2 tri√¢ngulos $\\times$ 180¬∞ = <strong>360¬∞</strong>.
                <br>A soma dos √¢ngulos internos de <em>qualquer</em> quadril√°tero √© sempre 360¬∞.
            </div>

            [WIDGET:interactive_quad_angle_sum]
        `,

            "Paralelogramos: Propriedades (Lados, √Çngulos, Diagonais)": `
            <h3>1. A Fam√≠lia dos Lados Paralelos üõ§Ô∏è</h3>
            <p>Um quadril√°tero √© um <strong>Paralelogramo</strong> quando seus lados opostos s√£o paralelos (como trilhos de trem). Isso gera propriedades incr√≠veis:</p>

            <ul class="list-disc list-inside bg-white p-4 rounded-xl border-2 border-gray-100 space-y-2 text-sm text-gray-700 mb-6">
                <li><strong>Lados:</strong> Os opostos s√£o iguais ($AB = CD$).</li>
                <li><strong>√Çngulos:</strong> Os opostos s√£o iguais ($\\hat{A} = \\hat{C}$). Os vizinhos somam 180¬∞.</li>
                <li><strong>Diagonais:</strong> Elas se cortam exatamente no meio (ponto m√©dio).</li>
            </ul>

            <p>Mexa nos v√©rtices e tente "quebrar" essas regras (spoiler: voc√™ n√£o vai conseguir!):</p>

            [WIDGET:interactive_parallelogram_explorer]
        `,

            "Ret√¢ngulos: Propriedades espec√≠ficas": `
            <h3>1. O √Çngulo Reto üìê</h3>
            <p>O Ret√¢ngulo √© um paralelogramo "endireitado". Ele tem todas as propriedades do paralelogramo, mais duas exclusivas:</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-4">
                <div class="bg-blue-50 p-3 rounded-lg border-l-4 border-brand-blue">
                    <strong>4 √Çngulos de 90¬∞</strong><br>
                    Da√≠ vem o nome "Ret√¢ngulo".
                </div>
                <div class="bg-orange-50 p-3 rounded-lg border-l-4 border-brand-orange">
                    <strong>Diagonais Iguais</strong><br>
                    As diagonais t√™m o mesmo tamanho exato.
                </div>
            </div>
            
            [WIDGET:interactive_rectangle_prop]
        `,

            "Losangos: Propriedades espec√≠ficas": `
            <h3>1. O Quadril√°tero Equil√°tero üíé</h3>
            <p>O Losango √© o irm√£o "chique" do paralelogramo. Ele tem todos os <strong>4 lados iguais</strong>.</p>
            <p>Sua propriedade secreta est√° nas diagonais: elas s√£o <strong>Perpendiculares</strong> (formam 90¬∞ no meio) e funcionam como bissetrizes (dividem os √¢ngulos ao meio).</p>

            [WIDGET:interactive_rhombus_diag]
        `,

            "Quadrados: A uni√£o das propriedades": `
            <h3>1. O Filho Perfeito üëë</h3>
            <p>O Quadrado √© o "Avatar" da geometria: ele domina todos os elementos. Ele √©, ao mesmo tempo, um Ret√¢ngulo (tem √¢ngulos retos) e um Losango (tem lados iguais).</p>
            
            <div class="bg-gray-800 text-white p-4 rounded-xl text-center shadow-lg my-4">
                <p class="font-bold text-lg">Checklist do Quadrado:</p>
                <ul class="text-sm mt-2 space-y-1 text-gray-300">
                    <li>‚úÖ Lados Iguais</li>
                    <li>‚úÖ √Çngulos Retos</li>
                    <li>‚úÖ Diagonais Iguais</li>
                    <li>‚úÖ Diagonais Perpendiculares</li>
                </ul>
            </div>
        `,

            "Trap√©zios: Classifica√ß√£o e Propriedades": `
            <h3>1. O Primo Diferente üöÇ</h3>
            <p>O Trap√©zio s√≥ tem <strong>um par</strong> de lados paralelos (chamados de Base Maior e Base Menor). O outro par n√£o √© paralelo.</p>
            
            <div class="grid grid-cols-3 gap-2 my-4 text-center">
                <div class="bg-white border-2 border-gray-200 rounded p-2 text-xs font-bold">
                    Is√≥sceles<br><span class="text-[10px] text-gray-400 font-normal">Pernas iguais</span>
                </div>
                <div class="bg-white border-2 border-gray-200 rounded p-2 text-xs font-bold">
                    Ret√¢ngulo<br><span class="text-[10px] text-gray-400 font-normal">2 √¢ngulos de 90¬∞</span>
                </div>
                <div class="bg-white border-2 border-gray-200 rounded p-2 text-xs font-bold">
                    Escaleno<br><span class="text-[10px] text-gray-400 font-normal">Tudo diferente</span>
                </div>
            </div>

            [WIDGET:interactive_trapezoid_types]
        `,

            "Base M√©dia do Trap√©zio e do Tri√¢ngulo": `
            <h3>1. O Atalho do Meio üìè</h3>
            <p>Se voc√™ conectar o meio de um lado ao meio do outro lado, voc√™ cria a <strong>Base M√©dia</strong>.</p>
            
            <div class="bg-green-50 p-4 rounded-xl border-l-4 border-brand-green my-4 shadow-sm">
                <h4 class="font-bold text-brand-green mb-2">A F√≥rmula da M√©dia</h4>
                <p class="text-sm">No trap√©zio, a Base M√©dia √© a m√©dia aritm√©tica das bases:</p>
                <p class="text-center font-mono text-xl font-bold mt-2 text-gray-700">BM = $\\frac{B + b}{2}$</p>
                <p class="text-xs text-gray-500 mt-2 text-center">No tri√¢ngulo, a base menor √© zero, ent√£o $BM = \\frac{B}{2}$.</p>
            </div>

            <p>Teste valores diferentes e veja a m√°gica da m√©dia:</p>

            [WIDGET:interactive_midsegment_calc]
        `,

            // =======================================================
            // 8¬∫ ANO: UNIDADE 9 - C√≠rculo e Circunfer√™ncia
            // =======================================================

            "Diferen√ßa entre C√≠rculo (Regi√£o) e Circunfer√™ncia (Contorno)": `
            <h3>1. O Anel e a Moeda üíçü™ô</h3>
            <p>Muitas pessoas usam essas palavras como sin√¥nimos, mas na matem√°tica elas s√£o diferentes!</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-white border-l-4 border-brand-blue p-4 rounded-r-xl shadow-sm">
                    <h4 class="font-bold text-brand-blue uppercase text-sm mb-2">Circunfer√™ncia</h4>
                    <p class="text-sm text-gray-600">√â apenas a <strong>linha</strong> curva. √â o contorno. Pense em um anel, um bambol√™ ou um pneu de bicicleta.</p>
                </div>
                <div class="bg-white border-l-4 border-brand-orange p-4 rounded-r-xl shadow-sm">
                    <h4 class="font-bold text-brand-orange uppercase text-sm mb-2">C√≠rculo</h4>
                    <p class="text-sm text-gray-600">√â a linha <strong>mais</strong> o recheio. √â a regi√£o plana. Pense em uma moeda, uma pizza ou uma tampa de panela.</p>
                </div>
            </div>

            <p>Use o seletor abaixo para visualizar a diferen√ßa:</p>

            [WIDGET:interactive_circle_vs_circumference]
        `,

            "Elementos: Raio, Corda, Di√¢metro, Arco, Flecha": `
            <h3>1. Anatomia Circular üß¨</h3>
            <p>Para navegar no c√≠rculo, precisamos conhecer as partes dele. N√£o √© s√≥ "meio" e "borda".</p>

            <ul class="list-disc list-inside bg-gray-50 p-4 rounded-xl border border-gray-200 text-sm space-y-2 mb-6">
                <li><strong>Raio ($r$):</strong> Do centro at√© a borda. (O raio da bicicleta).</li>
                <li><strong>Corda:</strong> Liga dois pontos quaisquer da borda (sem passar obrigatoriamente pelo centro).</li>
                <li><strong>Di√¢metro ($d$):</strong> A maior corda poss√≠vel! Passa pelo centro. Vale $2 \\times r$.</li>
                <li><strong>Arco:</strong> Um peda√ßo da curva da circunfer√™ncia.</li>
                <li><strong>Flecha:</strong> A dist√¢ncia entre o meio de uma corda e o meio do seu arco.</li>
            </ul>

            <p>Passe o mouse (ou toque) nas partes do diagrama interativo para identificar cada elemento:</p>

            [WIDGET:interactive_circle_anatomy]
        `,

            "Posi√ß√µes Relativas: Reta e Circunfer√™ncia (Tangente, Secante, Externa)": `
            <h3>1. O Encontro da Linha com a Bola üé±</h3>
            <p>Imagine uma reta se aproximando de uma circunfer√™ncia. Dependendo da dist√¢ncia ($d$) entre o centro e a reta, temos tr√™s situa√ß√µes:</p>

            <div class="grid grid-cols-3 gap-2 my-4 text-center text-xs">
                <div class="bg-green-50 p-2 rounded border border-green-200">
                    <strong class="block text-green-700">Externa</strong>
                    0 pontos em comum.<br>($d > r$)
                </div>
                <div class="bg-blue-50 p-2 rounded border border-blue-200">
                    <strong class="block text-blue-700">Tangente</strong>
                    1 ponto em comum.<br>($d = r$)
                </div>
                <div class="bg-red-50 p-2 rounded border border-red-200">
                    <strong class="block text-red-700">Secante</strong>
                    2 pontos em comum.<br>($d < r$)
                </div>
            </div>

            [WIDGET:interactive_line_circle_pos]
        `,

            "Propriedade da Reta Tangente (Perpendicular ao raio)": `
            <h3>1. O Toque Perfeito üëâ</h3>
            <p>A reta tangente √© especial. Ela encosta na circunfer√™ncia em apenas um ponto e vai embora. </p>
            <p>A propriedade m√°gica √©: <strong>No ponto de tang√™ncia, a reta forma sempre 90¬∞ com o raio.</strong></p>

            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm shadow-sm">
                <strong>Por que isso importa?</strong><br>
                Isso permite usar o Teorema de Pit√°goras para calcular dist√¢ncias desconhecidas em problemas de engenharia e astronomia!
            </div>

            [WIDGET:interactive_tangent_prop]
        `,

            "Posi√ß√µes Relativas entre duas Circunfer√™ncias": `
            <h3>1. A Dan√ßa dos An√©is ‚≠ï‚≠ï</h3>
            <p>Duas circunfer√™ncias podem interagir de v√°rias formas, dependendo da dist√¢ncia entre seus centros.</p>

            <ul class="space-y-2 text-sm text-gray-700 mb-6">
                <li>üåëüåí <strong>Externas:</strong> Longe uma da outra.</li>
                <li>üé± <strong>Tangentes (Externas):</strong> Beijam-se por fora.</li>
                <li>ü•® <strong>Secantes:</strong> Cruzam-se em dois pontos.</li>
                <li>üëÅÔ∏è <strong>Tangentes (Internas):</strong> Beijam-se por dentro.</li>
                <li>üéØ <strong>Internas / Conc√™ntricas:</strong> Uma dentro da outra.</li>
            </ul>

            <p>Arraste os c√≠rculos para ver como a classifica√ß√£o muda:</p>

            [WIDGET:interactive_two_circles_pos]
        `,

            "√Çngulo Central e √Çngulo Inscrito (Rela√ß√£o de Medidas)": `
            <h3>1. Onde est√° o V√©rtice? üìê</h3>
            <p>O √¢ngulo muda de valor dependendo de onde ele nasce.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-4">
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                    <h4 class="font-bold text-brand-blue">√Çngulo Central</h4>
                    <p class="text-xs">O v√©rtice est√° no <strong>Centro</strong>. Ele enxerga o arco exatamente como ele √©.</p>
                </div>
                <div class="bg-purple-50 p-4 rounded-xl border border-purple-200">
                    <h4 class="font-bold text-brand-purple">√Çngulo Inscrito</h4>
                    <p class="text-xs">O v√©rtice est√° na <strong>Borda</strong> (atr√°s). Ele v√™ o arco de longe, por isso enxerga a <strong>metade</strong>.</p>
                </div>
            </div>

            <div class="text-center bg-gray-800 text-white p-4 rounded-xl shadow-lg my-6 font-mono text-xl">
                Inscrito = Central √∑ 2
            </div>

            <p>Mova o ponto inscrito pela borda e veja que o √¢ngulo nunca muda!</p>

            [WIDGET:interactive_angles_circle]
        `,

            "O N√∫mero Pi": `
            <h3>1. O C√≥digo Secreto do C√≠rculo ü•ß</h3>
            <p>Pegue qualquer c√≠rculo do universo: uma moeda, uma roda gigante, um planeta. Se voc√™ dividir o tamanho da volta (Comprimento) pelo tamanho da largura (Di√¢metro), o resultado √© <strong>SEMPRE</strong> o mesmo n√∫mero.</p>
            <p>Esse n√∫mero √© o <strong>Pi ($\\pi$)</strong>.</p>
            <p>$\\pi \\approx 3,14159...$</p>

            <p>Vamos "desenrolar" uma circunfer√™ncia para ver o Pi aparecendo na pr√°tica:</p>

            [WIDGET:interactive_pi_unroll]
        `,

            "Comprimento da Circunfer√™ncia e √Årea do C√≠rculo": `
            <h3>1. O Contorno (Comprimento) üìè</h3>
            <p>√â a dist√¢ncia se voc√™ andasse em cima da linha. Como vimos, o Pi √© a chave.</p>
            <div class="bg-blue-50 text-center p-3 rounded-xl border border-blue-200 font-mono font-bold text-brand-blue mb-6">
                C = 2 ¬∑ $\\pi$ ¬∑ r
            </div>

            <h3>2. A Regi√£o (√Årea) üü•</h3>
            <p>√â quanto espa√ßo tem dentro. Podemos imaginar o c√≠rculo fatiado em peda√ßos de pizza e remontado como um ret√¢ngulo.</p>
            <div class="bg-orange-50 text-center p-3 rounded-xl border border-orange-200 font-mono font-bold text-brand-orange mb-6">
                A = $\\pi$ ¬∑ $r^2$
            </div>

            [WIDGET:interactive_area_circle_derivation]

            <h3>3. Desafio: O Arqueiro Matem√°tico üèπ</h3>
            <p>Calcule r√°pido para acertar o alvo!</p>
            
            [WIDGET:game_circle_calc_challenge]
        `,

            // =======================================================
            // 8¬∫ ANO: UNIDADE 10 - Estat√≠stica e Probabilidade
            // =======================================================

            "Princ√≠pio Fundamental da Contagem (PFC)": `
            <h3>1. O Segredo da Multiplica√ß√£o üïµÔ∏è</h3>
            <p>Imagine que voc√™ √© um espi√£o e precisa descobrir uma senha. O Princ√≠pio Fundamental da Contagem (PFC) √© a ferramenta que nos diz quantas combina√ß√µes existem sem precisarmos testar uma por uma.</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm shadow-sm">
                <strong>A Regra de Ouro:</strong><br>
                Se uma decis√£o tem <strong>X</strong> op√ß√µes e a outra tem <strong>Y</strong> op√ß√µes, o total de combina√ß√µes √© <strong>X ¬∑ Y</strong>.
            </div>

            <p>Se voc√™ tem 3 tipos de p√£o e 4 recheios, voc√™ tem $3 \\times 4 = 12$ sandu√≠ches diferentes. Simples assim!</p>

            <h3>2. Visualizando as Decis√µes</h3>
            <p>Teste o simulador de senhas para ver como o n√∫mero de possibilidades explode rapidamente quando adicionamos mais op√ß√µes.</p>

            [WIDGET:interactive_pfc_lock]
        `,

            "Espa√ßo Amostral e Evento": `
            <h3>1. O Universo das Possibilidades üåå</h3>
            <p>Antes de calcular a sorte, precisamos mapear o terreno.</p>
            <ul class="list-disc list-inside bg-gray-50 p-4 rounded-xl border border-gray-200 text-sm space-y-2 mb-6">
                <li><strong>Espa√ßo Amostral ($\\Omega$):</strong> √â o conjunto de <strong>TUDO</strong> que pode acontecer. (Ex: Num dado, √© {1, 2, 3, 4, 5, 6}).</li>
                <li><strong>Evento ($E$):</strong> √â o que <strong>QUEREMOS</strong> que aconte√ßa. √â um subconjunto do espa√ßo amostral. (Ex: Sair um n√∫mero par {2, 4, 6}).</li>
            </ul>

            <p>Vamos usar a "Roleta da Sorte" para identificar quem √© quem:</p>

            [WIDGET:interactive_sample_space_wheel]
        `,

            "Probabilidade Te√≥rica (Laplace)": `
            <h3>1. Calculando a Chance üé≤</h3>
            <p>A probabilidade √© uma fra√ß√£o que mede a certeza. Ela foi definida por Pierre-Simon Laplace:</p>

            <div class="flex justify-center my-6">
                <div class="bg-gray-800 text-white p-4 rounded-xl text-center shadow-lg font-mono text-lg">
                    $$ P(E) = \\frac{\\text{Casos Favor√°veis (Quero)}}{\\text{Casos Poss√≠veis (Total)}} $$
                </div>
            </div>

            <p>O resultado vai de <strong>0 (Imposs√≠vel)</strong> a <strong>1 (Certeza Absoluta)</strong>, ou de 0% a 100%.</p>

            <h3>2. Laborat√≥rio de Cartas üÉè</h3>
            <p>Qual a chance de tirar um √Ås? Ou uma carta vermelha? Use o laborat√≥rio para simular e calcular.</p>

            [WIDGET:interactive_probability_cards]
        `,

            "M√©dia, Moda e Mediana (Medidas de Tend√™ncia Central)": `
            <h3>1. O Resumo dos Dados üìä</h3>
            <p>Quando temos muitos n√∫meros, precisamos de um representante. Temos tr√™s candidatos principais:</p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6">
                <div class="bg-blue-50 p-3 rounded-lg border-t-4 border-brand-blue text-center">
                    <strong class="text-brand-blue block mb-1">M√©dia</strong>
                    <span class="text-xs text-gray-600">O Equilibrista. Soma tudo e divide pela quantidade. √â sens√≠vel a valores extremos.</span>
                </div>
                <div class="bg-orange-50 p-3 rounded-lg border-t-4 border-brand-orange text-center">
                    <strong class="text-brand-orange block mb-1">Moda</strong>
                    <span class="text-xs text-gray-600">O Popular. √â o valor que mais aparece (est√° "na moda").</span>
                </div>
                <div class="bg-purple-50 p-3 rounded-lg border-t-4 border-brand-purple text-center">
                    <strong class="text-brand-purple block mb-1">Mediana</strong>
                    <span class="text-xs text-gray-600">O Centro. Coloque em fila (ordem crescente) e pegue o do meio.</span>
                </div>
            </div>

            <p>Arraste os blocos para ver como cada medida reage:</p>

            [WIDGET:interactive_central_tendency]
        `,

            "Gr√°ficos de Linhas e Histogramas": `
            <h3>1. Contando Hist√≥rias com Imagens üìà</h3>
            <p>Dados brutos s√£o chatos. Gr√°ficos contam a hist√≥ria!</p>
            
            <ul class="list-none space-y-3 mb-6">
                <li class="flex items-center gap-3">
                    <i class="fas fa-chart-line text-2xl text-brand-blue"></i>
                    <div>
                        <strong>Gr√°fico de Linhas:</strong> Perfeito para ver <strong>evolu√ß√£o no tempo</strong> (crescimento, queda, tend√™ncia).
                    </div>
                </li>
                <li class="flex items-center gap-3">
                    <i class="fas fa-chart-bar text-2xl text-brand-orange"></i>
                    <div>
                        <strong>Histograma:</strong> Parece barra, mas √© diferente! Ele agrupa dados em <strong>intervalos</strong> (ex: pessoas de 10-20 anos, 20-30 anos...). As barras s√£o coladinhas.
                    </div>
                </li>
            </ul>

            [WIDGET:interactive_chart_builder_8]
        `,

            "Medidas de Dispers√£o: Amplitude e no√ß√µes de Desvio Padr√£o": `
            <h3>1. Os Dados s√£o Confi√°veis? üéØ</h3>
            <p>A m√©dia engana! Se voc√™ tirar 0 na prova 1 e 10 na prova 2, sua m√©dia √© 5. Se tirar 5 e 5, a m√©dia tamb√©m √© 5. Mas a situa√ß√£o √© muito diferente!</p>
            <p>Para medir essa "bagun√ßa" ou "espalhamento", usamos as Medidas de Dispers√£o.</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm">
                <strong>Amplitude:</strong> √â a dist√¢ncia entre o maior e o menor valor.<br>
                $$ A = \\text{M√°ximo} - \\text{M√≠nimo} $$
            </div>

            <h3>2. No√ß√£o de Desvio Padr√£o (O "Espalhamento")</h3>
            <p>O Desvio Padr√£o diz, em m√©dia, o qu√£o longe os dados est√£o do centro.
            <br>‚Ä¢ Desvio Padr√£o <strong>BAIXO</strong> = Dados homog√™neos (consistentes).
            <br>‚Ä¢ Desvio Padr√£o <strong>ALTO</strong> = Dados heterog√™neos (irregulares).</p>

            [WIDGET:interactive_dispersion_target]
        `,

            //
            // NONO ANO
            //

            // =================================================================
            // CONTE√öDO 9¬∫ ANO
            // =================================================================

            // =======================================================
            // UNIDADE 1: POTENCIA√á√ÉO E RADICIA√á√ÉO EM R
            // =======================================================

            "Revis√£o: Conjuntos Num√©ricos e N√∫meros Irracionais": `
            <h3>1. A Grande Fam√≠lia dos N√∫meros üë®‚Äçüë©‚Äçüëß‚Äçüë¶</h3>
            <p>At√© agora, voc√™ conheceu v√°rios tipos de n√∫meros. Vamos organiz√°-los como caixas dentro de caixas.</p>
            
            <ul class="list-none space-y-2 mb-4 bg-white p-4 rounded-xl border border-gray-200 text-sm">
                <li><strong class="text-brand-orange">‚Ñï Naturais:</strong> Contagem (0, 1, 2, 3...)</li>
                <li><strong class="text-brand-blue">‚Ñ§ Inteiros:</strong> Inclui os negativos (..., -2, -1, 0, 1...)</li>
                <li><strong class="text-brand-green">‚Ñö Racionais:</strong> Fra√ß√µes e Decimais exatos/peri√≥dicos (1/2, 0.5, 0.333...)</li>
                <li><strong class="text-brand-purple">ùïÄ Irracionais:</strong> Os "estranhos". Decimais infinitos e sem repeti√ß√£o ($\pi$, $\sqrt{2}$).</li>
            </ul>

            <div class="bg-gray-800 text-white p-4 rounded-xl text-center shadow-lg my-6">
                <h4 class="font-bold text-lg mb-2">O Conjunto Real ($\\mathbb{R}$)</h4>
                <p class="text-sm">√â a uni√£o de TODOS eles. $\\mathbb{R} = \\mathbb{Q} \\cup \\mathbb{I}$</p>
            </div>

            <p>Arraste os n√∫meros para a caixa correta para provar que voc√™ sabe quem √© quem!</p>

            [WIDGET:interactive_sets_venn]
        `,

            "A Reta Real e Intervalos": `
            <h3>1. Preenchendo os Buracos üï≥Ô∏è</h3>
            <p>A Reta Num√©rica dos Racionais ($\\mathbb{Q}$) √© cheia de furinhos microsc√≥picos. Os N√∫meros Irracionais ($\\mathbb{I}$) servem para tapar esses buracos.</p>
            <p>Juntos, eles formam a <strong>Reta Real</strong>: uma linha cont√≠nua onde cada ponto √© um n√∫mero.</p>

            <h3>2. Intervalos: Onde come√ßa e onde termina? üöß</h3>
            <p>√Äs vezes queremos um peda√ßo da reta. Usamos bolas cheias ou vazias para dizer se as pontas est√£o inclu√≠das.</p>

            <div class="grid grid-cols-2 gap-4 my-4 text-center text-sm">
                <div class="bg-green-50 p-2 rounded border border-green-200">
                    <div class="w-4 h-4 bg-green-600 rounded-full mx-auto mb-1"></div>
                    <strong>Bolinha Fechada [ ]</strong>
                    <p class="text-xs text-gray-500">Inclui o n√∫mero.<br>Ex: $\\ge 2$</p>
                </div>
                <div class="bg-red-50 p-2 rounded border border-red-200">
                    <div class="w-4 h-4 bg-white border-2 border-red-600 rounded-full mx-auto mb-1"></div>
                    <strong>Bolinha Aberta ( )</strong>
                    <p class="text-xs text-gray-500">N√£o inclui.<br>Ex: $> 2$</p>
                </div>
            </div>

            [WIDGET:interactive_intervals_builder]
        `,

            "Pot√™ncia com Expoente Inteiro e Fracion√°rio": `
            <h3>1. Expoente Negativo: O Inverso üôÉ</h3>
            <p>Um expoente negativo n√£o deixa o n√∫mero negativo! Ele apenas manda o n√∫mero para o "por√£o" (inverte a fra√ß√£o).</p>
            <div class="text-center font-mono text-xl bg-gray-100 p-3 rounded-lg border border-gray-300 my-4">
                $2^{-3} = \\frac{1}{2^3} = \\frac{1}{8}$
            </div>

            <h3>2. Expoente Fracion√°rio: A Raiz Disfar√ßada üå±</h3>
            <p>Todo radical pode ser escrito como pot√™ncia. A regra √© clara:</p>
            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm shadow-sm">
                <strong>Regra do Sol e Sombra ‚òÄÔ∏è‚òÇÔ∏è</strong><br>
                "Quem est√° no sol (cima da fra√ß√£o) vai para a sombra (dentro da raiz).<br>
                Quem est√° na sombra (baixo da fra√ß√£o) vai para o sol (√≠ndice da raiz)."
            </div>

            [WIDGET:interactive_exponent_sun_shadow]
        `,

            "Nota√ß√£o Cient√≠fica e Ordem de Grandeza (F√≠sica)": `
            <h3>1. A Linguagem da Ci√™ncia üî¨üöÄ</h3>
            <p>Cientistas lidam com coisas gigantes (gal√°xias) e min√∫sculas (√°tomos). Escrever todos os zeros d√° muito trabalho!</p>
            <p>A Nota√ß√£o Cient√≠fica padroniza tudo em: <strong>$N \\times 10^k$</strong>.</p>
            <ul class="list-disc list-inside text-sm text-gray-600 mb-4 bg-white p-3 rounded border border-gray-100">
                <li><strong>N:</strong> Um n√∫mero entre 1 e 10.</li>
                <li><strong>k:</strong> Quantos pulos a v√≠rgula deu.</li>
            </ul>

            <p>Use o "microsc√≥pio/telesc√≥pio" para converter os n√∫meros:</p>

            [WIDGET:interactive_scientific_notation_slider]
        `,

            "Propriedades dos Radicais (Produto, Quociente, Raiz de Raiz)": `
            <h3>1. As Leis da Raiz ‚öñÔ∏è</h3>
            <p>Radicais parecem dif√≠ceis, mas eles seguem regras de separa√ß√£o e uni√£o muito parecidas com as pot√™ncias.</p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 my-6 text-center text-xs">
                <div class="bg-blue-50 p-2 rounded border border-blue-200">
                    <strong class="text-brand-blue block mb-1">Produto</strong>
                    $\\sqrt{a \\cdot b} = \\sqrt{a} \\cdot \\sqrt{b}$<br>
                    (Separa amigos)
                </div>
                <div class="bg-orange-50 p-2 rounded border border-orange-200">
                    <strong class="text-brand-orange block mb-1">Quociente</strong>
                    $\\sqrt{\\frac{a}{b}} = \\frac{\\sqrt{a}}{\\sqrt{b}}$<br>
                    (Separa andares)
                </div>
                <div class="bg-purple-50 p-2 rounded border border-purple-200">
                    <strong class="text-brand-purple block mb-1">Raiz de Raiz</strong>
                    $\\sqrt[n]{\\sqrt[m]{a}} = \\sqrt[n \\cdot m]{a}$<br>
                    (Multiplica √≠ndices)
                </div>
            </div>

            [WIDGET:interactive_radical_properties_lab]
        `,

            "Simplifica√ß√£o de Radicais (Extra√ß√£o de Fatores)": `
            <h3>1. Fuga da Pris√£o ‚àö üöì</h3>
            <p>Imagine que a raiz √© uma pris√£o. Para escapar, voc√™ precisa pagar uma fian√ßa igual ao √≠ndice da raiz.</p>
            <p>Se a raiz √© quadrada (√≠ndice 2), voc√™ precisa formar <strong>duplas</strong> iguais para que um deles saia.</p>

            <div class="bg-gray-800 text-white p-4 rounded-xl text-center shadow-lg my-4 font-mono">
                $\\sqrt{75} = \\sqrt{3 \\cdot 5^2} = 5\\sqrt{3}$
            </div>
            <p class="text-xs text-gray-500 text-center mb-4">O 5 tinha o ticket (expoente 2), ent√£o saiu. O 3 ficou preso.</p>

            <p>Ajude os n√∫meros a fugir da raiz fatorando eles:</p>

            [WIDGET:interactive_radical_jailbreak]
        `,

            "Opera√ß√µes com Radicais (Soma de semelhantes, Multiplica√ß√£o)": `
            <h3>1. S√≥ Pode Misturar Iguais! üçéüçè</h3>
            <p>Voc√™ n√£o pode somar $\\sqrt{2} + \\sqrt{3}$. √â como somar ma√ßa com laranja.</p>
            <p>S√≥ podemos somar ou subtrair radicais que t√™m o <strong>mesmo √≠ndice</strong> e o <strong>mesmo n√∫mero dentro</strong> (radicando).</p>
            
            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-center font-bold text-gray-700">
                $2\\sqrt{5} + 4\\sqrt{5} = 6\\sqrt{5}$
            </div>

            <h3>2. Multiplica√ß√£o: Vale Tudo ü•ä</h3>
            <p>Na multiplica√ß√£o, os de fora multiplicam os de fora, e os de dentro multiplicam os de dentro.</p>

            [WIDGET:interactive_radical_operations_sorter]
        `,

            "Racionaliza√ß√£o de Denominadores": `
            <h3>1. O Ch√£o √© Lava üî•</h3>
            <p>Na matem√°tica, consideramos "inelegante" deixar uma raiz na parte de baixo da fra√ß√£o (denominador). √â como deixar o ch√£o sujo.</p>
            <p>Para limpar, usamos o truque da <strong>Multiplica√ß√£o pelo Espelho</strong>: multiplicamos em cima e embaixo pela mesma raiz.</p>

            <div class="flex justify-center items-center gap-4 my-6 font-mono text-lg">
                <span>$\\frac{1}{\\sqrt{2}}$</span>
                <span class="text-gray-400">√ó</span>
                <span class="text-brand-blue">$\\frac{\\sqrt{2}}{\\sqrt{2}}$</span>
                <span class="text-gray-400">=</span>
                <span class="text-brand-green">$\\frac{\\sqrt{2}}{2}$</span>
            </div>

            [WIDGET:interactive_rationalization_cleaner]
        `,

            // =======================================================
            // UNIDADE 2: EQUA√á√ïES DO 2¬∫ GRAU
            // =======================================================

            "Defini√ß√£o e Forma Geral (ax¬≤ + bx + c = 0)": `
            <h3>1. O Que √© uma Equa√ß√£o do 2¬∫ Grau? üé¢</h3>
            <p>At√© agora, trabalhamos com retas ($x^1$). Agora, vamos curvar a linha! Uma equa√ß√£o √© do 2¬∫ grau quando a inc√≥gnita ($x$) tem o expoente <strong>2</strong> como o maior de todos.</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4">
                <h4 class="font-bold text-brand-blue mb-2">A Forma Geral</h4>
                <div class="font-mono text-2xl text-center font-black">
                    <span class="text-brand-purple">a</span>x¬≤ + <span class="text-brand-blue">b</span>x + <span class="text-brand-orange">c</span> = 0
                </div>
                <ul class="mt-3 text-sm text-gray-700 space-y-1">
                    <li><strong class="text-brand-purple">a</strong>: Coeficiente quadr√°tico (n√£o pode ser zero!).</li>
                    <li><strong class="text-brand-blue">b</strong>: Coeficiente linear.</li>
                    <li><strong class="text-brand-orange">c</strong>: Termo independente (o n√∫mero sozinho).</li>
                </ul>
            </div>

            <p><strong>A Regra de Ouro:</strong> Para come√ßar a resolver, sempre tente deixar a equa√ß√£o igual a ZERO, jogando tudo para a esquerda.</p>

            [WIDGET:interactive_coeff_identifier]
        `,

            "Resolu√ß√£o de Equa√ß√µes Incompletas (Isolamento e Fatora√ß√£o)": `
            <h3>1. Quando falta algu√©m... üëª</h3>
            <p>Se $b=0$ ou $c=0$, a equa√ß√£o √© incompleta. N√£o precisamos da f√≥rmula gigante de Bhaskara para resolver! Existem atalhos r√°pidos.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-white border-2 border-gray-200 rounded-xl p-4 shadow-sm">
                    <strong class="text-brand-blue block mb-2">Caso 1: Falta o 'b' ($ax^2 + c = 0$)</strong>
                    <p class="text-sm text-gray-600 mb-2">Isolamos o $x$. √â igual a resolver equa√ß√£o do 1¬∫ grau, mas tiramos a raiz no final.</p>
                    <div class="bg-gray-100 p-2 rounded font-mono text-center text-sm">
                        $2x^2 - 50 = 0$ <br>
                        $2x^2 = 50$ <br>
                        $x^2 = 25$ <br>
                        $x = \\pm 5$
                    </div>
                </div>
                <div class="bg-white border-2 border-gray-200 rounded-xl p-4 shadow-sm">
                    <strong class="text-brand-orange block mb-2">Caso 2: Falta o 'c' ($ax^2 + bx = 0$)</strong>
                    <p class="text-sm text-gray-600 mb-2">Usamos fatora√ß√£o (Fator Comum). Uma das ra√≠zes √© <strong>sempre ZERO</strong>.</p>
                    <div class="bg-gray-100 p-2 rounded font-mono text-center text-sm">
                        $x^2 - 5x = 0$ <br>
                        $x(x - 5) = 0$ <br>
                        Ou $x = 0$, ou $x - 5 = 0 \\rightarrow x=5$
                    </div>
                </div>
            </div>

            [WIDGET:interactive_incomplete_solver]
        `,

            "Dedu√ß√£o da F√≥rmula Resolutiva (Completar Quadrados)": `
            <h3>1. A Origem Geom√©trica üüß</h3>
            <p>Antes de Bhaskara, os matem√°ticos √°rabes (como Al-Khwarizmi) resolviam equa√ß√µes completando desenhos geom√©tricos.</p>
            <p>A ideia √©: "Eu tenho um quadrado ($x^2$) e ret√¢ngulos ($bx$). Quanto falta para completar um quadrado perfeito maior?"</p>

            <div class="relative w-full h-48 my-6 bg-gray-50 rounded-xl border border-gray-200 flex items-center justify-center overflow-hidden">
                [WIDGET:interactive_complete_square_geo]
            </div>

            <p>Ao completar a figura, transformamos a equa√ß√£o em um trin√¥mio quadrado perfeito: $(x + k)^2 = n$, que √© f√°cil de resolver tirando a raiz!</p>
        `,

            "F√≥rmula de Bhaskara": `
            <h3>1. A Super Arma Matem√°tica ‚öîÔ∏è</h3>
            <p>Quando a equa√ß√£o √© completa ($a, b, c \\neq 0$) e dif√≠cil de fatorar, usamos a F√≥rmula de Bhaskara. Ela resolve <strong>qualquer</strong> equa√ß√£o do 2¬∫ grau.</p>

            <div class="bg-gray-800 text-white p-6 rounded-2xl text-center shadow-lg my-6">
                <p class="text-xs text-gray-400 font-bold uppercase mb-2">Passo 1: Calcular Delta ($\\Delta$)</p>
                <div class="text-2xl font-mono font-bold text-yellow-400 mb-4">
                    $\\Delta = b^2 - 4 \\cdot a \\cdot c$
                </div>
                <p class="text-xs text-gray-400 font-bold uppercase mb-2">Passo 2: Calcular X</p>
                <div class="text-2xl font-mono font-bold">
                    $x = \\frac{-b \\pm \\sqrt{\\Delta}}{2 \\cdot a}$
                </div>
            </div>

            <p>Vamos praticar a substitui√ß√£o passo a passo:</p>

            [WIDGET:interactive_bhaskara_steps]
        `,

            "O Discriminante (Delta) e a Natureza das Ra√≠zes": `
            <h3>1. O Or√°culo da Equa√ß√£o üîÆ</h3>
            <p>O Delta ($\\Delta$) nos conta o futuro da equa√ß√£o antes mesmo de terminarmos a conta. Ele nos diz quantas solu√ß√µes (ra√≠zes) existem.</p>
            <p>Geometricamente, isso define se a par√°bola corta o eixo X duas vezes, uma vez, ou se ela "flutua" sem tocar no eixo.</p>

            <div class="grid grid-cols-3 gap-2 my-4 text-center">
                <div class="bg-green-50 p-2 rounded border border-green-200">
                    <strong class="text-green-700 block text-lg">$\\Delta > 0$</strong>
                    <span class="text-xs text-gray-600">2 Ra√≠zes Reais Diferentes</span>
                </div>
                <div class="bg-yellow-50 p-2 rounded border border-yellow-200">
                    <strong class="text-yellow-700 block text-lg">$\\Delta = 0$</strong>
                    <span class="text-xs text-gray-600">1 Raiz Real (Dupla)</span>
                </div>
                <div class="bg-red-50 p-2 rounded border border-red-200">
                    <strong class="text-red-700 block text-lg">$\\Delta < 0$</strong>
                    <span class="text-xs text-gray-600">Nenhuma Raiz Real</span>
                </div>
            </div>

            [WIDGET:interactive_discriminant_roots]
        `,

            "Rela√ß√µes de Soma e Produto (Girard)": `
            <h3>1. O Segredo dos Mestres ü§´</h3>
            <p>Voc√™ pode encontrar as ra√≠zes de cabe√ßa, sem escrever nada, usando as Rela√ß√µes de Girard.</p>
            
            <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-brand-purple my-4">
                <p>Se a equa√ß√£o for $x^2 - Sx + P = 0$ (com $a=1$):</p>
                <ul class="mt-2 space-y-2 font-mono font-bold text-brand-text">
                    <li>Soma das ra√≠zes ($x_1 + x_2$) = <span class="text-brand-red">-b</span></li>
                    <li>Produto das ra√≠zes ($x_1 \\cdot x_2$) = <span class="text-brand-blue">c</span></li>
                </ul>
            </div>

            <p><strong>Exemplo:</strong> $x^2 - 5x + 6 = 0$.<br>Quero dois n√∫meros que somados d√£o 5 e multiplicados d√£o 6.<br>Resposta: 2 e 3!</p>

            [WIDGET:game_sum_product_puzzle]
        `,

            "Forma Fatorada da Equa√ß√£o do 2¬∫ Grau": `
            <h3>1. Engenharia Reversa üõ†Ô∏è</h3>
            <p>Se conhecemos as ra√≠zes ($x_1$ e $x_2$), podemos reconstruir a equa√ß√£o original.</p>
            <div class="text-center font-mono text-xl bg-white p-4 rounded-xl border-2 border-gray-200 my-4 shadow-sm">
                $a \\cdot (x - x_1) \\cdot (x - x_2) = 0$
            </div>
            <p>Isso √© muito √∫til para simplificar fra√ß√µes alg√©bricas!</p>
        `,

            "Equa√ß√µes Biquadradas e Irracionais (Redut√≠veis ao 2¬∫ grau)": `
            <h3>1. As Equa√ß√µes Disfar√ßadas üé≠</h3>
            <p>√Äs vezes, uma equa√ß√£o parece dif√≠cil ($x^4$), mas podemos usar um truque para transform√°-la em uma do 2¬∫ grau.</p>
            
            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm">
                <strong>O Truque da M√°scara (Substitui√ß√£o):</strong><br>
                Chamamos $x^2$ de uma nova letra, por exemplo, <strong>y</strong>.
                <br>Ent√£o $x^4$ vira $y^2$.
                <br>A equa√ß√£o $x^4 - 5x^2 + 4 = 0$ vira $y^2 - 5y + 4 = 0$.
            </div>

            <p>Resolva para $y$ primeiro, depois tire a raiz para achar o $x$.</p>

            [WIDGET:interactive_biquadratic_swap]
        `,

            "Sistemas de Equa√ß√µes envolvendo 2¬∫ Grau": `
            <h3>1. O Encontro das Linhas üìâ</h3>
            <p>Um sistema com uma equa√ß√£o do 1¬∫ grau (reta) e uma do 2¬∫ grau (par√°bola) representa geometricamente onde essas duas linhas se cruzam.</p>
            <p>Geralmente usamos o <strong>M√©todo da Substitui√ß√£o</strong>: isolamos uma letra na equa√ß√£o da reta e jogamos dentro da equa√ß√£o da par√°bola.</p>
        `,

            // =======================================================
            // UNIDADE 3: INTRODU√á√ÉO √ÄS FUN√á√ïES
            // =======================================================

            "No√ß√£o de Fun√ß√£o: Depend√™ncia entre Grandezas": `
            <h3>1. A M√°quina Matem√°tica ‚öôÔ∏è</h3>
            <p>Uma <strong>Fun√ß√£o</strong> √© como uma m√°quina de transforma√ß√£o. Voc√™ coloca um n√∫mero dentro (Entrada), a m√°quina aplica uma regra fixa, e cospe um novo n√∫mero (Sa√≠da).</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm shadow-sm">
                <strong>A Regra de Ouro:</strong><br>
                Para cada entrada ($x$), existe <strong>uma √∫nica</strong> sa√≠da ($y$). A m√°quina nunca fica confusa!
            </div>

            <p>Isso cria uma rela√ß√£o de <strong>depend√™ncia</strong>. O valor da sa√≠da <em>depende</em> do valor da entrada. Exemplo: O pre√ßo do Uber (sa√≠da) depende da dist√¢ncia percorrida (entrada).</p>

            <p>Teste a m√°quina abaixo. Tente descobrir qual √© a regra que ela est√° usando!</p>

            [WIDGET:interactive_function_machine]
        `,

            "Representa√ß√£o: Diagramas, Tabelas e Gr√°ficos": `
            <h3>1. As Tr√™s Caras da Fun√ß√£o üé≠</h3>
            <p>Podemos representar a mesma fun√ß√£o de tr√™s formas diferentes. Elas contam a mesma hist√≥ria, mas em l√≠nguas diferentes.</p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6 text-center text-sm">
                <div class="bg-gray-50 p-3 rounded-lg border border-gray-300">
                    <strong class="block text-brand-purple mb-1">1. Diagrama de Flechas</strong>
                    Mostra a conex√£o direta. Quem atira em quem.
                </div>
                <div class="bg-gray-50 p-3 rounded-lg border border-gray-300">
                    <strong class="block text-brand-blue mb-1">2. Tabela</strong>
                    Organiza os pares ordenados (x, y). Bom para calcular.
                </div>
                <div class="bg-gray-50 p-3 rounded-lg border border-gray-300">
                    <strong class="block text-brand-orange mb-1">3. Gr√°fico</strong>
                    Desenha o caminho. Bom para ver a tend√™ncia.
                </div>
            </div>

            [WIDGET:interactive_func_representations]
        `,

            "Dom√≠nio, Contradom√≠nio e Imagem": `
            <h3>1. O Campo de Batalha das Flechas üèπ</h3>
            <p>No diagrama de flechas, temos dois conjuntos de n√∫meros:</p>
            
            <ul class="list-none space-y-2 mb-6">
                <li class="flex items-center gap-2">
                    <span class="bg-blue-100 text-blue-700 font-bold px-2 py-1 rounded text-xs">Dom√≠nio (D)</span>
                    <span class="text-sm">O conjunto de partida. S√£o os arqueiros (X).</span>
                </li>
                <li class="flex items-center gap-2">
                    <span class="bg-gray-100 text-gray-700 font-bold px-2 py-1 rounded text-xs">Contradom√≠nio (CD)</span>
                    <span class="text-sm">O conjunto de chegada. √â o alvo inteiro dispon√≠vel.</span>
                </li>
                <li class="flex items-center gap-2">
                    <span class="bg-green-100 text-green-700 font-bold px-2 py-1 rounded text-xs">Imagem (Im)</span>
                    <span class="text-sm">S√£o os pontos que foram <strong>realmente acertados</strong> pelas flechas (Y).</span>
                </li>
            </ul>

            <p>Selecione o Dom√≠nio e dispare as flechas para descobrir a Imagem:</p>

            [WIDGET:interactive_domain_range_shooter]
        `,

            "Fun√ß√£o Afim (1¬∫ Grau): Lei de Forma√ß√£o (ax+b)": `
            <h3>1. A Receita do T√°xi üöñ</h3>
            <p>A Fun√ß√£o Afim √© a mais famosa do cotidiano. Ela sempre tem uma <strong>parte fixa</strong> e uma <strong>parte vari√°vel</strong>.</p>
            
            <div class="text-center font-mono text-2xl font-black text-brand-blue my-4 bg-blue-50 p-4 rounded-xl border-2 border-blue-200">
                f(x) = ax + b
            </div>

            <ul class="list-disc list-inside text-sm text-gray-700 mb-6 bg-white p-4 rounded-xl border border-gray-200">
                <li><strong>a (Coeficiente Angular):</strong> √â a taxa de varia√ß√£o. Quanto custa cada km rodado?</li>
                <li><strong>b (Coeficiente Linear):</strong> √â o valor inicial (fixo). Quanto custa a bandeirada ao entrar no t√°xi?</li>
            </ul>

            <p>Simule uma corrida de t√°xi e veja a conta sendo feita:</p>

            [WIDGET:interactive_affine_taxi]
        `,

            "Fun√ß√£o Afim: Gr√°fico (Reta), Coeficientes, Zero e Sinal": `
            <h3>1. A Linha Reta üìè</h3>
            <p>O gr√°fico de uma fun√ß√£o do 1¬∫ grau √© sempre uma <strong>RETA</strong>.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-green-50 p-4 rounded-xl border-l-4 border-brand-green">
                    <h4 class="font-bold text-brand-green text-sm">Crescente (a > 0)</h4>
                    <p class="text-xs">A reta sobe a ladeira. Quanto mais X, mais Y.</p>
                </div>
                <div class="bg-red-50 p-4 rounded-xl border-l-4 border-brand-red">
                    <h4 class="font-bold text-brand-red text-sm">Decrescente (a < 0)</h4>
                    <p class="text-xs">A reta desce a ladeira. Quanto mais X, menos Y.</p>
                </div>
            </div>

            <h3>2. A Raiz (Zero da Fun√ß√£o)</h3>
            <p>√â onde a reta corta o eixo X (o ch√£o). √â o valor de $x$ que faz $f(x) = 0$.</p>

            [WIDGET:interactive_affine_explorer]
        `,

            "Fun√ß√£o Quadr√°tica (2¬∫ Grau): Lei de Forma√ß√£o": `
            <h3>1. A Curva da Gravidade üçé</h3>
            <p>Quando jogamos algo para o alto, ele sobe e desce fazendo uma curva. Essa curva √© descrita pela Fun√ß√£o Quadr√°tica.</p>
            
            <div class="text-center font-mono text-xl font-black text-brand-purple my-4 bg-purple-50 p-4 rounded-xl border-2 border-purple-200">
                f(x) = ax¬≤ + bx + c
            </div>

            <p>O termo $x^2$ √© quem manda na curva. Sem ele, seria uma reta!</p>
        `,

            "Fun√ß√£o Quadr√°tica: Gr√°fico (Par√°bola), V√©rtice e Zeros": `
            <h3>1. A Par√°bola üé¢</h3>
            <p>O gr√°fico da fun√ß√£o do 2¬∫ grau tem formato de "U" (ou "U" invertido). Chamamos de <strong>Par√°bola</strong>.</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm shadow-sm">
                <strong>O Humor da Par√°bola (Concavidade):</strong><br>
                üôÇ Se <strong>a > 0</strong>: Sorrindo (Concavidade para cima).<br>
                ‚òπÔ∏è Se <strong>a < 0</strong>: Triste (Concavidade para baixo).
            </div>

            <h3>2. Pontos Importantes</h3>
            <ul class="text-sm text-gray-700 list-disc list-inside mb-4">
                <li><strong>V√©rtice:</strong> O ponto de virada (o topo da montanha ou o fundo do vale).</li>
                <li><strong>Zeros (Ra√≠zes):</strong> Onde a curva toca o ch√£o (Eixo X). Pode tocar 2 vezes, 1 vez ou nenhuma!</li>
            </ul>

            <p>Lance o proj√©til e tente acertar o alvo ajustando a par√°bola:</p>

            [WIDGET:game_projectile_parabola]
        `,

            // =======================================================
            // UNIDADE 4: GEOMETRIA - SEMELHAN√áA E TEOREMA DE TALES
            // =======================================================

            "Raz√£o entre Segmentos e Segmentos Proporcionais": `
            <h3>1. A Matem√°tica da Compara√ß√£o üìè</h3>
            <p>Uma <strong>raz√£o</strong> nada mais √© do que uma divis√£o para comparar tamanhos. Se um l√°pis tem 10cm e uma borracha tem 2cm, a raz√£o entre eles √© $10/2 = 5$. O l√°pis √© 5 vezes a borracha.</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm shadow-sm">
                <strong>Segmentos Proporcionais:</strong><br>
                Dizemos que quatro segmentos (A, B, C, D) s√£o proporcionais quando a divis√£o dos dois primeiros √© igual √† divis√£o dos dois √∫ltimos.
                <br>
                $$ \\frac{A}{B} = \\frac{C}{D} $$
            </div>

            <p>Use o cortador de barras abaixo para entender visualmente:</p>

            [WIDGET:interactive_segment_ratio]
        `,

            "Feixe de Retas Paralelas": `
            <h3>1. Trilhos Infinitos üõ§Ô∏è</h3>
            <p>Um <strong>Feixe de Retas Paralelas</strong> √© um conjunto de retas que nunca se cruzam (como as linhas de um caderno). Quando cortamos essas retas com uma outra linha (chamada <strong>Transversal</strong>), criamos segmentos.</p>
            
            <p>A m√°gica √© que n√£o importa o quanto voc√™ incline a transversal: os peda√ßos cortados mant√™m uma rela√ß√£o de "parentesco" (propor√ß√£o).</p>

            [WIDGET:interactive_parallel_lines_visualizer]
        `,

            "Teorema de Tales e Aplica√ß√µes": `
            <h3>1. O Teorema da Sombra ‚òÄÔ∏è</h3>
            <p>Tales de Mileto descobriu algo incr√≠vel: <em>"Um feixe de retas paralelas determina, em duas transversais quaisquer, segmentos proporcionais."</em></p>

            <div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200 text-center my-6 shadow-sm">
                <span class="text-xs font-bold text-yellow-700 uppercase tracking-widest">A F√≥rmula de Ouro</span>
                <div class="text-3xl font-black text-brand-orange mt-2">
                    $$ \\frac{A}{B} = \\frac{C}{D} $$
                </div>
                <p class="text-sm text-gray-500 mt-2">"O de cima est√° para o de baixo, assim como o outro de cima est√° para o outro de baixo."</p>
            </div>

            <p>Tente quebrar o teorema movendo as retas no laborat√≥rio abaixo (spoiler: voc√™ n√£o vai conseguir!):</p>

            [WIDGET:interactive_tales_theorem]
        `,

            "Teorema da Bissetriz Interna": `
            <h3>1. O Corte Justo no Tri√¢ngulo üî∫</h3>
            <p>A <strong>Bissetriz</strong> √© a linha que divide um √¢ngulo do tri√¢ngulo exatamente ao meio.</p>
            <p>O Teorema diz: <em>"A bissetriz divide o lado oposto em dois peda√ßos que s√£o proporcionais aos lados vizinhos."</em></p>
            
            <p>√â como se os lados do tri√¢ngulo projetassem suas sombras no ch√£o.</p>

            [WIDGET:interactive_angle_bisector]
        `,

            "Semelhan√ßa de Pol√≠gonos e Raz√£o de Semelhan√ßa": `
            <h3>1. A M√°quina de Xerox (Amplia√ß√£o/Redu√ß√£o) üì†</h3>
            <p>Dois pol√≠gonos s√£o <strong>Semelhantes</strong> quando t√™m a mesma forma, mas tamanhos diferentes. Para isso, duas coisas precisam acontecer:</p>
            <ul class="list-disc list-inside bg-white p-4 rounded-xl border border-gray-200 text-sm space-y-2 mb-4">
                <li>üìê <strong>√Çngulos Iguais:</strong> Os cantos n√£o mudam.</li>
                <li>üìè <strong>Lados Proporcionais:</strong> Se um lado dobra, todos os outros dobram tamb√©m.</li>
            </ul>

            <p>O n√∫mero que usamos para multiplicar o tamanho chama-se <strong>Raz√£o de Semelhan√ßa ($k$)</strong>.</p>
            
            [WIDGET:interactive_polygon_scaler]
        `,

            "Casos de Semelhan√ßa de Tri√¢ngulos (AA, LAL, LLL)": `
            <h3>1. Detetive de Tri√¢ngulos üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
            <p>Voc√™ n√£o precisa medir tudo para saber se dois tri√¢ngulos s√£o semelhantes. Basta encontrar algumas pistas (Casos de Semelhan√ßa):</p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 my-4">
                <div class="bg-blue-50 p-3 rounded-lg text-center border-t-4 border-brand-blue">
                    <strong class="text-brand-blue">AA</strong>
                    <p class="text-xs">Dois √Çngulos iguais.</p>
                </div>
                <div class="bg-green-50 p-3 rounded-lg text-center border-t-4 border-brand-green">
                    <strong class="text-brand-green">LLL</strong>
                    <p class="text-xs">Tr√™s Lados proporcionais.</p>
                </div>
                <div class="bg-orange-50 p-3 rounded-lg text-center border-t-4 border-brand-orange">
                    <strong class="text-brand-orange">LAL</strong>
                    <p class="text-xs">Lado-√Çngulo-Lado.</p>
                </div>
            </div>

            [WIDGET:interactive_triangle_matcher]
        `,

            "Rela√ß√£o entre Per√≠metros e √Åreas de Figuras Semelhantes": `
            <h3>1. A Armadilha do Quadrado ‚ö†Ô∏è</h3>
            <p>Se voc√™ dobrar o tamanho dos lados de uma figura ($k=2$), o que acontece com a √Årea?</p>
            <p>Muitos acham que a √°rea dobra tamb√©m, mas n√£o! A √°rea <strong>QUADRUPLICA</strong>.</p>

            <div class="bg-red-50 p-4 rounded-xl border-l-4 border-brand-red my-4 text-sm">
                <strong>Leis da Pot√™ncia:</strong>
                <ul class="mt-2 space-y-1">
                    <li>‚Ä¢ <strong>Per√≠metro (1D):</strong> Cresce igual ao lado ($k$).</li>
                    <li>‚Ä¢ <strong>√Årea (2D):</strong> Cresce ao quadrado ($k^2$).</li>
                    <li>‚Ä¢ <strong>Volume (3D):</strong> Cresce ao cubo ($k^3$).</li>
                </ul>
            </div>

            <p>Veja isso acontecendo visualmente:</p>

            [WIDGET:interactive_area_ratio_visualizer]
        `,

            // =======================================================
            // UNIDADE 5: TRI√ÇNGULO RET√ÇNGULO E TRIGONOMETRIA
            // =======================================================

            "Rela√ß√µes M√©tricas no Tri√¢ngulo Ret√¢ngulo (Proje√ß√µes)": `
            <h3>1. As Sombras dos Catetos ‚òÄÔ∏è</h3>
            <p>Quando tra√ßamos a altura ($h$) em um tri√¢ngulo ret√¢ngulo apoiado sobre a hipotenusa, dividimos ele em dois tri√¢ngulos menores semelhantes.</p>
            <p>Os peda√ßos que a altura cria na base s√£o chamados de <strong>Proje√ß√µes</strong> ($m$ e $n$). Imagine que s√£o as sombras dos catetos ao meio-dia.</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm shadow-sm">
                <strong>F√≥rmulas Poderosas:</strong>
                <ul class="mt-2 space-y-1 font-mono text-xs md:text-sm text-blue-900">
                    <li>‚Ä¢ $h^2 = m \\cdot n$ (Altura ao quadrado = produto das proje√ß√µes)</li>
                    <li>‚Ä¢ $b^2 = a \\cdot m$ (Cateto ao quadrado = hipotenusa $\\cdot$ sua proje√ß√£o)</li>
                    <li>‚Ä¢ $c^2 = a \\cdot n$</li>
                    <li>‚Ä¢ $a \\cdot h = b \\cdot c$ (O "produto cruzado")</li>
                </ul>
            </div>

            <p>Mova o v√©rtice para ver como as proje√ß√µes mudam:</p>

            [WIDGET:interactive_metric_relations]
        `,

            "Teorema de Pit√°goras: Demonstra√ß√£o e Aplica√ß√µes": `
            <h3>1. O Quebra-Cabe√ßa Milenar üß©</h3>
            <p>Voc√™ j√° sabe que $a^2 = b^2 + c^2$, mas voc√™ acredita nisso? Vamos provar visualmente!</p>
            <p>A √°rea do quadrado constru√≠do sobre a hipotenusa √© <strong>exatamente igual</strong> √† soma das √°reas dos quadrados dos catetos.</p>

            [WIDGET:interactive_pythagoras_proof]
        `,

            "Aplica√ß√µes: Diagonal do Quadrado/Cubo e Altura do Tri√¢ngulo Equil√°tero": `
            <h3>1. Atalhos Matem√°ticos üèéÔ∏è</h3>
            <p>O Teorema de Pit√°goras cria f√≥rmulas r√°pidas para figuras comuns. N√£o precisa fazer a conta inteira toda vez!</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-gray-50 p-4 rounded-xl border-2 border-gray-200 text-center">
                    <h4 class="font-bold text-gray-700 mb-2">Diagonal do Quadrado</h4>
                    <div class="text-3xl font-mono text-brand-blue">d = l$\\sqrt{2}$</div>
                    <p class="text-xs text-gray-500 mt-2">Aparece o $\\sqrt{2}$</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-xl border-2 border-gray-200 text-center">
                    <h4 class="font-bold text-gray-700 mb-2">Altura do Tri√¢ngulo Equil√°tero</h4>
                    <div class="text-3xl font-mono text-brand-orange">h = $\\frac{l\\sqrt{3}}{2}$</div>
                    <p class="text-xs text-gray-500 mt-2">Aparece o $\\sqrt{3}$</p>
                </div>
            </div>

            [WIDGET:interactive_diagonal_height_demo]
        `,

            "Raz√µes Trigonom√©tricas: Seno, Cosseno e Tangente": `
            <h3>1. O Olhar do √Çngulo üëÄ</h3>
            <p>Tudo depende de <strong>onde</strong> voc√™ est√° olhando. O cateto √© "Oposto" se estiver longe de voc√™, e "Adjacente" se estiver ao seu lado.</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-center">
                <p class="text-2xl font-black text-yellow-800 tracking-widest mb-2">SOH CAH TOA</p>
                <div class="grid grid-cols-3 gap-2 text-xs font-bold text-yellow-900">
                    <div>Seno = O/H</div>
                    <div>Cosseno = A/H</div>
                    <div>Tangente = O/A</div>
                </div>
            </div>

            <p>Clique no √¢ngulo para ver quem √© quem:</p>

            [WIDGET:interactive_trig_eye]
        `,

            "Tabela de √Çngulos Not√°veis (30¬∫, 45¬∫, 60¬∫)": `
            <h3>1. A M√∫sica dos √Çngulos üéµ</h3>
            <p>Estes tr√™s √¢ngulos aparecem em todo lugar. Precisamos memorizar seus valores. Existe um padr√£o f√°cil:</p>
            
            <ul class="list-decimal list-inside bg-white p-4 rounded-xl border border-gray-200 text-sm text-gray-600 mb-6">
                <li>Escreva 1, 2, 3 e 3, 2, 1.</li>
                <li>Tudo sobre 2.</li>
                <li>Raiz onde n√£o tem 1.</li>
            </ul>

            [WIDGET:interactive_trig_table_builder]
        `,

            "Resolu√ß√£o de Problemas com Tri√¢ngulos Ret√¢ngulos": `
            <h3>1. Medindo o Imposs√≠vel üìê</h3>
            <p>Como medir a altura de uma √°rvore sem subir nela? Usando a sombra e a trigonometria!</p>
            <p>Se voc√™ sabe a dist√¢ncia at√© a √°rvore e o √¢ngulo de vis√£o at√© o topo, a <strong>Tangente</strong> te d√° a altura.</p>

            [WIDGET:game_shadow_ruler]
        `,

            // =======================================================
            // UNIDADE 6: RELA√á√ïES NA CIRCUNFER√äNCIA E POL√çGONOS REGULARES
            // =======================================================

            "Rela√ß√µes M√©tricas na Circunfer√™ncia (Cordas, Secantes, Tangentes)": `
            <h3>1. O Poder do Ponto üí•</h3>
            <p>Quando linhas se cruzam dentro ou fora de um c√≠rculo, elas criam peda√ßos que t√™m uma rela√ß√£o matem√°tica m√°gica.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6">
                <div class="bg-blue-50 p-3 rounded-lg border-t-4 border-brand-blue">
                    <strong class="text-brand-blue block mb-1">Cruzamento (Cordas)</strong>
                    <p class="text-xs">Duas cordas se cruzam em X.</p>
                    <p class="font-mono font-bold mt-2 text-center">PA ¬∑ PB = PC ¬∑ PD</p>
                </div>
                <div class="bg-orange-50 p-3 rounded-lg border-t-4 border-brand-orange">
                    <strong class="text-brand-orange block mb-1">Secantes (V)</strong>
                    <p class="text-xs">Duas retas cortam o c√≠rculo e se encontram fora.</p>
                    <p class="font-mono font-bold mt-2 text-center">Total ¬∑ Fora = Total ¬∑ Fora</p>
                </div>
                <div class="bg-purple-50 p-3 rounded-lg border-t-4 border-brand-purple">
                    <strong class="text-brand-purple block mb-1">Tangente-Secante</strong>
                    <p class="text-xs">Uma toca (beija) e a outra corta.</p>
                    <p class="font-mono font-bold mt-2 text-center">Tangente¬≤ = Total ¬∑ Fora</p>
                </div>
            </div>

            <p>Mexa nas linhas abaixo para ver os n√∫meros se ajustando √† regra:</p>

            [WIDGET:interactive_metric_relations]
        `,

            "Pol√≠gonos Regulares Inscritos e Circunscritos": `
            <h3>1. Dentro ou Fora? üì¶</h3>
            <p>Pol√≠gonos Regulares (lados e √¢ngulos iguais) adoram c√≠rculos.</p>
            <ul class="list-disc list-inside bg-white p-4 rounded-xl border border-gray-200 text-sm space-y-2 mb-4">
                <li><strong>Inscrito:</strong> O pol√≠gono est√° <strong>DENTRO</strong>. Os v√©rtices tocam a borda. (O c√≠rculo segura o pol√≠gono).</li>
                <li><strong>Circunscrito:</strong> O pol√≠gono est√° <strong>FORA</strong>. Os lados tocam a borda. (O pol√≠gono segura o c√≠rculo).</li>
            </ul>

            [WIDGET:interactive_inscribed_circumscribed]
        `,

            "Rela√ß√£o entre Lado, Raio e Ap√≥tema (Tri√¢ngulo, Quadrado, Hex√°gono)": `
            <h3>1. O Tri√¢ngulo M√°gico Interno üìê</h3>
            <p>Para calcular medidas em pol√≠gonos, sempre procuramos um tri√¢ngulo ret√¢ngulo escondido. Ele √© formado por 3 elementos:</p>
            
            <div class="flex flex-wrap gap-2 justify-center my-4 text-xs font-bold text-white">
                <span class="bg-brand-blue px-2 py-1 rounded">Raio (R)</span>
                <span class="bg-brand-orange px-2 py-1 rounded">Ap√≥tema (a)</span>
                <span class="bg-gray-500 px-2 py-1 rounded">Metade do Lado (L/2)</span>
            </div>

            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm shadow-sm">
                <strong>O que √© Ap√≥tema?</strong><br>
                √â a dist√¢ncia do centro at√© o meio do lado. √â a "altura" do tri√¢ngulo interno.
            </div>

            <p>Veja como o Pit√°goras ($R^2 = a^2 + (L/2)^2$) conecta tudo:</p>

            [WIDGET:interactive_apothem_finder]
        `,

            "C√°lculo de √Åreas de Pol√≠gonos Regulares": `
            <h3>1. Dividir para Conquistar üçï</h3>
            <p>N√£o precisamos decorar uma f√≥rmula nova para cada pol√≠gono (pent√°gono, oct√≥gono...). A estrat√©gia √© universal: fatiar em tri√¢ngulos iguais!</p>
            <p>A √°rea de um pol√≠gono regular √© a soma da √°rea de todos esses tri√¢ngulos centrais.</p>

            <div class="text-center bg-gray-800 text-white p-4 rounded-xl shadow-lg my-6 font-mono text-xl">
                √Årea = Semiper√≠metro ¬∑ Ap√≥tema
                <br>
                <span class="text-sm text-gray-400">($A = p \\cdot a$)</span>
            </div>

            [WIDGET:interactive_polygon_area_slices]
        `,

            // =======================================================
            // UNIDADE 7: √ÅREAS DE FIGURAS CIRCULARES
            // =======================================================

            "Revis√£o: √Årea do C√≠rculo": `
            <h3>1. $\\pi r^2$ em A√ß√£o üî¥</h3>
            <p>J√° vimos que a √°rea do c√≠rculo √© $\\pi \\cdot r^2$. Lembre-se: se te derem o <strong>Di√¢metro</strong>, divida por 2 para achar o Raio antes de calcular!</p>
            <p>Use o visualizador para relembrar:</p>

            [WIDGET:interactive_area_circle_derivation]
        `,

            "√Årea do Setor Circular (Regra de tr√™s com √¢ngulo)": `
            <h3>1. A Fatia de Pizza üçï</h3>
            <p>Um setor circular √© apenas uma parte do c√≠rculo total. Para calcular sua √°rea, usamos a l√≥gica da proporcionalidade:</p>
            <p><em>"Se 360¬∞ √© a √°rea toda, $\\alpha$ graus √© que parte?"</em></p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-center font-mono font-bold text-brand-blue">
                $$ A_{setor} = \\frac{\\alpha}{360} \\cdot \\pi r^2 $$
            </div>

            <p>Ajuste o √¢ngulo da faca e veja a √°rea mudar:</p>

            [WIDGET:interactive_sector_slice]
        `,

            "√Årea da Coroa Circular": `
            <h3>1. A Rosquinha (Donut) üç©</h3>
            <p>A Coroa Circular √© a regi√£o entre dois c√≠rculos conc√™ntricos (um dentro do outro).</p>
            <p>Para achar essa √°rea, a estrat√©gia √© simples: <strong>√Årea do Grand√£o MENOS √Årea do Pequeno</strong>.</p>
            
            <div class="bg-orange-50 p-4 rounded-xl border-l-4 border-brand-orange my-4 text-center font-mono font-bold text-brand-orange">
                $$ A = \\pi (R^2 - r^2) $$
            </div>

            [WIDGET:interactive_annulus_calc]
        `,

            "√Årea do Segmento Circular": `
            <h3>1. A Borda da Pizza ü•ü</h3>
            <p>O Segmento Circular √© a regi√£o "presa" entre uma corda e o arco. √â a parte mais dif√≠cil de visualizar.</p>
            <p><strong>A Estrat√©gia:</strong> Calcule a √°rea da fatia de pizza inteira (Setor) e subtraia o tri√¢ngulo formado pelos raios e a corda.</p>

            <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-brand-purple my-4 text-center font-bold text-purple-900 text-sm">
                Segmento = Setor (Pizza) - Tri√¢ngulo (Recheio)
            </div>

            [WIDGET:interactive_segment_visualizer]
        `,

            // =======================================================
            // UNIDADE 8: PROBABILIDADE E COMBINAT√ìRIA
            // =======================================================

            "√Årvore de Possibilidades e Princ√≠pio Multiplicativo (Revis√£o)": `
            <h3>1. O Mapa das Escolhas üå≥</h3>
            <p>Voc√™ se lembra do <strong>Princ√≠pio Fundamental da Contagem (PFC)</strong>? Se voc√™ tem 3 camisas e 2 cal√ßas, voc√™ tem $3 \\times 2 = 6$ looks.</p>
            <p>A <strong>√Årvore de Possibilidades</strong> √© a vers√£o visual dessa conta. Ela desenha cada caminho poss√≠vel que voc√™ pode tomar.</p>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-sm shadow-sm">
                <strong>Regra do "E":</strong><br>
                Quando voc√™ precisa escolher A <strong>E</strong> B, voc√™ <strong>MULTIPLICA</strong> as op√ß√µes.
            </div>

            <p>Explore a √°rvore abaixo para relembrar como os ramos se multiplicam:</p>

            [WIDGET:interactive_tree_path]
        `,

            "Eventos Dependentes e Independentes": `
            <h3>1. A Mem√≥ria do Acaso üß†</h3>
            <p>A grande pergunta da probabilidade √©: <em>"O que aconteceu antes muda o que vai acontecer agora?"</em></p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-green-50 p-4 rounded-xl border-t-4 border-brand-green shadow-sm">
                    <h4 class="font-bold text-brand-green uppercase text-sm mb-2">Independentes (Com Reposi√ß√£o)</h4>
                    <p class="text-sm text-gray-600">O passado n√£o importa. Se voc√™ tira uma carta e a <strong>devolve</strong> pro baralho, a chance de tirar a mesma carta de novo √© igual. O total nunca muda.</p>
                </div>
                <div class="bg-red-50 p-4 rounded-xl border-t-4 border-brand-red shadow-sm">
                    <h4 class="font-bold text-brand-red uppercase text-sm mb-2">Dependentes (Sem Reposi√ß√£o)</h4>
                    <p class="text-sm text-gray-600">O passado muda o futuro. Se voc√™ tira uma carta e <strong>guarda no bolso</strong>, o baralho diminuiu! A chance da pr√≥xima carta mudou.</p>
                </div>
            </div>

            <p>Teste a diferen√ßa na Urna Virtual. Veja o denominador mudando!</p>

            [WIDGET:interactive_urn_events]
        `,

            "Probabilidade da Uni√£o de Eventos": `
            <h3>1. O Problema da Dupla Contagem ‚úåÔ∏è</h3>
            <p>Qual a chance de sortear uma carta que seja <strong>Vermelha</strong> OU <strong>Rei</strong>?</p>
            <p>Se voc√™ somar todas as vermelhas com todos os reis, vai errar! Por qu√™? Porque existem <strong>Reis Vermelhos</strong>. Se somar direto, voc√™ conta eles duas vezes.</p>

            <div class="bg-purple-50 p-4 rounded-xl border-2 border-purple-200 text-center my-6 shadow-sm">
                <span class="text-xs font-bold text-purple-700 uppercase tracking-widest">F√≥rmula da Uni√£o</span>
                <div class="text-lg md:text-2xl font-black text-brand-text mt-2 font-mono">
                    P(A $\\cup$ B) = P(A) + P(B) - P(A $\\cap$ B)
                </div>
                <p class="text-xs text-gray-500 mt-2">"Soma tudo, mas desconta a interse√ß√£o (o meio) uma vez."</p>
            </div>

            <p>Use o Diagrama de Venn para visualizar a interse√ß√£o:</p>

            [WIDGET:interactive_venn_union]
        `,

            "Probabilidade Condicional (Introdu√ß√£o intuitiva)": `
            <h3>1. Filtrando o Universo üîç</h3>
            <p>√Äs vezes, recebemos uma fofoca (uma informa√ß√£o extra) que muda nossas chances. Isso √© <strong>Probabilidade Condicional</strong>.</p>
            <p>Exemplo: Qual a chance de algu√©m gostar de Futebol? (Muita gente).<br>
            Mas... e se eu te disser: <em>"Dado que essa pessoa veste a camisa do Flamengo"</em>? A chance aumentou muito!</p>

            <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-brand-yellow my-4 text-sm">
                <strong>O que muda?</strong><br>
                O nosso "Total" (Denominador) diminui. N√£o olhamos mais para todo mundo, apenas para o grupo da condi√ß√£o (quem veste Flamengo).
            </div>

            <p>Vamos filtrar formas geom√©tricas:</p>

            [WIDGET:interactive_conditional_filters]
        `,


            // ENSINO M√âDIO

            //
            // PRIMEIRO ANO DO ENSINO M√âDIO
            //

            //
            // =================================================================
            // CONTE√öDO 1¬∫ ANO EM
            // =================================================================

            // =======================================================
            // UNIDADE 1: L√ìGICA E CONJUNTOS
            // =======================================================

            "L√≥gica Matem√°tica: Proposi√ß√µes, Conectivos e Tabelas-Verdade": `
            <h3>1. A Matem√°tica do "Verdadeiro ou Falso" üö¶</h3>
            <p>A L√≥gica √© a base da programa√ß√£o e do pensamento estruturado. Aqui, n√£o lidamos com n√∫meros, mas com <strong>Proposi√ß√µes</strong>: frases que podem ser apenas Verdadeiras (V) ou Falsas (F).</p>
            
            <div class="bg-gray-800 text-white p-4 rounded-xl shadow-lg my-6">
                <p class="font-mono text-sm mb-2 text-gray-400">// Exemplo de C√≥digo L√≥gico</p>
                <p>Se (<span class="text-brand-blue">Estudar</span> <strong>E</strong> <span class="text-brand-orange">Descansar</span>) Ent√£o:</p>
                <p class="ml-4 text-brand-green">Sucesso = Verdadeiro;</p>
            </div>

            <h3>2. Os Conectivos L√≥gicos üîó</h3>
            <ul class="list-none space-y-3 mb-6">
                <li class="flex items-center gap-3 bg-white p-3 rounded-lg border border-gray-200 shadow-sm">
                    <strong class="text-2xl text-brand-blue">‚àß</strong>
                    <div><strong>E (Conjun√ß√£o):</strong> Exigente. S√≥ √© verdade se TUDO for verdade.</div>
                </li>
                <li class="flex items-center gap-3 bg-white p-3 rounded-lg border border-gray-200 shadow-sm">
                    <strong class="text-2xl text-brand-orange">‚à®</strong>
                    <div><strong>OU (Disjun√ß√£o):</strong> Flex√≠vel. Basta um ser verdade para tudo ser verdade.</div>
                </li>
                <li class="flex items-center gap-3 bg-white p-3 rounded-lg border border-gray-200 shadow-sm">
                    <strong class="text-2xl text-brand-purple">¬¨</strong>
                    <div><strong>N√ÉO (Nega√ß√£o):</strong> Do contra. Inverte o valor (V vira F).</div>
                </li>
            </ul>

            <p>Teste a l√≥gica na pr√°tica com o Simulador de Circuitos:</p>

            [WIDGET:interactive_logic_gates]
        `,

            "Teoria dos Conjuntos: Representa√ß√£o e Subconjuntos": `
            <h3>1. Organizando o Caos üì¶</h3>
            <p>Um conjunto √© simplesmente uma cole√ß√£o de coisas. Podem ser n√∫meros, pessoas, planetas ou at√© outros conjuntos.</p>
            
            <div class="flex justify-center gap-4 my-6">
                <div class="bg-blue-50 border-2 border-brand-blue p-4 rounded-full w-32 h-32 flex items-center justify-center text-center text-xs font-bold text-brand-blue shadow-inner">
                    A = {1, 2, 3}
                </div>
                <div class="self-center text-2xl text-gray-400">‚äÇ</div>
                <div class="bg-purple-50 border-2 border-brand-purple p-4 rounded-full w-40 h-40 flex items-center justify-center text-center text-xs font-bold text-brand-purple shadow-inner">
                    B = {0, 1, 2, 3, 4}
                </div>
            </div>
            
            <p class="text-center text-sm text-gray-500 mb-4">"A est√° contido em B" (A √© subconjunto de B)</p>

            <p>Use o organizador visual para entender as rela√ß√µes de pertin√™ncia ($\\in$) e inclus√£o ($\\subset$):</p>

            [WIDGET:interactive_set_builder]
        `,

            "Opera√ß√µes: Uni√£o, Intersec√ß√£o, Diferen√ßa e Complementar": `
            <h3>1. A Aritm√©tica dos Grupos üé®</h3>
            <p>Assim como somamos n√∫meros, podemos operar grupos inteiros.</p>
            
            <div class="grid grid-cols-2 gap-4 my-6 text-sm">
                <div class="bg-white p-3 rounded-xl border-l-4 border-brand-green shadow-sm">
                    <strong class="text-brand-green block mb-1">Uni√£o ($\\cup$)</strong>
                    Junta tudo. "Eu quero o que √© meu E o que √© seu."
                </div>
                <div class="bg-white p-3 rounded-xl border-l-4 border-brand-blue shadow-sm">
                    <strong class="text-brand-blue block mb-1">Intersec√ß√£o ($\\cap$)</strong>
                    O que tem em comum. "Onde n√≥s concordamos."
                </div>
                <div class="bg-white p-3 rounded-xl border-l-4 border-brand-red shadow-sm">
                    <strong class="text-brand-red block mb-1">Diferen√ßa ($-$)</strong>
                    Exclusividade. "O que eu tenho que voc√™ N√ÉO tem."
                </div>
            </div>

            <p>Pinte os diagramas para ver as opera√ß√µes acontecendo:</p>

            [WIDGET:interactive_venn_painter]
        `,

            "Conjuntos Num√©ricos (N, Z, Q, I, R) e Intervalos Reais": `
            <h3>1. As Matrioskas Matem√°ticas ü™Ü</h3>
            <p>Os n√∫meros n√£o "nascem" todos de uma vez. Eles evolu√≠ram com a hist√≥ria, um dentro do outro.</p>
            
            <ul class="list-disc list-inside space-y-2 text-sm text-gray-700 bg-gray-50 p-4 rounded-xl border border-gray-200 mb-6">
                <li><strong>$\\mathbb{N}$ (Naturais):</strong> Contagem (0, 1, 2...)</li>
                <li><strong>$\\mathbb{Z}$ (Inteiros):</strong> D√≠vidas e negativos (..., -2, -1, 0, 1...)</li>
                <li><strong>$\\mathbb{Q}$ (Racionais):</strong> Fra√ß√µes e d√≠zimas (1/2, 0.333...)</li>
                <li><strong>$\\mathbb{I}$ (Irracionais):</strong> Infinitos n√£o peri√≥dicos ($\\pi, \\sqrt{2}$)</li>
                <li><strong>$\\mathbb{R}$ (Reais):</strong> Todos os anteriores juntos.</li>
            </ul>

            <p>Explore a Reta Real e os Intervalos (bolinha aberta ou fechada?):</p>

            [WIDGET:interactive_real_intervals]
        `,

            "Problemas envolvendo Cardinalidade (Diagrama de Venn)": `
            <h3>1. O Detetive de Dados üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
            <p>Imagine uma pesquisa: "Quem gosta de Futebol? Quem gosta de V√¥lei?". Sempre tem algu√©m que gosta dos dois, e algu√©m que n√£o gosta de nada.</p>
            <p>Para n√£o contar a mesma pessoa duas vezes, usamos o <strong>Princ√≠pio da Inclus√£o-Exclus√£o</strong>:</p>
            
            <div class="text-center font-mono font-bold bg-blue-50 p-3 rounded-lg text-brand-blue my-4">
                n(A $\\cup$ B) = n(A) + n(B) - n(A $\\cap$ B)
            </div>

            <p>Resolva o mist√©rio da pesquisa movendo as pessoas para os lugares certos:</p>

            [WIDGET:interactive_venn_problem_solver]
        `,

            // =======================================================
            // UNIDADE 2: FUN√á√ïES - CONCEITOS FUNDAMENTAIS
            // =======================================================

            "Defini√ß√£o rigorosa de Fun√ß√£o": `
            <h3>1. A M√°quina Matem√°tica üè≠</h3>
            <p>Uma fun√ß√£o √© uma m√°quina que transforma entrada em sa√≠da. Mas ela tem uma regra sagrada: <strong>Para cada entrada, existe apenas UMA sa√≠da.</strong></p>
            <p>Voc√™ aperta o bot√£o "A" e sai "1". Se apertar "A" de novo e sair "2", a m√°quina est√° quebrada (n√£o √© fun√ß√£o)!</p>

            [WIDGET:interactive_function_machine_concept]
        `,

            "Dom√≠nio, Contradom√≠nio e Imagem": `
            <h3>1. O Territ√≥rio da Fun√ß√£o üó∫Ô∏è</h3>
            <div class="flex flex-col gap-4 my-6">
                <div class="flex items-center gap-3">
                    <div class="bg-brand-blue text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">D</div>
                    <p class="text-sm"><strong>Dom√≠nio:</strong> A mat√©ria-prima. Onde o $x$ mora. (Quem pode entrar na m√°quina).</p>
                </div>
                <div class="flex items-center gap-3">
                    <div class="bg-brand-orange text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">CD</div>
                    <p class="text-sm"><strong>Contradom√≠nio:</strong> O dep√≥sito. Onde as respostas MORAM (mas nem todas s√£o usadas).</p>
                </div>
                <div class="flex items-center gap-3">
                    <div class="bg-brand-green text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">Im</div>
                    <p class="text-sm"><strong>Imagem:</strong> O produto final. As respostas que realmente SA√çRAM.</p>
                </div>
            </div>

            [WIDGET:interactive_domain_range_mapper]
        `,

            "An√°lise Gr√°fica: Crescimento, Decrescimento, Sinais": `
            <h3>1. Lendo a Montanha Russa üé¢</h3>
            <p>Um gr√°fico conta a hist√≥ria da fun√ß√£o. Ele sobe, desce, cruza o ch√£o (eixo X) e mergulha no subsolo.</p>
            <ul class="list-disc list-inside text-sm text-gray-700 mb-6">
                <li><strong>Crescente üìà:</strong> Quanto mais para a direita, mais alto.</li>
                <li><strong>Decrescente üìâ:</strong> Quanto mais para a direita, mais baixo.</li>
                <li><strong>Raiz (Zero):</strong> Onde corta o eixo X.</li>
            </ul>

            <p>Passe o scanner no gr√°fico para analisar o comportamento:</p>

            [WIDGET:interactive_graph_analyzer]
        `,

            "Tipologia: Injetora, Sobrejetora e Bijetora": `
            <h3>1. As Personalidades das Fun√ß√µes üé≠</h3>
            <p>Como as setas saem de um conjunto e chegam no outro?</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6 text-sm">
                <div class="bg-white p-3 border-t-4 border-blue-500 shadow-sm rounded">
                    <strong>Injetora</strong><br>
                    "Fiel". Cada x tem um y exclusivo. Ningu√©m no destino recebe duas setas.
                </div>
                <div class="bg-white p-3 border-t-4 border-orange-500 shadow-sm rounded">
                    <strong>Sobrejetora</strong><br>
                    "Espa√ßosa". Ocupa todo o contradom√≠nio. N√£o sobra ningu√©m sem seta no destino.
                </div>
                <div class="bg-white p-3 border-t-4 border-green-500 shadow-sm rounded">
                    <strong>Bijetora</strong><br>
                    "Perfeita". √â Fiel e Espa√ßosa ao mesmo tempo. Casamento perfeito um-para-um.
                </div>
            </div>

            [WIDGET:interactive_function_types_arrows]
        `,

            "Fun√ß√£o Par e Fun√ß√£o √çmpar": `
            <h3>1. O Espelho Matem√°tico ü™û</h3>
            <p>Algumas fun√ß√µes t√™m simetrias incr√≠veis.</p>
            <ul class="list-none space-y-3 mb-6">
                <li class="bg-gray-50 p-3 rounded-lg border-l-4 border-purple-500">
                    <strong>Fun√ß√£o Par:</strong> Sim√©trica no eixo Y (como um rosto).<br>
                    $f(x) = f(-x)$ (Ex: $x^2$)
                </li>
                <li class="bg-gray-50 p-3 rounded-lg border-l-4 border-yellow-500">
                    <strong>Fun√ß√£o √çmpar:</strong> Sim√©trica na origem (gira 180¬∞).<br>
                    $f(-x) = -f(x)$ (Ex: $x^3$)
                </li>
            </ul>

            [WIDGET:interactive_symmetry_tester]
        `,

            "Fun√ß√£o Composta": `
            <h3>1. A Boneca Russa ü™Ü</h3>
            <p>E se colocarmos uma m√°quina dentro da outra? Isso √© a fun√ß√£o composta $f(g(x))$, ou "f bola g".</p>
            <p>A sa√≠da da m√°quina de dentro ($g$) vira a entrada da m√°quina de fora ($f$).</p>
            
            <div class="text-center font-mono font-bold bg-gray-800 text-white p-3 rounded-lg my-4">
                x ‚ûî [ g ] ‚ûî y ‚ûî [ f ] ‚ûî z
            </div>

            [WIDGET:interactive_composite_machine]
        `,

            "Fun√ß√£o Inversa": `
            <h3>1. O Bot√£o Desfazer ‚Ü©Ô∏è</h3>
            <p>A fun√ß√£o inversa ($f^{-1}$) faz o caminho de volta. Se $f$ transforma 2 em 4, a inversa transforma 4 em 2.</p>
            <p>Graficamente, elas s√£o reflexos perfeitos na linha $y=x$ (a diagonal).</p>

            [WIDGET:interactive_inverse_graph]
        `,

            // =======================================================
            // UNIDADE 3: FUN√á√ÉO AFIM (1¬∫ GRAU)
            // =======================================================

            "Defini√ß√£o e Gr√°fico": `
            <h3>1. A Linha Reta üìè</h3>
            <p>A fun√ß√£o mais simples e √∫til do mundo. Ela descreve movimentos constantes, contas de luz, corridas de t√°xi.</p>
            <p class="text-center text-2xl font-black text-brand-blue my-4">f(x) = ax + b</p>
            <p>O gr√°fico √© sempre uma <strong>RETA</strong>.</p>
        `,

            "Coeficientes Angular (Taxa de Varia√ß√£o) e Linear": `
            <h3>1. Quem Manda na Reta? üéõÔ∏è</h3>
            <p>Na f√≥rmula $y = ax + b$, cada letra tem um superpoder:</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue">
                    <h4 class="font-bold text-brand-blue">Coeficiente "a" (Angular)</h4>
                    <p class="text-sm">Define a <strong>Inclina√ß√£o</strong>. √â a velocidade de crescimento. Se $a$ √© positivo, sobe. Se negativo, desce.</p>
                </div>
                <div class="bg-green-50 p-4 rounded-xl border-l-4 border-brand-green">
                    <h4 class="font-bold text-brand-green">Coeficiente "b" (Linear)</h4>
                    <p class="text-sm">Define o <strong>In√≠cio</strong>. √â onde a reta corta o eixo Y (quando $x=0$).</p>
                </div>
            </div>

            <p>Mexa nos controles e veja a reta dan√ßar:</p>

            [WIDGET:interactive_linear_slope_lab]
        `,

            "Zero da Fun√ß√£o e Equa√ß√£o do 1¬∫ Grau": `
            <h3>1. O Tiro ao Alvo üéØ</h3>
            <p>O <strong>Zero da Fun√ß√£o</strong> (ou Raiz) √© o valor de $x$ onde o gr√°fico corta o eixo horizontal (X). √â quando $f(x) = 0$.</p>
            <p>Geometricamente, √© o momento que o avi√£o pousa na pista.</p>

            [WIDGET:interactive_linear_root_finder]
        `,

            "Estudo do Sinal": `
            <h3>1. Positivo ou Negativo? üå°Ô∏è</h3>
            <p>Estudar o sinal √© saber quando a fun√ß√£o est√° "acima do mar" (positiva) ou "abaixo do mar" (negativa). Tudo depende da Raiz.</p>
            
            <ul class="list-none text-sm space-y-2 mb-4">
                <li>üü¢ <strong>f(x) > 0:</strong> Gr√°fico acima do eixo X.</li>
                <li>üî¥ <strong>f(x) < 0:</strong> Gr√°fico abaixo do eixo X.</li>
            </ul>

            [WIDGET:interactive_sign_study_linear]
        `,

            "Inequa√ß√µes do 1¬∫ Grau (Simples, Produto e Quociente)": `
            <h3>1. O Jogo do Var√°l üëï</h3>
            <p>Para resolver inequa√ß√µes complexas como $(x-2)(x+5) > 0$, usamos o "Var√°l de Sinais". Analisamos o sinal de cada parente separadamente e depois fazemos a regra de sinal.</p>
            <p>Mais com Mais d√° Mais (+), Menos com Menos d√° Mais (+)... voc√™ j√° sabe!</p>

            [WIDGET:interactive_inequality_number_line]
        `,

            // =======================================================
            // UNIDADE 4: FUN√á√ÉO QUADR√ÅTICA (2¬∫ GRAU)
            // =======================================================

            "Defini√ß√£o e Concavidade da Par√°bola": `
            <h3>1. A Curva da Gravidade üçé</h3>
            <p>Quando chutamos uma bola ou jogamos uma pedra, ela faz uma curva chamada <strong>Par√°bola</strong>. Isso √© fun√ß√£o do 2¬∫ Grau!</p>
            <p class="text-center text-2xl font-black text-brand-purple my-4">f(x) = ax¬≤ + bx + c</p>
            
            <div class="bg-gray-100 p-4 rounded-xl text-center text-sm mb-4">
                O sinal do <strong>"a"</strong> manda no humor da par√°bola:<br>
                üôÇ <strong>a > 0:</strong> Feliz (Concavidade para cima)<br>
                ‚òπÔ∏è <strong>a < 0:</strong> Triste (Concavidade para baixo)
            </div>

            [WIDGET:interactive_parabola_smiley]
        `,

            "Ra√≠zes e F√≥rmula de Bhaskara": `
            <h3>1. Onde a Bola Cai? ‚õ≥</h3>
            <p>As ra√≠zes s√£o os pontos onde a par√°bola toca o ch√£o (eixo X). Para ach√°-las, usamos o famoso Delta ($\\Delta$) e Bhaskara.</p>
            <p>O Delta √© o profeta: ele diz o futuro das ra√≠zes antes de calcularmos.</p>
            
            <ul class="text-sm space-y-1 mb-6">
                <li>‚Ä¢ $\\Delta > 0$: Corta em 2 lugares.</li>
                <li>‚Ä¢ $\\Delta = 0$: Toca em 1 lugar (beija o eixo).</li>
                <li>‚Ä¢ $\\Delta < 0$: Flutua (n√£o toca o eixo X).</li>
            </ul>

            [WIDGET:interactive_quadratic_roots_visualizer]
        `,

            "V√©rtice: M√°ximos e M√≠nimos e Conjunto Imagem": `
            <h3>1. O Ponto Extremo üèîÔ∏è</h3>
            <p>O V√©rtice √© o ponto de virada. √â o topo da montanha (M√°ximo) ou o fundo do vale (M√≠nimo).</p>
            <p>Na economia, usamos isso para achar o <strong>Lucro M√°ximo</strong> ou o <strong>Custo M√≠nimo</strong>.</p>
            
            <div class="bg-yellow-50 p-3 rounded-lg border-l-4 border-brand-yellow text-center font-mono">
                Xv = -b / 2a<br>
                Yv = -$\\Delta$ / 4a
            </div>

            [WIDGET:interactive_vertex_explorer]
        `,

            "Forma Can√¥nica e Fatorada": `
            <h3>1. Outras Roupas da Mesma Fun√ß√£o üëó</h3>
            <p>A forma cl√°ssica $ax^2+bx+c$ √© boa, mas √†s vezes outras formas s√£o mais √∫teis.</p>
            <ul class="list-disc list-inside text-sm mb-4">
                <li><strong>Fatorada:</strong> $a(x - x_1)(x - x_2)$. Mostra as ra√≠zes na cara!</li>
                <li><strong>Can√¥nica:</strong> $a(x - x_v)^2 + y_v$. Mostra o v√©rtice na cara!</li>
            </ul>
        `,

            "Estudo do Sinal da Fun√ß√£o Quadr√°tica": `
            <h3>1. Dentro e Fora das Ra√≠zes üåâ</h3>
            <p>O sinal da par√°bola muda quando passamos pelas ra√≠zes. Existe uma regra mnem√¥nica:</p>
            <p class="text-center font-bold text-brand-blue my-4">"MaCaMa"</p>
            <p class="text-center text-sm text-gray-500">Mesmo sinal de 'a' (fora), Contr√°rio de 'a' (dentro), Mesmo de 'a' (fora).</p>
            
            [WIDGET:interactive_quadratic_sign_scheme]
        `,

            "Inequa√ß√µes do 2¬∫ Grau (Produto e Quociente)": `
            <h3>1. Var√°l de Sinais Avan√ßado üß∫</h3>
            <p>Para resolver $(x^2 - 4)(x+1) < 0$, desenhamos as par√°bolas e retas num var√°l e vemos onde os sinais se combinam para dar negativo.</p>
        `,

            // =======================================================
            // UNIDADE 5: FUN√á√ÉO MODULAR
            // =======================================================

            "M√≥dulo de um N√∫mero Real (Defini√ß√£o Geom√©trica)": `
            <h3>1. Dist√¢ncia √© sempre Positiva üìè</h3>
            <p>O m√≥dulo $|x|$ mede a dist√¢ncia do n√∫mero at√© o zero. N√£o importa se voc√™ andou para frente ou para tr√°s, a dist√¢ncia √© positiva.</p>
            <div class="text-center text-2xl font-black my-4">|-5| = 5</div>
            
            [WIDGET:interactive_absolute_value_distance]
        `,

            "Fun√ß√£o Modular B√°sica e Gr√°fico": `
            <h3>1. O Gr√°fico do "V" da Vit√≥ria ‚úåÔ∏è</h3>
            <p>A fun√ß√£o $f(x) = |x|$ √© famosa pelo seu formato de "V". Ela pega a parte negativa da reta (que estava no subsolo) e rebate para cima.</p>
            <p>Nada fica negativo na sa√≠da do m√≥dulo!</p>

            [WIDGET:interactive_modulus_graph_bouncer]
        `,

            "Transla√ß√µes e Transforma√ß√µes de Gr√°ficos Modulares": `
            <h3>1. Movendo o V üïπÔ∏è</h3>
            <p>Podemos mover o gr√°fico do m√≥dulo pelo plano:</p>
            <ul class="text-sm space-y-2 mb-4">
                <li>$|x| + k$: Sobe ou desce.</li>
                <li>$|x - k|$: Vai para direita ou esquerda (cuidado, o sinal engana!).</li>
                <li>$k|x|$: Fica mais fechado (agudo) ou aberto.</li>
            </ul>
        `,

            "Equa√ß√µes Modulares": `
            <h3>1. Dois Caminhos Poss√≠veis üõ£Ô∏è</h3>
            <p>Se $|x| = 5$, ent√£o quem est√° l√° dentro pode ser 5 <strong>OU</strong> -5. Sempre abrimos a conta em dois casos para resolver.</p>
        `,

            "Inequa√ß√µes Modulares": `
            <h3>1. Dentro ou Fora? üì¶</h3>
            <p>Resolver $|x| < 3$ significa: "Quero n√∫meros cuja dist√¢ncia √© menor que 3". (Entre -3 e 3).</p>
            <p>Resolver $|x| > 3$ significa: "Quero dist√¢ncia maior que 3". (Longe do zero, extremos).</p>
        `,

            // =======================================================
            // UNIDADE 6: FUN√á√ÉO EXPONENCIAL
            // =======================================================

            "Revis√£o de Potencia√ß√£o e Propriedades": `
            <h3>1. A Base do Crescimento R√°pido üöÄ</h3>
            <p>Antes de voar, cheque os motores! As regras de pot√™ncia ($a^n \\cdot a^m = a^{n+m}$, etc.) s√£o o combust√≠vel desta unidade.</p>
            
            [WIDGET:interactive_power_rules_match]
        `,

            "Fun√ß√£o Exponencial: Defini√ß√£o, Gr√°fico e Ass√≠ntota": `
            <h3>1. A Decolagem do Foguete üìà</h3>
            <p>A fun√ß√£o exponencial ($a^x$) cresce muito, muito r√°pido. √â o tal "crescimento viral".</p>
            <p>O gr√°fico tem uma caracter√≠stica √∫nica: ele tenta encostar no eixo X, mas nunca consegue! Essa linha intoc√°vel chama-se <strong>Ass√≠ntota</strong>.</p>
            
            <p>Mexa na base e veja a diferen√ßa entre Crescimento Viral (base > 1) e Decaimento Radioativo (base entre 0 e 1):</p>

            [WIDGET:interactive_exponential_curve]
        `,

            "Equa√ß√µes Exponenciais (Igualdade de Bases e Vari√°vel Auxiliar)": `
            <h3>1. O Jogo das Bases Iguais ‚öñÔ∏è</h3>
            <p>O segredo para resolver $2^x = 32$ √© escrever todo mundo na mesma l√≠ngua. Como $32 = 2^5$, ent√£o $2^x = 2^5$, logo $x=5$!</p>
            <p>Se as bases s√£o iguais, os expoentes t√™m que ser iguais.</p>
        `,

            "Inequa√ß√µes Exponenciais": `
            <h3>1. Cuidado com a Base Pequena! ‚ö†Ô∏è</h3>
            <p>Se a base for maior que 1 ($2^x > 2^3$), mantemos o sinal ($x > 3$).</p>
            <p>Mas se a base for pequena (entre 0 e 1, tipo $0,5^x > 0,5^3$), o sinal <strong>INVERTE</strong> ($x < 3$)! Quanto mais voc√™ multiplica um n√∫mero pequeno, menor ele fica.</p>
        `,

            "Aplica√ß√µes: Crescimento Populacional e Decaimento Radioativo": `
            <h3>1. Matem√°tica da Vida Real ü¶†‚ò¢Ô∏è</h3>
            <p>Bact√©rias se duplicando? Juros compostos? Elementos radioativos sumindo (Meia-vida)? Tudo isso segue o modelo exponencial.</p>
            
            [WIDGET:interactive_half_life_decay]
        `,

            // =======================================================
            // UNIDADE 7: FUN√á√ÉO LOGAR√çTMICA
            // =======================================================

            "Defini√ß√£o de Logaritmo": `
            <h3>1. O Que √© Log? ü§î</h3>
            <p>N√£o tenha medo do nome feio! Logaritmo √© apenas uma pergunta:</p>
            <div class="bg-gray-800 text-white p-4 rounded-xl text-center text-lg my-4">
                $\\log_2(8) = ?$
            </div>
            <p class="text-center font-bold text-brand-blue">"A base 2 deve ser elevada a qual expoente para dar 8?"</p>
            <p class="text-center">Resposta: 3 (porque $2^3 = 8$).</p>
            
            <p><strong>Log √© apenas um expoente disfar√ßado!</strong></p>

            [WIDGET:interactive_log_definition_wheel]
        `,

            "Condi√ß√£o de Exist√™ncia": `
            <h3>1. As Regras do Jogo üö´</h3>
            <p>O Logaritmo √© sens√≠vel. Ele n√£o aceita qualquer n√∫mero.</p>
            <ul class="list-disc list-inside text-sm mb-4">
                <li>O Logaritmando (o n√∫mero de dentro) deve ser <strong>Positivo</strong>.</li>
                <li>A Base deve ser <strong>Positiva</strong> e <strong>Diferente de 1</strong>.</li>
            </ul>
        `,

            "Propriedades Operat√≥rias (Produto, Quociente, Pot√™ncia)": `
            <h3>1. Superpoderes do Log ‚ö°</h3>
            <p>Os logs t√™m o poder de rebaixar opera√ß√µes matem√°ticas dif√≠ceis para n√≠veis mais f√°ceis:</p>
            <div class="grid grid-cols-1 gap-2 my-4 text-sm font-mono bg-gray-50 p-4 rounded-xl border border-gray-200">
                <div>Multiplica√ß√£o ‚ûî Soma</div>
                <div>Divis√£o ‚ûî Subtra√ß√£o</div>
                <div>Pot√™ncia ‚ûî Multiplica√ß√£o (Tombo!)</div>
            </div>
            
            <p>Clique nas propriedades para ver a transforma√ß√£o:</p>
            
            [WIDGET:interactive_log_properties_clicker]
        `,

            "Mudan√ßa de Base": `
            <h3>1. O Tradutor Universal üåê</h3>
            <p>√Äs vezes sua calculadora s√≥ tem base 10, mas voc√™ precisa calcular base 2. A Mudan√ßa de Base salva o dia, permitindo reescrever qualquer log em uma base conveniente.</p>
        `,

            "Fun√ß√£o Logar√≠tmica: Gr√°fico, Dom√≠nio e Imagem": `
            <h3>1. O Espelho da Exponencial ü™û</h3>
            <p>A fun√ß√£o Log √© a inversa da Exponencial. O gr√°fico cresce muuuito devagar (c√¢mera lenta).</p>
            <p>A ass√≠ntota agora √© vertical (eixo Y). O gr√°fico nunca toca o eixo Y.</p>

            [WIDGET:interactive_log_graph_explorer]
        `,

            "Equa√ß√µes Logar√≠tmicas": `
            <h3>1. Destravando o X üîë</h3>
            <p>Usamos a defini√ß√£o (o "chute" da base) para transformar o log em exponencial e resolver. Lembre-se sempre de testar a Condi√ß√£o de Exist√™ncia no final!</p>
        `,

            "Inequa√ß√µes Logar√≠tmicas": `
            <h3>1. Cuidado com a Base (De novo!) ‚ö†Ô∏è</h3>
            <p>Assim como na exponencial: se a base for maior que 1, mant√©m o sinal. Se for entre 0 e 1, <strong>INVERTE</strong> o sinal da desigualdade.</p>
        `,

            "Aplica√ß√µes: Escala Richter, pH, Decib√©is": `
            <h3>1. Medindo o Invis√≠vel üåç</h3>
            <p>Terremotos, acidez e som variam em escalas gigantescas. O Log serve para "compactar" esses n√∫meros enormes em uma escala de 0 a 10 que conseguimos entender.</p>
            <p>Um terremoto grau 6 n√£o √© o dobro do grau 3... √© 1000 vezes mais forte ($10^3$)!</p>

            [WIDGET:interactive_richter_scale_sim]
        `,

            // =======================================================
            // UNIDADE 8: SEQU√äNCIAS E PROGRESS√ïES
            // =======================================================

            "Defini√ß√£o de Sequ√™ncia e Lei de Forma√ß√£o": `
            <h3>1. A Fila dos N√∫meros üî¢</h3>
            <p>Uma sequ√™ncia √© uma lista ordenada. Cada n√∫mero tem seu lugar ($a_1, a_2, a_3...$). A Lei de Forma√ß√£o √© a regra que gera os n√∫meros.</p>
        `,

            "Progress√£o Aritm√©tica (PA): Termo Geral, Propriedades e Soma": `
            <h3>1. A Escada Constante (PA) ü™ú</h3>
            <p>Na PA, subimos de degrau em degrau somando sempre o mesmo valor (Raz√£o $r$).</p>
            <p>Ex: 2, 5, 8, 11... (Soma 3).</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-center">
                <span class="font-bold text-brand-blue">Gauss e a Soma:</span><br>
                Para somar uma PA, basta somar o primeiro com o √∫ltimo e multiplicar pelos pares.<br>
                $$ S_n = \\frac{(a_1 + a_n) \\cdot n}{2} $$
            </div>

            [WIDGET:interactive_pa_visualizer]
        `,

            "Progress√£o Geom√©trica (PG): Termo Geral e Propriedades": `
            <h3>1. A Multiplica√ß√£o Explosiva (PG) üí•</h3>
            <p>Na PG, multiplicamos pela raz√£o ($q$). O crescimento √© muito mais r√°pido.</p>
            <p>Ex: 2, 4, 8, 16, 32... (Multiplica por 2).</p>

            [WIDGET:interactive_pg_growth]
        `,

            "Soma de PG Finita e Infinita (S√©ries Geom√©tricas)": `
            <h3>1. O Paradoxo de Zen√£o üê¢</h3>
            <p>√â poss√≠vel somar infinitos n√∫meros e dar um resultado finito? Sim! Se os n√∫meros diminuem r√°pido o suficiente (PG com $0 < q < 1$).</p>
            <p>Ex: $1 + 1/2 + 1/4 + 1/8... = 2$.</p>
            
            [WIDGET:interactive_infinite_square_sum]
        `,

            "Matem√°tica Financeira: Juros Compostos e S√©ries Uniformes": `
            <h3>1. Dinheiro Faz Dinheiro üí∞</h3>
            <p>Juros Compostos nada mais s√£o do que uma <strong>Progress√£o Geom√©trica</strong> aplicada ao dinheiro. O dinheiro cresce exponencialmente.</p>
            
            <div class="bg-green-50 p-4 rounded-xl border border-green-200 text-center my-4">
                <span class="text-3xl font-black text-brand-green">M = C(1+i)^t</span>
            </div>

            [WIDGET:interactive_compound_interest_calc]
        `,


            //
            // SEGUNDO ANO DO ENSINO M√âDIO
            //

            //
            // =================================================================
            // CONTE√öDO 2¬∫ ANO EM
            // =================================================================

            // =======================================================
            // UNIDADE 1: TRIGONOMETRIA - CICLO E FUN√á√ïES
            // =======================================================

            "Medidas de Arcos: Graus e Radianos": `
            <h3>1. A L√≠ngua dos √Çngulos üó£Ô∏è</h3>
            <p>Estamos acostumados com Graus (uma volta = 360¬∞), mas na matem√°tica "adulta" (C√°lculo e F√≠sica), usamos o <strong>Radiano</strong>.</p>
            <p>O Radiano √© baseado no pr√≥prio raio da circunfer√™ncia. Uma volta completa ($360^\\circ$) tem exatamente $2\pi$ radianos (aprox. 6,28 raios enrolados na borda).</p>
            
            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-center font-mono font-bold">
                180¬∞ = $\\pi$ rad
            </div>

            [WIDGET:interactive_radians_converter]
        `,

            "Ciclo Trigonom√©trico e Arcos C√¥ngruos": `
            <h3>1. A Roda Gigante Infinita üé°</h3>
            <p>O Ciclo Trigonom√©trico √© uma circunfer√™ncia de raio 1 centrada num plano cartesiano. Ele √© o "mapa" de toda a trigonometria.</p>
            
            <div class="bg-gray-800 text-white p-4 rounded-xl shadow-lg mb-6">
                <p class="text-sm text-gray-400 uppercase font-bold mb-2">Arcos C√¥ngruos</p>
                <p>Se voc√™ der uma volta completa e parar no mesmo lugar, o √¢ngulo muda, mas a posi√ß√£o n√£o. $30^\\circ$ √© c√¥ngruo a $390^\\circ$ ($30+360$).</p>
            </div>

            <p>Gire a roda e veja os √¢ngulos se acumularem:</p>

            [WIDGET:interactive_trig_cycle_spin]
        `,

            "Seno, Cosseno e Tangente no Ciclo": `
            <h3>1. As Sombras do Ponteiro ‚òÄÔ∏è</h3>
            <p>Imagine um ponto girando no ciclo. Ele projeta "sombras" nos eixos:</p>
            <ul class="list-none space-y-2 mb-6">
                <li class="flex items-center gap-2"><div class="w-4 h-4 bg-brand-blue rounded-full"></div> <strong>Cosseno (Com Sono):</strong> Est√° deitado no eixo X.</li>
                <li class="flex items-center gap-2"><div class="w-4 h-4 bg-brand-orange rounded-full"></div> <strong>Seno (Sem Sono):</strong> Est√° em p√© no eixo Y.</li>
                <li class="flex items-center gap-2"><div class="w-4 h-4 bg-brand-purple rounded-full"></div> <strong>Tangente:</strong> √â uma reta que "tangencia" (toca) o lado direito do ciclo.</li>
            </ul>

            <p>Movimente o √¢ngulo e veja as linhas crescerem e diminu√≠rem:</p>

            [WIDGET:interactive_sin_cos_visualizer]
        `,

            "Rela√ß√£o Fundamental e Auxiliares (Sec, Cossec, Cotg)": `
            <h3>1. O Teorema de Pit√°goras no Ciclo üìê</h3>
            <p>Como o raio do ciclo √© 1, formamos um tri√¢ngulo ret√¢ngulo onde os catetos s√£o Seno e Cosseno. Da√≠ nasce a lei mais importante:</p>
            
            <div class="text-center text-2xl font-black text-brand-green my-4 bg-green-50 p-4 rounded-xl border border-green-200">
                $\\sin^2 x + \\cos^2 x = 1$
            </div>

            <p>As outras s√£o apenas inversos: Secante (inverso de Cos), Cossecante (inverso de Sen) e Cotangente (inverso de Tan).</p>
        `,

            "Redu√ß√£o ao 1¬∫ Quadrante e Simetrias": `
            <h3>1. O Jogo dos Espelhos ü™û</h3>
            <p>O ciclo √© sim√©trico. Um √¢ngulo no 2¬∫, 3¬∫ ou 4¬∫ quadrante tem um "irm√£o g√™meo" no 1¬∫ quadrante. O valor num√©rico √© o mesmo, s√≥ muda o sinal (+ ou -).</p>
            <p>A regra dos sinais √©: <strong>SETACA</strong> (Seno, Tangente, Cosseno - quem √© positivo em cada quadrante 1, 2, 3, 4).</p>

            [WIDGET:interactive_quadrant_mirror]
        `,

            "Fun√ß√µes Seno e Cosseno: Gr√°ficos, Per√≠odo e Imagem": `
            <h3>1. As Ondas da Vida üåä</h3>
            <p>Se desenrolarmos o movimento do ciclo trigonom√©trico ao longo do tempo, criamos ondas. Isso explica o som, a luz, as mar√©s e a corrente alternada.</p>
            <p><strong>Senoide:</strong> Come√ßa no 0. <strong>Cossenoide:</strong> Come√ßa no 1 (topo).</p>

            [WIDGET:interactive_wave_maker]
        `,

            "Fun√ß√£o Tangente: Gr√°fico e Dom√≠nio": `
            <h3>1. A Curva Explosiva üí•</h3>
            <p>A tangente √© dram√°tica. Quando o √¢ngulo chega perto de 90¬∞, ela vai para o infinito! Por isso, o gr√°fico tem quebras (ass√≠ntotas).</p>
        `,

            "Transforma√ß√µes Gr√°ficas (y = a + b.sen(cx + d))": `
            <h3>1. Remixando a Onda üéõÔ∏è</h3>
            <p>Podemos esticar, esmagar e mover a onda alterando os n√∫meros na f√≥rmula:</p>
            <ul class="text-sm space-y-2 mb-4">
                <li><strong>a:</strong> Sobe/Desce a onda (Eixo m√©dio).</li>
                <li><strong>b:</strong> Amplitude (Volume/Altura da onda).</li>
                <li><strong>c:</strong> Frequ√™ncia (Deixa a onda mais r√°pida ou lenta).</li>
            </ul>

            [WIDGET:interactive_wave_synthesizer]
        `,

            // =======================================================
            // UNIDADE 2: IDENTIDADES, TRANSFORMA√á√ïES E EQUA√á√ïES
            // =======================================================

            "F√≥rmulas de Adi√ß√£o e Subtra√ß√£o de Arcos": `
            <h3>1. A Matem√°tica do Amor üíë</h3>
            <p>Seno e Cosseno t√™m regras sociais diferentes:</p>
            <div class="bg-gray-100 p-4 rounded-xl text-sm italic text-gray-600 my-4 text-center">
                "Minha terra tem palmeiras onde canta o sabi√°...<br>
                <strong>Seno A Cosseno B, Seno B Cosseno A.</strong>" (Sinal igual)
            </div>
            <p>J√° o Cosseno √© ego√≠sta (Cossa A Cossa B) e "troca o sinal" dos outros (Sena A Sena B).</p>
        `,

            "Arco Duplo e Arco Metade": `
            <h3>1. Dobrando a Aposta üé∞</h3>
            <p>Como calcular $\sin(120^\circ)$ sabendo $\sin(60^\circ)$? Usamos as f√≥rmulas de arco duplo.</p>
            <p>$\cos(2x) = \cos^2 x - \sin^2 x$ (Cuidado para n√£o confundir com a rela√ß√£o fundamental!).</p>
        `,

            "Transforma√ß√£o em Produto (F√≥rmulas de Werner - Prostaferese)": `
            <h3>1. De Soma para Multiplica√ß√£o ‚úñÔ∏è</h3>
            <p>√Äs vezes √© mais f√°cil multiplicar do que somar ondas. Essas f√≥rmulas transformam $Sen A + Sen B$ em um produto. Essencial para engenharia de som.</p>
        `,

            "Equa√ß√µes Trigonom√©tricas em R": `
            <h3>1. O Detetive do √Çngulo üïµÔ∏è</h3>
            <p>Resolver $\\sin(x) = 0,5$ √© perguntar: "Em quais momentos da volta a altura √© 0,5?".</p>
            <p>Lembre-se: No ciclo, existem infinitas voltas, ent√£o a resposta geral √© $x + 2k\\pi$.</p>
            
            [WIDGET:interactive_trig_equation_solver]
        `,

            "Inequa√ß√µes Trigonom√©tricas (Visualiza√ß√£o no Ciclo)": `
            <h3>1. Pintando o Ciclo üé®</h3>
            <p>Para resolver $\\cos(x) > 0,5$, olhamos para o ciclo e pintamos toda a regi√£o √† direita da linha vertical 0,5.</p>
        `,

            // =======================================================
            // UNIDADE 3: AN√ÅLISE COMBINAT√ìRIA
            // =======================================================

            "Princ√≠pio Fundamental da Contagem (PFC)": `
            <h3>1. A √Årvore de Decis√µes üå≥</h3>
            <p>Se voc√™ tem 3 camisas e 2 cal√ßas, tem $3 \\times 2 = 6$ looks. O PFC diz: <strong>Multiplique as op√ß√µes de cada etapa.</strong></p>
            
            [WIDGET:interactive_outfit_combiner]
        `,

            "Fatorial e suas propriedades": `
            <h3>1. O Exclama√ß√£o Matem√°tico (!) ‚ùó</h3>
            <p>O fatorial ($n!$) √© uma contagem regressiva explosiva. Usamos para organizar filas.</p>
            <p class="text-center font-mono text-xl my-4">$5! = 5 \\times 4 \\times 3 \\times 2 \\times 1 = 120$</p>
            
            [WIDGET:interactive_factorial_slider]
        `,

            "Arranjos Simples": `
            <h3>1. O P√≥dio Importa ü•áü•àü•â</h3>
            <p>No Arranjo, a <strong>ORDEM IMPORTA</strong>. Escolher Ana e Bia √© diferente de escolher Bia e Ana (uma √© presidente, a outra vice).</p>
            <p class="text-brand-blue font-bold text-center">"A ordem Altera o Arranjo" (AA)</p>
        `,

            "Permuta√ß√£o Simples e com Repeti√ß√£o": `
            <h3>1. A Dan√ßa das Cadeiras ü™ë</h3>
            <p>Permutar √© embaralhar. √â um anagrama. Se tivermos letras repetidas (como em "ARARA"), dividimos pelas repeti√ß√µes para n√£o contar palavras iguais.</p>

            [WIDGET:interactive_anagram_maker]
        `,

            "Permuta√ß√£o Circular": `
            <h3>1. A Roda de Ciranda ‚≠ï</h3>
            <p>Numa roda, girar as pessoas n√£o cria uma nova ordem. Por isso, fixamos uma pessoa e permutamos o resto.</p>
            <p>$PC_n = (n-1)!$</p>
        `,

            "Combina√ß√£o Simples e Propriedades": `
            <h3>1. A Ordem N√ÉO Importa ü•ó</h3>
            <p>Na Combina√ß√£o, estamos fazendo uma salada de frutas. Banana e Ma√ß√£ √© o mesmo que Ma√ß√£ e Banana. O grupo √© o mesmo.</p>
            
            <div class="bg-yellow-50 p-4 rounded-xl text-center font-bold text-brand-orange border border-yellow-200">
                "Combina√ß√£o = Com Banana" (Mistura tudo)
            </div>

            [WIDGET:interactive_combo_vs_permutation]
        `,

            "Tri√¢ngulo de Pascal": `
            <h3>1. A Pir√¢mide dos N√∫meros üîº</h3>
            <p>Um tri√¢ngulo infinito onde cada n√∫mero √© a soma dos dois de cima. Ele esconde segredos sobre combina√ß√µes e pot√™ncias.</p>
            
            [WIDGET:interactive_pascal_triangle]
        `,

            "Bin√¥mio de Newton (Termo Geral)": `
            <h3>1. Expandindo Pot√™ncias üí•</h3>
            <p>Para calcular $(a+b)^5$ sem sofrer multiplicando 5 vezes, usamos os n√∫meros do Tri√¢ngulo de Pascal como coeficientes.</p>
        `,

            // =======================================================
            // UNIDADE 4: PROBABILIDADE
            // =======================================================

            "Defini√ß√£o Cl√°ssica (Laplace)": `
            <h3>1. Medindo a Sorte üçÄ</h3>
            <p>A probabilidade √© a matem√°tica da incerteza. A f√≥rmula de ouro √©:</p>
            <div class="bg-gray-800 text-white p-4 rounded-xl text-center my-4 font-mono">
                $$ P = \\frac{\\text{O que eu quero}}{\\text{Tudo que pode acontecer}} $$
            </div>
        `,

            "Probabilidade da Uni√£o e Eventos Mutuamente Exclusivos": `
            <h3>1. A Regra do "OU" ‚ûï</h3>
            <p>Qual a chance de tirar um √Ås <strong>OU</strong> um Rei? Somamos as chances. Mas cuidado: se houver intersec√ß√£o (carta que √© as duas coisas), temos que subtrair para n√£o contar dobrado.</p>
        `,

            "Probabilidade Condicional": `
            <h3>1. O Universo Diminuiu üîç</h3>
            <p>√â a chance de algo acontecer <strong>dado que</strong> outra coisa j√° aconteceu. A informa√ß√£o extra restringe nosso espa√ßo amostral.</p>
            <p>Ex: Qual a chance de ser √Ås, sabendo que a carta √© vermelha?</p>

            [WIDGET:interactive_conditional_probability_deck]
        `,

            "Eventos Independentes e Regra do Produto": `
            <h3>1. A Regra do "E" ‚úñÔ∏è</h3>
            <p>Qual a chance de dar Cara na moeda <strong>E</strong> 6 no dado? Como um n√£o afeta o outro, multiplicamos as probabilidades.</p>
        `,

            "Lei Binomial da Probabilidade": `
            <h3>1. Sucesso ou Fracasso ‚úÖ‚ùå</h3>
            <p>Usada quando repetimos um teste v√°rias vezes (chutar 5 p√™naltis). Queremos saber a chance de acertar exatamente k vezes.</p>
        `,

            // =======================================================
            // UNIDADE 5: MATRIZES E DETERMINANTES
            // =======================================================

            "Matrizes: Defini√ß√£o, Tipos Especiais e Igualdade": `
            <h3>1. Planilhas de Dados üìÖ</h3>
            <p>Uma matriz √© apenas uma tabela de n√∫meros organizada em Linhas e Colunas. √â como o computador enxerga imagens!</p>
            <p>Matriz Identidade ($I$) √© o "n√∫mero 1" das matrizes.</p>

            [WIDGET:interactive_matrix_builder]
        `,

            "Opera√ß√µes Matriciais (Soma, Subtra√ß√£o, Produto por Escalar, Produto Matricial)": `
            <h3>1. Aritm√©tica Tabelada ‚ûï</h3>
            <p>Somar √© f√°cil (casa com casa). Multiplicar √© mais complexo: <strong>"Linha por Coluna"</strong>. √â um movimento de mergulho.</p>
            
            [WIDGET:interactive_matrix_multiplication]
        `,

            "Matriz Inversa e Transposta": `
            <h3>1. Espelhando a Matriz üîÑ</h3>
            <p><strong>Transposta ($A^t$):</strong> O que √© linha vira coluna (troca a posi√ß√£o).</p>
            <p><strong>Inversa ($A^{-1}$):</strong> √â a matriz que "desfaz" o que a original fez. Multiplicando as duas, d√° a Identidade.</p>
        `,

            "Determinantes: Defini√ß√£o e Regra de Sarrus (2x2, 3x3)": `
            <h3>1. O DNA da Matriz üß¨</h3>
            <p>O Determinante √© um n√∫mero √∫nico que resume a matriz quadrada. Se for zero, a matriz √© "achatada" (n√£o tem inversa).</p>
            <p>Para 3x3, usamos a <strong>Regra de Sarrus</strong>: copia as colunas e multiplica nas diagonais.</p>

            [WIDGET:interactive_sarrus_rule]
        `,

            "Teorema de Laplace e Regra de Chi√≥": `
            <h3>1. Quebrando Matrizes Grandes üî®</h3>
            <p>Para matrizes 4x4 ou maiores, Sarrus n√£o funciona. Usamos Laplace para quebrar em matrizes menores (cofatores) ou Chi√≥ para reduzir a ordem.</p>
        `,

            "Propriedades dos Determinantes": `
            <h3>1. Atalhos Matem√°ticos üèéÔ∏è</h3>
            <p>Se uma linha for toda zero, o det √© 0. Se trocar duas linhas de lugar, o sinal do det inverte. Conhecer isso economiza muita conta!</p>
        `,

            // =======================================================
            // UNIDADE 6: SISTEMAS LINEARES
            // =======================================================

            "Equa√ß√£o Linear e Sistema Linear": `
            <h3>1. Cruzamento de Informa√ß√µes üö¶</h3>
            <p>Um sistema linear √© um conjunto de "dicas" (equa√ß√µes) que devem ser verdadeiras ao mesmo tempo. Geometricamente, √© onde retas ou planos se cruzam.</p>
        `,

            "Classifica√ß√£o quanto √†s solu√ß√µes (SPD, SPI, SI)": `
            <h3>1. O Veredito do Sistema üë®‚Äç‚öñÔ∏è</h3>
            <ul class="list-none space-y-2 mb-4 text-sm">
                <li class="bg-green-50 p-2 rounded border border-green-200"><strong>SPD:</strong> Determinado. 1 Solu√ß√£o √∫nica (Cruzamento em X).</li>
                <li class="bg-yellow-50 p-2 rounded border border-yellow-200"><strong>SPI:</strong> Indeterminado. Infinitas solu√ß√µes (Retas sobrepostas).</li>
                <li class="bg-red-50 p-2 rounded border border-red-200"><strong>SI:</strong> Imposs√≠vel. Sem solu√ß√£o (Retas paralelas).</li>
            </ul>

            [WIDGET:interactive_linear_system_visualizer]
        `,

            "Regra de Cramer": `
            <h3>1. A For√ßa dos Determinantes üí™</h3>
            <p>Cramer resolve o sistema usando apenas determinantes. √â elegante, mas trabalhoso para sistemas grandes.</p>
        `,

            "Escalonamento de Sistemas (M√©todo de Gauss)": `
            <h3>1. A Escada da Solu√ß√£o ü™ú</h3>
            <p>O m√©todo mais poderoso (usado por computadores). Eliminamos vari√°veis uma por uma at√© formar uma "escada" de equa√ß√µes, achando o valor da √∫ltima e voltando.</p>
            
            [WIDGET:interactive_gaussian_elimination]
        `,

            "Discuss√£o de Sistemas Lineares (Param√©tricos)": `
            <h3>1. O "E Se?" da Matem√°tica ü§î</h3>
            <p>Discutir um sistema √© analisar um par√¢metro $k$: "Para qual valor de $k$ o sistema tem solu√ß√£o?". √â uma an√°lise de condi√ß√µes de exist√™ncia.</p>
        `,

            // =======================================================
            // UNIDADE 7: GEOMETRIA ESPACIAL DE POSI√á√ÉO
            // =======================================================

            "Axiomas e Postulados (Euclides/Hilbert)": `
            <h3>1. As Regras do Jogo üìú</h3>
            <p>Na geometria espacial, aceitamos verdades sem prova (axiomas):</p>
            <ul class="list-disc list-inside text-sm">
                <li>Por dois pontos passa uma √∫nica reta.</li>
                <li>Por tr√™s pontos n√£o alinhados passa um √∫nico plano.</li>
            </ul>
        `,

            "Posi√ß√µes Relativas: Reta-Reta, Reta-Plano, Plano-Plano": `
            <h3>1. Coreografia no Espa√ßo ü©∞</h3>
            <p>No 3D, as coisas ficam interessantes. Duas retas podem n√£o se cruzar e N√ÉO serem paralelas: s√£o as <strong>Retas Reversas</strong> (uma passa por cima, outra por baixo, em dire√ß√µes diferentes).</p>

            [WIDGET:interactive_3d_lines_planes]
        `,

            "Perpendicularismo e Ortogonalidade no Espa√ßo": `
            <h3>1. O √Çngulo de 90¬∞ em 3D üìê</h3>
            <p>Uma reta √© perpendicular a um plano se ela for perpendicular a <strong>todas</strong> as retas do plano que passam pelo ponto de furo. √â como um poste fincado no ch√£o.</p>
        `,

            "Proje√ß√µes Ortogonais": `
            <h3>1. A Sombra do Meio-Dia ‚òÄÔ∏è</h3>
            <p>A proje√ß√£o ortogonal √© a "sombra" que um objeto faz no ch√£o quando o sol est√° exatamente em cima. √â "achatar" o objeto 3D em 2D.</p>
            
            [WIDGET:interactive_orthogonal_shadows]
        `,

            "Dist√¢ncias e √Çngulos no Espa√ßo (Diedros)": `
            <h3>1. O Canto da Sala üè†</h3>
            <p>Um <strong>Diedro</strong> √© o √¢ngulo formado por dois planos (como um livro aberto). A dist√¢ncia entre ponto e plano √© sempre a linha reta perpendicular (a mais curta).</p>
        `,

            //
            // TERCEIRO ANO DO ENSINO M√âDIO
            //

            //
            // =================================================================
            // CONTE√öDO 3¬∫ ANO EM
            // =================================================================

            // =======================================================
            // UNIDADE 1: GEOMETRIA ESPACIAL - POLIEDROS E PRISMAS
            // =======================================================

            "Poliedros: Defini√ß√£o, Elementos e Rela√ß√£o de Euler": `
            <h3>1. O Mundo em 3D üßä</h3>
            <p>Bem-vindo √† terceira dimens√£o! Um poliedro √© um s√≥lido fechado formado apenas por faces planas (pol√≠gonos). N√£o pode ter curvas!</p>
            <p>Eles s√£o feitos de 3 elementos:</p>
            <ul class="list-disc list-inside text-sm mb-4">
                <li><strong>Faces (F):</strong> As "paredes" planas.</li>
                <li><strong>Arestas (A):</strong> As "quinas" onde duas faces se encontram.</li>
                <li><strong>V√©rtices (V):</strong> As "pontas" onde as arestas se encontram.</li>
            </ul>

            <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-brand-blue my-4 text-center">
                <span class="font-bold text-brand-blue uppercase text-xs">Rela√ß√£o de Euler</span>
                <div class="text-3xl font-black text-brand-text mt-2">V + F = A + 2</div>
                <p class="text-xs text-gray-500 mt-1">"Vamos Fazer Amor a Dois" (Mnem√¥nico cl√°ssico)</p>
            </div>

            [WIDGET:interactive_euler_checker]
        `,

            "Poliedros Regulares (Plat√£o)": `
            <h3>1. Os 5 S√≥lidos Perfeitos ‚≠ê</h3>
            <p>Existem apenas 5 poliedros em que todas as faces s√£o iguais e todos os √¢ngulos s√£o iguais. S√£o os S√≥lidos de Plat√£o.</p>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-2 text-center text-xs font-bold text-gray-600 my-4">
                <div class="bg-gray-100 p-2 rounded">Tetraedro<br>(4 faces)</div>
                <div class="bg-gray-100 p-2 rounded">Cubo<br>(6 faces)</div>
                <div class="bg-gray-100 p-2 rounded">Octaedro<br>(8 faces)</div>
                <div class="bg-gray-100 p-2 rounded">Dodecaedro<br>(12 faces)</div>
                <div class="bg-gray-100 p-2 rounded">Icosaedro<br>(20 faces)</div>
            </div>
        `,

            "Prismas: Defini√ß√£o, Classifica√ß√£o e Sec√ß√£o": `
            <h3>1. O Pr√©dio Geom√©trico üè¢</h3>
            <p>O Prisma √© como um pr√©dio: tem um ch√£o (base) e um teto igualzinho (base oposta), conectados por paredes retangulares (faces laterais).</p>
            <p>O nome dele vem da base: Prisma Triangular (base tri√¢ngulo), Prisma Hexagonal (base hex√°gono), etc.</p>
        `,

            "√Årea Lateral e Total de Prismas": `
            <h3>1. Embrulhando o Presente üéÅ</h3>
            <p>Calcular a √°rea total √© descobrir quanto papel de presente precisamos para cobrir o s√≥lido.</p>
            <ul class="list-none space-y-2 text-sm bg-gray-50 p-4 rounded-xl border border-gray-200">
                <li><strong>√Årea Lateral ($A_L$):</strong> Soma das √°reas das paredes (ret√¢ngulos).</li>
                <li><strong>√Årea da Base ($A_B$):</strong> √Årea do ch√£o (pol√≠gono).</li>
                <li><strong>√Årea Total ($A_T$):</strong> $A_L + 2 \\cdot A_B$ (Paredes + Ch√£o + Teto).</li>
            </ul>
        `,

            "Volume de Prismas (Princ√≠pio de Cavalieri)": `
            <h3>1. Empilhando Fatias üç∞</h3>
            <p>O Princ√≠pio de Cavalieri diz que se dois s√≥lidos t√™m a mesma altura e a mesma √°rea de base em qualquer corte, eles t√™m o mesmo volume.</p>
            <p>Para qualquer prisma, o volume √© simples:</p>
            <div class="text-center font-black text-3xl text-brand-purple my-4">V = $A_B$ ¬∑ h</div>
            <p class="text-center text-sm">Volume = √Årea da Base √ó Altura</p>

            [WIDGET:interactive_prism_volume_builder]
        `,

            "Paralelep√≠pedo e Cubo (Diagonais)": `
            <h3>1. A Caixa de Sapato e o Dado üé≤</h3>
            <p>S√£o os prismas mais famosos. O Cubo √© um paralelep√≠pedo onde $a=b=c$.</p>
            <p><strong>Diagonal do Cubo:</strong> Imagine uma linha atravessando de um canto inferior at√© o canto superior oposto.</p>
            <div class="text-center font-mono font-bold bg-yellow-50 p-2 rounded text-brand-orange my-2">
                D = a $\\sqrt{3}$
            </div>
        `,

            // =======================================================
            // UNIDADE 2: GEOMETRIA ESPACIAL - PIR√ÇMIDES E CORPOS REDONDOS
            // =======================================================

            "Pir√¢mides: Elementos, Ap√≥tema e √Åreas": `
            <h3>1. Ponta para Cima ‚ñ≤</h3>
            <p>A Pir√¢mide tem uma base, mas todas as paredes laterais s√£o tri√¢ngulos que se encontram num ponto (V√©rtice).</p>
            <p><strong>Ap√≥tema da Pir√¢mide ($g$ ou $a_p$):</strong> √â a altura da face lateral (o tri√¢ngulo). Cuidado para n√£o confundir com a altura da pir√¢mide ($h$)!</p>
            
            [WIDGET:interactive_pythagoras_pyramid]
        `,

            "Volume de Pir√¢mides": `
            <h3>1. A Regra do Um Ter√ßo ‚Öì</h3>
            <p>Se voc√™ tem um prisma e uma pir√¢mide com a mesma base e mesma altura, a pir√¢mide ocupa exatamente um ter√ßo do espa√ßo.</p>
            <div class="text-center font-black text-3xl text-brand-red my-4">V = $\\frac{1}{3}$ ¬∑ $A_B$ ¬∑ h</div>
        `,

            "Cilindro: Elementos, Sec√ß√£o Meridiana, √Åreas e Volume": `
            <h3>1. O Prisma Redondo üõ¢Ô∏è</h3>
            <p>O Cilindro funciona igual ao Prisma, mas a base √© um c√≠rculo. Se voc√™ "desenrolar" um cilindro, ele vira um ret√¢ngulo (lateral) e dois c√≠rculos (tampas).</p>
            <p><strong>Volume:</strong> $V = \\pi r^2 \\cdot h$</p>
        `,

            "Cone: Elementos, √Åreas e Volume": `
            <h3>1. O Chap√©u de Festa üéâ</h3>
            <p>O Cone funciona igual √† Pir√¢mide. O volume tamb√©m √© um ter√ßo do cilindro.</p>
            <p>Uma rela√ß√£o importante no cone √© o "Pit√°goras interno":</p>
            <div class="text-center font-mono font-bold text-gray-700 bg-gray-100 p-2 rounded">
                $g^2 = h^2 + r^2$
            </div>
            <p class="text-xs text-center text-gray-500 mt-1">Geratriz¬≤ = Altura¬≤ + Raio¬≤</p>

            [WIDGET:interactive_cone_cylinder_relation]
        `,

            "Esfera: Elementos, √Årea da Superf√≠cie e Volume": `
            <h3>1. A Perfei√ß√£o Geom√©trica ‚öΩ</h3>
            <p>A Esfera √© o conjunto de pontos no espa√ßo √† mesma dist√¢ncia do centro.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-4 text-center">
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                    <strong class="text-brand-blue block">√Årea (Casca)</strong>
                    $A = 4 \\pi r^2$
                </div>
                <div class="bg-orange-50 p-4 rounded-xl border border-orange-200">
                    <strong class="text-brand-orange block">Volume (Recheio)</strong>
                    $V = \\frac{4}{3} \\pi r^3$
                </div>
            </div>
        `,

            // =======================================================
            // UNIDADE 3: GEOMETRIA ANAL√çTICA - PONTO E RETA
            // =======================================================

            "Coordenadas no Plano e Dist√¢ncia entre Pontos": `
            <h3>1. O GPS da Matem√°tica üìç</h3>
            <p>A Geometria Anal√≠tica mistura √Ålgebra com Desenho. Tudo vira coordenada $(x, y)$.</p>
            <p>Para calcular a dist√¢ncia entre dois pontos, usamos o <strong>Teorema de Pit√°goras</strong> disfar√ßado:</p>
            
            <div class="bg-gray-800 text-white p-3 rounded-xl text-center font-mono text-sm md:text-base my-4">
                $d_{AB} = \\sqrt{(x_B-x_A)^2 + (y_B-y_A)^2}$
            </div>

            [WIDGET:interactive_distance_points]
        `,

            "Ponto M√©dio e Baricentro do Tri√¢ngulo": `
            <h3>1. A M√©dia das Coordenadas üéØ</h3>
            <p>Quer achar o meio do caminho? √â s√≥ tirar a m√©dia!</p>
            <ul class="list-disc list-inside text-sm space-y-2 mb-4">
                <li><strong>Ponto M√©dio:</strong> M√©dia de 2 pontos. $M = (\\frac{x_A+x_B}{2}, \\frac{y_A+y_B}{2})$.</li>
                <li><strong>Baricentro (G):</strong> Centro de gravidade do tri√¢ngulo. M√©dia de 3 pontos.</li>
            </ul>
        `,

            "Equa√ß√£o Geral e Reduzida da Reta": `
            <h3>1. O RG da Reta üÜî</h3>
            <p>Toda reta tem uma "assinatura" alg√©brica. A forma mais famosa √© a Reduzida:</p>
            <div class="text-center font-black text-3xl text-brand-blue my-4">y = mx + n</div>
            <ul class="text-sm space-y-1 text-gray-600 bg-white p-3 rounded border border-gray-200">
                <li><strong>m (Coef. Angular):</strong> Inclina√ß√£o (Sobe ou desce?)</li>
                <li><strong>n (Coef. Linear):</strong> Onde corta o eixo Y.</li>
            </ul>

            [WIDGET:interactive_slope_visualizer]
        `,

            "Posi√ß√µes Relativas entre Retas (Paralelismo e Perpendicularismo)": `
            <h3>1. O Encontro das Retas ‚öîÔ∏è</h3>
            <p>Olhando apenas para o $m$ (inclina√ß√£o), sabemos como as retas interagem:</p>
            <div class="grid grid-cols-2 gap-4 my-4">
                <div class="bg-blue-50 p-2 rounded border border-blue-200 text-center">
                    <strong class="text-brand-blue">Paralelas (//)</strong>
                    <p class="text-xs">Mesma inclina√ß√£o.<br>$m_1 = m_2$</p>
                </div>
                <div class="bg-red-50 p-2 rounded border border-red-200 text-center">
                    <strong class="text-brand-red">Perpendiculares (‚ä•)</strong>
                    <p class="text-xs">Inverso e oposto.<br>$m_1 \\cdot m_2 = -1$</p>
                </div>
            </div>
        `,

            // =======================================================
            // UNIDADE 4: GEOMETRIA ANAL√çTICA - CIRCUNFER√äNCIA E C√îNICAS
            // =======================================================

            "Equa√ß√£o Reduzida e Geral da Circunfer√™ncia": `
            <h3>1. Pit√°goras Girando üé°</h3>
            <p>A equa√ß√£o da circunfer√™ncia √©, literalmente, o Teorema de Pit√°goras aplicado a um ponto que gira em torno de um centro $(x_c, y_c)$.</p>
            
            <div class="bg-gray-800 text-white p-4 rounded-xl text-center shadow-lg my-6">
                $(x - x_c)^2 + (y - y_c)^2 = R^2$
            </div>
            
            <p>Se voc√™ sabe o Centro e o Raio, voc√™ sabe a equa√ß√£o!</p>

            [WIDGET:interactive_circle_equation_builder]
        `,

            "Posi√ß√µes Relativas (Ponto-Circunfer√™ncia, Reta-Circunfer√™ncia)": `
            <h3>1. Dentro, Fora ou na Borda? üéæ</h3>
            <p>Calculamos a dist√¢ncia ($d$) do ponto (ou reta) at√© o centro e comparamos com o Raio ($R$).</p>
            <ul class="text-sm space-y-1 mb-4">
                <li>$d > R$: Exterior (Longe)</li>
                <li>$d = R$: Pertence (Na borda / Tangente)</li>
                <li>$d < R$: Interior (Dentro / Secante)</li>
            </ul>
        `,

            "Elipse, Hip√©rbole e Par√°bola (C√¥nicas)": `
            <h3>1. Fatiando o Cone üç¶</h3>
            <p>As c√¥nicas surgem quando cortamos um cone duplo com uma l√¢mina. A inclina√ß√£o do corte define a curva.</p>
            
            [WIDGET:interactive_conic_sections]
        `,

            // =======================================================
            // UNIDADE 5: N√öMEROS COMPLEXOS
            // =======================================================

            "A Unidade Imagin√°ria (i) e Conjunto C": `
            <h3>1. A Solu√ß√£o do Imposs√≠vel üëª</h3>
            <p>Por muito tempo, $\\sqrt{-1}$ foi considerado imposs√≠vel. At√© que os matem√°ticos definiram $i = \\sqrt{-1}$.</p>
            <p>Agora temos um novo eixo num√©rico! Um n√∫mero complexo tem uma parte Real e uma Imagin√°ria: <strong>$z = a + bi$</strong>.</p>
        `,

            "Plano de Argand-Gauss e Interpreta√ß√£o Geom√©trica": `
            <h3>1. O Plano 2D dos N√∫meros üó∫Ô∏è</h3>
            <p>N√∫meros reais moram numa reta. N√∫meros complexos moram num plano!</p>
            <ul class="list-disc list-inside text-sm mb-4">
                <li>Eixo X: Parte Real (a)</li>
                <li>Eixo Y: Parte Imagin√°ria (b)</li>
            </ul>
            <p>Cada n√∫mero complexo √© um vetor (uma seta) que sai da origem.</p>

            [WIDGET:interactive_complex_plane_vector]
        `,

            "M√≥dulo e Argumento": `
            <h3>1. Tamanho e Dire√ß√£o üß≠</h3>
            <p>Olhando para o vetor:</p>
            <ul class="text-sm space-y-2 mb-4">
                <li><strong>M√≥dulo ($|z|$):</strong> √â o tamanho da seta (Pit√°goras). $\\rho = \\sqrt{a^2+b^2}$.</li>
                <li><strong>Argumento ($\\theta$):</strong> √â o √¢ngulo que a seta faz com o eixo X.</li>
            </ul>
        `,

            "Forma Trigonom√©trica (Polar)": `
            <h3>1. Coordenadas Polares üì°</h3>
            <p>Em vez de dizer "ande x e ande y" ($a+bi$), dizemos "gire $\\theta$ graus e ande $\\rho$ metros".</p>
            <div class="text-center font-bold text-brand-purple my-4">z = $\\rho \\cdot (\\cos \\theta + i \\cdot \\sen \\theta)$</div>
            <p class="text-xs text-center">Apelido carinhoso: $z = \\rho \\cdot \\text{cis}(\\theta)$</p>
        `,

            "Opera√ß√µes na Forma Trigonom√©trica (Produto e Divis√£o)": `
            <h3>1. Gira-Gira Matem√°tico üé°</h3>
            <p>Multiplicar complexos na forma polar √© m√°gico:</p>
            <div class="bg-green-50 p-3 rounded-lg border-l-4 border-brand-green text-sm mb-4">
                <strong>Multiplica√ß√£o:</strong> Multiplica os tamanhos (m√≥dulos) e <strong>SOMA</strong> os √¢ngulos.<br>
                Isso significa que multiplicar por um complexo <strong>GIRA</strong> o vetor!
            </div>
            
            [WIDGET:interactive_complex_rotation]
        `,

            // =======================================================
            // UNIDADE 6: POLIN√îMIOS E EQUA√á√ïES ALG√âBRICAS
            // =======================================================

            "Polin√¥mios em C: Grau, Valor Num√©rico e Raiz": `
            <h3>1. Os Monstros Alg√©bricos üêâ</h3>
            <p>Polin√¥mios s√£o somas de pot√™ncias de x, tipo $P(x) = 2x^3 - 4x + 1$.</p>
            <p><strong>Raiz:</strong> √â o valor de $x$ que zera o polin√¥mio. Geometricamente, √© onde o gr√°fico cruza o eixo X.</p>
        `,

            "Divis√£o de Polin√¥mios: M√©todo da Chave e Briot-Ruffini": `
            <h3>1. Dividindo Gigantes ‚ûó</h3>
            <p>O dispositivo de <strong>Briot-Ruffini</strong> √© um atalho genial para dividir polin√¥mios por $(x-a)$. √â como fazer uma divis√£o montada, mas usando apenas os n√∫meros (coeficientes).</p>
            
            [WIDGET:interactive_briot_ruffini]
        `,

            "Equa√ß√µes Polinomiais: Teorema Fundamental da √Ålgebra": `
            <h3>1. A Promessa de Gauss üìú</h3>
            <p>O Teorema Fundamental da √Ålgebra garante: "Todo polin√¥mio de grau $n$ tem exatamente $n$ ra√≠zes" (se contarmos as complexas e repetidas).</p>
            <p>Se √© grau 3, tem 3 ra√≠zes. Se √© grau 5, tem 5 ra√≠zes.</p>
            
            <div class="bg-yellow-50 p-3 rounded-lg border-l-4 border-brand-yellow text-sm">
                <strong>Dica:</strong> Se um n√∫mero complexo $a+bi$ √© raiz, seu conjugado $a-bi$ tamb√©m √©! Elas andam em pares.
            </div>
        `,

            // =======================================================
            // UNIDADE 7: ESTAT√çSTICA INFERENCIAL E REVIS√ÉO
            // =======================================================

            "Medidas de Dispers√£o: Vari√¢ncia e Desvio Padr√£o (Aprofundamento)": `
            <h3>1. A Curva Normal (O Sino) üîî</h3>
            <p>Na natureza (altura das pessoas, notas, erros), os dados tendem a se agrupar no meio. O gr√°fico forma um sino.</p>
            <p>O <strong>Desvio Padr√£o ($\\sigma$)</strong> dita a largura do sino. $\\sigma$ pequeno = sino fino e alto. $\\sigma$ grande = sino achatado e largo.</p>

            [WIDGET:interactive_normal_distribution]
        `,

        };
        // 3. BANCO DE QUEST√ïES (QUIZ)
        const CONTEUDO_QUESTOES = {
            "6¬∫ Ano": [
                { q: "Quanto √© $2^3$?", opts: ["6", "8", "5", "9"], a: 1 },
                { q: "Qual √© o MMC de 4 e 6?", opts: ["24", "12", "10", "2"], a: 1 },
                {
                    q: "Como se chama o resultado da divis√£o?",
                    opts: ["Produto", "Soma", "Quociente", "Resto"],
                    a: 2,
                },
                {
                    q: "O que significa o denominador da fra√ß√£o?",
                    opts: [
                        "Quantas partes peguei",
                        "O total de divis√µes",
                        "O resultado",
                        "O resto",
                    ],
                    a: 1,
                },
                { q: "Qual n√∫mero √© primo?", opts: ["9", "15", "13", "21"], a: 2 },
            ],
            "7¬∫ Ano": [
                { q: "Quanto √© -5 + 2?", opts: ["-3", "-7", "3", "7"], a: 0 },
                {
                    q: "Qual o valor de x em 2x = 10?",
                    opts: ["5", "20", "8", "12"],
                    a: 0,
                },
                {
                    q: "O ponto (2, -3) est√° em qual quadrante?",
                    opts: ["1¬∫", "2¬∫", "3¬∫", "4¬∫"],
                    a: 3,
                },
            ],
            "8¬∫ Ano": [
                {
                    q: "Qual √© o desenvolvimento de $(a+b)^2$?",
                    opts: ["$a^2+b^2$", "$a^2+ab+b^2$", "$a^2+2ab+b^2$", "$2a+2b$"],
                    a: 2,
                },
                {
                    q: "A soma dos √¢ngulos internos de um tri√¢ngulo √©:",
                    opts: ["180¬∞", "360¬∞", "90¬∞", "270¬∞"],
                    a: 0,
                },
            ],
            "9¬∫ Ano": [
                {
                    q: "Qual √© o valor de Delta em $x^2 - 5x + 6 = 0$?",
                    opts: ["1", "25", "49", "-1"],
                    a: 0,
                },
                {
                    q: "Em um tri√¢ngulo ret√¢ngulo, $a^2 = b^2 + ...$",
                    opts: ["$c^2$", "$2bc$", "$c$", "$bc$"],
                    a: 0,
                },
            ],
        };

        // --- APP ENGINE ---
        const app = {
            history: [],
            // currentView: 'home',
            currentView: "loading",
            currentData: null,

            // Estado do Usu√°rio
            user: null,
            isGuest: false, // Flag para saber se √© convidado

            // Estado do Usu√°rio (Sincronizado com a Nuvem)
            user: {
                uid: null,
                name: null,
                photo: null,
                xp: 0,
                completedLessons: [],
            },

            // 1. M√ìDULO DE AUTENTICA√á√ÉO (CORRE√á√ÉO: Adicionado de volta)
            auth: {
                dbName: "mathlingo_users_db",
                currentUser: null,

                getDB() {
                    const db = localStorage.getItem(this.dbName);
                    return db ? JSON.parse(db) : { users: [] };
                },

                saveDB(data) {
                    localStorage.setItem(this.dbName, JSON.stringify(data));
                },

                login(username, password) {
                    const db = this.getDB();
                    const user = db.users.find(
                        (u) => u.username === username && u.password === password
                    );
                    if (user) {
                        this.currentUser = user;
                        localStorage.setItem("mathlingo_session", JSON.stringify(user));
                        return { success: true };
                    }
                    return { success: false, msg: "Usu√°rio ou senha incorretos." };
                },

                register(username, password) {
                    if (!username || !password)
                        return { success: false, msg: "Preencha tudo!" };
                    const db = this.getDB();
                    if (db.users.find((u) => u.username === username))
                        return { success: false, msg: "Usu√°rio j√° existe!" };

                    const newUser = { username, password, xp: 0, completedLessons: [] };
                    db.users.push(newUser);
                    this.saveDB(db);
                    return { success: true };
                },

                logout() {
                    this.currentUser = null;
                    localStorage.removeItem("mathlingo_session");
                    app.render("login");
                },

                checkSession() {
                    const session = localStorage.getItem("mathlingo_session");
                    if (session) {
                        this.currentUser = JSON.parse(session);
                        return true;
                    }
                    return false;
                },

                updateProgress(xp, lesson) {
                    if (!this.currentUser) return;
                    const db = this.getDB();
                    const idx = db.users.findIndex(
                        (u) => u.username === this.currentUser.username
                    );
                    if (idx !== -1) {
                        db.users[idx].xp += xp;
                        if (lesson && !db.users[idx].completedLessons.includes(lesson)) {
                            db.users[idx].completedLessons.push(lesson);
                        }
                        this.saveDB(db);
                        this.currentUser = db.users[idx];
                        localStorage.setItem(
                            "mathlingo_session",
                            JSON.stringify(this.currentUser)
                        );
                    }
                },
            },

            // 2. INICIALIZA√á√ÉO
            //init() {
            //if (this.auth.checkSession()) {
            //this.render('home');
            //} else {
            //this.render('login');
            //}
            //},
            init() {
                this.render("loading");

                if (typeof auth !== "undefined") {
                    auth.onAuthStateChanged(async (firebaseUser) => {
                        if (firebaseUser) {
                            console.log("Firebase User Detectado");
                            this.isGuest = false;
                            await this.loadFirebaseData(firebaseUser);
                            this.render("home");
                        } else {
                            this.checkGuestSession();
                        }
                    });
                } else {
                    this.checkGuestSession();
                }
            },

            checkGuestSession() {
                const guestData = localStorage.getItem("mathlingo_guest_data");
                if (guestData) {
                    this.user = JSON.parse(guestData);
                    this.isGuest = true;
                    this.render("home");
                } else {
                    this.user = null;
                    this.isGuest = false;
                    this.render("login");
                }
            },

            loginGuest() {
                const newGuest = {
                    uid: "guest_" + Date.now(),
                    name: "Visitante",
                    photo: null,
                    xp: 0,
                    completedLessons: [],
                };
                this.user = newGuest;
                this.isGuest = true;
                this.saveLocalData();
                this.render("home");
            },

            loginGoogle() {
                if (typeof auth === "undefined")
                    return alert("Erro: Firebase n√£o configurado.");
                auth.signInWithPopup(provider).catch((err) => alert(err.message));
            },

            async loginEmail(email, pass) {
                if (typeof auth === "undefined") return;
                try {
                    await auth.signInWithEmailAndPassword(email, pass);
                } catch (e) {
                    alert("Erro: " + e.message);
                    return { error: true };
                }
            },

            async registerEmail(email, pass, name) {
                if (typeof auth === "undefined") return;
                try {
                    const res = await auth.createUserWithEmailAndPassword(email, pass);
                    await res.user.updateProfile({ displayName: name });
                    return { success: true };
                } catch (e) {
                    alert("Erro: " + e.message);
                    return { error: true };
                }
            },

            logout() {
                if (this.isGuest) {
                    this.user = null;
                    this.isGuest = false;
                    this.render("login");
                } else {
                    auth.signOut();
                }
            },

            async loadFirebaseData(firebaseUser) {
                try {
                    const userRef = db.collection("users").doc(firebaseUser.uid);
                    const doc = await userRef.get();

                    if (doc.exists) {
                        const data = doc.data();
                        this.user = {
                            uid: firebaseUser.uid,
                            name: firebaseUser.displayName,
                            photo: firebaseUser.photoURL,
                            xp: data.xp || 0,
                            completedLessons: data.completedLessons || [],
                        };
                    } else {
                        this.user = {
                            uid: firebaseUser.uid,
                            name: firebaseUser.displayName,
                            photo: firebaseUser.photoURL,
                            xp: 0,
                            completedLessons: [],
                        };
                        await userRef.set({ xp: 0, completedLessons: [] });
                    }
                } catch (err) {
                    console.error(err);
                }
            },

            saveLocalData() {
                localStorage.setItem(
                    "mathlingo_guest_data",
                    JSON.stringify(this.user)
                );
            },

            async saveProgress(xpAmount, lessonName) {
                if (!this.user) return;

                this.user.xp += xpAmount;
                if (lessonName && !this.user.completedLessons.includes(lessonName)) {
                    this.user.completedLessons.push(lessonName);
                }

                if (this.isGuest) {
                    this.saveLocalData();
                } else {
                    try {
                        await db.collection("users").doc(this.user.uid).update({
                            xp: this.user.xp,
                            completedLessons: this.user.completedLessons,
                        });
                    } catch (err) {
                        console.error(err);
                    }
                }
                this.updateHeader();
            },

            navigate(view, data = null) {
                if (this.currentView && this.currentView !== "loading") {
                    this.history.push({
                        view: this.currentView,
                        data: this.currentData,
                    });
                }
                this.currentView = view;
                this.currentData = data;
                this.render(view, data);
            },

            goBack() {
                if (this.history.length === 0) return;
                const prev = this.history.pop();
                this.currentView = prev.view;
                this.currentData = prev.data;
                this.render(prev.view, prev.data);
            },

            render(view, data) {
                const container = document.getElementById("main-container");
                const btnBack = document.getElementById("btn-back");
                const header = document.querySelector("header");

                window.scrollTo(0, 0);

                if (view === "login" || view === "loading") {
                    header.classList.add("hidden");
                    btnBack.classList.add("hidden");
                } else {
                    header.classList.remove("hidden");
                    this.updateHeader();
                    btnBack.classList.toggle("hidden", view === "home");
                }

                if (view === "loading") {
                    container.innerHTML = `<div class="flex h-[80vh] items-center justify-center text-brand-green animate-pulse"><i class="fas fa-circle-notch fa-spin text-4xl"></i></div>`;
                    return;
                }

                if (view === "login") this.renderLogin(container);
                else if (view === "home") this.renderHome(container);
                else if (view === "levels") this.renderLevels(container);
                else if (view === "settings") this.renderSettings(container);
                else if (view === "units") this.renderUnits(container, data);
                else if (view === "path") this.renderPath(container, data);
                else if (view === "lesson") this.renderLesson(container, data);
            },

            updateHeader() {
                const xpEl = document.querySelector(".fa-gem")?.nextElementSibling;
                const fireEl = document.querySelector(".fa-fire")?.nextElementSibling;
                if (this.user && xpEl) xpEl.innerText = this.user.xp;
                if (this.user && fireEl)
                    fireEl.innerText = this.user.completedLessons.length;
            },

            renderLogin(container) {
                container.innerHTML = `
<div class="flex flex-col items-center justify-center min-h-[90vh] animate-fade-in px-4 py-8">
<div class="mb-8 text-center">
<div class="w-20 h-20 bg-brand-green rounded-2xl mx-auto flex items-center justify-center text-4xl text-white shadow-lg mb-4 relative overflow-hidden">
<i class="fas fa-shapes"></i>
</div>
<h1 class="text-3xl font-black text-brand-green mb-1">MathLingo</h1>
<p class="text-gray-400 font-bold text-sm">Sua jornada matem√°tica.</p>
</div>

<div class="bg-white p-6 md:p-8 rounded-[2rem] shadow-card border-2 border-gray-100 w-full max-w-md">

<button onclick="app.loginGoogle()" class="w-full bg-white border-2 border-gray-200 hover:bg-gray-50 text-gray-700 font-bold py-3 rounded-xl shadow-sm transition-all flex items-center justify-center gap-3 group active:scale-95 mb-4">
<img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5 group-hover:scale-110 transition-transform">
<span>Entrar com Google</span>
</button>

<button onclick="app.loginGuest()" class="w-full bg-gray-100 border-2 border-transparent hover:border-gray-300 text-gray-500 font-bold py-3 rounded-xl shadow-sm transition-all flex items-center justify-center gap-3 group active:scale-95 mb-6">
<i class="fas fa-user-astronaut"></i>
<span>Continuar como Convidado</span>
</button>

<div class="relative flex py-2 items-center mb-6">
<div class="flex-grow border-t border-gray-200"></div>
<span class="flex-shrink mx-4 text-gray-300 text-xs font-bold uppercase">Ou via Email</span>
<div class="flex-grow border-t border-gray-200"></div>
</div>

<div class="flex flex-col gap-3">
<div id="field-name" class="hidden">
<input type="text" id="inp-name" class="w-full bg-gray-50 border-2 border-gray-200 rounded-xl p-3 font-bold text-gray-700 outline-none focus:border-brand-green transition-colors" placeholder="Seu Nome">
</div>
<input type="email" id="inp-email" class="w-full bg-gray-50 border-2 border-gray-200 rounded-xl p-3 font-bold text-gray-700 outline-none focus:border-brand-blue transition-colors" placeholder="Email">
<input type="password" id="inp-pass" class="w-full bg-gray-50 border-2 border-gray-200 rounded-xl p-3 font-bold text-gray-700 outline-none focus:border-brand-blue transition-colors" placeholder="Senha">
<button id="btn-submit" class="w-full bg-brand-blue hover:bg-brand-blueDark text-white font-extrabold text-lg py-3 rounded-xl shadow-btn btn-game uppercase tracking-widest transition-all mt-2">
ENTRAR
</button>
</div>

<div class="text-center mt-6">
<p class="text-sm font-bold text-gray-400" id="toggle-text">N√£o tem conta?</p>
<button id="btn-toggle" class="text-brand-blue font-black uppercase text-xs hover:underline mt-1">CRIAR CONTA</button>
</div>
</div>
</div>
`;

                const btnSubmit = container.querySelector("#btn-submit");
                const btnToggle = container.querySelector("#btn-toggle");
                const fieldName = container.querySelector("#field-name");
                const toggleText = container.querySelector("#toggle-text");
                let isLogin = true;

                btnToggle.onclick = () => {
                    isLogin = !isLogin;
                    if (isLogin) {
                        fieldName.classList.add("hidden");
                        btnSubmit.innerText = "ENTRAR";
                        btnSubmit.className = btnSubmit.className
                            .replace("bg-brand-green", "bg-brand-blue")
                            .replace("bg-brand-greenDark", "bg-brand-blueDark");
                        toggleText.innerText = "N√£o tem conta?";
                        btnToggle.innerText = "CRIAR CONTA";
                    } else {
                        fieldName.classList.remove("hidden");
                        btnSubmit.innerText = "CADASTRAR";
                        btnSubmit.className = btnSubmit.className
                            .replace("bg-brand-blue", "bg-brand-green")
                            .replace("bg-brand-blueDark", "bg-brand-greenDark");
                        toggleText.innerText = "J√° tem conta?";
                        btnToggle.innerText = "FAZER LOGIN";
                    }
                };

                btnSubmit.onclick = async () => {
                    const email = container.querySelector("#inp-email").value;
                    const pass = container.querySelector("#inp-pass").value;
                    const name = container.querySelector("#inp-name").value;
                    if (!email || !pass) return alert("Preencha email e senha!");

                    // Feedback Loading
                    btnSubmit.innerText = "...";

                    if (isLogin) {
                        // CORRE√á√ÉO: Chamando app.loginEmail diretamente
                        const res = await app.loginEmail(email, pass);
                        if (res && res.error) btnSubmit.innerText = "ENTRAR";
                    } else {
                        if (!name) {
                            alert("Preencha seu nome!");
                            btnSubmit.innerText = "CADASTRAR";
                            return;
                        }
                        // CORRE√á√ÉO: Chamando app.registerEmail diretamente
                        const res = await app.registerEmail(email, pass, name);
                        if (res && res.success) {
                            alert("Conta criada!");
                            toggleText.innerText = "Fa√ßa login agora.";
                            isLogin = true;
                        }
                        btnSubmit.innerText = isLogin ? "ENTRAR" : "CADASTRAR";
                    }
                };
            },

            // configura√ß√µes





renderSettings(container) {
const user = this.user || this.auth.currentUser;

const u = this.user;
                const avatar = u.photo
                    ? `<img src="${u.photo}" class="w-full h-full object-cover">`
                    : this.isGuest
                        ? `<i class="fas fa-user-astronaut text-5xl text-white"></i>`
                        : `<span class="text-6xl font-black text-white">${u.name[0]}</span>`;

        if (!user) return this.renderLogin(target);
        container.innerHTML = `
            <div class="min-h-screen bg-gray-100 flex items-center justify-center p-4 font-sans">
                <div class="bg-white w-full max-w-md rounded-2xl shadow-xl overflow-hidden animate-fade-in">
                    
                    <div class="bg-brand-blue p-6 text-center relative">
                        <button onclick="app.navigate('home')" class="absolute left-4 top-4 text-white hover:text-blue-200 transition-transform hover:scale-110">
                            <i class="fas fa-arrow-left text-xl"></i>
                        </button>
                        
                        <h2 class="text-2xl font-black text-white uppercase tracking-wider">Meu Perfil</h2>

                            
                         <div class="w-20 h-20 rounded-full bg-brand-green border-4 border-white shadow-xl mb-6 flex items-center justify-center relative overflow-hidden">
${avatar}


                        </div>
                        <p class="text-white font-bold mt-2">${user.displayName || "Estudante"}</p>
                    </div>

                    <div class="p-8 space-y-6">
                        <div id="settings-loader" class="text-center text-gray-400 text-xs font-bold py-2">
                            <i class="fas fa-circle-notch fa-spin"></i> Carregando dados...
                        </div>

<div>
                    <label class="block text-gray-400 text-sm font-bold mb-2">Nome Completo *</label>
                    <input type="text" id="set-name" 
                        class="w-full bg-gray-800 text-white border border-gray-700 rounded-lg px-4 py-3 focus:outline-none focus:border-indigo-500 transition-colors"
                        value="${u.fullName || ''}" 
                        placeholder="Ex: Jo√£o da Silva">
                </div>

                <div>
                    <label class="block text-gray-400 text-sm font-bold mb-2">Matr√≠cula</label>
                    <input type="text" id="set-mat" 
                        class="w-full bg-gray-800 text-white border border-gray-700 rounded-lg px-4 py-3 focus:outline-none focus:border-indigo-500 transition-colors"
                        value="${u.matricula || ''}" 
                        placeholder="Ex: 2025001">
                </div>

                        <div id="settings-content" class="space-y-6 opacity-50 pointer-events-none transition-opacity duration-300">
                            <div>
                                <label class="block text-gray-400 text-sm font-bold mb-2">Ano Letivo</label>
                                <select id="set-year" class="w-full bg-gray-800 text-white border border-gray-700 rounded-lg px-4 py-3 focus:outline-none focus:border-indigo-500 transition-colors">
                                    <option value="2030">2030</option>
                                    <option value="2029">2029</option>
                                    <option value="2028">2028</option>
                                    <option value="2027">2027</option>
                                    <option value="2026">2026</option>
                                    <option value="2025">2025</option>
                                </select>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-400 text-sm font-bold mb-2">S√©rie</label>
                                    <select id="set-grade" class="w-full bg-gray-800 text-white border border-gray-700 rounded-lg px-4 py-3 focus:outline-none focus:border-indigo-500 transition-colors">
                                        <option value="6">6¬∫ Ano</option>
                                        <option value="7">7¬∫ Ano</option>
                                        <option value="8">8¬∫ Ano</option>
                                        <option value="9">9¬∫ Ano</option>
                                        <option value="1EM">1¬∫ EM</option>
                                        <option value="2EM">2¬∫ EM</option>
                                        <option value="3EM">3¬∫ EM</option>
                                        <option value="TREINEIRO">Treineiro</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-400 text-sm font-bold mb-2">Turma</label>
                                    <select id="set-class" class="w-full bg-gray-800 text-white border border-gray-700 rounded-lg px-4 py-3 focus:outline-none focus:border-indigo-500 transition-colors">
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                        <option value="E">E</option>
                                        <option value="F">F</option>
                                        <option value="G">G</option>
                                        <option value="H">H</option>
                                        <option value="I">I</option>
                                        <option value="J">J</option>
                                        <option value="K">K</option>
                                        <option value="L">L</option>
                                        <option value="M">M</option>
                                        <option value="N">N</option>
                                        <option value="O">O</option>
                                        <option value="P">P</option>
                                        <option value="Q">Q</option>
                                        <option value="R">R</option>
                                        <option value="S">S</option>
                                        <option value="T">T</option>
                                        <option value="U">U</option>
                                        <option value="V">V</option>
                                        <option value="W">W</option>
                                        <option value="X">X</option>
                                        <option value="Y">Y</option>
                                        <option value="Z">Z</option>
                                        <option value="TREINEIRO">Treineiro</option>
                                    </select>
                                </div>
                            </div>

                            <button id="btn-save-profile" class="w-full bg-brand-green text-white font-bold py-4 rounded-xl shadow-btn active:scale-95 transition-all">
                                SALVAR DADOS
                            </button>

                            <hr>

                            <button id="btn-reset-progress" class="w-full bg-white border-2 border-red-200 text-red-500 font-bold py-3 rounded-xl hover:bg-red-50">
                                RESETAR PROGRESSO
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Busca dados (Firebase)
        const docRef = window.firebase.firestore().collection("users").doc(user.uid);
        
        docRef.get().then((doc) => {
            if (doc.exists) {
                const data = doc.data();
                if(document.getElementById('set-year')) {
                    document.getElementById('set-name').value = data.name || "";
                    document.getElementById('set-mat').value = data.matricula || "";
                    document.getElementById('set-year').value = data.schoolYear || "2026";
                    document.getElementById('set-grade').value = data.grade || "6";
                    document.getElementById('set-class').value = data.schoolClass || "A";
                }
            }
            if(document.getElementById('settings-loader')) {
                document.getElementById('settings-loader').style.display = 'none';
                document.getElementById('settings-content').classList.remove('opacity-50', 'pointer-events-none');
            }
        });

        // Configura bot√µes internos (Aqui o JavaScript funciona normal)
        document.getElementById('btn-save-profile').onclick = function() {
            const btn = this;
            btn.innerText = "Salvando...";
            const data = {
                name: document.getElementById('set-name').value,
                matricula: document.getElementById('set-mat').value,
                schoolYear: document.getElementById('set-year').value,
                grade: document.getElementById('set-grade').value,
                schoolClass: document.getElementById('set-class').value
            };
            docRef.update(data).then(() => {
                btn.innerText = 'Salvo!';
                setTimeout(() => app.renderHome(container), 1000);
            });
        };

        document.getElementById('btn-reset-progress').onclick = () => {
            if(confirm("Tem certeza? Vai zerar tudo.")) {
                docRef.update({ xp: 0, completedLessons: [] }).then(() => {
                    alert("Resetado.");
                    app.renderHome(container);
                });
            }
        };
    },





            // fim das configura√ß√µes

            renderHome(container) {
                const u = this.user;
                const avatar = u.photo
                    ? `<img src="${u.photo}" class="w-full h-full object-cover">`
                    : this.isGuest
                        ? `<i class="fas fa-user-astronaut text-5xl text-white"></i>`
                        : `<span class="text-6xl font-black text-white">${u.name[0]}</span>`;
                const guestBadge = this.isGuest
                    ? `<span class="bg-gray-200 text-gray-500 text-xs px-2 py-1 rounded ml-2 font-bold uppercase">Offline</span>`
                    : "";

                container.innerHTML = `
<div class="flex flex-col items-center justify-center pt-10 animate-fade-in w-full">
<div class="flex flex-col items-center mb-12">
    
    
    








<div class="w-36 h-36 rounded-full bg-brand-green border-4 border-white shadow-xl mb-6 flex items-center justify-center relative overflow-hidden">
${avatar}
</div>
<h2 class="text-3xl font-extrabold text-gray-700 text-center">Ol√°, ${u.name.split(" ")[0]
                    }!</h2>
<div class="flex items-center mt-2">
<p class="text-gray-400 font-bold text-lg">N√≠vel Iniciante ‚Ä¢ ${u.xp} XP</p>
${guestBadge}
</div>
</div>

<div class="w-full max-w-md space-y-6">
<div onclick="app.navigate('levels')" class="group cursor-pointer bg-white border-2 border-gray-200 rounded-3xl p-6 flex items-center gap-6 hover:border-brand-purple hover:bg-purple-50 transition-all shadow-card active:translate-y-1 active:shadow-none">
<div class="w-20 h-20 rounded-2xl bg-brand-purple flex items-center justify-center shadow-inner group-hover:scale-110 transition-transform text-white text-4xl shrink-0">
<i class="fas fa-book-open"></i>
</div>
<div>
<h3 class="text-2xl font-extrabold text-gray-700 group-hover:text-brand-purple transition-colors">Trilha de Teoria</h3>
<p class="text-gray-400 font-bold text-sm">Aulas passo a passo</p>
</div>
</div>
<div onclick="alert('Em breve!')" class="group cursor-pointer bg-white border-2 border-gray-200 rounded-3xl p-6 flex items-center gap-6 opacity-60">
<div class="w-20 h-20 rounded-2xl bg-brand-blue flex items-center justify-center shadow-inner text-white text-4xl shrink-0">
<i class="fas fa-dumbbell"></i>
</div>
<div>
<h3 class="text-2xl font-extrabold text-gray-700">Arena de Pr√°tica</h3>
<p class="text-gray-400 font-bold text-sm">Desafios e Quiz</p>
</div>
</div>
</div>

<div onclick="app.navigate('settings')" class="group cursor-pointer border-2 border-gray-100 rounded-3xl p-6 flex gap-6 hover:border-brand-purple hover:bg-purple-30 transition-all shadow-card active:translate-y-1 ">
<div>
<h3 class="text-2xl font-extrabold group-hover:text-brand-purple transition-colors">Configurar Turma</h3>
</div>
</div>

<button onclick="app.logout()" class="mt-12 text-gray-400 font-bold text-xs uppercase hover:text-brand-red transition-colors border border-gray-200 px-4 py-2 rounded-lg">
${this.isGuest ? "Apagar Dados e Sair" : "Sair da Conta"}
</button>
</div>
`;
            },

            renderLevels(container) {
                const allLevels = Object.keys(CURRICULO);
                const fundamental = allLevels.filter((l) => !l.includes("EM"));
                const medio = allLevels.filter((l) => l.includes("EM"));

                const createBtn = (lvl) => {
                    const theme = LEVEL_THEMES[lvl] || LEVEL_THEMES["6¬∫ Ano"];
                    const shortLabel = lvl.split(" ")[0];
                    const displayLabel = lvl.includes("Ensino")
                        ? lvl.replace("Ano do Ensino M√©dio", "ano EM")
                        : lvl;
                    return `
<button onclick="app.navigate('units', '${lvl}')" 
class="relative w-full md:w-40 h-28 rounded-3xl border-b-4 ${theme.borderDark
                        } ${theme.main
                        } hover:brightness-110 transition-all active:scale-95 active:border-b-0 flex flex-col items-center justify-center gap-1 shadow-lg text-white group">
<div class="w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center text-xl font-extrabold shadow-inner group-hover:scale-110 transition-transform">
${shortLabel.replace("¬∫", "")}
</div>
<span class="font-extrabold text-md tracking-wide uppercase">${displayLabel}</span>
</button>
`;
                };

                container.innerHTML = `
<div class="flex flex-col items-center pt-4 w-full animate-fade-in pb-20 max-w-4xl mx-auto">
<div class="w-full flex items-center gap-4 mb-6 mt-4">
<div class="h-1 flex-1 bg-gray-200 rounded-full"></div>
<h3 class="text-gray-400 font-black text-sm uppercase tracking-widest">Ensino Fundamental</h3>
<div class="h-1 flex-1 bg-gray-200 rounded-full"></div>
</div>
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 w-full mb-12 px-2">
${fundamental.map((lvl) => createBtn(lvl)).join("")}
</div>
<div class="w-full flex items-center gap-4 mb-6">
<div class="h-1 flex-1 bg-gray-200 rounded-full"></div>
<h3 class="text-gray-400 font-black text-sm uppercase tracking-widest">Ensino M√©dio</h3>
<div class="h-1 flex-1 bg-gray-200 rounded-full"></div>
</div>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 w-full px-2 md:px-20">
${medio.map((lvl) => createBtn(lvl)).join("")}
</div>
</div>
`;
            },

            renderUnits(container, levelName) {
                const theme = LEVEL_THEMES[levelName] || LEVEL_THEMES["6¬∫ Ano"];
                const units = CURRICULO[levelName] || {};

                // Garante que tem usu√°rio (seja convidado ou google)
                const userLessons = this.user ? this.user.completedLessons : [];

                let html = `
<div class="flex flex-col items-center pt-8 w-full animate-fade-in pb-20">
<h3 class="text-gray-700 font-extrabold text-2xl mb-6">Escolha o Conte√∫do</h3>

<div class="bg-white border-2 ${theme.border} rounded-2xl px-8 py-3 mb-10 shadow-sm flex items-center gap-4 transform hover:scale-105 transition-transform cursor-default">
<span class="font-extrabold text-lg ${theme.text}">${levelName}</span>
</div>

<div class="w-full border-2 ${theme.border} rounded-[2.5rem] p-6 md:p-8 bg-white shadow-sm space-y-8">
`;

                let idx = 1;
                // Loop pelas unidades (Ex: Unidade 1, Unidade 2...)
                for (const [unitName, lessons] of Object.entries(units)) {
                    // Calcula progresso real
                    const total = lessons.length;
                    const done = lessons.filter((l) => userLessons.includes(l)).length;
                    const pct = total > 0 ? Math.round((done / total) * 100) : 0;

                    html += `
<div onclick="app.navigate('path', {level: '${levelName}', unit: '${unitName}'})" 
 class="group cursor-pointer flex items-center gap-6 hover:bg-gray-50 p-2 rounded-2xl transition-colors">

<div class="w-20 h-20 rounded-full flex items-center justify-center text-2xl font-extrabold text-white shrink-0 shadow-md transition-transform group-hover:scale-110 
${pct > 0 ? theme.main : "bg-gray-200 text-gray-400"}">
${idx}
</div>

<div class="flex-1">
<div class="flex justify-between items-end mb-2">
<h4 class="font-extrabold text-gray-700 text-lg leading-tight group-hover:text-black">${unitName}</h4>
<span class="text-sm font-extrabold ${pct > 0 ? theme.text : "text-gray-400"
                        }">${pct}%</span>
</div>
<div class="h-4 w-full bg-gray-100 rounded-full overflow-hidden">
<div class="h-full bg-gradient-to-r ${theme.gradient
                        } transition-all duration-1000" style="width: ${pct}%"></div>
</div>
</div>
</div>
`;
                    idx++;
                }

                html += `</div></div>`;
                container.innerHTML = html;
            },

            renderPath(container, { level, unit }) {
                const theme = LEVEL_THEMES[level] || LEVEL_THEMES["6¬∫ Ano"];
                const lessons = CURRICULO[level][unit] || [];
                const userLessons = this.user ? this.user.completedLessons : [];

                let html = `
<div class="flex flex-col items-center pt-8 w-full animate-fade-in pb-20 max-w-xl mx-auto">

<div class="${theme.light} ${theme.text
                    } text-sm font-extrabold px-6 py-2 rounded-2xl mb-4 tracking-wide cursor-pointer hover:brightness-95" onclick="app.goBack()">
${level.toUpperCase()}
</div>

<h2 class="text-2xl md:text-3xl font-extrabold text-gray-700 text-center mb-2 leading-tight">${unit}</h2>
<p class="text-gray-400 font-bold text-base mb-12">Trilha de Aprendizagem</p>

<div class="relative w-full flex flex-col items-center">
<div class="absolute top-0 bottom-10 left-1/2 w-3 bg-gray-200 -translate-x-1/2 rounded-full -z-10"></div>
`;

                lessons.forEach((lesson, i) => {
                    // L√≥gica de Desbloqueio
                    const isCompleted = userLessons.includes(lesson);
                    // Desbloqueia se for a primeira OU se a anterior estiver completa
                    const isUnlocked = i === 0 || userLessons.includes(lessons[i - 1]);

                    // Ziguezague (Esquerda / Direita)
                    const offset = i % 2 === 0 ? "-translate-x-8" : "translate-x-8";
                    const tooltipPos =
                        i % 2 === 0 ? "left-24 text-left" : "right-24 text-right";

                    let btnClass, icon;

                    if (isCompleted) {
                        // Completou: Dourado
                        btnClass =
                            "bg-[#ffc800] border-[#e5b400] text-white shadow-[0_4px_0_#e5b400]";
                        icon = '<i class="fas fa-check text-3xl"></i>';
                    } else if (isUnlocked) {
                        // Atual: Cor do Tema
                        btnClass = `${theme.main} ${theme.borderDark} text-white ring-8 ${theme.ring} shadow-lg`;
                        icon = '<i class="fas fa-star text-2xl"></i>';
                    } else {
                        // Bloqueado: Cinza
                        btnClass = "bg-gray-200 border-gray-300 text-gray-400";
                        icon = '<i class="fas fa-lock text-2xl"></i>';
                    }

                    // A√ß√£o do Bot√£o
                    const action = isUnlocked
                        ? `onclick="app.navigate('lesson', '${lesson}')"`
                        : `onclick="alert('Complete a li√ß√£o anterior para desbloquear esta!')"`;

                    html += `
<div class="flex items-center justify-center w-full mb-10 relative">
<div class="relative group transition-transform ${offset}">

<div class="absolute top-1/2 -translate-y-1/2 ${tooltipPos} w-48 p-3 rounded-xl border-2 bg-white z-20 shadow-sm transition-all ${isUnlocked
                            ? `${theme.border} scale-105`
                            : "border-gray-200 opacity-60"
                        }">
<h4 class="font-extrabold text-gray-700 text-sm leading-snug">${lesson}</h4>
</div>

<button ${action} class="w-20 h-20 rounded-full border-b-[6px] flex items-center justify-center transition-all active:scale-95 active:border-b-0 z-10 relative ${btnClass}">
${icon}
<div class="absolute top-2 left-1/2 -translate-x-1/2 w-2/3 h-1/3 bg-white opacity-20 rounded-full"></div>
</button>
</div>
</div>
`;
                });

                html += `
<div class="w-24 h-24 mt-4 relative cursor-pointer hover:scale-105 transition-transform" onclick="alert('Parab√©ns! Voc√™ completou a unidade!')">
<div class="w-full h-full rounded-3xl ${theme.light} border-4 ${theme.border} flex items-center justify-center shadow-card">
<i class="fas fa-gem text-4xl ${theme.text} animate-bounce"></i>
</div>
</div>
</div></div>`;

                container.innerHTML = html;
            },

            renderLesson(c, n) {
                const content =
                    CONTEUDO_TEORIA[n] ||
                    `<div class="text-center py-10 text-gray-400 font-bold">Conte√∫do em desenvolvimento...</div>`;
                c.innerHTML = `<div class="bg-white p-6 md:p-10 rounded-[2rem] shadow-card border-2 border-gray-100 animate-fade-in mb-20 max-w-3xl mx-auto"><div class="flex items-center gap-3 mb-8 border-b-2 border-gray-100 pb-6"><div class="w-12 h-12 bg-brand-green rounded-xl flex items-center justify-center text-white text-xl shadow-sm"><i class="fas fa-book"></i></div><h1 class="text-2xl md:text-3xl font-black text-gray-700 leading-tight">${n}</h1></div><div id="lesson-body" class="lesson-content text-gray-700">${this.parseContent(
                    content
                )}</div><div class="mt-12 pt-8 border-t-2 border-gray-100"><button onclick="app.saveProgress(50,'${n}');app.goBack()" class="w-full bg-brand-green hover:bg-brand-greenDark text-white font-extrabold text-lg py-4 rounded-2xl shadow-btn btn-game uppercase tracking-widest transition-colors flex items-center justify-center gap-3"><i class="fas fa-check-circle"></i> Concluir Li√ß√£o</button></div></div>`;
                if (window.renderMathInElement)
                    renderMathInElement(document.getElementById("lesson-body"), {
                        delimiters: [
                            { left: "$$", right: "$$", display: true },
                            { left: "$", right: "$", display: false },
                        ],
                    });
                this.activateWidgets();
            },

            parseContent(t) {
                let p = t.replace(/\n/g, "<br>");
                p = p.replace(
                    /\[ALERTA.*?\]:(.*?)(<br>|$)/g,
                    `<div class="bg-red-50 border-l-[6px] border-brand-red p-4 my-6 rounded-r-xl flex gap-4 items-start shadow-sm"><div class="text-brand-red text-xl mt-1"><i class="fas fa-exclamation-triangle"></i></div><div><h5 class="font-black text-brand-red text-sm uppercase tracking-wider mb-1">Aten√ß√£o</h5><p class="text-gray-700 text-sm font-bold m-0">$1</p></div></div>`
                );
                p = p.replace(
                    /\[DICA.*?\]:(.*?)(<br>|$)/g,
                    `<div class="bg-blue-50 border-l-[6px] border-brand-blue p-4 my-6 rounded-r-xl flex gap-4 items-start shadow-sm"><div class="text-brand-blue text-xl mt-1"><i class="fas fa-lightbulb"></i></div><div><h5 class="font-black text-brand-blue text-sm uppercase tracking-wider mb-1">Dica Ninja</h5><p class="text-gray-700 text-sm font-bold m-0">$1</p></div></div>`
                );
                p = p.replace(
                    /\[WIDGET:(.*?)\]/g,
                    (m, n) =>
                        `<div class="widget-placeholder w-full my-8" data-widget="${n.trim()}"></div>`
                );
                return p;
            },
            activateWidgets() {
                document.querySelectorAll(".widget-placeholder").forEach((d) => {
                    const n = d.dataset.widget;
                    if (this.widgets[n]) this.widgets[n](d);
                    else
                        d.innerHTML = `<div class="bg-gray-100 rounded-2xl p-8 text-center border-2 border-dashed border-gray-300 text-gray-400 font-bold">Widget: ${n}</div>`;
                });
            },

            widgets: {
                // insira o novo widget: na linha abaixo dessa

                interactive_fraction_anatomy(container) {
                    // Estado
                    let num = 1;
                    let den = 4;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Raio-X da Fra√ß√£o</h3>

        <div class="flex flex-col md:flex-row items-center gap-10 w-full justify-center">
            
            <div class="flex flex-col gap-4">
                
                <div class="flex items-center gap-3 bg-blue-50 p-2 rounded-xl border border-blue-200">
                    <div class="flex flex-col items-center w-10">
                        <button id="btn-n-up" class="text-brand-blue hover:text-blue-600 transition-colors"><i class="fas fa-chevron-up"></i></button>
                        <span class="font-black text-xl text-brand-blue" id="disp-num">1</span>
                        <button id="btn-n-down" class="text-brand-blue hover:text-blue-600 transition-colors"><i class="fas fa-chevron-down"></i></button>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-xs font-bold text-blue-800 uppercase">Numerador</span>
                        <span class="text-[10px] text-blue-600 leading-tight">Conta as partes<br>pintadas</span>
                    </div>
                </div>

                <div class="h-0.5 w-full bg-gray-300 rounded-full"></div>

                <div class="flex items-center gap-3 bg-orange-50 p-2 rounded-xl border border-orange-200">
                    <div class="flex flex-col items-center w-10">
                        <button id="btn-d-up" class="text-brand-orange hover:text-orange-600 transition-colors"><i class="fas fa-chevron-up"></i></button>
                        <span class="font-black text-xl text-brand-orange" id="disp-den">4</span>
                        <button id="btn-d-down" class="text-brand-orange hover:text-orange-600 transition-colors"><i class="fas fa-chevron-down"></i></button>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-xs font-bold text-orange-800 uppercase">Denominador</span>
                        <span class="text-[10px] text-orange-600 leading-tight">Define o corte<br>total</span>
                    </div>
                </div>

            </div>

            <div class="flex flex-col items-center">
                <div class="relative w-40 h-40 transition-all duration-300">
                    <svg viewBox="0 0 100 100" class="w-full h-full transform -rotate-90">
                        <circle cx="50" cy="50" r="45" fill="#f3f4f6" stroke="#e5e7eb" stroke-width="2" />
                        <path id="pie-slice" d="" fill="#1CB0F6" stroke="#1CB0F6" stroke-width="0" class="transition-all duration-500" />
                        <g id="pie-lines"></g>
                        <circle cx="50" cy="50" r="45" fill="none" stroke="#374151" stroke-width="2" />
                    </svg>
                </div>
                <div class="mt-4 text-center">
                    <p id="text-desc" class="font-bold text-gray-600 text-sm">1 de 4 partes</p>
                </div>
            </div>

        </div>
    </div>
    `;

                    const dispN = container.querySelector("#disp-num");
                    const dispD = container.querySelector("#disp-den");
                    const pieSlice = container.querySelector("#pie-slice");
                    const pieLines = container.querySelector("#pie-lines");
                    const textDesc = container.querySelector("#text-desc");

                    const update = () => {
                        // Limites
                        if (den < 1) den = 1;
                        if (den > 12) den = 12;
                        if (num < 0) num = 0;
                        if (num > den) num = den;

                        dispN.innerText = num;
                        dispD.innerText = den;
                        textDesc.innerText = `${num} de ${den} partes`;

                        // Render Pizza
                        // Slice (Numerador)
                        if (num === 0) {
                            pieSlice.setAttribute("d", "");
                        } else if (num === den) {
                            pieSlice.setAttribute(
                                "d",
                                "M 50 5 50 50 A 45 45 0 1 0 50 4.9 Z"
                            ); // C√≠rculo quase cheio para evitar bug de arco SVG
                            // Ou usar circle simples
                            pieSlice.setAttribute("d", "M 50 5 A 45 45 0 1 1 49.99 5 Z");
                        } else {
                            const percentage = num / den;
                            const degrees = percentage * 360;
                            const rad = degrees * (Math.PI / 180);
                            const x = 50 + 45 * Math.cos(rad);
                            const y = 50 + 45 * Math.sin(rad);
                            const largeArc = degrees > 180 ? 1 : 0;

                            // Move to center, Line to top (start), Arc to end, Close
                            // Nota: SVG roda -90 via CSS, ent√£o 0 grau √© o topo visualmente
                            // Coordenada inicial (topo relativo ao c√≠rculo n√£o rotacionado seria direita 0, mas aqui calculamos normal)
                            // Vamos usar coordenadas polares padr√£o e o CSS gira tudo.
                            // 0 rad = direita (50+45, 50) = (95, 50)

                            const startX = 95;
                            const startY = 50;

                            const d = `M 50 50 L ${startX} ${startY} A 45 45 0 ${largeArc} 1 ${x} ${y} Z`;
                            pieSlice.setAttribute("d", d);
                        }

                        // Lines (Denominador)
                        let linesHTML = "";
                        if (den > 1) {
                            for (let i = 0; i < den; i++) {
                                const deg = (i * 360) / den;
                                const rad = deg * (Math.PI / 180);
                                const x2 = 50 + 45 * Math.cos(rad);
                                const y2 = 50 + 45 * Math.sin(rad);
                                linesHTML += `<line x1="50" y1="50" x2="${x2}" y2="${y2}" stroke="white" stroke-width="2" />`;
                            }
                        }
                        pieLines.innerHTML = linesHTML;
                    };

                    container.querySelector("#btn-n-up").onclick = () => {
                        num++;
                        update();
                    };
                    container.querySelector("#btn-n-down").onclick = () => {
                        num--;
                        update();
                    };
                    container.querySelector("#btn-d-up").onclick = () => {
                        den++;
                        if (num > den) num = den;
                        update();
                    };
                    container.querySelector("#btn-d-down").onclick = () => {
                        den--;
                        if (num > den) num = den;
                        update();
                    };

                    update();
                },

                interactive_fraction_role_quiz(container) {
                    let score = 0;
                    let currentTask = "num"; // 'num' ou 'den'
                    let nVal = 3;
                    let dVal = 5;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full text-white mb-6 z-10">
            <h3 class="font-black uppercase text-xs tracking-widest text-gray-400">Reflexo Matem√°tico</h3>
            <div class="bg-gray-700 px-3 py-1 rounded-full text-xs font-black text-brand-yellow">Pontos: <span id="role-score">0</span></div>
        </div>

        <div class="text-center mb-8 z-10">
            <p class="text-gray-400 text-xs font-bold uppercase mb-2">Clique no:</p>
            <div id="task-display" class="text-3xl md:text-4xl font-black text-white bg-gray-800 px-6 py-3 rounded-xl border-2 border-gray-600 animate-pulse">
                NUMERADOR
            </div>
        </div>

        <div class="flex flex-col items-center z-10 gap-2 mb-4">
            
            <button id="btn-num" class="text-6xl font-black text-white hover:text-brand-blue transition-all transform hover:scale-110 active:scale-95 p-4 rounded-xl hover:bg-gray-800 border-2 border-transparent hover:border-brand-blue">
                3
            </button>
            
            <div class="w-32 h-2 bg-white rounded-full"></div>
            
            <button id="btn-den" class="text-6xl font-black text-white hover:text-brand-orange transition-all transform hover:scale-110 active:scale-95 p-4 rounded-xl hover:bg-gray-800 border-2 border-transparent hover:border-brand-orange">
                5
            </button>

        </div>

        <div id="role-feedback" class="h-8 font-bold text-center z-10"></div>

    </div>
    `;

                    const taskDisp = container.querySelector("#task-display");
                    const scoreEl = container.querySelector("#role-score");
                    const btnNum = container.querySelector("#btn-num");
                    const btnDen = container.querySelector("#btn-den");
                    const feedback = container.querySelector("#role-feedback");

                    const nextRound = () => {
                        // Gera novos n√∫meros
                        nVal = Math.floor(Math.random() * 9) + 1;
                        dVal = nVal + Math.floor(Math.random() * 5) + 1;

                        btnNum.innerText = nVal;
                        btnDen.innerText = dVal;

                        // Escolhe tarefa
                        currentTask = Math.random() > 0.5 ? "num" : "den";

                        if (currentTask === "num") {
                            taskDisp.innerText = "NUMERADOR";
                            taskDisp.className =
                                "text-3xl md:text-4xl font-black text-brand-blue bg-blue-900/50 px-6 py-3 rounded-xl border-2 border-brand-blue animate-pulse";
                        } else {
                            taskDisp.innerText = "DENOMINADOR";
                            taskDisp.className =
                                "text-3xl md:text-4xl font-black text-brand-orange bg-orange-900/50 px-6 py-3 rounded-xl border-2 border-brand-orange animate-pulse";
                        }
                    };

                    const check = (choice) => {
                        if (choice === currentTask) {
                            // Acerto
                            score += 10;
                            scoreEl.innerText = score;
                            feedback.innerHTML = `<span class="text-green-400">Boa! ${choice === "num" ? "O de cima!" : "O de baixo!"
                                }</span>`;
                            nextRound();
                        } else {
                            // Erro
                            score = Math.max(0, score - 5);
                            scoreEl.innerText = score;
                            feedback.innerHTML = `<span class="text-red-500">Ops! Tente de novo.</span>`;

                            // Shake no bot√£o errado
                            const btn = choice === "num" ? btnNum : btnDen;
                            btn.classList.add("text-red-500", "animate-shake");
                            setTimeout(
                                () => btn.classList.remove("text-red-500", "animate-shake"),
                                400
                            );
                        }
                    };

                    btnNum.onclick = () => check("num");
                    btnDen.onclick = () => check("den");

                    nextRound();
                },

                interactive_timeline_runner(container) {
                    let t1 = 4;
                    let t2 = 6;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Simulador de Encontro</h3>

        <div class="flex gap-4 mb-6">
            <div class="flex flex-col items-center">
                <label class="text-[10px] font-bold text-brand-blue uppercase">Corredor Azul</label>
                <input type="number" id="in-t1" value="4" min="2" max="10" class="w-16 text-center border-2 border-brand-blue rounded-lg font-bold text-xl text-brand-blue outline-none">
                <span class="text-[10px] text-gray-400">min/volta</span>
            </div>
            <div class="flex flex-col items-center">
                <label class="text-[10px] font-bold text-brand-red uppercase">Corredor Vermelho</label>
                <input type="number" id="in-t2" value="6" min="2" max="10" class="w-16 text-center border-2 border-brand-red rounded-lg font-bold text-xl text-brand-red outline-none">
                <span class="text-[10px] text-gray-400">min/volta</span>
            </div>
        </div>

        <div class="w-full overflow-x-auto pb-6 relative custom-scrollbar">
            <div class="relative min-w-[600px] h-40 pt-4" id="track-area">
                <div class="absolute top-1/2 left-0 w-full h-1 bg-gray-200 rounded-full"></div>
                
                <div id="ticks-layer" class="absolute inset-0 h-full pointer-events-none"></div>

                <div id="jumps-blue" class="absolute inset-0 h-full"></div>
                
                <div id="jumps-red" class="absolute inset-0 h-full"></div>
            </div>
        </div>

        <div class="mt-2 text-center bg-green-50 p-3 rounded-xl border border-green-200 w-full max-w-sm">
            <p class="text-xs text-green-800 font-bold uppercase mb-1">Pr√≥ximo Encontro (MMC)</p>
            <div class="text-3xl font-black text-brand-green" id="mmc-res">12 min</div>
        </div>
    </div>
    `;

                    const inT1 = container.querySelector("#in-t1");
                    const inT2 = container.querySelector("#in-t2");
                    const ticksLayer = container.querySelector("#ticks-layer");
                    const jumpsBlue = container.querySelector("#jumps-blue");
                    const jumpsRed = container.querySelector("#jumps-red");
                    const mmcRes = container.querySelector("#mmc-res");
                    const trackArea = container.querySelector("#track-area");

                    const gcd = (a, b) => (b === 0 ? a : gcd(b, a % b));
                    const lcm = (a, b) => (a * b) / gcd(a, b);

                    const draw = () => {
                        t1 = parseInt(inT1.value) || 2;
                        t2 = parseInt(inT2.value) || 2;

                        const valMMC = lcm(t1, t2);
                        const limit = Math.min(valMMC * 2 + 1, 60); // Mostra at√© 2x o MMC ou max 60
                        const scale = 30; // px por minuto

                        // Ajusta largura do container
                        trackArea.style.width = `${(limit + 2) * scale}px`;

                        // Renderiza R√©gua
                        let ticksHTML = "";
                        for (let i = 0; i <= limit; i++) {
                            const isMMC = i > 0 && i % valMMC === 0;
                            const height = isMMC
                                ? "h-6 bg-brand-green"
                                : i % 5 === 0
                                    ? "h-4 bg-gray-400"
                                    : "h-2 bg-gray-300";
                            const textClass = isMMC
                                ? "text-brand-green font-black scale-125"
                                : "text-gray-400 font-medium";

                            ticksHTML += `
                <div class="absolute top-1/2 -translate-y-1/2 flex flex-col items-center justify-center" style="left: ${i * scale
                                }px; width: 2px;">
                    <div class="w-0.5 ${height} rounded-full mb-1"></div>
                    <span class="text-[10px] ${textClass}">${i}</span>
                </div>
            `;
                        }
                        ticksLayer.innerHTML = ticksHTML;

                        // Renderiza Pulos (Arcos usando CSS border-radius hack ou SVG? Vamos de divs absolutas com border-top-radius)
                        // Azul (Cima)
                        let blueHTML = "";
                        for (let i = 0; i < limit; i += t1) {
                            const width = t1 * scale;
                            const left = i * scale;
                            blueHTML += `
                <div class="absolute top-[10%] border-t-2 border-l-2 border-r-2 border-brand-blue rounded-t-full opacity-60" 
                     style="left: ${left}px; width: ${width}px; height: 30px;">
                     <div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-white text-[8px] text-brand-blue font-bold px-1">+${t1}</div>
                </div>
            `;
                        }
                        jumpsBlue.innerHTML = blueHTML;

                        // Vermelho (Baixo)
                        let redHTML = "";
                        for (let i = 0; i < limit; i += t2) {
                            const width = t2 * scale;
                            const left = i * scale;
                            redHTML += `
                <div class="absolute bottom-[10%] border-b-2 border-l-2 border-r-2 border-brand-red rounded-b-full opacity-60" 
                     style="left: ${left}px; width: ${width}px; height: 30px;">
                     <div class="absolute -bottom-3 left-1/2 -translate-x-1/2 bg-white text-[8px] text-brand-red font-bold px-1">+${t2}</div>
                </div>
            `;
                        }
                        jumpsRed.innerHTML = redHTML;

                        mmcRes.innerText = `${valMMC} min`;
                    };

                    inT1.addEventListener("input", draw);
                    inT2.addEventListener("input", draw);
                    draw();
                },

                interactive_gift_factory(container) {
                    let item1 = 20;
                    let item2 = 12;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-6">F√°brica de Kits (MDC)</h3>

        <div class="flex gap-8 mb-8 w-full max-w-md justify-center">
            <div class="flex flex-col items-center w-1/2">
                <div class="flex justify-between w-full text-xs font-bold text-gray-500 mb-2">
                    <span>üç¨ Balas</span>
                    <span id="val-1" class="text-brand-blue">20</span>
                </div>
                <div class="w-full bg-blue-50 border-2 border-blue-200 rounded-lg p-2 min-h-[60px] flex flex-wrap gap-1 content-start" id="stock-1">
                    </div>
                <input type="range" id="range-1" min="4" max="30" value="20" class="w-full mt-2 h-2 bg-gray-200 rounded-lg accent-brand-blue cursor-pointer">
            </div>

            <div class="flex flex-col items-center w-1/2">
                <div class="flex justify-between w-full text-xs font-bold text-gray-500 mb-2">
                    <span>üç≠ Pirulitos</span>
                    <span id="val-2" class="text-brand-orange">12</span>
                </div>
                <div class="w-full bg-orange-50 border-2 border-orange-200 rounded-lg p-2 min-h-[60px] flex flex-wrap gap-1 content-start" id="stock-2">
                    </div>
                <input type="range" id="range-2" min="4" max="30" value="12" class="w-full mt-2 h-2 bg-gray-200 rounded-lg accent-brand-orange cursor-pointer">
            </div>
        </div>

        <div class="w-full max-w-sm bg-gray-50 border border-gray-200 rounded-xl p-4 flex flex-col items-center">
            <p class="text-xs font-bold text-gray-400 uppercase mb-2">Quantas sacolinhas?</p>
            <div class="flex items-center gap-4 w-full">
                <button id="btn-dec" class="w-10 h-10 rounded-full bg-white border border-gray-300 font-black text-gray-500 hover:bg-gray-100">-</button>
                <div class="flex-1 text-center">
                    <span id="bags-count" class="text-4xl font-black text-brand-text">1</span>
                    <p class="text-[10px] text-gray-400 uppercase font-bold">Sacolinhas</p>
                </div>
                <button id="btn-inc" class="w-10 h-10 rounded-full bg-white border border-gray-300 font-black text-gray-500 hover:bg-gray-100">+</button>
            </div>
        </div>

        <div id="factory-feedback" class="mt-6 text-center h-16 w-full">
            </div>

    </div>
    `;

                    const range1 = container.querySelector("#range-1");
                    const range2 = container.querySelector("#range-2");
                    const val1El = container.querySelector("#val-1");
                    const val2El = container.querySelector("#val-2");
                    const stock1 = container.querySelector("#stock-1");
                    const stock2 = container.querySelector("#stock-2");
                    const bagsDisplay = container.querySelector("#bags-count");
                    const btnInc = container.querySelector("#btn-inc");
                    const btnDec = container.querySelector("#btn-dec");
                    const feedback = container.querySelector("#factory-feedback");

                    let currentBags = 1;

                    const gcd = (a, b) => (b === 0 ? a : gcd(b, a % b));

                    const renderStock = (el, count, colorClass) => {
                        el.innerHTML = "";
                        for (let i = 0; i < count; i++) {
                            const item = document.createElement("div");
                            item.className = `w-3 h-3 rounded-full ${colorClass}`;
                            el.appendChild(item);
                        }
                    };

                    const update = () => {
                        item1 = parseInt(range1.value);
                        item2 = parseInt(range2.value);
                        val1El.innerText = item1;
                        val2El.innerText = item2;

                        renderStock(stock1, item1, "bg-brand-blue");
                        renderStock(stock2, item2, "bg-brand-orange");

                        checkBags();
                    };

                    const checkBags = () => {
                        bagsDisplay.innerText = currentBags;

                        const perBag1 = item1 / currentBags;
                        const perBag2 = item2 / currentBags;
                        const isInteger1 = Number.isInteger(perBag1);
                        const isInteger2 = Number.isInteger(perBag2);
                        const trueMDC = gcd(item1, item2);

                        if (isInteger1 && isInteger2) {
                            // Divis√£o poss√≠vel
                            if (currentBags === trueMDC) {
                                // √â o MDC!
                                feedback.innerHTML = `
                    <div class="bg-green-100 border-2 border-green-400 rounded-xl p-2 animate-pop-in">
                        <p class="text-green-800 font-bold text-sm"><i class="fas fa-star"></i> PERFEITO! (MDC)</p>
                        <p class="text-xs text-green-700">Cada sacola ter√° <strong>${perBag1}</strong> balas e <strong>${perBag2}</strong> pirulitos.</p>
                    </div>
                `;
                            } else {
                                // √â divisor comum, mas n√£o o m√°ximo
                                feedback.innerHTML = `
                    <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-2">
                        <p class="text-yellow-800 font-bold text-sm">Funciona, mas...</p>
                        <p class="text-xs text-yellow-700">Voc√™ pode fazer <strong>MAIS</strong> sacolinhas iguais. Tente aumentar!</p>
                    </div>
                `;
                            }
                        } else {
                            // N√£o divide exato
                            feedback.innerHTML = `
                <div class="bg-red-50 border-2 border-red-200 rounded-xl p-2">
                    <p class="text-red-800 font-bold text-sm">N√£o d√° certo!</p>
                    <p class="text-xs text-red-700">Os doces n√£o dividem igualmente. Vai sobrar coisa fora da sacola.</p>
                </div>
            `;
                        }
                    };

                    range1.oninput = update;
                    range2.oninput = update;

                    btnInc.onclick = () => {
                        if (currentBags < Math.min(item1, item2)) {
                            currentBags++;
                            checkBags();
                        }
                    };
                    btnDec.onclick = () => {
                        if (currentBags > 1) {
                            currentBags--;
                            checkBags();
                        }
                    };

                    update();
                },

                interactive_problem_sorter(container) {
                    const problems = [
                        {
                            text: "Dois √¥nibus saem juntos do terminal. Um a cada 10min, outro a cada 15min. Quando sair√£o juntos de novo?",
                            type: "MMC",
                        },
                        {
                            text: "Tenho 30 rosas e 20 margaridas. Quero fazer buqu√™s iguais com o maior n√∫mero de flores poss√≠vel.",
                            type: "MDC",
                        },
                        {
                            text: "Um rem√©dio de 6h em 6h e outro de 8h em 8h. Qual o hor√°rio da pr√≥xima dose simult√¢nea?",
                            type: "MMC",
                        },
                        {
                            text: "Cortar duas t√°buas de 12m e 18m em peda√ßos iguais do maior tamanho poss√≠vel.",
                            type: "MDC",
                        },
                        {
                            text: "Luzes de natal piscam em tempos diferentes. Quando piscar√£o juntas?",
                            type: "MMC",
                        },
                    ];

                    let currentIdx = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-300 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-6 z-10">
            <h3 class="font-black text-gray-500 uppercase text-xs tracking-widest">Ag√™ncia de Detetives</h3>
            <div class="bg-white border border-gray-200 px-3 py-1 rounded-full text-xs font-black">Score: <span id="sort-score" class="text-brand-blue">0</span></div>
        </div>

        <div class="relative w-full h-40 mb-6 perspective-container">
            <div id="prob-card" class="absolute inset-0 bg-white rounded-xl shadow-md border-b-4 border-gray-200 p-6 flex items-center justify-center text-center transition-all duration-500 cursor-grab active:cursor-grabbing z-20">
                <p class="font-bold text-gray-700 text-sm md:text-base leading-relaxed" id="card-text">...</p>
            </div>
            <div id="sort-feedback" class="absolute inset-0 flex items-center justify-center font-black text-4xl opacity-0 transition-opacity z-10"></div>
        </div>

        <div class="flex gap-4 w-full max-w-sm z-10">
            <button class="sort-btn flex-1 bg-purple-100 border-b-4 border-purple-300 text-brand-purple font-black py-4 rounded-xl active:border-b-0 active:translate-y-1 transition-all hover:bg-purple-200" data-type="MMC">
                MMC<br><span class="text-[10px] font-normal uppercase opacity-70">Encontro / Tempo</span>
            </button>
            <button class="sort-btn flex-1 bg-orange-100 border-b-4 border-orange-300 text-brand-orange font-black py-4 rounded-xl active:border-b-0 active:translate-y-1 transition-all hover:bg-orange-200" data-type="MDC">
                MDC<br><span class="text-[10px] font-normal uppercase opacity-70">Divis√£o / M√°ximo</span>
            </button>
        </div>

        <div id="end-screen" class="hidden absolute inset-0 bg-white/95 flex-col items-center justify-center z-30 animate-fade-in text-center p-6">
            <div class="text-6xl mb-4">üïµÔ∏è‚Äç‚ôÄÔ∏è</div>
            <h3 class="text-2xl font-black text-brand-text mb-2">Caso Encerrado!</h3>
            <p class="text-gray-500 mb-6">Voc√™ resolveu ${problems.length} casos.</p>
            <button id="btn-restart" class="bg-brand-blue text-white font-bold py-3 px-8 rounded-full shadow-btn active:scale-95 transition-all">Jogar Novamente</button>
        </div>

    </div>
    `;

                    const card = container.querySelector("#prob-card");
                    const cardText = container.querySelector("#card-text");
                    const feedback = container.querySelector("#sort-feedback");
                    const scoreEl = container.querySelector("#sort-score");
                    const endScreen = container.querySelector("#end-screen");
                    const restartBtn = container.querySelector("#btn-restart");
                    const btns = container.querySelectorAll(".sort-btn");

                    const loadCard = () => {
                        if (currentIdx >= problems.length) {
                            endScreen.classList.remove("hidden");
                            endScreen.classList.add("flex");
                            return;
                        }

                        const p = problems[currentIdx];
                        cardText.innerText = p.text;

                        // Reset Visual
                        card.style.transform = "rotate(0deg) translate(0,0)";
                        card.style.opacity = "1";
                        feedback.classList.add("opacity-0");
                    };

                    const handleChoice = (type) => {
                        const p = problems[currentIdx];
                        const isCorrect = p.type === type;

                        // Anima√ß√£o do Card
                        const rotation = type === "MMC" ? -15 : 15;
                        const xDir = type === "MMC" ? -100 : 100;

                        card.style.transform = `rotate(${rotation}deg) translate(${xDir}%, -20px)`;
                        card.style.opacity = "0";

                        if (isCorrect) {
                            score += 10;
                            feedback.innerHTML =
                                '<span class="text-green-500">‚úÖ CERTO!</span>';
                        } else {
                            feedback.innerHTML =
                                '<span class="text-red-500">‚ùå ERRO!</span>';
                        }

                        feedback.classList.remove("opacity-0");
                        scoreEl.innerText = score;

                        setTimeout(() => {
                            currentIdx++;
                            loadCard();
                        }, 600);
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => handleChoice(btn.dataset.type);
                    });

                    restartBtn.onclick = () => {
                        currentIdx = 0;
                        score = 0;
                        scoreEl.innerText = 0;
                        endScreen.classList.add("hidden");
                        endScreen.classList.remove("flex");
                        loadCard();
                    };

                    loadCard();
                },

                interactive_remainder_visualizer(container) {
                    // Estado
                    let total = 14;
                    let groups = 4;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Distribuidor de Itens</h3>

        <div class="flex gap-4 mb-6 w-full justify-center">
            <div class="flex flex-col items-center">
                <label class="text-[10px] font-bold text-gray-400 uppercase mb-1">Total de Itens</label>
                <div class="flex items-center gap-2">
                    <button class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 font-bold" id="btn-tot-minus">-</button>
                    <span class="text-2xl font-black text-brand-text w-8 text-center" id="val-total">${total}</span>
                    <button class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 font-bold" id="btn-tot-plus">+</button>
                </div>
            </div>
            
            <div class="h-12 w-px bg-gray-200 mx-2"></div>

            <div class="flex flex-col items-center">
                <label class="text-[10px] font-bold text-gray-400 uppercase mb-1">Grupos (Divisor)</label>
                <div class="flex items-center gap-2">
                    <button class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 font-bold" id="btn-grp-minus">-</button>
                    <span class="text-2xl font-black text-brand-blue w-8 text-center" id="val-groups">${groups}</span>
                    <button class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 font-bold" id="btn-grp-plus">+</button>
                </div>
            </div>
        </div>

        <div class="w-full bg-gray-50 rounded-xl border border-gray-200 p-4 min-h-[150px] flex flex-col items-center justify-center gap-4 transition-all" id="visual-area">
            <div id="groups-display" class="flex flex-wrap justify-center gap-4"></div>
            
            <div id="remainder-display" class="hidden flex items-center gap-2 bg-red-50 px-4 py-2 rounded-lg border border-red-200 animate-pop-in">
                <span class="text-xs font-bold text-brand-red uppercase">Resto:</span>
                <div id="remainder-dots" class="flex gap-1"></div>
            </div>
        </div>

        <div id="status-badge" class="mt-4 px-4 py-2 rounded-full font-black text-sm uppercase tracking-wider bg-orange-100 text-brand-orange">
            N√£o Exata
        </div>

    </div>
    `;

                    const valTotal = container.querySelector("#val-total");
                    const valGroups = container.querySelector("#val-groups");
                    const groupsDisplay = container.querySelector("#groups-display");
                    const remDisplay = container.querySelector("#remainder-display");
                    const remDots = container.querySelector("#remainder-dots");
                    const statusBadge = container.querySelector("#status-badge");
                    const visualArea = container.querySelector("#visual-area");

                    const update = () => {
                        valTotal.innerText = total;
                        valGroups.innerText = groups;

                        const q = Math.floor(total / groups);
                        const r = total % groups;

                        // Renderiza Grupos
                        groupsDisplay.innerHTML = "";
                        for (let i = 0; i < groups; i++) {
                            const groupBox = document.createElement("div");
                            groupBox.className =
                                "border-2 border-brand-blue bg-white rounded-lg p-2 flex flex-wrap gap-1 w-16 min-h-[40px] content-start justify-center transition-all";

                            for (let j = 0; j < q; j++) {
                                const dot = document.createElement("div");
                                dot.className = "w-3 h-3 rounded-full bg-brand-blue";
                                groupBox.appendChild(dot);
                            }
                            groupsDisplay.appendChild(groupBox);
                        }

                        // Renderiza Resto
                        remDots.innerHTML = "";
                        if (r > 0) {
                            remDisplay.classList.remove("hidden");
                            statusBadge.innerText = "Divis√£o N√£o Exata";
                            statusBadge.className =
                                "mt-4 px-4 py-2 rounded-full font-black text-sm uppercase tracking-wider bg-orange-100 text-brand-orange transition-all";
                            visualArea.classList.add("border-orange-200", "bg-orange-50");
                            visualArea.classList.remove("border-green-200", "bg-green-50");

                            for (let k = 0; k < r; k++) {
                                const dot = document.createElement("div");
                                dot.className =
                                    "w-4 h-4 rounded-full bg-brand-red border border-red-500 shadow-sm animate-bounce";
                                dot.style.animationDelay = `${k * 0.1}s`;
                                remDots.appendChild(dot);
                            }
                        } else {
                            remDisplay.classList.add("hidden");
                            statusBadge.innerText = "Divis√£o Exata";
                            statusBadge.className =
                                "mt-4 px-4 py-2 rounded-full font-black text-sm uppercase tracking-wider bg-green-100 text-brand-green transition-all";
                            visualArea.classList.add("border-green-200", "bg-green-50");
                            visualArea.classList.remove(
                                "border-orange-200",
                                "bg-orange-50"
                            );
                        }
                    };

                    // Listeners
                    container.querySelector("#btn-tot-plus").onclick = () => {
                        if (total < 30) total++;
                        update();
                    };
                    container.querySelector("#btn-tot-minus").onclick = () => {
                        if (total > 1) total--;
                        update();
                    };
                    container.querySelector("#btn-grp-plus").onclick = () => {
                        if (groups < 10) groups++;
                        update();
                    };
                    container.querySelector("#btn-grp-minus").onclick = () => {
                        if (groups > 1) groups--;
                        update();
                    };

                    update();
                },

                interactive_division_sorter(container) {
                    // Banco de Perguntas
                    const problems = [
                        { q: "10 √∑ 2", type: "exata" },
                        { q: "10 √∑ 3", type: "nao-exata" },
                        { q: "15 √∑ 5", type: "exata" },
                        { q: "16 √∑ 5", type: "nao-exata" },
                        { q: "21 √∑ 7", type: "exata" },
                        { q: "22 √∑ 7", type: "nao-exata" },
                        { q: "8 √∑ 4", type: "exata" },
                        { q: "9 √∑ 2", type: "nao-exata" },
                        { q: "30 √∑ 10", type: "exata" },
                        { q: "35 √∑ 10", type: "nao-exata" },
                    ];

                    let currentIdx = 0;
                    let score = 0;
                    let shuffled = [...problems].sort(() => Math.random() - 0.5);

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full mb-4">
            <span class="text-xs font-bold text-gray-400 uppercase">Classificador</span>
            <span class="text-xs font-bold text-brand-blue bg-blue-50 px-2 py-1 rounded">Acertos: <span id="sort-score">0</span></span>
        </div>

        <div class="relative w-full h-40 flex items-center justify-center mb-6">
            
            <div class="absolute left-0 top-0 bottom-0 w-1/4 border-2 border-dashed border-green-200 rounded-xl flex items-center justify-center bg-green-50 opacity-50">
                <span class="text-green-300 font-black -rotate-90 uppercase text-xs tracking-widest">Exata</span>
            </div>
            <div class="absolute right-0 top-0 bottom-0 w-1/4 border-2 border-dashed border-orange-200 rounded-xl flex items-center justify-center bg-orange-50 opacity-50">
                <span class="text-orange-300 font-black rotate-90 uppercase text-xs tracking-widest">N√£o Exata</span>
            </div>

            <div id="math-card" class="w-40 h-28 bg-white border-b-4 border-gray-300 rounded-2xl flex items-center justify-center text-3xl font-black text-gray-700 shadow-lg transform transition-all duration-300 z-10 relative">
                ...
            </div>
            
            <div id="sort-feedback" class="absolute z-20 text-6xl opacity-0 transition-all duration-300 scale-0"></div>

        </div>

        <div class="flex gap-4 w-full max-w-xs z-30">
            <button id="btn-exact" class="flex-1 h-14 rounded-xl bg-green-100 border-b-4 border-green-300 text-green-700 font-bold shadow-sm active:border-b-0 active:translate-y-1 transition-all">
                EXATA
            </button>
            <button id="btn-non" class="flex-1 h-14 rounded-xl bg-orange-100 border-b-4 border-orange-300 text-orange-700 font-bold shadow-sm active:border-b-0 active:translate-y-1 transition-all">
                N√ÉO EXATA
            </button>
        </div>

        <div id="end-msg" class="hidden absolute inset-0 bg-white flex-col items-center justify-center z-40">
            <div class="text-6xl mb-4">üèÅ</div>
            <h3 class="text-xl font-black text-brand-text mb-2">Fim de Jogo!</h3>
            <p class="text-gray-500 mb-4">Voc√™ acertou <span id="final-score">0</span> de ${problems.length}</p>
            <button id="btn-restart" class="bg-brand-blue text-white font-bold py-2 px-6 rounded-lg shadow-btn active:scale-95">Jogar Novamente</button>
        </div>

    </div>
    `;

                    const card = container.querySelector("#math-card");
                    const scoreEl = container.querySelector("#sort-score");
                    const feedback = container.querySelector("#sort-feedback");
                    const endScreen = container.querySelector("#end-msg");
                    const finalScore = container.querySelector("#final-score");

                    const loadCard = () => {
                        if (currentIdx >= shuffled.length) {
                            finalScore.innerText = score;
                            endScreen.classList.remove("hidden");
                            endScreen.classList.add("flex");
                            return;
                        }

                        const p = shuffled[currentIdx];
                        card.innerText = p.q;
                        // Reset posi√ß√£o
                        card.style.transform = "translate(0, 0) rotate(0deg)";
                        card.className =
                            "w-40 h-28 bg-white border-b-4 border-gray-300 rounded-2xl flex items-center justify-center text-3xl font-black text-gray-700 shadow-lg transition-all duration-300 z-10 relative animate-pop-in";
                    };

                    const handleChoice = (choice) => {
                        // 'exata' ou 'nao-exata'
                        const correctType = shuffled[currentIdx].type;
                        const isCorrect = choice === correctType;

                        // Anima√ß√£o do Cart√£o
                        const xDir = choice === "exata" ? -150 : 150;
                        const rotate = choice === "exata" ? -15 : 15;
                        card.style.transform = `translate(${xDir}px, 20px) rotate(${rotate}deg)`;
                        card.style.opacity = "0";

                        if (isCorrect) {
                            score++;
                            scoreEl.innerText = score;
                            feedback.innerHTML = "‚úÖ";
                            feedback.className =
                                "absolute z-20 text-6xl text-green-500 opacity-100 scale-100 transition-all duration-300";
                        } else {
                            feedback.innerHTML = "‚ùå";
                            feedback.className =
                                "absolute z-20 text-6xl text-red-500 opacity-100 scale-100 transition-all duration-300";
                        }

                        setTimeout(() => {
                            feedback.classList.remove("opacity-100", "scale-100");
                            feedback.classList.add("opacity-0", "scale-0");
                            currentIdx++;
                            loadCard();
                        }, 400);
                    };

                    container.querySelector("#btn-exact").onclick = () =>
                        handleChoice("exata");
                    container.querySelector("#btn-non").onclick = () =>
                        handleChoice("nao-exata");

                    container.querySelector("#btn-restart").onclick = () => {
                        currentIdx = 0;
                        score = 0;
                        scoreEl.innerText = 0;
                        shuffled = [...problems].sort(() => Math.random() - 0.5);
                        endScreen.classList.add("hidden");
                        endScreen.classList.remove("flex");
                        loadCard();
                    };

                    loadCard();
                },

                interactive_decimal_jump(container) {
                    // Estado inicial
                    let currentNum = 1234;
                    let divisor = 10; // 10, 100, 1000

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Laborat√≥rio de Pulos</h3>

        <div class="relative h-24 w-full flex items-center justify-center bg-gray-50 rounded-xl border border-gray-200 mb-6 overflow-hidden">
            <div id="number-container" class="flex items-end font-mono text-4xl md:text-5xl font-bold text-gray-700 transition-all duration-500 relative">
                </div>
        </div>

        <div class="flex gap-2 w-full max-w-sm mb-4">
            <button class="div-btn flex-1 py-3 rounded-xl border-2 font-bold text-sm transition-all bg-blue-100 border-blue-300 text-blue-700 shadow-sm" data-d="10">√∑ 10</button>
            <button class="div-btn flex-1 py-3 rounded-xl border-2 font-bold text-sm transition-all bg-white border-gray-200 text-gray-500 hover:bg-gray-50" data-d="100">√∑ 100</button>
            <button class="div-btn flex-1 py-3 rounded-xl border-2 font-bold text-sm transition-all bg-white border-gray-200 text-gray-500 hover:bg-gray-50" data-d="1000">√∑ 1000</button>
        </div>

        <div class="flex items-center gap-4 w-full max-w-sm">
             <input type="number" id="input-num" value="1234" class="w-24 text-center border-2 border-gray-300 rounded-lg p-2 font-bold text-lg outline-none focus:border-brand-blue text-gray-600">
             <button id="btn-animate" class="flex-1 bg-brand-green text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all">
                PULAR! üê∏
             </button>
        </div>

    </div>
    `;

                    const numContainer = container.querySelector("#number-container");
                    const inputNum = container.querySelector("#input-num");
                    const btnAnim = container.querySelector("#btn-animate");
                    const divBtns = container.querySelectorAll(".div-btn");

                    // Renderiza o n√∫mero com a v√≠rgula como elemento separado
                    const renderNumber = (val, hasComma = false) => {
                        const str = val.toString();
                        // Se n√£o tem v√≠rgula explicita, ela est√° no final (invis√≠vel ou ghost)
                        const parts = str.split(".");
                        const intPart = parts[0];
                        const decPart = parts[1] || "";

                        let html = "";

                        // Zeros √† esquerda para anima√ß√£o se necess√°rio (padding)
                        // Vamos simplificar: renderizar d√≠gitos

                        for (let char of intPart) {
                            html += `<span class="digit inline-block w-6 text-center">${char}</span>`;
                        }

                        // A V√≠rgula
                        // Se j√° tem decimal, renderiza fixa. Se n√£o, renderiza a "ghost" no final
                        if (parts.length > 1) {
                            html += `<span id="comma" class="text-brand-red font-black inline-block w-4 text-center transform transition-transform duration-700 z-10">,</span>`;
                            for (let char of decPart) {
                                html += `<span class="digit inline-block w-6 text-center">${char}</span>`;
                            }
                        } else {
                            html += `<span id="comma" class="text-brand-red font-black inline-block w-4 text-center transform transition-transform duration-700 z-10 opacity-50">,</span>`;
                            // Zero fantasma para pular
                            html += `<span class="digit inline-block w-6 text-center opacity-0 transition-opacity" id="ghost-zero">0</span>`;
                        }

                        numContainer.innerHTML = html;
                    };

                    const animateJump = () => {
                        const val = parseFloat(inputNum.value);
                        if (isNaN(val)) return;

                        // 1. Prepara visual inicial
                        // Garante zeros √† esquerda suficientes
                        let str = inputNum.value;
                        const zeros = divisor === 1000 ? 3 : divisor === 100 ? 2 : 1;

                        // Adiciona zeros visuais se o n√∫mero for pequeno (ex: 5 / 1000 -> 0005)
                        // Isso √© complexo de animar perfeitamente com DOM simples, vamos usar uma abordagem de "resultado final" com delay

                        // Estrat√©gia Visual Simplificada:
                        // 1. Mostra n√∫mero original
                        renderNumber(val);

                        const comma = container.querySelector("#comma");
                        const ghostZero = container.querySelector("#ghost-zero");

                        // Bloqueia bot√£o
                        btnAnim.disabled = true;
                        btnAnim.classList.add("opacity-50");

                        // 2. Anima√ß√£o da v√≠rgula andando para a esquerda
                        // Simulamos com translateX. Cada d√≠gito tem aprox 24px (w-6)
                        const jumpSize = 24 * zeros;

                        // Se precisar de zeros √† esquerda, mostra eles antes
                        if (val < Math.pow(10, zeros)) {
                            // Ex: 5 / 1000. Precisa virar 0,005.
                            // Adicionamos zeros no HTML antes
                            const neededZeros = zeros - str.length + 1; // Simplificado
                            // Essa parte √© chata. Vamos focar no movimento da v√≠rgula.
                        }

                        setTimeout(() => {
                            comma.classList.add("scale-150", "-translate-y-2"); // Pula pra cima
                            comma.classList.remove("opacity-50"); // Fica s√≥lida

                            setTimeout(() => {
                                comma.style.transform = `translate(-${jumpSize}px, 0) scale(1.5)`; // Anda

                                setTimeout(() => {
                                    comma.classList.remove("scale-150"); // Aterra

                                    // 3. Mostra o resultado final matem√°tico limpo
                                    setTimeout(() => {
                                        const res = val / divisor;
                                        // Formata para string com v√≠rgula (BR)
                                        const resString = res.toString().replace(".", ",");

                                        numContainer.innerHTML = `<span class="text-brand-green font-black animate-pop-in">${resString}</span>`;

                                        btnAnim.disabled = false;
                                        btnAnim.classList.remove("opacity-50");
                                    }, 500);
                                }, 500);
                            }, 300);
                        }, 100);
                    };

                    // Listeners
                    divBtns.forEach((btn) => {
                        btn.onclick = () => {
                            // Toggle active state
                            divBtns.forEach((b) => {
                                b.className =
                                    "div-btn flex-1 py-3 rounded-xl border-2 font-bold text-sm transition-all bg-white border-gray-200 text-gray-500 hover:bg-gray-50";
                            });
                            btn.className =
                                "div-btn flex-1 py-3 rounded-xl border-2 font-bold text-sm transition-all bg-blue-100 border-blue-300 text-blue-700 shadow-sm";
                            divisor = parseInt(btn.dataset.d);

                            // Reset display
                            renderNumber(inputNum.value);
                        };
                    });

                    inputNum.addEventListener("input", () =>
                        renderNumber(inputNum.value)
                    );
                    btnAnim.onclick = animateJump;

                    // Init
                    renderNumber(1234);
                },

                interactive_zero_hero(container) {
                    // Estado do Jogo
                    let score = 0;
                    let isPlaying = false;
                    let dropInterval;
                    let speed = 2000; // ms por queda

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[400px]">
        
        <div class="flex justify-between w-full items-center mb-2 z-20">
            <div class="bg-gray-800 text-white px-3 py-1 rounded-full text-xs font-bold border border-gray-600">
                ü¶∏‚Äç‚ôÇÔ∏è Zero Hero
            </div>
            <div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black shadow-sm">
                Score: <span id="hero-score">0</span>
            </div>
        </div>

        <div class="relative w-full flex-1 border-b-4 border-brand-green/50" id="game-zone">
            <div class="absolute bottom-0 w-full h-1 bg-green-500 shadow-[0_0_10px_#22c55e]"></div>
        </div>

        <div class="grid grid-cols-3 gap-2 w-full mt-4 z-20">
            <button class="hero-btn bg-blue-600 border-b-4 border-blue-800 text-white font-bold py-3 rounded-xl active:translate-y-1 active:border-b-0 transition-all text-sm" data-ans="10">√∑ 10</button>
            <button class="hero-btn bg-purple-600 border-b-4 border-purple-800 text-white font-bold py-3 rounded-xl active:translate-y-1 active:border-b-0 transition-all text-sm" data-ans="100">√∑ 100</button>
            <button class="hero-btn bg-orange-600 border-b-4 border-orange-800 text-white font-bold py-3 rounded-xl active:translate-y-1 active:border-b-0 transition-all text-sm" data-ans="1000">√∑ 1000</button>
        </div>

        <div id="hero-overlay" class="absolute inset-0 bg-gray-900/90 z-30 flex flex-col items-center justify-center text-center p-6">
            <div class="text-6xl mb-4">‚òÑÔ∏è</div>
            <h3 class="text-white font-black text-2xl mb-2" id="overlay-title">Divis√£o R√°pida!</h3>
            <p class="text-gray-400 text-sm mb-6">N√∫meros v√£o cair. Escolha por quanto dividir para chegar no resultado mostrado.</p>
            <button id="btn-start-hero" class="bg-brand-green text-white font-bold py-3 px-8 rounded-full shadow-[0_0_20px_rgba(88,204,2,0.5)] animate-pulse">JOGAR</button>
        </div>

    </div>
    `;

                    const gameZone = container.querySelector("#game-zone");
                    const scoreEl = container.querySelector("#hero-score");
                    const overlay = container.querySelector("#hero-overlay");
                    const startBtn = container.querySelector("#btn-start-hero");
                    const title = container.querySelector("#overlay-title");
                    const btns = container.querySelectorAll(".hero-btn");

                    let currentEnemy = null; // { el: DOMElement, correctDiv: 10/100/1000 }

                    const spawnEnemy = () => {
                        if (!isPlaying) return;

                        // Gera problema
                        // Ex: 500 -> Resposta 50 (Div por 10)
                        // Ex: 500 -> Resposta 5 (Div por 100)
                        const base = Math.floor(Math.random() * 100) + 1; // 1 a 100
                        const divs = [10, 100, 1000];
                        const correctDiv = divs[Math.floor(Math.random() * divs.length)];

                        // O n√∫mero que cai √© o RESULTADO da multiplica√ß√£o para garantir divis√£o exata (ou decimal simples)
                        // Vamos fazer o contr√°rio: mostramos a Pergunta (Ex: 5000) e o Alvo (Ex: 50). O usu√°rio clica em √∑100.
                        const numToDisplay = base * correctDiv;
                        const targetRes = base;

                        const enemy = document.createElement("div");
                        enemy.className =
                            "absolute left-1/2 -translate-x-1/2 bg-white text-gray-900 px-4 py-2 rounded-lg font-bold border-2 border-red-500 shadow-lg text-lg flex flex-col items-center gap-1 animate-fall";
                        // Animate-fall ser√° definido no CSS inline
                        enemy.style.top = "-50px";
                        enemy.innerHTML = `
            <span>${numToDisplay}</span>
            <span class="text-xs text-gray-500">Meta: <strong>${targetRes}</strong></span>
        `;

                        gameZone.appendChild(enemy);

                        currentEnemy = { el: enemy, div: correctDiv };

                        // Anima√ß√£o manual com requestAnimationFrame para controle de colis√£o
                        let pos = -50;
                        const limit = 280; // Altura aproximada da zona

                        const fall = () => {
                            if (!isPlaying || !currentEnemy || currentEnemy.el !== enemy)
                                return;

                            pos += 1.5 + score * 0.1; // Acelera com o tempo
                            enemy.style.top = `${pos}px`;

                            if (pos > limit) {
                                gameOver();
                            } else {
                                requestAnimationFrame(fall);
                            }
                        };
                        requestAnimationFrame(fall);
                    };

                    const check = (val) => {
                        if (!currentEnemy) return;

                        if (val === currentEnemy.div) {
                            // Acerto
                            score += 10;
                            scoreEl.innerText = score;

                            // Efeito visual
                            currentEnemy.el.className =
                                "absolute left-1/2 -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded-lg font-bold border-2 border-green-300 shadow-lg text-lg flex flex-col items-center gap-1 scale-125 transition-transform";
                            currentEnemy.el.innerHTML = "‚úÖ";

                            const oldEnemy = currentEnemy.el;
                            currentEnemy = null; // Limpa ref

                            setTimeout(() => oldEnemy.remove(), 200);
                            setTimeout(spawnEnemy, 500);
                        } else {
                            // Erro (Penalidade ou Game Over?)
                            // Vamos fazer vibrar e perder ponto
                            score = Math.max(0, score - 5);
                            scoreEl.innerText = score;
                            currentEnemy.el.classList.add("animate-shake");
                            setTimeout(
                                () => currentEnemy.el?.classList.remove("animate-shake"),
                                300
                            );
                        }
                    };

                    const gameOver = () => {
                        isPlaying = false;
                        if (currentEnemy && currentEnemy.el) currentEnemy.el.remove();
                        currentEnemy = null;

                        title.innerText = `Fim de Jogo! Score: ${score}`;
                        startBtn.innerText = "Tentar de Novo";
                        overlay.classList.remove("hidden");
                    };

                    const startGame = () => {
                        score = 0;
                        scoreEl.innerText = 0;
                        isPlaying = true;
                        overlay.classList.add("hidden");
                        spawnEnemy();
                    };

                    startBtn.onclick = startGame;

                    btns.forEach((btn) => {
                        btn.onclick = () => check(parseInt(btn.dataset.ans));
                    });

                    // CSS Inline para anima√ß√µes espec√≠ficas
                    if (!document.getElementById("hero-styles")) {
                        const s = document.createElement("style");
                        s.id = "hero-styles";
                        s.innerHTML = `
            @keyframes fall { from { top: -50px; } to { top: 300px; } }
            /* Nota: A anima√ß√£o de queda √© feita via JS para detectar colis√£o, 
               mas classes auxiliares ajudam */
        `;
                        container.appendChild(s);
                    }
                },

                interactive_expression_collapse(container) {
                    // Configura√ß√£o dos N√≠veis
                    const levels = [
                        {
                            expr: [
                                { val: "2", type: "num" },
                                { val: "+", type: "op", level: 1 },
                                { val: "3", type: "num" },
                                { val: "√ó", type: "op", level: 2, id: 1 }, // Alvo
                                { val: "4", type: "num" },
                            ],
                            hint: "Quem manda mais? Mais (+) ou Vezes (√ó)?",
                            correctId: 1,
                            nextExpr: "2 + 12",
                            final: "14",
                        },
                        {
                            expr: [
                                { val: "(", type: "group" },
                                { val: "10", type: "num" },
                                { val: "-", type: "op", level: 1, id: 2 }, // Alvo (Parenteses)
                                { val: "2", type: "num" },
                                { val: ")", type: "group" },
                                { val: "√∑", type: "op", level: 2 },
                                { val: "4", type: "num" },
                            ],
                            hint: "Resolva o escudo (par√™nteses) primeiro!",
                            correctId: 2,
                            nextExpr: "8 √∑ 4",
                            final: "2",
                        },
                        {
                            expr: [
                                { val: "5", type: "num" },
                                { val: "√ó", type: "op", level: 2 },
                                { val: "[", type: "group" },
                                { val: "3", type: "num" },
                                { val: "+", type: "op", level: 1, id: 3 }, // Alvo (Dentro do colchete)
                                { val: "2", type: "num" },
                                { val: "]", type: "group" },
                            ],
                            hint: "Resolva de dentro para fora.",
                            correctId: 3,
                            nextExpr: "5 √ó 5",
                            final: "25",
                        },
                    ];

                    let currentLvl = 0;
                    let state = "start"; // start, solved

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden min-h-[250px]">
        
        <div class="flex justify-between w-full items-center mb-6 border-b-2 border-gray-100 pb-2">
            <h3 class="text-brand-blue font-black uppercase text-xs tracking-widest"><i class="fas fa-layer-group"></i> Onde eu clico?</h3>
            <div class="text-xs font-bold text-gray-400">N√≠vel <span id="lvl-num">1</span>/${levels.length}</div>
        </div>

        <div class="flex flex-col items-center justify-center flex-1 w-full gap-4">
            
            <div id="expression-container" class="flex gap-2 text-2xl md:text-4xl font-mono font-bold text-brand-text flex-wrap justify-center items-center p-4 bg-gray-50 rounded-xl border border-gray-200 transition-all duration-300">
                </div>

            <p id="hint-text" class="text-sm text-gray-500 italic h-6 text-center"></p>

        </div>

        <button id="btn-next-lvl" class="mt-6 bg-brand-green text-white font-bold py-3 px-8 rounded-xl shadow-btn active:scale-95 transition-all hidden">
            Pr√≥ximo <i class="fas fa-arrow-right"></i>
        </button>

    </div>
    `;

                    const exprContainer = container.querySelector(
                        "#expression-container"
                    );
                    const hintText = container.querySelector("#hint-text");
                    const lvlNum = container.querySelector("#lvl-num");
                    const btnNext = container.querySelector("#btn-next-lvl");

                    const renderLevel = () => {
                        if (currentLvl >= levels.length) {
                            exprContainer.innerHTML =
                                "<div class='text-brand-green'>üéâ Fim do Treino!</div>";
                            hintText.innerText = "";
                            btnNext.classList.add("hidden");
                            return;
                        }

                        const lvl = levels[currentLvl];
                        lvlNum.innerText = currentLvl + 1;
                        hintText.innerText = lvl.hint;
                        hintText.className =
                            "text-sm text-gray-500 italic h-6 text-center";
                        btnNext.classList.add("hidden");
                        exprContainer.className =
                            "flex gap-2 text-2xl md:text-4xl font-mono font-bold text-brand-text flex-wrap justify-center items-center p-4 bg-gray-50 rounded-xl border border-gray-200 transition-all duration-300";

                        // Renderiza partes
                        exprContainer.innerHTML = "";

                        lvl.expr.forEach((part, idx) => {
                            const el = document.createElement("div");
                            el.innerText = part.val;

                            if (part.type === "op") {
                                el.className =
                                    "cursor-pointer p-2 rounded-lg hover:bg-blue-100 hover:text-brand-blue transition-colors";
                                el.onclick = () => check(part.id, el, idx);
                            } else if (part.type === "group") {
                                el.className = "text-brand-purple";
                            } else {
                                el.className = "";
                            }
                            exprContainer.appendChild(el);
                        });
                    };

                    const check = (id, el, idx) => {
                        const lvl = levels[currentLvl];

                        if (id === lvl.correctId) {
                            // ACERTOU
                            // Efeito visual de colapso
                            el.className =
                                "bg-brand-green text-white p-2 rounded-lg scale-125 transition-transform";
                            hintText.innerHTML =
                                "<span class='text-brand-green font-bold'><i class='fas fa-check'></i> Isso a√≠! Resolvendo...</span>";

                            setTimeout(() => {
                                // Troca a express√£o
                                exprContainer.innerHTML = `<div class="animate-pop-in text-brand-blue">${lvl.nextExpr}</div> <div class="text-gray-300">=</div> <div class="animate-pop-in font-black text-brand-green">${lvl.final}</div>`;
                                exprContainer.classList.add(
                                    "border-brand-green",
                                    "bg-green-50"
                                );
                                btnNext.classList.remove("hidden");
                            }, 600);
                        } else {
                            // ERROU
                            el.classList.add(
                                "bg-red-100",
                                "text-brand-red",
                                "animate-shake"
                            );
                            hintText.innerHTML =
                                "<span class='text-brand-red font-bold'>Ainda n√£o!</span> Respeite a hierarquia.";
                            setTimeout(() => {
                                el.classList.remove(
                                    "bg-red-100",
                                    "text-brand-red",
                                    "animate-shake"
                                );
                            }, 500);
                        }
                    };

                    btnNext.onclick = () => {
                        currentLvl++;
                        renderLevel();
                    };

                    renderLevel();
                },

                interactive_bomb_defuse(container) {
                    // Configura√ß√£o do Desafio
                    const bombData = {
                        exprDisplay: "5 + 2 √ó { 8 - [ 4 + 2 ] }",
                        wires: [
                            {
                                id: 1,
                                label: "5 + 2",
                                correct: false,
                                reason: "A adi√ß√£o √© a √∫ltima!",
                            },
                            {
                                id: 2,
                                label: "8 - 4",
                                correct: false,
                                reason: "Tem um colchete protegendo o 4!",
                            },
                            { id: 3, label: "4 + 2", correct: true, reason: "" }, // Colchete interno
                            {
                                id: 4,
                                label: "2 √ó 8",
                                correct: false,
                                reason: "Resolva as chaves primeiro.",
                            },
                        ],
                        time: 15,
                    };

                    let timer = null;
                    let timeLeft = bombData.time;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-2xl font-sans select-none relative overflow-hidden text-white">
        
        <div class="absolute top-4 right-4 bg-black border-2 border-red-900 px-3 py-1 rounded font-mono text-brand-red font-black text-xl animate-pulse" id="bomb-timer">00:${timeLeft}</div>
        
        <h3 class="text-gray-400 font-black uppercase text-xs tracking-widest mb-6 self-start flex gap-2 items-center"><i class="fas fa-bomb"></i> Desarme a Bomba</h3>

        <div class="w-full bg-black border-4 border-gray-600 rounded-lg p-4 mb-8 text-center shadow-[0_0_15px_rgba(0,0,0,0.8)] relative">
            <div class="text-green-500 font-mono text-xl md:text-2xl font-bold tracking-wider" id="bomb-screen">
                ${bombData.exprDisplay}
            </div>
            <div class="absolute inset-0 bg-green-500 opacity-5 pointer-events-none animate-pulse"></div>
        </div>

        <p class="text-sm text-gray-400 mb-4 font-bold uppercase">Corte o fio da PRIMEIRA opera√ß√£o:</p>

        <div class="grid grid-cols-2 gap-4 w-full" id="wires-container">
            ${bombData.wires
                            .map(
                                (w) => `
                <button class="wire-btn relative bg-gray-800 border-l-8 rounded-r-lg p-3 hover:bg-gray-700 transition-all group flex items-center gap-3 overflow-hidden active:scale-95" data-id="${w.id
                                    }">
                    <div class="absolute left-0 top-0 bottom-0 w-2 ${[
                                        "bg-red-500",
                                        "bg-blue-500",
                                        "bg-yellow-500",
                                        "bg-green-500",
                                    ][w.id - 1]
                                    }"></div>
                    <i class="fas fa-cut text-gray-500 group-hover:text-white transition-colors"></i>
                    <span class="font-mono font-bold text-lg">${w.label}</span>
                </button>
            `
                            )
                            .join("")}
        </div>

        <div id="bomb-overlay" class="absolute inset-0 bg-gray-900/95 hidden flex-col items-center justify-center text-center p-6 z-20">
            <div class="text-6xl mb-4" id="bo-icon"></div>
            <h3 class="text-3xl font-black text-white mb-2" id="bo-title"></h3>
            <p class="text-gray-400 text-sm mb-6" id="bo-msg"></p>
            <button id="btn-restart-bomb" class="bg-gray-700 border border-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition-all">Tentar Novamente</button>
        </div>

    </div>
    `;

                    const timerEl = container.querySelector("#bomb-timer");
                    const overlay = container.querySelector("#bomb-overlay");
                    const boIcon = container.querySelector("#bo-icon");
                    const boTitle = container.querySelector("#bo-title");
                    const boMsg = container.querySelector("#bo-msg");
                    const wires = container.querySelectorAll(".wire-btn");
                    const btnRestart = container.querySelector("#btn-restart-bomb");

                    const stopGame = (win, msg = "") => {
                        clearInterval(timer);
                        overlay.classList.remove("hidden");
                        overlay.classList.add("flex", "animate-fade-in");

                        if (win) {
                            boIcon.innerText = "‚úÇÔ∏èüòé";
                            boTitle.innerText = "Bomba Desarmada!";
                            boTitle.className = "text-3xl font-black text-green-500 mb-2";
                            boMsg.innerText =
                                "Voc√™ cortou o fio correto (4+2) que estava nos colchetes internos.";
                        } else {
                            boIcon.innerText = "üí•";
                            boTitle.innerText = "EXPLODIU!";
                            boTitle.className =
                                "text-3xl font-black text-red-600 mb-2 animate-shake";
                            boMsg.innerText = msg || "O tempo acabou!";
                        }
                    };

                    const startGame = () => {
                        timeLeft = bombData.time;
                        timerEl.innerText = `00:${timeLeft}`;
                        overlay.classList.add("hidden");
                        overlay.classList.remove("flex");

                        // Reset wires
                        wires.forEach((w) => {
                            w.disabled = false;
                            w.classList.remove("opacity-50");
                        });

                        clearInterval(timer);
                        timer = setInterval(() => {
                            timeLeft--;
                            timerEl.innerText = `00:${timeLeft < 10 ? "0" + timeLeft : timeLeft
                                }`;
                            if (timeLeft <= 5) timerEl.classList.add("text-red-500");

                            if (timeLeft <= 0) {
                                stopGame(false);
                            }
                        }, 1000);
                    };

                    wires.forEach((w) => {
                        w.onclick = () => {
                            const id = parseInt(w.dataset.id);
                            const wireData = bombData.wires.find((x) => x.id === id);

                            if (wireData.correct) {
                                stopGame(true);
                            } else {
                                stopGame(false, `Erro! ${wireData.reason}`);
                            }
                        };
                    });

                    btnRestart.onclick = startGame;

                    startGame();
                },

                interactive_square_concept(container) {
                    let side = 3;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Visualizador de Pot√™ncia</h3>

        <div class="flex flex-col md:flex-row items-center gap-8 w-full justify-center mb-6">
            
            <div class="flex flex-col items-center bg-gray-50 p-4 rounded-xl border border-gray-200 min-w-[120px]">
                <span class="text-[10px] font-bold text-gray-400 uppercase mb-2">Aritm√©tica</span>
                <div class="text-4xl font-mono font-black text-brand-text mb-2">
                    <span id="alg-base" class="text-brand-blue">3</span><sup class="text-brand-orange">2</sup>
                </div>
                <div class="text-sm font-bold text-gray-500">
                    <span id="alg-expand">3 √ó 3</span> = <span id="alg-res" class="text-brand-green text-xl">9</span>
                </div>
            </div>

            <div class="flex flex-col items-center">
                <span class="text-[10px] font-bold text-gray-400 uppercase mb-2">Geometria</span>
                <div id="grid-container" class="bg-blue-50 border-2 border-brand-blue rounded-lg transition-all duration-300 grid gap-0.5 p-0.5 shadow-inner" style="grid-template-columns: repeat(3, 1fr);">
                    </div>
                <div class="flex justify-between w-full mt-2 text-xs font-bold text-brand-blue px-1">
                    <span id="geo-side-w">3 u</span>
                    <span id="geo-side-h">3 u</span>
                </div>
            </div>

        </div>

        <div class="w-full max-w-xs">
            <div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-2">
                <span>Lado do Quadrado</span>
                <span id="slider-val" class="text-brand-blue text-lg">3</span>
            </div>
            <input type="range" id="side-slider" min="1" max="10" value="3" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue hover:accent-brand-blueDark">
            <div class="flex justify-between text-[10px] text-gray-300 font-bold mt-1">
                <span>1</span><span>5</span><span>10</span>
            </div>
        </div>

    </div>
    `;

                    const slider = container.querySelector("#side-slider");
                    const sliderVal = container.querySelector("#slider-val");
                    const algBase = container.querySelector("#alg-base");
                    const algExpand = container.querySelector("#alg-expand");
                    const algRes = container.querySelector("#alg-res");
                    const grid = container.querySelector("#grid-container");
                    const geoW = container.querySelector("#geo-side-w");
                    const geoH = container.querySelector("#geo-side-h");

                    const update = () => {
                        side = parseInt(slider.value);
                        const area = side * side;

                        // Atualiza √Ålgebra
                        sliderVal.innerText = side;
                        algBase.innerText = side;
                        algExpand.innerText = `${side} √ó ${side}`;
                        algRes.innerText = area;

                        // Atualiza Geometria
                        geoW.innerText = `${side} u`;
                        geoH.innerText = `${side} u`;

                        // Atualiza Grid
                        grid.style.gridTemplateColumns = `repeat(${side}, 1fr)`;
                        grid.innerHTML = "";

                        // Tamanho din√¢mico dos blocos para n√£o estourar o container
                        // Base: 200px m√°x width
                        const blockSize = Math.max(15, Math.min(40, 180 / side));

                        for (let i = 0; i < area; i++) {
                            const block = document.createElement("div");
                            block.style.width = `${blockSize}px`;
                            block.style.height = `${blockSize}px`;
                            block.className =
                                "bg-brand-blue rounded-[2px] opacity-0 animate-pop-in";
                            block.style.animationDelay = `${i * 0.02}s`; // Efeito cascata r√°pido
                            grid.appendChild(block);
                        }
                    };

                    slider.oninput = update;
                    update();
                },

                interactive_square_defense(container) {
                    // Configura√ß√£o
                    let score = 0;
                    let lives = 3;
                    let isPlaying = false;
                    let spawnInterval;
                    let gameLoop;
                    let enemies = []; // { el, y, speed, side, area }

                    // N√≠veis de dificuldade (Areas)
                    const possibleSides = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]; // 1, 4, 9, 16, 25, 36, 49, 64, 81, 100

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[400px]">
        
        <div class="absolute top-0 left-0 w-full p-4 flex justify-between items-start z-20 pointer-events-none">
            <div class="bg-gray-800/80 px-3 py-1 rounded-full text-white text-xs font-bold border border-gray-600">
                Score: <span class="text-brand-yellow" id="game-score">0</span>
            </div>
            <div class="flex gap-1" id="lives-container">
                <span class="text-red-500">‚ù§Ô∏è</span><span class="text-red-500">‚ù§Ô∏è</span><span class="text-red-500">‚ù§Ô∏è</span>
            </div>
        </div>

        <div id="game-area" class="absolute inset-0 z-10 overflow-hidden">
            </div>

        <div class="absolute bottom-0 left-0 w-full p-2 bg-gray-800 border-t-2 border-gray-600 z-30 flex flex-wrap justify-center gap-2">
            ${possibleSides
                            .map(
                                (s) => `
                <button class="fire-btn w-10 h-10 md:w-12 md:h-12 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-lg border-b-4 border-gray-900 active:border-b-0 active:translate-y-1 transition-all shadow-lg" data-side="${s}">
                    ${s}
                </button>
            `
                            )
                            .join("")}
        </div>

        <div id="overlay" class="absolute inset-0 bg-gray-900/90 z-40 flex flex-col items-center justify-center text-center p-6">
            <div class="text-5xl mb-4">üõ°Ô∏è</div>
            <h3 class="text-white font-black text-2xl mb-2" id="overlay-title">Defesa Quadrada</h3>
            <p class="text-gray-400 text-sm mb-6 max-w-xs" id="overlay-msg">Blocos com a √ÅREA cair√£o (Ex: 49). Clique no n√∫mero do LADO (Ex: 7) para destruir!</p>
            <button id="btn-start" class="bg-brand-green text-white font-bold py-3 px-8 rounded-full shadow-[0_0_20px_rgba(88,204,2,0.5)] animate-pulse hover:scale-105 transition-transform">
                JOGAR
            </button>
        </div>

    </div>
    `;

                    const gameArea = container.querySelector("#game-area");
                    const scoreEl = container.querySelector("#game-score");
                    const livesContainer = container.querySelector("#lives-container");
                    const overlay = container.querySelector("#overlay");
                    const title = container.querySelector("#overlay-title");
                    const msg = container.querySelector("#overlay-msg");
                    const btnStart = container.querySelector("#btn-start");
                    const fireBtns = container.querySelectorAll(".fire-btn");

                    // Fun√ß√µes do Jogo
                    const spawnEnemy = () => {
                        if (!isPlaying) return;

                        const side =
                            possibleSides[Math.floor(Math.random() * possibleSides.length)];
                        const area = side * side;
                        const speed = 1 + score / 500; // Acelera com o tempo

                        const el = document.createElement("div");
                        // Posi√ß√£o X aleat√≥ria (limites 10% a 80%)
                        const left = 10 + Math.random() * 70;

                        el.className =
                            "absolute flex items-center justify-center bg-white border-2 border-brand-red text-brand-red font-black text-lg rounded shadow-lg animate-pop-in";
                        el.style.width = "50px";
                        el.style.height = "50px";
                        el.style.left = `${left}%`;
                        el.style.top = "-60px";
                        el.innerText = area;

                        gameArea.appendChild(el);

                        enemies.push({ el, y: -60, speed, side });
                    };

                    const updateGame = () => {
                        if (!isPlaying) return;

                        // Move inimigos
                        enemies.forEach((enemy, index) => {
                            enemy.y += enemy.speed;
                            enemy.el.style.top = `${enemy.y}px`;

                            // Colis√£o com o ch√£o (Game Over zone ~320px)
                            if (enemy.y > 320) {
                                takeDamage();
                                removeEnemy(index);
                            }
                        });

                        requestAnimationFrame(updateGame);
                    };

                    const removeEnemy = (index) => {
                        const enemy = enemies[index];
                        if (enemy && enemy.el.parentNode) {
                            enemy.el.remove();
                        }
                        enemies.splice(index, 1);
                    };

                    const takeDamage = () => {
                        lives--;
                        updateLives();
                        // Flash vermelho na tela
                        gameArea.classList.add("bg-red-500/20");
                        setTimeout(() => gameArea.classList.remove("bg-red-500/20"), 100);

                        if (lives <= 0) {
                            endGame();
                        }
                    };

                    const updateLives = () => {
                        livesContainer.innerHTML = "";
                        for (let i = 0; i < 3; i++) {
                            if (i < lives)
                                livesContainer.innerHTML +=
                                    '<span class="text-red-500">‚ù§Ô∏è</span>';
                            else
                                livesContainer.innerHTML +=
                                    '<span class="text-gray-600">üíî</span>';
                        }
                    };

                    const shoot = (side) => {
                        if (!isPlaying) return;

                        // Procura inimigo com esse lado
                        // Prioriza o que estiver mais baixo (maior Y)
                        const targetIndex = enemies.findIndex((e) => e.side === side);

                        if (targetIndex !== -1) {
                            // Acertou!
                            const enemy = enemies[targetIndex];

                            // Efeito visual de explos√£o
                            enemy.el.classList.add(
                                "scale-150",
                                "opacity-0",
                                "bg-green-400",
                                "border-green-600",
                                "text-white"
                            );

                            setTimeout(() => removeEnemy(targetIndex), 200); // Remove ap√≥s anim

                            score += 10;
                            scoreEl.innerText = score;
                        } else {
                            // Errou (Penalidade opcional, por enquanto s√≥ visual)
                            scoreEl.classList.add("text-red-500");
                            setTimeout(() => scoreEl.classList.remove("text-red-500"), 200);
                        }
                    };

                    const startGame = () => {
                        score = 0;
                        lives = 3;
                        scoreEl.innerText = 0;
                        updateLives();
                        enemies.forEach((e) => e.el.remove());
                        enemies = [];
                        isPlaying = true;
                        overlay.classList.add("hidden");

                        gameLoop = requestAnimationFrame(updateGame);
                        spawnInterval = setInterval(spawnEnemy, 2000); // A cada 2s
                    };

                    const endGame = () => {
                        isPlaying = false;
                        clearInterval(spawnInterval);
                        cancelAnimationFrame(gameLoop);

                        title.innerText = "Game Over!";
                        msg.innerHTML = `Pontua√ß√£o Final: <strong class="text-brand-yellow text-xl">${score}</strong>`;
                        btnStart.innerText = "Tentar Novamente";
                        overlay.classList.remove("hidden");
                    };

                    // Listeners
                    btnStart.onclick = startGame;
                    fireBtns.forEach((btn) => {
                        btn.onclick = () => shoot(parseInt(btn.dataset.side));
                    });
                },

                interactive_3d_cube_builder(container) {
                    let side = 2; // Come√ßa com 2x2x2

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Visualizador 3D</h3>

        <div class="perspective-container relative w-64 h-64 flex items-center justify-center mb-6">
            <div id="scene-3d" class="w-full h-full relative transition-transform duration-500" style="transform-style: preserve-3d; transform: rotateX(-20deg) rotateY(-30deg);">
                </div>
        </div>

        <div class="w-full max-w-xs px-4 mb-4">
            <div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-2">
                <span>Aresta (Lado): <span id="side-val" class="text-brand-blue text-lg">2</span></span>
            </div>
            <input type="range" id="side-slider" min="1" max="5" value="2" step="1" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-purple hover:accent-brand-purpleDark">
            <div class="flex justify-between text-[10px] text-gray-300 font-bold mt-1 px-1">
                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
            </div>
        </div>

        <div class="bg-gray-50 border border-gray-200 rounded-xl p-4 text-center w-full max-w-sm">
            <p class="text-xs font-bold text-gray-400 uppercase mb-1">C√°lculo do Volume</p>
            <div class="font-mono text-lg md:text-xl text-gray-700">
                <span class="text-brand-blue" id="math-side-1">2</span> √ó 
                <span class="text-brand-blue" id="math-side-2">2</span> √ó 
                <span class="text-brand-blue" id="math-side-3">2</span> = 
                <span class="text-brand-purple font-black text-2xl" id="math-result">8</span>
            </div>
            <p class="text-[10px] text-gray-400 mt-2">Cubinhos totais</p>
        </div>

    </div>
    `;

                    // CSS 3D
                    const style = document.createElement("style");
                    style.innerHTML = `
        .perspective-container { perspective: 800px; }
        .cube-unit {
            position: absolute;
            width: 30px;
            height: 30px;
            transform-style: preserve-3d;
            transition: all 0.5s ease-out;
        }
        .face {
            position: absolute;
            width: 30px;
            height: 30px;
            border: 1px solid rgba(0,0,0,0.1);
            opacity: 0.9;
        }
        .face.front  { transform: translateZ(15px); background: #A78BFA; } /* Purple-400 */
        .face.back   { transform: rotateY(180deg) translateZ(15px); background: #8B5CF6; }
        .face.right  { transform: rotateY(90deg) translateZ(15px); background: #7C3AED; } /* Purple-600 */
        .face.left   { transform: rotateY(-90deg) translateZ(15px); background: #A78BFA; }
        .face.top    { transform: rotateX(90deg) translateZ(15px); background: #C4B5FD; } /* Purple-300 */
        .face.bottom { transform: rotateX(-90deg) translateZ(15px); background: #6D28D9; }
    `;
                    container.appendChild(style);

                    const scene = container.querySelector("#scene-3d");
                    const slider = container.querySelector("#side-slider");
                    const sideVal = container.querySelector("#side-val");
                    const m1 = container.querySelector("#math-side-1");
                    const m2 = container.querySelector("#math-side-2");
                    const m3 = container.querySelector("#math-side-3");
                    const mRes = container.querySelector("#math-result");

                    const renderCubes = (n) => {
                        scene.innerHTML = "";
                        const size = 30; // Tamanho do cubinho em px
                        const offset = ((n - 1) * size) / 2; // Para centralizar no pivot

                        // Loop 3D
                        for (let x = 0; x < n; x++) {
                            for (let y = 0; y < n; y++) {
                                for (let z = 0; z < n; z++) {
                                    const el = document.createElement("div");
                                    el.className = "cube-unit";

                                    // Posicionamento
                                    // Inverte Y para crescer pra cima visualmente se quiser, mas aqui tanto faz
                                    const tx = x * size - offset;
                                    const ty = y * size - offset;
                                    const tz = z * size - offset;

                                    el.style.transform = `translateX(${tx}px) translateY(${ty}px) translateZ(${tz}px)`;

                                    // Faces
                                    el.innerHTML = `
                        <div class="face front"></div>
                        <div class="face back"></div>
                        <div class="face right"></div>
                        <div class="face left"></div>
                        <div class="face top"></div>
                        <div class="face bottom"></div>
                    `;

                                    // Delay escalonado para efeito de constru√ß√£o
                                    // Camadas de baixo pra cima ou tr√°s pra frente
                                    const delay = (x + y + z) * 0.05;
                                    el.style.animation = `popIn 0.4s ease-out ${delay}s backwards`;

                                    scene.appendChild(el);
                                }
                            }
                        }
                    };

                    const update = () => {
                        const n = parseInt(slider.value);
                        sideVal.innerText = n;
                        m1.innerText = n;
                        m2.innerText = n;
                        m3.innerText = n;
                        mRes.innerText = Math.pow(n, 3);

                        renderCubes(n);
                    };

                    slider.addEventListener("input", update);

                    // Auto-rotate suave para dar no√ß√£o de 3D
                    let rotY = -30;
                    setInterval(() => {
                        // rotY += 0.2;
                        // scene.style.transform = `rotateX(-20deg) rotateY(${rotY}deg)`;
                    }, 50); // Opcional, pode distrair. Deixei comentado.

                    update();
                },

                interactive_cube_race(container) {
                    const questions = [
                        { q: "Lado 2", ans: 8 },
                        { q: "Lado 3", ans: 27 },
                        { q: "Lado 1", ans: 1 },
                        { q: "Lado 4", ans: 64 },
                        { q: "Lado 5", ans: 125 },
                        { q: "Lado 10", ans: 1000 },
                    ];

                    let currentQ = 0;
                    let score = 0;
                    let timeLeft = 10;
                    let timerInterval = null;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">
        
        <div class="flex justify-between w-full items-center mb-6 z-10">
            <h3 class="font-black uppercase text-xs tracking-widest text-gray-400">Turbo Math</h3>
            <div class="bg-gray-700 px-3 py-1 rounded-full text-xs font-black text-brand-yellow">Pontos: <span id="race-score">0</span></div>
        </div>

        <div class="w-full bg-gray-800 h-24 rounded-xl border-2 border-gray-600 mb-6 relative overflow-hidden">
            <div class="absolute inset-0 opacity-20" style="background: repeating-linear-gradient(90deg, transparent, transparent 20px, #fff 20px, #fff 40px);"></div>
            <div id="car" class="absolute bottom-2 left-2 text-4xl transition-all duration-500 ease-out">üèéÔ∏è</div>
            <div class="absolute bottom-2 right-2 text-4xl">üèÅ</div>
        </div>

        <div class="text-center z-10 mb-6">
            <p class="text-gray-400 text-xs font-bold uppercase mb-2">Qual o volume?</p>
            <div class="bg-white text-gray-900 px-8 py-4 rounded-2xl shadow-[0_0_20px_rgba(255,255,255,0.2)]">
                <span class="font-mono font-black text-4xl" id="q-text">Lado 3</span>
            </div>
        </div>

        <div class="w-full h-2 bg-gray-700 rounded-full mb-6 overflow-hidden">
            <div id="timer-bar" class="h-full bg-brand-green transition-all duration-100 ease-linear" style="width: 100%"></div>
        </div>

        <div class="grid grid-cols-2 gap-3 w-full max-w-sm z-10" id="opts-area">
            </div>

        <div id="start-overlay" class="absolute inset-0 bg-gray-900/95 z-30 flex flex-col items-center justify-center text-center p-6">
            <div class="text-6xl mb-4">üèÅ</div>
            <h3 class="text-2xl font-black text-white mb-2">Corrida C√∫bica</h3>
            <p class="text-gray-400 text-sm mb-6">Calcule o volume (Lado¬≥) antes que o tempo acabe!</p>
            <button id="btn-start-race" class="bg-brand-red text-white font-bold py-3 px-10 rounded-full shadow-[0_0_15px_rgba(239,68,68,0.6)] animate-pulse">ACELERAR</button>
        </div>

    </div>
    `;

                    const qText = container.querySelector("#q-text");
                    const optsArea = container.querySelector("#opts-area");
                    const timerBar = container.querySelector("#timer-bar");
                    const scoreEl = container.querySelector("#race-score");
                    const car = container.querySelector("#car");
                    const startOverlay = container.querySelector("#start-overlay");
                    const btnStart = container.querySelector("#btn-start-race");

                    const nextQuestion = () => {
                        if (currentQ >= questions.length) {
                            endGame(true);
                            return;
                        }

                        // Setup Pergunta
                        const q = questions[currentQ];
                        qText.innerText = q.q;

                        // Setup Op√ß√µes (1 certa + 3 erradas pr√≥ximas)
                        let opts = [q.ans];
                        while (opts.length < 4) {
                            // Gera erro comum (quadrado, soma, ou aleat√≥rio pr√≥ximo)
                            const r = Math.random();
                            let wrong;
                            if (r < 0.3) wrong = Math.pow(parseInt(q.q.split(" ")[1]), 2);
                            // Quadrado (erro comum)
                            else if (r < 0.6)
                                wrong = parseInt(q.q.split(" ")[1]) * 3; // Soma (erro comum)
                            else wrong = q.ans + Math.floor(Math.random() * 10) + 1;

                            if (!opts.includes(wrong) && wrong > 0) opts.push(wrong);
                        }
                        opts.sort(() => Math.random() - 0.5);

                        // Render Bot√µes
                        optsArea.innerHTML = "";
                        opts.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-gray-700 border-b-4 border-gray-900 hover:bg-gray-600 text-white font-mono font-bold text-xl py-4 rounded-xl active:border-b-0 active:translate-y-1 transition-all";
                            btn.innerText = opt;
                            btn.onclick = () => check(opt);
                            optsArea.appendChild(btn);
                        });

                        // Reset Timer
                        resetTimer();
                    };

                    const resetTimer = () => {
                        clearInterval(timerInterval);
                        timeLeft = 100;
                        timerBar.style.width = "100%";
                        timerBar.classList.replace("bg-brand-red", "bg-brand-green");

                        timerInterval = setInterval(() => {
                            timeLeft -= 2; // Velocidade
                            timerBar.style.width = `${timeLeft}%`;

                            if (timeLeft < 30)
                                timerBar.classList.replace("bg-brand-green", "bg-brand-red");

                            if (timeLeft <= 0) {
                                clearInterval(timerInterval);
                                endGame(false);
                            }
                        }, 100);
                    };

                    const check = (val) => {
                        const correct = questions[currentQ].ans;
                        if (val === correct) {
                            score += 100;
                            scoreEl.innerText = score;
                            currentQ++;

                            // Move Carro
                            const progress = (currentQ / questions.length) * 100;
                            car.style.left = `calc(${progress}% - 40px)`;

                            nextQuestion();
                        } else {
                            // Erro penaliza tempo
                            timeLeft -= 30;
                            const btn = Array.from(optsArea.children).find(
                                (b) => b.innerText == val
                            );
                            btn.classList.add("bg-red-600", "animate-shake");
                        }
                    };

                    const endGame = (win) => {
                        clearInterval(timerInterval);
                        startOverlay.classList.remove("hidden");
                        startOverlay.querySelector("h3").innerText = win
                            ? "VIT√ìRIA!"
                            : "FIM DE JOGO";
                        startOverlay.querySelector("p").innerText = win
                            ? `Voc√™ fez ${score} pontos!`
                            : "O tempo acabou!";
                        startOverlay.querySelector(".text-6xl").innerText = win
                            ? "üèÜ"
                            : "üí•";
                        btnStart.innerText = "JOGAR NOVAMENTE";

                        btnStart.onclick = () => {
                            currentQ = 0;
                            score = 0;
                            scoreEl.innerText = 0;
                            car.style.left = "8px";
                            startOverlay.classList.add("hidden");
                            nextQuestion();
                        };
                    };

                    btnStart.onclick = () => {
                        startOverlay.classList.add("hidden");
                        nextQuestion();
                    };
                },

                interactive_class_order_explorer(container) {
                    // Configura√ß√£o das Classes
                    const classesConfig = [
                        {
                            name: "Classe das Unidades",
                            color: "bg-green-50 border-green-200 text-green-800",
                            badge: "bg-green-200",
                        },
                        {
                            name: "Classe dos Milhares",
                            color: "bg-blue-50 border-blue-200 text-blue-800",
                            badge: "bg-blue-200",
                        },
                        {
                            name: "Classe dos Milh√µes",
                            color: "bg-orange-50 border-orange-200 text-orange-800",
                            badge: "bg-orange-200",
                        },
                        {
                            name: "Classe dos Bilh√µes",
                            color: "bg-purple-50 border-purple-200 text-purple-800",
                            badge: "bg-purple-200",
                        },
                        {
                            name: "Classe dos Trilh√µes",
                            color: "bg-red-50 border-red-200 text-red-800",
                            badge: "bg-red-200",
                        },
                    ];

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-6">Raio-X do N√∫mero</h3>

<div class="w-full max-w-2xl mb-8 relative group">
<input type="text" id="num-input" value="12345678" maxlength="15" 
class="w-full text-3xl md:text-5xl font-mono font-bold text-center border-b-4 border-brand-gray outline-none text-brand-text bg-transparent pb-2 tracking-widest focus:border-brand-blue transition-all placeholder-gray-200" 
placeholder="Digite um n√∫mero...">
<div class="text-center text-xs text-gray-400 mt-2 font-bold uppercase group-focus-within:text-brand-blue transition-colors">Digite at√© 15 d√≠gitos</div>
</div>

<div id="grid-display" class="flex flex-row-reverse flex-wrap-reverse justify-center gap-2 md:gap-4 w-full pb-4">
</div>

<div class="mt-6 w-full bg-gray-50 p-4 rounded-xl border border-gray-200 text-center relative overflow-hidden">
<div class="absolute top-0 left-0 w-1 h-full bg-brand-blue"></div>
<span class="text-[10px] font-bold text-gray-400 uppercase block mb-1 tracking-wider">Como se l√™</span>
<p id="text-read" class="text-brand-blue font-bold text-lg md:text-xl leading-tight italic capitalize">
Doze milh√µes, trezentos e quarenta e cinco mil, seiscentos e setenta e oito
</p>
</div>

</div>
`;

                    // 2. Seletores
                    const input = container.querySelector("#num-input");
                    const gridDisplay = container.querySelector("#grid-display");
                    const textRead = container.querySelector("#text-read");

                    // 3. Helper: Conversor de N√∫meros para Extenso (PT-BR)
                    const numPorExtenso = (n) => {
                        if (n === 0) return "zero";

                        const unidades = [
                            "",
                            "um",
                            "dois",
                            "tr√™s",
                            "quatro",
                            "cinco",
                            "seis",
                            "sete",
                            "oito",
                            "nove",
                        ];
                        const dezenas = [
                            "",
                            "dez",
                            "vinte",
                            "trinta",
                            "quarenta",
                            "cinquenta",
                            "sessenta",
                            "setenta",
                            "oitenta",
                            "noventa",
                        ];
                        const dez_especiais = [
                            "dez",
                            "onze",
                            "doze",
                            "treze",
                            "quatorze",
                            "quinze",
                            "dezesseis",
                            "dezessete",
                            "dezoito",
                            "dezenove",
                        ];
                        const centenas = [
                            "",
                            "cento",
                            "duzentos",
                            "trezentos",
                            "quatrocentos",
                            "quinhentos",
                            "seiscentos",
                            "setecentos",
                            "oitocentos",
                            "novecentos",
                        ];

                        const classesPlural = [
                            "",
                            "mil",
                            "milh√µes",
                            "bilh√µes",
                            "trilh√µes",
                        ];
                        const classesSingular = [
                            "",
                            "mil",
                            "milh√£o",
                            "bilh√£o",
                            "trilh√£o",
                        ];

                        let s = n.toString();
                        s = s.padStart(Math.ceil(s.length / 3) * 3, "0"); // Padroniza trios

                        let grupos = s.match(/.{1,3}/g).map(Number); // [12, 345, 678]
                        let totalGrupos = grupos.length;
                        let resultado = [];

                        grupos.forEach((valor, i) => {
                            let classeIdx = totalGrupos - 1 - i;
                            if (valor === 0) return;

                            let extenso = "";
                            let c = Math.floor(valor / 100);
                            let d = Math.floor((valor % 100) / 10);
                            let u = valor % 10;

                            // Centena
                            if (valor === 100) extenso = "cem";
                            else {
                                if (c > 0) extenso += centenas[c];
                                if (c > 0 && (d > 0 || u > 0)) extenso += " e ";

                                // Dezena e Unidade
                                if (d === 1) {
                                    extenso += dez_especiais[u];
                                } else {
                                    if (d > 0) extenso += dezenas[d];
                                    if (d > 0 && u > 0) extenso += " e ";
                                    if (u > 0) extenso += unidades[u];
                                }
                            }

                            // Nome da Classe (Mil, Milh√£o...)
                            if (classeIdx > 0) {
                                let nomeClasse =
                                    valor === 1
                                        ? classesSingular[classeIdx]
                                        : classesPlural[classeIdx];
                                extenso += ` ${nomeClasse}`;
                            }

                            resultado.push(extenso);
                        });

                        // L√≥gica do "e" entre classes (simplificada)
                        return resultado.join(", ");
                    };

                    // 4. L√≥gica de Renderiza√ß√£o
                    const update = () => {
                        // Limpa input (apenas n√∫meros)
                        let val = input.value.replace(/\D/g, "");

                        // Atualiza visualmente o input para formatar com pontos (ex: 12.345)
                        // Precisamos salvar a posi√ß√£o do cursor para n√£o pular pro fim ao digitar
                        // (Para simplicidade deste widget did√°tico, vamos deixar sem pontos no input ou apenas atualizar no blur,
                        // mas vamos focar no grid que √© o importante).

                        if (val === "") {
                            gridDisplay.innerHTML =
                                '<div class="text-gray-300 italic">Digite um n√∫mero acima...</div>';
                            textRead.innerText = "...";
                            return;
                        }

                        // Texto por Extenso
                        try {
                            textRead.innerText = numPorExtenso(parseInt(val));
                        } catch (e) {
                            textRead.innerText = "N√∫mero muito grande!";
                        }

                        // Gera Grid
                        gridDisplay.innerHTML = "";

                        // Inverte para processar da direita para esquerda (U -> D -> C)
                        const reversedVal = val.split("").reverse().join("");
                        const groups = reversedVal.match(/.{1,3}/g) || [];

                        groups.forEach((groupStr, groupIndex) => {
                            if (groupIndex >= classesConfig.length) return;
                            const config = classesConfig[groupIndex];

                            // Container da Classe
                            const classCard = document.createElement("div");
                            classCard.className = `flex flex-col items-center p-3 rounded-xl border-2 ${config.color} animate-pop-in shadow-sm flex-1 min-w-[100px] max-w-[180px]`;

                            // Cabe√ßalho da Classe
                            const header = document.createElement("div");
                            header.className = `text-[10px] font-black uppercase mb-3 px-2 py-1 rounded-full ${config.badge} bg-opacity-50 tracking-wide`;
                            header.innerText = config.name;
                            classCard.appendChild(header);

                            // Container das Ordens (N√∫meros)
                            // Flex-row-reverse aqui para mostrar C D U na ordem correta de leitura
                            const ordersRow = document.createElement("div");
                            ordersRow.className =
                                "flex flex-row-reverse justify-center gap-2 w-full";

                            // O grupo est√° invertido (ex: 321).
                            // D√≠gito 0 = Unidade, D√≠gito 1 = Dezena, D√≠gito 2 = Centena
                            const digits = groupStr.split(""); // ['3', '2', '1']

                            // Precisamos renderizar sempre 3 slots para manter o alinhamento?
                            // Ou apenas o que existe? Vamos renderizar o que existe, mas preenchendo visualmente.

                            // Para ficar alinhado C D U, vamos iterar de 2 at√© 0
                            for (let i = 2; i >= 0; i--) {
                                const d = digits[i]; // Pode ser undefined se o n√∫mero acabou

                                // Se n√£o tem d√≠gito (ex: n√∫mero 12, n√£o tem centena), renderiza placeholder ou nada?
                                // Vamos renderizar apenas se existir, mas mantendo a ordem.
                                if (d === undefined) continue;

                                const orderName = ["U", "D", "C"][i];
                                const orderGlobal = groupIndex * 3 + i + 1; // 1¬™, 2¬™, 3¬™ ordem...

                                const digitBox = document.createElement("div");
                                digitBox.className =
                                    "flex flex-col items-center relative group/digit";
                                digitBox.innerHTML = `
<div class="w-8 h-10 md:w-10 md:h-12 bg-white rounded-lg border-2 border-current flex items-center justify-center text-2xl md:text-3xl font-black shadow-sm z-10 relative group-hover/digit:-translate-y-1 transition-transform">
${d}
</div>
<div class="text-[10px] font-bold mt-1 opacity-60">${orderName}</div>

<div class="absolute bottom-full mb-2 opacity-0 group-hover/digit:opacity-100 transition-opacity bg-gray-800 text-white text-[10px] px-2 py-1 rounded whitespace-nowrap pointer-events-none z-20">
${orderGlobal}¬™ Ordem
</div>
`;
                                ordersRow.appendChild(digitBox);
                            }

                            classCard.appendChild(ordersRow);
                            gridDisplay.appendChild(classCard);
                        });
                    };

                    // 5. Listeners
                    input.addEventListener("input", update);

                    // Init
                    update();
                },

                interactive_equation_advanced(container) {
                    // Estado inicial
                    let currentState = {
                        lhs: { x: 0, c: 0 },
                        rhs: { x: 0, c: 0 },
                        step: 0,
                    };

                    // 1. HTML (Agora com 3 bot√µes de a√ß√£o e visualiza√ß√£o de balan√ßa)
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm">

<div class="w-full max-w-md mb-6 bg-purple-50 p-4 rounded-xl border border-purple-100 flex flex-col gap-2">
<label class="text-xs font-bold text-brand-purple uppercase">Digite a Equa√ß√£o (Ex: 3x + 4 = x + 10)</label>
<div class="flex gap-2">
<input type="text" id="eq-input" value="3x + 4 = x + 10" class="flex-1 text-lg md:text-xl font-mono font-bold text-center border-2 border-brand-gray rounded-lg p-2 focus:border-brand-purple outline-none text-brand-text uppercase" placeholder="ax + b = cx + d">
<button id="build-btn" class="bg-brand-purple text-white px-4 rounded-lg font-bold hover:bg-purple-600 transition-colors shadow-btn active:shadow-none active:translate-y-1">
<i class="fas fa-hammer"></i>
</button>
</div>
</div>

<div class="relative w-full max-w-sm h-48 mb-4 flex justify-center items-end select-none">
<div class="absolute bottom-0 w-0 h-0 border-l-[20px] border-l-transparent border-r-[20px] border-r-transparent border-b-[40px] border-b-brand-text z-10"></div>
<div class="absolute bottom-[38px] w-72 h-2 bg-brand-text rounded-full z-10 transition-transform duration-500 origin-center" id="beam"></div>

<div class="absolute bottom-[38px] left-[50%] -translate-x-36 flex flex-col items-center transition-all duration-500" id="pan-l">
<div class="w-0.5 h-16 bg-gray-400"></div>
<div class="w-24 h-2 bg-brand-text rounded-full"></div>
<div id="content-l" class="absolute bottom-4 flex flex-wrap-reverse gap-1 justify-center w-28 transition-all"></div>
</div>

<div class="absolute bottom-[38px] left-[25%] translate-x-36 flex flex-col items-center transition-all duration-500" id="pan-r">
<div class="w-0.5 h-16 bg-gray-400"></div>
<div class="w-24 h-2 bg-brand-text rounded-full"></div>
<div id="content-r" class="absolute bottom-4 flex flex-wrap-reverse gap-1 justify-center w-28 transition-all"></div>
</div>
</div>

<div id="controls" class="hidden w-full max-w-lg bg-gray-50 p-4 rounded-xl border border-gray-200 flex flex-col gap-4 transition-all">

<div class="text-center font-mono text-xl font-bold text-brand-text bg-white p-2 rounded border border-gray-100" id="status-text">
$$3x + 4 = x + 10$$
</div>

<div class="grid grid-cols-3 gap-2">
<button id="step1-btn" class="bg-brand-blue text-white py-3 rounded-lg font-bold text-xs md:text-sm shadow-btn active:shadow-none active:translate-y-1 transition-all flex flex-col items-center justify-center gap-1">
<i class="fas fa-balance-scale-left"></i>
<span>1. Tirar X</span>
</button>

<button id="step2-btn" class="bg-brand-orange text-white py-3 rounded-lg font-bold text-xs md:text-sm opacity-50 cursor-not-allowed shadow-none transition-all flex flex-col items-center justify-center gap-1" disabled>
<i class="fas fa-minus-circle"></i>
<span>2. Tirar Sobras</span>
</button>

<button id="step3-btn" class="bg-brand-green text-white py-3 rounded-lg font-bold text-xs md:text-sm opacity-50 cursor-not-allowed shadow-none transition-all flex flex-col items-center justify-center gap-1" disabled>
<i class="fas fa-divide"></i>
<span>3. Dividir</span>
</button>
</div>
</div>
</div>
`;

                    // 2. Seletores
                    const els = {
                        input: container.querySelector("#eq-input"),
                        buildBtn: container.querySelector("#build-btn"),
                        contentL: container.querySelector("#content-l"),
                        contentR: container.querySelector("#content-r"),
                        controls: container.querySelector("#controls"),
                        statusText: container.querySelector("#status-text"),
                        step1Btn: container.querySelector("#step1-btn"),
                        step2Btn: container.querySelector("#step2-btn"),
                        step3Btn: container.querySelector("#step3-btn"),
                        beam: container.querySelector("#beam"),
                    };

                    // 3. Parser de Equa√ß√£o (L√™ ax + b = cx + d)
                    const parseEquation = (str) => {
                        const clean = str.replace(/\s+/g, "").toLowerCase();
                        const parts = clean.split("=");
                        if (parts.length !== 2) return null;

                        const parseSide = (s) => {
                            let x = 0,
                                c = 0;
                            // Regex simples para capturar termos como 3x, x, 10, -5
                            // Para simplificar no 6¬∫ ano, vamos assumir somas positivas por enquanto
                            // Mas o regex abaixo tenta pegar coeficientes
                            const terms = s.split("+");
                            terms.forEach((t) => {
                                if (t.includes("x")) {
                                    const val = t.replace("x", "");
                                    x += val === "" ? 1 : parseInt(val);
                                } else {
                                    c += parseInt(t) || 0;
                                }
                            });
                            return { x, c };
                        };
                        return { lhs: parseSide(parts[0]), rhs: parseSide(parts[1]) };
                    };

                    // 4. Desenha Elementos (Blocos e Bolinhas)
                    const draw = (data) => {
                        els.contentL.innerHTML = "";
                        els.contentR.innerHTML = "";

                        // Cria HTML dos blocos
                        const createX = () =>
                            `<div class="block-x w-8 h-8 bg-brand-purple text-white border-2 border-purple-700 rounded flex items-center justify-center font-bold text-sm animate-pop-in mb-1 relative z-10 shadow-sm">x</div>`;
                        const createUnit = () =>
                            `<div class="unit-ball w-5 h-5 bg-brand-green border border-green-700 rounded-full shadow-sm animate-pop-in mb-1 relative z-10"></div>`;

                        // Preenche Prato Esquerdo
                        for (let i = 0; i < data.lhs.x; i++)
                            els.contentL.innerHTML += createX();
                        for (let i = 0; i < data.lhs.c; i++)
                            els.contentL.innerHTML += createUnit();

                        // Preenche Prato Direito
                        for (let i = 0; i < data.rhs.x; i++)
                            els.contentR.innerHTML += createX();
                        for (let i = 0; i < data.rhs.c; i++)
                            els.contentR.innerHTML += createUnit();
                    };

                    // 5. Atualiza Texto Matem√°tico
                    const updateMathText = (msg) => {
                        if (msg) {
                            els.statusText.innerText = msg;
                            return;
                        }

                        const buildSide = (s) => {
                            let parts = [];
                            if (s.x > 0) parts.push(s.x === 1 ? "x" : `${s.x}x`);
                            if (s.c > 0) parts.push(`${s.c}`);
                            if (parts.length === 0) return "0";
                            return parts.join(" + ");
                        };
                        const txt = `$$${buildSide(currentState.lhs)} = ${buildSide(
                            currentState.rhs
                        )}$$`;
                        els.statusText.innerText = txt;
                        if (window.renderMathInElement)
                            renderMathInElement(els.statusText);
                    };

                    // Helpers de Bot√£o
                    const activateBtn = (btn) => {
                        btn.className = btn.className.replace(
                            "opacity-50 cursor-not-allowed shadow-none",
                            "shadow-btn"
                        );
                        btn.disabled = false;
                    };
                    const disableBtn = (btn) => {
                        if (!btn.className.includes("opacity-50")) {
                            btn.className += " opacity-50 cursor-not-allowed shadow-none";
                        }
                        btn.disabled = true;
                    };

                    // 6. A√ß√£o: MONTAR
                    els.buildBtn.onclick = () => {
                        const eq = parseEquation(els.input.value);
                        if (!eq) return alert("Formato inv√°lido. Tente: 3x + 4 = x + 10");

                        currentState = { ...eq };
                        draw(currentState);

                        els.controls.classList.remove("hidden");
                        updateMathText();

                        // Reseta bot√µes
                        activateBtn(els.step1Btn);
                        disableBtn(els.step2Btn);
                        disableBtn(els.step3Btn);

                        // Anima√ß√£o de balan√ßo
                        els.beam.classList.add("animate-wiggle");
                        setTimeout(
                            () => els.beam.classList.remove("animate-wiggle"),
                            500
                        );
                    };

                    // 7. Passo 1: TIRAR X (Do lado menor)
                    els.step1Btn.onclick = () => {
                        const minX = Math.min(currentState.lhs.x, currentState.rhs.x);

                        if (minX > 0) {
                            // Anima√ß√£o de sa√≠da
                            const xL = Array.from(
                                els.contentL.querySelectorAll(".block-x")
                            ).slice(-minX);
                            const xR = Array.from(
                                els.contentR.querySelectorAll(".block-x")
                            ).slice(-minX);
                            [...xL, ...xR].forEach((el) =>
                                el.classList.add("animate-pop-out")
                            );

                            setTimeout(() => {
                                currentState.lhs.x -= minX;
                                currentState.rhs.x -= minX;
                                draw(currentState);
                                updateMathText();
                            }, 500);
                        } else {
                            // Se j√° n√£o tinha X dos dois lados
                            updateMathText("J√° n√£o tem X dos dois lados!");
                        }

                        disableBtn(els.step1Btn);
                        activateBtn(els.step2Btn);
                    };

                    // 8. Passo 2: TIRAR SOBRAS (Constantes)
                    els.step2Btn.onclick = () => {
                        // Tira constante do lado que ainda tem X para isolar
                        // Mas por simplicidade visual, tiramos o menor valor de constante de ambos os lados
                        const minC = Math.min(currentState.lhs.c, currentState.rhs.c);

                        if (minC > 0) {
                            const cL = Array.from(
                                els.contentL.querySelectorAll(".unit-ball")
                            ).slice(-minC);
                            const cR = Array.from(
                                els.contentR.querySelectorAll(".unit-ball")
                            ).slice(-minC);
                            [...cL, ...cR].forEach((el) =>
                                el.classList.add("animate-pop-out")
                            );

                            setTimeout(() => {
                                currentState.lhs.c -= minC;
                                currentState.rhs.c -= minC;
                                draw(currentState);
                                updateMathText();
                            }, 500);
                        }

                        disableBtn(els.step2Btn);
                        activateBtn(els.step3Btn);
                    };

                    // 9. Passo 3: DIVIDIR
                    els.step3Btn.onclick = () => {
                        // Procura onde est√° o X
                        const sideWithX = currentState.lhs.x > 0 ? "lhs" : "rhs";
                        const sideWithC = currentState.lhs.c > 0 ? "lhs" : "rhs"; // O outro lado

                        const divisor = currentState[sideWithX].x;

                        if (divisor > 1) {
                            // Efeito visual de divis√£o
                            els.contentL.classList.add("opacity-0");
                            els.contentR.classList.add("opacity-0");

                            setTimeout(() => {
                                currentState[sideWithX].x = 1;
                                currentState[sideWithC].c =
                                    currentState[sideWithC].c / divisor;

                                draw(currentState);
                                els.contentL.classList.remove("opacity-0");
                                els.contentR.classList.remove("opacity-0");
                                els.contentL.classList.add("animate-pop-in");
                                els.contentR.classList.add("animate-pop-in");

                                const res = currentState[sideWithC].c;
                                els.statusText.innerText = `$$x = ${res}$$`; // Resultado final
                                els.statusText.classList.add(
                                    "text-brand-green",
                                    "scale-110",
                                    "transition-transform"
                                );
                                if (window.renderMathInElement)
                                    renderMathInElement(els.statusText);
                            }, 300);
                        }

                        disableBtn(els.step3Btn);
                    };

                    // CSS Inline
                    if (!document.getElementById("anim-styles")) {
                        const style = document.createElement("style");
                        style.id = "anim-styles";
                        style.innerHTML = `
@keyframes popIn { 0% { transform: scale(0); } 70% { transform: scale(1.2); } 100% { transform: scale(1); } }
.animate-pop-in { animation: popIn 0.4s ease-out forwards; }
@keyframes popOut { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }
.animate-pop-out { animation: popOut 0.5s ease-in forwards; pointer-events: none; }
@keyframes wiggle { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(-2deg); } 75% { transform: rotate(2deg); } }
.animate-wiggle { animation: wiggle 0.4s ease-in-out; }
`;
                        container.appendChild(style);
                    }
                },

                interactive_cartesian_plane(container) {
                    // Configura√ß√£o
                    const gridSize = 6; // Grid de 0 a 6
                    let target = { x: 3, y: 2 };
                    let score = 0;

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<div class="flex justify-between w-full items-center mb-4">
<h3 class="text-brand-blue font-black uppercase text-xs tracking-widest">Plano Cartesiano</h3>
<div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black shadow-sm">Acertos: <span id="score">0</span></div>
</div>

<div class="mb-6 text-center">
<p class="text-gray-400 text-xs font-bold uppercase mb-1">Miss√£o:</p>
<div class="text-3xl font-black text-brand-text bg-gray-100 px-6 py-2 rounded-xl border-2 border-gray-200 inline-block shadow-inner">
(<span class="text-brand-blue" id="tgt-x">3</span>, <span class="text-brand-orange" id="tgt-y">2</span>)
</div>
<p class="text-xs text-gray-400 mt-2 italic" id="feedback-msg">Clique na intersec√ß√£o correta!</p>
</div>

<div class="relative bg-white rounded-xl border-2 border-brand-text shadow-lg cursor-crosshair overflow-hidden" style="width: 280px; height: 280px;">
<svg width="280" height="280" viewBox="-20 -20 280 280" id="cartesian-svg">
</svg>
</div>

<div class="mt-4 flex gap-4 text-xs font-bold uppercase text-gray-400 w-full justify-between px-8">
<span><span class="text-brand-orange">Y</span> (Vertical)</span>
<span><span class="text-brand-blue">X</span> (Horizontal)</span>
</div>

</div>
`;

                    // 2. Seletores
                    const svg = container.querySelector("#cartesian-svg");
                    const tgtX = container.querySelector("#tgt-x");
                    const tgtY = container.querySelector("#tgt-y");
                    const scoreEl = container.querySelector("#score");
                    const feedback = container.querySelector("#feedback-msg");

                    // 3. Fun√ß√µes de Desenho
                    // Espa√ßo de 40px por unidade (240px √∫til / 6)
                    const unit = 40;
                    const offset = 20; // Margem interna do SVG

                    // Converte Coordenada Matem√°tica -> SVG Pixel
                    // SVG Y cresce para baixo, ent√£o yMatematico = Height - yPixel
                    const toPixel = (x, y) => {
                        return {
                            cx: x * unit,
                            cy: gridSize * unit - y * unit,
                        };
                    };

                    const drawGrid = () => {
                        let html = "";

                        // Linhas da Grade
                        for (let i = 0; i <= gridSize; i++) {
                            const pos = i * unit;
                            const limit = gridSize * unit;

                            // Verticais (X)
                            html += `<line x1="${pos}" y1="0" x2="${pos}" y2="${limit}" stroke="#E5E7EB" stroke-width="1" />`;
                            // N√∫meros X
                            html += `<text x="${pos}" y="${limit + 20
                                }" font-size="10" text-anchor="middle" fill="#1CB0F6" font-weight="bold">${i}</text>`;

                            // Horizontais (Y) - Lembrar que Y inverte
                            html += `<line x1="0" y1="${pos}" x2="${limit}" y2="${pos}" stroke="#E5E7EB" stroke-width="1" />`;
                            // N√∫meros Y (0 a 6 de baixo pra cima)
                            const labelY = gridSize - i;
                            html += `<text x="-15" y="${pos + 4
                                }" font-size="10" text-anchor="end" fill="#FF9600" font-weight="bold">${labelY}</text>`;
                        }

                        // Eixos Principais
                        // Eixo Y (x=0)
                        html += `<line x1="0" y1="0" x2="0" y2="${gridSize * unit
                            }" stroke="#4B4B4B" stroke-width="3" />`;
                        // Eixo X (y=0 na matem√°tica = yMax no SVG)
                        html += `<line x1="0" y1="${gridSize * unit}" x2="${gridSize * unit
                            }" y2="${gridSize * unit}" stroke="#4B4B4B" stroke-width="3" />`;

                        // Origem
                        html += `<circle cx="0" cy="${gridSize * unit
                            }" r="4" fill="#4B4B4B" />`;

                        svg.innerHTML = html;
                    };

                    const nextRound = () => {
                        // Gera novo alvo (entre 0 e 6)
                        target = {
                            x: Math.floor(Math.random() * (gridSize + 1)),
                            y: Math.floor(Math.random() * (gridSize + 1)),
                        };
                        tgtX.innerText = target.x;
                        tgtY.innerText = target.y;
                        feedback.innerText = "Clique na intersec√ß√£o correta!";
                        feedback.className = "text-xs text-gray-400 mt-2 italic";

                        // Limpa pontos anteriores
                        const oldPoints = svg.querySelectorAll(".game-point");
                        oldPoints.forEach((p) => p.remove());
                    };

                    // 4. L√≥gica de Clique
                    svg.onclick = (e) => {
                        // Pega posi√ß√£o do clique relativo ao SVG
                        const rect = svg.getBoundingClientRect();
                        // Precisamos considerar o viewBox offset (-20)
                        // A forma mais f√°cil √© calcular baseado no tamanho renderizado
                        const scaleX = 280 / rect.width; // Se tiver responsividade

                        // Coordenada do clique dentro do elemento visual
                        const clickX = e.clientX - rect.left;
                        const clickY = e.clientY - rect.top;

                        // Ajusta para o sistema de coordenadas do SVG (ViewBox)
                        // ViewBox come√ßa em -20, -20.
                        const svgX = clickX - 20;
                        const svgY = clickY - 20;

                        // Converte para grid (Snap to nearest)
                        // Inverte Y: mathY = (Height - pixelY) / unit
                        const rawGridX = svgX / unit;
                        const rawGridY = (gridSize * unit - svgY) / unit;

                        const gridX = Math.round(rawGridX);
                        const gridY = Math.round(rawGridY);

                        // Valida limites
                        if (
                            gridX < 0 ||
                            gridX > gridSize ||
                            gridY < 0 ||
                            gridY > gridSize
                        )
                            return;

                        // Desenha o ponto clicado
                        const px = toPixel(gridX, gridY);

                        const isCorrect = gridX === target.x && gridY === target.y;

                        // Cria elemento visual do ponto
                        const point = document.createElementNS(
                            "http://www.w3.org/2000/svg",
                            "circle"
                        );
                        point.setAttribute("cx", px.cx);
                        point.setAttribute("cy", px.cy);
                        point.setAttribute("r", 6);
                        point.setAttribute(
                            "class",
                            `game-point transition-all duration-300 ${isCorrect ? "fill-brand-green" : "fill-brand-red"
                            }`
                        );

                        // Efeito de "Onda" (Pulse)
                        const pulse = document.createElementNS(
                            "http://www.w3.org/2000/svg",
                            "circle"
                        );
                        pulse.setAttribute("cx", px.cx);
                        pulse.setAttribute("cy", px.cy);
                        pulse.setAttribute("r", 6);
                        pulse.setAttribute("fill", "none");
                        pulse.setAttribute("stroke", isCorrect ? "#58CC02" : "#FF4B4B");
                        pulse.setAttribute("stroke-width", "2");
                        pulse.setAttribute("class", "game-point animate-ping opacity-75");

                        svg.appendChild(pulse);
                        svg.appendChild(point);

                        if (isCorrect) {
                            score++;
                            scoreEl.innerText = score;
                            feedback.innerHTML = `<span class="text-brand-green font-bold">Acertou! üéâ</span>`;
                            tgtX.parentElement.classList.add(
                                "bg-green-100",
                                "border-green-200"
                            );
                            setTimeout(() => {
                                tgtX.parentElement.classList.remove(
                                    "bg-green-100",
                                    "border-green-200"
                                );
                                nextRound();
                            }, 800);
                        } else {
                            feedback.innerHTML = `<span class="text-brand-red font-bold">Ops! Voc√™ clicou em (${gridX}, ${gridY})</span>`;
                            // Remove o ponto errado depois de um tempo
                            setTimeout(() => {
                                point.remove();
                                pulse.remove();
                            }, 1000);
                        }
                    };

                    // Init
                    drawGrid();
                    nextRound();
                },

                interactive_divisibility_game(container) {
                    // Configura√ß√£o dos Jogos
                    const rules = {
                        2: {
                            name: "Por 2",
                            desc: "√â Par?",
                            check: (n) => n % 2 === 0,
                            color: "bg-green-500",
                            icon: "‚úåÔ∏è",
                        },
                        3: {
                            name: "Por 3",
                            desc: "Soma tabuada do 3?",
                            check: (n) => n % 3 === 0,
                            color: "bg-blue-500",
                            icon: "ü§ü",
                        },
                        4: {
                            name: "Por 4",
                            desc: "Final 00 ou divide por 4?",
                            check: (n) => n % 4 === 0,
                            color: "bg-red-500",
                            icon: "üçÄ",
                        },
                        5: {
                            name: "Por 5",
                            desc: "Termina em 0 ou 5?",
                            check: (n) => n % 5 === 0,
                            color: "bg-orange-500",
                            icon: "‚úã",
                        },
                        6: {
                            name: "Por 6",
                            desc: "Par E divide por 3?",
                            check: (n) => n % 6 === 0,
                            color: "bg-yellow-500",
                            icon: "üçî",
                        },
                        //8: {
                        //name: "Por 8",
                        //desc: "√öltimos 3 dividem?",
                        //check: (n) => n % 8 === 0,
                        //color: "bg-pink-500",
                        //icon: "üé±",
                        //},
                        9: {
                            name: "Por 9",
                            desc: "Soma tabuada do 9?",
                            check: (n) => n % 9 === 0,
                            color: "bg-purple-500",
                            icon: "‚ú®",
                        },
                        10: {
                            name: "Por 10",
                            desc: "Termina em 0?",
                            check: (n) => n % 10 === 0,
                            color: "bg-indigo-500",
                            icon: "üîü",
                        },
                    };

                    let currentRule = null;
                    let currentNumber = 0;
                    let score = 0;
                    let streak = 0;
                    let timeLeft = 0;
                    let timerInterval = null;

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden relative min-h-[400px]">

<div id="menu-screen" class="w-full flex flex-col items-center animate-fade-in">
<h3 class="text-brand-blue font-black uppercase text-sm tracking-widest mb-6">Escolha o Treino</h3>
<div class="grid grid-cols-2 md:grid-cols-4 gap-3 w-full">
${Object.keys(rules)
                            .map(
                                (k) => `
<button class="rule-btn bg-gray-50 border-2 border-gray-200 hover:border-brand-blue hover:bg-blue-50 rounded-xl p-3 flex flex-col items-center gap-1 transition-all active:scale-95" data-r="${k}">
<span class="text-2xl">${rules[k].icon}</span>
<span class="font-bold text-gray-700">${rules[k].name}</span>
</button>
`
                            )
                            .join("")}
</div>
</div>

<div id="game-screen" class="hidden w-full flex-col items-center h-full justify-between animate-pop-in">

<div class="w-full flex justify-between items-center mb-4">
<button id="btn-back-menu" class="text-gray-400 hover:text-brand-blue transition-colors"><i class="fas fa-arrow-left"></i> Menu</button>
<div class="flex gap-4 font-black text-lg">
<span class="text-brand-yellow">üî• <span id="streak-val">0</span></span>
<span class="text-brand-green">pts: <span id="score-val">0</span></span>
</div>
</div>

<div class="flex-1 flex flex-col items-center justify-center w-full">
<div class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2" id="rule-desc">Regra</div>

<div class="w-full max-w-xs bg-gray-100 rounded-3xl p-8 text-center mb-8 border-4 border-gray-200 relative overflow-hidden">
<div class="absolute top-0 left-0 h-2 bg-brand-blue transition-all duration-[50ms] w-full" id="time-bar"></div>

<div class="text-5xl md:text-6xl font-black text-brand-text tabular-nums tracking-tighter" id="game-num">000</div>
</div>

<div class="grid grid-cols-2 gap-4 w-full max-w-xs">
<button id="btn-no" class="bg-red-100 text-red-600 border-b-4 border-red-300 hover:bg-red-200 hover:border-red-400 rounded-2xl py-4 font-black text-xl transition-all active:border-b-0 active:translate-y-1">
<i class="fas fa-times"></i> N√ÉO
</button>
<button id="btn-yes" class="bg-green-100 text-green-600 border-b-4 border-green-300 hover:bg-green-200 hover:border-green-400 rounded-2xl py-4 font-black text-xl transition-all active:border-b-0 active:translate-y-1">
<i class="fas fa-check"></i> SIM
</button>
</div>
</div>

</div>

<div id="feedback-overlay" class="absolute inset-0 bg-white/90 flex flex-col items-center justify-center z-10 hidden animate-fade-in">
<div class="text-6xl mb-4" id="fb-icon">‚ùå</div>
<h3 class="text-2xl font-black text-brand-text mb-2" id="fb-title">Errado!</h3>
<p class="text-gray-500 font-bold mb-6 text-center px-4" id="fb-msg">Explica√ß√£o aqui</p>
<button id="btn-next" class="bg-brand-blue text-white font-bold py-3 px-8 rounded-xl shadow-btn active:scale-95 transition-all">Continuar</button>
</div>

</div>
`;

                    // 2. Seletores
                    const menuScreen = container.querySelector("#menu-screen");
                    const gameScreen = container.querySelector("#game-screen");
                    const feedbackOverlay =
                        container.querySelector("#feedback-overlay");

                    const ruleDesc = container.querySelector("#rule-desc");
                    const gameNum = container.querySelector("#game-num");
                    const timeBar = container.querySelector("#time-bar");
                    const scoreVal = container.querySelector("#score-val");
                    const streakVal = container.querySelector("#streak-val");

                    const btnBack = container.querySelector("#btn-back-menu");
                    const btnYes = container.querySelector("#btn-yes");
                    const btnNo = container.querySelector("#btn-no");
                    const btnNext = container.querySelector("#btn-next");

                    const fbIcon = container.querySelector("#fb-icon");
                    const fbTitle = container.querySelector("#fb-title");
                    const fbMsg = container.querySelector("#fb-msg");

                    // 3. Fun√ß√µes do Jogo
                    const showMenu = () => {
                        clearInterval(timerInterval);
                        gameScreen.classList.add("hidden");
                        feedbackOverlay.classList.add("hidden");
                        menuScreen.classList.remove("hidden");
                    };

                    const startGame = (ruleKey) => {
                        currentRule = { key: ruleKey, ...rules[ruleKey] };
                        score = 0;
                        streak = 0;
                        updateScoreboard();

                        menuScreen.classList.add("hidden");
                        gameScreen.classList.remove("hidden");
                        gameScreen.classList.add("flex");

                        ruleDesc.innerText = `Regra: ${currentRule.desc}`;
                        nextRound();
                    };

                    const nextRound = () => {
                        // Gera n√∫mero desafiador
                        // 50% chance de ser divis√≠vel
                        const isDivisible = Math.random() < 0.5;
                        let num;

                        if (isDivisible) {
                            num = currentRule.key * (Math.floor(Math.random() * 20) + 1);
                            // √Äs vezes multiplica por algo grande para assustar
                            if (Math.random() < 0.3)
                                num *= Math.floor(Math.random() * 10) + 1;
                        } else {
                            do {
                                num = Math.floor(Math.random() * 200) + 10;
                            } while (num % currentRule.key === 0);
                        }

                        currentNumber = num;
                        gameNum.innerText = num;

                        startTimer();
                    };

                    const startTimer = () => {
                        clearInterval(timerInterval);
                        timeLeft = 100;
                        timeBar.style.width = "100%";
                        timeBar.className =
                            "absolute top-0 left-0 h-2 bg-brand-blue transition-all duration-[100ms] w-full"; // Reset cor

                        timerInterval = setInterval(() => {
                            timeLeft -= 2; // Velocidade do timer
                            timeBar.style.width = `${timeLeft}%`;

                            if (timeLeft < 30)
                                timeBar.classList.replace("bg-brand-blue", "bg-brand-red");

                            if (timeLeft <= 0) {
                                handleAnswer(null); // Time out
                            }
                        }, 100);
                    };

                    const handleAnswer = (userSaidYes) => {
                        clearInterval(timerInterval);
                        const isDivisible = currentNumber % currentRule.key === 0;
                        const isCorrect =
                            (userSaidYes === true && isDivisible) ||
                            (userSaidYes === false && !isDivisible);

                        if (userSaidYes === null) {
                            // Timeout
                            showFeedback(
                                false,
                                "Tempo esgotado!",
                                `O n√∫mero era ${currentNumber}.`
                            );
                        } else if (isCorrect) {
                            score += 10 + streak * 2;
                            streak++;
                            updateScoreboard();
                            // Pequena pausa vitoriosa
                            gameNum.classList.add(
                                "text-brand-green",
                                "scale-110",
                                "transition-transform"
                            );
                            setTimeout(() => {
                                gameNum.classList.remove("text-brand-green", "scale-110");
                                nextRound();
                            }, 400);
                        } else {
                            streak = 0;
                            updateScoreboard();
                            showFeedback(
                                false,
                                "Errou!",
                                `${currentNumber} ${isDivisible ? "√â" : "N√ÉO √©"
                                } divis√≠vel por ${currentRule.key}.`
                            );
                        }
                    };

                    const showFeedback = (success, title, msg) => {
                        fbIcon.innerText = success ? "üéâ" : "üí•";
                        fbTitle.innerText = title;
                        fbTitle.className = `text-2xl font-black mb-2 ${success ? "text-brand-green" : "text-brand-red"
                            }`;
                        fbMsg.innerText = msg;

                        feedbackOverlay.classList.remove("hidden");
                        feedbackOverlay.classList.add("flex");
                    };

                    const updateScoreboard = () => {
                        scoreVal.innerText = score;
                        streakVal.innerText = streak;
                    };

                    // 4. Listeners
                    container.querySelectorAll(".rule-btn").forEach((btn) => {
                        btn.onclick = () => startGame(btn.dataset.r);
                    });

                    btnBack.onclick = showMenu;
                    btnYes.onclick = () => handleAnswer(true);
                    btnNo.onclick = () => handleAnswer(false);
                    btnNext.onclick = () => {
                        feedbackOverlay.classList.add("hidden");
                        nextRound();
                    };
                },

                interactive_flowchart_divisibility(container) {
                    // Estado do Jogo
                    const steps = [
                        {
                            id: "start",
                            type: "pill",
                            text: "IN√çCIO",
                            color: "bg-green-100 border-green-400 text-green-800",
                        },
                        {
                            id: "input",
                            type: "rect",
                            text: "Ler n√∫mero",
                            color: "bg-blue-50 border-blue-400 text-blue-800",
                        },
                        {
                            id: "check",
                            type: "diamond",
                            text: "Termina em 0 ou 5?",
                            color: "bg-orange-50 border-orange-400 text-orange-800",
                        },
                        {
                            id: "yes",
                            type: "rect",
                            text: "√â divis√≠vel por 5",
                            color: "bg-green-50 border-green-400 text-green-800",
                        },
                        {
                            id: "no",
                            type: "rect",
                            text: "N√£o √© divis√≠vel",
                            color: "bg-red-50 border-red-400 text-red-800",
                        },
                        {
                            id: "end",
                            type: "pill",
                            text: "FIM",
                            color: "bg-green-100 border-green-400 text-green-800",
                        },
                    ];

                    let userOrder = [];
                    let isComplete = false;

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Monte o Algoritmo: Divisibilidade por 5</h3>
<p class="text-xs text-gray-400 mb-6 text-center">Clique nos blocos na ordem correta para montar o fluxo l√≥gico.</p>

<div class="w-full min-h-[300px] bg-gray-50 rounded-xl border-2 border-dashed border-gray-300 p-4 flex flex-col items-center gap-2 relative mb-6 transition-colors" id="drop-zone">
<div class="text-gray-300 font-bold text-sm absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none" id="placeholder-text">
O fluxo aparecer√° aqui...
</div>
</div>
<div class="flex flex-wrap gap-3 justify-center" id="blocks-bank">
</div>
<div class="mt-6 flex gap-2">
<button id="btn-reset" class="text-gray-400 font-bold text-xs uppercase hover:text-brand-red transition-colors">
<i class="fas fa-undo"></i> Reiniciar
</button>
</div>

<div id="success-msg" class="hidden mt-4 text-brand-green font-black text-xl animate-pop-in">
üéâ Algoritmo Correto!
</div>
</div>
`;
                    const dropZone = container.querySelector("#drop-zone");
                    const blocksBank = container.querySelector("#blocks-bank");
                    const placeholder = container.querySelector("#placeholder-text");
                    const successMsg = container.querySelector("#success-msg");
                    const btnReset = container.querySelector("#btn-reset");
                    // 2. Renderiza√ß√£o dos Blocos
                    const renderBlock = (step, inBank = true) => {
                        const el = document.createElement("div");

                        // Estilos baseados na forma
                        let shapeClass = "rounded-lg px-4 py-2"; // Ret√¢ngulo padr√£o
                        if (step.type === "pill") shapeClass = "rounded-full px-6 py-1";
                        if (step.type === "diamond")
                            shapeClass =
                                "w-24 h-24 flex items-center justify-center text-center text-[10px] p-1 rotate-45 m-2"; // Losango precisa de ajuste
                        // Corre√ß√£o visual do texto dentro do losango
                        const innerContent =
                            step.type === "diamond"
                                ? `<div class="-rotate-45">${step.text}</div>`
                                : step.text;
                        el.className = `${shapeClass} ${step.color} border-2 font-bold text-xs shadow-sm cursor-pointer transition-all hover:scale-105 active:scale-95 animate-pop-in`;
                        el.innerHTML = innerContent;
                        el.dataset.id = step.id;
                        el.onclick = () => handleBlockClick(step, inBank);

                        return el;
                    };
                    // 3. Inicializa√ß√£o
                    const initGame = () => {
                        userOrder = [];
                        isComplete = false;
                        dropZone.innerHTML = "";
                        dropZone.appendChild(placeholder);
                        blocksBank.innerHTML = "";
                        successMsg.classList.add("hidden");
                        placeholder.classList.remove("hidden");
                        dropZone.classList.remove("border-brand-green", "bg-green-50");
                        // Embaralha e renderiza no banco
                        [...steps]
                            .sort(() => Math.random() - 0.5)
                            .forEach((s) => {
                                blocksBank.appendChild(renderBlock(s, true));
                            });
                    };
                    // 4. L√≥gica do Jogo
                    const handleBlockClick = (step, inBank) => {
                        if (isComplete) return;
                        if (inBank) {
                            // Move para a zona de drop
                            userOrder.push(step.id);

                            // Cria visual na zona de drop (com seta se n√£o for o primeiro)
                            if (userOrder.length > 1) {
                                const arrow = document.createElement("div");
                                arrow.className =
                                    "text-gray-300 text-xl font-bold animate-fade-in";
                                arrow.innerHTML = "‚¨á";
                                dropZone.appendChild(arrow);
                            }

                            dropZone.appendChild(renderBlock(step, false)); // Renderiza vers√£o "fixa"

                            // Remove do banco (esconde visualmente ou remove do DOM)
                            const bankBlock = blocksBank.querySelector(
                                `[data-id="${step.id}"]`
                            );
                            if (bankBlock) bankBlock.remove();
                            placeholder.classList.add("hidden");
                            checkWin();
                        } else {
                            // Clicou na zona de drop? (Opcional: permitir remover/desfazer)
                            // Por simplicidade, vamos deixar apenas o bot√£o "Reiniciar"
                        }
                    };
                    const checkWin = () => {
                        // A ordem l√≥gica simplificada para este jogo: Start -> Input -> Check -> (Yes/No) -> End
                        // Como Yes/No s√£o paralelos na vida real mas sequenciais aqui, aceitamos qualquer ordem entre eles
                        // Mas Start deve ser 1¬∫, Input 2¬∫, Check 3¬∫, End √öltimo.

                        if (userOrder.length === steps.length) {
                            const isStart = userOrder[0] === "start";
                            const isInput = userOrder[1] === "input";
                            const isCheck = userOrder[2] === "check";
                            const isEnd = userOrder[userOrder.length - 1] === "end";

                            if (isStart && isInput && isCheck && isEnd) {
                                isComplete = true;
                                successMsg.classList.remove("hidden");
                                dropZone.classList.add("border-brand-green", "bg-green-50");
                                dropZone.classList.remove("border-dashed", "border-gray-300");
                            } else {
                                // Feedback visual de erro
                                dropZone.classList.add("border-brand-red", "bg-red-50");
                                setTimeout(() => {
                                    dropZone.classList.remove("border-brand-red", "bg-red-50");
                                }, 500);
                            }
                        }
                    };
                    btnReset.onclick = initGame;
                    initGame();
                },

                interactive_fraction_decimal_converter(container) {
                    // Estado Inicial
                    let num = 1;
                    let den = 2;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">O Tradutor Matem√°tico</h3>

<div class="flex flex-col md:flex-row items-center gap-8 w-full justify-center mb-8">
<div class="flex flex-col items-center gap-2 bg-blue-50 p-4 rounded-xl border border-blue-100">
<div class="flex flex-col items-center gap-1">
<input type="number" id="conv-num" value="${num}" class="w-12 text-center border-2 border-brand-blue rounded-lg font-bold text-lg outline-none text-brand-blue bg-white focus:border-brand-blueDark transition-colors">
<div class="w-full h-0.5 bg-brand-blue"></div>
<input type="number" id="conv-den" value="${den}" min="1" class="w-12 text-center border-2 border-brand-blue rounded-lg font-bold text-lg outline-none text-brand-blue bg-white focus:border-brand-blueDark transition-colors">
</div>
<span class="text-[10px] font-bold text-brand-blue uppercase">Fra√ß√£o</span>
</div>

<div class="text-3xl text-gray-300">
<i class="fas fa-arrow-right hidden md:block"></i>
<i class="fas fa-arrow-down md:hidden"></i>
</div>

<div class="flex flex-col items-center gap-2 bg-green-50 p-4 rounded-xl border border-green-100 min-w-[120px]">
<div class="text-4xl font-mono font-black text-brand-green" id="conv-res">0,5</div>
<span class="text-[10px] font-bold text-brand-green uppercase">Decimal</span>
</div>
</div>

<div class="w-full max-w-md space-y-4">

<div>
<div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-1">
<span>Fra√ß√£o</span>
<span id="label-frac-val" class="text-brand-blue">1/2</span>
</div>
<div class="relative h-8 bg-gray-100 rounded-lg overflow-hidden border border-gray-300">
<div id="bar-frac" class="absolute top-0 left-0 h-full bg-brand-blue transition-all duration-500 opacity-80" style="width: 50%"></div>
<div class="absolute inset-0" style="background-image: linear-gradient(90deg, transparent 98%, rgba(0,0,0,0.05) 98%); background-size: 10% 100%;"></div>
</div>
</div>

<div>
<div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-1">
<span>Decimal</span>
<span id="label-dec-val" class="text-brand-green">0,5</span>
</div>
<div class="relative h-8 bg-gray-100 rounded-lg overflow-hidden border border-gray-300">
<div id="bar-dec" class="absolute top-0 left-0 h-full bg-brand-green transition-all duration-500 opacity-80" style="width: 50%"></div>
<div class="absolute inset-0" style="background-image: linear-gradient(90deg, transparent 98%, rgba(0,0,0,0.05) 98%); background-size: 10% 100%;"></div>
</div>
</div>

</div>

<div class="mt-6 text-center bg-yellow-50 p-3 rounded-lg border border-yellow-200 w-full max-w-md">
<p class="text-sm text-yellow-900 font-mono" id="calc-step">1 √∑ 2 = 0,5</p>
</div>
</div>
`;

                    const nInput = container.querySelector("#conv-num");
                    const dInput = container.querySelector("#conv-den");
                    const resText = container.querySelector("#conv-res");
                    const barFrac = container.querySelector("#bar-frac");
                    const barDec = container.querySelector("#bar-dec");
                    const calcStep = container.querySelector("#calc-step");
                    const labelFrac = container.querySelector("#label-frac-val");
                    const labelDec = container.querySelector("#label-dec-val");

                    const update = () => {
                        let n = parseFloat(nInput.value) || 0;
                        let d = parseFloat(dInput.value) || 1;
                        if (d === 0) d = 1;

                        const val = n / d;

                        const valStr = val.toLocaleString("pt-BR", {
                            maximumFractionDigits: 4,
                        });

                        resText.innerText = valStr;
                        calcStep.innerHTML = `<span class="font-bold text-brand-blue">${n}</span> √∑ <span class="font-bold text-brand-blue">${d}</span> = <span class="font-bold text-brand-green">${valStr}</span>`;

                        const percent = Math.min(val * 100, 100);
                        barFrac.style.width = `${percent}%`;
                        barDec.style.width = `${percent}%`;

                        labelFrac.innerText = `${n}/${d}`;
                        labelDec.innerText = valStr;
                    };

                    nInput.addEventListener("input", update);
                    dInput.addEventListener("input", update);
                },

                interactive_conversion_game(container) {
                    // Banco de Dados de Pares
                    const pairs = [
                        { f: "1/2", d: "0,5" },
                        { f: "1/4", d: "0,25" },
                        { f: "3/4", d: "0,75" },
                        { f: "1/5", d: "0,2" },
                        { f: "2/5", d: "0,4" },
                        { f: "3/5", d: "0,6" },
                        { f: "4/5", d: "0,8" },
                        { f: "1/10", d: "0,1" },
                        { f: "3/10", d: "0,3" },
                        { f: "7/10", d: "0,7" },
                        { f: "1/8", d: "0,125" },
                        { f: "1/100", d: "0,01" },
                        { f: "5/2", d: "2,5" },
                    ];

                    let score = 0;
                    let streak = 0;
                    let currentPair = null;
                    let isFtoD = true; // Dire√ß√£o: Fra√ß√£o -> Decimal (true) ou Decimal -> Fra√ß√£o (false)

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full items-center mb-4 border-b-2 border-gray-100 pb-2">
<h3 class="text-brand-purple font-black uppercase text-xs tracking-widest"><i class="fas fa-exchange-alt"></i> Blitz da Convers√£o</h3>
<div class="flex gap-3">
<div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black shadow-sm">üî• <span id="game-streak">0</span></div>
<div class="bg-brand-green text-green-100 px-3 py-1 rounded-full text-xs font-black shadow-sm">Pts: <span id="game-score">0</span></div>
</div>
</div>

<div class="mb-6 text-center w-full">
<p class="text-xs text-gray-400 font-bold uppercase mb-2" id="q-label">Converta para Decimal</p>
<div class="bg-gray-100 text-brand-text font-mono font-black text-5xl p-6 rounded-2xl border-b-4 border-gray-300 shadow-inner flex items-center justify-center min-h-[120px] animate-pop-in" id="q-display">
?
</div>
</div>

<div class="grid grid-cols-2 gap-3 w-full max-w-sm" id="opts-grid">
</div>

<div id="feedback-msg" class="h-6 mt-4 text-sm font-bold text-center text-brand-red"></div>

</div>
`;

                    // 2. Seletores
                    const qDisplay = container.querySelector("#q-display");
                    const qLabel = container.querySelector("#q-label");
                    const optsGrid = container.querySelector("#opts-grid");
                    const scoreEl = container.querySelector("#game-score");
                    const streakEl = container.querySelector("#game-streak");
                    const fbMsg = container.querySelector("#feedback-msg");

                    // 3. L√≥gica do Jogo
                    const nextRound = () => {
                        fbMsg.innerText = "";

                        // 1. Escolhe um par
                        currentPair = pairs[Math.floor(Math.random() * pairs.length)];

                        // 2. Escolhe dire√ß√£o (50% chance)
                        isFtoD = Math.random() > 0.5;

                        const question = isFtoD ? currentPair.f : currentPair.d;
                        const answer = isFtoD ? currentPair.d : currentPair.f;

                        // 3. Atualiza UI
                        qLabel.innerText = isFtoD
                            ? "Converta para DECIMAL"
                            : "Converta para FRA√á√ÉO";
                        qDisplay.innerText = question;
                        qDisplay.classList.remove("animate-pop-in");
                        void qDisplay.offsetWidth; // Trigger reflow para reiniciar anima√ß√£o
                        qDisplay.classList.add("animate-pop-in");

                        // 4. Gera Op√ß√µes (1 Certa + 3 Erradas)
                        let options = [answer];
                        while (options.length < 4) {
                            const randomP = pairs[Math.floor(Math.random() * pairs.length)];
                            const randomOpt = isFtoD ? randomP.d : randomP.f;
                            if (!options.includes(randomOpt)) options.push(randomOpt);
                        }
                        options.sort(() => Math.random() - 0.5);

                        // 5. Renderiza Bot√µes
                        optsGrid.innerHTML = "";
                        options.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-white border-b-4 border-gray-200 text-gray-600 font-bold text-xl py-4 rounded-xl hover:bg-blue-50 hover:border-blue-200 hover:text-brand-blue transition-all active:border-b-0 active:translate-y-1";
                            btn.innerText = opt;
                            btn.onclick = () => checkAnswer(opt, answer);
                            optsGrid.appendChild(btn);
                        });
                    };

                    const checkAnswer = (selected, correct) => {
                        // Bloqueia cliques
                        const btns = optsGrid.querySelectorAll("button");

                        if (selected === correct) {
                            // Acerto
                            score += 10 + streak * 2;
                            streak++;
                            scoreEl.innerText = score;
                            streakEl.innerText = streak;

                            // Feedback Visual nos bot√µes
                            btns.forEach((b) => {
                                if (b.innerText === correct) {
                                    b.className =
                                        "bg-brand-green border-b-4 border-green-700 text-white font-bold text-xl py-4 rounded-xl transform scale-105 shadow-lg";
                                    b.innerHTML = `${b.innerText} <i class="fas fa-check ml-2"></i>`;
                                } else {
                                    b.classList.add("opacity-30");
                                }
                            });

                            setTimeout(nextRound, 800);
                        } else {
                            // Erro
                            streak = 0;
                            streakEl.innerText = streak;
                            fbMsg.innerText = `Ops! A resposta certa era ${correct}`;

                            btns.forEach((b) => {
                                if (b.innerText === selected) {
                                    b.className =
                                        "bg-brand-red border-b-4 border-red-700 text-white font-bold text-xl py-4 rounded-xl animate-shake";
                                } else if (b.innerText === correct) {
                                    b.className =
                                        "bg-green-100 border-b-4 border-green-200 text-green-800 font-bold text-xl py-4 rounded-xl";
                                }
                            });

                            setTimeout(nextRound, 1500);
                        }
                    };

                    // Init
                    nextRound();

                    // Inject CSS Shake if needed
                    if (!document.getElementById("anim-shake")) {
                        const s = document.createElement("style");
                        s.id = "anim-shake";
                        s.innerHTML = `@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } } .animate-shake { animation: shake 0.3s ease-in-out; }`;
                        container.appendChild(s);
                    }
                },

                interactive_geometry_tools(container) {
                    // Estado
                    let activeTool = "ruler";

                    // Estado Compasso
                    let compassRadius = 50;
                    let compassAngle = 0;

                    // Estado Transferidor
                    let protractorRot = 0;
                    let targetAngle = 45;

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-4 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">

<div class="flex gap-2 mb-4 bg-gray-100 p-1 rounded-xl overflow-x-auto w-full max-w-md no-scrollbar">
<button data-t="ruler" class="tool-tab flex-1 py-2 px-3 rounded-lg text-xs font-bold uppercase whitespace-nowrap transition-all bg-white text-brand-blue shadow-sm flex items-center justify-center gap-2"><i class="fas fa-ruler-horizontal"></i> R√©gua</button>
<button data-t="protractor" class="tool-tab flex-1 py-2 px-3 rounded-lg text-xs font-bold uppercase whitespace-nowrap transition-all text-gray-400 hover:bg-white flex items-center justify-center gap-2"><div class="w-4 h-2 border-t-2 border-l-2 border-r-2 border-current rounded-t-full"></div> Transf.</button>
<button data-t="squares" class="tool-tab flex-1 py-2 px-3 rounded-lg text-xs font-bold uppercase whitespace-nowrap transition-all text-gray-400 hover:bg-white flex items-center justify-center gap-2"><i class="fas fa-ruler-combined"></i> Esquadros</button>
<button data-t="compass" class="tool-tab flex-1 py-2 px-3 rounded-lg text-xs font-bold uppercase whitespace-nowrap transition-all text-gray-400 hover:bg-white flex items-center justify-center gap-2"><i class="fas fa-drafting-compass"></i> Compasso</button>
</div>

<div class="relative w-full h-80 bg-gray-50 border-2 border-dashed border-gray-200 rounded-xl overflow-hidden flex items-center justify-center" id="workspace">
</div>

<div class="mt-4 w-full max-w-sm bg-gray-50 p-3 rounded-xl border border-gray-200" id="controls-area">
</div>
</div>
`;

                    const workspace = container.querySelector("#workspace");
                    const controlsArea = container.querySelector("#controls-area");
                    const tabs = container.querySelectorAll(".tool-tab");

                    // --- RENDERIZADORES ---

                    const renderRuler = () => {
                        workspace.innerHTML = `<div class="absolute flex flex-col items-center justify-center pointer-events-none" style="width: 150px; height: 20px; background: #FF9600; border-radius: 4px; top: 30%; left: 20%;"><span class="text-white text-[10px] font-bold opacity-50">Objeto</span></div><div id="ruler-el" class="absolute w-[320px] h-14 bg-yellow-100/90 border border-yellow-600 rounded shadow-xl flex items-end px-4 cursor-grab active:cursor-grabbing" style="top: 50%; left: 10px;">${Array.from(
                            { length: 16 }
                        )
                            .map(
                                (_, i) =>
                                    `<div class="h-full flex flex-col justify-end items-center relative" style="width:20px"><div class="h-5 w-0.5 bg-black"></div><span class="text-[10px] font-mono font-bold absolute bottom-6">${i}</span><div class="absolute bottom-0 left-[5px] h-2 w-px bg-gray-400"></div><div class="absolute bottom-0 left-[10px] h-3 w-px bg-gray-600"></div><div class="absolute bottom-0 left-[15px] h-2 w-px bg-gray-400"></div></div>`
                            )
                            .join("")}</div>`;
                        controlsArea.innerHTML = `<div class="text-center text-xs text-gray-500"><i class="fas fa-hand-pointer"></i> Arraste a r√©gua para medir.</div>`;
                        const r = container.querySelector("#ruler-el");
                        let isD = false,
                            sX,
                            sY,
                            iL,
                            iT;
                        const start = (e) => {
                            isD = true;
                            const c = e.touches ? e.touches[0] : e;
                            sX = c.clientX;
                            sY = c.clientY;
                            iL = r.offsetLeft;
                            iT = r.offsetTop;
                            r.style.cursor = "grabbing";
                        };
                        const move = (e) => {
                            if (!isD) return;
                            e.preventDefault();
                            const c = e.touches ? e.touches[0] : e;
                            r.style.left = `${iL + c.clientX - sX}px`;
                            r.style.top = `${iT + c.clientY - sY}px`;
                        };
                        r.onmousedown = start;
                        r.ontouchstart = start;
                        window.onmousemove = move;
                        window.ontouchmove = move;
                        window.onmouseup = () => {
                            isD = false;
                            r.style.cursor = "grab";
                        };
                    };

                    const renderProtractor = () => {
                        let ticks = "";
                        for (let i = 0; i <= 180; i += 5) {
                            const M = i % 10 === 0;
                            ticks += `<div class="absolute bottom-0 left-1/2 origin-bottom" style="height:100%;width:1px;transform:rotate(${i - 90
                                }deg);"><div class="absolute top-2 left-0 bg-blue-900" style="width:${M ? "1.5px" : "1px"
                                };height:${M ? "10px" : "6px"}"></div></div>`;
                        }
                        workspace.innerHTML = `<div class="absolute bottom-10 left-1/2 -translate-x-1/2 w-0 h-0"><div class="absolute bottom-0 left-0 w-32 h-1 bg-black origin-left rounded-full"></div><div id="aleg" class="absolute bottom-0 left-0 w-32 h-1 bg-brand-red origin-left rounded-full transition-transform duration-300" style="transform:rotate(-${targetAngle}deg)"></div><div class="absolute bottom-[-6px] left-[-6px] w-4 h-4 bg-black rounded-full border-2 border-white z-10"></div></div><div id="pel" class="absolute w-64 h-32 bg-white/40 backdrop-blur border-2 border-blue-500 rounded-t-full shadow-xl flex justify-center items-end origin-bottom z-20" style="bottom:40px;left:50%;margin-left:-128px;transform:rotate(${protractorRot}deg);"><div class="absolute bottom-0 w-1 h-1 bg-blue-500 rounded-full z-30"></div><div class="absolute inset-0 overflow-hidden rounded-t-full">${ticks}</div></div>`;
                        controlsArea.innerHTML = `<div class="grid grid-cols-2 gap-4"><div><label class="text-[10px] font-bold text-brand-red uppercase block">√Çngulo</label><input type="range" min="0" max="180" value="${targetAngle}" class="w-full h-2 bg-red-100 rounded-lg cursor-pointer accent-brand-red" id="asl"></div><div><label class="text-[10px] font-bold text-brand-blue uppercase block">Girar</label><input type="range" min="-45" max="45" value="${protractorRot}" class="w-full h-2 bg-blue-100 rounded-lg cursor-pointer accent-brand-blue" id="rsl"></div></div>`;
                        container.querySelector("#asl").oninput = (e) => {
                            targetAngle = e.target.value;
                            container.querySelector(
                                "#aleg"
                            ).style.transform = `rotate(-${targetAngle}deg)`;
                        };
                        container.querySelector("#rsl").oninput = (e) => {
                            protractorRot = e.target.value;
                            container.querySelector(
                                "#pel"
                            ).style.transform = `rotate(${protractorRot}deg)`;
                        };
                    };

                    const renderSquares = () => {
                        workspace.innerHTML = `<div class="flex items-end justify-center gap-4 h-full pb-8"><div class="w-32 h-32 bg-purple-100 border-2 border-purple-600 hover:scale-105 transition-transform shadow-lg" style="clip-path:polygon(0 0,0 100%,100% 100%)"><span class="absolute bottom-2 left-2 text-[10px] font-bold text-purple-800">90¬∞</span></div><div class="w-24 h-40 bg-purple-100 border-2 border-purple-600 hover:scale-105 transition-transform shadow-lg" style="clip-path:polygon(0 0,0 100%,100% 100%)"><span class="absolute bottom-2 left-2 text-[10px] font-bold text-purple-800">90¬∞</span></div></div>`;
                        controlsArea.innerHTML = `<div class="text-center text-xs text-gray-400 italic">Toque nos esquadros para ver os √¢ngulos.</div>`;
                    };

                    const renderCompass = () => {
                        const legLen = 110; // Altura da perna em px

                        // C√°lculo do √¢ngulo de abertura (Trigonometria b√°sica)
                        // Raio = 2 * legLen * sin(theta)
                        // theta = asin(Raio / 2 / legLen)
                        const updateCompassVisuals = () => {
                            const thetaRad = Math.asin(compassRadius / 2 / legLen);
                            const thetaDeg = thetaRad * (180 / Math.PI);

                            // Atualiza rota√ß√µes das pernas
                            // Perna Esquerda (Agulha): Gira -theta
                            const needleLeg = container.querySelector("#needle-leg");
                            if (needleLeg)
                                needleLeg.style.transform = `rotate(-${thetaDeg}deg)`;

                            // Perna Direita (Grafite): Gira +2*theta (em rela√ß√£o √† agulha, pois est√° dentro dela ou via container relativo)
                            // Melhor: Perna direita relativa ao topo
                            const pencilLeg = container.querySelector("#pencil-leg");
                            if (pencilLeg)
                                pencilLeg.style.transform = `rotate(${thetaDeg * 2}deg)`; // Abre o dobro em rela√ß√£o √† agulha

                            // Atualiza Rota√ß√£o Geral (Desenhando)
                            const rotator = container.querySelector("#compass-rig");
                            if (rotator)
                                rotator.style.transform = `translate(-50%, -50%) rotate(${compassAngle + 90
                                    }deg)`;

                            // Atualiza SVG
                            const circ = container.querySelector("#draw-circle");
                            if (circ) {
                                const circumference = 2 * Math.PI * compassRadius;
                                const offset =
                                    circumference - circumference * (compassAngle / 360);
                                circ.setAttribute("r", compassRadius);
                                circ.style.strokeDasharray = circumference;
                                circ.style.strokeDashoffset = offset;
                            }
                        };

                        workspace.innerHTML = `
<div class="absolute inset-0 pointer-events-none">
<svg width="100%" height="100%" class="overflow-visible">
<defs>
<pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
<path d="M 20 0 L 0 0 0 20" fill="none" stroke="#f0f0f0" stroke-width="1"/>
</pattern>
</defs>
<rect width="100%" height="100%" fill="url(#grid)" />

<circle cx="50%" cy="50%" r="2" fill="black" />

<g transform="translate(0,0)" style="transform-origin: center; transform-box: fill-box;">
<circle id="draw-circle" cx="50%" cy="50%" r="${compassRadius}" 
fill="none" stroke="#FF9600" stroke-width="2" 
transform="rotate(-90)" style="transform-origin: center;" />
</g>
</svg>
</div>

<div id="compass-rig" class="absolute top-1/2 left-1/2 w-0 h-0 z-20 transition-transform duration-75">

<div id="needle-leg" class="absolute bottom-0 left-0 w-0 h-0 flex flex-col items-center justify-end origin-bottom transition-transform duration-300" style="height: ${legLen}px;">

<div class="absolute bottom-0 w-1.5 bg-gray-400 rounded-t-sm" style="height: 100%;"></div>
<div class="absolute bottom-0 w-0.5 h-2 bg-black"></div> <div class="absolute top-0 w-6 h-6 bg-gray-600 rounded-full border-2 border-gray-400 z-20 -translate-y-1/2"></div>

<div id="pencil-leg" class="absolute top-0 left-0 w-0 h-0 flex flex-col items-center origin-top transition-transform duration-300" style="height: ${legLen}px;">

<div class="absolute top-0 w-1.5 bg-orange-400 rounded-b-sm" style="height: 100%;"></div>
<div class="absolute bottom-0 w-2 h-4 bg-orange-600 rounded-b-sm"></div> </div>

</div>

</div>
`;

                        controlsArea.innerHTML = `
 <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label class="text-[10px] font-bold text-gray-400 uppercase mb-1 block">Abertura (Raio)</label>
<input type="range" min="20" max="100" value="${compassRadius}" class="w-full h-2 bg-gray-200 rounded-lg cursor-pointer accent-brand-text" id="radius-slider">
</div>
<div>
<label class="text-[10px] font-bold text-brand-orange uppercase mb-1 block">Girar e Riscar</label>
<input type="range" min="0" max="360" value="${compassAngle}" class="w-full h-2 bg-orange-100 rounded-lg cursor-pointer accent-brand-orange" id="draw-slider">
</div>
</div>
`;

                        const rSlider = container.querySelector("#radius-slider");
                        const dSlider = container.querySelector("#draw-slider");

                        rSlider.oninput = (e) => {
                            compassRadius = parseInt(e.target.value);
                            compassAngle = 0;
                            dSlider.value = 0;
                            updateCompassVisuals();
                        };

                        dSlider.oninput = (e) => {
                            compassAngle = parseInt(e.target.value);
                            updateCompassVisuals();
                        };

                        // Render inicial
                        updateCompassVisuals();
                    };

                    // Tabs Logic
                    tabs.forEach((tab) => {
                        tab.onclick = () => {
                            activeTool = tab.dataset.t;
                            tabs.forEach((t) => {
                                const isActive = t.dataset.t === activeTool;
                                t.className = `tool-tab flex-1 py-2 px-3 rounded-lg text-xs font-bold uppercase whitespace-nowrap transition-all flex items-center justify-center gap-2 ${isActive
                                    ? "bg-white text-brand-blue shadow-sm"
                                    : "text-gray-400 hover:bg-white"
                                    }`;
                            });
                            if (activeTool === "ruler") renderRuler();
                            else if (activeTool === "protractor") renderProtractor();
                            else if (activeTool === "squares") renderSquares();
                            else if (activeTool === "compass") renderCompass();
                        };
                    });

                    // Init
                    renderRuler();
                },

                interactive_estimation_game(container) {
                    // 1. Dados do Jogo (Perguntas Curadas para ensinar estrat√©gias)
                    const questions = [
                        {
                            q: "19 √ó 21",
                            options: [40, 400, 4000],
                            correct: 1,
                            logic:
                                "19 √© perto de 20. 21 √© perto de 20.<br><strong>20 √ó 20 = 400</strong>",
                        },
                        {
                            q: "498 + 305",
                            options: [80, 800, 8000],
                            correct: 1,
                            logic:
                                "Arredonde para centenas:<br><strong>500 + 300 = 800</strong>",
                        },
                        {
                            q: "102 √∑ 5",
                            options: [2, 20, 200],
                            correct: 1,
                            logic: "102 √© quase 100.<br><strong>100 √∑ 5 = 20</strong>",
                        },
                        {
                            q: "9,9 √ó 7,1",
                            options: [7, 70, 700],
                            correct: 1,
                            logic:
                                "9,9 vira 10. 7,1 vira 7.<br><strong>10 √ó 7 = 70</strong>",
                        },
                        {
                            q: "3.100 - 98",
                            options: [2000, 3000, 4000],
                            correct: 1,
                            logic:
                                "Tirar 98 √© quase tirar 100.<br><strong>3100 - 100 = 3000</strong>",
                        },
                    ];

                    let currentIdx = 0;
                    let score = 0;
                    let isAnswered = false;

                    // 2. Inje√ß√£o do HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full items-center mb-6 border-b-2 border-gray-100 pb-2">
<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest"><i class="fas fa-bullseye"></i> Alvo Aproximado</h3>
<div class="text-xs font-bold text-gray-400">Quest√£o <span id="q-num">1</span>/${questions.length}</div>
</div>

<div class="absolute top-0 left-0 h-1 bg-brand-green transition-all duration-500" id="progress-bar" style="width: 0%"></div>

<div class="bg-gray-800 text-white font-mono text-4xl md:text-5xl p-6 rounded-xl w-full text-center mb-8 shadow-inner border-4 border-gray-600 flex items-center justify-center min-h-[100px]">
<span id="question-text" class="tracking-widest animate-pop-in">${questions[0].q}</span>
</div>

<div class="grid grid-cols-3 gap-3 w-full mb-6" id="options-container">
</div>

<div id="feedback-area" class="w-full bg-gray-50 rounded-xl p-4 border-2 border-gray-100 text-center hidden">
<div id="feedback-icon" class="text-4xl mb-2"></div>
<h4 id="feedback-title" class="font-black text-lg uppercase mb-1"></h4>
<p id="feedback-logic" class="text-sm text-gray-600 font-medium"></p>
<button id="next-btn" class="mt-4 bg-brand-blue text-white font-bold py-2 px-6 rounded-lg shadow-btn active:translate-y-1 active:shadow-none transition-all w-full">
Pr√≥ximo <i class="fas fa-arrow-right"></i>
</button>
</div>

<div id="final-screen" class="hidden flex-col items-center text-center py-8">
<div class="text-6xl mb-4">üèÜ</div>
<h3 class="text-2xl font-black text-brand-text mb-2">Fim de Jogo!</h3>
<p class="text-gray-500 mb-6">Voc√™ acertou <strong class="text-brand-green" id="final-score">0</strong> de ${questions.length} estimativas.</p>
<button onclick="app.renderLesson(document.getElementById('main-container'), app.currentLessonName)" class="bg-gray-200 text-gray-600 font-bold py-2 px-6 rounded-lg hover:bg-gray-300 transition-colors">
<i class="fas fa-redo"></i> Jogar Novamente
</button>
</div>

</div>
`;

                    // 3. Seletores
                    const qNum = container.querySelector("#q-num");
                    const progressBar = container.querySelector("#progress-bar");
                    const qText = container.querySelector("#question-text");
                    const optsContainer = container.querySelector("#options-container");
                    const feedbackArea = container.querySelector("#feedback-area");
                    const feedbackIcon = container.querySelector("#feedback-icon");
                    const feedbackTitle = container.querySelector("#feedback-title");
                    const feedbackLogic = container.querySelector("#feedback-logic");
                    const nextBtn = container.querySelector("#next-btn");
                    const finalScreen = container.querySelector("#final-screen");
                    const finalScore = container.querySelector("#final-score");

                    // 4. Fun√ß√£o de Renderiza√ß√£o da Pergunta
                    const renderQuestion = () => {
                        isAnswered = false;
                        const q = questions[currentIdx];

                        // Atualiza UI
                        qNum.innerText = currentIdx + 1;
                        qText.innerText = q.q;
                        progressBar.style.width = `${(currentIdx / questions.length) * 100
                            }%`;

                        feedbackArea.classList.add("hidden");
                        optsContainer.classList.remove("hidden");
                        optsContainer.innerHTML = ""; // Limpa bot√µes antigos

                        // Cria bot√µes
                        q.options.forEach((opt, idx) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-white border-2 border-brand-blue text-brand-blue text-xl md:text-2xl font-bold py-4 rounded-xl shadow-sm hover:bg-blue-50 active:scale-95 transition-all transform hover:-translate-y-1";
                            btn.innerText = opt.toLocaleString("pt-BR"); // Formata milhar (4.000)

                            btn.onclick = () => checkAnswer(idx, btn);
                            optsContainer.appendChild(btn);
                        });
                    };

                    // 5. L√≥gica de Verifica√ß√£o
                    const checkAnswer = (selectedIdx, btnElement) => {
                        if (isAnswered) return;
                        isAnswered = true;

                        const q = questions[currentIdx];
                        const isCorrect = selectedIdx === q.correct;

                        // Estiliza os bot√µes
                        const allBtns = optsContainer.querySelectorAll("button");
                        allBtns.forEach((b, i) => {
                            b.classList.add("cursor-default", "pointer-events-none"); // Trava cliques
                            if (i === q.correct) {
                                b.className =
                                    "bg-brand-green border-2 border-green-600 text-white text-xl md:text-2xl font-bold py-4 rounded-xl shadow-md transform scale-105 z-10"; // Correto destaca
                                b.innerHTML += ' <i class="fas fa-check ml-1"></i>';
                            } else if (i === selectedIdx && !isCorrect) {
                                b.className =
                                    "bg-brand-red border-2 border-red-600 text-white text-xl md:text-2xl font-bold py-4 rounded-xl opacity-50"; // Errado apaga
                            } else {
                                b.classList.add("opacity-30"); // Outros somem
                            }
                        });

                        // Mostra Feedback
                        feedbackArea.classList.remove("hidden");
                        feedbackArea.classList.add("animate-slide-up");

                        if (isCorrect) {
                            score++;
                            feedbackIcon.innerHTML = "üéØ";
                            feedbackTitle.className =
                                "font-black text-lg uppercase mb-1 text-brand-green";
                            feedbackTitle.innerText = "Na Mosca!";
                        } else {
                            feedbackIcon.innerHTML = "üòÖ";
                            feedbackTitle.className =
                                "font-black text-lg uppercase mb-1 text-brand-orange";
                            feedbackTitle.innerText = "Quase!";
                        }

                        feedbackLogic.innerHTML = q.logic;

                        // Bot√£o Pr√≥ximo
                        if (currentIdx === questions.length - 1) {
                            nextBtn.innerText = "Ver Resultado";
                        }
                    };

                    // 6. Listener Pr√≥ximo
                    nextBtn.onclick = () => {
                        currentIdx++;
                        if (currentIdx < questions.length) {
                            renderQuestion();
                        } else {
                            // Fim do Jogo
                            container.querySelector(".border-b-2").classList.add("hidden"); // Esconde header
                            container.querySelector(".bg-gray-800").classList.add("hidden"); // Esconde display
                            optsContainer.classList.add("hidden");
                            feedbackArea.classList.add("hidden");
                            progressBar.style.width = "100%";

                            finalScreen.classList.remove("hidden");
                            finalScreen.classList.add("flex", "animate-pop-in");
                            finalScore.innerText = score;
                        }
                    };

                    // Init
                    renderQuestion();
                },

                interactive_fraction_operator(container) {
                    // Estado Inicial
                    let total = 12;
                    let num = 2;
                    let den = 3;

                    // 1. Inje√ß√£o do HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-6">Calculadora Visual de Fra√ß√µes</h3>

<div class="flex flex-col md:flex-row gap-6 items-center justify-center w-full mb-8">

<div class="flex items-center gap-2">
<div class="flex flex-col items-center gap-1">
<input type="number" id="in-num" value="${num}" min="1" class="w-12 text-center border-2 border-brand-orange rounded-lg font-bold text-lg outline-none text-brand-orange focus:bg-orange-50">
<div class="w-full h-0.5 bg-gray-400"></div>
<input type="number" id="in-den" value="${den}" min="1" class="w-12 text-center border-2 border-brand-blue rounded-lg font-bold text-lg outline-none text-brand-blue focus:bg-blue-50">
</div>
<span class="text-xl font-black text-gray-400">DE</span>

<div class="flex flex-col items-center">
<input type="number" id="in-total" value="${total}" min="1" max="50" class="w-16 text-center border-2 border-gray-300 rounded-lg font-bold text-xl outline-none text-gray-600 focus:border-brand-text">
<span class="text-[10px] font-bold text-gray-400 uppercase mt-1">Total</span>
</div>
</div>

<div class="text-2xl font-black text-gray-300">=</div>

<div class="flex flex-col items-center">
<div id="res-val" class="text-4xl font-black text-brand-green animate-pop-in">8</div>
<span class="text-[10px] font-bold text-brand-green uppercase">Resultado</span>
</div>

</div>

<div class="w-full bg-gray-50 rounded-xl border-2 border-dashed border-gray-200 p-4 relative">
<div id="groups-container" class="flex flex-wrap justify-center gap-4"></div>

<div id="step-explain" class="mt-4 text-center text-sm font-mono text-gray-500 bg-white p-2 rounded border border-gray-100 shadow-sm">
Dividimos ${total} em ${den} grupos de <span class="font-bold">?</span>.
</div>
</div>

</div>
`;

                    // 2. Seletores
                    const inNum = container.querySelector("#in-num");
                    const inDen = container.querySelector("#in-den");
                    const inTotal = container.querySelector("#in-total");
                    const resVal = container.querySelector("#res-val");
                    const groupsContainer =
                        container.querySelector("#groups-container");
                    const stepExplain = container.querySelector("#step-explain");

                    // 3. L√≥gica de Atualiza√ß√£o
                    const update = () => {
                        // Pega valores
                        let n = parseInt(inNum.value) || 1;
                        let d = parseInt(inDen.value) || 1;
                        let t = parseInt(inTotal.value) || 1;

                        // Valida√ß√µes simples para UX
                        if (d > t) d = t; // N√£o d√° pra dividir em mais grupos que itens
                        if (n > d) n = d; // Fra√ß√£o pr√≥pria para visualiza√ß√£o f√°cil
                        // if (t % d !== 0) ... podemos deixar quebrado ou avisar, mas vamos arredondar visualmente

                        // C√°lculo
                        const valPerGroup = t / d;
                        const result = (t / d) * n;

                        // Atualiza Resultado Num√©rico
                        // Se for inteiro mostra inteiro, sen√£o 2 casas
                        resVal.innerText = Number.isInteger(result)
                            ? result
                            : result.toFixed(2).replace(".", ",");

                        // Atualiza Explica√ß√£o
                        const isExact = Number.isInteger(valPerGroup);
                        if (isExact) {
                            stepExplain.innerHTML = `
1. Dividimos <strong>${t}</strong> por <strong class="text-brand-blue">${d}</strong> = <strong>${valPerGroup}</strong> por grupo.<br>
2. Pegamos <strong class="text-brand-orange">${n}</strong> grupos de <strong>${valPerGroup}</strong> = <strong class="text-brand-green">${result}</strong>.
`;
                        } else {
                            stepExplain.innerHTML = `
<span class="text-brand-orange"><i class="fas fa-exclamation-circle"></i> Divis√£o n√£o exata!</span><br>
O resultado √© aproximadamente <strong>${result
                                    .toFixed(2)
                                    .replace(".", ",")}</strong>.
`;
                        }

                        // Renderiza Grupos Visuais (Apenas se for exato e total < 100 para n√£o travar)
                        groupsContainer.innerHTML = "";

                        if (isExact && t <= 50) {
                            for (let i = 0; i < d; i++) {
                                // Cria o Grupo
                                const group = document.createElement("div");
                                const isSelected = i < n;

                                // Estilo do Grupo
                                const borderColor = isSelected
                                    ? "border-brand-orange"
                                    : "border-gray-300";
                                const bgColor = isSelected ? "bg-orange-50" : "bg-white";
                                const opacity = isSelected ? "opacity-100" : "opacity-50";

                                group.className = `border-2 ${borderColor} ${bgColor} ${opacity} rounded-lg p-2 flex flex-wrap gap-1 justify-center items-center transition-all duration-500`;
                                group.style.minWidth = "40px";
                                group.style.minHeight = "40px";

                                // Adiciona Bolinhas dentro do grupo
                                for (let j = 0; j < valPerGroup; j++) {
                                    const dot = document.createElement("div");
                                    const dotColor = isSelected
                                        ? "bg-brand-orange"
                                        : "bg-gray-300";
                                    dot.className = `w-3 h-3 rounded-full ${dotColor} transition-colors duration-500`;
                                    group.appendChild(dot);
                                }

                                // Label do Grupo (Opcional)
                                // if (isSelected) {
                                // const label = document.createElement('div');
                                // label.className = "absolute -top-2 -right-2 bg-brand-orange text-white text-[8px] px-1 rounded";
                                // label.innerText = "PEGUEI";
                                // group.style.position = "relative";
                                // group.appendChild(label);
                                // }

                                groupsContainer.appendChild(group);
                            }
                        } else if (!isExact) {
                            groupsContainer.innerHTML = `<div class="text-gray-400 text-sm py-8">Visualiza√ß√£o dispon√≠vel apenas para divis√µes exatas.</div>`;
                        } else {
                            groupsContainer.innerHTML = `<div class="text-gray-400 text-sm py-8">Muitos itens para desenhar! O c√°lculo continua certo.</div>`;
                        }
                    };

                    // 4. Listeners
                    inNum.addEventListener("input", update);
                    inDen.addEventListener("input", update);
                    inTotal.addEventListener("input", update);

                    // Init
                    update();
                },

                interactive_equation_steps(container) {
                    // 1. Estilos CSS para a anima√ß√£o espec√≠fica deste widget
                    const style = document.createElement("style");
                    style.innerHTML = `
@keyframes jumpOver {
0% { transform: translate(0, 0); color: #1CB0F6; }
40% { transform: translate(0, -40px) scale(1.1); color: #1CB0F6; }
50% { transform: translate(60px, -40px) scale(1.1); color: #FF4B4B; } /* Troca de cor no ar */
100% { transform: translate(120px, 0) scale(1); color: #FF4B4B; }
}
.animate-jump { animation: jumpOver 1.2s forwards ease-in-out; }
.fade-out { opacity: 0; pointer-events: none; transition: opacity 0.5s; }
.fade-in { opacity: 1; transition: opacity 0.5s; }
`;
                    container.appendChild(style);

                    // 2. HTML Estrutural
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none h-[320px] relative overflow-hidden">

<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-8">Resolvendo: x + 5 = 20</h3>

<div class="relative flex items-center justify-center gap-4 text-4xl md:text-5xl font-mono font-bold text-brand-text w-full mb-8">
<div class="flex gap-4 relative" id="lhs">
<span class="text-brand-purple transition-all duration-500" id="term-x">x</span>
<span id="term-num" class="text-brand-blue inline-block relative z-10">+ 5</span>
</div>

<span class="text-gray-300">=</span>

<div class="flex gap-4 relative" id="rhs">
<span id="term-res">20</span>
<span id="landing-spot" class="text-brand-red opacity-0 w-0 transition-all duration-500">- 5</span> 
</div>
</div>

<div id="control-panel" class="w-full max-w-xs text-center transition-all duration-500 absolute bottom-6">
<p class="text-sm text-gray-500 mb-4 font-medium" id="instruction">
O <strong class="text-brand-blue">+5</strong> est√° somando. Para deixar o <strong>x</strong> sozinho, o que fazemos?
</p>

<div class="grid grid-cols-2 gap-3">
<button class="action-btn bg-white border-2 border-gray-200 text-gray-400 font-bold py-3 rounded-xl hover:bg-red-50 hover:border-red-200 hover:text-red-400 transition-all" onclick="app.widgets.shakeEq(this)">
+ 5
</button>
<button id="btn-correct" class="action-btn bg-brand-blue text-white font-bold py-3 rounded-xl shadow-[0_4px_0_#1899D6] active:shadow-none active:translate-y-[4px] transition-all border-b-4 border-brand-blueDark">
- 5 (Inverso)
</button>
</div>
</div>

<div id="success-msg" class="absolute bottom-6 flex-col items-center translate-y-20 opacity-0 transition-all duration-500 flex">
<div class="text-brand-green font-black text-3xl mb-2 bg-green-50 px-6 py-2 rounded-xl border-2 border-brand-green">x = 15</div>
<button id="btn-reset" class="text-xs text-gray-400 font-bold uppercase hover:text-brand-blue flex items-center gap-2 mt-2 p-2">
<i class="fas fa-undo"></i> Reiniciar
</button>
</div>

</div>
`;

                    // 3. Seletores e L√≥gica
                    const termNum = container.querySelector("#term-num");
                    const termX = container.querySelector("#term-x"); // Para centralizar depois
                    const termRes = container.querySelector("#term-res");
                    const landingSpot = container.querySelector("#landing-spot");
                    const btnCorrect = container.querySelector("#btn-correct");
                    const controlPanel = container.querySelector("#control-panel");
                    const successMsg = container.querySelector("#success-msg");
                    const instruction = container.querySelector("#instruction");
                    const btnReset = container.querySelector("#btn-reset");

                    // Fun√ß√£o de Erro (Tremida)
                    app.widgets.shakeEq = (btn) => {
                        btn.classList.add(
                            "animate-pulse",
                            "bg-red-100",
                            "border-red-300"
                        );
                        setTimeout(
                            () =>
                                btn.classList.remove(
                                    "animate-pulse",
                                    "bg-red-100",
                                    "border-red-300"
                                ),
                            500
                        );
                        instruction.innerHTML =
                            "<span class='text-brand-red'>N√£o!</span> Se ele est√° somando, somar mais vai piorar!";
                    };

                    // Fun√ß√£o Principal: A Anima√ß√£o
                    btnCorrect.onclick = async () => {
                        // 1. Bloqueia bot√µes
                        btnCorrect.disabled = true;

                        // 2. Anima√ß√£o do Pulo
                        // O CSS keyframe 'jumpOver' cuida do movimento e da troca de cor
                        termNum.classList.add("animate-jump");

                        // 3. Espera a anima√ß√£o (1.2s)
                        await new Promise((r) => setTimeout(r, 1200));

                        // 4. Ajuste do Layout p√≥s-pulo
                        termNum.classList.add("hidden"); // Esconde o original que voou
                        landingSpot.classList.remove("opacity-0", "w-0"); // Mostra o novo no lugar certo

                        // Centraliza o X visualmente (opcional, mas fica bonito)
                        // termX.classList.add('translate-x-8');

                        // 5. Fase de C√°lculo
                        instruction.innerText = "Agora resolva: 20 - 5 = ?";

                        // Troca os bot√µes por "Calcular"
                        controlPanel.innerHTML = `
<button class="bg-brand-green text-white font-bold py-3 px-8 rounded-xl shadow-[0_4px_0_#46A302] active:shadow-none active:translate-y-[4px] text-xl w-full animate-pop-in" id="btn-calc">
Calcular
</button>
`;

                        const btnCalc = container.querySelector("#btn-calc");

                        btnCalc.onclick = () => {
                            // 6. Finaliza√ß√£o
                            controlPanel.classList.add("opacity-0", "translate-y-10"); // Esconde painel
                            landingSpot.classList.add("hidden"); // Some o -5
                            termRes.classList.add("hidden"); // Some o 20

                            successMsg.classList.remove("translate-y-20", "opacity-0"); // Sobe o sucesso
                        };
                    };

                    btnReset.onclick = () => {
                        app.renderLesson(
                            document.getElementById("main-container"),
                            app.currentLessonName
                        );
                    };
                },

                interactive_place_value_extended(container) {
                    // 1. Inje√ß√£o do HTML (Layout e Estilos)
                    // Usamos classes gen√©ricas para selecionar os elementos depois (ex: .pv-grid)
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full font-sans shadow-sm">
<p class="text-xs font-bold text-brand-blue mb-4 uppercase tracking-wide">DIGITE UM N√öMERO (Max 12 d√≠gitos)</p>

<input type="number" value="1234567890" min="0" max="999999999999" 
class="text-3xl md:text-4xl font-extrabold text-center w-full max-w-md p-3 rounded-xl border-2 border-brand-gray focus:border-brand-blue outline-none mb-6 bg-brand-bg text-brand-text transition-colors placeholder-gray-300">

<!-- O Grid onde os blocos ser√£o gerados dinamicamente -->
<div class="pv-grid grid grid-flow-col auto-cols-max gap-4 overflow-x-auto w-full pb-4 justify-start md:justify-center scrollbar-hide"></div>
</div>
`;

                    // 2. Sele√ß√£o de Elementos (Escopado ao container atual)
                    // Usamos container.querySelector para pegar APENAS os elementos deste widget espec√≠fico
                    const input = container.querySelector("input");
                    const grid = container.querySelector(".pv-grid");

                    // 3. Defini√ß√£o das Classes/Cores
                    const classes = [
                        {
                            name: "Unidades",
                            color: "border-brand-purple text-brand-purple bg-purple-50",
                        },
                        {
                            name: "Milhares",
                            color: "border-brand-blue text-brand-blue bg-blue-50",
                        },
                        {
                            name: "Milh√µes",
                            color: "border-brand-red text-brand-red bg-red-50",
                        },
                        {
                            name: "Bilh√µes",
                            color: "border-brand-orange text-brand-orange bg-orange-50",
                        },
                    ];

                    // 4. L√≥gica de Atualiza√ß√£o (Encapsulada aqui dentro)
                    const update = () => {
                        // Limita a 12 d√≠gitos para n√£o quebrar o layout
                        if (input.value.length > 12)
                            input.value = input.value.slice(0, 12);

                        const val = input.value;
                        grid.innerHTML = ""; // Limpa o grid atual

                        // L√≥gica: Reverte string -> Agrupa de 3 em 3 -> Gera HTML
                        let reversed = val.split("").reverse().join("");
                        let groups = reversed.match(/.{1,3}/g) || [];

                        groups.forEach((group, groupIndex) => {
                            if (groupIndex >= classes.length) return;

                            const cls = classes[groupIndex];

                            // Cria o container do grupo (Ex: Milhares)
                            const groupContainer = document.createElement("div");

                            // Extrai as cores da string de configura√ß√£o
                            const borderColor = cls.color.split(" ")[0];
                            const textColor = cls.color.split(" ")[1];
                            const bgColor = cls.color.split(" ")[2];

                            groupContainer.className = `flex flex-col items-center border-2 ${borderColor} rounded-xl p-2 ${bgColor} min-w-[100px] animate-fade-in`;

                            // Gera os d√≠gitos individuais (C, D, U)
                            let digitsHtml = '<div class="flex gap-1">';
                            const normalGroup = group.split("").reverse().join(""); // Desvira o n√∫mero (321 -> 123)

                            normalGroup.split("").forEach((d, i) => {
                                // Calcula label (C, D, U) baseado na posi√ß√£o
                                const pos = normalGroup.length - 1 - i;
                                const label = ["U", "D", "C"][pos];

                                digitsHtml += `
<div class="flex flex-col items-center bg-white rounded p-1 w-8 shadow-sm">
<span class="text-xl font-bold text-brand-text">${d}</span>
<span class="text-[10px] text-gray-400 font-bold border-t border-gray-100 w-full text-center mt-1">${label}</span>
</div>`;
                            });
                            digitsHtml += "</div>";

                            // Junta tudo
                            groupContainer.innerHTML = `
<span class="text-xs font-bold uppercase mb-2 ${textColor}">${cls.name}</span>
${digitsHtml}
`;

                            // Insere no in√≠cio (prepend) para que Bilh√µes fiquem √† esquerda
                            grid.prepend(groupContainer);
                        });
                    };

                    // 5. Adiciona o Event Listener e Roda a primeira vez
                    input.addEventListener("input", update);
                    update();
                },

                renderVerticalCalc(c, op) {
                    const sym = op === "*" ? "√ó" : op;
                    const res = op === "+" ? 468 : op === "-" ? 125 : 48;
                    const n1 = op === "+" ? 125 : op === "-" ? 450 : 12;
                    const n2 = op === "+" ? 343 : op === "-" ? 325 : 4;
                    c.innerHTML = `
<div class="bg-white border-2 border-gray-200 rounded-3xl p-8 flex justify-center shadow-sm hover:shadow-md transition-shadow">
<div class="font-mono text-3xl md:text-4xl text-right tracking-widest text-brand-text">
<div>${n1}</div>
<div class="border-b-4 border-brand-text pr-2 mb-2 pb-1 relative"><span class="absolute left-[-40px] text-brand-blue font-bold">${sym}</span>${n2}</div>
<div class="font-black text-brand-green fade-in">${res}</div>
</div>
</div>`;
                },

                interactive_addition_vertical(container) {
                    // 1. Configura√ß√£o Espec√≠fica da Adi√ß√£o
                    const config = {
                        symbol: "+",
                        colorText: "text-brand-blue",
                        colorBorder: "border-brand-blue", // Para foco
                        labels: ["Parcela 1", "Parcela 2", "Soma"],
                    };

                    // 2. Inje√ß√£o do HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col md:flex-row items-center justify-center gap-8 shadow-sm">
<div class="flex flex-col gap-4">
<div class="flex flex-col gap-1">
<label class="text-[10px] font-bold text-gray-400 uppercase tracking-wide">${config.labels[0]}</label>
<input type="number" class="input-v1 border-2 border-brand-gray rounded-lg p-2 w-28 text-center font-bold text-xl outline-none focus:${config.colorBorder} transition-colors text-brand-text" value="125">
</div>
<div class="flex flex-col gap-1">
<label class="text-[10px] font-bold text-gray-400 uppercase tracking-wide">${config.labels[1]}</label>
<input type="number" class="input-v2 border-2 border-brand-gray rounded-lg p-2 w-28 text-center font-bold text-xl outline-none focus:${config.colorBorder} transition-colors text-brand-text" value="48">
</div>
</div>

<div class="display-area bg-gray-50 p-6 rounded-xl border-2 border-gray-100 min-w-[180px] flex flex-col items-end font-mono text-4xl shadow-inner select-none cursor-default">
</div>
</div>
`;

                    // 3. Seletores Escopados
                    const inputV1 = container.querySelector(".input-v1");
                    const inputV2 = container.querySelector(".input-v2");
                    const display = container.querySelector(".display-area");

                    // 4. Fun√ß√£o de Atualiza√ß√£o
                    const update = () => {
                        const v1 = parseInt(inputV1.value) || 0;
                        const v2 = parseInt(inputV2.value) || 0;
                        const res = v1 + v2; // L√≥gica da SOMA

                        // Renderiza a conta armada com labels flutuantes (hover)
                        display.innerHTML = `
<div class="relative w-full text-right group mb-1">
${v1}
<span class="absolute -right-32 top-1 text-xs font-sans text-gray-400 opacity-0 group-hover:opacity-100 bg-white p-1 shadow rounded border z-10 w-24 text-center transition-opacity pointer-events-none font-bold uppercase">${config.labels[0]}</span>
</div>

<div class="relative w-full text-right border-b-4 border-brand-text pr-2 group pb-1">
<span class="absolute left-0 ${config.colorText}">${config.symbol}</span> 
${v2}
<span class="absolute -right-32 top-1 text-xs font-sans text-gray-400 opacity-0 group-hover:opacity-100 bg-white p-1 shadow rounded border z-10 w-24 text-center transition-opacity pointer-events-none font-bold uppercase">${config.labels[1]}</span>
</div>

<div class="relative w-full text-right ${config.colorText} pt-2 group font-extrabold">
${res}
<span class="absolute -right-32 top-3 text-xs font-sans text-gray-400 opacity-0 group-hover:opacity-100 bg-white p-1 shadow rounded border z-10 w-24 text-center transition-opacity pointer-events-none font-bold uppercase">${config.labels[2]}</span>
</div>
`;
                    };

                    // 5. Listeners
                    inputV1.addEventListener("input", update);
                    inputV2.addEventListener("input", update);
                    update();
                },

                interactive_subtraction_vertical(container) {
                    // 1. Configura√ß√£o Espec√≠fica da Subtra√ß√£o
                    const config = {
                        symbol: "-",
                        colorText: "text-brand-red",
                        colorBorder: "border-brand-red", // Para foco
                        labels: ["Minuendo", "Subtraendo", "Diferen√ßa"],
                    };

                    // 2. Inje√ß√£o do HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col md:flex-row items-center justify-center gap-8 shadow-sm">
<div class="flex flex-col gap-4">
<div class="flex flex-col gap-1">
<label class="text-[10px] font-bold text-gray-400 uppercase tracking-wide">${config.labels[0]}</label>
<input type="number" class="input-v1 border-2 border-brand-gray rounded-lg p-2 w-28 text-center font-bold text-xl outline-none focus:${config.colorBorder} transition-colors text-brand-text" value="125">
</div>
<div class="flex flex-col gap-1">
<label class="text-[10px] font-bold text-gray-400 uppercase tracking-wide">${config.labels[1]}</label>
<input type="number" class="input-v2 border-2 border-brand-gray rounded-lg p-2 w-28 text-center font-bold text-xl outline-none focus:${config.colorBorder} transition-colors text-brand-text" value="48">
</div>
</div>

<div class="display-area bg-gray-50 p-6 rounded-xl border-2 border-gray-100 min-w-[180px] flex flex-col items-end font-mono text-4xl shadow-inner select-none cursor-default">
</div>
</div>
`;

                    // 3. Seletores Escopados
                    const inputV1 = container.querySelector(".input-v1");
                    const inputV2 = container.querySelector(".input-v2");
                    const display = container.querySelector(".display-area");

                    // 4. Fun√ß√£o de Atualiza√ß√£o
                    const update = () => {
                        const v1 = parseInt(inputV1.value) || 0;
                        const v2 = parseInt(inputV2.value) || 0;
                        const res = v1 - v2; // L√≥gica da SUBTRA√á√ÉO

                        display.innerHTML = `
<div class="relative w-full text-right group mb-1">
${v1}
<span class="absolute -right-32 top-1 text-xs font-sans text-gray-400 opacity-0 group-hover:opacity-100 bg-white p-1 shadow rounded border z-10 w-24 text-center transition-opacity pointer-events-none font-bold uppercase">${config.labels[0]}</span>
</div>

<div class="relative w-full text-right border-b-4 border-brand-text pr-2 group pb-1">
<span class="absolute left-0 ${config.colorText}">${config.symbol}</span> 
${v2}
<span class="absolute -right-32 top-1 text-xs font-sans text-gray-400 opacity-0 group-hover:opacity-100 bg-white p-1 shadow rounded border z-10 w-24 text-center transition-opacity pointer-events-none font-bold uppercase">${config.labels[1]}</span>
</div>

<div class="relative w-full text-right ${config.colorText} pt-2 group font-extrabold">
${res}
<span class="absolute -right-32 top-3 text-xs font-sans text-gray-400 opacity-0 group-hover:opacity-100 bg-white p-1 shadow rounded border z-10 w-24 text-center transition-opacity pointer-events-none font-bold uppercase">${config.labels[2]}</span>
</div>
`;
                    };

                    // 5. Listeners
                    inputV1.addEventListener("input", update);
                    inputV2.addEventListener("input", update);
                    update();
                },

                interactive_multiplication_vertical(container) {
                    // 1. Configura√ß√£o
                    const config = {
                        symbol: "√ó",
                        colorText: "text-brand-purple",
                        colorBorder: "border-brand-purple",
                        labels: ["Fator 1", "Fator 2", "Produto"],
                    };

                    // 2. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col md:flex-row items-center justify-center gap-8 shadow-sm">
<div class="flex flex-col gap-4">
<div class="flex flex-col gap-1">
<label class="text-[10px] font-bold text-gray-400 uppercase tracking-wide">${config.labels[0]}</label>
<input type="number" class="input-v1 border-2 border-brand-gray rounded-lg p-2 w-28 text-center font-bold text-xl outline-none focus:${config.colorBorder} transition-colors text-brand-text" value="12">
</div>
<div class="flex flex-col gap-1">
<label class="text-[10px] font-bold text-gray-400 uppercase tracking-wide">${config.labels[1]}</label>
<input type="number" class="input-v2 border-2 border-brand-gray rounded-lg p-2 w-28 text-center font-bold text-xl outline-none focus:${config.colorBorder} transition-colors text-brand-text" value="4">
</div>
</div>

<div class="display-area bg-gray-50 p-6 rounded-xl border-2 border-gray-100 min-w-[180px] flex flex-col items-end font-mono text-4xl shadow-inner select-none cursor-default">
</div>
</div>
`;

                    // 3. Seletores e L√≥gica
                    const inputV1 = container.querySelector(".input-v1");
                    const inputV2 = container.querySelector(".input-v2");
                    const display = container.querySelector(".display-area");

                    const update = () => {
                        const v1 = parseInt(inputV1.value) || 0;
                        const v2 = parseInt(inputV2.value) || 0;
                        const res = v1 * v2;

                        display.innerHTML = `
<div class="relative w-full text-right group mb-1">
${v1}
<span class="absolute -right-32 top-1 text-xs font-sans text-gray-400 opacity-0 group-hover:opacity-100 bg-white p-1 shadow rounded border z-10 w-24 text-center transition-opacity pointer-events-none font-bold uppercase">${config.labels[0]}</span>
</div>

<div class="relative w-full text-right border-b-4 border-brand-text pr-2 group pb-1">
<span class="absolute left-0 ${config.colorText}">${config.symbol}</span> 
${v2}
<span class="absolute -right-32 top-1 text-xs font-sans text-gray-400 opacity-0 group-hover:opacity-100 bg-white p-1 shadow rounded border z-10 w-24 text-center transition-opacity pointer-events-none font-bold uppercase">${config.labels[1]}</span>
</div>

<div class="relative w-full text-right ${config.colorText} pt-2 group font-extrabold">
${res}
<span class="absolute -right-32 top-3 text-xs font-sans text-gray-400 opacity-0 group-hover:opacity-100 bg-white p-1 shadow rounded border z-10 w-24 text-center transition-opacity pointer-events-none font-bold uppercase">${config.labels[2]}</span>
</div>
`;
                    };

                    inputV1.addEventListener("input", update);
                    inputV2.addEventListener("input", update);
                    update();
                },

                interactive_division_vertical(container) {
                    // 1. Configura√ß√£o
                    const config = {
                        colorMain: "text-brand-orange",
                        colorBorder: "border-brand-orange",
                        labels: ["Dividendo", "Divisor", "Quociente", "Resto"],
                    };

                    // 2. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col md:flex-row items-center justify-center gap-8 shadow-sm">
<div class="flex flex-col gap-4">
<div class="flex flex-col gap-1">
<label class="text-[10px] font-bold text-gray-400 uppercase tracking-wide">${config.labels[0]}</label>
<input type="number" class="input-v1 border-2 border-brand-gray rounded-lg p-2 w-28 text-center font-bold text-xl outline-none focus:${config.colorBorder} transition-colors text-brand-text" value="20">
</div>
<div class="flex flex-col gap-1">
<label class="text-[10px] font-bold text-gray-400 uppercase tracking-wide">${config.labels[1]}</label>
<input type="number" class="input-v2 border-2 border-brand-gray rounded-lg p-2 w-28 text-center font-bold text-xl outline-none focus:${config.colorBorder} transition-colors text-brand-text" value="3">
</div>
</div>

<div class="display-area bg-gray-50 p-6 rounded-xl border-2 border-gray-100 min-w-[200px] flex items-center justify-center font-mono text-3xl shadow-inner select-none cursor-default">
</div>
</div>
`;

                    // 3. Seletores e L√≥gica
                    const inputV1 = container.querySelector(".input-v1");
                    const inputV2 = container.querySelector(".input-v2");
                    const display = container.querySelector(".display-area");

                    const update = () => {
                        const v1 = parseInt(inputV1.value) || 0;
                        // Evita divis√£o por zero convertendo 0 para 1 visualmente ou lidando com erro
                        const v2 =
                            parseInt(inputV2.value) === 0
                                ? 1
                                : parseInt(inputV2.value) || 1;

                        const q = Math.floor(v1 / v2);
                        const r = v1 % v2;

                        // Layout do M√©todo da Chave
                        display.innerHTML = `
<div class="flex items-start">
<div class="flex flex-col items-end pr-3 group relative">
 <div>${v1}</div>
 <div class="text-brand-red text-xl mt-1 opacity-70">-${q * v2}</div>
 <div class="border-t-2 border-gray-400 mt-1 font-bold text-brand-blue">${r}</div>
 
 <span class="absolute -left-24 bottom-0 text-xs font-sans text-gray-400 opacity-0 group-hover:opacity-100 bg-white p-1 shadow rounded border z-10 w-20 text-center transition-opacity pointer-events-none font-bold uppercase">${config.labels[3]
                            }</span>
</div>

<div class="flex flex-col items-start pl-3 border-l-2 border-brand-text h-full group relative">
 <div class="border-b-2 border-brand-text pb-1 mb-1 w-full text-center">${v2}</div>
 <div class="font-bold ${config.colorMain}">${q}</div>

 <span class="absolute -right-24 bottom-0 text-xs font-sans text-gray-400 opacity-0 group-hover:opacity-100 bg-white p-1 shadow rounded border z-10 w-20 text-center transition-opacity pointer-events-none font-bold uppercase">${config.labels[2]
                            }</span>
</div>
</div>
`;
                    };

                    inputV1.addEventListener("input", update);
                    inputV2.addEventListener("input", update);
                    update();
                },

                interactive_power_visualizer(container) {
                    // 1. Inje√ß√£o do HTML
                    container.innerHTML = `
<div class="bg-brand-bg border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center gap-6 w-full shadow-sm">

<div class="flex items-start gap-2 font-extrabold text-brand-text select-none">

<div class="flex flex-col items-center">
<input type="number" class="input-base text-4xl md:text-5xl w-20 text-center bg-transparent border-b-4 border-brand-gray focus:border-brand-blue outline-none transition-colors text-brand-blue" value="2" min="1" max="10">
<span class="text-[10px] text-gray-400 uppercase font-bold mt-1 tracking-wide">Base</span>
</div>

<div class="flex flex-col items-center -mt-2">
<input type="number" class="input-exp text-xl md:text-2xl w-12 text-center bg-transparent border-b-4 border-brand-gray focus:border-brand-purple outline-none mb-2 transition-colors text-brand-purple" value="9" min="0" max="10">
<span class="text-[10px] text-gray-400 uppercase font-bold tracking-wide">Exp</span>
</div>

<span class="text-4xl self-center pt-4 text-gray-300">=</span>
<span class="result-text text-4xl md:text-5xl self-center pt-4 text-brand-green ml-2 min-w-[60px] text-center">512</span>
</div>

<div class="w-full bg-white rounded-lg border-2 border-gray-100 p-4 min-h-[100px] flex flex-col items-center justify-center transition-all duration-500">
<div class="blocks-container flex flex-wrap justify-center gap-1 content-center max-w-2xl">
</div>
<p class="limit-warning text-xs text-orange-400 font-bold mt-4 hidden uppercase tracking-wide animate-pulse">
<i class="fas fa-exclamation-triangle"></i> Visualiza√ß√£o limitada a 512 itens
</p>
</div>
</div>
`;

                    // 2. Seletores Escopados
                    const baseInput = container.querySelector(".input-base");
                    const expInput = container.querySelector(".input-exp");
                    const resText = container.querySelector(".result-text");
                    const blocksContainer =
                        container.querySelector(".blocks-container");
                    const warning = container.querySelector(".limit-warning");

                    // 3. Fun√ß√£o de Atualiza√ß√£o
                    const update = () => {
                        const b = parseInt(baseInput.value) || 0;
                        const e = parseInt(expInput.value) || 0;

                        const res = Math.pow(b, e);
                        resText.innerText = res > 10000 ? "..." : res;

                        blocksContainer.innerHTML = "";

                        // --- ALTERA√á√ÉO AQUI: Limite aumentado para 512 ---
                        const visualLimit = 512;
                        const countToRender = Math.min(res, visualLimit);

                        // Fragmento de documento para performance (renderizar 512 itens de uma vez)
                        const fragment = document.createDocumentFragment();

                        for (let i = 0; i < countToRender; i++) {
                            const dot = document.createElement("div");

                            // Separa grupos visualmente
                            const isGroupStart = b > 1 && i % b === 0 && i !== 0;

                            // --- ALTERA√á√ÉO AQUI: Tamanho reduzido (w-2/w-3) para caber 512 melhor ---
                            // 'w-2 h-2' em mobile, 'w-3 h-3' em desktop
                            dot.className = `w-2 h-2 md:w-3 md:h-3 bg-brand-blue rounded-sm shadow-sm transition-all hover:scale-150 hover:bg-brand-blueDark ${isGroupStart ? "ml-2 md:ml-3" : ""
                                }`;

                            fragment.appendChild(dot);
                        }

                        blocksContainer.appendChild(fragment);

                        if (res > visualLimit) {
                            blocksContainer.innerHTML += `<div class="flex items-center justify-center w-full text-gray-400 font-black tracking-widest text-xs mt-2">...e muito mais!</div>`;
                            warning.classList.remove("hidden");
                        } else {
                            warning.classList.add("hidden");
                        }
                    };

                    // 4. Listeners
                    baseInput.addEventListener("input", update);
                    expInput.addEventListener("input", update);
                    update();
                },

                interactive_expression_solver(container) {
                    // 1. Dados: Os passos da resolu√ß√£o
                    // Voc√™ pode alterar isso para receber uma express√£o din√¢mica no futuro
                    const steps = [
                        {
                            latex: "10 + [ 4 + ( 3 \\times 2 ) - 1 ]",
                            desc: "Express√£o Inicial",
                        },
                        {
                            latex: "10 + [ 4 + \\mathbf{6} - 1 ]",
                            desc: "Resolveu (3 √ó 2)",
                        },
                        { latex: "10 + [ \\mathbf{10} - 1 ]", desc: "Resolveu 4 + 6" },
                        { latex: "10 + \\mathbf{9}", desc: "Resolveu colchete [10-1]" },
                        { latex: "\\mathbf{19}", desc: "Resultado Final" },
                    ];

                    let currentStep = 0; // Estado atual

                    // 2. Inje√ß√£o do HTML
                    // Usamos tons de Amarelo para indicar "Aten√ß√£o/Processo"
                    container.innerHTML = `
<div class="bg-yellow-50 border-2 border-brand-yellow rounded-xl p-6 w-full shadow-sm flex flex-col gap-4">
<div class="flex items-center gap-2 mb-2">
<i class="fas fa-calculator text-brand-yellowDark"></i>
<span class="text-xs font-bold text-brand-yellowDark uppercase tracking-wider">Resolvendo Passo a Passo</span>
</div>

<div class="step-list space-y-3 font-mono text-lg md:text-xl transition-all">
</div>

<button class="action-btn w-full bg-brand-yellow hover:bg-yellow-500 text-white font-bold py-3 px-6 rounded-xl shadow-[0_4px_0_rgb(200,150,0)] active:shadow-none active:translate-y-[4px] transition-all mt-4">
Pr√≥ximo Passo
</button>
</div>
`;

                    // 3. Seletores
                    const list = container.querySelector(".step-list");
                    const btn = container.querySelector(".action-btn");

                    // 4. Fun√ß√£o de Renderiza√ß√£o
                    const render = () => {
                        list.innerHTML = ""; // Limpa a lista

                        // Renderiza todos os passos at√© o atual
                        for (let i = 0; i <= currentStep && i < steps.length; i++) {
                            const step = steps[i];
                            const isLast = i === currentStep; // O √∫ltimo passo vis√≠vel recebe destaque

                            const item = document.createElement("div");

                            // Estilos condicionais: O √∫ltimo passo √© branco com borda amarela, os anteriores ficam cinza "apagados"
                            const activeStyle =
                                "bg-white border-brand-yellow shadow-sm scale-[1.02]";
                            const inactiveStyle =
                                "bg-gray-100 border-transparent text-gray-500 opacity-80";

                            item.className = `p-3 rounded-lg border-2 flex justify-between items-center transition-all duration-300 ${isLast ? activeStyle : inactiveStyle
                                }`;

                            item.innerHTML = `
<span>$$${step.latex}$$</span> 
<span class="text-[10px] md:text-xs font-bold uppercase ${isLast ? "text-brand-yellowDark" : "text-gray-400"
                                }">${step.desc}</span>
`;

                            list.appendChild(item);
                        }

                        // Renderiza a matem√°tica (KaTeX) nos novos elementos
                        // Verifica se a biblioteca existe para n√£o dar erro
                        if (window.renderMathInElement) {
                            renderMathInElement(list, {
                                delimiters: [{ left: "$$", right: "$$", display: false }],
                            });
                        }

                        // Atualiza o texto do bot√£o
                        if (currentStep >= steps.length - 1) {
                            btn.innerText = "Reiniciar";
                            btn.classList.replace("bg-brand-yellow", "bg-brand-green"); // Muda cor para verde
                            btn.classList.replace(
                                "shadow-[0_4px_0_rgb(200,150,0)]",
                                "shadow-[0_4px_0_#2e8b01]"
                            );
                        } else {
                            btn.innerText = "Pr√≥ximo Passo";
                            btn.classList.replace("bg-brand-green", "bg-brand-yellow"); // Volta para amarelo
                            btn.classList.replace(
                                "shadow-[0_4px_0_#2e8b01]",
                                "shadow-[0_4px_0_rgb(200,150,0)]"
                            );
                        }
                    };

                    // 5. Listener do Bot√£o
                    btn.onclick = () => {
                        if (currentStep >= steps.length - 1) {
                            currentStep = 0; // Reinicia
                        } else {
                            currentStep++; // Avan√ßa
                        }
                        render();
                    };

                    // Renderiza a primeira vez
                    render();
                },

                interactive_equality_balance(container) {
                    // 1. Estado Inicial
                    let isSolved = false;

                    // 2. Inje√ß√£o do HTML (Estrutura da Balan√ßa)
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm select-none">

<div class="relative w-full max-w-sm h-48 mt-4 mb-2 flex justify-center items-end">
<div class="absolute bottom-0 w-0 h-0 border-l-[20px] border-l-transparent border-r-[20px] border-r-transparent border-b-[40px] border-b-brand-text z-10"></div>

<div class="absolute bottom-[38px] w-72 h-2 bg-brand-text rounded-full z-10 transition-transform duration-500 origin-center" id="beam"></div>

<div class="absolute bottom-[38px] left-[50%] -translate-x-36 flex flex-col items-center transition-all duration-500">
<div class="w-0.5 h-16 bg-gray-400"></div> <div class="w-24 h-2 bg-brand-text rounded-full shadow-sm"></div> <div id="plate-left" class="absolute bottom-4 flex gap-1 items-end justify-center w-full transition-all"></div> </div>

<div class="absolute bottom-[38px] left-[25%] translate-x-36 flex flex-col items-center transition-all duration-500">
<div class="w-0.5 h-16 bg-gray-400"></div> <div class="w-24 h-2 bg-brand-text rounded-full shadow-sm"></div> <div id="plate-right" class="absolute bottom-4 flex gap-1 items-end justify-center w-full transition-all"></div> </div>
</div>

<div class="mt-8 mb-4 bg-gray-50 px-6 py-2 rounded-lg border border-gray-200 transition-all duration-300" id="eq-container">
<p class="text-xl md:text-2xl font-mono font-bold text-brand-blue transition-all" id="eq-text">
$$x + 2 = 5$$
</p>
</div>

<button id="solve-btn" class="bg-brand-blue text-white px-6 py-3 rounded-xl font-bold text-sm shadow-btn active:shadow-none active:translate-y-1 transition-all flex items-center gap-2 hover:bg-brand-blueDark">
<i class="fas fa-balance-scale"></i>
<span>Resolver: Tirar 2 de cada lado</span>
</button>
</div>
`;

                    // 3. Seletores
                    const plateLeft = container.querySelector("#plate-left");
                    const plateRight = container.querySelector("#plate-right");
                    const eqText = container.querySelector("#eq-text");
                    const btn = container.querySelector("#solve-btn");
                    const beam = container.querySelector("#beam");

                    // 4. Fun√ß√£o de Renderiza√ß√£o do Conte√∫do dos Pratos
                    const renderPlates = () => {
                        // Limpa
                        plateLeft.innerHTML = "";
                        plateRight.innerHTML = "";

                        // --- LADO ESQUERDO ---
                        // Sempre tem o X
                        const xBlock = document.createElement("div");
                        xBlock.className =
                            "w-10 h-10 bg-brand-purple text-white flex items-center justify-center font-bold rounded shadow-sm text-xl z-20 border-2 border-purple-600";
                        xBlock.innerText = "x";
                        plateLeft.appendChild(xBlock);

                        // Tem +2 (se n√£o estiver resolvido)
                        // Usamos opacidade para animar a sa√≠da
                        if (!isSolved) {
                            // Adiciona 2 bolinhas
                            for (let i = 0; i < 2; i++) {
                                const ball = document.createElement("div");
                                ball.className =
                                    "w-6 h-6 bg-brand-green rounded-full border border-green-600 shadow-sm animate-fade-in";
                                plateLeft.appendChild(ball);
                            }
                        }

                        // --- LADO DIREITO ---
                        // Tem 5 (se n√£o resolvido) ou 3 (se resolvido)
                        const count = isSolved ? 3 : 5;
                        for (let i = 0; i < count; i++) {
                            const ball = document.createElement("div");
                            ball.className =
                                "w-6 h-6 bg-brand-green rounded-full border border-green-600 shadow-sm animate-fade-in";
                            plateRight.appendChild(ball);
                        }
                    };

                    // 5. L√≥gica de Atualiza√ß√£o (Bot√£o)
                    btn.onclick = () => {
                        if (!isSolved) {
                            // A√á√ÉO: RESOLVER
                            isSolved = true;

                            // Atualiza Texto Matem√°tico
                            eqText.innerText = "$$x = 3$$";

                            // Atualiza Bot√£o
                            btn.innerHTML = `<i class="fas fa-undo"></i> <span>Reiniciar</span>`;
                            btn.classList.replace("bg-brand-blue", "bg-brand-gray");
                            btn.classList.add("text-gray-600");

                            // Anima√ß√£o visual da balan√ßa (um leve balan√ßo para mostrar equil√≠brio)
                            beam.classList.add("animate-wiggle");
                            setTimeout(() => beam.classList.remove("animate-wiggle"), 500);
                        } else {
                            // A√á√ÉO: REINICIAR
                            isSolved = false;

                            // Atualiza Texto Matem√°tico
                            eqText.innerText = "$$x + 2 = 5$$";

                            // Atualiza Bot√£o
                            btn.innerHTML = `<i class="fas fa-balance-scale"></i> <span>Resolver: Tirar 2 de cada lado</span>`;
                            btn.classList.replace("bg-brand-gray", "bg-brand-blue");
                            btn.classList.remove("text-gray-600");
                        }

                        // Renderiza os pratos novamente
                        renderPlates();

                        // Re-renderiza o KaTeX (f√≥rmulas matem√°ticas)
                        if (window.renderMathInElement) {
                            renderMathInElement(container, {
                                delimiters: [{ left: "$$", right: "$$", display: false }],
                            });
                        }
                    };

                    // Renderiza√ß√£o Inicial
                    renderPlates();
                    // Chamada inicial do KaTeX caso j√° esteja carregado
                    if (window.renderMathInElement) {
                        renderMathInElement(container, {
                            delimiters: [{ left: "$$", right: "$$", display: false }],
                        });
                    }
                },

                interactive_equation_builder(container) {
                    // Estado inicial
                    let currentState = {
                        lhs: { x: 0, c: 0 },
                        rhs: { x: 0, c: 0 },
                        step: 0,
                    };

                    // 1. Inje√ß√£o do HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm">

<div class="w-full max-w-md mb-6 bg-blue-50 p-4 rounded-xl border border-blue-100 flex flex-col gap-2">
<label class="text-xs font-bold text-brand-blue uppercase">Digite a Equa√ß√£o (Ex: 2x + 4 = 10)</label>
<div class="flex gap-2">
<input type="text" id="eq-input" value="2x + 4 = 10" class="flex-1 text-xl font-mono font-bold text-center border-2 border-brand-gray rounded-lg p-2 focus:border-brand-blue outline-none text-brand-text uppercase" placeholder="ax + b = c">
<button id="build-btn" class="bg-brand-blue text-white px-4 rounded-lg font-bold hover:bg-brand-blueDark transition-colors">
<i class="fas fa-hammer"></i> Montar
</button>
</div>
</div>

<div class="relative w-full max-w-sm h-48 mb-4 flex justify-center items-end select-none">
<div class="absolute bottom-0 w-0 h-0 border-l-[20px] border-l-transparent border-r-[20px] border-r-transparent border-b-[40px] border-b-brand-text z-10"></div>
<div class="absolute bottom-[38px] w-72 h-2 bg-brand-text rounded-full z-10 transition-transform duration-500 origin-center" id="beam"></div>

<div class="absolute bottom-[38px] left-[50%] -translate-x-36 flex flex-col items-center transition-all duration-500" id="pan-l">
<div class="w-0.5 h-16 bg-gray-400"></div>
<div class="w-24 h-2 bg-brand-text rounded-full"></div>
<div id="content-l" class="absolute bottom-4 flex flex-wrap-reverse gap-1 justify-center w-24 transition-all"></div>
</div>

<div class="absolute bottom-[38px] left-[25%] translate-x-36 flex flex-col items-center transition-all duration-500" id="pan-r">
<div class="w-0.5 h-16 bg-gray-400"></div>
<div class="w-24 h-2 bg-brand-text rounded-full"></div>
<div id="content-r" class="absolute bottom-4 flex flex-wrap-reverse gap-1 justify-center w-24 transition-all"></div>
</div>
</div>

<div id="controls" class="hidden w-full max-w-md bg-gray-50 p-4 rounded-xl border border-gray-200 flex flex-col gap-3">
<div class="text-center font-mono text-xl font-bold text-brand-text transition-all" id="status-text">$$2x + 4 = 10$$</div>

<div class="flex gap-2 justify-center">
<button id="step1-btn" class="flex-1 bg-brand-orange text-white py-2 rounded-lg font-bold text-sm opacity-50 cursor-not-allowed shadow-sm transition-all flex items-center justify-center gap-2">
<span>1. Tirar Sobras</span>
</button>
<button id="step2-btn" class="flex-1 bg-brand-green text-white py-2 rounded-lg font-bold text-sm opacity-50 cursor-not-allowed shadow-sm transition-all flex items-center justify-center gap-2">
<span>2. Dividir Grupos</span>
</button>
</div>
</div>
</div>
`;

                    // 2. Seletores
                    const input = container.querySelector("#eq-input");
                    const buildBtn = container.querySelector("#build-btn");
                    const contentL = container.querySelector("#content-l");
                    const contentR = container.querySelector("#content-r");
                    const controls = container.querySelector("#controls");
                    const statusText = container.querySelector("#status-text");
                    const step1Btn = container.querySelector("#step1-btn");
                    const step2Btn = container.querySelector("#step2-btn");
                    const beam = container.querySelector("#beam");

                    // 3. Parser (Mesma l√≥gica anterior)
                    const parseEquation = (str) => {
                        const clean = str.replace(/\s+/g, "").toLowerCase();
                        const parts = clean.split("=");
                        if (parts.length !== 2) return null;

                        const parseSide = (s) => {
                            let x = 0,
                                c = 0;
                            const xMatch = s.match(/(\d*)x/);
                            if (xMatch) x = xMatch[1] === "" ? 1 : parseInt(xMatch[1]);
                            const terms = s.split("+");
                            terms.forEach((t) => {
                                if (!t.includes("x")) c += parseInt(t) || 0;
                            });
                            return { x, c };
                        };
                        return { lhs: parseSide(parts[0]), rhs: parseSide(parts[1]) };
                    };

                    // 4. Desenha Elementos
                    const draw = (data) => {
                        contentL.innerHTML = "";
                        contentR.innerHTML = "";

                        // Adicionei a classe 'unit-ball' nas bolinhas verdes para podermos selecion√°-las depois
                        const createX = () =>
                            `<div class="block-x w-8 h-8 bg-brand-purple text-white border-2 border-purple-700 rounded flex items-center justify-center font-bold text-sm animate-pop-in mb-1">x</div>`;
                        const createUnit = () =>
                            `<div class="unit-ball w-5 h-5 bg-brand-green border border-green-700 rounded-full shadow-sm animate-pop-in mb-1"></div>`;

                        for (let i = 0; i < data.lhs.x; i++)
                            contentL.innerHTML += createX();
                        for (let i = 0; i < data.lhs.c; i++)
                            contentL.innerHTML += createUnit();

                        for (let i = 0; i < data.rhs.x; i++)
                            contentR.innerHTML += createX();
                        for (let i = 0; i < data.rhs.c; i++)
                            contentR.innerHTML += createUnit();
                    };

                    // 5. Bot√£o Montar
                    buildBtn.onclick = () => {
                        const eq = parseEquation(input.value);
                        if (!eq) {
                            alert("Tente: 2x + 4 = 10");
                            return;
                        }

                        currentState = { ...eq, step: 0 };
                        draw(currentState);

                        controls.classList.remove("hidden");
                        statusText.innerText = `$$${input.value}$$`;
                        if (window.renderMathInElement) renderMathInElement(statusText);

                        step1Btn.className =
                            "flex-1 bg-brand-orange text-white py-2 rounded-lg font-bold text-sm shadow-[0_4px_0_#c2410c] active:shadow-none active:translate-y-[4px] transition-all hover:bg-orange-600";
                        step1Btn.disabled = false;

                        step2Btn.className =
                            "flex-1 bg-brand-green text-white py-2 rounded-lg font-bold text-sm opacity-50 cursor-not-allowed shadow-none";
                        step2Btn.disabled = true;

                        beam.classList.add("animate-wiggle");
                        setTimeout(() => beam.classList.remove("animate-wiggle"), 500);
                    };

                    // 6. Bot√£o Passo 1: TIRAR SOBRAS (Com Anima√ß√£o)
                    step1Btn.onclick = () => {
                        // Descobre quantas bolinhas tirar
                        const minC = Math.min(currentState.lhs.c, currentState.rhs.c);

                        if (minC > 0) {
                            // Seleciona as bolinhas no DOM
                            // Array.from(...).slice(-N) pega as √öLTIMAS N bolinhas adicionadas (que ficam no topo visualmente)
                            const ballsL = Array.from(
                                contentL.querySelectorAll(".unit-ball")
                            ).slice(-minC);
                            const ballsR = Array.from(
                                contentR.querySelectorAll(".unit-ball")
                            ).slice(-minC);

                            // Aplica anima√ß√£o de sa√≠da
                            [...ballsL, ...ballsR].forEach((ball) => {
                                ball.classList.remove("animate-pop-in"); // Remove entrada
                                ball.classList.add("animate-pop-out"); // Adiciona sa√≠da
                            });

                            // Espera 500ms (tempo da anima√ß√£o) antes de atualizar os dados reais
                            setTimeout(() => {
                                currentState.lhs.c -= minC;
                                currentState.rhs.c -= minC;
                                draw(currentState); // Redesenha limpo

                                statusText.innerText = `$$${currentState.lhs.x}x = ${currentState.rhs.c}$$`;
                                if (window.renderMathInElement)
                                    renderMathInElement(statusText);
                            }, 500);
                        } else {
                            statusText.innerText = "Nada para subtrair!";
                        }

                        // Atualiza estado dos bot√µes
                        currentState.step = 1;
                        step1Btn.className =
                            "flex-1 bg-brand-orange text-white py-2 rounded-lg font-bold text-sm opacity-50 cursor-not-allowed shadow-none";
                        step1Btn.disabled = true;

                        step2Btn.className =
                            "flex-1 bg-brand-green text-white py-2 rounded-lg font-bold text-sm shadow-[0_4px_0_#2e8b01] active:shadow-none active:translate-y-[4px] transition-all hover:bg-green-600";
                        step2Btn.disabled = false;
                    };

                    // 7. Bot√£o Passo 2: DIVIDIR
                    step2Btn.onclick = () => {
                        if (currentState.lhs.x > 1) {
                            // Anima√ß√£o simples de fade para a divis√£o
                            contentL.classList.add("opacity-0");
                            contentR.classList.add("opacity-0");

                            setTimeout(() => {
                                const divisor = currentState.lhs.x;
                                currentState.lhs.x = 1;
                                currentState.rhs.c = currentState.rhs.c / divisor;

                                draw(currentState);
                                contentL.classList.remove("opacity-0");
                                contentR.classList.remove("opacity-0");
                                contentL.classList.add("animate-pop-in");
                                contentR.classList.add("animate-pop-in");

                                statusText.innerText = `$$x = ${currentState.rhs.c}$$`;
                                if (window.renderMathInElement)
                                    renderMathInElement(statusText);

                                // Sucesso visual
                                statusText.classList.add("text-brand-green", "scale-125");
                            }, 300);
                        }

                        step2Btn.className =
                            "flex-1 bg-brand-green text-white py-2 rounded-lg font-bold text-sm opacity-50 cursor-not-allowed shadow-none";
                        step2Btn.disabled = true;
                    };

                    // Estilos CSS Inline para Anima√ß√µes
                    const style = document.createElement("style");
                    style.innerHTML = `
@keyframes popIn { 0% { transform: scale(0); } 70% { transform: scale(1.2); } 100% { transform: scale(1); } }
.animate-pop-in { animation: popIn 0.4s ease-out forwards; }

@keyframes popOut { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }
.animate-pop-out { animation: popOut 0.5s ease-in forwards; pointer-events: none; }

@keyframes wiggle { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(-2deg); } 75% { transform: rotate(2deg); } }
.animate-wiggle { animation: wiggle 0.4s ease-in-out; }
`;
                    container.appendChild(style);
                },

                interactive_primes_sieve(container) {
                    // Configura√ß√£o
                    const maxNum = 50;
                    let currentStep = 0;

                    // Passos do Algoritmo
                    const steps = [
                        { type: "init", label: "Iniciar: O n√∫mero 1" },
                        { type: "filter", num: 2, label: "Filtrar M√∫ltiplos de 2" },
                        { type: "filter", num: 3, label: "Filtrar M√∫ltiplos de 3" },
                        { type: "filter", num: 5, label: "Filtrar M√∫ltiplos de 5" },
                        { type: "filter", num: 7, label: "Filtrar M√∫ltiplos de 7" },
                        { type: "finish", label: "Finalizar" },
                    ];

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<div class="text-center mb-4">
<h3 class="text-brand-blue font-extrabold text-xl uppercase tracking-wider">A Peneira dos Primos</h3>
<p class="text-xs text-gray-500 font-bold mt-1" id="instruction-text">Vamos encontrar os primos at√© ${maxNum}?</p>
</div>

<div class="grid grid-cols-10 gap-1 md:gap-2 mb-6 w-full max-w-md select-none" id="sieve-grid">
</div>

<button id="action-btn" class="w-full max-w-xs bg-brand-blue hover:bg-brand-blueDark text-white font-bold py-3 px-6 rounded-xl shadow-btn active:scale-95 transition-all flex items-center justify-center gap-2">
<i class="fas fa-play"></i>
<span id="btn-label">Come√ßar</span>
</button>

<div class="flex gap-4 mt-6 text-[10px] uppercase font-bold text-gray-400">
<div class="flex items-center gap-1"><div class="w-3 h-3 bg-brand-green rounded border border-green-600"></div> Primos</div>
<div class="flex items-center gap-1"><div class="w-3 h-3 bg-gray-200 rounded text-gray-400 decoration-line-through"></div> Eliminados</div>
</div>
</div>
`;

                    // 2. Seletores
                    const grid = container.querySelector("#sieve-grid");
                    const btn = container.querySelector("#action-btn");
                    const btnLabel = container.querySelector("#btn-label");
                    const instruction = container.querySelector("#instruction-text");

                    // 3. Renderiza√ß√£o Inicial
                    const createGrid = () => {
                        grid.innerHTML = "";
                        for (let i = 1; i <= maxNum; i++) {
                            const el = document.createElement("div");
                            el.id = `num-${i}`;
                            el.className =
                                "aspect-square flex items-center justify-center rounded font-bold text-brand-blue border border-blue-100 bg-blue-50 text-xs md:text-sm transition-all duration-300";
                            el.innerText = i;
                            grid.appendChild(el);
                        }
                    };

                    const wait = (ms) => new Promise((r) => setTimeout(r, ms));

                    // 4. L√≥gica Passo a Passo
                    btn.onclick = async () => {
                        if (btn.disabled) return;
                        btn.disabled = true; // Trava durante anima√ß√£o
                        btn.classList.add("opacity-50", "cursor-not-allowed");

                        const stepData = steps[currentStep];

                        if (stepData.type === "init") {
                            instruction.innerText =
                                "O n√∫mero 1 n√£o √© primo (tem apenas 1 divisor).";
                            const el1 = container.querySelector("#num-1");
                            el1.className =
                                "aspect-square flex items-center justify-center rounded font-bold text-gray-300 bg-gray-100 border border-transparent scale-90";
                            await wait(500);
                            nextStep();
                        } else if (stepData.type === "filter") {
                            const p = stepData.num;
                            instruction.innerText = `O ${p} √© primo! Vamos marcar ele e eliminar seus m√∫ltiplos.`;

                            // Marca Primo
                            const primeEl = container.querySelector(`#num-${p}`);
                            if (!primeEl.classList.contains("bg-gray-100")) {
                                primeEl.className =
                                    "aspect-square flex items-center justify-center rounded font-bold text-white bg-brand-green border border-green-600 shadow-md scale-110 z-10 relative";
                            }
                            await wait(600);

                            // Elimina M√∫ltiplos
                            for (let m = p * p; m <= maxNum; m += p) {
                                // Otimiza√ß√£o: come√ßa do quadrado
                                // Mas para ser visualmente completo, podemos come√ßar de 2*p se quisermos refor√ßar
                                // Vamos usar p*p que √© o algoritmo real otimizado, ou 2*p se quisermos mostrar todos.
                                // Vamos usar 2*p para garantir que o aluno veja todos sendo riscados.
                            }
                            // Loop visual completo
                            for (let m = p + p; m <= maxNum; m += p) {
                                const el = container.querySelector(`#num-${m}`);
                                if (!el.classList.contains("bg-gray-100")) {
                                    el.classList.add("bg-brand-red", "text-white"); // Flash
                                    await wait(50);
                                    el.className =
                                        "aspect-square flex items-center justify-center rounded font-bold text-gray-300 bg-gray-100 border border-transparent scale-90 line-through decoration-2 decoration-gray-400";
                                }
                            }
                            nextStep();
                        } else if (stepData.type === "finish") {
                            instruction.innerText =
                                "Pronto! Todos os n√∫meros que sobraram s√£o Primos.";
                            instruction.className =
                                "text-xs font-bold mt-1 text-brand-green";

                            for (let i = 2; i <= maxNum; i++) {
                                const el = container.querySelector(`#num-${i}`);
                                if (
                                    !el.classList.contains("bg-gray-100") &&
                                    !el.classList.contains("bg-brand-green")
                                ) {
                                    el.className =
                                        "aspect-square flex items-center justify-center rounded font-bold text-white bg-brand-green border border-green-600 shadow-md scale-110 animate-pop-in";
                                    await wait(50);
                                }
                            }

                            // Bot√£o Reiniciar
                            currentStep++;
                            btn.innerHTML = `<i class="fas fa-undo"></i> <span>Reiniciar</span>`;
                            btn.classList.replace("bg-brand-blue", "bg-gray-500");
                            btn.disabled = false;
                            btn.classList.remove("opacity-50", "cursor-not-allowed");
                            return;
                        }

                        // Reiniciar
                        if (currentStep > steps.length) {
                            currentStep = 0;
                            createGrid();
                            btn.innerHTML = `<i class="fas fa-play"></i> <span id="btn-label">Come√ßar</span>`;
                            btn.classList.replace("bg-gray-500", "bg-brand-blue");
                            instruction.innerText = `Vamos encontrar os primos at√© ${maxNum}?`;
                            instruction.className = "text-xs text-gray-500 font-bold mt-1";
                            btn.disabled = false;
                            btn.classList.remove("opacity-50", "cursor-not-allowed");
                        }
                    };

                    const nextStep = () => {
                        currentStep++;
                        if (currentStep < steps.length) {
                            btnLabel.innerText = steps[currentStep].label;
                        }
                        btn.disabled = false;
                        btn.classList.remove("opacity-50", "cursor-not-allowed");
                    };

                    // Init
                    createGrid();
                    btnLabel.innerText = steps[0].label;
                },

                interactive_mmc_mdc(container) {
                    // 1. Inje√ß√£o do HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm">

<div class="text-center mb-6">
<h3 class="text-brand-text font-extrabold text-lg uppercase tracking-wider mb-2">Comparando Dois N√∫meros</h3>
<div class="flex gap-4 justify-center items-center">
<input type="number" class="input-n1 text-3xl font-extrabold text-center w-20 p-2 rounded-xl border-2 border-brand-gray focus:border-brand-blue outline-none text-brand-blue transition-colors" value="12" min="1">
<span class="text-gray-300 font-bold text-xl">&</span>
<input type="number" class="input-n2 text-3xl font-extrabold text-center w-20 p-2 rounded-xl border-2 border-brand-gray focus:border-brand-blue outline-none text-brand-blue transition-colors" value="18" min="1">
</div>
</div>

<div class="grid grid-cols-2 gap-4 w-full max-w-sm">

<div class="bg-orange-50 border-2 border-orange-100 rounded-xl p-4 flex flex-col items-center justify-center transition-transform hover:scale-105">
<span class="text-[10px] font-black text-brand-orange uppercase tracking-widest mb-1">MDC</span>
<span class="text-xs text-orange-400 font-bold mb-2 text-center leading-tight">Maior Divisor Comum</span>
<div class="res-mdc text-4xl md:text-5xl font-black text-brand-orange drop-shadow-sm">6</div>
</div>

<div class="bg-purple-50 border-2 border-purple-100 rounded-xl p-4 flex flex-col items-center justify-center transition-transform hover:scale-105">
<span class="text-[10px] font-black text-brand-purple uppercase tracking-widest mb-1">MMC</span>
<span class="text-xs text-purple-400 font-bold mb-2 text-center leading-tight">M√≠nimo M√∫ltiplo Comum</span>
<div class="res-mmc text-4xl md:text-5xl font-black text-brand-purple drop-shadow-sm">36</div>
</div>

</div>

<div class="mt-6 text-center text-xs text-gray-400 font-medium bg-gray-50 px-4 py-2 rounded-full">
<i class="fas fa-lightbulb text-brand-yellow"></i> 
Dica: O MMC nunca √© menor que o maior n√∫mero!
</div>
</div>
`;

                    // 2. Seletores
                    const n1Input = container.querySelector(".input-n1");
                    const n2Input = container.querySelector(".input-n2");
                    const resMdc = container.querySelector(".res-mdc");
                    const resMmc = container.querySelector(".res-mmc");

                    // 3. Fun√ß√µes Matem√°ticas (Algoritmo de Euclides)
                    const getMDC = (a, b) => {
                        return !b ? a : getMDC(b, a % b);
                    };

                    const getMMC = (a, b) => {
                        return (a * b) / getMDC(a, b);
                    };

                    // 4. L√≥gica de Atualiza√ß√£o
                    const update = () => {
                        let v1 = parseInt(n1Input.value);
                        let v2 = parseInt(n2Input.value);

                        // Valida√ß√£o simples (evita 0 ou negativo)
                        if (v1 < 1 || isNaN(v1)) v1 = 1;
                        if (v2 < 1 || isNaN(v2)) v2 = 1;

                        const mdc = getMDC(v1, v2);
                        const mmc = getMMC(v1, v2);

                        // Atualiza o DOM
                        resMdc.innerText = mdc;
                        resMmc.innerText = mmc;

                        // Feedback visual nos inputs (caso tenham sido corrigidos)
                        // n1Input.value = v1;
                        // n2Input.value = v2;
                    };

                    // 5. Listeners
                    n1Input.addEventListener("input", update);
                    n2Input.addEventListener("input", update);

                    // Inicializa
                    update();
                },

                interactive_pizza_fractions(container) {
                    // Estado Inicial
                    let num = 3; // Numerador (Partes pintadas)
                    let den = 8; // Denominador (Total de cortes)

                    // 1. Inje√ß√£o do HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col md:flex-row items-center justify-center gap-8 w-full shadow-sm select-none">

<div class="relative w-48 h-48 md:w-56 md:h-56 shrink-0 transition-transform duration-300 hover:scale-105">
<div id="pizza-fill" class="absolute inset-0 rounded-full border-4 border-brand-text transition-all duration-500" 
 style="background: conic-gradient(#FF9600 0% 0%, #FFF 0% 100%); box-shadow: 4px 4px 0px rgba(0,0,0,0.1);"></div>

<svg id="pizza-slices" class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 100 100">
</svg>
</div>

<div class="flex flex-col items-center gap-6 w-full max-w-xs">

<div class="flex flex-col items-center font-black text-brand-text">
<span id="num-display" class="text-5xl md:text-6xl text-brand-orange leading-none transition-all">3</span>
<div class="w-24 h-1 bg-brand-text my-2 rounded-full"></div>
<span id="den-display" class="text-5xl md:text-6xl text-brand-blue leading-none transition-all">8</span>
</div>

<div class="flex gap-4 w-full">
<div class="flex-1 flex flex-col items-center gap-2 bg-orange-50 p-3 rounded-xl border border-orange-100">
<span class="text-[10px] font-bold uppercase text-brand-orange tracking-wide">Fatias (Num)</span>
<div class="flex items-center gap-2">
<button id="btn-num-minus" class="w-8 h-8 rounded-full bg-white text-brand-orange border-2 border-brand-orange font-black hover:bg-orange-100 active:scale-95 transition-all">-</button>
<button id="btn-num-plus" class="w-8 h-8 rounded-full bg-brand-orange text-white border-2 border-brand-orange font-black hover:bg-orange-500 active:scale-95 transition-all shadow-sm">+</button>
</div>
</div>

<div class="flex-1 flex flex-col items-center gap-2 bg-blue-50 p-3 rounded-xl border border-blue-100">
<span class="text-[10px] font-bold uppercase text-brand-blue tracking-wide">Cortes (Den)</span>
<div class="flex items-center gap-2">
<button id="btn-den-minus" class="w-8 h-8 rounded-full bg-white text-brand-blue border-2 border-brand-blue font-black hover:bg-blue-100 active:scale-95 transition-all">-</button>
<button id="btn-den-plus" class="w-8 h-8 rounded-full bg-brand-blue text-white border-2 border-brand-blue font-black hover:bg-blue-600 active:scale-95 transition-all shadow-sm">+</button>
</div>
</div>
</div>

</div>
</div>
`;

                    // 2. Seletores
                    const pizzaFill = container.querySelector("#pizza-fill");
                    const pizzaSlices = container.querySelector("#pizza-slices");
                    const numDisp = container.querySelector("#num-display");
                    const denDisp = container.querySelector("#den-display");

                    const btnNumPlus = container.querySelector("#btn-num-plus");
                    const btnNumMinus = container.querySelector("#btn-num-minus");
                    const btnDenPlus = container.querySelector("#btn-den-plus");
                    const btnDenMinus = container.querySelector("#btn-den-minus");

                    // 3. Fun√ß√£o de Atualiza√ß√£o Visual
                    const update = () => {
                        // Limites de Seguran√ßa
                        if (den < 1) den = 1;
                        if (den > 16) den = 16; // Limite visual para n√£o poluir
                        if (num < 0) num = 0;
                        if (num > den) num = den; // Mant√©m fra√ß√£o pr√≥pria (visualiza√ß√£o mais simples)

                        // Atualiza Texto
                        numDisp.innerText = num;
                        denDisp.innerText = den;

                        // 1. Pinta a Pizza (Numerador)
                        // Usa laranja (#FF9600) para a parte comida e branco/cinza para o resto
                        const percent = (num / den) * 100;
                        pizzaFill.style.background = `conic-gradient(#FF9600 0% ${percent}%, #F3F4F6 ${percent}% 100%)`;

                        // 2. Desenha as Linhas de Corte (Denominador)
                        // Usa SVG para calcular os √¢ngulos exatos
                        pizzaSlices.innerHTML = "";

                        // S√≥ desenha cortes se den > 1
                        if (den > 1) {
                            const centerX = 50;
                            const centerY = 50;
                            const radius = 50;

                            for (let i = 0; i < den; i++) {
                                const angle = (i * 360) / den;
                                // Converte graus para radianos e ajusta -90deg para come√ßar do topo (12h)
                                const rad = (angle - 90) * (Math.PI / 180);

                                const x2 = centerX + radius * Math.cos(rad);
                                const y2 = centerY + radius * Math.sin(rad);

                                const line = document.createElementNS(
                                    "http://www.w3.org/2000/svg",
                                    "line"
                                );
                                line.setAttribute("x1", centerX);
                                line.setAttribute("y1", centerY);
                                line.setAttribute("x2", x2);
                                line.setAttribute("y2", y2);
                                line.setAttribute("stroke", "#4B4B4B"); // Cor da linha (text-brand-text)
                                line.setAttribute("stroke-width", "1");

                                pizzaSlices.appendChild(line);
                            }
                        }
                    };

                    // 4. Listeners dos Controles
                    btnNumPlus.onclick = () => {
                        if (num < den) num++;
                        update();
                    };
                    btnNumMinus.onclick = () => {
                        if (num > 0) num--;
                        update();
                    };

                    btnDenPlus.onclick = () => {
                        if (den < 16) {
                            den++;
                            // Opcional: Se aumentar o corte, aumenta o num proporcionalmente?
                            // N√£o, melhor manter o num fixo para ver a fra√ß√£o diminuir visualmente (pedag√≥gico)
                            update();
                        }
                    };
                    btnDenMinus.onclick = () => {
                        if (den > 1) {
                            den--;
                            if (num > den) num = den; // Ajusta numerador se passar do total
                            update();
                        }
                    };

                    // Inicializa
                    update();
                },

                interactive_fraction_wall(container) {
                    // Configura√ß√£o
                    const rows = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
                    const colors = {
                        1: "bg-brand-red border-red-600 text-white",
                        2: "bg-brand-orange border-orange-600 text-white",
                        3: "bg-brand-yellow border-yellow-500 text-yellow-900",
                        4: "bg-brand-green border-green-600 text-white",
                        5: "bg-brand-blue border-blue-600 text-white",
                        6: "bg-brand-purple border-purple-600 text-white",
                        8: "bg-pink-400 border-pink-600 text-white",
                        10: "bg-teal-400 border-teal-600 text-white",
                        12: "bg-indigo-400 border-indigo-600 text-white",
                    };

                    let mode = "explore"; // explore ou challenge
                    let activeValue = 0.5; // Valor sendo explorado (1/2)
                    let targetFraction = { n: 1, d: 2, val: 0.5 }; // Alvo do desafio

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-4 flex flex-col items-center w-full shadow-sm font-sans select-none">

<div class="flex justify-between w-full items-center mb-4 border-b-2 border-gray-100 pb-2">
<h3 class="text-brand-blue font-black uppercase text-xs tracking-widest flex items-center gap-2">
<i class="fas fa-th-large"></i> Muro das Fra√ß√µes
</h3>

<div class="flex bg-gray-100 p-1 rounded-lg">
<button id="btn-explore" class="px-3 py-1 rounded text-xs font-bold transition-colors bg-white text-brand-blue shadow-sm">Explorar</button>
<button id="btn-challenge" class="px-3 py-1 rounded text-xs font-bold transition-colors text-gray-400 hover:bg-white">Desafio</button>
</div>
</div>

<div id="feedback-area" class="w-full bg-blue-50 border border-blue-100 rounded-lg p-3 mb-4 text-center min-h-[50px] flex items-center justify-center flex-col">
<span class="text-xs font-bold text-blue-400 uppercase mb-1" id="feedback-title">Equivalentes a 1/2</span>
<span class="text-lg font-mono font-black text-brand-blue" id="feedback-text">2/4 = 3/6 = 4/8...</span>
</div>

<div class="relative w-full max-w-2xl flex flex-col gap-1 p-2 bg-gray-100 rounded-xl border border-gray-200 overflow-hidden" id="wall-container">
<div id="ruler-line" class="absolute top-0 bottom-0 w-0.5 bg-brand-text z-20 transition-all duration-300 pointer-events-none shadow-xl transform -translate-x-1/2 border-l-2 border-dashed border-black opacity-50" style="left: 50%"></div>

<div id="blocks-area" class="flex flex-col gap-1 w-full"></div>
</div>

</div>
`;

                    // 2. Seletores
                    const blocksArea = container.querySelector("#blocks-area");
                    const rulerLine = container.querySelector("#ruler-line");
                    const feedbackArea = container.querySelector("#feedback-area");
                    const feedbackTitle = container.querySelector("#feedback-title");
                    const feedbackText = container.querySelector("#feedback-text");
                    const btnExplore = container.querySelector("#btn-explore");
                    const btnChallenge = container.querySelector("#btn-challenge");

                    // 3. L√≥gica de Renderiza√ß√£o
                    const renderWall = () => {
                        blocksArea.innerHTML = "";
                        rows.forEach((denom) => {
                            const rowEl = document.createElement("div");
                            rowEl.className = "flex w-full h-8 gap-[1px]";

                            for (let num = 1; num <= denom; num++) {
                                const block = document.createElement("div");
                                const colorClass = colors[denom] || "bg-gray-400 text-white";
                                const fractionValue = num / denom;

                                block.className = `flex-1 flex items-center justify-center text-[10px] font-bold rounded-sm cursor-pointer transition-all duration-200 border-b-2 shadow-sm hover:brightness-110 active:scale-95 ${colorClass}`;
                                block.innerText = `1/${denom}`;

                                // Dados para l√≥gica
                                block.dataset.value = fractionValue; // Valor acumulado onde o bloco termina
                                block.dataset.denom = denom;
                                block.dataset.num = num;

                                block.onclick = () => handleClick(fractionValue, num, denom);
                                rowEl.appendChild(block);
                            }
                            blocksArea.appendChild(rowEl);
                        });
                        updateVisuals();
                    };

                    // 4. L√≥gica de Intera√ß√£o
                    const handleClick = (val, n, d) => {
                        if (mode === "explore") {
                            activeValue = val;
                            updateVisuals();
                        } else {
                            checkAnswer(val, n, d);
                        }
                    };

                    const updateVisuals = () => {
                        // Move R√©gua
                        const percent = activeValue * 100;
                        rulerLine.style.left = `${percent}%`;

                        // Destaca Blocos
                        const allBlocks = blocksArea.querySelectorAll("div > div");
                        const equivalents = [];

                        allBlocks.forEach((block) => {
                            const blockVal = parseFloat(block.dataset.value);
                            const denom = parseInt(block.dataset.denom);
                            const num = parseInt(block.dataset.num);
                            const epsilon = 0.0001;

                            // Reseta estilo
                            block.style.opacity = "1";
                            block.style.filter = "brightness(1)";
                            block.classList.remove("ring-2", "ring-white", "z-10");

                            if (mode === "explore") {
                                if (blockVal < activeValue + epsilon) {
                                    // Est√° na zona esquerda
                                    if (Math.abs(blockVal - activeValue) < epsilon) {
                                        // √â equivalente! (Termina na r√©gua)
                                        block.classList.add("ring-2", "ring-white", "z-10");
                                        block.style.filter = "brightness(1.2)";
                                        equivalents.push(`${num}/${denom}`);
                                    }
                                } else {
                                    // Est√° na zona direita (Apaga)
                                    block.style.opacity = "0.3";
                                }
                            } else {
                                // Modo Desafio: Mostra todos acesos
                            }
                        });

                        if (mode === "explore") {
                            // Acha a fra√ß√£o irredut√≠vel (menor denominador) para o t√≠tulo
                            // Como 'equivalents' √© constru√≠do de cima para baixo, a primeira (1/denom) costuma ser a base, mas nem sempre.
                            // Vamos pegar a primeira da lista.
                            feedbackTitle.innerText = "Fra√ß√µes Equivalentes";
                            feedbackText.innerText =
                                equivalents.join(" = ") || "Nenhuma encontrada";
                            feedbackArea.className =
                                "w-full bg-blue-50 border border-blue-100 rounded-lg p-3 mb-4 text-center min-h-[50px] flex items-center justify-center flex-col";
                        }
                    };

                    // L√≥gica do Desafio
                    const startChallenge = () => {
                        // Gera alvo aleat√≥rio (que tenha equivalentes f√°ceis)
                        const possibleTargets = [
                            0.5, 0.25, 0.75, 0.2, 0.4, 0.6, 0.8, 0.333333, 0.666666,
                        ];
                        const val =
                            possibleTargets[
                            Math.floor(Math.random() * possibleTargets.length)
                            ];

                        // Acha a fra√ß√£o mais bonita para exibir (ex: 1/2 em vez de 2/4)
                        // Simplifica√ß√£o r√°pida
                        let n = 1,
                            d = 1;
                        // (Hack para achar fra√ß√£o base de decimal conhecido)
                        if (val === 0.5) {
                            n = 1;
                            d = 2;
                        } else if (val === 0.25) {
                            n = 1;
                            d = 4;
                        } else if (val === 0.75) {
                            n = 3;
                            d = 4;
                        } else if (val === 0.2) {
                            n = 1;
                            d = 5;
                        }
                        // ... etc. Para simplificar, vamos usar texto fixo.

                        activeValue = val; // R√©gua invis√≠vel ou guia? Melhor esconder a r√©gua no desafio.
                        rulerLine.style.opacity = "0";

                        feedbackTitle.innerText = "Desafio!";
                        feedbackText.innerHTML = `Encontre uma fra√ß√£o equivalente a <span class="text-brand-purple">${(
                            val * 100
                        ).toFixed(0)}%</span> (ou decimal ${val.toFixed(2)})`;
                        feedbackArea.className =
                            "w-full bg-purple-50 border border-purple-100 rounded-lg p-3 mb-4 text-center min-h-[50px] flex items-center justify-center flex-col animate-pop-in";

                        // Reseta visual dos blocos
                        const allBlocks = blocksArea.querySelectorAll("div > div");
                        allBlocks.forEach((b) => {
                            b.style.opacity = "1";
                            b.style.filter = "brightness(1)";
                            b.classList.remove("ring-2", "ring-white", "z-10");
                        });
                    };

                    const checkAnswer = (val, n, d) => {
                        const epsilon = 0.0001;
                        if (Math.abs(val - activeValue) < epsilon) {
                            // Acertou
                            feedbackTitle.innerText = "Muito Bem!";
                            feedbackTitle.className =
                                "text-xs font-bold text-green-600 uppercase mb-1";
                            feedbackText.innerHTML = `<span class="text-brand-green text-2xl">Sim! ${n}/${d} √© igual.</span>`;
                            feedbackArea.className =
                                "w-full bg-green-50 border border-green-200 rounded-lg p-3 mb-4 text-center min-h-[50px] flex items-center justify-center flex-col animate-pop-in";

                            // Efeito visual
                            setTimeout(startChallenge, 1500);
                        } else {
                            // Errou
                            feedbackTitle.innerText = "Tente de novo";
                            feedbackTitle.className =
                                "text-xs font-bold text-red-500 uppercase mb-1";
                            feedbackText.innerHTML = `<span class="text-brand-red">${n}/${d} √© ${val < activeValue ? "menor" : "maior"
                                }.</span>`;
                            feedbackArea.className =
                                "w-full bg-red-50 border border-red-200 rounded-lg p-3 mb-4 text-center min-h-[50px] flex items-center justify-center flex-col animate-shake";
                        }
                    };

                    // 5. Listeners dos Bot√µes
                    btnExplore.onclick = () => {
                        mode = "explore";
                        btnExplore.className =
                            "px-3 py-1 rounded text-xs font-bold transition-colors bg-white text-brand-blue shadow-sm";
                        btnChallenge.className =
                            "px-3 py-1 rounded text-xs font-bold transition-colors text-gray-400 hover:bg-white";
                        rulerLine.style.opacity = "0.5";
                        updateVisuals(); // Restaura estado de explora√ß√£o
                    };

                    btnChallenge.onclick = () => {
                        mode = "challenge";
                        btnChallenge.className =
                            "px-3 py-1 rounded text-xs font-bold transition-colors bg-white text-brand-purple shadow-sm";
                        btnExplore.className =
                            "px-3 py-1 rounded text-xs font-bold transition-colors text-gray-400 hover:bg-white";
                        startChallenge();
                    };

                    // Init
                    renderWall();
                },

                interactive_fraction_addition(container) {
                    // Fun√ß√£o Auxiliar de Simplifica√ß√£o (MDC)
                    // Usamos Math.abs para garantir que funcione mesmo se entrarem negativos
                    const gcd = (a, b) => (b === 0 ? a : gcd(b, a % b));

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans">
<h3 class="text-brand-blue font-bold uppercase text-xs mb-6 tracking-widest">Soma e Subtra√ß√£o</h3>

<div class="flex items-center gap-2 md:gap-4 mb-6 text-xl md:text-2xl font-bold text-brand-text">

<div class="flex flex-col items-center gap-1">
<input type="number" id="n1" value="1" class="w-12 md:w-16 text-center border-2 border-brand-blue rounded-lg p-1 outline-none focus:bg-blue-50 text-brand-blue">
<div class="w-full h-0.5 bg-brand-text"></div>
<input type="number" id="d1" value="2" min="1" class="w-12 md:w-16 text-center border-2 border-brand-blue rounded-lg p-1 outline-none focus:bg-blue-50 text-brand-blue">
</div>

<select id="op" class="bg-gray-100 rounded-lg p-2 font-bold cursor-pointer outline-none border-2 border-transparent focus:border-brand-gray">
<option value="+">+</option>
<option value="-">-</option>
</select>

<div class="flex flex-col items-center gap-1">
<input type="number" id="n2" value="1" class="w-12 md:w-16 text-center border-2 border-brand-orange rounded-lg p-1 outline-none focus:bg-orange-50 text-brand-orange">
<div class="w-full h-0.5 bg-brand-text"></div>
<input type="number" id="d2" value="3" min="1" class="w-12 md:w-16 text-center border-2 border-brand-orange rounded-lg p-1 outline-none focus:bg-orange-50 text-brand-orange">
</div>

<span class="text-gray-400 mx-1">=</span>

<div id="result-area" class="flex flex-col items-center gap-1 opacity-50">
<span class="res-n text-brand-purple">?</span>
<div class="w-full h-0.5 bg-brand-text"></div>
<span class="res-d text-brand-purple">?</span>
</div>
</div>

<div id="error-msg" class="hidden w-full bg-red-50 border border-red-200 rounded-xl p-3 text-center text-red-600 font-bold text-sm mb-4">
<i class="fas fa-ban"></i> Denominador inv√°lido!
</div>

<div id="steps-container" class="w-full bg-yellow-50 border border-yellow-200 rounded-xl p-4 text-sm hidden">
<p class="font-bold text-yellow-800 mb-2 flex items-center gap-2">
<i class="fas fa-info-circle"></i> Denominadores diferentes!
</p>
<div class="flex flex-col gap-2 font-mono text-center text-yellow-900">
<div>1. MMC de <span id="lbl-d1"></span> e <span id="lbl-d2"></span> √© <strong id="lbl-mmc"></strong>.</div>
<div class="flex items-center justify-center gap-2">
<span>Nova conta:</span>
<div class="inline-flex flex-col align-middle text-xs">
<span class="border-b border-black px-1" id="step-n1"></span><span id="step-mmc1"></span>
</div>
<span id="step-op"></span>
<div class="inline-flex flex-col align-middle text-xs">
<span class="border-b border-black px-1" id="step-n2"></span><span id="step-mmc2"></span>
</div>
</div>
</div>
</div>
</div>
`;

                    const inputs = container.querySelectorAll("input, select");
                    const stepsContainer = container.querySelector("#steps-container");
                    const errorMsg = container.querySelector("#error-msg");
                    const resultArea = container.querySelector("#result-area");

                    const update = () => {
                        const n1 = parseInt(container.querySelector("#n1").value) || 0;
                        let d1 = parseInt(container.querySelector("#d1").value);
                        const n2 = parseInt(container.querySelector("#n2").value) || 0;
                        let d2 = parseInt(container.querySelector("#d2").value);
                        const op = container.querySelector("#op").value;

                        // Prote√ß√£o contra NaN (se o campo estiver vazio)
                        if (isNaN(d1)) d1 = 0;
                        if (isNaN(d2)) d2 = 0;

                        // VERIFICA√á√ÉO DE ERRO (DIVIS√ÉO POR ZERO OU NEGATIVO)
                        // Embora o HTML tenha min="1", o usu√°rio pode digitar manualmente
                        if (d1 <= 0 || d2 <= 0) {
                            resultArea.querySelector(".res-n").innerText = "?";
                            resultArea.querySelector(".res-d").innerText = "?";
                            errorMsg.innerHTML =
                                d1 === 0 || d2 === 0
                                    ? `<i class="fas fa-ban"></i> Imposs√≠vel dividir por zero!`
                                    : `<i class="fas fa-exclamation-triangle"></i> Denominador deve ser positivo!`;

                            errorMsg.classList.remove("hidden");
                            stepsContainer.classList.add("hidden");
                            resultArea.classList.add("opacity-50");
                            return;
                        } else {
                            errorMsg.classList.add("hidden");
                        }

                        // L√≥gica do MMC (Usa Math.abs para seguran√ßa matem√°tica)
                        const getMMC = (a, b) =>
                            Math.abs(a * b) / gcd(Math.abs(a), Math.abs(b));
                        const mmc = getMMC(d1, d2);

                        // Novos Numeradores
                        const newN1 = n1 * (mmc / d1);
                        const newN2 = n2 * (mmc / d2);

                        // Resultado Final
                        let resN = op === "+" ? newN1 + newN2 : newN1 - newN2;
                        let resD = mmc;

                        // Simplifica√ß√£o
                        const common = gcd(Math.abs(resN), resD);
                        const simpleN = resN / common;
                        const simpleD = resD / common;

                        // Renderiza Resultado
                        resultArea.querySelector(".res-n").innerText = simpleN;
                        resultArea.querySelector(".res-d").innerText = simpleD;
                        resultArea.classList.remove("opacity-50");

                        // Renderiza Passos (Se necess√°rio)
                        if (d1 !== d2) {
                            stepsContainer.classList.remove("hidden");
                            container.querySelector("#lbl-d1").innerText = d1;
                            container.querySelector("#lbl-d2").innerText = d2;
                            container.querySelector("#lbl-mmc").innerText = mmc;

                            container.querySelector("#step-n1").innerText = newN1;
                            container.querySelector("#step-mmc1").innerText = mmc;
                            container.querySelector("#step-op").innerText = op;
                            container.querySelector("#step-n2").innerText = newN2;
                            container.querySelector("#step-mmc2").innerText = mmc;
                        } else {
                            stepsContainer.classList.add("hidden");
                        }
                    };

                    inputs.forEach((i) => i.addEventListener("input", update));
                    update();
                },

                interactive_fraction_mult(container) {
                    const gcd = (a, b) => (b === 0 ? a : gcd(b, a % b));

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col md:flex-row items-center justify-center gap-8 w-full shadow-sm">

<div class="flex flex-col items-center gap-4">
<h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest">Multiplica√ß√£o</h3>
<div class="flex items-center gap-2 text-xl font-bold">
<div class="flex flex-col items-center">
<input type="number" id="mn1" value="2" min="1" max="5" class="w-12 text-center border-b-2 border-brand-purple outline-none">
<input type="number" id="md1" value="3" min="1" max="5" class="w-12 text-center border-t-2 border-gray-300 outline-none">
</div>
<span class="text-brand-purple">√ó</span>
<div class="flex flex-col items-center">
<input type="number" id="mn2" value="1" min="1" max="5" class="w-12 text-center border-b-2 border-brand-blue outline-none">
<input type="number" id="md2" value="4" min="1" max="5" class="w-12 text-center border-t-2 border-gray-300 outline-none">
</div>
<span>=</span>
<div class="flex flex-col items-center text-brand-green">
<span id="m-res-n">2</span>
<div class="w-8 h-0.5 bg-current"></div>
<span id="m-res-d">12</span>
</div>
</div>
<div id="simp-msg" class="text-xs text-gray-400 font-bold hidden">Simplificando: <span id="simp-val"></span></div>
</div>

<div class="relative w-32 h-32 border-2 border-gray-800 bg-white shadow-md ml-6 mt-4">
<div id="grid-container" class="w-full h-full grid">
</div>

<div class="absolute -left-8 top-0 bottom-0 flex flex-col justify-center items-center text-xs font-bold text-brand-purple">
<span class="transform -rotate-90 whitespace-nowrap">Fra√ß√£o 1</span>
</div>

<div class="absolute -top-6 left-0 right-0 flex justify-center items-center text-xs font-bold text-brand-blue">
<span>Fra√ß√£o 2</span>
</div>
</div>
</div>
`;

                    const inputs = container.querySelectorAll("input");

                    const update = () => {
                        const n1 = parseInt(container.querySelector("#mn1").value) || 1;
                        const d1 = parseInt(container.querySelector("#md1").value) || 1;
                        const n2 = parseInt(container.querySelector("#mn2").value) || 1;
                        const d2 = parseInt(container.querySelector("#md2").value) || 1;

                        // Atualiza Grid CSS
                        const grid = container.querySelector("#grid-container");
                        grid.style.gridTemplateRows = `repeat(${d1}, 1fr)`; // Denominador 1 = Linhas
                        grid.style.gridTemplateColumns = `repeat(${d2}, 1fr)`; // Denominador 2 = Colunas

                        grid.innerHTML = "";

                        // Gera C√©lulas
                        for (let i = 0; i < d1; i++) {
                            for (let j = 0; j < d2; j++) {
                                const cell = document.createElement("div");
                                cell.className =
                                    "border border-gray-200 transition-colors duration-300";

                                const rowSelected = i < n1;
                                const colSelected = j < n2;

                                if (rowSelected && colSelected) {
                                    cell.className += " bg-brand-green border-green-600"; // Interse√ß√£o
                                } else if (rowSelected) {
                                    cell.className += " bg-purple-100"; // Apenas Frac 1
                                } else if (colSelected) {
                                    cell.className += " bg-blue-100"; // Apenas Frac 2
                                }

                                grid.appendChild(cell);
                            }
                        }

                        // Resultado Num√©rico
                        const resN = n1 * n2;
                        const resD = d1 * d2;
                        container.querySelector("#m-res-n").innerText = resN;
                        container.querySelector("#m-res-d").innerText = resD;

                        // Checa Simplifica√ß√£o
                        const s = gcd(resN, resD);
                        if (s > 1) {
                            container.querySelector("#simp-msg").classList.remove("hidden");
                            container.querySelector("#simp-val").innerText = `${resN / s}/${resD / s
                                }`;
                        } else {
                            container.querySelector("#simp-msg").classList.add("hidden");
                        }
                    };

                    inputs.forEach((i) => i.addEventListener("input", update));
                    update();
                },

                interactive_fraction_div(container) {
                    const gcd = (a, b) => (b === 0 ? a : gcd(b, a % b));

                    let state = { n1: 2, d1: 3, n2: 1, d2: 2, flipped: false };

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans">
<h3 class="text-brand-orange font-bold uppercase text-xs mb-6 tracking-widest">Divis√£o (Regra do Inverso)</h3>

<div class="flex items-center gap-2 md:gap-4 mb-8 relative h-20">

<div class="flex flex-col items-center gap-1">
<input type="number" id="div-n1" value="2" class="w-14 text-center border-2 border-brand-gray rounded-lg p-1 font-bold text-xl outline-none">
<div class="w-full h-0.5 bg-brand-text"></div>
<input type="number" id="div-d1" value="3" class="w-14 text-center border-2 border-brand-gray rounded-lg p-1 font-bold text-xl outline-none">
</div>

<div id="div-op" class="text-3xl font-black text-brand-orange transition-all duration-500">√∑</div>

<div id="frac-2-container" class="flex flex-col items-center gap-1 transition-transform duration-700">
<input type="number" id="div-n2" value="1" class="w-14 text-center border-2 border-brand-blue rounded-lg p-1 font-bold text-xl outline-none bg-blue-50">
<div class="w-full h-0.5 bg-brand-text"></div>
<input type="number" id="div-d2" value="4" class="w-14 text-center border-2 border-brand-green rounded-lg p-1 font-bold text-xl outline-none bg-green-50">
</div>

<span class="text-2xl text-gray-300 ml-2">=</span>

<div class="flex flex-col items-center gap-1 opacity-50 transition-opacity duration-500" id="div-res">
<span class="text-2xl font-bold text-brand-text" id="r-n">?</span>
<div class="w-full h-0.5 bg-brand-text"></div>
<span class="text-2xl font-bold text-brand-text" id="r-d">?</span>
</div>

</div>

<button id="btn-flip" class="bg-brand-orange hover:bg-orange-600 text-white font-bold py-2 px-6 rounded-xl shadow-btn active:translate-y-1 active:shadow-none transition-all flex items-center gap-2">
<i class="fas fa-sync-alt"></i> Inverter e Multiplicar
</button>
<div class="text-xs text-gray-400 mt-2 font-bold uppercase tracking-wide hidden" id="reset-msg">Clique para reiniciar</div>
</div>
`;

                    const n1El = container.querySelector("#div-n1");
                    const d1El = container.querySelector("#div-d1");
                    const n2El = container.querySelector("#div-n2");
                    const d2El = container.querySelector("#div-d2");
                    const frac2 = container.querySelector("#frac-2-container");
                    const op = container.querySelector("#div-op");
                    const btn = container.querySelector("#btn-flip");
                    const resDiv = container.querySelector("#div-res");

                    // Fun√ß√£o de Resolver
                    const solve = () => {
                        const n1 = parseInt(n1El.value);
                        const d1 = parseInt(d1El.value);
                        // Se flipou, usamos os valores visuais (que est√£o invertidos no DOM, mas logicamente aqui queremos o c√°lculo final)
                        // C√°lculo real: (n1/d1) / (n2/d2) = (n1 * d2) / (d1 * n2)
                        const n2 = parseInt(n2El.value);
                        const d2 = parseInt(d2El.value);

                        // Resultado Final sempre baseado nos inputs originais (antes de inverter visualmente)
                        // Se o estado √© "flipped", os inputs visuais j√° est√£o trocados? N√£o, vamos manter a l√≥gica simples:
                        // O c√°lculo matem√°tico √© fixo: N1*D2 e D1*N2 (Cruzado)

                        // Como visualmente invertemos os inputs, vamos calcular baseado no que o usu√°rio v√™.
                        // Se state.flipped √© true, o usu√°rio v√™ uma multiplica√ß√£o.

                        let finalN, finalD;

                        if (state.flipped) {
                            // Usu√°rio v√™ multiplica√ß√£o: Topo * Topo
                            // Nota: Ao flipar, trocamos os valores dos inputs via JS
                            finalN = parseInt(n1El.value) * parseInt(n2El.value);
                            finalD = parseInt(d1El.value) * parseInt(d2El.value);
                        } else {
                            // Usu√°rio v√™ divis√£o: C√°lculo cruzado
                            finalN = parseInt(n1El.value) * parseInt(d2El.value);
                            finalD = parseInt(d1El.value) * parseInt(n2El.value);
                        }

                        // Simplifica
                        const s = gcd(finalN, finalD);
                        container.querySelector("#r-n").innerText = finalN / s;
                        container.querySelector("#r-d").innerText = finalD / s;
                    };

                    btn.onclick = async () => {
                        if (!state.flipped) {
                            // Passo 1: Anima√ß√£o de Invers√£o
                            state.flipped = true;

                            // Trava inputs
                            [n1El, d1El, n2El, d2El].forEach((i) => (i.disabled = true));

                            // 1. Gira o container
                            frac2.style.transform = "rotate(180deg)";

                            // 2. Muda o operador
                            op.style.opacity = 0;

                            await new Promise((r) => setTimeout(r, 300));

                            op.innerText = "√ó"; // Vira multiplica√ß√£o
                            op.style.opacity = 1;
                            op.classList.replace("text-brand-orange", "text-brand-purple");

                            await new Promise((r) => setTimeout(r, 400)); // Espera rota√ß√£o terminar

                            // 3. Troca os valores internamente e des-rotaciona instantaneamente (truque visual)
                            // para que os n√∫meros n√£o fiquem de cabe√ßa para baixo
                            const tempVal = n2El.value;
                            const tempClass = n2El.className; // Troca cores tamb√©m

                            n2El.value = d2El.value;
                            d2El.value = tempVal;

                            // Reset rota√ß√£o (sem transi√ß√£o para o usu√°rio n√£o ver)
                            frac2.style.transition = "none";
                            frac2.style.transform = "rotate(0deg)";

                            // Feedback visual de resultado
                            solve();
                            resDiv.style.opacity = 1;
                            resDiv.classList.add("scale-110");

                            // Atualiza Bot√£o
                            btn.innerHTML = `<i class="fas fa-undo"></i> Reiniciar`;
                            btn.className =
                                "bg-gray-400 text-white font-bold py-2 px-6 rounded-xl hover:bg-gray-500 transition-all flex items-center gap-2";
                            container
                                .querySelector("#reset-msg")
                                .classList.remove("hidden");
                        } else {
                            // Reiniciar
                            state.flipped = false;

                            // Restaura Inputs
                            [n1El, d1El, n2El, d2El].forEach((i) => (i.disabled = false));

                            // Restaura Estilos
                            frac2.style.transition = "transform 0.7s";
                            op.innerText = "√∑";
                            op.classList.replace("text-brand-purple", "text-brand-orange");
                            resDiv.style.opacity = 0.5;
                            resDiv.classList.remove("scale-110");
                            container.querySelector("#r-n").innerText = "?";
                            container.querySelector("#r-d").innerText = "?";

                            btn.innerHTML = `<i class="fas fa-sync-alt"></i> Inverter e Multiplicar`;
                            btn.className =
                                "bg-brand-orange hover:bg-orange-600 text-white font-bold py-2 px-6 rounded-xl shadow-btn active:translate-y-1 active:shadow-none transition-all flex items-center gap-2";
                            container.querySelector("#reset-msg").classList.add("hidden");
                        }
                    };
                },

                interactive_decimal_align(container) {
                    // Estado inicial
                    let offset = -2; // Come√ßa desalinhado propositalmente (valores de -4 a 4)

                    // N√∫meros do problema (Fixos para este exemplo pedag√≥gico)
                    // Conta: 12,5 + 3,42
                    const num1 = { int: "12", dec: "5" }; // 12,5
                    const num2 = { int: "3", dec: "42" }; // 3,42

                    // 1. Inje√ß√£o do HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm select-none font-sans">

<div class="text-center mb-6">
<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-1">Miss√£o: Alinhar as V√≠rgulas</h3>
<p class="text-sm text-gray-400">Arraste o n√∫mero de baixo at√© as v√≠rgulas se encontrarem!</p>
</div>

<div class="relative bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl p-8 w-full max-w-sm overflow-hidden flex flex-col items-center justify-center gap-2 mb-6 transition-colors duration-300" id="math-zone">

<div class="absolute top-0 bottom-0 left-1/2 w-0.5 bg-brand-red opacity-50 z-0 dashed-line"></div>

<div class="flex items-baseline text-4xl md:text-5xl font-mono font-bold text-gray-400 z-10 relative">
<span>12</span>
<span class="text-brand-red mx-1">,</span>
<span>5&nbsp;</span> </div>

<div class="absolute left-4 top-1/2 -translate-y-1/2 text-2xl font-bold text-gray-300">+</div>

<div id="movable-row" class="flex items-baseline text-4xl md:text-5xl font-mono font-bold text-brand-blue z-10 relative transition-transform duration-100 cursor-grab active:cursor-grabbing" style="transform: translateX(-50px)">
<span>3</span>
<span class="text-brand-red mx-1 scale-125 inline-block transition-transform" id="comma-2">,</span>
<span>42</span>
</div>

<div class="w-full border-b-4 border-gray-300 mt-2 z-10"></div>

<div id="result-display" class="h-12 mt-2 text-4xl md:text-5xl font-mono font-bold text-brand-green opacity-0 transition-all duration-300 transform translate-y-2">
15,92
</div>
</div>

<div class="w-full max-w-xs px-4">
<input type="range" id="align-slider" min="-4" max="4" value="-2" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue hover:accent-brand-blueDark">
<div class="flex justify-between text-[10px] text-gray-400 font-bold mt-2 uppercase">
<span>Esquerda</span>
<span>Direita</span>
</div>
</div>

<div id="feedback-msg" class="mt-4 font-bold text-brand-red animate-pulse">
<i class="fas fa-times-circle"></i> V√≠rgula desalinhada!
</div>
</div>
`;

                    // 2. Seletores
                    const slider = container.querySelector("#align-slider");
                    const movableRow = container.querySelector("#movable-row");
                    const mathZone = container.querySelector("#math-zone");
                    const resultDisplay = container.querySelector("#result-display");
                    const feedbackMsg = container.querySelector("#feedback-msg");
                    const comma2 = container.querySelector("#comma-2");

                    // 3. Fun√ß√£o de Atualiza√ß√£o
                    const update = () => {
                        const val = parseInt(slider.value);

                        // Move o n√∫mero visualmente (aprox 30px por passo do slider)
                        // A l√≥gica aqui √© visual: alinhar o elemento DOM
                        const pxOffset = val * 24;
                        movableRow.style.transform = `translateX(${pxOffset}px)`;

                        // Verifica se alinhou (O valor 0 √© o "centro" l√≥gico que definimos)
                        // No nosso caso, o valor correto no slider que alinha 3,42 com 12,5 depende do layout visual.
                        // Vamos assumir que '1' √© o alinhamento correto para este exemplo espec√≠fico
                        // Ajuste fino: 12,5 vs 3,42.
                        // 12,5
                        //3,42
                        // O '3' deve ficar embaixo do '2'. A v√≠rgula embaixo da v√≠rgula.

                        // Para simplificar a l√≥gica visual do slider, vamos dizer que 0 √© o alvo.
                        // Ajustaremos o CSS inicial para que 0 seja visualmente alinhado.

                        if (val === 0) {
                            // SUCESSO
                            mathZone.classList.remove("border-gray-300", "bg-gray-50");
                            mathZone.classList.add("border-brand-green", "bg-green-50");

                            resultDisplay.style.opacity = 1;
                            resultDisplay.style.transform = "translateY(0)";

                            feedbackMsg.className = "mt-4 font-bold text-brand-green";
                            feedbackMsg.innerHTML = `<i class="fas fa-check-circle"></i> Perfeito! V√≠rgula sobre v√≠rgula.`;

                            comma2.classList.add("scale-150", "text-brand-green"); // Destaque na v√≠rgula
                        } else {
                            // ERRO
                            mathZone.classList.add("border-gray-300", "bg-gray-50");
                            mathZone.classList.remove("border-brand-green", "bg-green-50");

                            resultDisplay.style.opacity = 0;
                            resultDisplay.style.transform = "translateY(10px)";

                            feedbackMsg.className = "mt-4 font-bold text-brand-red";
                            feedbackMsg.innerHTML = `<i class="fas fa-times-circle"></i> V√≠rgula desalinhada!`;

                            comma2.classList.remove("scale-150", "text-brand-green");
                        }
                    };

                    // 4. Listeners
                    slider.addEventListener("input", update);

                    // Inicializa (Dispara o evento para setar a posi√ß√£o inicial errada)
                    update();
                },

                interactive_decimal_add_sub(container) {
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans">
<h3 class="text-brand-blue font-bold uppercase text-xs mb-4 tracking-widest">Alinhamento Autom√°tico</h3>

<div class="flex items-center gap-2 mb-6">
<input type="number" id="dec-n1" value="12.5" step="0.1" class="w-20 md:w-24 text-center border-2 border-brand-blue rounded-lg p-2 font-bold text-lg outline-none focus:bg-blue-50 text-brand-text">
<select id="dec-op" class="bg-gray-100 rounded-lg p-2 font-bold cursor-pointer outline-none border-2 border-transparent focus:border-brand-gray text-xl">
<option value="+">+</option>
<option value="-">-</option>
</select>
<input type="number" id="dec-n2" value="3.42" step="0.01" class="w-20 md:w-24 text-center border-2 border-brand-orange rounded-lg p-2 font-bold text-lg outline-none focus:bg-orange-50 text-brand-text">
</div>

<div class="bg-gray-800 text-white p-6 rounded-xl font-mono text-2xl md:text-3xl flex flex-col items-end shadow-inner border-4 border-gray-300 relative min-w-[200px]">

<div class="absolute top-0 bottom-0 right-[3.25rem] w-px bg-red-500 opacity-50 z-0"></div>

<div id="row-1" class="z-10 relative">12,50</div>
<div id="row-2" class="z-10 relative pr-2 border-b-2 border-white w-full text-right mb-2 pb-1">
<span class="absolute left-0 text-gray-400" id="op-display">+</span>
3,42
</div>
<div id="row-res" class="z-10 relative text-brand-green font-bold">15,92</div>

</div>

<p class="mt-4 text-xs text-gray-400 font-bold uppercase">
<i class="fas fa-info-circle"></i> O computador preenche com zeros para alinhar!
</p>
</div>
`;

                    const n1El = container.querySelector("#dec-n1");
                    const n2El = container.querySelector("#dec-n2");
                    const opEl = container.querySelector("#dec-op");

                    const row1 = container.querySelector("#row-1");
                    const row2 = container.querySelector("#row-2");
                    const rowRes = container.querySelector("#row-res");
                    const opDisplay = container.querySelector("#op-display");

                    const update = () => {
                        let val1 = parseFloat(n1El.value) || 0;
                        let val2 = parseFloat(n2El.value) || 0;
                        const operator = opEl.value;

                        // Calcula resultado real
                        let res = operator === "+" ? val1 + val2 : val1 - val2;

                        // Formata√ß√£o para Alinhamento Visual
                        // Descobre qual tem mais casas decimais para padronizar
                        const s1 = val1.toString();
                        const s2 = val2.toString();
                        const dec1 = s1.includes(".") ? s1.split(".")[1].length : 0;
                        const dec2 = s2.includes(".") ? s2.split(".")[1].length : 0;
                        const maxDec = Math.max(dec1, dec2);

                        // Formata fixando as casas decimais (isso adiciona os zeros fantasmas)
                        // e troca ponto por v√≠rgula para o padr√£o BR
                        const fmt = (n) => n.toFixed(maxDec).replace(".", ",");

                        row1.innerHTML = fmt(val1).replace(
                            /0+$/,
                            (match) => `<span class="text-gray-500">${match}</span>`
                        ); // Zeros extras cinza? (Opcional, aqui deixei normal)
                        // Melhor: Apenas formatar string
                        row1.innerText = fmt(val1);

                        // Atualiza linha 2 mantendo o operador visual
                        row2.innerHTML = `<span class="absolute left-0 text-gray-400">${operator}</span> ${fmt(
                            val2
                        )}`;

                        rowRes.innerText = fmt(res);
                    };

                    [n1El, n2El, opEl].forEach((el) =>
                        el.addEventListener("input", update)
                    );
                    update();
                },

                interactive_decimal_mult(container) {
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans">
<h3 class="text-brand-purple font-bold uppercase text-xs mb-6 tracking-widest">Multiplica√ß√£o: Conte as Casas!</h3>

<div class="flex flex-col md:flex-row items-center gap-8 w-full justify-center">

<div class="flex flex-col gap-4">
<div class="flex items-center gap-2">
<input type="number" id="mul-n1" value="2.5" step="0.1" class="w-20 text-center border-b-2 border-brand-purple outline-none font-bold text-xl">
<span class="text-xs font-bold text-brand-purple bg-purple-50 px-2 py-1 rounded-full whitespace-nowrap" id="count-1">1 casa</span>
</div>
<div class="flex items-center gap-2">
<span class="text-xl font-bold text-gray-300">√ó</span>
<input type="number" id="mul-n2" value="0.03" step="0.01" class="w-20 text-center border-b-2 border-brand-purple outline-none font-bold text-xl">
<span class="text-xs font-bold text-brand-purple bg-purple-50 px-2 py-1 rounded-full whitespace-nowrap" id="count-2">2 casas</span>
</div>
</div>

<div class="flex flex-col items-center bg-gray-50 p-4 rounded-xl border-2 border-dashed border-gray-200 min-w-[200px]">
<div class="text-sm text-gray-400 font-bold mb-2">Total de Casas: <span id="total-count" class="text-brand-red">3</span></div>

<div class="opacity-50 text-sm font-mono mb-1" id="int-calc">25 √ó 3 = 75</div>

<div class="text-4xl font-mono font-bold text-brand-green" id="mul-res">0,075</div>

<div class="flex mt-1 gap-1" id="dots-container">
</div>
</div>
</div>
</div>
`;

                    const n1El = container.querySelector("#mul-n1");
                    const n2El = container.querySelector("#mul-n2");
                    const count1El = container.querySelector("#count-1");
                    const count2El = container.querySelector("#count-2");
                    const totalCountEl = container.querySelector("#total-count");
                    const intCalcEl = container.querySelector("#int-calc");
                    const resEl = container.querySelector("#mul-res");
                    const dotsContainer = container.querySelector("#dots-container");

                    const countDecimals = (n) => {
                        if (Math.floor(n) === n) return 0;
                        return n.toString().split(".")[1].length || 0;
                    };

                    const update = () => {
                        const v1 = parseFloat(n1El.value) || 0;
                        const v2 = parseFloat(n2El.value) || 0;

                        const c1 = countDecimals(v1);
                        const c2 = countDecimals(v2);
                        const total = c1 + c2;

                        // Atualiza Labels
                        count1El.innerText = c1 === 1 ? "1 casa" : `${c1} casas`;
                        count2El.innerText = c2 === 1 ? "1 casa" : `${c2} casas`;
                        totalCountEl.innerText = total;

                        // C√°lculo Inteiro (Ignorando v√≠rgula)
                        // Remove o ponto e trata como string -> int para mostrar a l√≥gica "Esquece a v√≠rgula"
                        const int1 = parseInt(v1.toString().replace(".", ""));
                        const int2 = parseInt(v2.toString().replace(".", ""));
                        const intRes = int1 * int2;
                        intCalcEl.innerText = `${int1} √ó ${int2} = ${intRes}`;

                        // Resultado Real
                        // Resolvemos problemas de ponto flutuante multiplicando e dividindo por pot√™ncias de 10
                        // Ou simplesmente usamos toFixed para o total de casas
                        let res = v1 * v2;
                        // Hackzinho JS para evitar 0.30000000004
                        res = parseFloat(res.toFixed(total + 2)); // Limpa lixo

                        // Formata BR
                        let resStr = res.toString().replace(".", ",");

                        // Se o JS "comeu" zeros (ex: 0.075 -> 0.075), precisamos garantir que mostre todas as casas?
                        // Para multiplica√ß√£o did√°tica, usamos toFixed(total) se necess√°rio, mas as vezes simplifica.
                        // Vamos deixar o c√°lculo JS padr√£o, mas formatado.

                        // Caso especial: for√ßar mostrar zeros √† esquerda se necess√°rio para did√°tica?
                        // Ex: 0,2 x 0,3 = 0,06. O JS faz certo.
                        resEl.innerText = resStr;

                        // Pontinhos Visuais (Pulos do Sapo)
                        dotsContainer.innerHTML = "";
                        for (let i = 0; i < total; i++) {
                            const dot = document.createElement("div");
                            dot.className =
                                "w-2 h-2 bg-brand-red rounded-full animate-bounce";
                            dot.style.animationDelay = `${i * 0.2}s`;
                            dotsContainer.appendChild(dot);
                        }
                    };

                    n1El.addEventListener("input", update);
                    n2El.addEventListener("input", update);
                    update();
                },

                interactive_decimal_div(container) {
                    let state = { multiplied: false, power: 0 };

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans">
<h3 class="text-brand-orange font-bold uppercase text-xs mb-6 tracking-widest">Divis√£o: Elimine a V√≠rgula!</h3>

<div class="flex items-center gap-4 text-2xl md:text-4xl font-mono font-bold text-brand-text mb-8 p-4 bg-gray-50 rounded-xl border border-gray-200 transition-all duration-500" id="div-box">

<span id="d-n1" class="transition-all">2,5</span>

<span class="text-brand-orange">√∑</span>

<span id="d-n2" class="transition-all">0,05</span>

</div>

<div class="flex flex-col items-center gap-2">
<button id="btn-elim" class="bg-brand-orange hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-xl shadow-btn active:shadow-none active:translate-y-1 transition-all flex items-center gap-2">
<i class="fas fa-magic"></i>
<span>Multiplicar por 10, 100...</span>
</button>

<div id="div-res-container" class="opacity-0 transition-opacity mt-4 text-center">
<div class="text-xs text-gray-400 uppercase font-bold mb-1">Resultado</div>
<div class="text-4xl font-bold text-brand-green" id="div-result">50</div>
</div>
</div>

<div class="mt-8 pt-4 border-t border-gray-100 w-full flex justify-center gap-4 text-sm">
<div class="flex flex-col items-center">
<label class="text-[10px] uppercase font-bold text-gray-400">Dividendo</label>
<input type="number" id="in-n1" value="2.5" step="0.1" class="w-16 text-center border rounded bg-gray-50">
</div>
<div class="flex flex-col items-center">
<label class="text-[10px] uppercase font-bold text-gray-400">Divisor</label>
<input type="number" id="in-n2" value="0.05" step="0.01" class="w-16 text-center border rounded bg-gray-50">
</div>
<button id="btn-reset" class="text-xs text-brand-blue font-bold underline">Reiniciar</button>
</div>
</div>
`;

                    const n1Display = container.querySelector("#d-n1");
                    const n2Display = container.querySelector("#d-n2");
                    const divBox = container.querySelector("#div-box");
                    const btnElim = container.querySelector("#btn-elim");
                    const resContainer = container.querySelector("#div-res-container");
                    const resDisplay = container.querySelector("#div-result");

                    const inN1 = container.querySelector("#in-n1");
                    const inN2 = container.querySelector("#in-n2");
                    const btnReset = container.querySelector("#btn-reset");

                    const getDecimals = (n) => {
                        if (Math.floor(n) === n) return 0;
                        return n.toString().split(".")[1].length || 0;
                    };

                    const updateDisplay = (v1, v2) => {
                        n1Display.innerText = v1.toString().replace(".", ",");
                        n2Display.innerText = v2.toString().replace(".", ",");
                    };

                    // L√≥gica Principal
                    btnElim.onclick = () => {
                        const v1 = parseFloat(inN1.value);
                        const v2 = parseFloat(inN2.value);

                        // Descobre por quanto multiplicar (10, 100, 1000...)
                        const maxDec = Math.max(getDecimals(v1), getDecimals(v2));

                        if (maxDec === 0) {
                            // J√° s√£o inteiros, s√≥ mostra o resultado
                            showResult(v1, v2);
                            return;
                        }

                        const multiplier = Math.pow(10, maxDec);
                        const newV1 = Math.round(v1 * multiplier); // Round remove erros de float
                        const newV2 = Math.round(v2 * multiplier);

                        // Anima√ß√£o
                        divBox.classList.add(
                            "scale-110",
                            "bg-orange-50",
                            "border-brand-orange"
                        );

                        // Texto indicativo
                        btnElim.innerHTML = `<i class="fas fa-check"></i> V√≠rgulas Eliminadas (x${multiplier})`;
                        btnElim.classList.replace("bg-brand-orange", "bg-brand-green");
                        btnElim.classList.add("pointer-events-none"); // Trava bot√£o

                        setTimeout(() => {
                            updateDisplay(newV1, newV2);
                            showResult(newV1, newV2);
                        }, 300);
                    };

                    const showResult = (v1, v2) => {
                        const res = v2 === 0 ? "Erro" : v1 / v2;
                        // Formata resultado (se ainda for decimal, usa v√≠rgula)
                        resDisplay.innerText = res.toString().replace(".", ",");
                        resContainer.classList.remove("opacity-0");
                        divBox.classList.remove("scale-110");
                    };

                    // Reset
                    const reset = () => {
                        const v1 = parseFloat(inN1.value);
                        const v2 = parseFloat(inN2.value);
                        updateDisplay(v1, v2);

                        divBox.classList.remove("bg-orange-50", "border-brand-orange");
                        resContainer.classList.add("opacity-0");

                        btnElim.innerHTML = `<i class="fas fa-magic"></i> <span>Multiplicar por 10, 100...</span>`;
                        btnElim.classList.replace("bg-brand-green", "bg-brand-orange");
                        btnElim.classList.remove("pointer-events-none");
                    };

                    inN1.addEventListener("input", reset);
                    inN2.addEventListener("input", reset);
                    btnReset.addEventListener("click", reset);

                    // Init
                    updateDisplay(parseFloat(inN1.value), parseFloat(inN2.value));
                },

                interactive_geometry_canvas(container) {
                    // Estado
                    let points = [];
                    let isClosed = false;
                    let cursor = { x: 0, y: 0 };
                    const gridSize = 30; // Pixels por unidade

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-4 flex flex-col items-center w-full shadow-sm font-sans select-none">

<div class="flex justify-between w-full items-center mb-4">
<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest">Construtor de Pol√≠gonos</h3>
<button id="btn-clear" class="text-xs font-bold text-red-500 hover:bg-red-50 px-3 py-1 rounded transition-colors border border-red-200">
<i class="fas fa-trash"></i> Limpar
</button>
</div>

<div class="relative bg-gray-50 border-2 border-brand-blue rounded-xl overflow-hidden cursor-crosshair shadow-inner" style="width: 100%; height: 300px;" id="canvas-wrapper">
<div class="absolute inset-0 pointer-events-none" style="background-image: radial-gradient(#CBD5E1 1px, transparent 1px); background-size: 30px 30px;"></div>

<svg width="100%" height="100%" id="geo-svg" class="relative z-10">
<path id="poly-path" fill="rgba(28, 176, 246, 0.1)" stroke="#1CB0F6" stroke-width="2" stroke-linejoin="round" />
<line id="preview-line" stroke="#9CA3AF" stroke-width="2" stroke-dasharray="5,5" class="hidden" />

<g id="vertices-group"></g>
</svg>

<div id="tooltip" class="absolute top-2 left-2 bg-white/90 px-2 py-1 rounded text-[10px] font-mono text-gray-500 border border-gray-200 pointer-events-none hidden">
x:0, y:0
</div>
</div>

<div class="w-full mt-4 grid grid-cols-3 gap-2 text-center">
<div class="bg-gray-100 p-2 rounded-lg">
<span class="text-[10px] font-bold text-gray-400 uppercase block">V√©rtices</span>
<span class="font-black text-brand-purple text-xl" id="info-vertices">0</span>
</div>
<div class="bg-gray-100 p-2 rounded-lg">
<span class="text-[10px] font-bold text-gray-400 uppercase block">Per√≠metro</span>
<span class="font-black text-brand-orange text-xl" id="info-perimeter">0</span>
<span class="text-[10px] text-gray-400">unidades</span>
</div>
<div class="bg-gray-100 p-2 rounded-lg">
<span class="text-[10px] font-bold text-gray-400 uppercase block">Nome</span>
<span class="font-bold text-brand-blue text-sm leading-tight flex items-center justify-center h-7" id="info-name">-</span>
</div>
</div>

<p class="text-xs text-gray-400 mt-3 italic" id="status-msg">Clique no grid para adicionar o ponto A.</p>

</div>
`;

                    // 2. Seletores
                    const svg = container.querySelector("#geo-svg");
                    const verticesGroup = container.querySelector("#vertices-group");
                    const polyPath = container.querySelector("#poly-path");
                    const previewLine = container.querySelector("#preview-line");
                    const btnClear = container.querySelector("#btn-clear");
                    const tooltip = container.querySelector("#tooltip");
                    const wrapper = container.querySelector("#canvas-wrapper");

                    const infoV = container.querySelector("#info-vertices");
                    const infoP = container.querySelector("#info-perimeter");
                    const infoN = container.querySelector("#info-name");
                    const statusMsg = container.querySelector("#status-msg");

                    // 3. Fun√ß√µes Matem√°ticas
                    const dist = (p1, p2) =>
                        Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));

                    const getPolyName = (n) => {
                        if (n < 3) return "-";
                        if (n === 3) return "Tri√¢ngulo";
                        if (n === 4) return "Quadril√°tero";
                        if (n === 5) return "Pent√°gono";
                        if (n === 6) return "Hex√°gono";
                        if (n === 7) return "Hept√°gono";
                        if (n === 8) return "Oct√≥gono";
                        return "Pol√≠gono";
                    };

                    // 4. Renderiza√ß√£o
                    const render = () => {
                        // Atualiza V√©rtices
                        verticesGroup.innerHTML = "";
                        points.forEach((p, i) => {
                            const circle = document.createElementNS(
                                "http://www.w3.org/2000/svg",
                                "circle"
                            );
                            circle.setAttribute("cx", p.x);
                            circle.setAttribute("cy", p.y);
                            circle.setAttribute("r", 5);

                            // O primeiro ponto ganha destaque para indicar fechamento
                            if (i === 0 && !isClosed && points.length > 2) {
                                circle.setAttribute("fill", "#FF9600"); // Laranja = Alvo para fechar
                                circle.setAttribute("r", 7);
                                circle.classList.add("animate-pulse");
                            } else {
                                circle.setAttribute("fill", "#4B4B4B");
                            }

                            circle.setAttribute("stroke", "white");
                            circle.setAttribute("stroke-width", "2");

                            // Label (A, B, C...)
                            const text = document.createElementNS(
                                "http://www.w3.org/2000/svg",
                                "text"
                            );
                            text.setAttribute("x", p.x + 8);
                            text.setAttribute("y", p.y - 8);
                            text.setAttribute(
                                "class",
                                "text-xs font-bold fill-gray-500 select-none"
                            );
                            text.textContent = String.fromCharCode(65 + i); // A, B, C...

                            verticesGroup.appendChild(text);
                            verticesGroup.appendChild(circle);
                        });

                        // Atualiza Caminho (Linhas)
                        if (points.length > 0) {
                            let d = `M ${points[0].x} ${points[0].y}`;
                            for (let i = 1; i < points.length; i++) {
                                d += ` L ${points[i].x} ${points[i].y}`;
                            }
                            if (isClosed) d += " Z"; // Fecha

                            polyPath.setAttribute("d", d);

                            if (isClosed) {
                                polyPath.setAttribute("fill", "rgba(28, 176, 246, 0.2)");
                                polyPath.setAttribute("stroke", "#1CB0F6");
                            } else {
                                polyPath.setAttribute("fill", "none");
                                polyPath.setAttribute("stroke", "#4B4B4B");
                            }
                        } else {
                            polyPath.setAttribute("d", "");
                        }

                        // Atualiza Stats
                        infoV.innerText = points.length;
                        infoN.innerText = isClosed
                            ? getPolyName(points.length)
                            : points.length > 0
                                ? "Em constru√ß√£o..."
                                : "-";

                        // Calcula Per√≠metro
                        let perim = 0;
                        if (points.length > 1) {
                            for (let i = 0; i < points.length - 1; i++) {
                                perim += dist(points[i], points[i + 1]);
                            }
                            if (isClosed) {
                                perim += dist(points[points.length - 1], points[0]);
                            }
                        }
                        // Converte px para "unidades de grid" (30px = 1u)
                        infoP.innerText = (perim / gridSize).toFixed(1);
                    };

                    // 5. Intera√ß√£o
                    wrapper.onmousemove = (e) => {
                        const rect = wrapper.getBoundingClientRect();
                        const rawX = e.clientX - rect.left;
                        const rawY = e.clientY - rect.top;

                        // Snap to Grid (Arredonda para o m√∫ltiplo de gridSize mais pr√≥ximo)
                        const snapX = Math.round(rawX / gridSize) * gridSize;
                        const snapY = Math.round(rawY / gridSize) * gridSize;

                        cursor = { x: snapX, y: snapY };

                        // Atualiza Tooltip
                        const gridX = Math.round(cursor.x / gridSize);
                        const gridY = Math.round(cursor.y / gridSize); // Y cresce pra baixo aqui, ok
                        tooltip.innerText = `(${gridX}, ${gridY})`;
                        tooltip.style.left = `${rawX + 10}px`;
                        tooltip.style.top = `${rawY + 10}px`;
                        tooltip.classList.remove("hidden");

                        // Linha de Previs√£o (Rubber banding)
                        if (!isClosed && points.length > 0) {
                            const last = points[points.length - 1];
                            previewLine.setAttribute("x1", last.x);
                            previewLine.setAttribute("y1", last.y);

                            // Detecta se est√° em cima do primeiro ponto para fechar
                            const first = points[0];
                            const distToFirst = dist(cursor, first);

                            if (points.length > 2 && distToFirst < 10) {
                                // Snap no primeiro ponto
                                previewLine.setAttribute("x2", first.x);
                                previewLine.setAttribute("y2", first.y);
                                previewLine.setAttribute("stroke", "#FF9600"); // Laranja indica fechar
                                statusMsg.innerText =
                                    "Clique no ponto inicial para FECHAR a forma.";
                                statusMsg.classList.add("text-brand-orange");
                            } else {
                                previewLine.setAttribute("x2", cursor.x);
                                previewLine.setAttribute("y2", cursor.y);
                                previewLine.setAttribute("stroke", "#9CA3AF");
                                statusMsg.innerText = "Clique para adicionar v√©rtices.";
                                statusMsg.classList.remove("text-brand-orange");
                            }

                            previewLine.classList.remove("hidden");
                        } else {
                            previewLine.classList.add("hidden");
                        }
                    };

                    wrapper.onmouseleave = () => {
                        tooltip.classList.add("hidden");
                        previewLine.classList.add("hidden");
                    };

                    wrapper.onclick = () => {
                        if (isClosed) return; // Reseta primeiro

                        // Verifica se clicou no primeiro ponto para fechar
                        if (points.length > 2) {
                            const first = points[0];
                            if (dist(cursor, first) < 10) {
                                isClosed = true;
                                statusMsg.innerText = "Figura Fechada! Veja as propriedades.";
                                statusMsg.className =
                                    "text-xs text-brand-green font-bold mt-3";
                                render();
                                return;
                            }
                        }

                        // Adiciona novo ponto
                        // Verifica duplicatas (n√£o clicar no mesmo lugar)
                        if (points.length > 0) {
                            const last = points[points.length - 1];
                            if (last.x === cursor.x && last.y === cursor.y) return;
                        }

                        points.push({ ...cursor });
                        render();
                    };

                    btnClear.onclick = () => {
                        points = [];
                        isClosed = false;
                        statusMsg.innerText = "Clique no grid para adicionar o ponto A.";
                        statusMsg.className = "text-xs text-gray-400 mt-3 italic";
                        render();
                    };

                    // Init
                    render();
                },

                interactive_angle_maker(container) {
                    // Estado inicial
                    let currentAngle = 45;

                    // 1. INJE√á√ÉO DO HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Classifica√ß√£o de √Çngulos</h3>

<div class="relative mb-4">
<canvas id="angle-canvas" width="300" height="180" class="bg-white rounded-xl"></canvas>

<div id="angle-value" class="absolute top-4 right-4 text-4xl font-black text-brand-text opacity-20">
45¬∞
</div>
</div>

<div class="w-full max-w-xs mb-6 px-2">
<input type="range" id="angle-slider" min="0" max="180" value="45" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue hover:accent-brand-blueDark transition-all">
</div>

<div class="flex items-center justify-between w-full max-w-xs bg-gray-50 p-4 rounded-xl border-2 transition-colors duration-300" id="info-panel">
<div class="flex flex-col">
<span class="text-[10px] text-gray-400 font-bold uppercase">Classifica√ß√£o</span>
<span id="angle-type" class="text-xl font-black text-brand-blue uppercase tracking-wide">Agudo</span>
</div>
<div class="text-3xl font-bold text-brand-text" id="angle-display">45¬∞</div>
</div>

<div class="flex gap-2 mt-4 flex-wrap justify-center">
<button class="shortcut-btn bg-white border border-gray-200 px-3 py-1 rounded-lg text-xs font-bold text-gray-500 hover:bg-gray-100 active:scale-95 transition-transform" data-val="0">0¬∞</button>
<button class="shortcut-btn bg-white border border-gray-200 px-3 py-1 rounded-lg text-xs font-bold text-gray-500 hover:bg-gray-100 active:scale-95 transition-transform" data-val="45">45¬∞</button>
<button class="shortcut-btn bg-white border border-gray-200 px-3 py-1 rounded-lg text-xs font-bold text-gray-500 hover:bg-gray-100 active:scale-95 transition-transform" data-val="90">90¬∞</button>
<button class="shortcut-btn bg-white border border-gray-200 px-3 py-1 rounded-lg text-xs font-bold text-gray-500 hover:bg-gray-100 active:scale-95 transition-transform" data-val="135">135¬∞</button>
<button class="shortcut-btn bg-white border border-gray-200 px-3 py-1 rounded-lg text-xs font-bold text-gray-500 hover:bg-gray-100 active:scale-95 transition-transform" data-val="180">180¬∞</button>
</div>
</div>
`;

                    // 2. SELETORES
                    const canvas = container.querySelector("#angle-canvas");
                    const ctx = canvas.getContext("2d");
                    const slider = container.querySelector("#angle-slider");
                    const angleDisplay = container.querySelector("#angle-display");
                    const angleValueOverlay = container.querySelector("#angle-value");
                    const angleType = container.querySelector("#angle-type");
                    const infoPanel = container.querySelector("#info-panel");
                    const buttons = container.querySelectorAll(".shortcut-btn");

                    // Configura√ß√µes de Desenho
                    // Aumentando a resolu√ß√£o visual do canvas para telas retina
                    const scale = window.devicePixelRatio || 1;
                    canvas.width = 300 * scale;
                    canvas.height = 180 * scale;
                    ctx.scale(scale, scale);
                    canvas.style.width = "300px";
                    canvas.style.height = "180px";

                    // Origem (Ponto central inferior)
                    const cx = 150;
                    const cy = 150;
                    const radius = 100; // Comprimento da reta

                    // 3. FUN√á√ÉO DE DESENHO
                    const draw = (deg) => {
                        // Limpa
                        ctx.clearRect(0, 0, 300, 180);

                        // Determina Cor e Tipo
                        let color = "#58CC02"; // Verde (Agudo)
                        let type = "AGUDO";
                        let bgClass = "border-brand-green bg-green-50";

                        if (deg === 0) {
                            type = "NULO";
                            color = "#E5E5E5"; // Cinza
                            bgClass = "border-gray-200 bg-gray-50";
                        } else if (deg === 90) {
                            type = "RETO";
                            color = "#1CB0F6"; // Azul
                            bgClass = "border-brand-blue bg-blue-50";
                        } else if (deg > 90 && deg < 180) {
                            type = "OBTUSO";
                            color = "#FFC800"; // Amarelo
                            bgClass = "border-brand-yellow bg-yellow-50";
                        } else if (deg === 180) {
                            type = "RASO";
                            color = "#FF4B4B"; // Vermelho
                            bgClass = "border-brand-red bg-red-50";
                        }

                        // Atualiza UI Texto
                        angleDisplay.innerText = `${deg}¬∞`;
                        angleValueOverlay.innerText = `${deg}¬∞`;
                        angleType.innerText = type;
                        angleType.style.color = color;
                        infoPanel.className = `flex items-center justify-between w-full max-w-xs p-4 rounded-xl border-2 transition-colors duration-300 ${bgClass}`;

                        // --- DESENHO NO CANVAS ---

                        // Converter para radianos
                        // Nota: Canvas Y cresce para baixo. 0 rad √© direita (3h).
                        // Queremos 0 rad na direita e ir subindo (anti-hor√°rio).
                        // A coordenada Y deve ser: cy - sin(rad) * r
                        const rad = deg * (Math.PI / 180);

                        // 1. Linha Base (Fixa na horizontal direita)
                        ctx.beginPath();
                        ctx.lineWidth = 4;
                        ctx.lineCap = "round";
                        ctx.strokeStyle = "#4B4B4B"; // Cinza escuro
                        ctx.moveTo(cx, cy);
                        ctx.lineTo(cx + radius, cy);
                        ctx.stroke();

                        // 2. Linha M√≥vel (Gira)
                        // Math.cos(rad) d√° X, Math.sin(rad) d√° Y.
                        // Negativo no Y porque o canvas √© invertido verticalmente.
                        const x2 = cx + radius * Math.cos(-rad);
                        const y2 = cy + radius * Math.sin(-rad);

                        ctx.beginPath();
                        ctx.moveTo(cx, cy);
                        ctx.lineTo(x2, y2);
                        ctx.stroke();

                        // 3. Arco do √Çngulo (Preenchimento)
                        if (deg > 0) {
                            ctx.beginPath();

                            // Desenho Especial para 90 Graus (Quadrado)
                            if (deg === 90) {
                                const size = 20;
                                ctx.strokeStyle = color;
                                ctx.lineWidth = 2;
                                ctx.moveTo(cx + size, cy); // Ponto na base
                                ctx.lineTo(cx + size, cy - size); // Canto flutuante
                                ctx.lineTo(cx, cy - size); // Ponto na reta vertical
                                ctx.stroke();

                                // Pontinho no meio
                                ctx.beginPath();
                                ctx.fillStyle = color;
                                ctx.arc(cx + size / 2, cy - size / 2, 2, 0, Math.PI * 2);
                                ctx.fill();
                            } else {
                                // Arco Normal
                                const arcRadius = 40;
                                ctx.fillStyle = color + "33"; // 20% opacidade (hex alpha)
                                ctx.strokeStyle = color;
                                ctx.lineWidth = 2;

                                ctx.moveTo(cx, cy);
                                // arc(x, y, radius, startAngle, endAngle, counterClockwise)
                                // Start: 0. End: -rad (porque √© anti-hor√°rio no visual, mas canvas conta hor√°rio positivo)
                                ctx.arc(cx, cy, arcRadius, 0, -rad, true);
                                ctx.lineTo(cx, cy);
                                ctx.fill();
                                ctx.stroke();
                            }
                        }

                        // 4. V√©rtice (Ponto A)
                        ctx.beginPath();
                        ctx.fillStyle = "#4B4B4B";
                        ctx.arc(cx, cy, 6, 0, Math.PI * 2);
                        ctx.fill();
                    };

                    // 4. LISTENERS

                    // Slider
                    slider.addEventListener("input", (e) => {
                        currentAngle = parseInt(e.target.value);
                        draw(currentAngle);
                    });

                    // Bot√µes
                    buttons.forEach((btn) => {
                        btn.onclick = () => {
                            const val = parseInt(btn.dataset.val);
                            currentAngle = val;
                            slider.value = val; // Sincroniza slider
                            draw(val);
                        };
                    });

                    // Inicializa
                    draw(45);
                },

                interactive_poly_types(container) {
                    // Estado
                    let state = {
                        isDragging: false,
                        // Coordenadas iniciais (Is√≥sceles)
                        A: { x: 50, y: 250 }, // Base Esq
                        B: { x: 250, y: 250 }, // Base Dir
                        C: { x: 150, y: 50 }, // Topo (M√≥vel)
                    };

                    // 1. Inje√ß√£o HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<div class="text-center mb-4">
<h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-1">Classifica√ß√£o de Tri√¢ngulos</h3>
<p class="text-sm text-gray-400">Arraste a bolinha roxa para transformar o tri√¢ngulo!</p>
</div>

<div class="relative w-[300px] h-[300px] bg-purple-50 rounded-xl border-2 border-purple-100 touch-none">
<svg id="poly-svg" class="w-full h-full overflow-visible" xmlns="http://www.w3.org/2000/svg">
<path id="triangle-path" d="" fill="rgba(155, 89, 182, 0.2)" stroke="#9B59B6" stroke-width="4" stroke-linejoin="round"/>

<g id="ticks-layer" stroke="#9B59B6" stroke-width="2"></g>

<circle cx="50" cy="250" r="4" fill="#9B59B6" />
<circle cx="250" cy="250" r="4" fill="#9B59B6" />

<circle id="vertex-c" cx="150" cy="50" r="12" fill="#9B59B6" class="cursor-grab hover:scale-125 transition-transform shadow-md" style="filter: drop-shadow(0px 2px 2px rgba(0,0,0,0.3));" />
<circle cx="150" cy="50" r="4" fill="white" class="pointer-events-none" id="vertex-c-dot" />
</svg>
</div>

<div class="mt-6 flex flex-col items-center gap-2 w-full">
<div id="type-badge" class="bg-brand-purple text-white px-6 py-2 rounded-full font-black text-xl md:text-2xl uppercase tracking-wider shadow-md transition-all">
Is√≥sceles
</div>
<div class="flex gap-4 text-xs font-mono text-gray-500 mt-2">
<span>Lado A: <b id="side-a">?</b></span>
<span>Lado B: <b id="side-b">?</b></span>
<span>Lado C: <b id="side-c">?</b></span>
</div>
</div>

<div class="flex gap-2 mt-6">
<button id="btn-equi" class="text-xs font-bold border-2 border-brand-purple text-brand-purple px-3 py-1 rounded hover:bg-purple-50 transition-colors">Equil√°tero</button>
<button id="btn-iso" class="text-xs font-bold border-2 border-brand-purple text-brand-purple px-3 py-1 rounded hover:bg-purple-50 transition-colors">Is√≥sceles</button>
<button id="btn-esc" class="text-xs font-bold border-2 border-brand-purple text-brand-purple px-3 py-1 rounded hover:bg-purple-50 transition-colors">Escaleno</button>
</div>
</div>
`;

                    // 2. Seletores
                    const svg = container.querySelector("#poly-svg");
                    const path = container.querySelector("#triangle-path");
                    const vertexC = container.querySelector("#vertex-c");
                    const vertexCDot = container.querySelector("#vertex-c-dot");
                    const ticksLayer = container.querySelector("#ticks-layer");
                    const badge = container.querySelector("#type-badge");

                    const sideADisplay = container.querySelector("#side-a");
                    const sideBDisplay = container.querySelector("#side-b");
                    const sideCDisplay = container.querySelector("#side-c");

                    // 3. Fun√ß√µes Matem√°ticas
                    const dist = (p1, p2) =>
                        Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));

                    // Desenha marca de congru√™ncia (tracinho) no meio da linha
                    const drawTick = (p1, p2, count) => {
                        const midX = (p1.x + p2.x) / 2;
                        const midY = (p1.y + p2.y) / 2;

                        // Vetor diretor da linha
                        const dx = p2.x - p1.x;
                        const dy = p2.y - p1.y;
                        const len = Math.sqrt(dx * dx + dy * dy);

                        // Vetor Normal (Perpendicular) unit√°rio
                        const nx = -dy / len;
                        const ny = dx / len;

                        const size = 6;
                        const gap = 4;
                        let svgStr = "";

                        // Desenha 'count' tracinhos
                        for (let i = 0; i < count; i++) {
                            // Offset para m√∫ltiplos tracinhos
                            const offset = (i - (count - 1) / 2) * gap;
                            // Move ao longo da linha
                            const startX = midX + (dx / len) * offset;
                            const startY = midY + (dy / len) * offset;

                            svgStr += `<line x1="${startX - nx * size}" y1="${startY - ny * size
                                }" x2="${startX + nx * size}" y2="${startY + ny * size}" />`;
                        }
                        return svgStr;
                    };

                    const update = () => {
                        // Atualiza visual do v√©rtice
                        vertexC.setAttribute("cx", state.C.x);
                        vertexC.setAttribute("cy", state.C.y);
                        vertexCDot.setAttribute("cx", state.C.x);
                        vertexCDot.setAttribute("cy", state.C.y);

                        // Desenha Tri√¢ngulo
                        const d = `M ${state.A.x} ${state.A.y} L ${state.B.x} ${state.B.y} L ${state.C.x} ${state.C.y} Z`;
                        path.setAttribute("d", d);

                        // Calcula Lados (Dist√¢ncias)
                        const sideC_len = dist(state.A, state.B); // Base (fixa)
                        const sideB_len = dist(state.A, state.C); // Esq
                        const sideA_len = dist(state.B, state.C); // Dir

                        // Toler√¢ncia para "igualdade" (facilitar para o usu√°rio acertar com o mouse)
                        const tolerance = 5;

                        // Classifica√ß√£o
                        let type = "Escaleno";
                        let colorClass = "bg-brand-red"; // Escaleno (Vermelho/Laranja)
                        let tickCount = { a: 0, b: 0, c: 0 };

                        // Verifica igualdade com toler√¢ncia
                        const ab_eq = Math.abs(sideA_len - sideB_len) < tolerance;
                        const bc_eq = Math.abs(sideB_len - sideC_len) < tolerance;
                        const ac_eq = Math.abs(sideA_len - sideC_len) < tolerance;

                        if (ab_eq && bc_eq) {
                            type = "Equil√°tero";
                            colorClass = "bg-brand-green";
                            tickCount = { a: 1, b: 1, c: 1 }; // Todos lados com 1 tra√ßo
                        } else if (ab_eq || bc_eq || ac_eq) {
                            type = "Is√≥sceles";
                            colorClass = "bg-brand-purple";

                            // Define onde desenhar os tra√ßos duplos
                            if (ab_eq) {
                                tickCount.a = 2;
                                tickCount.b = 2;
                            } else if (bc_eq) {
                                tickCount.b = 2;
                                tickCount.c = 2;
                            } else if (ac_eq) {
                                tickCount.a = 2;
                                tickCount.c = 2;
                            }
                        }

                        // Atualiza UI
                        badge.innerText = type;
                        badge.className = `${colorClass} text-white px-6 py-2 rounded-full font-black text-xl md:text-2xl uppercase tracking-wider shadow-md transition-all`;

                        // Exibe valores arredondados
                        sideADisplay.innerText = Math.round(sideA_len);
                        sideBDisplay.innerText = Math.round(sideB_len);
                        sideCDisplay.innerText = Math.round(sideC_len);

                        // Desenha Marcas (Tracinhos)
                        let ticksHTML = "";
                        if (tickCount.c > 0)
                            ticksHTML += drawTick(state.A, state.B, tickCount.c); // Base
                        if (tickCount.b > 0)
                            ticksHTML += drawTick(state.A, state.C, tickCount.b); // Esq
                        if (tickCount.a > 0)
                            ticksHTML += drawTick(state.B, state.C, tickCount.a); // Dir
                        ticksLayer.innerHTML = ticksHTML;
                    };

                    // 4. Intera√ß√£o (Mouse/Touch)
                    const getSVGPos = (evt) => {
                        const pt = svg.createSVGPoint();
                        // Trata Touch vs Mouse
                        pt.x = evt.clientX || evt.touches[0].clientX;
                        pt.y = evt.clientY || evt.touches[0].clientY;
                        return pt.matrixTransform(svg.getScreenCTM().inverse());
                    };

                    const onMove = (e) => {
                        if (!state.isDragging) return;
                        // e.preventDefault(); // Evita scroll em mobile enquanto arrasta
                        const pos = getSVGPos(e);

                        // Limita a √°rea de desenho para n√£o sair do box
                        state.C.x = Math.max(10, Math.min(290, pos.x));
                        state.C.y = Math.max(10, Math.min(240, pos.y)); // N√£o deixa descer muito perto da base
                        update();
                    };

                    const onStart = (e) => {
                        state.isDragging = true;
                        vertexC.classList.add("cursor-grabbing");
                    };
                    const onEnd = (e) => {
                        state.isDragging = false;
                        vertexC.classList.remove("cursor-grabbing");
                    };

                    vertexC.addEventListener("mousedown", onStart);
                    vertexC.addEventListener("touchstart", onStart);

                    window.addEventListener("mousemove", onMove);
                    window.addEventListener("touchmove", onMove, { passive: false });

                    window.addEventListener("mouseup", onEnd);
                    window.addEventListener("touchend", onEnd);

                    // 5. Bot√µes de Atalho
                    const setShape = (cx, cy) => {
                        state.C = { x: cx, y: cy };
                        update();
                    };

                    // Posi√ß√µes pr√©-calculadas para garantir classifica√ß√£o exata
                    // Base est√° em Y=250, comprimento 200. Centro X=150.
                    // Altura Equil√°tero = 200 * (sqrt(3)/2) approx 173.2. Y = 250 - 173.2 = 76.8
                    container.querySelector("#btn-equi").onclick = () =>
                        setShape(150, 76.8);
                    container.querySelector("#btn-iso").onclick = () =>
                        setShape(150, 20); // Bem alto
                    container.querySelector("#btn-esc").onclick = () =>
                        setShape(50, 50); // Jogado para a esquerda

                    // Inicializa
                    update();
                },

                interactive_multiples_game(container) {
                    // Configura√ß√£o
                    const targets = [2, 3, 4, 5, 6, 10];
                    let currentTarget = 2;
                    let score = 0;
                    let gridNumbers = [];

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full items-center mb-4 border-b-2 border-gray-100 pb-2">
<h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest"><i class="fas fa-gamepad"></i> Ca√ßa-M√∫ltiplos</h3>
<div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black shadow-sm">Pontos: <span id="game-score">0</span></div>
</div>

<div class="text-center mb-6">
<p class="text-gray-400 text-xs font-bold uppercase mb-1">Miss√£o:</p>
<h2 class="text-2xl md:text-3xl font-black text-brand-text">Encontre os m√∫ltiplos de <span id="target-num" class="text-brand-blue text-4xl">2</span></h2>
</div>

<div id="game-grid" class="grid grid-cols-4 gap-3 w-full max-w-sm mb-6">
</div>

<button id="btn-next-level" class="w-full bg-brand-blue hover:bg-blue-600 text-white font-bold py-3 rounded-xl shadow-btn active:translate-y-1 active:shadow-none transition-all hidden">
Pr√≥ximo N√≠vel <i class="fas fa-arrow-right ml-2"></i>
</button>

<div id="feedback-msg" class="h-6 text-sm font-bold text-center"></div>

</div>
`;

                    // 2. Seletores
                    const targetEl = container.querySelector("#target-num");
                    const gridEl = container.querySelector("#game-grid");
                    const scoreEl = container.querySelector("#game-score");
                    const btnNext = container.querySelector("#btn-next-level");
                    const msgEl = container.querySelector("#feedback-msg");

                    // 3. L√≥gica do Jogo
                    const startLevel = () => {
                        // Escolhe um alvo aleat√≥rio
                        currentTarget =
                            targets[Math.floor(Math.random() * targets.length)];
                        targetEl.innerText = currentTarget;

                        // Gera n√∫meros (metade m√∫ltiplos, metade intrusos)
                        gridNumbers = [];
                        const correctCount = 6;
                        const wrongCount = 6; // Total 12 slots (4x3)

                        // Gera Corretos (M√∫ltiplos)
                        for (let i = 0; i < correctCount; i++) {
                            gridNumbers.push({
                                val: currentTarget * (Math.floor(Math.random() * 10) + 1),
                                isCorrect: true,
                            });
                        }

                        // Gera Errados (N√£o M√∫ltiplos)
                        for (let i = 0; i < wrongCount; i++) {
                            let wrong;
                            do {
                                wrong = Math.floor(Math.random() * 50) + 1;
                            } while (wrong % currentTarget === 0); // Garante que n√£o √© m√∫ltiplo
                            gridNumbers.push({ val: wrong, isCorrect: false });
                        }

                        // Embaralha
                        gridNumbers.sort(() => Math.random() - 0.5);

                        renderGrid();
                        btnNext.classList.add("hidden");
                        msgEl.innerText = "";
                        msgEl.className = "h-6 text-sm font-bold text-center";
                    };

                    const renderGrid = () => {
                        gridEl.innerHTML = "";
                        let remainingCorrect = gridNumbers.filter(
                            (n) => n.isCorrect && !n.found
                        ).length;

                        if (remainingCorrect === 0) {
                            levelComplete();
                            return;
                        }

                        gridNumbers.forEach((item, idx) => {
                            const btn = document.createElement("button");

                            // Estilos base
                            let classes =
                                "h-16 rounded-xl font-bold text-xl shadow-sm transition-all transform active:scale-95 flex items-center justify-center border-b-4 ";

                            if (item.found) {
                                // J√° clicado
                                if (item.isCorrect) {
                                    classes +=
                                        "bg-green-100 text-green-400 border-green-200 cursor-default";
                                    btn.innerHTML = '<i class="fas fa-check"></i>';
                                } else {
                                    classes +=
                                        "bg-red-100 text-red-400 border-red-200 cursor-default opacity-50";
                                    btn.innerText = item.val;
                                }
                            } else {
                                // Ainda n√£o clicado (Jog√°vel)
                                classes +=
                                    "bg-white text-gray-600 border-gray-200 hover:bg-gray-50 hover:border-gray-300";
                                btn.innerText = item.val;

                                btn.onclick = () => handleClick(idx);
                            }

                            btn.className = classes;
                            gridEl.appendChild(btn);
                        });
                    };

                    const handleClick = (idx) => {
                        const item = gridNumbers[idx];
                        if (item.found) return;

                        item.found = true;

                        if (item.isCorrect) {
                            score += 10;
                            // Feedback Positivo Sonoro/Visual (Simulado)
                        } else {
                            score = Math.max(0, score - 5);
                            msgEl.innerText = `Ops! ${item.val} n√£o divide por ${currentTarget}.`;
                            msgEl.className =
                                "h-6 text-sm font-bold text-center text-brand-red animate-pulse";
                            setTimeout(() => (msgEl.innerText = ""), 1500);
                        }

                        scoreEl.innerText = score;
                        renderGrid();
                    };

                    const levelComplete = () => {
                        gridEl.innerHTML = `
<div class="col-span-4 flex flex-col items-center justify-center py-4 animate-pop-in">
<div class="text-5xl mb-2">üéâ</div>
<h3 class="text-xl font-black text-brand-green">N√≠vel Completo!</h3>
<p class="text-gray-400 text-sm">Voc√™ encontrou todos os m√∫ltiplos.</p>
</div>
`;
                        btnNext.classList.remove("hidden");
                    };

                    // Listeners
                    btnNext.onclick = startLevel;

                    // Init
                    startLevel();
                },

                interactive_multiples_game(container) {
                    // Configura√ß√£o
                    const targets = [2, 3, 4, 5, 6, 10];
                    let currentTarget = 2;
                    let score = 0;
                    let gridNumbers = [];

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full items-center mb-4 border-b-2 border-gray-100 pb-2">
<h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest"><i class="fas fa-gamepad"></i> Ca√ßa-M√∫ltiplos</h3>
<div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black shadow-sm">Pontos: <span id="game-score">0</span></div>
</div>

<div class="text-center mb-6">
<p class="text-gray-400 text-xs font-bold uppercase mb-1">Miss√£o:</p>
<h2 class="text-2xl md:text-3xl font-black text-brand-text">Encontre os m√∫ltiplos de <span id="target-num" class="text-brand-blue text-4xl">2</span></h2>
</div>

<div id="game-grid" class="grid grid-cols-4 gap-3 w-full max-w-sm mb-6">
</div>

<button id="btn-next-level" class="w-full bg-brand-blue hover:bg-blue-600 text-white font-bold py-3 rounded-xl shadow-btn active:translate-y-1 active:shadow-none transition-all hidden">
Pr√≥ximo N√≠vel <i class="fas fa-arrow-right ml-2"></i>
</button>

<div id="feedback-msg" class="h-6 text-sm font-bold text-center"></div>

</div>
`;

                    // 2. Seletores
                    const targetEl = container.querySelector("#target-num");
                    const gridEl = container.querySelector("#game-grid");
                    const scoreEl = container.querySelector("#game-score");
                    const btnNext = container.querySelector("#btn-next-level");
                    const msgEl = container.querySelector("#feedback-msg");

                    // 3. L√≥gica do Jogo
                    const startLevel = () => {
                        // Escolhe um alvo aleat√≥rio
                        currentTarget =
                            targets[Math.floor(Math.random() * targets.length)];
                        targetEl.innerText = currentTarget;

                        // Gera n√∫meros (metade m√∫ltiplos, metade intrusos)
                        gridNumbers = [];
                        const correctCount = 6;
                        const wrongCount = 6; // Total 12 slots (4x3)

                        // Gera Corretos (M√∫ltiplos)
                        for (let i = 0; i < correctCount; i++) {
                            gridNumbers.push({
                                val: currentTarget * (Math.floor(Math.random() * 10) + 1),
                                isCorrect: true,
                            });
                        }

                        // Gera Errados (N√£o M√∫ltiplos)
                        for (let i = 0; i < wrongCount; i++) {
                            let wrong;
                            do {
                                wrong = Math.floor(Math.random() * 50) + 1;
                            } while (wrong % currentTarget === 0); // Garante que n√£o √© m√∫ltiplo
                            gridNumbers.push({ val: wrong, isCorrect: false });
                        }

                        // Embaralha
                        gridNumbers.sort(() => Math.random() - 0.5);

                        renderGrid();
                        btnNext.classList.add("hidden");
                        msgEl.innerText = "";
                        msgEl.className = "h-6 text-sm font-bold text-center";
                    };

                    const renderGrid = () => {
                        gridEl.innerHTML = "";
                        let remainingCorrect = gridNumbers.filter(
                            (n) => n.isCorrect && !n.found
                        ).length;

                        if (remainingCorrect === 0) {
                            levelComplete();
                            return;
                        }

                        gridNumbers.forEach((item, idx) => {
                            const btn = document.createElement("button");

                            // Estilos base
                            let classes =
                                "h-16 rounded-xl font-bold text-xl shadow-sm transition-all transform active:scale-95 flex items-center justify-center border-b-4 ";

                            if (item.found) {
                                // J√° clicado
                                if (item.isCorrect) {
                                    classes +=
                                        "bg-green-100 text-green-400 border-green-200 cursor-default";
                                    btn.innerHTML = '<i class="fas fa-check"></i>';
                                } else {
                                    classes +=
                                        "bg-red-100 text-red-400 border-red-200 cursor-default opacity-50";
                                    btn.innerText = item.val;
                                }
                            } else {
                                // Ainda n√£o clicado (Jog√°vel)
                                classes +=
                                    "bg-white text-gray-600 border-gray-200 hover:bg-gray-50 hover:border-gray-300";
                                btn.innerText = item.val;

                                btn.onclick = () => handleClick(idx);
                            }

                            btn.className = classes;
                            gridEl.appendChild(btn);
                        });
                    };

                    const handleClick = (idx) => {
                        const item = gridNumbers[idx];
                        if (item.found) return;

                        item.found = true;

                        if (item.isCorrect) {
                            score += 10;
                            // Feedback Positivo Sonoro/Visual (Simulado)
                        } else {
                            score = Math.max(0, score - 5);
                            msgEl.innerText = `Ops! ${item.val} n√£o divide por ${currentTarget}.`;
                            msgEl.className =
                                "h-6 text-sm font-bold text-center text-brand-red animate-pulse";
                            setTimeout(() => (msgEl.innerText = ""), 1500);
                        }

                        scoreEl.innerText = score;
                        renderGrid();
                    };

                    const levelComplete = () => {
                        gridEl.innerHTML = `
<div class="col-span-4 flex flex-col items-center justify-center py-4 animate-pop-in">
<div class="text-5xl mb-2">üéâ</div>
<h3 class="text-xl font-black text-brand-green">N√≠vel Completo!</h3>
<p class="text-gray-400 text-sm">Voc√™ encontrou todos os m√∫ltiplos.</p>
</div>
`;
                        btnNext.classList.remove("hidden");
                    };

                    // Listeners
                    btnNext.onclick = startLevel;

                    // Init
                    startLevel();
                },

                interactive_solids_viewer(container) {
                    // Banco de Dados dos S√≥lidos (GEOMETRIA CORRIGIDA)
                    const solids = {
                        cube: {
                            name: "Cubo (Hexaedro)",
                            type: "poly",
                            stats: { f: 6, v: 8, e: 12 },
                            color: "text-brand-blue",
                            svg3d: `<path d="M20 20 L80 20 L80 80 L20 80 Z" fill="none" stroke="currentColor" stroke-width="2"/><path d="M20 20 L40 5 L100 5 L80 20" fill="none" stroke="currentColor" stroke-width="2"/><path d="M80 80 L100 65 L100 5" fill="none" stroke="currentColor" stroke-width="2"/><path d="M20 80 L40 65 L40 5" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="4,2" class="opacity-50"/><path d="M40 65 L100 65" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="4,2" class="opacity-50"/>`,
                            svg2d: `<rect x="40" y="40" width="20" height="20" fill="currentColor" fill-opacity="0.2" stroke="currentColor"/><rect x="40" y="20" width="20" height="20" fill="currentColor" fill-opacity="0.2" stroke="currentColor"/><rect x="40" y="60" width="20" height="20" fill="currentColor" fill-opacity="0.2" stroke="currentColor"/><rect x="40" y="80" width="20" height="20" fill="currentColor" fill-opacity="0.2" stroke="currentColor"/><rect x="20" y="40" width="20" height="20" fill="currentColor" fill-opacity="0.2" stroke="currentColor"/><rect x="60" y="40" width="20" height="20" fill="currentColor" fill-opacity="0.2" stroke="currentColor"/>`,
                        },
                        pyramid: {
                            name: "Pir√¢mide Triangular",
                            type: "poly",
                            stats: { f: 4, v: 4, e: 6 },
                            color: "text-brand-purple",
                            svg3d: `
<path d="M20 70 L80 70 L50 20 Z" fill="none" stroke="currentColor" stroke-width="2"/>
<path d="M20 70 L50 50 L80 70" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="4,2" class="opacity-50"/>
<path d="M50 50 L50 20" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="4,2" class="opacity-50"/>
`,
                            svg2d: `
<g transform="translate(0, 5)">
<polygon points="35,35 65,35 50,61" fill="currentColor" fill-opacity="0.2" stroke="currentColor"/>
<polygon points="35,35 65,35 50,9" fill="currentColor" fill-opacity="0.2" stroke="currentColor"/>
<polygon points="35,35 50,61 20,61" fill="currentColor" fill-opacity="0.2" stroke="currentColor"/>
<polygon points="65,35 50,61 80,61" fill="currentColor" fill-opacity="0.2" stroke="currentColor"/>
</g>
`,
                        },
                        cylinder: {
                            name: "Cilindro",
                            type: "round",
                            stats: { desc: "N√£o tem v√©rtices" },
                            color: "text-brand-orange",
                            svg3d: `<ellipse cx="50" cy="20" rx="30" ry="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M20 20 L20 80" stroke="currentColor" stroke-width="2"/><path d="M80 20 L80 80" stroke="currentColor" stroke-width="2"/><ellipse cx="50" cy="80" rx="30" ry="10" fill="none" stroke="currentColor" stroke-width="2"/>`,
                            svg2d: `
<rect x="20" y="30" width="60" height="40" fill="currentColor" fill-opacity="0.2" stroke="currentColor"/>
<circle cx="50" cy="19.5" r="10" fill="currentColor" fill-opacity="0.2" stroke="currentColor"/>
<circle cx="50" cy="80.5" r="10" fill="currentColor" fill-opacity="0.2" stroke="currentColor"/>
`,
                        },
                        cone: {
                            name: "Cone",
                            type: "round",
                            stats: { desc: "1 V√©rtice (√Åpice)" },
                            color: "text-brand-green",
                            svg3d: `
<ellipse cx="50" cy="80" rx="30" ry="10" fill="none" stroke="currentColor" stroke-width="2"/>
<path d="M20 80 L50 10 L80 80" stroke="currentColor" stroke-width="2" fill="none"/>
`,
                            svg2d: `
<g transform="translate(0, -5)">
<path d="M 50 10 L 92.4 52.4 A 60 60 0 0 1 7.6 52.4 Z" fill="currentColor" fill-opacity="0.2" stroke="currentColor" />
<circle cx="50" cy="85" r="15" fill="currentColor" fill-opacity="0.2" stroke="currentColor"/>
</g>
`,
                        },
                        sphere: {
                            name: "Esfera",
                            type: "round",
                            stats: { desc: "Sem faces planas" },
                            color: "text-brand-red",
                            svg3d: `<circle cx="50" cy="50" r="35" fill="none" stroke="currentColor" stroke-width="2"/><ellipse cx="50" cy="50" rx="35" ry="10" fill="none" stroke="currentColor" stroke-width="1" stroke-dasharray="4,2"/>`,
                            svg2d: `<text x="50" y="55" text-anchor="middle" font-size="10" fill="currentColor" font-weight="bold">N√£o planific√°vel</text><circle cx="50" cy="50" r="35" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="4,2" opacity="0.3"/>`,
                        },
                    };

                    let currentSolid = "cube";
                    let isFlat = false;

                    // 1. HTML
                    // AQUI EST√Å A MUDAN√áA: min-h-[350px] no container do meio
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col md:flex-row gap-6 w-full shadow-sm font-sans">

<div class="flex flex-row md:flex-col gap-2 overflow-x-auto md:w-1/4 pb-2 md:pb-0 no-scrollbar">
<button data-id="cube" class="solid-btn bg-blue-50 text-brand-blue p-3 rounded-xl border-2 border-brand-blue flex items-center justify-center gap-2 hover:bg-blue-100 transition-all">
<i class="fas fa-cube"></i> <span class="hidden md:inline text-xs font-bold">Cubo</span>
</button>
<button data-id="pyramid" class="solid-btn bg-white text-gray-500 p-3 rounded-xl border-2 border-transparent flex items-center justify-center gap-2 hover:bg-gray-100 transition-all">
<i class="fas fa-caret-up"></i> <span class="hidden md:inline text-xs font-bold">Pir√¢mide</span>
</button>
<button data-id="cylinder" class="solid-btn bg-white text-gray-500 p-3 rounded-xl border-2 border-transparent flex items-center justify-center gap-2 hover:bg-gray-100 transition-all">
<i class="fas fa-database"></i> <span class="hidden md:inline text-xs font-bold">Cilindro</span>
</button>
<button data-id="cone" class="solid-btn bg-white text-gray-500 p-3 rounded-xl border-2 border-transparent flex items-center justify-center gap-2 hover:bg-gray-100 transition-all">
<i class="fas fa-filter"></i> <span class="hidden md:inline text-xs font-bold">Cone</span>
</button>
<button data-id="sphere" class="solid-btn bg-white text-gray-500 p-3 rounded-xl border-2 border-transparent flex items-center justify-center gap-2 hover:bg-gray-100 transition-all">
<i class="fas fa-globe"></i> <span class="hidden md:inline text-xs font-bold">Esfera</span>
</button>
</div>

<div class="flex-1 flex flex-col items-center justify-center bg-gray-50 rounded-xl border-2 border-gray-100 p-6 relative min-h-[350px]">

<div id="type-badge" class="absolute top-4 left-4 text-[10px] font-black uppercase tracking-wider bg-brand-blue text-white px-2 py-1 rounded shadow-sm">
Poliedro
</div>

<div id="svg-container" class="w-64 h-64 transition-all duration-500 text-brand-blue">
</div>

<button id="btn-toggle-view" class="absolute bottom-4 right-4 text-xs font-bold text-gray-400 bg-white px-3 py-1 rounded border border-gray-200 hover:text-brand-blue hover:border-brand-blue transition-colors flex items-center gap-2 shadow-sm">
<i class="fas fa-expand-arrows-alt"></i> <span>Planificar</span>
</button>
</div>

<div class="md:w-1/3 flex flex-col gap-4">
<h3 id="solid-name" class="text-xl font-black text-brand-text leading-tight">Cubo</h3>

<div id="stats-container" class="space-y-2">
</div>

<div id="poly-tip" class="bg-blue-50 p-3 rounded-lg border-l-4 border-brand-blue text-xs text-brand-text hidden">
<strong>Rela√ß√£o de Euler:</strong><br>
V + F = A + 2<br>
<span id="euler-calc" class="font-mono mt-1 block">8 + 6 = 12 + 2</span>
</div>
 <div id="round-tip" class="bg-orange-50 p-3 rounded-lg border-l-4 border-brand-orange text-xs text-brand-text hidden">
<strong>Corpo Redondo:</strong><br>
Possui superf√≠cies curvas e pode rolar se colocado numa rampa.
</div>
</div>
</div>
`;

                    // 2. Seletores
                    const svgContainer = container.querySelector("#svg-container");
                    const solidName = container.querySelector("#solid-name");
                    const typeBadge = container.querySelector("#type-badge");
                    const statsContainer = container.querySelector("#stats-container");
                    const polyTip = container.querySelector("#poly-tip");
                    const roundTip = container.querySelector("#round-tip");
                    const eulerCalc = container.querySelector("#euler-calc");
                    const btnToggle = container.querySelector("#btn-toggle-view");
                    const buttons = container.querySelectorAll(".solid-btn");

                    // 3. Atualiza√ß√£o
                    const update = () => {
                        const s = solids[currentSolid];
                        const isPoly = s.type === "poly";

                        // SVG
                        // Aumentei o container do SVG via classe CSS no HTML acima (w-64 h-64)
                        svgContainer.className = `w-64 h-64 transition-all duration-500 ${s.color}`;
                        svgContainer.innerHTML = `<svg viewBox="0 0 100 100" class="w-full h-full drop-shadow-lg animate-fade-in">${isFlat ? s.svg2d : s.svg3d
                            }</svg>`;

                        // Textos
                        solidName.innerText = s.name;
                        typeBadge.innerText = isPoly ? "Poliedro" : "Corpo Redondo";
                        typeBadge.className = `absolute top-4 left-4 text-[10px] font-black uppercase tracking-wider px-2 py-1 rounded shadow-sm text-white ${isPoly ? "bg-brand-blue" : "bg-brand-orange"
                            }`;

                        // Bot√£o Planificar
                        btnToggle.innerHTML = isFlat
                            ? `<i class="fas fa-box"></i> <span>Montar</span>`
                            : `<i class="fas fa-expand-arrows-alt"></i> <span>Planificar</span>`;
                        if (currentSolid === "sphere") btnToggle.style.display = "none";
                        else btnToggle.style.display = "flex";

                        // Stats
                        let statsHTML = "";
                        if (isPoly) {
                            statsHTML += `<div class="flex justify-between border-b border-gray-100 py-1"><span class="text-gray-400 font-bold text-xs uppercase">Faces</span><span class="font-bold">${s.stats.f}</span></div>`;
                            statsHTML += `<div class="flex justify-between border-b border-gray-100 py-1"><span class="text-gray-400 font-bold text-xs uppercase">V√©rtices</span><span class="font-bold">${s.stats.v}</span></div>`;
                            statsHTML += `<div class="flex justify-between border-b border-gray-100 py-1"><span class="text-gray-400 font-bold text-xs uppercase">Arestas</span><span class="font-bold">${s.stats.e}</span></div>`;

                            polyTip.classList.remove("hidden");
                            roundTip.classList.add("hidden");
                            eulerCalc.innerText = `${s.stats.v} + ${s.stats.f} = ${s.stats.e} + 2`;
                        } else {
                            statsHTML += `<div class="text-sm text-gray-500 italic">${s.stats.desc}</div>`;
                            polyTip.classList.add("hidden");
                            roundTip.classList.remove("hidden");
                        }
                        statsContainer.innerHTML = statsHTML;

                        // Atualiza Menu Ativo
                        buttons.forEach((btn) => {
                            const active = btn.dataset.id === currentSolid;
                            if (active) {
                                btn.className = `solid-btn ${s.color
                                    .replace("text-", "bg-")
                                    .replace("blue", "blue-50")
                                    .replace("orange", "orange-50")
                                    .replace("purple", "purple-50")
                                    .replace("green", "green-50")
                                    .replace("red", "red-50")} ${s.color
                                    } p-3 rounded-xl border-2 ${s.color.replace(
                                        "text-",
                                        "border-"
                                    )} flex items-center justify-center gap-2 transition-all shadow-sm`;
                            } else {
                                btn.className =
                                    "solid-btn bg-white text-gray-400 p-3 rounded-xl border-2 border-transparent flex items-center justify-center gap-2 hover:bg-gray-50 transition-all";
                            }
                        });
                    };

                    // 4. Listeners
                    buttons.forEach((btn) => {
                        btn.onclick = () => {
                            currentSolid = btn.dataset.id;
                            isFlat = false;
                            update();
                        };
                    });

                    btnToggle.onclick = () => {
                        isFlat = !isFlat;
                        update();
                    };

                    // Init
                    update();
                },

                interactive_unit_converter(container) {
                    // Estado
                    let state = {
                        type: "m", // m (comprimento), g (massa), l (capacidade)
                        value: 1,
                        from: 3, // √çndice inicial (0=k, 3=base, 6=m)
                        to: 5, // √çndice final
                    };

                    // Configura√ß√£o das Unidades
                    const unitsData = {
                        m: {
                            name: "Comprimento",
                            color: "text-brand-blue",
                            border: "border-brand-blue",
                            bg: "bg-blue-50",
                            base: "m",
                        },
                        g: {
                            name: "Massa",
                            color: "text-brand-orange",
                            border: "border-brand-orange",
                            bg: "bg-orange-50",
                            base: "g",
                        },
                        l: {
                            name: "Capacidade",
                            color: "text-brand-green",
                            border: "border-brand-green",
                            bg: "bg-green-50",
                            base: "L",
                        },
                    };

                    const prefixes = [
                        { p: "k", n: "Quilo" },
                        { p: "h", n: "Hecto" },
                        { p: "da", n: "Deca" },
                        { p: "", n: "Base" },
                        { p: "d", n: "Deci" },
                        { p: "c", n: "Centi" },
                        { p: "m", n: "Mili" },
                    ];

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<div class="flex bg-gray-100 p-1 rounded-lg mb-6 gap-1 w-full max-w-sm">
<button data-type="m" class="type-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all shadow-sm bg-white text-brand-blue">Metros</button>
<button data-type="g" class="type-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all text-gray-400 hover:bg-white">Gramas</button>
<button data-type="l" class="type-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all text-gray-400 hover:bg-white">Litros</button>
</div>

<div class="flex flex-col md:flex-row items-center gap-4 mb-8 w-full justify-center">

<div class="flex flex-col items-center">
<label class="text-[10px] font-bold text-gray-400 uppercase">Valor</label>
<input type="number" id="val-input" value="1" class="w-24 text-center border-b-2 border-brand-gray focus:border-brand-blue outline-none text-2xl font-bold bg-transparent text-brand-text">
</div>

<div class="flex flex-col items-center">
<label class="text-[10px] font-bold text-gray-400 uppercase">De</label>
<select id="sel-from" class="bg-gray-50 border border-gray-200 text-brand-text text-sm rounded-lg focus:ring-brand-blue focus:border-brand-blue block p-2.5 font-bold cursor-pointer outline-none">
</select>
</div>

<i class="fas fa-arrow-right text-gray-300 mx-2"></i>

<div class="flex flex-col items-center">
<label class="text-[10px] font-bold text-gray-400 uppercase">Para</label>
<select id="sel-to" class="bg-gray-50 border border-gray-200 text-brand-text text-sm rounded-lg focus:ring-brand-blue focus:border-brand-blue block p-2.5 font-bold cursor-pointer outline-none">
</select>
</div>
</div>

<div class="w-full overflow-x-auto pb-4 mb-4">
<div class="flex justify-between items-center min-w-[320px] px-4 relative h-20" id="ruler-container">
<div class="absolute top-1/2 left-4 right-4 h-1 bg-gray-200 -z-10 rounded"></div>
<div id="jump-path" class="absolute top-1/2 h-1 bg-brand-blue -z-0 transition-all duration-500 rounded opacity-50"></div>

</div>
</div>

<div class="w-full bg-gray-50 rounded-xl border border-gray-200 p-4 flex flex-col items-center text-center transition-colors duration-300" id="res-box">
<div class="text-xs font-bold text-gray-400 uppercase mb-1">Resultado</div>
<div class="text-4xl font-mono font-bold text-brand-text mb-2 break-all" id="res-val">100</div>

<div class="text-sm font-medium text-gray-600 bg-white px-3 py-1 rounded-full border border-gray-100 shadow-sm">
<span id="logic-steps">2 pulos para a direita</span> 
<span class="text-brand-blue font-bold mx-1">‚Üí</span> 
<span id="logic-math">√ó 100</span>
</div>
</div>

</div>
`;

                    // 2. Seletores
                    const typeBtns = container.querySelectorAll(".type-btn");
                    const valInput = container.querySelector("#val-input");
                    const selFrom = container.querySelector("#sel-from");
                    const selTo = container.querySelector("#sel-to");
                    const ruler = container.querySelector("#ruler-container");
                    const jumpPath = container.querySelector("#jump-path");
                    const resVal = container.querySelector("#res-val");
                    const resBox = container.querySelector("#res-box");
                    const logicSteps = container.querySelector("#logic-steps");
                    const logicMath = container.querySelector("#logic-math");

                    // 3. Fun√ß√µes Auxiliares
                    const getUnitList = () =>
                        prefixes.map((p, i) => ({
                            val: i,
                            label: `${p.p}${unitsData[state.type].base}`,
                            desc: `${p.n}${unitsData[state.type].name
                                .toLowerCase()
                                .slice(0, 5)}`, // Ex: Quilometro
                        }));

                    const renderOptions = () => {
                        const list = getUnitList();
                        const opts = list
                            .map((u) => `<option value="${u.val}">${u.label}</option>`)
                            .join("");
                        selFrom.innerHTML = opts;
                        selTo.innerHTML = opts;
                        selFrom.value = state.from;
                        selTo.value = state.to;
                    };

                    const renderRuler = () => {
                        // Limpa apenas os itens (mant√©m as linhas de fundo)
                        const existingItems = ruler.querySelectorAll(".unit-item");
                        existingItems.forEach((e) => e.remove());

                        const list = getUnitList();
                        const currentStyle = unitsData[state.type];

                        list.forEach((u) => {
                            const el = document.createElement("div");
                            el.className =
                                "unit-item flex flex-col items-center gap-1 cursor-pointer transition-transform hover:scale-110 z-10";
                            el.dataset.idx = u.val;

                            // Bolinha
                            const circle = document.createElement("div");
                            circle.className = `w-4 h-4 rounded-full border-2 bg-white transition-colors duration-300 ${u.val === state.from || u.val === state.to
                                ? currentStyle.border + " " + currentStyle.bg
                                : "border-gray-300"
                                }`;

                            // Texto
                            const label = document.createElement("span");
                            label.className = `text-xs font-bold ${u.val === state.from || u.val === state.to
                                ? currentStyle.color
                                : "text-gray-400"
                                }`;
                            label.innerText = u.label;

                            el.appendChild(circle);
                            el.appendChild(label);

                            // Clique r√°pido na r√©gua
                            el.onclick = () => {
                                // L√≥gica simples: clica no destino
                                state.to = u.val;
                                selTo.value = u.val;
                                update();
                            };

                            ruler.appendChild(el);
                        });
                    };

                    const update = () => {
                        // Atualiza inputs
                        state.value = parseFloat(valInput.value) || 0;
                        state.from = parseInt(selFrom.value);
                        state.to = parseInt(selTo.value);

                        // C√°lculos
                        const diff = state.to - state.from; // Positivo = Direita, Negativo = Esquerda
                        const steps = Math.abs(diff);
                        const factor = Math.pow(10, steps);

                        // Resultado (Evita erros de ponto flutuante tipo 0.300004)
                        let result;
                        if (diff > 0) result = state.value * factor;
                        else result = state.value / factor;

                        // Limpeza de float
                        result = parseFloat(result.toPrecision(12));

                        // Atualiza UI Texto
                        resVal.innerText = result.toString().replace(".", ","); // Padr√£o BR

                        const currentData = unitsData[state.type];
                        resVal.className = `text-4xl font-mono font-bold mb-2 break-all ${currentData.color}`;
                        resBox.className = `w-full rounded-xl border p-4 flex flex-col items-center text-center transition-colors duration-300 ${currentData.bg
                            } ${currentData.border.replace("border-", "border-opacity-30 ")}`;

                        // Texto L√≥gico
                        if (diff === 0) {
                            logicSteps.innerText = "Mesma unidade";
                            logicMath.innerText = "√ó 1";
                        } else {
                            const direction = diff > 0 ? "direita" : "esquerda";
                            const op = diff > 0 ? "√ó" : "√∑";
                            // Pluraliza√ß√£o
                            const stepText = steps === 1 ? "pulo" : "pulos";
                            logicSteps.innerText = `${steps} ${stepText} para a ${direction}`;
                            logicMath.innerText = `${op} ${factor}`;
                        }

                        // Atualiza R√©gua Visual
                        renderRuler(); // Re-renderiza para atualizar cores

                        // Anima√ß√£o da Linha de Salto
                        // Precisamos das posi√ß√µes dos elementos
                        const items = ruler.querySelectorAll(".unit-item");
                        if (items[state.from] && items[state.to]) {
                            const startEl = items[Math.min(state.from, state.to)];
                            const endEl = items[Math.max(state.from, state.to)];

                            // Posi√ß√£o relativa ao container
                            const startX = startEl.offsetLeft + startEl.offsetWidth / 2;
                            const endX = endEl.offsetLeft + endEl.offsetWidth / 2;
                            const width = endX - startX;

                            jumpPath.style.left = `${startX}px`;
                            jumpPath.style.width = `${width}px`;
                            jumpPath.className = `absolute top-1/2 h-1 -z-0 transition-all duration-500 rounded opacity-50 ${currentData.bg.replace(
                                "bg-",
                                "bg-brand-"
                            )}`; // Gambiarra de cor, ideal usar cor direta

                            // Ajuste de cor manual para a barra
                            if (state.type === "m")
                                jumpPath.style.backgroundColor = "#1CB0F6";
                            if (state.type === "g")
                                jumpPath.style.backgroundColor = "#FF9600";
                            if (state.type === "l")
                                jumpPath.style.backgroundColor = "#58CC02";
                        }
                    };

                    // 4. Listeners

                    // Troca de Tipo (Abas)
                    typeBtns.forEach((btn) => {
                        btn.onclick = () => {
                            state.type = btn.dataset.type;

                            // Atualiza estilo das abas
                            typeBtns.forEach((b) => {
                                const active = b.dataset.type === state.type;
                                const style = unitsData[state.type];
                                if (active) {
                                    b.className = `type-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all shadow-sm bg-white ${style.color}`;
                                } else {
                                    b.className = `type-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all text-gray-400 hover:bg-white`;
                                }
                            });

                            renderOptions();
                            renderRuler();
                            update();
                        };
                    });

                    valInput.addEventListener("input", update);
                    selFrom.addEventListener("change", update);
                    selTo.addEventListener("change", update);

                    // Inicializa
                    renderOptions();
                    renderRuler();
                    update();
                },

                interactive_clock_math(container) {
                    // Estado inicial
                    let state = {
                        h: 2,
                        m: 30,
                    };

                    // 1. INJE√á√ÉO DO HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col md:flex-row items-center justify-center gap-8 w-full shadow-sm font-sans select-none">

<div class="relative w-48 h-48 md:w-56 md:h-56 shrink-0 bg-white rounded-full border-4 border-gray-200 shadow-inner flex items-center justify-center">

<svg class="absolute inset-0 w-full h-full text-gray-300" viewBox="0 0 100 100">
${[...Array(12)]
                            .map((_, i) => {
                                const deg = i * 30;
                                return `<line x1="50" y1="10" x2="50" y2="15" stroke="currentColor" stroke-width="2" transform="rotate(${deg} 50 50)" />`;
                            })
                            .join("")}
</svg>

<div class="absolute top-2 text-xs font-bold text-gray-400">12</div>
<div class="absolute bottom-2 text-xs font-bold text-gray-400">6</div>
<div class="absolute left-2 text-xs font-bold text-gray-400">9</div>
<div class="absolute right-2 text-xs font-bold text-gray-400">3</div>

<div id="hand-h" class="absolute w-1.5 h-14 bg-brand-blue rounded-full origin-bottom" style="bottom: 50%; left: calc(50% - 3px); transform: rotate(0deg); transition: transform 0.5s cubic-bezier(0.4, 2.08, 0.55, 0.44);"></div>

<div id="hand-m" class="absolute w-1 h-20 bg-brand-orange rounded-full origin-bottom" style="bottom: 50%; left: calc(50% - 2px); transform: rotate(0deg); transition: transform 0.5s cubic-bezier(0.4, 2.08, 0.55, 0.44);"></div>

<div class="absolute w-4 h-4 bg-brand-text rounded-full border-2 border-white z-10"></div>
</div>

<div class="flex flex-col items-center w-full max-w-xs">

<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-4">Conversor de Tempo</h3>

<div class="flex items-center gap-2 mb-6 text-4xl font-mono font-bold">
<div class="flex flex-col items-center">
<input type="number" id="in-h" value="2" min="0" max="23" class="w-16 text-center border-b-2 border-brand-blue text-brand-blue outline-none focus:bg-blue-50 transition-colors">
<span class="text-[10px] text-gray-400 uppercase font-sans mt-1">Horas</span>
</div>
<span class="text-gray-300 pb-4">:</span>
<div class="flex flex-col items-center">
<input type="number" id="in-m" value="30" min="0" max="59" class="w-16 text-center border-b-2 border-brand-orange text-brand-orange outline-none focus:bg-orange-50 transition-colors">
<span class="text-[10px] text-gray-400 uppercase font-sans mt-1">Min</span>
</div>
</div>

<div class="bg-gray-50 rounded-xl border border-gray-200 p-4 w-full mb-4">
<div class="text-[10px] font-bold text-gray-400 uppercase mb-2 text-center">Total em Minutos</div>
<div class="flex flex-col gap-1 font-mono text-sm md:text-base text-gray-600">
<div class="flex justify-between items-center border-b border-gray-200 pb-1">
<span><span class="text-brand-blue font-bold" id="math-h">2</span> √ó 60</span>
<span class="font-bold" id="math-h-res">120</span>
</div>
<div class="flex justify-between items-center text-brand-orange">
<span>+ <span class="font-bold" id="math-m">30</span></span>
<span class="font-bold" id="math-m-res">30</span>
</div>
<div class="flex justify-between items-center pt-1 border-t-2 border-gray-300 font-bold text-xl text-brand-green">
<span>Total</span>
<span id="math-total">150 min</span>
</div>
</div>
</div>

<div class="flex gap-2 w-full">
<button class="add-btn flex-1 bg-white border border-gray-200 text-gray-500 font-bold py-2 rounded-lg text-xs hover:bg-gray-100 active:scale-95 transition-all" data-add="15">+15m</button>
<button class="add-btn flex-1 bg-white border border-gray-200 text-gray-500 font-bold py-2 rounded-lg text-xs hover:bg-gray-100 active:scale-95 transition-all" data-add="30">+30m</button>
<button class="add-btn flex-1 bg-white border border-gray-200 text-gray-500 font-bold py-2 rounded-lg text-xs hover:bg-gray-100 active:scale-95 transition-all" data-add="60">+1h</button>
</div>

</div>
</div>
`;

                    // 2. SELETORES
                    const handH = container.querySelector("#hand-h");
                    const handM = container.querySelector("#hand-m");
                    const inH = container.querySelector("#in-h");
                    const inM = container.querySelector("#in-m");

                    const mathH = container.querySelector("#math-h");
                    const mathHRes = container.querySelector("#math-h-res");
                    const mathM = container.querySelector("#math-m");
                    const mathMRes = container.querySelector("#math-m-res");
                    const mathTotal = container.querySelector("#math-total");

                    const addBtns = container.querySelectorAll(".add-btn");

                    // 3. ATUALIZA√á√ÉO
                    const update = () => {
                        // Normaliza√ß√£o (Se m > 60, converte para horas)
                        let rawH = parseInt(inH.value) || 0;
                        let rawM = parseInt(inM.value) || 0;

                        // Ajuste de "wrap around" (ex: 65 min -> 1h 05min)
                        // Mas s√≥ atualizamos os inputs se o usu√°rio n√£o estiver digitando ativamente neles (para n√£o bugar a UX)
                        // Aqui vamos assumir que state √© a fonte da verdade

                        // C√°lculos para o Rel√≥gio
                        const totalMin = rawH * 60 + rawM;

                        // Rota√ß√£o Ponteiros
                        // Minutos: 6 graus por minuto
                        const degM = rawM * 6;
                        // Horas: 30 graus por hora + 0.5 graus por minuto
                        const degH = (rawH % 12) * 30 + rawM * 0.5;

                        handM.style.transform = `rotate(${degM}deg)`;
                        handH.style.transform = `rotate(${degH}deg)`;

                        // C√°lculos da Tabela
                        mathH.innerText = rawH;
                        mathHRes.innerText = rawH * 60;
                        mathM.innerText = `+ ${rawM}`;
                        mathMRes.innerText = rawM;
                        mathTotal.innerText = `${totalMin} min`;
                    };

                    // 4. INTERA√á√ÉO
                    // Inputs manuais
                    inH.addEventListener("input", update);
                    inM.addEventListener("input", update);

                    // Bot√µes de Soma (L√≥gica de Rel√≥gio)
                    addBtns.forEach((btn) => {
                        btn.onclick = () => {
                            let h = parseInt(inH.value) || 0;
                            let m = parseInt(inM.value) || 0;
                            const add = parseInt(btn.dataset.add);

                            m += add;

                            // L√≥gica de "Vai um" (Carry over)
                            while (m >= 60) {
                                m -= 60;
                                h++;
                            }

                            // Atualiza Inputs e Estado
                            inH.value = h;
                            inM.value = m;
                            update();
                        };
                    });

                    // Init
                    update();
                },

                interactive_area_calc(container) {
                    // Estado
                    let shape = "rect"; // rect, tri, circle
                    let dims = { w: 10, h: 6, b: 8, r: 5 }; // Valores Iniciais

                    // Configura√ß√£o Visual por forma
                    const configs = {
                        rect: {
                            name: "Ret√¢ngulo",
                            color: "text-brand-blue",
                            fill: "fill-blue-100",
                            stroke: "stroke-brand-blue",
                        },
                        tri: {
                            name: "Tri√¢ngulo",
                            color: "text-brand-orange",
                            fill: "fill-orange-100",
                            stroke: "stroke-brand-orange",
                        },
                        circle: {
                            name: "C√≠rculo",
                            color: "text-brand-green",
                            fill: "fill-green-100",
                            stroke: "stroke-brand-green",
                        },
                    };

                    // 1. Inje√ß√£o do HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Calculadora de √Åreas</h3>

<div class="flex gap-2 mb-6 bg-gray-50 p-1 rounded-lg w-full max-w-xs justify-center">
<button data-s="rect" class="shape-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all bg-white text-brand-blue shadow-sm">Ret√¢ngulo</button>
<button data-s="tri" class="shape-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all text-gray-400 hover:bg-white">Tri√¢ngulo</button>
<button data-s="circle" class="shape-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all text-gray-400 hover:bg-white">C√≠rculo</button>
</div>

<div class="flex flex-col md:flex-row gap-8 items-center justify-center w-full">

<div class="relative w-64 h-64 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200 flex items-center justify-center overflow-hidden">
<svg id="area-svg" width="240" height="240" viewBox="0 0 240 240" class="transition-all duration-500">
</svg>

<div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: radial-gradient(#000 1px, transparent 1px); background-size: 20px 20px;"></div>
</div>

<div class="flex flex-col gap-4 w-full max-w-xs">

<div id="inputs-area" class="flex flex-col gap-3 bg-white p-2 rounded-lg">
</div>

<div class="bg-blue-50 rounded-xl p-4 border border-blue-100 transition-colors duration-300" id="result-card">
<div class="flex justify-between items-end mb-2">
<div class="text-[10px] font-bold text-gray-400 uppercase">F√≥rmula</div>
<div id="formula-display" class="font-mono text-sm text-brand-blue font-bold">A = b √ó h</div>
</div>

<div class="w-full h-px bg-current opacity-20 mb-3"></div>

<div class="text-[10px] font-bold text-gray-400 uppercase mb-1">C√°lculo</div>
<div id="calc-display" class="font-mono text-sm text-gray-600 mb-2">10 √ó 6</div>
<div id="res-display" class="text-3xl font-bold text-brand-blue">60</div>
<div class="text-xs text-right text-gray-400 font-bold mt-1">unidades quadradas</div>
</div>
</div>
</div>
</div>
`;

                    // 2. Seletores
                    const svg = container.querySelector("#area-svg");
                    const inputsArea = container.querySelector("#inputs-area");
                    const formulaDisplay = container.querySelector("#formula-display");
                    const calcDisplay = container.querySelector("#calc-display");
                    const resDisplay = container.querySelector("#res-display");
                    const resultCard = container.querySelector("#result-card");
                    const shapeBtns = container.querySelectorAll(".shape-btn");

                    // 3. Helper de Cria√ß√£o de Input
                    const createInput = (id, label, val, max = 20) => `
<div class="flex items-center justify-between group">
<label class="text-xs font-bold text-gray-400 uppercase group-hover:text-brand-blue transition-colors">${label}</label>
<div class="flex items-center gap-2">
<input type="range" id="${id}-range" value="${val}" min="1" max="${max}" class="w-20 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue">
<input type="number" id="${id}" value="${val}" min="1" max="${max}" class="dim-input w-12 text-center border-b-2 border-gray-200 focus:border-brand-blue outline-none font-bold text-lg bg-transparent text-brand-text">
</div>
</div>
`;

                    // 4. Renderiza√ß√£o da UI (Inputs e Bot√µes)
                    const updateUI = () => {
                        const style = configs[shape];

                        // Atualiza Bot√µes
                        shapeBtns.forEach((btn) => {
                            if (btn.dataset.s === shape) {
                                btn.className = `shape-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all bg-white ${style.color} shadow-sm ring-1 ring-gray-200`;
                            } else {
                                btn.className =
                                    "shape-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all text-gray-400 hover:bg-white hover:text-gray-500";
                            }
                        });

                        // Atualiza Card de Resultado (Cores)
                        resultCard.className = `rounded-xl p-4 border transition-colors duration-300 ${style.fill.replace(
                            "fill-",
                            "bg-"
                        )} ${style.stroke
                            .replace("stroke-", "border-")
                            .replace("text-", "border-opacity-30 ")}`;
                        formulaDisplay.className = `font-mono text-sm font-bold ${style.color}`;
                        resDisplay.className = `text-3xl font-bold ${style.color}`;

                        // Gera Inputs
                        let htmlInputs = "";
                        if (shape === "rect") {
                            htmlInputs += createInput("in-w", "Base (b)", dims.w);
                            htmlInputs += createInput("in-h", "Altura (h)", dims.h);
                        } else if (shape === "tri") {
                            htmlInputs += createInput("in-b", "Base (b)", dims.b);
                            htmlInputs += createInput("in-h", "Altura (h)", dims.h); // Altura menor para caber no tri√¢ngulo
                        } else if (shape === "circle") {
                            htmlInputs += createInput("in-r", "Raio (r)", dims.r, 10); // Raio m√°x 10 (diametro 20)
                        }
                        inputsArea.innerHTML = htmlInputs;

                        // Re-adiciona Listeners aos novos inputs
                        // Sincroniza Slider e Number Input
                        container.querySelectorAll(".dim-input").forEach((input) => {
                            const range = container.querySelector(`#${input.id}-range`);

                            // Fun√ß√£o √∫nica de atualiza√ß√£o
                            const sync = (val) => {
                                val = parseFloat(val) || 0;
                                if (shape === "rect") {
                                    if (input.id === "in-w") dims.w = val;
                                    if (input.id === "in-h") dims.h = val;
                                } else if (shape === "tri") {
                                    if (input.id === "in-b") dims.b = val;
                                    if (input.id === "in-h") dims.h = val; // Altura
                                } else if (shape === "circle") {
                                    if (input.id === "in-r") dims.r = val;
                                }
                                draw();
                            };

                            input.addEventListener("input", (e) => {
                                range.value = e.target.value;
                                sync(e.target.value);
                            });

                            range.addEventListener("input", (e) => {
                                input.value = e.target.value;
                                sync(e.target.value);
                            });
                        });

                        draw();
                    };

                    // 5. Desenho e C√°lculo
                    const draw = () => {
                        // Escala: O SVG √© 240x240. Vamos dizer que 1 unidade = 10px.
                        // Centro √© 120, 120.
                        const scale = 10;
                        const center = 120;
                        const style = configs[shape];

                        svg.innerHTML = "";
                        let res = 0;
                        let formula = "";
                        let calc = "";
                        let svgContent = "";

                        if (shape === "rect") {
                            const wPx = dims.w * scale;
                            const hPx = dims.h * scale;
                            const x = center - wPx / 2;
                            const y = center - hPx / 2;

                            svgContent = `<rect x="${x}" y="${y}" width="${wPx}" height="${hPx}" class="${style.fill} ${style.stroke}" stroke-width="3" rx="4" />`;

                            // Labels de Dimens√£o
                            svgContent += `<text x="${center}" y="${y - 8
                                }" text-anchor="middle" class="text-xs fill-gray-400 font-bold">${dims.w
                                }</text>`;
                            svgContent += `<text x="${x + wPx + 8
                                }" y="${center}" text-anchor="start" class="text-xs fill-gray-400 font-bold">${dims.h
                                }</text>`;

                            res = dims.w * dims.h;
                            formula = "A = b √ó h";
                            calc = `${dims.w} √ó ${dims.h}`;
                        } else if (shape === "tri") {
                            const bPx = dims.b * scale;
                            const hPx = dims.h * scale; // Altura visual
                            // Tri√¢ngulo Is√≥sceles centralizado
                            const x1 = center - bPx / 2;
                            const x2 = center + bPx / 2;
                            const yBase = center + hPx / 2;
                            const yTop = center - hPx / 2;

                            svgContent = `<polygon points="${x1},${yBase} ${x2},${yBase} ${center},${yTop}" class="${style.fill} ${style.stroke}" stroke-width="3" stroke-linejoin="round" />`;

                            // Linha da Altura (Tracejada)
                            svgContent += `<line x1="${center}" y1="${yTop}" x2="${center}" y2="${yBase}" stroke="#4B4B4B" stroke-dasharray="4,2" stroke-width="1" />`;

                            // Labels
                            svgContent += `<text x="${center}" y="${yBase + 15
                                }" text-anchor="middle" class="text-xs fill-gray-400 font-bold">${dims.b
                                }</text>`;
                            svgContent += `<text x="${center + 4
                                }" y="${center}" text-anchor="start" class="text-xs fill-gray-500 font-bold" style="text-shadow: 0 0 2px white">h=${dims.h
                                }</text>`;

                            res = (dims.b * dims.h) / 2;
                            formula = "A = (b √ó h) / 2";
                            calc = `(${dims.b} √ó ${dims.h}) / 2`;
                        } else if (shape === "circle") {
                            const rPx = dims.r * scale;

                            svgContent = `<circle cx="${center}" cy="${center}" r="${rPx}" class="${style.fill} ${style.stroke}" stroke-width="3" />`;

                            // Linha do Raio
                            svgContent += `<line x1="${center}" y1="${center}" x2="${center + rPx
                                }" y2="${center}" stroke="#4B4B4B" stroke-width="2" />`;

                            // Ponto Central
                            svgContent += `<circle cx="${center}" cy="${center}" r="3" fill="#4B4B4B" />`;

                            // Label
                            svgContent += `<text x="${center + rPx / 2}" y="${center - 6
                                }" text-anchor="middle" class="text-xs fill-gray-500 font-bold">r=${dims.r
                                }</text>`;

                            res = Math.PI * Math.pow(dims.r, 2);
                            formula = "A = œÄ √ó r¬≤";
                            calc = `3,14 √ó ${dims.r}¬≤`;
                            res = parseFloat(res.toFixed(2));
                        }

                        svg.innerHTML = svgContent;

                        // Updates Finais de Texto
                        formulaDisplay.innerText = formula;
                        calcDisplay.innerText = calc;
                        resDisplay.innerText = res.toString().replace(".", ",");
                    };

                    // Listener Global
                    shapeBtns.forEach((btn) => {
                        btn.onclick = () => {
                            shape = btn.dataset.s;
                            updateUI();
                        };
                    });

                    // Init
                    updateUI();
                },

                interactive_volume_cube(container) {
                    // Estado Inicial
                    let dims = { w: 4, d: 3, h: 5 }; // Largura, Profundidade, Altura
                    let isFilling = false;

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col md:flex-row items-center gap-8 w-full shadow-sm font-sans select-none overflow-hidden">

<div class="flex flex-col gap-6 w-full max-w-xs z-10">
<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest">Laborat√≥rio de Volume</h3>

<div class="space-y-4">
<div>
<div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-1">
<span>Comprimento (c)</span>
<span class="text-brand-blue"><span id="val-w">4</span> cm</span>
</div>
<input type="range" id="range-w" min="2" max="6" value="4" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue">
</div>

<div>
<div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-1">
<span>Largura (l)</span>
<span class="text-brand-orange"><span id="val-d">3</span> cm</span>
</div>
<input type="range" id="range-d" min="2" max="6" value="3" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-orange">
</div>

<div>
<div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-1">
<span>Altura (a)</span>
<span class="text-brand-green"><span id="val-h">5</span> cm</span>
</div>
<input type="range" id="range-h" min="2" max="6" value="5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-green">
</div>
</div>

<button id="btn-fill" class="bg-brand-blue hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-btn active:shadow-none active:translate-y-1 transition-all flex items-center justify-center gap-2">
<i class="fas fa-tint"></i>
<span id="btn-label">Encher de √Ågua</span>
</button>
</div>

<div class="flex-1 flex flex-col items-center justify-center min-h-[300px] w-full relative perspective-container">

<div id="scene" class="relative transition-all duration-500" style="transform-style: preserve-3d; transform: rotateX(-20deg) rotateY(-30deg);">

<div id="tank" class="relative transition-all duration-500" style="transform-style: preserve-3d;">
<div class="face back absolute border-2 border-brand-blue bg-blue-50 opacity-30"></div>
<div class="face left absolute border-2 border-brand-blue bg-blue-50 opacity-30"></div>
<div class="face bottom absolute border-2 border-brand-blue bg-blue-100 opacity-80"></div>

<div id="water" class="absolute bottom-0 left-0 transition-all duration-[2s] ease-in-out opacity-80" style="transform-style: preserve-3d; width: 100%; height: 0%;">
<div class="water-face front absolute bg-blue-400 opacity-60"></div>
<div class="water-face back absolute bg-blue-400 opacity-60"></div>
<div class="water-face right absolute bg-blue-500 opacity-60"></div>
<div class="water-face left absolute bg-blue-500 opacity-60"></div>
<div class="water-face top absolute bg-blue-300 opacity-90"></div>
</div>

<div class="face right absolute border-2 border-brand-blue bg-blue-50 opacity-20 pointer-events-none"></div>
<div class="face front absolute border-2 border-brand-blue bg-blue-50 opacity-10 pointer-events-none"></div>
</div>

</div>

<div class="mt-12 w-full max-w-xs bg-gray-50 border border-gray-200 rounded-xl p-3 flex justify-around text-center z-10">
<div>
<div class="text-[10px] font-bold text-gray-400 uppercase">Volume</div>
<div class="text-xl font-mono font-bold text-brand-text" id="res-vol">60 cm¬≥</div>
</div>
<div class="w-px bg-gray-200"></div>
<div>
<div class="text-[10px] font-bold text-gray-400 uppercase">Capacidade</div>
<div class="text-xl font-mono font-bold text-brand-blue" id="res-cap">60 mL</div>
</div>
</div>

</div>
</div>
`;

                    // 2. CSS Din√¢mico (Para controlar o 3D)
                    const style = document.createElement("style");
                    style.innerHTML = `
.perspective-container { perspective: 800px; }
.face { position: absolute; box-sizing: border-box; }
.water-face { position: absolute; box-sizing: border-box; }

/* Posicionamento Din√¢mico via Vari√°veis CSS */
#tank {
width: var(--w-px);
height: var(--h-px);
/* Centraliza o ponto de rota√ß√£o no meio do cubo */
transform-origin: 50% 50% calc(var(--d-px) / -2);
}

/* --- FACES DO TANQUE --- */
.face.front{ width: var(--w-px); height: var(--h-px); transform: translateZ(0); }
.face.back { width: var(--w-px); height: var(--h-px); transform: translateZ(calc(var(--d-px) * -1)); }
.face.right{ width: var(--d-px); height: var(--h-px); transform: rotateY(90deg) translateZ(calc(var(--d-px) / 2 + var(--w-px) - var(--d-px)/2)); } 
/* Ajuste matem√°tico complexo simplificado: Right face pivot */
/* Vamos usar transform-origin left para facilitar */

/* Simplificando Transforms com Origin */
.face.right { width: var(--d-px); height: var(--h-px); transform-origin: top right; right: 0; transform: rotateY(90deg); }
.face.left{ width: var(--d-px); height: var(--h-px); transform-origin: top left; left: 0; transform: rotateY(-90deg); }
.face.top{ width: var(--w-px); height: var(--d-px); transform-origin: top left; transform: rotateX(90deg); }
.face.bottom { width: var(--w-px); height: var(--d-px); transform-origin: bottom left; bottom: 0; transform: rotateX(90deg); }

/* --- √ÅGUA --- */
.water-face.front { width: 100%; height: 100%; transform: translateZ(0); }
.water-face.back{ width: 100%; height: 100%; transform: translateZ(calc(var(--d-px) * -1)); }
.water-face.left{ width: var(--d-px); height: 100%; transform-origin: top left; left: 0; transform: rotateY(-90deg); }
.water-face.right { width: var(--d-px); height: 100%; transform-origin: top right; right: 0; transform: rotateY(90deg); }
.water-face.top { width: 100%; height: var(--d-px); transform-origin: top left; top: 0; transform: rotateX(90deg); }
`;
                    container.appendChild(style);

                    // 3. Seletores
                    const rW = container.querySelector("#range-w");
                    const rD = container.querySelector("#range-d");
                    const rH = container.querySelector("#range-h");

                    const vW = container.querySelector("#val-w");
                    const vD = container.querySelector("#val-d");
                    const vH = container.querySelector("#val-h");

                    const tank = container.querySelector("#tank");
                    const water = container.querySelector("#water");
                    const btnFill = container.querySelector("#btn-fill");
                    const btnLabel = container.querySelector("#btn-label");

                    const resVol = container.querySelector("#res-vol");
                    const resCap = container.querySelector("#res-cap");

                    // 4. L√≥gica de Atualiza√ß√£o
                    const update = () => {
                        // Atualiza inputs
                        dims.w = parseInt(rW.value);
                        dims.d = parseInt(rD.value);
                        dims.h = parseInt(rH.value);

                        // Atualiza Textos
                        vW.innerText = dims.w;
                        vD.innerText = dims.d;
                        vH.innerText = dims.h;

                        // Calcula Volume
                        const vol = dims.w * dims.d * dims.h;
                        resVol.innerText = `${vol} cm¬≥`;
                        resCap.innerText = `${vol} mL`; // 1 cm¬≥ = 1 mL

                        // Atualiza CSS Variables para redimensionar o 3D
                        const scale = 30; // 1cm = 30px
                        tank.style.setProperty("--w-px", `${dims.w * scale}px`);
                        tank.style.setProperty("--d-px", `${dims.d * scale}px`);
                        tank.style.setProperty("--h-px", `${dims.h * scale}px`);
                    };

                    // 5. A√ß√£o de Encher
                    btnFill.onclick = () => {
                        isFilling = !isFilling;
                        if (isFilling) {
                            water.style.height = "100%"; // Enche at√© o topo
                            btnLabel.innerText = "Esvaziar";
                            btnFill.classList.replace("bg-brand-blue", "bg-brand-red");
                            btnFill.classList.replace(
                                "hover:bg-blue-600",
                                "hover:bg-red-600"
                            );
                        } else {
                            water.style.height = "0%"; // Esvazia
                            btnLabel.innerText = "Encher de √Ågua";
                            btnFill.classList.replace("bg-brand-red", "bg-brand-blue");
                            btnFill.classList.replace(
                                "hover:bg-red-600",
                                "hover:bg-blue-600"
                            );
                        }
                    };

                    // Listeners
                    [rW, rD, rH].forEach((el) => el.addEventListener("input", update));

                    // Init
                    update();
                },

                interactive_charts_demo(container) {
                    // Estado
                    let chartType = "bar"; // bar, pie, line

                    // Dados Iniciais (Pesquisa de Prefer√™ncia)
                    let data = {
                        labels: ["Futebol", "V√¥lei", "Basquete"],
                        values: [12, 8, 5],
                    };

                    // Cores do Tema
                    const colors = {
                        bg: [
                            "rgba(28, 176, 246, 0.7)",
                            "rgba(255, 150, 0, 0.7)",
                            "rgba(88, 204, 2, 0.7)",
                        ], // Blue, Orange, Green
                        border: ["#1CB0F6", "#FF9600", "#58CC02"],
                    };

                    let chartInstance = null;

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans">

<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-4">Laborat√≥rio de Gr√°ficos</h3>

<div class="flex gap-2 mb-6 bg-gray-50 p-1 rounded-lg w-full max-w-xs justify-center">
<button data-type="bar" class="chart-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all bg-white text-brand-blue shadow-sm">
<i class="fas fa-chart-bar"></i> Barras
</button>
<button data-type="pie" class="chart-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all text-gray-400 hover:bg-white">
<i class="fas fa-chart-pie"></i> Pizza
</button>
<button data-type="line" class="chart-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all text-gray-400 hover:bg-white">
<i class="fas fa-chart-line"></i> Linha
</button>
</div>

<div class="relative w-full max-w-sm h-64 bg-white mb-6">
<canvas id="myChart"></canvas>
</div>

<div class="w-full max-w-sm bg-gray-50 rounded-xl border border-gray-200 p-4">
<div class="flex justify-between text-[10px] font-bold text-gray-400 uppercase mb-2 px-2">
<span>Categoria</span>
<span>Votos</span>
</div>

<div class="flex flex-col gap-2" id="inputs-list">
<div class="flex items-center gap-2">
<div class="w-3 h-3 rounded-full bg-brand-blue"></div>
<input type="text" class="lbl-input flex-1 bg-white border border-gray-200 rounded px-2 py-1 text-sm font-bold text-gray-600 outline-none focus:border-brand-blue" data-idx="0" value="Futebol">
<input type="number" class="val-input w-16 bg-white border border-gray-200 rounded px-2 py-1 text-sm font-bold text-brand-blue outline-none focus:border-brand-blue text-center" data-idx="0" value="12" min="0">
</div>
<div class="flex items-center gap-2">
<div class="w-3 h-3 rounded-full bg-brand-orange"></div>
<input type="text" class="lbl-input flex-1 bg-white border border-gray-200 rounded px-2 py-1 text-sm font-bold text-gray-600 outline-none focus:border-brand-orange" data-idx="1" value="V√¥lei">
<input type="number" class="val-input w-16 bg-white border border-gray-200 rounded px-2 py-1 text-sm font-bold text-brand-orange outline-none focus:border-brand-orange text-center" data-idx="1" value="8" min="0">
</div>
<div class="flex items-center gap-2">
<div class="w-3 h-3 rounded-full bg-brand-green"></div>
<input type="text" class="lbl-input flex-1 bg-white border border-gray-200 rounded px-2 py-1 text-sm font-bold text-gray-600 outline-none focus:border-brand-green" data-idx="2" value="Basquete">
<input type="number" class="val-input w-16 bg-white border border-gray-200 rounded px-2 py-1 text-sm font-bold text-brand-green outline-none focus:border-brand-green text-center" data-idx="2" value="5" min="0">
</div>
</div>
</div>

<div id="chart-tip" class="mt-4 text-xs text-center text-gray-500 font-medium italic">
Use gr√°fico de <strong>Barras</strong> para comparar quem tem mais ou menos.
</div>
</div>
`;

                    // 2. Seletores
                    const ctx = container.querySelector("#myChart").getContext("2d");
                    const btns = container.querySelectorAll(".chart-btn");
                    const lblInputs = container.querySelectorAll(".lbl-input");
                    const valInputs = container.querySelectorAll(".val-input");
                    const tipEl = container.querySelector("#chart-tip");

                    // 3. Renderiza√ß√£o do Gr√°fico (Chart.js)
                    const renderChart = () => {
                        // Destroi anterior para n√£o sobrepor
                        if (chartInstance) chartInstance.destroy();

                        // Configura√ß√µes espec√≠ficas por tipo
                        const isPie = chartType === "pie";

                        // Dicas Pedag√≥gicas
                        const tips = {
                            bar: "Use <strong>Barras</strong> para comparar quantidades absolutas (quem ganhou?).",
                            pie: "Use <strong>Pizza</strong> para ver a divis√£o do todo (porcentagem).",
                            line: "Use <strong>Linha</strong> para ver evolu√ß√£o (crescimento ou queda).",
                        };
                        tipEl.innerHTML = tips[chartType];

                        chartInstance = new Chart(ctx, {
                            type: chartType,
                            data: {
                                labels: data.labels,
                                datasets: [
                                    {
                                        label: "Votos",
                                        data: data.values,
                                        backgroundColor: isPie ? colors.bg : colors.bg[0], // Pizza usa v√°rias cores, barra usa uma (ou array mapeado)
                                        // Para ficar bonito no MathLingo, vamos for√ßar cores diferentes nas barras tamb√©m
                                        backgroundColor: colors.bg,
                                        borderColor: colors.border,
                                        borderWidth: 2,
                                        borderRadius: isPie ? 0 : 5, // Arredonda barras
                                        tension: 0.4, // Suaviza linha
                                    },
                                ],
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: isPie, // S√≥ mostra legenda na pizza
                                        position: "bottom",
                                        labels: {
                                            font: {
                                                family: "'Nunito', sans-serif",
                                                weight: "bold",
                                            },
                                        },
                                    },
                                    tooltip: {
                                        backgroundColor: "rgba(75, 75, 75, 0.9)",
                                        titleFont: { family: "'Nunito', sans-serif" },
                                        bodyFont: { family: "'Nunito', sans-serif" },
                                    },
                                },
                                scales: {
                                    y: {
                                        display: !isPie, // Esconde eixo Y na pizza
                                        beginAtZero: true,
                                        grid: { display: true, drawBorder: false },
                                    },
                                    x: {
                                        display: !isPie,
                                        grid: { display: false },
                                    },
                                },
                                animation: {
                                    duration: 800,
                                    easing: "easeOutQuart",
                                },
                            },
                        });
                    };

                    // 4. Listeners

                    // Bot√µes de Tipo
                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            chartType = btn.dataset.type;

                            // Atualiza UI dos bot√µes
                            btns.forEach((b) => {
                                const active = b.dataset.type === chartType;
                                b.className = active
                                    ? "chart-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all bg-white text-brand-blue shadow-sm ring-1 ring-gray-200"
                                    : "chart-btn flex-1 py-2 rounded-md text-xs font-bold uppercase transition-all text-gray-400 hover:bg-white";
                            });

                            renderChart();
                        };
                    });

                    // Inputs da Tabela (Labels e Valores)
                    const updateData = () => {
                        lblInputs.forEach((inp) => {
                            const idx = inp.dataset.idx;
                            data.labels[idx] = inp.value;
                        });
                        valInputs.forEach((inp) => {
                            const idx = inp.dataset.idx;
                            data.values[idx] = parseInt(inp.value) || 0;
                        });

                        // Chart.js permite atualizar dados sem destruir tudo
                        chartInstance.data.labels = data.labels;
                        chartInstance.data.datasets[0].data = data.values;
                        chartInstance.update();
                    };

                    lblInputs.forEach((i) => i.addEventListener("input", updateData));
                    valInputs.forEach((i) => i.addEventListener("input", updateData));

                    // Checagem de seguran√ßa (Se Chart.js n√£o carregou)
                    if (typeof Chart !== "undefined") {
                        renderChart();
                    } else {
                        container.innerHTML = `<div class="text-red-500 font-bold text-center p-4">Erro: Biblioteca Chart.js n√£o carregada.</div>`;
                    }
                },

                interactive_head_tail(container) {
                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans">
<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-1">Cara ou Coroa?</h3>
<p class="text-xs text-gray-400 mb-4 text-center">Observe como a propor√ß√£o se equilibra com muitos lan√ßamentos.</p>

<!-- Painel de Estat√≠sticas -->
<div class="flex gap-4 w-full max-w-sm mb-6">
<!-- Cara -->
<div class="flex-1 bg-yellow-50 border-2 border-yellow-200 rounded-xl p-3 flex flex-col items-center">
<div class="w-8 h-8 rounded-full bg-brand-yellow border-2 border-yellow-600 flex items-center justify-center text-white font-bold mb-1 shadow-sm text-xs">C</div>
<span class="text-[10px] font-bold uppercase text-yellow-600">Cara</span>
<div class="text-2xl font-black text-brand-yellow" id="count-cara">0</div>
<div class="text-xs font-bold text-yellow-600 opacity-60" id="pct-cara">0%</div>
<!-- Barra de Progresso -->
<div class="w-full h-1.5 bg-yellow-200 rounded-full mt-2 overflow-hidden">
<div id="bar-cara" class="h-full bg-brand-yellow transition-all duration-500" style="width: 0%"></div>
</div>
</div>

<!-- Coroa -->
<div class="flex-1 bg-gray-100 border-2 border-gray-200 rounded-xl p-3 flex flex-col items-center">
<div class="w-8 h-8 rounded-full bg-gray-400 border-2 border-gray-600 flex items-center justify-center text-white font-bold mb-1 shadow-sm text-xs">K</div>
<span class="text-[10px] font-bold uppercase text-gray-500">Coroa</span>
<div class="text-2xl font-black text-gray-500" id="count-coroa">0</div>
<div class="text-xs font-bold text-gray-400 opacity-60" id="pct-coroa">0%</div>
<!-- Barra de Progresso -->
<div class="w-full h-1.5 bg-gray-200 rounded-full mt-2 overflow-hidden">
<div id="bar-coroa" class="h-full bg-gray-500 transition-all duration-500" style="width: 0%"></div>
</div>
</div>
</div>

<!-- Bot√µes de A√ß√£o -->
<div class="flex gap-2 mb-6 w-full max-w-sm">
<button class="action-btn flex-1 bg-white border-2 border-brand-blue text-brand-blue hover:bg-blue-50 font-bold py-2 rounded-lg text-xs transition-all shadow-sm active:scale-95" data-n="1">
1 Moeda
</button>
<button class="action-btn flex-1 bg-white border-2 border-brand-blue text-brand-blue hover:bg-blue-50 font-bold py-2 rounded-lg text-xs transition-all shadow-sm active:scale-95" data-n="10">
10 Moedas
</button>
<button class="action-btn flex-1 bg-brand-blue text-white hover:bg-brand-blueDark font-bold py-2 rounded-lg text-xs transition-all shadow-btn active:shadow-none active:translate-y-1" data-n="100">
100 Moedas!
</button>
</div>

<!-- √Årea Visual (Moedas) -->
<div class="w-full bg-brand-bg rounded-xl border-inner p-4 min-h-[100px] max-h-[220px] overflow-y-auto">
<div id="coins-container" class="flex flex-wrap justify-center gap-1 content-start">
<span class="text-gray-400 text-xs italic mt-4">Lance as moedas para ver o resultado...</span>
</div>
</div>
</div>
`;

                    // 2. Seletores
                    const countCaraEl = container.querySelector("#count-cara");
                    const pctCaraEl = container.querySelector("#pct-cara");
                    const barCara = container.querySelector("#bar-cara");

                    const countCoroaEl = container.querySelector("#count-coroa");
                    const pctCoroaEl = container.querySelector("#pct-coroa");
                    const barCoroa = container.querySelector("#bar-coroa");

                    const coinsContainer = container.querySelector("#coins-container");
                    const btns = container.querySelectorAll(".action-btn");

                    // 3. Fun√ß√£o de Lan√ßamento
                    const flip = (n) => {
                        coinsContainer.innerHTML = ""; // Limpa anteriores (Reset Mode)

                        let cara = 0;
                        let coroa = 0;

                        // Fragmento para performance ao inserir 100 elementos
                        const fragment = document.createDocumentFragment();

                        for (let i = 0; i < n; i++) {
                            const isCara = Math.random() < 0.5;
                            if (isCara) cara++;
                            else coroa++;

                            const coin = document.createElement("div");
                            // Estilo da moeda
                            const colorClass = isCara
                                ? "bg-brand-yellow border-yellow-600 text-yellow-800"
                                : "bg-gray-300 border-gray-500 text-gray-700";
                            const sizeClass =
                                n === 100 ? "w-4 h-4 text-[8px]" : "w-8 h-8 text-xs"; // Menor se forem muitas

                            coin.className = `${sizeClass} rounded-full border-2 flex items-center justify-center font-black shadow-sm animate-pop-in ${colorClass}`;
                            coin.innerText = isCara ? "C" : "K";
                            // Delay aleat√≥rio leve para efeito de "chuva"
                            coin.style.animationDelay = `${Math.random() * 0.2}s`;

                            fragment.appendChild(coin);
                        }

                        coinsContainer.appendChild(fragment);

                        // Atualiza Stats
                        updateStats(cara, coroa, n);
                    };

                    const updateStats = (cara, coroa, total) => {
                        countCaraEl.innerText = cara;
                        countCoroaEl.innerText = coroa;

                        const pCara = Math.round((cara / total) * 100);
                        const pCoroa = Math.round((coroa / total) * 100); // Pode dar 99% ou 101% em rounding, ok para demo

                        pctCaraEl.innerText = `${pCara}%`;
                        pctCoroaEl.innerText = `${pCoroa}%`;

                        barCara.style.width = `${pCara}%`;
                        barCoroa.style.width = `${pCoroa}%`;
                    };

                    // 4. Listeners
                    btns.forEach((btn) => {
                        btn.onclick = () => flip(parseInt(btn.dataset.n));
                    });
                },

                interactive_prob_dice_intuitive(container) {
                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans">
<h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-1">Dados e M√©dia</h3>
<p class="text-xs text-gray-400 mb-4 text-center">Lance muitos dados e veja a m√°gica da m√©dia 3,5.</p>

<!-- Painel de M√©dia -->
<div class="bg-purple-50 border border-purple-100 rounded-xl p-4 w-full max-w-sm mb-6 flex justify-between items-center">
<div class="text-xs font-bold text-brand-purple uppercase">
Soma Total: <span id="sum-val" class="text-brand-text">0</span><br>
Dados: <span id="count-val" class="text-brand-text">0</span>
</div>
<div class="text-right">
<div class="text-[10px] font-bold text-gray-400 uppercase">M√©dia (Soma √∑ Qtd)</div>
<div class="text-4xl font-black text-brand-purple transition-all" id="avg-display">0.0</div>
</div>
</div>

<!-- Bot√µes -->
<div class="flex gap-2 mb-6 w-full max-w-sm">
<button class="dice-btn flex-1 bg-white border-2 border-brand-purple text-brand-purple hover:bg-purple-50 font-bold py-2 rounded-lg text-xs transition-all shadow-sm active:scale-95" data-n="1">
1 Dado
</button>
<button class="dice-btn flex-1 bg-white border-2 border-brand-purple text-brand-purple hover:bg-purple-50 font-bold py-2 rounded-lg text-xs transition-all shadow-sm active:scale-95" data-n="10">
10 Dados
</button>
<button class="dice-btn flex-1 bg-brand-purple text-white hover:bg-purple-700 font-bold py-2 rounded-lg text-xs transition-all shadow-btn active:shadow-none active:translate-y-1" data-n="100">
100 Dados
</button>
</div>

<!-- √Årea Visual (Dados) -->
<div class="w-full bg-brand-bg rounded-xl border-inner p-4 min-h-[100px] max-h-[220px] overflow-y-auto">
<div id="dice-container" class="flex flex-wrap justify-center gap-2 content-start">
<span class="text-gray-400 text-xs italic mt-4">Role os dados...</span>
</div>
</div>

<!-- Gr√°fico de Barras Simplificado (Distribui√ß√£o) -->
<div class="w-full max-w-sm mt-4 grid grid-cols-6 gap-1 h-16 items-end" id="bars-container">
<!-- Barras geradas via JS -->
</div>
<div class="w-full max-w-sm grid grid-cols-6 gap-1 text-center text-[10px] font-bold text-gray-400">
<span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span>
</div>
</div>
`;

                    // 2. Seletores
                    const sumVal = container.querySelector("#sum-val");
                    const countVal = container.querySelector("#count-val");
                    const avgDisplay = container.querySelector("#avg-display");
                    const diceContainer = container.querySelector("#dice-container");
                    const barsContainer = container.querySelector("#bars-container");
                    const btns = container.querySelectorAll(".dice-btn");

                    // Helper: Criar face do dado com grid CSS
                    // Retorna o HTML interno das bolinhas
                    const getDiceFace = (val) => {
                        const dots = {
                            1: '<div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 2/2"></div>',
                            2: '<div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 1/1"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 3/3"></div>',
                            3: '<div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 1/1"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 2/2"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 3/3"></div>',
                            4: '<div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 1/1"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 1/3"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 3/1"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 3/3"></div>',
                            5: '<div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 1/1"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 1/3"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 2/2"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 3/1"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 3/3"></div>',
                            6: '<div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 1/1"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 1/3"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 2/1"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 2/3"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 3/1"></div><div class="bg-brand-text w-1.5 h-1.5 rounded-full" style="grid-area: 3/3"></div>',
                        };
                        return dots[val];
                    };

                    // 3. Fun√ß√£o de Rolar
                    const roll = (n) => {
                        diceContainer.innerHTML = "";

                        let sum = 0;
                        let frequencies = [0, 0, 0, 0, 0, 0, 0]; // Index 1-6

                        const fragment = document.createDocumentFragment();

                        for (let i = 0; i < n; i++) {
                            const val = Math.floor(Math.random() * 6) + 1;
                            sum += val;
                            frequencies[val]++;

                            const dice = document.createElement("div");
                            const sizeClass =
                                n === 100 ? "w-6 h-6 p-0.5" : "w-10 h-10 p-1.5";

                            dice.className = `${sizeClass} bg-white rounded-lg shadow-sm border border-gray-300 grid grid-cols-3 grid-rows-3 gap-0.5 animate-pop-in`;
                            dice.innerHTML = getDiceFace(val);
                            dice.style.animationDelay = `${Math.random() * 0.3}s`;

                            fragment.appendChild(dice);
                        }
                        diceContainer.appendChild(fragment);

                        // Atualiza Stats
                        const avg = sum / n;
                        sumVal.innerText = sum;
                        countVal.innerText = n;
                        avgDisplay.innerText = avg.toFixed(2); // Ex: 3.45

                        // Feedback visual na M√©dia
                        // Se estiver entre 3 e 4, fica verde (zona esperada para grandes n√∫meros)
                        if (n > 10 && avg >= 3 && avg <= 4) {
                            avgDisplay.className =
                                "text-4xl font-black text-brand-green transition-all scale-110";
                        } else {
                            avgDisplay.className =
                                "text-4xl font-black text-brand-purple transition-all";
                        }

                        // Atualiza Barras
                        barsContainer.innerHTML = "";
                        // Encontra o maior valor para escalar as barras (max-height: 100%)
                        const maxFreq = Math.max(...frequencies.slice(1));

                        for (let i = 1; i <= 6; i++) {
                            const hPercent =
                                maxFreq > 0 ? (frequencies[i] / maxFreq) * 100 : 0;
                            const bar = document.createElement("div");
                            bar.className =
                                "bg-brand-purple rounded-t-sm w-full transition-all duration-500 opacity-80 hover:opacity-100 relative group";
                            bar.style.height = `${hPercent}%`;

                            // Tooltip simples
                            bar.innerHTML = `<div class="absolute bottom-full left-1/2 -translate-x-1/2 text-[10px] bg-black text-white px-1 rounded opacity-0 group-hover:opacity-100 pointer-events-none mb-1">${frequencies[i]}</div>`;

                            barsContainer.appendChild(bar);
                        }
                    };

                    // 4. Listeners
                    btns.forEach((btn) => {
                        btn.onclick = () => roll(parseInt(btn.dataset.n));
                    });
                },

                interactive_sign_rules(container) {
                    // Estado Inicial (1 = Positivo, -1 = Negativo)
                    let s1 = 1;
                    let s2 = 1;

                    // Configura√ß√£o Visual
                    const styles = {
                        pos: {
                            symbol: "+",
                            color: "text-brand-green",
                            bg: "bg-green-100",
                            border: "border-brand-green",
                            icon: "fa-smile-beam", // Carinha feliz
                            label: "Amigo",
                            desc: "Positivo",
                        },
                        neg: {
                            symbol: "-",
                            color: "text-brand-red",
                            bg: "bg-red-100",
                            border: "border-brand-red",
                            icon: "fa-angry", // Carinha brava
                            label: "Inimigo",
                            desc: "Negativo",
                        },
                    };

                    // 1. Inje√ß√£o do HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-2">Multiplica√ß√£o e Divis√£o</h3>
<p class="text-xs text-gray-400 mb-6 font-bold">Toque nos cart√µes para trocar o sinal!</p>

<div class="flex flex-col md:flex-row items-center justify-center gap-4 mb-8 w-full">

<button id="btn-s1" class="sign-card w-24 h-32 rounded-2xl border-4 flex flex-col items-center justify-center transition-all duration-300 hover:scale-105 active:scale-95 shadow-md group">
<i class="fas text-3xl mb-2 transition-transform duration-300 group-hover:rotate-12"></i>
<span class="text-5xl font-black mb-1 symbol"></span>
<span class="text-[10px] font-bold uppercase tracking-wider opacity-60 label"></span>
</button>

<div class="text-3xl font-black text-gray-300">√ó</div>

<button id="btn-s2" class="sign-card w-24 h-32 rounded-2xl border-4 flex flex-col items-center justify-center transition-all duration-300 hover:scale-105 active:scale-95 shadow-md group">
<i class="fas text-3xl mb-2 transition-transform duration-300 group-hover:-rotate-12"></i>
<span class="text-5xl font-black mb-1 symbol"></span>
<span class="text-[10px] font-bold uppercase tracking-wider opacity-60 label"></span>
</button>

<div class="text-3xl font-black text-gray-300">=</div>

<div id="res-card" class="w-24 h-32 rounded-2xl border-4 border-dashed flex flex-col items-center justify-center transition-all duration-500 relative overflow-hidden bg-gray-50">
<div class="absolute inset-0 opacity-20 bg-current transition-colors"></div>
<i class="fas text-3xl mb-2 z-10 transition-all" id="res-icon"></i>
<span class="text-5xl font-black mb-1 z-10" id="res-symbol"></span>
<span class="text-[10px] font-bold uppercase tracking-wider opacity-60 z-10" id="res-label"></span>
</div>

</div>

<div class="bg-gray-50 rounded-xl p-4 w-full max-w-md border-2 border-gray-100 text-center transition-all duration-300" id="logic-box">
<p class="text-lg font-bold text-brand-text mb-1" id="logic-title">logic</p>
<p class="text-sm text-gray-500 italic" id="logic-desc">desc</p>
</div>

</div>
`;

                    // 2. Seletores
                    const btnS1 = container.querySelector("#btn-s1");
                    const btnS2 = container.querySelector("#btn-s2");
                    const resCard = container.querySelector("#res-card");
                    const resIcon = container.querySelector("#res-icon");
                    const resSymbol = container.querySelector("#res-symbol");
                    const resLabel = container.querySelector("#res-label");

                    const logicBox = container.querySelector("#logic-box");
                    const logicTitle = container.querySelector("#logic-title");
                    const logicDesc = container.querySelector("#logic-desc");

                    // 3. Fun√ß√£o de Renderiza√ß√£o de um Cart√£o
                    const renderCard = (element, signVal) => {
                        const style = signVal === 1 ? styles.pos : styles.neg;

                        // Remove classes antigas de cor
                        element.className = element.className.replace(
                            /text-brand-\w+|bg-\w+-\d+|border-brand-\w+|border-\w+-\d+/g,
                            ""
                        );

                        // Adiciona novas
                        element.classList.add(style.color, style.bg, style.border);

                        // Atualiza conte√∫do interno
                        element.querySelector(
                            "i"
                        ).className = `fas ${style.icon} text-3xl mb-2 transition-transform duration-300 group-hover:rotate-12`;
                        element.querySelector(".symbol").innerText = style.symbol;
                        element.querySelector(".label").innerText = style.desc;
                    };

                    // 4. L√≥gica Principal
                    const update = () => {
                        const resVal = s1 * s2; // A matem√°tica real: 1*1=1, 1*-1=-1, -1*-1=1

                        // Renderiza Inputs
                        renderCard(btnS1, s1);
                        renderCard(btnS2, s2);

                        // Renderiza Resultado
                        const resStyle = resVal === 1 ? styles.pos : styles.neg;

                        resCard.className = `w-24 h-32 rounded-2xl border-4 flex flex-col items-center justify-center transition-all duration-500 relative overflow-hidden ${resStyle.bg} ${resStyle.border} ${resStyle.color}`;
                        resIcon.className = `fas ${resStyle.icon} text-3xl mb-2 z-10 animate-pop-in`;
                        resSymbol.innerText = resStyle.symbol;
                        resLabel.innerText = resStyle.desc;

                        // Renderiza L√≥gica (Met√°fora)
                        // L√≥gica: Amigo (+) ou Inimigo (-)
                        const p1 = s1 === 1 ? "Amigo" : "Inimigo";
                        const p2 = s2 === 1 ? "Amigo" : "Inimigo";
                        const resText = resVal === 1 ? "Amigo" : "Inimigo";

                        // Frase montada: "O (Amigo) do meu (Inimigo) √© meu..."
                        logicTitle.innerHTML = `O <span class="${s1 === 1 ? "text-brand-green" : "text-brand-red"
                            }">${p1}</span> do meu <span class="${s2 === 1 ? "text-brand-green" : "text-brand-red"
                            }">${p2}</span> √© meu...`;

                        logicDesc.innerHTML = `<span class="font-black text-xl ${resStyle.color} uppercase not-italic animate-pulse">${resText}</span>`;

                        // Feedback de borda na caixa de texto
                        logicBox.className = `bg-gray-50 rounded-xl p-4 w-full max-w-md border-2 text-center transition-all duration-300 ${resStyle.border.replace(
                            "border-",
                            "border-opacity-30 border-"
                        )}`;
                    };

                    // 5. Listeners
                    btnS1.onclick = () => {
                        s1 *= -1; // Inverte sinal
                        update();
                    };

                    btnS2.onclick = () => {
                        s2 *= -1; // Inverte sinal
                        update();
                    };

                    // CSS Inline para anima√ß√£o
                    if (!document.getElementById("anim-pop")) {
                        const style = document.createElement("style");
                        style.id = "anim-pop";
                        style.innerHTML = `@keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 70% { transform: scale(1.2); } 100% { transform: scale(1); opacity: 1; } } .animate-pop-in { animation: popIn 0.4s ease-out forwards; }`;
                        container.appendChild(style);
                    }

                    // Init
                    update();
                },

                interactive_rule_of_three(container) {
                    // Estado
                    let mode = "direct"; // 'direct' ou 'inverse'

                    // Dados de Exemplo (Presets)
                    const scenarios = {
                        custom: {
                            label: "Personalizado",
                            u1: "A",
                            u2: "B",
                            v1: 2,
                            v2: 10,
                            v3: 5,
                        },
                        gas: {
                            label: "Gasolina (Direta)",
                            u1: "Litros",
                            u2: "Dist√¢ncia (km)",
                            v1: 10,
                            v2: 100,
                            v3: 20,
                            mode: "direct",
                        },
                        speed: {
                            label: "Viagem (Inversa)",
                            u1: "Velocidade (km/h)",
                            u2: "Tempo (h)",
                            v1: 80,
                            v2: 2,
                            v3: 40,
                            mode: "inverse",
                        },
                        food: {
                            label: "Comida (Direta)",
                            u1: "Pessoas",
                            u2: "Gramas",
                            v1: 2,
                            v2: 500,
                            v3: 5,
                            mode: "direct",
                        },
                        work: {
                            label: "Obra (Inversa)",
                            u1: "Pedreiros",
                            u2: "Dias",
                            v1: 3,
                            v2: 10,
                            v3: 6,
                            mode: "inverse",
                        },
                    };

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-4">A Ferramenta Suprema</h3>

<select id="scenario-select" class="mb-6 bg-gray-100 border border-gray-200 text-gray-700 text-sm rounded-lg focus:ring-brand-blue focus:border-brand-blue block w-full p-2.5 font-bold cursor-pointer outline-none max-w-xs">
<option value="custom">-- Modo Livre --</option>
<option value="gas">üöó Gasolina vs Dist√¢ncia</option>
<option value="speed">‚è±Ô∏è Velocidade vs Tempo</option>
<option value="food">üçï Pessoas vs Comida</option>
<option value="work">üß± Oper√°rios vs Dias</option>
</select>

<div class="flex bg-gray-100 p-1 rounded-lg mb-8 w-full max-w-xs relative">
<div id="mode-bg" class="absolute top-1 bottom-1 w-[calc(50%-4px)] bg-white rounded-md shadow-sm transition-all duration-300 left-1"></div>
<button data-m="direct" class="mode-btn flex-1 py-2 rounded-md text-xs font-bold uppercase z-10 transition-colors text-brand-blue">Direta</button>
<button data-m="inverse" class="mode-btn flex-1 py-2 rounded-md text-xs font-bold uppercase z-10 transition-colors text-gray-400">Inversa</button>
</div>

<div class="relative w-full max-w-sm flex justify-between items-center gap-8 mb-8">

<svg id="lines-svg" class="absolute inset-0 w-full h-full pointer-events-none z-0 overflow-visible">
</svg>

<div class="flex flex-col gap-6 z-10 w-24">
<div class="flex flex-col">
<input type="text" id="label-u1" value="Grandeza A" class="text-[10px] font-bold text-gray-400 uppercase text-center bg-transparent border-none outline-none mb-1">
<input type="number" id="val-a" class="calc-input text-center font-bold text-xl p-2 rounded-lg border-2 border-gray-200 bg-white shadow-sm focus:border-brand-blue outline-none text-brand-text" value="2">
</div>
<div class="flex flex-col">
<input type="number" id="val-c" class="calc-input text-center font-bold text-xl p-2 rounded-lg border-2 border-gray-200 bg-white shadow-sm focus:border-brand-blue outline-none text-brand-text" value="5">
</div>
</div>

<div class="flex flex-col gap-6 z-10 w-24">
<div class="flex flex-col">
<input type="text" id="label-u2" value="Grandeza B" class="text-[10px] font-bold text-gray-400 uppercase text-center bg-transparent border-none outline-none mb-1">
<input type="number" id="val-b" class="calc-input text-center font-bold text-xl p-2 rounded-lg border-2 border-gray-200 bg-white shadow-sm focus:border-brand-blue outline-none text-brand-text" value="10">
</div>
<div class="flex flex-col relative">
<div class="h-[46px] flex items-center justify-center bg-gray-100 rounded-lg border-2 border-gray-200 border-dashed text-brand-purple font-black text-2xl" id="val-x">
?
</div>
<span class="absolute -right-6 top-1/2 -translate-y-1/2 text-brand-purple font-bold text-xs">X</span>
</div>
</div>

</div>

<div class="w-full max-w-md bg-gray-50 border-2 border-gray-200 rounded-xl p-4 transition-colors duration-300" id="result-box">
<div class="flex justify-between items-center mb-2 border-b border-gray-200 pb-2">
<span class="text-xs font-bold text-gray-400 uppercase" id="logic-label">Multiplica Cruzado</span>
<i class="fas fa-calculator text-gray-300"></i>
</div>

<div class="font-mono text-sm md:text-base text-gray-600 space-y-1 text-center">
<div id="step-1">2 ¬∑ x = 10 ¬∑ 5</div>
<div id="step-2">2x = 50</div>
<div id="step-3" class="font-bold text-lg text-brand-text mt-2">x = 25</div>
</div>
</div>

</div>
`;

                    // 2. Seletores
                    const modeBtns = container.querySelectorAll(".mode-btn");
                    const modeBg = container.querySelector("#mode-bg");
                    const scenarioSelect = container.querySelector("#scenario-select");
                    const svg = container.querySelector("#lines-svg");

                    const inpA = container.querySelector("#val-a");
                    const inpB = container.querySelector("#val-b");
                    const inpC = container.querySelector("#val-c");
                    const dispX = container.querySelector("#val-x");

                    const labelU1 = container.querySelector("#label-u1");
                    const labelU2 = container.querySelector("#label-u2");

                    const resultBox = container.querySelector("#result-box");
                    const logicLabel = container.querySelector("#logic-label");
                    const step1 = container.querySelector("#step-1");
                    const step2 = container.querySelector("#step-2");
                    const step3 = container.querySelector("#step-3");

                    // 3. Fun√ß√µes de Desenho e L√≥gica
                    const setMode = (newMode) => {
                        mode = newMode;

                        // UI do Toggle
                        if (mode === "direct") {
                            modeBg.style.left = "4px";
                            modeBtns[0].className =
                                "mode-btn flex-1 py-2 rounded-md text-xs font-bold uppercase z-10 transition-colors text-brand-blue";
                            modeBtns[1].className =
                                "mode-btn flex-1 py-2 rounded-md text-xs font-bold uppercase z-10 transition-colors text-gray-400";
                        } else {
                            modeBg.style.left = "calc(50% + 0px)"; // Ajuste visual
                            modeBtns[0].className =
                                "mode-btn flex-1 py-2 rounded-md text-xs font-bold uppercase z-10 transition-colors text-gray-400";
                            modeBtns[1].className =
                                "mode-btn flex-1 py-2 rounded-md text-xs font-bold uppercase z-10 transition-colors text-brand-orange";
                        }
                        update();
                    };

                    const update = () => {
                        const a = parseFloat(inpA.value) || 1; // Evita div por zero
                        const b = parseFloat(inpB.value) || 0;
                        const c = parseFloat(inpC.value) || 0;
                        let x, s1, s2;

                        const color = mode === "direct" ? "#1CB0F6" : "#FF9600"; // Azul ou Laranja

                        // L√≥gica Matem√°tica
                        if (mode === "direct") {
                            // Regra Direta: A/B = C/x => A*x = B*C => x = (B*C)/A
                            x = (b * c) / a;
                            s1 = `${a} ¬∑ x = ${b} ¬∑ ${c}`;
                            s2 = `${a}x = ${b * c}`;
                            logicLabel.innerText = "Diretamente Proporcional (Cruzado)";

                            // Desenho do X (Cruzado)
                            // Coordenadas relativas do SVG (0,0 a 100%,100%)
                            // Inputs est√£o em posi√ß√µes fixas aproximadas
                            svg.innerHTML = `
<line x1="20%" y1="20%" x2="80%" y2="80%" stroke="${color}" stroke-width="3" stroke-dasharray="8" class="animate-dash" />
<line x1="20%" y1="80%" x2="80%" y2="20%" stroke="${color}" stroke-width="3" stroke-dasharray="8" class="animate-dash" style="animation-delay: 0.5s"/>
<circle cx="80%" cy="80%" r="4" fill="${color}" />
<circle cx="80%" cy="20%" r="4" fill="${color}" />
`;

                            resultBox.className =
                                "w-full max-w-md bg-blue-50 border-2 border-blue-100 rounded-xl p-4 transition-colors duration-300";
                        } else {
                            // Regra Inversa: A*B = C*x => x = (A*B)/C
                            x = (a * b) / c;
                            s1 = `${c} ¬∑ x = ${a} ¬∑ ${b}`;
                            s2 = `${c}x = ${a * b}`;
                            logicLabel.innerText = "Inversamente Proporcional (Reto)";

                            // Desenho do = (Paralelo)
                            svg.innerHTML = `
<line x1="25%" y1="20%" x2="75%" y2="20%" stroke="${color}" stroke-width="3" stroke-dasharray="8" class="animate-dash" />
<line x1="25%" y1="80%" x2="75%" y2="80%" stroke="${color}" stroke-width="3" stroke-dasharray="8" class="animate-dash" />
<circle cx="75%" cy="20%" r="4" fill="${color}" />
<circle cx="75%" cy="80%" r="4" fill="${color}" />
`;

                            resultBox.className =
                                "w-full max-w-md bg-orange-50 border-2 border-orange-100 rounded-xl p-4 transition-colors duration-300";
                        }

                        // Exibir Resultado
                        // Arredonda para 2 casas decimais se necess√°rio
                        const displayX = Number.isInteger(x)
                            ? x
                            : x.toFixed(2).replace(".", ",");
                        dispX.innerText = displayX;
                        dispX.style.color = color;
                        dispX.style.borderColor = color;

                        step1.innerText = s1;
                        step2.innerText = s2;
                        step3.innerText = `x = ${displayX}`;
                        step3.className = `font-bold text-lg mt-2 ${mode === "direct" ? "text-brand-blue" : "text-brand-orange"
                            }`;
                    };

                    // 4. Listeners

                    // Inputs num√©ricos
                    [inpA, inpB, inpC].forEach((el) =>
                        el.addEventListener("input", update)
                    );
                    [labelU1, labelU2].forEach((el) =>
                        el.addEventListener("input", () => { })
                    ); // Apenas permite editar

                    // Bot√µes de Modo
                    modeBtns.forEach((btn) => {
                        btn.onclick = () => setMode(btn.dataset.m);
                    });

                    // Seletor de Cen√°rio
                    scenarioSelect.onchange = () => {
                        const val = scenarioSelect.value;
                        const data = scenarios[val];
                        if (data) {
                            // Atualiza Labels
                            labelU1.value = data.u1;
                            labelU2.value = data.u2;

                            // Atualiza Valores
                            inpA.value = data.v1;
                            inpB.value = data.v2;
                            inpC.value = data.v3;

                            // Atualiza Modo (se definido no preset)
                            if (data.mode) setMode(data.mode);
                            else update();
                        }
                    };

                    // CSS Inline para anima√ß√£o das linhas
                    if (!document.getElementById("anim-dash")) {
                        const style = document.createElement("style");
                        style.id = "anim-dash";
                        style.innerHTML = `
@keyframes dash { to { stroke-dashoffset: -16; } }
.animate-dash { animation: dash 1s linear infinite; }
`;
                        container.appendChild(style);
                    }

                    // Init
                    update();
                },

                interactive_square_sum(container) {
                    // Estado inicial
                    let state = { a: 3, b: 2 };

                    // Configura√ß√£o de Cores
                    const styles = {
                        a: {
                            bg: "fill-brand-blue",
                            text: "text-brand-blue",
                            stroke: "stroke-brand-blue",
                        },
                        b: {
                            bg: "fill-brand-orange",
                            text: "text-brand-orange",
                            stroke: "stroke-brand-orange",
                        },
                        ab: {
                            bg: "fill-brand-purple",
                            text: "text-brand-purple",
                            stroke: "stroke-brand-purple",
                        },
                    };

                    // 1. INJE√á√ÉO DO HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-6">O Quadrado da Soma: $(a+b)^2$</h3>

<div class="flex flex-col md:flex-row items-start gap-10 w-full justify-center">

<div class="relative flex flex-col items-center">
<svg id="geo-canvas" width="260" height="260" viewBox="0 0 260 260" class="overflow-visible">
<rect id="rect-a2" x="0" y="0" class="${styles.a.bg} fill-opacity-20 ${styles.a.stroke}" stroke-width="2" />
<rect id="rect-ab1" class="${styles.ab.bg} fill-opacity-20 ${styles.ab.stroke}" stroke-width="2" />
<rect id="rect-ab2" class="${styles.ab.bg} fill-opacity-20 ${styles.ab.stroke}" stroke-width="2" />
<rect id="rect-b2" class="${styles.b.bg} fill-opacity-20 ${styles.b.stroke}" stroke-width="2" />

<text id="lbl-a2" class="text-sm font-bold fill-brand-blue pointer-events-none" text-anchor="middle" dominant-baseline="middle">a¬≤</text>
<text id="lbl-ab1" class="text-sm font-bold fill-brand-purple pointer-events-none" text-anchor="middle" dominant-baseline="middle">ab</text>
<text id="lbl-ab2" class="text-sm font-bold fill-brand-purple pointer-events-none" text-anchor="middle" dominant-baseline="middle">ab</text>
<text id="lbl-b2" class="text-sm font-bold fill-brand-orange pointer-events-none" text-anchor="middle" dominant-baseline="middle">b¬≤</text>

<text id="dim-a-top" y="-10" class="text-xs font-bold fill-brand-blue" text-anchor="middle">a</text>
<text id="dim-b-top" y="-10" class="text-xs font-bold fill-brand-orange" text-anchor="middle">b</text>
<text id="dim-a-left" x="-15" class="text-xs font-bold fill-brand-blue" text-anchor="end" dominant-baseline="middle">a</text>
<text id="dim-b-left" x="-15" class="text-xs font-bold fill-brand-orange" text-anchor="end" dominant-baseline="middle">b</text>
</svg>
</div>

<div class="flex flex-col gap-6 w-full max-w-xs">

<div class="bg-gray-50 p-4 rounded-xl border border-gray-200 space-y-4">
<div>
<div class="flex justify-between text-xs font-bold uppercase mb-1">
<span class="text-brand-blue">Valor de A</span>
<span id="val-a" class="text-brand-blue font-mono text-lg">3</span>
</div>
<input type="range" id="range-a" min="1" max="5" value="3" class="w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer accent-brand-blue">
</div>
<div>
<div class="flex justify-between text-xs font-bold uppercase mb-1">
<span class="text-brand-orange">Valor de B</span>
<span id="val-b" class="text-brand-orange font-mono text-lg">2</span>
</div>
<input type="range" id="range-b" min="1" max="5" value="2" class="w-full h-2 bg-orange-100 rounded-lg appearance-none cursor-pointer accent-brand-orange">
</div>
</div>

<div class="text-center font-mono space-y-2">
<div class="text-lg text-gray-400 font-bold mb-2">Substituindo:</div>

<div class="bg-white border-2 border-brand-gray rounded-lg p-3 shadow-inner">
<span class="text-xl">
(<strong class="text-brand-blue" id="form-a">3</strong> + <strong class="text-brand-orange" id="form-b">2</strong>)¬≤
</span>
</div>

<div class="text-2xl font-bold text-gray-300">‚Üì</div>

<div class="bg-white border-2 border-brand-gray rounded-lg p-3 shadow-inner flex flex-wrap justify-center gap-1 text-lg md:text-xl font-bold">
<span class="text-brand-blue" id="res-a2">9</span>
<span class="text-gray-400">+</span>
<span class="text-brand-purple" id="res-2ab">12</span>
<span class="text-gray-400">+</span>
<span class="text-brand-orange" id="res-b2">4</span>
<span class="text-gray-400">=</span>
<span class="text-brand-green" id="res-total">25</span>
</div>

<div class="text-[10px] text-gray-400 uppercase font-bold mt-1 flex justify-center gap-4">
<span class="text-brand-blue">a¬≤</span>
<span class="text-brand-purple">2ab</span>
<span class="text-brand-orange">b¬≤</span>
</div>
</div>

</div>
</div>
</div>
`;

                    // 2. SELETORES
                    const rA = container.querySelector("#range-a");
                    const rB = container.querySelector("#range-b");
                    const vA = container.querySelector("#val-a");
                    const vB = container.querySelector("#val-b");

                    // SVG Elements
                    const rectA2 = container.querySelector("#rect-a2");
                    const rectAb1 = container.querySelector("#rect-ab1");
                    const rectAb2 = container.querySelector("#rect-ab2");
                    const rectB2 = container.querySelector("#rect-b2");

                    const lblA2 = container.querySelector("#lbl-a2");
                    const lblAb1 = container.querySelector("#lbl-ab1");
                    const lblAb2 = container.querySelector("#lbl-ab2");
                    const lblB2 = container.querySelector("#lbl-b2");

                    const dimATop = container.querySelector("#dim-a-top");
                    const dimBTop = container.querySelector("#dim-b-top");
                    const dimALeft = container.querySelector("#dim-a-left");
                    const dimBLeft = container.querySelector("#dim-b-left");

                    // Formula Elements
                    const formA = container.querySelector("#form-a");
                    const formB = container.querySelector("#form-b");
                    const resA2 = container.querySelector("#res-a2");
                    const res2ab = container.querySelector("#res-2ab");
                    const resB2 = container.querySelector("#res-b2");
                    const resTotal = container.querySelector("#res-total");

                    // 3. L√ìGICA DE ATUALIZA√á√ÉO
                    const update = () => {
                        const a = parseInt(rA.value);
                        const b = parseInt(rB.value);

                        // Atualiza Textos de Controle
                        vA.innerText = a;
                        vB.innerText = b;

                        // Escala para o SVG (1 unidade = 30px)
                        const scale = 30;
                        const sizeA = a * scale;
                        const sizeB = b * scale;

                        // --- ATUALIZA SVG ---

                        // 1. Quadrado A¬≤ (Topo Esquerda)
                        rectA2.setAttribute("width", sizeA);
                        rectA2.setAttribute("height", sizeA);

                        // 2. Ret√¢ngulo AB1 (Topo Direita)
                        rectAb1.setAttribute("x", sizeA);
                        rectAb1.setAttribute("y", 0);
                        rectAb1.setAttribute("width", sizeB);
                        rectAb1.setAttribute("height", sizeA);

                        // 3. Ret√¢ngulo AB2 (Baixo Esquerda)
                        rectAb2.setAttribute("x", 0);
                        rectAb2.setAttribute("y", sizeA);
                        rectAb2.setAttribute("width", sizeA);
                        rectAb2.setAttribute("height", sizeB);

                        // 4. Quadrado B¬≤ (Baixo Direita)
                        rectB2.setAttribute("x", sizeA);
                        rectB2.setAttribute("y", sizeA);
                        rectB2.setAttribute("width", sizeB);
                        rectB2.setAttribute("height", sizeB);

                        // Posiciona Labels (Centro das formas)
                        const setLabelPos = (el, x, y) => {
                            el.setAttribute("x", x);
                            el.setAttribute("y", y);
                        };

                        setLabelPos(lblA2, sizeA / 2, sizeA / 2);
                        setLabelPos(lblAb1, sizeA + sizeB / 2, sizeA / 2);
                        setLabelPos(lblAb2, sizeA / 2, sizeA + sizeB / 2);
                        setLabelPos(lblB2, sizeA + sizeB / 2, sizeA + sizeB / 2);

                        // Atualiza Texto dos Labels (√Årea)
                        lblA2.textContent = a * a;
                        lblAb1.textContent = a * b;
                        lblAb2.textContent = a * b;
                        lblB2.textContent = b * b;

                        // Posiciona Dimens√µes Externas
                        dimATop.setAttribute("x", sizeA / 2);
                        dimATop.textContent = a;

                        dimBTop.setAttribute("x", sizeA + sizeB / 2);
                        dimBTop.textContent = b;

                        dimALeft.setAttribute("y", sizeA / 2);
                        dimALeft.textContent = a;

                        dimBLeft.setAttribute("y", sizeA + sizeB / 2);
                        dimBLeft.textContent = b;

                        // --- ATUALIZA F√ìRMULA ---
                        formA.innerText = a;
                        formB.innerText = b;

                        resA2.innerText = a * a;
                        res2ab.innerText = 2 * (a * b); // Soma dos dois ret√¢ngulos roxos
                        resB2.innerText = b * b;
                        resTotal.innerText = Math.pow(a + b, 2);
                    };

                    // 4. LISTENERS
                    rA.addEventListener("input", update);
                    rB.addEventListener("input", update);

                    // Init
                    update();
                },

                interactive_system_steps(container) {
                    // Estado
                    let currentStep = 0;

                    // Dados do Sistema (Exemplo fixo did√°tico: x+y=6 e x-y=2)
                    // Solu√ß√£o: x=4, y=2
                    const systemData = {
                        eq1: { x: 1, y: 1, r: 6 },
                        eq2: { x: 1, y: -1, r: 2 },
                    };

                    // Passos da Anima√ß√£o
                    const steps = [
                        {
                            id: 0,
                            btn: "Somar as Equa√ß√µes (+)",
                            text: "O M√©todo da Adi√ß√£o consiste em somar as duas equa√ß√µes verticalmente para eliminar uma letra.",
                        },
                        {
                            id: 1,
                            btn: "Calcular X",
                            text: "O Y foi eliminado! Agora temos uma equa√ß√£o simples de 1¬∫ grau.",
                        },
                        {
                            id: 2,
                            btn: "Substituir X na 1¬™ Eq.",
                            text: "J√° sabemos que X vale 4. Vamos trocar o X pelo 4 na primeira equa√ß√£o.",
                        },
                        {
                            id: 3,
                            btn: "Calcular Y",
                            text: "Agora resolvemos a equa√ß√£o para encontrar o valor de Y.",
                        },
                        {
                            id: 4,
                            btn: "Reiniciar",
                            text: "Parab√©ns! Encontramos o par ordenado (4, 2).",
                        },
                    ];

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-2">M√©todo da Adi√ß√£o</h3>

<div class="relative bg-gray-50 border-2 border-gray-200 rounded-xl p-6 mb-6 w-full max-w-sm min-h-[200px] flex flex-col justify-center items-center transition-all duration-500" id="board">

<div id="bracket" class="absolute left-4 top-1/2 -translate-y-1/2 text-6xl font-light text-gray-300 transform scale-y-150">{</div>

<div class="flex flex-col gap-4 text-2xl font-mono font-bold w-full pl-8" id="equations-area">
<div id="row-1" class="flex items-center gap-2 transition-all duration-500">
<span class="text-brand-purple">x</span>
<span class="text-gray-400">+</span>
<span class="text-brand-orange" id="y1">y</span>
<span class="text-gray-400">=</span>
<span>6</span>
</div>

<div id="sum-line" class="w-full h-0.5 bg-gray-300 opacity-0 transition-opacity"></div>

<div id="row-2" class="flex items-center gap-2 transition-all duration-500">
<span class="text-brand-purple">x</span>
<span class="text-gray-400">-</span>
<span class="text-brand-orange" id="y2">y</span>
<span class="text-gray-400">=</span>
<span>2</span>
</div>

<div id="row-res" class="hidden text-brand-text mt-2 border-t-2 border-gray-800 pt-2">
</div>
</div>
</div>

<div class="bg-blue-50 border border-blue-100 rounded-lg p-3 mb-4 text-sm text-brand-blue text-center w-full max-w-sm min-h-[60px] flex items-center justify-center">
<span id="step-desc" class="animate-fade-in">${steps[0].text}</span>
</div>

<button id="next-btn" class="bg-brand-purple hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-xl shadow-btn active:shadow-none active:translate-y-1 transition-all w-full max-w-xs flex items-center justify-center gap-2">
<i class="fas fa-arrow-down"></i>
<span id="btn-text">${steps[0].btn}</span>
</button>

</div>
`;

                    // 2. Seletores
                    const board = container.querySelector("#board");
                    const row1 = container.querySelector("#row-1");
                    const row2 = container.querySelector("#row-2");
                    const rowRes = container.querySelector("#row-res");
                    const sumLine = container.querySelector("#sum-line");
                    const bracket = container.querySelector("#bracket");

                    const y1 = container.querySelector("#y1");
                    const y2 = container.querySelector("#y2");

                    const btn = container.querySelector("#next-btn");
                    const btnText = container.querySelector("#btn-text");
                    const stepDesc = container.querySelector("#step-desc");

                    // 3. L√≥gica de Passos
                    const updateStep = () => {
                        // Atualiza Textos
                        const s = steps[currentStep];
                        btnText.innerText = s.btn;
                        stepDesc.innerHTML = s.text; // innerHTML para permitir bold se precisar

                        // L√≥gica Visual por Passo
                        if (currentStep === 0) {
                            // RESET
                            rowRes.classList.add("hidden");
                            rowRes.innerHTML = "";
                            row1.style.opacity = "1";
                            row2.style.opacity = "1";
                            sumLine.style.opacity = "0";
                            bracket.style.opacity = "1";

                            // Restaura HTML original das linhas
                            row1.innerHTML = `<span class="text-brand-purple">x</span> <span class="text-gray-400">+</span> <span class="text-brand-orange">y</span> <span class="text-gray-400">=</span> <span>6</span>`;
                            row2.innerHTML = `<span class="text-brand-purple">x</span> <span class="text-gray-400">-</span> <span class="text-brand-orange">y</span> <span class="text-gray-400">=</span> <span>2</span>`;
                        } else if (currentStep === 1) {
                            // SOMAR: Anima√ß√£o de corte do Y
                            sumLine.style.opacity = "1";

                            // Seleciona os Ys atuais para animar
                            const yTerms = container.querySelectorAll(".text-brand-orange");
                            yTerms.forEach((el) => {
                                el.classList.add(
                                    "text-brand-red",
                                    "line-through",
                                    "decoration-4",
                                    "decoration-brand-red",
                                    "opacity-50",
                                    "transition-all"
                                );
                            });

                            // Mostra resultado parcial (2x = 8)
                            setTimeout(() => {
                                rowRes.classList.remove("hidden");
                                rowRes.innerHTML = `<div class="flex items-center gap-2 animate-pop-in"><span class="text-brand-purple font-black">2x</span> <span class="text-gray-300 ml-8">=</span> <span class="font-black">8</span></div>`;
                            }, 500);
                        } else if (currentStep === 2) {
                            // CALCULAR X
                            // Some com as equa√ß√µes de cima para focar no resultado
                            row1.style.opacity = "0.1";
                            row2.style.opacity = "0.1";
                            sumLine.style.opacity = "0.1";
                            bracket.style.opacity = "0.1";

                            // Transforma 2x=8 em x=4
                            rowRes.innerHTML = `
<div class="flex flex-col items-center animate-slide-up">
<div class="text-gray-400 text-sm mb-1">8 √∑ 2</div>
<div class="text-3xl font-black text-brand-purple border-2 border-brand-purple px-4 py-2 rounded-lg bg-purple-50">x = 4</div>
</div>
`;
                        } else if (currentStep === 3) {
                            // SUBSTITUIR X
                            // Limpa a lousa e traz a Eq 1
                            row2.classList.add("hidden");
                            sumLine.classList.add("hidden");
                            bracket.classList.add("hidden");
                            rowRes.classList.add("hidden");

                            row1.style.opacity = "1";
                            row1.classList.add("scale-110", "mb-4"); // Destaque

                            // Anima√ß√£o: X vira 4
                            row1.innerHTML = `<span class="text-brand-purple font-black bg-purple-100 px-2 rounded animate-pulse">x</span> <span class="text-gray-400">+</span> <span class="text-brand-orange">y</span> <span class="text-gray-400">=</span> <span>6</span>`;

                            setTimeout(() => {
                                row1.innerHTML = `<span class="text-brand-purple font-black animate-pop-in">4</span> <span class="text-gray-400">+</span> <span class="text-brand-orange">y</span> <span class="text-gray-400">=</span> <span>6</span>`;
                            }, 800);
                        } else if (currentStep === 4) {
                            // CALCULAR Y
                            // Mostra passo final: y = 6 - 4
                            row1.innerHTML = `
<div class="flex flex-col items-center animate-slide-up gap-2">
<div class="flex items-center gap-2 text-gray-400">
<span class="text-brand-orange">y</span> = 6 - <span class="text-brand-purple">4</span>
</div>
<div class="text-3xl font-black text-brand-orange border-2 border-brand-orange px-4 py-2 rounded-lg bg-orange-50">y = 2</div>
</div>
`;

                            // Mostra Solu√ß√£o Final
                            setTimeout(() => {
                                rowRes.classList.remove("hidden");
                                rowRes.innerHTML = `<div class="text-center mt-4 font-bold text-gray-600 animate-pop-in">S = { (<span class="text-brand-purple">4</span>, <span class="text-brand-orange">2</span>) }</div>`;
                            }, 800);

                            // Muda bot√£o para reiniciar
                            btn.classList.replace("bg-brand-purple", "bg-brand-green");
                        }
                    };

                    // 4. Listener
                    btn.onclick = () => {
                        currentStep++;
                        if (currentStep >= steps.length) {
                            currentStep = 0;
                            // Reseta classes e estilos manuais
                            btn.classList.replace("bg-brand-green", "bg-brand-purple");
                            row2.classList.remove("hidden");
                            sumLine.classList.remove("hidden");
                            bracket.classList.remove("hidden");
                            row1.classList.remove("scale-110", "mb-4");
                        }
                        updateStep();
                    };

                    // Init
                    // updateStep(); // J√° come√ßa no estado 0 pelo HTML est√°tico
                },

                interactive_combinatorics(container) {
                    // Estado
                    let state = {
                        shirts: 2, // Max 4
                        pants: 3, // Max 4
                    };

                    // Cores
                    const cShirt = "text-brand-blue";
                    const cPants = "text-brand-orange";
                    const bgShirt = "bg-blue-100";
                    const bgPants = "bg-orange-100";

                    // 1. INJE√á√ÉO DO HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-6">Princ√≠pio Fundamental da Contagem</h3>

<div class="flex flex-col md:flex-row items-center gap-8 w-full justify-center mb-8 bg-gray-50 p-4 rounded-xl border border-gray-200">

<div class="flex flex-col items-center gap-2">
<span class="text-[10px] font-bold uppercase text-gray-400">Op√ß√µes de Camisetas</span>
<div class="flex items-center gap-2">
<button id="btn-shirt-minus" class="w-8 h-8 rounded-full bg-white border-2 border-brand-blue text-brand-blue font-bold hover:bg-blue-50">-</button>
<span class="text-2xl font-black ${cShirt}" id="val-shirts">2</span>
<button id="btn-shirt-plus" class="w-8 h-8 rounded-full bg-brand-blue border-2 border-brand-blue text-white font-bold hover:bg-blue-600 shadow-sm">+</button>
</div>
</div>

<span class="text-2xl font-black text-gray-300">√ó</span>

<div class="flex flex-col items-center gap-2">
<span class="text-[10px] font-bold uppercase text-gray-400">Op√ß√µes de Cal√ßas</span>
<div class="flex items-center gap-2">
<button id="btn-pants-minus" class="w-8 h-8 rounded-full bg-white border-2 border-brand-orange text-brand-orange font-bold hover:bg-orange-50">-</button>
<span class="text-2xl font-black ${cPants}" id="val-pants">3</span>
<button id="btn-pants-plus" class="w-8 h-8 rounded-full bg-brand-orange border-2 border-brand-orange text-white font-bold hover:bg-orange-600 shadow-sm">+</button>
</div>
</div>

<span class="text-2xl font-black text-gray-300">=</span>

<div class="flex flex-col items-center">
<span class="text-[10px] font-bold uppercase text-gray-400">Combina√ß√µes</span>
<span class="text-4xl font-black text-brand-green" id="val-total">6</span>
</div>
</div>

<div class="w-full overflow-x-auto">
<div class="relative min-w-[300px] h-[400px] bg-white border-2 border-dashed border-gray-200 rounded-xl" id="tree-container">
<svg id="tree-lines" class="absolute inset-0 w-full h-full pointer-events-none z-0">
</svg>

<div id="tree-nodes" class="absolute inset-0 w-full h-full z-10"></div>
</div>
</div>

<p class="text-center text-xs text-gray-400 mt-2 italic">Acompanhe as linhas para ver cada look poss√≠vel!</p>
</div>
`;

                    // 2. SELETORES
                    const valShirts = container.querySelector("#val-shirts");
                    const valPants = container.querySelector("#val-pants");
                    const valTotal = container.querySelector("#val-total");

                    const treeLines = container.querySelector("#tree-lines");
                    const treeNodes = container.querySelector("#tree-nodes");

                    // 3. FUN√á√ÉO DE DESENHO DA √ÅRVORE
                    const renderTree = () => {
                        treeLines.innerHTML = "";
                        treeNodes.innerHTML = "";

                        const total = state.shirts * state.pants;
                        const containerH = 400;
                        const containerW = treeNodes.offsetWidth || 300;

                        // Configura√ß√£o de Espa√ßamento
                        // Raiz (Voc√™) -> N√≠vel 1 (Camisas) -> N√≠vel 2 (Cal√ßas)
                        const xRoot = 20;
                        const xL1 = containerW * 0.4; // Coluna Camisas
                        const xL2 = containerW * 0.8; // Coluna Cal√ßas

                        // 1. Desenhar N√≥ Raiz (Voc√™)
                        const rootY = containerH / 2;
                        createNode(
                            xRoot,
                            rootY,
                            "fas fa-user",
                            "bg-gray-200 text-gray-500",
                            "Voc√™"
                        );

                        // Altura dispon√≠vel para dividir as camisas
                        const shirtGap = containerH / (state.shirts + 1);

                        for (let i = 1; i <= state.shirts; i++) {
                            const shirtY = shirtGap * i;

                            // Linha Raiz -> Camisa
                            createLine(xRoot + 15, rootY, xL1 - 15, shirtY, "#1CB0F6"); // Azul

                            // N√≥ Camisa
                            createNode(
                                xL1,
                                shirtY,
                                "fas fa-tshirt",
                                "bg-blue-100 text-brand-blue border-brand-blue",
                                `C${i}`
                            );

                            // Para cada camisa, desenhar as cal√ßas
                            // O espa√ßo das cal√ßas deve ser "local" √† camisa para n√£o cruzar feio
                            // Mas para ficar bonito, distribu√≠mos todas as cal√ßas uniformemente na vertical final
                            // Por√©m, a √°rvore cl√°ssica agrupa por ramo. Vamos agrupar.

                            // Altura dispon√≠vel para este sub-grupo
                            // Vamos calcular a posi√ß√£o Y absoluta de cada folha final para ficar uniforme
                        }

                        // --- Abordagem Melhorada de Layout ---
                        // Vamos iterar sobre o total de folhas (Combina√ß√µes finais) para saber onde colocar as cal√ßas
                        // Cada cal√ßa ocupa um slot vertical final.
                        const slotHeight = containerH / (total + 1); // Altura de cada combina√ß√£o final
                        let currentSlot = 1;

                        for (let i = 1; i <= state.shirts; i++) {
                            // Posi√ß√£o Y da Camisa: M√©dia das posi√ß√µes Y das suas cal√ßas filhas
                            // As cal√ßas dessa camisa v√£o dos slots 'currentSlot' at√© 'currentSlot + pants - 1'

                            const startSlot = currentSlot;
                            const endSlot = currentSlot + state.pants - 1;

                            // Y das cal√ßas
                            const pantsYs = [];
                            for (let p = 0; p < state.pants; p++) {
                                const y = (currentSlot + p) * slotHeight;
                                pantsYs.push(y);
                            }

                            // Y da Camisa (Centro das suas filhas)
                            const shirtY = (pantsYs[0] + pantsYs[pantsYs.length - 1]) / 2;

                            // Desenha Linha Raiz -> Camisa
                            createLine(xRoot + 20, rootY, xL1 - 20, shirtY, "#E5E5E5", 2);

                            // Desenha N√≥ Camisa
                            createNode(
                                xL1,
                                shirtY,
                                "fas fa-tshirt",
                                "bg-white border-2 border-brand-blue text-brand-blue z-20",
                                `C${i}`
                            );

                            // Desenha Cal√ßas e Linhas
                            pantsYs.forEach((y, idx) => {
                                // Linha Camisa -> Cal√ßa
                                createLine(xL1 + 20, shirtY, xL2 - 20, y, "#FF9600", 1.5); // Laranja

                                // N√≥ Cal√ßa
                                // Usamos √≠cone de 'bars' ou 'socks' para representar parte de baixo, ou um quadrado
                                // FontAwesome 'fa-running' ou apenas um quadrado colorido
                                const pIndex = idx + 1;

                                // Cria n√≥ da cal√ßa
                                const node = document.createElement("div");
                                node.className = `absolute flex items-center gap-2 transform -translate-x-1/2 -translate-y-1/2 animate-pop-in`;
                                node.style.left = `${xL2}px`;
                                node.style.top = `${y}px`;
                                node.style.animationDelay = `${i * 0.1 + idx * 0.05}s`;

                                node.innerHTML = `
<div class="w-8 h-8 rounded-full bg-white border-2 border-brand-orange text-brand-orange flex items-center justify-center shadow-sm z-10">
<span class="text-xs font-bold">${pIndex}</span>
</div>
<span class="text-[10px] font-bold text-gray-400 whitespace-nowrap">Look ${i}-${pIndex}</span>
`;
                                treeNodes.appendChild(node);
                            });

                            currentSlot += state.pants;
                        }
                    };

                    // Helpers de SVG e DOM
                    const createLine = (x1, y1, x2, y2, color, width) => {
                        // Curva de B√©zier para ficar elegante
                        // Control points: Metade do caminho em X
                        const cp1x = x1 + (x2 - x1) / 2;
                        const cp2x = x1 + (x2 - x1) / 2;

                        const path = document.createElementNS(
                            "http://www.w3.org/2000/svg",
                            "path"
                        );
                        const d = `M ${x1} ${y1} C ${cp1x} ${y1}, ${cp2x} ${y2}, ${x2} ${y2}`;

                        path.setAttribute("d", d);
                        path.setAttribute("fill", "none");
                        path.setAttribute("stroke", color);
                        path.setAttribute("stroke-width", width);
                        path.setAttribute("stroke-linecap", "round");
                        treeLines.appendChild(path);
                    };

                    const createNode = (x, y, icon, classes, label) => {
                        const el = document.createElement("div");
                        el.className = `absolute w-10 h-10 rounded-full flex flex-col items-center justify-center shadow-md transform -translate-x-1/2 -translate-y-1/2 ${classes}`;
                        el.style.left = `${x}px`;
                        el.style.top = `${y}px`;
                        el.innerHTML = `<i class="${icon}"></i>`;

                        // Label flutuante
                        if (label) {
                            const lbl = document.createElement("span");
                            lbl.className =
                                "absolute -bottom-4 text-[10px] font-bold text-gray-400 whitespace-nowrap";
                            lbl.innerText = label;
                            el.appendChild(lbl);
                        }
                        treeNodes.appendChild(el);
                    };

                    // 4. L√ìGICA DE ATUALIZA√á√ÉO
                    const update = () => {
                        // Atualiza Textos
                        valShirts.innerText = state.shirts;
                        valPants.innerText = state.pants;
                        valTotal.innerText = state.shirts * state.pants;

                        // Redesenha √Årvore
                        renderTree();
                    };

                    // 5. LISTENERS
                    const limitS = 4;
                    const limitP = 3; // Mantemos baixo para n√£o estourar a tela visualmente (4x3 = 12 ramos)

                    container.querySelector("#btn-shirt-plus").onclick = () => {
                        if (state.shirts < limitS) {
                            state.shirts++;
                            update();
                        }
                    };
                    container.querySelector("#btn-shirt-minus").onclick = () => {
                        if (state.shirts > 1) {
                            state.shirts--;
                            update();
                        }
                    };

                    container.querySelector("#btn-pants-plus").onclick = () => {
                        if (state.pants < limitP) {
                            state.pants++;
                            update();
                        }
                    };
                    container.querySelector("#btn-pants-minus").onclick = () => {
                        if (state.pants > 1) {
                            state.pants--;
                            update();
                        }
                    };

                    // Init
                    update();
                },

                interactive_quad_builder(container) {
                    // Estado
                    let isRect = false;
                    let isRhombus = false;

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Laborat√≥rio de Quadril√°teros</h3>

<div class="relative w-64 h-48 bg-gray-50 rounded-xl border border-gray-200 mb-6 flex items-center justify-center overflow-hidden transition-colors duration-500" id="canvas-bg">
<svg width="200" height="150" viewBox="0 0 200 150" class="overflow-visible transition-all duration-700" id="quad-svg">
<path id="quad-path" d="M 50 100 L 150 100 L 180 50 L 80 50 Z" fill="rgba(206, 130, 255, 0.2)" stroke="#CE82FF" stroke-width="4" stroke-linejoin="round" class="transition-all duration-700" />

<g id="right-angles" class="opacity-0 transition-opacity duration-500">
<rect x="50" y="90" width="10" height="10" fill="none" stroke="#1CB0F6" stroke-width="2" />
<rect x="140" y="90" width="10" height="10" fill="none" stroke="#1CB0F6" stroke-width="2" />
<rect x="140" y="50" width="10" height="10" fill="none" stroke="#1CB0F6" stroke-width="2" />
<rect x="50" y="50" width="10" height="10" fill="none" stroke="#1CB0F6" stroke-width="2" />
</g>

<g id="equal-sides" class="opacity-0 transition-opacity duration-500 stroke-brand-orange" stroke-width="2">
<line x1="95" y1="95" x2="105" y2="105" />
<line x1="100" y1="95" x2="110" y2="105" />
<line x1="95" y1="45" x2="105" y2="55" />
<line x1="100" y1="45" x2="110" y2="55" />
<line x1="45" y1="70" x2="55" y2="80" />
<line x1="50" y1="70" x2="60" y2="80" />
<line x1="145" y1="70" x2="155" y2="80" />
<line x1="150" y1="70" x2="160" y2="80" />
</g>
</svg>
</div>

<div class="mb-6 text-center">
<span class="text-xs font-bold text-gray-400 uppercase">Figura Atual</span>
<h2 id="shape-name" class="text-2xl font-black text-gray-700 transition-all">Paralelogramo</h2>
</div>

<div class="flex gap-4 w-full max-w-sm">

<button id="btn-rect" class="flex-1 bg-white border-2 border-brand-blue text-gray-400 p-3 rounded-xl shadow-sm hover:bg-blue-50 active:scale-95 transition-all flex flex-col items-center gap-2 group">
<i class="far fa-square text-2xl group-hover:text-brand-blue transition-colors"></i>
<span class="text-[10px] font-bold uppercase leading-tight">Endireitar<br>(√Çngulos Retos)</span>
</button>

<button id="btn-rhombus" class="flex-1 bg-white border-2 border-brand-orange text-gray-400 p-3 rounded-xl shadow-sm hover:bg-orange-50 active:scale-95 transition-all flex flex-col items-center gap-2 group">
<i class="fas fa-ruler-combined text-2xl group-hover:text-brand-orange transition-colors"></i>
<span class="text-[10px] font-bold uppercase leading-tight">Igualar<br>(Lados Iguais)</span>
</button>

</div>

<p class="mt-4 text-xs text-center text-gray-400 italic" id="hint-text">Adicione poderes √† figura!</p>

</div>
`;

                    // 2. Seletores
                    const path = container.querySelector("#quad-path");
                    const gAngles = container.querySelector("#right-angles");
                    const gSides = container.querySelector("#equal-sides");
                    const shapeName = container.querySelector("#shape-name");
                    const canvasBg = container.querySelector("#canvas-bg");
                    const btnRect = container.querySelector("#btn-rect");
                    const btnRhombus = container.querySelector("#btn-rhombus");
                    const hintText = container.querySelector("#hint-text");

                    // 3. Renderiza√ß√£o
                    const update = () => {
                        // Coordenadas Base (Paralelogramo)
                        // Base: 100px. Altura: 50px. Skew: 30px.

                        // L√≥gica de Transforma√ß√£o
                        // Se isRect: Skew vira 0.
                        // Se isRhombus: Altura aumenta para igualar o lado inclinado ou base diminui.
                        // Vamos manter a √°rea visual mais ou menos constante.

                        let skew = isRect ? 0 : 30;
                        let base = 100;
                        let height = 50;

                        if (isRhombus) {
                            // Para ser losango (lados iguais), precisamos ajustar.
                            // Simplifica√ß√£o visual: Transformamos em quadrado (se reto) ou losango cl√°ssico
                            if (isRect) {
                                base = 80;
                                height = 80; // Quadrado
                            } else {
                                base = 80;
                                height = 80; // Losango visual (o path cuida do formato)
                            }
                        }

                        // Pontos SVG (Centralizados em 200x150)
                        const cx = 100,
                            cy = 75;
                        const halfW = base / 2;
                        const halfH = height / 2;

                        const p1 = { x: cx - halfW + skew / 2, y: cy + halfH }; // Bottom Left
                        const p2 = { x: cx + halfW + skew / 2, y: cy + halfH }; // Bottom Right
                        const p3 = { x: cx + halfW - skew / 2, y: cy - halfH }; // Top Right
                        const p4 = { x: cx - halfW - skew / 2, y: cy - halfH }; // Top Left

                        const d = `M ${p1.x} ${p1.y} L ${p2.x} ${p2.y} L ${p3.x} ${p3.y} L ${p4.x} ${p4.y} Z`;
                        path.setAttribute("d", d);

                        // Atualiza Estilos dos Bot√µes e Gr√°ficos
                        if (isRect) {
                            btnRect.classList.add(
                                "bg-blue-100",
                                "text-brand-blue",
                                "border-brand-blue"
                            );
                            btnRect.classList.remove("bg-white", "text-gray-400");
                            gAngles.classList.remove("opacity-0");

                            // Ajusta posi√ß√£o dos angulos retos
                            const rects = gAngles.querySelectorAll("rect");
                            rects[0].setAttribute("x", p1.x);
                            rects[0].setAttribute("y", p1.y - 10);
                            rects[1].setAttribute("x", p2.x - 10);
                            rects[1].setAttribute("y", p2.y - 10);
                            rects[2].setAttribute("x", p3.x - 10);
                            rects[2].setAttribute("y", p3.y);
                            rects[3].setAttribute("x", p4.x);
                            rects[3].setAttribute("y", p4.y);
                        } else {
                            btnRect.classList.remove("bg-blue-100", "text-brand-blue");
                            btnRect.classList.add("bg-white", "text-gray-400");
                            gAngles.classList.add("opacity-0");
                        }

                        if (isRhombus) {
                            btnRhombus.classList.add(
                                "bg-orange-100",
                                "text-brand-orange",
                                "border-brand-orange"
                            );
                            btnRhombus.classList.remove("bg-white", "text-gray-400");
                            gSides.classList.remove("opacity-0");

                            // Ajusta marcas (Simplificado: centraliza nas linhas m√©dias)
                            // N√£o vamos recalcular exato pra n√£o complicar o c√≥digo, as posi√ß√µes relativas funcionam bem visualmente no centro
                        } else {
                            btnRhombus.classList.remove(
                                "bg-orange-100",
                                "text-brand-orange"
                            );
                            btnRhombus.classList.add("bg-white", "text-gray-400");
                            gSides.classList.add("opacity-0");
                        }

                        // Determina Nome
                        let name = "Paralelogramo";
                        let color = "text-gray-700";
                        let bg = "bg-gray-50";

                        if (isRect && isRhombus) {
                            name = "QUADRADO";
                            color = "text-brand-purple";
                            bg = "bg-purple-50";
                            hintText.innerText =
                                "A forma perfeita! Tem lados iguais E √¢ngulos retos.";
                        } else if (isRect) {
                            name = "Ret√¢ngulo";
                            color = "text-brand-blue";
                            bg = "bg-blue-50";
                            hintText.innerText = "Tem √¢ngulos retos, mas lados diferentes.";
                        } else if (isRhombus) {
                            name = "Losango";
                            color = "text-brand-orange";
                            bg = "bg-orange-50";
                            hintText.innerText = "Tem lados iguais, mas √© tortinho.";
                        } else {
                            hintText.innerText =
                                "Lados opostos paralelos, mas sem regras especiais.";
                        }

                        shapeName.innerText = name;
                        shapeName.className = `text-2xl font-black transition-all ${color}`;
                        canvasBg.className = `relative w-64 h-48 rounded-xl border-2 border-gray-200 mb-6 flex items-center justify-center overflow-hidden transition-colors duration-500 ${bg}`;

                        path.setAttribute(
                            "stroke",
                            isRect && isRhombus
                                ? "#9B59B6"
                                : isRect
                                    ? "#1CB0F6"
                                    : isRhombus
                                        ? "#FF9600"
                                        : "#CE82FF"
                        );
                        path.setAttribute(
                            "fill",
                            isRect && isRhombus
                                ? "rgba(155, 89, 182, 0.2)"
                                : isRect
                                    ? "rgba(28, 176, 246, 0.2)"
                                    : isRhombus
                                        ? "rgba(255, 150, 0, 0.2)"
                                        : "rgba(206, 130, 255, 0.2)"
                        );
                    };

                    // 4. Listeners
                    btnRect.onclick = () => {
                        isRect = !isRect;
                        update();
                    };
                    btnRhombus.onclick = () => {
                        isRhombus = !isRhombus;
                        update();
                    };

                    // Init
                    update();
                },

                interactive_bhaskara_steps(container) {
                    // Estado
                    let step = 0;
                    let coeffs = { a: 1, b: -5, c: 6 }; // Exemplo cl√°ssico: x¬≤ - 5x + 6 = 0 (x=2, x=3)

                    // Cores
                    const cA = "text-brand-purple";
                    const cB = "text-brand-blue";
                    const cC = "text-brand-orange";
                    const bgA = "bg-purple-50 border-brand-purple";
                    const bgB = "bg-blue-50 border-brand-blue";
                    const bgC = "bg-orange-50 border-brand-orange";

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-6">A Receita de Bh√°skara</h3>

<div class="flex flex-wrap items-center justify-center gap-2 mb-8 bg-gray-50 p-4 rounded-xl border border-gray-200 w-full max-w-lg transition-all duration-500" id="input-area">

<div class="flex flex-col items-center">
<label class="text-[10px] font-bold text-gray-400 uppercase mb-1">a</label>
<input type="number" id="in-a" value="1" class="w-14 text-center border-2 border-gray-300 rounded-lg p-2 font-bold text-xl outline-none focus:${cA.replace(
                        "text-",
                        "border-"
                    )} ${cA} transition-colors">
</div>
<span class="text-xl font-black text-gray-400 mt-4">x¬≤ +</span>

<div class="flex flex-col items-center">
<label class="text-[10px] font-bold text-gray-400 uppercase mb-1">b</label>
<input type="number" id="in-b" value="-5" class="w-14 text-center border-2 border-gray-300 rounded-lg p-2 font-bold text-xl outline-none focus:${cB.replace(
                        "text-",
                        "border-"
                    )} ${cB} transition-colors">
</div>
<span class="text-xl font-black text-gray-400 mt-4">x +</span>

<div class="flex flex-col items-center">
<label class="text-[10px] font-bold text-gray-400 uppercase mb-1">c</label>
<input type="number" id="in-c" value="6" class="w-14 text-center border-2 border-gray-300 rounded-lg p-2 font-bold text-xl outline-none focus:${cC.replace(
                        "text-",
                        "border-"
                    )} ${cC} transition-colors">
</div>
<span class="text-xl font-black text-gray-400 mt-4">= 0</span>

<button id="btn-start" class="ml-4 bg-brand-green text-white w-12 h-12 rounded-full shadow-lg hover:scale-110 active:scale-95 transition-all flex items-center justify-center">
<i class="fas fa-play"></i>
</button>
</div>

<div id="steps-display" class="w-full max-w-lg hidden flex-col gap-4">

<div class="bg-white border-2 border-brand-text rounded-xl p-6 shadow-md relative overflow-hidden transition-all duration-500" id="card-step">
<div class="absolute top-0 left-0 w-2 h-full bg-brand-text" id="step-bar"></div>
<div class="pl-4">
<h4 class="text-sm font-bold text-gray-400 uppercase mb-2" id="step-title">Passo 1: O Delta</h4>
<div class="text-2xl md:text-3xl font-mono font-bold text-brand-text break-words leading-relaxed" id="math-content">
</div>
<p class="text-sm text-gray-500 mt-4 italic" id="step-desc">Substituindo os valores na f√≥rmula do discriminante.</p>
</div>
</div>

<div class="flex justify-between items-center mt-2">
<button id="btn-reset" class="text-gray-400 font-bold text-xs uppercase hover:text-brand-red transition-colors hidden">
<i class="fas fa-trash-alt"></i> Mudar Equa√ß√£o
</button>
<button id="btn-next" class="bg-brand-blue text-white font-bold py-3 px-8 rounded-xl shadow-btn active:shadow-none active:translate-y-1 transition-all flex items-center gap-2 ml-auto">
<span>Pr√≥ximo</span> <i class="fas fa-arrow-right"></i>
</button>
</div>

</div>
</div>
`;

                    // 2. Seletores
                    const inA = container.querySelector("#in-a");
                    const inB = container.querySelector("#in-b");
                    const inC = container.querySelector("#in-c");
                    const btnStart = container.querySelector("#btn-start");
                    const inputArea = container.querySelector("#input-area");

                    const stepsDisplay = container.querySelector("#steps-display");
                    const cardStep = container.querySelector("#card-step");
                    const stepTitle = container.querySelector("#step-title");
                    const mathContent = container.querySelector("#math-content");
                    const stepDesc = container.querySelector("#step-desc");
                    const stepBar = container.querySelector("#step-bar");
                    const btnNext = container.querySelector("#btn-next");
                    const btnReset = container.querySelector("#btn-reset");

                    // 3. L√≥gica
                    let delta = 0;

                    const renderStep = () => {
                        // Garante cores
                        const valA = `<span class="${cA}">${coeffs.a < 0 ? `(${coeffs.a})` : coeffs.a
                            }</span>`;
                        const valB = `<span class="${cB}">${coeffs.b < 0 ? `(${coeffs.b})` : coeffs.b
                            }</span>`;
                        const valC = `<span class="${cC}">${coeffs.c < 0 ? `(${coeffs.c})` : coeffs.c
                            }</span>`;

                        // Vari√°veis limpas para c√°lculo
                        const a = coeffs.a;
                        const b = coeffs.b;
                        const c = coeffs.c;

                        // HTML Din√¢mico
                        if (step === 1) {
                            // CALCULAR DELTA (Substitui√ß√£o)
                            stepBar.className =
                                "absolute top-0 left-0 w-2 h-full bg-brand-yellow";
                            stepTitle.innerText = "1. Calculando o Delta (Œî)";
                            stepTitle.className =
                                "text-sm font-bold text-brand-yellowDark uppercase mb-2";

                            // F√≥rmula: b¬≤ - 4ac
                            mathContent.innerHTML = `
<div>Œî = <span class="text-gray-400">b</span>¬≤ - 4<span class="text-gray-400">ac</span></div>
<div class="mt-2">Œî = ${valB}¬≤ - 4¬∑${valA}¬∑${valC}</div>
`;
                            stepDesc.innerText =
                                "Trocamos as letras pelos n√∫meros. Aten√ß√£o aos sinais!";

                            delta = b * b - 4 * a * c;
                        } else if (step === 2) {
                            // RESULTADO DELTA
                            stepBar.className =
                                "absolute top-0 left-0 w-2 h-full bg-brand-yellow";

                            const part1 = b * b; // b¬≤
                            const part2 = -4 * a * c; // -4ac
                            const sign = part2 >= 0 ? "+" : ""; // Sinal expl√≠cito

                            mathContent.innerHTML = `
<div>Œî = ${part1} ${sign} ${part2}</div>
<div class="mt-2 font-black">Œî = ${delta}</div>
`;

                            if (delta < 0) {
                                stepDesc.innerHTML = `<span class="text-brand-red font-bold"><i class="fas fa-ban"></i> Delta Negativo!</span> N√£o existem ra√≠zes reais. A conta acaba aqui.`;
                                btnNext.innerHTML = `<i class="fas fa-undo"></i> Reiniciar`;
                                btnNext.onclick = reset; // Atalho para reset
                            } else if (delta === 0) {
                                stepDesc.innerHTML = `<span class="text-brand-blue font-bold"><i class="fas fa-equals"></i> Delta Zero!</span> Teremos apenas uma raiz real (ou duas iguais).`;
                            } else {
                                stepDesc.innerHTML = `<span class="text-brand-green font-bold"><i class="fas fa-check"></i> Delta Positivo!</span> Teremos duas ra√≠zes reais diferentes.`;
                            }
                        } else if (step === 3) {
                            // F√ìRMULA DE BHASKARA (Substitui√ß√£o)
                            stepBar.className =
                                "absolute top-0 left-0 w-2 h-full bg-brand-text";
                            stepTitle.innerText = "2. A F√≥rmula Principal";
                            stepTitle.className =
                                "text-sm font-bold text-gray-400 uppercase mb-2";

                            // x = (-b ¬± ‚àöŒî) / 2a
                            // Aten√ß√£o: -b inverte o sinal visualmente
                            const negB = -b;

                            mathContent.innerHTML = `
<div class="text-lg text-gray-400 mb-2">x = <span class="border-t border-gray-400 px-1">-b ¬± ‚àöŒî</span> / 2a</div>
<div>x = <span class="border-t-2 border-brand-text px-1">${-b} ¬± ‚àö${delta}</span></div>
<div class="text-center w-full mt-1">2¬∑${valA}</div>
`;
                            stepDesc.innerText = `O oposto de b √© ${-b}. A raiz de Delta (${delta}) vamos calcular agora.`;
                        } else if (step === 4) {
                            // CALCULAR RA√çZES
                            stepBar.className =
                                "absolute top-0 left-0 w-2 h-full bg-brand-green";
                            stepTitle.innerText = "3. As Duas Ra√≠zes";
                            stepTitle.className =
                                "text-sm font-bold text-brand-green uppercase mb-2";

                            const sqrtDelta = Math.sqrt(delta);

                            // Verifica se raiz √© exata para visualiza√ß√£o bonita
                            const sqrtDisplay = Number.isInteger(sqrtDelta)
                                ? sqrtDelta
                                : sqrtDelta.toFixed(2);

                            const x1 = (-b + sqrtDelta) / (2 * a);
                            const x2 = (-b - sqrtDelta) / (2 * a);

                            // Formata√ß√£o BR
                            const f = (n) =>
                                Number.isInteger(n) ? n : n.toFixed(2).replace(".", ",");

                            mathContent.innerHTML = `
<div class="grid grid-cols-1 gap-4 w-full">
<div class="bg-green-50 p-2 rounded border border-green-200">
<span class="text-xs font-bold text-green-600 uppercase">Raiz 1 (+)</span>
<div>x' = <span class="whitespace-nowrap">(${-b} + ${sqrtDisplay}) / ${2 * a
                                }</span></div>
<div class="text-brand-green font-black text-2xl mt-1">x' = ${f(x1)}</div>
</div>
<div class="bg-green-50 p-2 rounded border border-green-200">
<span class="text-xs font-bold text-green-600 uppercase">Raiz 2 (-)</span>
<div>x'' = <span class="whitespace-nowrap">(${-b} - ${sqrtDisplay}) / ${2 * a
                                }</span></div>
<div class="text-brand-green font-black text-2xl mt-1">x'' = ${f(x2)}</div>
</div>
</div>
`;
                            stepDesc.innerText =
                                "Separamos o 'Mais ou Menos' em duas contas. Aqui est√£o as solu√ß√µes!";

                            btnNext.innerHTML = `<i class="fas fa-undo"></i> Nova Conta`;
                        }
                    };

                    const start = () => {
                        coeffs.a = parseFloat(inA.value);
                        coeffs.b = parseFloat(inB.value);
                        coeffs.c = parseFloat(inC.value);

                        if (coeffs.a === 0) {
                            alert("O valor de 'a' n√£o pode ser 0 numa equa√ß√£o do 2¬∫ grau!");
                            return;
                        }

                        // Anima√ß√£o de Entrada
                        inputArea.classList.add(
                            "scale-75",
                            "opacity-50",
                            "pointer-events-none"
                        );
                        stepsDisplay.classList.remove("hidden");
                        stepsDisplay.classList.add("animate-slide-up");
                        btnReset.classList.remove("hidden");

                        step = 1;
                        renderStep();
                    };

                    const reset = () => {
                        step = 0;
                        inputArea.classList.remove(
                            "scale-75",
                            "opacity-50",
                            "pointer-events-none"
                        );
                        stepsDisplay.classList.add("hidden");
                        btnNext.innerHTML = `<span>Pr√≥ximo</span> <i class="fas fa-arrow-right"></i>`;
                        btnNext.onclick = next; // Restaura handler
                    };

                    const next = () => {
                        if (step === 2 && delta < 0) {
                            reset(); // Se delta negativo, bot√£o vira reset
                            return;
                        }
                        if (step < 4) {
                            step++;
                            renderStep();
                        } else {
                            reset(); // Fim
                        }
                    };

                    // 4. Listeners
                    btnStart.onclick = start;
                    btnNext.onclick = next;
                    btnReset.onclick = reset;
                },

                interactive_parabola_graph(container) {
                    // Estado Inicial
                    let params = { a: 1, b: 0, c: -4 };

                    // Configura√ß√µes do Gr√°fico
                    const width = 300;
                    const height = 300;
                    const scale = 15; // 1 unidade = 15px (Zoom)
                    const range = 10; // X vai de -10 a 10

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-2">Laborat√≥rio de Par√°bolas</h3>

<div class="bg-gray-50 border border-gray-200 rounded-lg px-6 py-3 mb-6 text-xl md:text-2xl font-mono font-bold text-gray-700 shadow-inner">
f(x) = <span class="text-brand-purple" id="disp-a">1</span>x¬≤ + <span class="text-brand-blue" id="disp-b">0</span>x + <span class="text-brand-orange" id="disp-c">-4</span>
</div>

<div class="flex flex-col md:flex-row gap-8 w-full items-center justify-center">

<div class="relative w-[300px] h-[300px] bg-white rounded-xl border-2 border-gray-200 overflow-hidden shadow-sm cursor-crosshair">
<svg id="graph-svg" width="300" height="300" viewBox="0 0 300 300">
<defs>
<pattern id="grid" width="15" height="15" patternUnits="userSpaceOnUse">
<path d="M 15 0 L 0 0 0 15" fill="none" stroke="rgba(0,0,0,0.05)" stroke-width="1"/>
</pattern>
</defs>
<rect width="100%" height="100%" fill="url(#grid)" />

<line x1="0" y1="150" x2="300" y2="150" stroke="#aaa" stroke-width="1" />
<line x1="150" y1="0" x2="150" y2="300" stroke="#aaa" stroke-width="1" />

<path id="curve" d="" fill="none" stroke="#9B59B6" stroke-width="3" stroke-linecap="round" />

<circle id="pt-vertex" r="4" fill="#1CB0F6" stroke="white" stroke-width="2" />
<circle id="pt-c" r="4" fill="#FF9600" stroke="white" stroke-width="2" />
</svg>

<div class="absolute top-2 right-2 flex flex-col items-end gap-1 pointer-events-none">
<span class="text-[10px] font-bold text-brand-blue bg-white px-1 rounded shadow border border-blue-100">‚óè V√©rtice</span>
<span class="text-[10px] font-bold text-brand-orange bg-white px-1 rounded shadow border border-orange-100">‚óè Corta Y (c)</span>
</div>
</div>

<div class="flex flex-col gap-4 w-full max-w-xs">

<div class="bg-purple-50 p-3 rounded-xl border border-purple-100">
<div class="flex justify-between text-xs font-bold text-brand-purple uppercase mb-1">
<span>Concavidade (a)</span>
<span id="val-a">1</span>
</div>
<input type="range" id="range-a" min="-3" max="3" step="0.1" value="1" class="w-full h-2 bg-purple-200 rounded-lg appearance-none cursor-pointer accent-brand-purple">
</div>

<div class="bg-blue-50 p-3 rounded-xl border border-blue-100">
<div class="flex justify-between text-xs font-bold text-brand-blue uppercase mb-1">
<span>Inclina√ß√£o (b)</span>
<span id="val-b">0</span>
</div>
<input type="range" id="range-b" min="-5" max="5" step="0.5" value="0" class="w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer accent-brand-blue">
</div>

<div class="bg-orange-50 p-3 rounded-xl border border-orange-100">
<div class="flex justify-between text-xs font-bold text-brand-orange uppercase mb-1">
<span>Altura (c)</span>
<span id="val-c">-4</span>
</div>
<input type="range" id="range-c" min="-8" max="8" step="0.5" value="-4" class="w-full h-2 bg-orange-200 rounded-lg appearance-none cursor-pointer accent-brand-orange">
</div>

<div class="mt-2 text-xs font-mono text-gray-500 bg-gray-50 p-2 rounded border text-center">
<div id="info-vertex">V√©rtice: (0, -4)</div>
<div id="info-delta">Œî > 0 (2 Ra√≠zes)</div>
</div>
</div>
</div>
</div>
`;

                    // 2. Seletores
                    const rA = container.querySelector("#range-a");
                    const rB = container.querySelector("#range-b");
                    const rC = container.querySelector("#range-c");

                    const dispA = container.querySelector("#disp-a");
                    const dispB = container.querySelector("#disp-b");
                    const dispC = container.querySelector("#disp-c");

                    const valA = container.querySelector("#val-a");
                    const valB = container.querySelector("#val-b");
                    const valC = container.querySelector("#val-c");

                    const curve = container.querySelector("#curve");
                    const ptVertex = container.querySelector("#pt-vertex");
                    const ptC = container.querySelector("#pt-c");

                    const infoVertex = container.querySelector("#info-vertex");
                    const infoDelta = container.querySelector("#info-delta");

                    // 3. Sistema de Coordenadas
                    // Transforma (x,y) matem√°tico em (x,y) pixels do SVG
                    const mapX = (x) => 150 + x * scale;
                    const mapY = (y) => 150 - y * scale; // Y do SVG √© invertido

                    // 4. L√≥gica de Atualiza√ß√£o
                    const update = () => {
                        // Pega valores
                        let a = parseFloat(rA.value);
                        // Evita a=0 (pois deixaria de ser par√°bola)
                        if (a === 0) {
                            a = 0.1;
                            rA.value = 0.1;
                        }

                        const b = parseFloat(rB.value);
                        const c = parseFloat(rC.value);

                        // Atualiza Textos
                        valA.innerText = a;
                        dispA.innerText = a;
                        valB.innerText = b;
                        dispB.innerText = b >= 0 ? `+ ${b}` : b;
                        valC.innerText = c;
                        dispC.innerText = c >= 0 ? `+ ${c}` : c;

                        // --- DESENHAR CURVA ---
                        // Gera um path SVG iterando X de -10 a 10
                        let d = "";
                        for (let x = -range; x <= range; x += 0.2) {
                            const y = a * x * x + b * x + c;

                            // Mapeia para pixels
                            const px = mapX(x);
                            const py = mapY(y);

                            // Evita desenhar muito fora do canvas (otimiza√ß√£o)
                            if (py > -100 && py < 400) {
                                d += d === "" ? `M ${px} ${py}` : ` L ${px} ${py}`;
                            }
                        }
                        curve.setAttribute("d", d);

                        // --- PONTOS NOT√ÅVEIS ---

                        // 1. V√©rtice (xv = -b/2a)
                        const xv = -b / (2 * a);
                        const yv = a * xv * xv + b * xv + c;

                        ptVertex.setAttribute("cx", mapX(xv));
                        ptVertex.setAttribute("cy", mapY(yv));
                        infoVertex.innerText = `V√©rtice: (${xv.toFixed(1)}, ${yv.toFixed(
                            1
                        )})`;

                        // 2. Intercepto Y (0, c)
                        ptC.setAttribute("cx", mapX(0));
                        ptC.setAttribute("cy", mapY(c));

                        // 3. Delta e Ra√≠zes
                        const delta = b * b - 4 * a * c;
                        if (delta > 0) {
                            infoDelta.innerText = `Œî = ${delta.toFixed(
                                1
                            )} (2 Ra√≠zes Reais)`;
                            infoDelta.className = "text-brand-green font-bold";
                        } else if (delta === 0) {
                            infoDelta.innerText = `Œî = 0 (1 Raiz Real)`;
                            infoDelta.className = "text-brand-blue font-bold";
                        } else {
                            infoDelta.innerText = `Œî = ${delta.toFixed(
                                1
                            )} (Sem Ra√≠zes Reais)`;
                            infoDelta.className = "text-brand-red font-bold";
                        }
                    };

                    // 5. Listeners
                    [rA, rB, rC].forEach((el) => el.addEventListener("input", update));

                    // Init
                    update();
                },

                interactive_pythagoras_calc(container) {
                    // Estado inicial (Terno Pitag√≥rico 3-4-5)
                    let state = {
                        a: 3, // Cateto Vertical
                        b: 4, // Cateto Horizontal
                    };

                    // Cores
                    const cA = "text-brand-purple";
                    const cB = "text-brand-blue";
                    const cC = "text-brand-orange"; // Hipotenusa
                    const strokeA = "stroke-brand-purple";
                    const strokeB = "stroke-brand-blue";
                    const strokeC = "stroke-brand-orange";

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-6">O Teorema de Pit√°goras</h3>

<div class="flex flex-col md:flex-row items-center gap-8 w-full justify-center">

<div class="relative w-64 h-64 bg-gray-50 rounded-xl border border-gray-200 shadow-inner flex items-center justify-center overflow-hidden">
<svg id="pythagoras-svg" width="240" height="240" viewBox="0 0 240 240">
<defs>
<pattern id="grid-p" width="20" height="20" patternUnits="userSpaceOnUse">
<path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(0,0,0,0.05)" stroke-width="1"/>
</pattern>
</defs>
<rect width="100%" height="100%" fill="url(#grid-p)" />

<path id="tri-path" fill="rgba(255, 150, 0, 0.1)" stroke-width="3" stroke-linejoin="round" />

<line id="line-a" stroke-width="4" class="${strokeA}" stroke-linecap="round" />
<line id="line-b" stroke-width="4" class="${strokeB}" stroke-linecap="round" />
<line id="line-c" stroke-width="4" class="${strokeC}" stroke-linecap="round" />

<rect id="right-angle" width="15" height="15" fill="none" stroke="#aaa" stroke-width="2" />

<text id="lbl-a" class="text-sm font-bold fill-brand-purple" text-anchor="end" dominant-baseline="middle">a</text>
<text id="lbl-b" class="text-sm font-bold fill-brand-blue" text-anchor="middle" dominant-baseline="hanging">b</text>
<text id="lbl-c" class="text-sm font-bold fill-brand-orange" text-anchor="middle" dominant-baseline="middle">c</text>
</svg>
</div>

<div class="flex flex-col gap-6 w-full max-w-xs">

<div class="space-y-4">
<div>
<div class="flex justify-between text-xs font-bold uppercase mb-1">
<span class="${cA}">Cateto a (Altura)</span>
<span id="val-a" class="font-mono text-lg ${cA}">3</span>
</div>
<input type="range" id="range-a" min="1" max="8" value="3" class="w-full h-2 bg-purple-100 rounded-lg appearance-none cursor-pointer accent-brand-purple">
</div>

<div>
<div class="flex justify-between text-xs font-bold uppercase mb-1">
<span class="${cB}">Cateto b (Base)</span>
<span id="val-b" class="font-mono text-lg ${cB}">4</span>
</div>
<input type="range" id="range-b" min="1" max="8" value="4" class="w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer accent-brand-blue">
</div>
</div>

<div class="bg-gray-50 border-2 border-gray-100 rounded-xl p-4">
<div class="text-center font-mono text-lg font-bold text-gray-400 mb-2">
<span class="${cA}">a¬≤</span> + <span class="${cB}">b¬≤</span> = <span class="${cC}">c¬≤</span>
</div>

<div class="flex justify-center items-center gap-2 font-mono text-sm md:text-base font-bold mb-2">
<div class="flex flex-col items-center">
<span class="${cA}" id="calc-a2">3¬≤</span>
<span class="text-xs text-gray-400" id="res-a2">9</span>
</div>
<span class="text-gray-400">+</span>
<div class="flex flex-col items-center">
<span class="${cB}" id="calc-b2">4¬≤</span>
<span class="text-xs text-gray-400" id="res-b2">16</span>
</div>
<span class="text-gray-400">=</span>
<div class="flex flex-col items-center">
<span class="${cC}">c¬≤</span>
<span class="text-xs text-brand-orange" id="res-c2">25</span>
</div>
</div>

<div class="w-full h-px bg-gray-200 my-2"></div>

<div class="flex justify-between items-center">
<span class="text-xs font-bold text-gray-400 uppercase">Hipotenusa (c)</span>
<div class="text-2xl font-black text-brand-orange">
<span class="text-sm text-gray-400 font-normal mr-1">‚àö<span id="root-val">25</span> = </span>
<span id="final-c">5</span>
</div>
</div>
</div>

</div>
</div>
</div>
`;

                    // 2. Seletores
                    const rA = container.querySelector("#range-a");
                    const rB = container.querySelector("#range-b");
                    const vA = container.querySelector("#val-a");
                    const vB = container.querySelector("#val-b");

                    // SVG
                    const lineA = container.querySelector("#line-a");
                    const lineB = container.querySelector("#line-b");
                    const lineC = container.querySelector("#line-c");
                    const rightAngle = container.querySelector("#right-angle");
                    const lblA = container.querySelector("#lbl-a");
                    const lblB = container.querySelector("#lbl-b");
                    const lblC = container.querySelector("#lbl-c");

                    // Calc Elements
                    const calcA2 = container.querySelector("#calc-a2");
                    const resA2 = container.querySelector("#res-a2");
                    const calcB2 = container.querySelector("#calc-b2");
                    const resB2 = container.querySelector("#res-b2");
                    const resC2 = container.querySelector("#res-c2");
                    const rootVal = container.querySelector("#root-val");
                    const finalC = container.querySelector("#final-c");

                    // 3. Atualiza√ß√£o
                    const update = () => {
                        const a = parseInt(rA.value);
                        const b = parseInt(rB.value);

                        // Inputs UI
                        vA.innerText = a;
                        vB.innerText = b;

                        // C√°lculos
                        const a2 = a * a;
                        const b2 = b * b;
                        const c2 = a2 + b2;
                        const c = Math.sqrt(c2);

                        // Math UI
                        calcA2.innerText = `${a}¬≤`;
                        resA2.innerText = a2;
                        calcB2.innerText = `${b}¬≤`;
                        resB2.innerText = b2;
                        resC2.innerText = c2;
                        rootVal.innerText = c2;

                        // Se for inteiro, mostra inteiro. Se n√£o, mostra 2 casas decimais.
                        finalC.innerText = Number.isInteger(c)
                            ? c
                            : c.toFixed(2).replace(".", ",");

                        // SVG Logic
                        // Origem do √¢ngulo reto: (40, 200) - canto inferior esquerdo com margem
                        // O SVG tem 240x240.
                        // Escala: 1 unidade = 20px
                        const scale = 20;
                        const originX = 40;
                        const originY = 200;

                        const xTop = originX;
                        const yTop = originY - a * scale; // Y cresce pra baixo
                        const xRight = originX + b * scale;
                        const yRight = originY;

                        // Desenha Linhas
                        // A (Vertical)
                        lineA.setAttribute("x1", originX);
                        lineA.setAttribute("y1", originY);
                        lineA.setAttribute("x2", xTop);
                        lineA.setAttribute("y2", yTop);

                        // B (Horizontal)
                        lineB.setAttribute("x1", originX);
                        lineB.setAttribute("y1", originY);
                        lineB.setAttribute("x2", xRight);
                        lineB.setAttribute("y2", yRight);

                        // C (Diagonal)
                        lineC.setAttribute("x1", xTop);
                        lineC.setAttribute("y1", yTop);
                        lineC.setAttribute("x2", xRight);
                        lineC.setAttribute("y2", yRight);

                        // Marca do √Çngulo Reto
                        rightAngle.setAttribute("x", originX);
                        rightAngle.setAttribute("y", originY - 15);

                        // Labels
                        lblA.setAttribute("x", originX - 10);
                        lblA.setAttribute("y", originY - (a * scale) / 2);
                        lblA.textContent = a;

                        lblB.setAttribute("x", originX + (b * scale) / 2);
                        lblB.setAttribute("y", originY + 20);
                        lblB.textContent = b;

                        // Label C (Posicionado no meio da hipotenusa, levemente deslocado)
                        const midX = (xTop + xRight) / 2;
                        const midY = (yTop + yRight) / 2;
                        lblC.setAttribute("x", midX + 15);
                        lblC.setAttribute("y", midY - 15);
                        lblC.textContent = Number.isInteger(c) ? c : c.toFixed(1);
                    };

                    // 4. Listeners
                    rA.addEventListener("input", update);
                    rB.addEventListener("input", update);

                    // Init
                    update();
                },

                interactive_trig_calc(container) {
                    // Estado
                    let angle = 30;
                    const radius = 180; // Tamanho visual da hipotenusa em px
                    const origin = { x: 40, y: 220 }; // Canto inferior esquerdo do SVG

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-6">Trigonometria: SOH CAH TOA</h3>

<div class="flex flex-col md:flex-row gap-8 w-full justify-center items-center">

<div class="relative bg-gray-50 border border-gray-200 rounded-xl shadow-inner p-4">
<svg id="trig-svg" width="260" height="240" viewBox="0 0 260 240" class="overflow-visible">

<path id="arc-angle" fill="rgba(75, 75, 75, 0.1)" stroke="none" />
<text id="lbl-angle" x="60" y="210" class="text-xs font-bold fill-gray-500">30¬∞</text>

<line id="line-adj" x1="40" y1="220" x2="200" y2="220" stroke="#1CB0F6" stroke-width="4" stroke-linecap="round" />

<line id="line-opp" x1="200" y1="220" x2="200" y2="100" stroke="#FF4B4B" stroke-width="4" stroke-linecap="round" />

<line id="line-hyp" x1="40" y1="220" x2="200" y2="100" stroke="#58CC02" stroke-width="4" stroke-linecap="round" />

<rect id="rect-90" x="185" y="205" width="15" height="15" fill="none" stroke="#aaa" stroke-width="2" />

<text id="lbl-hyp" class="text-xs font-bold fill-brand-green" text-anchor="middle">H</text>
<text id="lbl-opp" class="text-xs font-bold fill-brand-red" text-anchor="start" dominant-baseline="middle">O</text>
<text id="lbl-adj" class="text-xs font-bold fill-brand-blue" text-anchor="middle" dominant-baseline="hanging" dy="8">A</text>

</svg>
</div>

<div class="flex flex-col gap-6 w-full max-w-xs">

<div>
<div class="flex justify-between text-xs font-bold uppercase mb-2">
<span class="text-gray-400">√Çngulo (Œ∏)</span>
<span class="text-brand-text text-lg" id="val-angle">30¬∞</span>
</div>
<input type="range" id="range-angle" min="0" max="89" value="30" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-text">
</div>

<div class="flex flex-col gap-2">

<div class="bg-red-50 border border-red-200 rounded-lg p-3 flex justify-between items-center">
<div class="flex flex-col">
<span class="text-[10px] font-bold text-red-400 uppercase tracking-widest">SENO (SOH)</span>
<span class="text-xs font-mono text-red-800">Oposto / Hip.</span>
</div>
<div class="text-2xl font-black text-brand-red" id="val-sin">0,50</div>
</div>

<div class="bg-blue-50 border border-blue-200 rounded-lg p-3 flex justify-between items-center">
<div class="flex flex-col">
<span class="text-[10px] font-bold text-blue-400 uppercase tracking-widest">COSSENO (CAH)</span>
<span class="text-xs font-mono text-blue-800">Adj. / Hip.</span>
</div>
<div class="text-2xl font-black text-brand-blue" id="val-cos">0,87</div>
</div>

<div class="bg-gray-50 border border-gray-200 rounded-lg p-3 flex justify-between items-center">
<div class="flex flex-col">
<span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">TANGENTE (TOA)</span>
<span class="text-xs font-mono text-gray-600">Oposto / Adj.</span>
</div>
<div class="text-2xl font-black text-brand-text" id="val-tan">0,58</div>
</div>

</div>
</div>
</div>
</div>
`;

                    // 2. SELETORES
                    const rangeAngle = container.querySelector("#range-angle");
                    const valAngle = container.querySelector("#val-angle");
                    const valSin = container.querySelector("#val-sin");
                    const valCos = container.querySelector("#val-cos");
                    const valTan = container.querySelector("#val-tan");

                    // SVG Elements
                    const lineAdj = container.querySelector("#line-adj");
                    const lineOpp = container.querySelector("#line-opp");
                    const lineHyp = container.querySelector("#line-hyp");
                    const rect90 = container.querySelector("#rect-90");
                    const arcAngle = container.querySelector("#arc-angle");
                    const lblAngle = container.querySelector("#lbl-angle");

                    const lblHyp = container.querySelector("#lbl-hyp");
                    const lblOpp = container.querySelector("#lbl-opp");
                    const lblAdj = container.querySelector("#lbl-adj");

                    // 3. ATUALIZA√á√ÉO
                    const update = () => {
                        let deg = parseInt(rangeAngle.value);
                        // Evita 0 e 90 exatos para n√£o colapsar o tri√¢ngulo totalmente (UX melhor)
                        if (deg < 1) deg = 1;
                        if (deg > 89) deg = 89;

                        valAngle.innerText = `${deg}¬∞`;

                        // Converter para radianos
                        const rad = deg * (Math.PI / 180);

                        // C√°lculos Trigonom√©tricos
                        const sin = Math.sin(rad);
                        const cos = Math.cos(rad);
                        const tan = Math.tan(rad);

                        // Coordenadas do V√©rtice Superior
                        // Y no SVG cresce para baixo, ent√£o subtra√≠mos da origem Y
                        const x = origin.x + radius * cos;
                        const y = origin.y - radius * sin;

                        // --- DESENHO SVG ---

                        // Adjacente (Base: Origem at√© X)
                        lineAdj.setAttribute("x1", origin.x);
                        lineAdj.setAttribute("y1", origin.y);
                        lineAdj.setAttribute("x2", x);
                        lineAdj.setAttribute("y2", origin.y);

                        // Oposto (Altura: X at√© Topo)
                        lineOpp.setAttribute("x1", x);
                        lineOpp.setAttribute("y1", origin.y);
                        lineOpp.setAttribute("x2", x);
                        lineOpp.setAttribute("y2", y);

                        // Hipotenusa (Origem at√© Topo)
                        lineHyp.setAttribute("x1", origin.x);
                        lineHyp.setAttribute("y1", origin.y);
                        lineHyp.setAttribute("x2", x);
                        lineHyp.setAttribute("y2", y);

                        // Marca de 90 graus (segue o v√©rtice reto)
                        const boxS = 15;
                        rect90.setAttribute("x", x - boxS);
                        rect90.setAttribute("y", origin.y - boxS);

                        // Arco do √Çngulo (Path)
                        const arcR = 40;
                        // Comando SVG Arc: A rx ry rot large-arc sweep x y
                        // Linha at√© borda, arco at√© (arcX, arcY), fecha
                        const arcX = origin.x + arcR * Math.cos(-rad); // SVG Y invertido
                        const arcY = origin.y + arcR * Math.sin(-rad);

                        const d = `M ${origin.x + arcR} ${origin.y
                            } A ${arcR} ${arcR} 0 0 0 ${arcX} ${arcY} L ${origin.x} ${origin.y
                            }`;
                        arcAngle.setAttribute("d", d);
                        lblAngle.innerText = `${deg}¬∞`;

                        // Labels de Lado (Posicionamento)
                        lblAdj.setAttribute("x", origin.x + (x - origin.x) / 2);
                        lblAdj.setAttribute("y", origin.y);

                        lblOpp.setAttribute("x", x + 5);
                        lblOpp.setAttribute("y", origin.y - (origin.y - y) / 2);

                        lblHyp.setAttribute("x", origin.x + (x - origin.x) / 2 - 10);
                        lblHyp.setAttribute("y", origin.y - (origin.y - y) / 2 - 10);

                        // --- VALORES NUM√âRICOS ---
                        valSin.innerText = sin.toFixed(2).replace(".", ",");
                        valCos.innerText = cos.toFixed(2).replace(".", ",");
                        valTan.innerText = tan.toFixed(2).replace(".", ",");
                    };

                    // 4. LISTENERS
                    rangeAngle.addEventListener("input", update);

                    // Init
                    update();
                },

                interactive_thermometer(div) {
                    div.innerHTML = `
<div class="flex items-center justify-center gap-8 bg-white border-2 border-gray-200 rounded-3xl p-8">
<div class="relative w-8 h-48 bg-gray-200 rounded-full border-2 border-gray-300 overflow-hidden">
<div id="merc" class="absolute bottom-0 w-full transition-all duration-300 bg-brand-purple" style="height: 50%"></div>
<div class="absolute top-1/2 w-full h-0.5 bg-black opacity-20"></div>
</div>
<div class="flex flex-col items-center gap-4">
<input type="range" min="-50" max="50" value="0" class="thermometer-slider" oninput="app.widgets.updateThermo(this)">
<div id="temp-val" class="text-3xl font-extrabold text-brand-purple">0¬∞</div>
</div>
</div>`;
                    app.widgets.updateThermo = (el) => {
                        const val = parseInt(el.value);
                        const merc =
                            el.parentElement.previousElementSibling.querySelector("#merc");
                        const label = el.nextElementSibling;
                        const h = val + 50;
                        merc.style.height = `${h}%`;
                        label.innerText = `${val}¬∞`;
                        label.className =
                            val < 0
                                ? "text-3xl font-extrabold text-brand-blue"
                                : val > 0
                                    ? "text-3xl font-extrabold text-brand-red"
                                    : "text-3xl font-extrabold text-brand-purple";
                        merc.style.backgroundColor =
                            val < 0 ? "#1CB0F6" : val > 0 ? "#FF4B4B" : "#9B59B6";
                    };
                },

                interactive_cartesian_plane(c) {
                    c.innerHTML = '<canvas id="cartesianCanvas"></canvas>';
                    new Chart(c.querySelector("canvas"), {
                        type: "scatter",
                        data: {
                            datasets: [
                                {
                                    label: "Ponto P(2, -3)",
                                    data: [{ x: 2, y: -3 }],
                                    backgroundColor: "#58CC02",
                                    pointRadius: 8,
                                },
                            ],
                        },
                        options: {
                            scales: { x: { min: -5, max: 5 }, y: { min: -5, max: 5 } },
                        },
                    });
                },

                interactive_cartesian_plane_6o_grade(container) {
                    // Configura√ß√£o do Jogo
                    const gridSize = 6; // Grid de 0 a 6 (Ideal para mobile)
                    let target = { x: 0, y: 0 };
                    let score = { hits: 0, misses: 0 };

                    // 1. HTML ESTRUTURAL
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-4 md:p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full items-center mb-4 border-b-2 border-gray-100 pb-2">
<h3 class="text-brand-blue font-black uppercase text-xs tracking-widest flex items-center gap-2">
<i class="fas fa-crosshairs"></i> Radar t√°tico
</h3>
<div class="flex gap-3 text-xs font-black">
<div class="text-brand-green bg-green-50 px-2 py-1 rounded">Acertos: <span id="score-hit">0</span></div>
<div class="text-brand-red bg-red-50 px-2 py-1 rounded">Erros: <span id="score-miss">0</span></div>
</div>
</div>

<div class="relative bg-blue-50 rounded-xl border-4 border-brand-blue shadow-inner cursor-crosshair overflow-hidden mb-6" style="width: 280px; height: 280px;">
<div class="absolute inset-0 border-b-2 border-green-400 opacity-20 animate-scan pointer-events-none z-0"></div>

<svg width="280" height="280" viewBox="-20 -20 280 280" id="radar-svg" class="relative z-10">
</svg>

<div id="feedback-layer" class="absolute inset-0 flex items-center justify-center pointer-events-none z-20 hidden">
<div id="feedback-icon" class="text-6xl animate-bounce drop-shadow-lg">üí•</div>
</div>
</div>

<div class="w-full max-w-sm bg-gray-800 p-4 rounded-2xl shadow-lg border-b-4 border-gray-900 text-white">
<p class="text-[10px] text-gray-400 uppercase font-bold text-center mb-3 tracking-widest">Coordenadas do Alvo</p>

<div class="flex items-end justify-center gap-4 mb-4">

<div class="flex flex-col items-center gap-1">
<label class="text-brand-blue font-bold text-xs">X (Ch√£o)</label>
<input type="number" id="input-x" class="w-16 h-12 text-center text-2xl font-mono font-bold text-gray-900 rounded-lg border-2 border-brand-blue focus:ring-4 focus:ring-blue-300 outline-none" placeholder="0" min="0" max="6">
</div>

<span class="text-2xl font-bold pb-2 text-gray-500">,</span>

<div class="flex flex-col items-center gap-1">
<label class="text-brand-orange font-bold text-xs">Y (Altura)</label>
<input type="number" id="input-y" class="w-16 h-12 text-center text-2xl font-mono font-bold text-gray-900 rounded-lg border-2 border-brand-orange focus:ring-4 focus:ring-orange-300 outline-none" placeholder="0" min="0" max="6">
</div>

</div>

<button id="btn-fire" class="w-full bg-brand-red hover:bg-red-600 text-white font-black text-lg py-3 rounded-xl shadow-btn active:scale-95 active:shadow-none transition-all uppercase tracking-widest flex items-center justify-center gap-2">
<i class="fas fa-rocket"></i> Lan√ßar M√≠ssil
</button>
</div>

</div>
`;

                    // 2. CSS Inline para Anima√ß√£o do Radar
                    if (!document.getElementById("radar-anim")) {
                        const s = document.createElement("style");
                        s.id = "radar-anim";
                        s.innerHTML = `
@keyframes scan { 0% { top: 0%; opacity: 0; } 50% { opacity: 0.5; } 100% { top: 100%; opacity: 0; } }
.animate-scan { animation: scan 3s linear infinite; }
`;
                        container.appendChild(s);
                    }

                    // 3. Seletores
                    const svg = container.querySelector("#radar-svg");
                    const inputX = container.querySelector("#input-x");
                    const inputY = container.querySelector("#input-y");
                    const btnFire = container.querySelector("#btn-fire");
                    const scoreHit = container.querySelector("#score-hit");
                    const scoreMiss = container.querySelector("#score-miss");
                    const feedbackLayer = container.querySelector("#feedback-layer");
                    const feedbackIcon = container.querySelector("#feedback-icon");

                    // Configura√ß√£o de Desenho
                    const unit = 40; // 40px por unidade

                    // Converte (x, y) matem√°tico para (cx, cy) do SVG
                    const toPixel = (x, y) => ({
                        cx: x * unit,
                        cy: gridSize * unit - y * unit,
                    });

                    // 4. Fun√ß√µes do Jogo
                    const drawGrid = () => {
                        let html = "";
                        // Linhas do Grid (Azuladas tipo radar)
                        for (let i = 0; i <= gridSize; i++) {
                            const pos = i * unit;
                            const limit = gridSize * unit;
                            // Verticais
                            html += `<line x1="${pos}" y1="0" x2="${pos}" y2="${limit}" stroke="#93C5FD" stroke-width="1" stroke-opacity="0.5" />`;
                            // Horizontais
                            html += `<line x1="0" y1="${pos}" x2="${limit}" y2="${pos}" stroke="#93C5FD" stroke-width="1" stroke-opacity="0.5" />`;

                            // N√∫meros (Labels)
                            html += `<text x="${pos}" y="${limit + 15
                                }" font-size="10" text-anchor="middle" fill="#1CB0F6" font-weight="bold">${i}</text>`;
                            html += `<text x="-10" y="${pos + 4
                                }" font-size="10" text-anchor="end" fill="#FF9600" font-weight="bold">${gridSize - i
                                }</text>`;
                        }

                        // Eixos Fortes
                        html += `<line x1="0" y1="0" x2="0" y2="${gridSize * unit
                            }" stroke="#1E3A8A" stroke-width="3" />`; // Y
                        html += `<line x1="0" y1="${gridSize * unit}" x2="${gridSize * unit
                            }" y2="${gridSize * unit}" stroke="#1E3A8A" stroke-width="3" />`; // X

                        return html;
                    };

                    const spawnTarget = () => {
                        // Gera alvo aleat√≥rio
                        target = {
                            x: Math.floor(Math.random() * (gridSize + 1)),
                            y: Math.floor(Math.random() * (gridSize + 1)),
                        };

                        // Limpa inputs e foca no X
                        inputX.value = "";
                        inputY.value = "";
                        // inputX.focus(); // Opcional: Foca automaticamente

                        renderBoard();
                    };

                    const renderBoard = (shot = null) => {
                        let content = drawGrid();

                        // Desenha o Alvo (Navio)
                        const tPx = toPixel(target.x, target.y);
                        // √çcone de Navio (C√≠rculo vermelho pulsante por enquanto)
                        content += `<circle cx="${tPx.cx}" cy="${tPx.cy}" r="8" fill="#EF4444" class="animate-pulse" />`;
                        content += `<circle cx="${tPx.cx}" cy="${tPx.cy}" r="14" fill="none" stroke="#EF4444" stroke-width="2" class="animate-ping" opacity="0.5" />`;

                        // Se houve um tiro, desenha o local do tiro
                        if (shot) {
                            const sPx = toPixel(shot.x, shot.y);
                            const color = shot.hit ? "#58CC02" : "#1E3A8A"; // Verde ou Azul Escuro
                            content += `<line x1="${sPx.cx - 6}" y1="${sPx.cy - 6}" x2="${sPx.cx + 6
                                }" y2="${sPx.cy + 6}" stroke="${color}" stroke-width="3" />`;
                            content += `<line x1="${sPx.cx + 6}" y1="${sPx.cy - 6}" x2="${sPx.cx - 6
                                }" y2="${sPx.cy + 6}" stroke="${color}" stroke-width="3" />`;
                        }

                        svg.innerHTML = content;
                    };

                    const fire = () => {
                        const x = parseInt(inputX.value);
                        const y = parseInt(inputY.value);

                        if (isNaN(x) || isNaN(y))
                            return alert("Digite as coordenadas X e Y!");
                        if (x < 0 || x > gridSize || y < 0 || y > gridSize)
                            return alert("Fora do mapa! Use n√∫meros de 0 a 6.");

                        const isHit = x === target.x && y === target.y;

                        // Mostra onde o tiro caiu
                        renderBoard({ x, y, hit: isHit });

                        // Feedback Visual
                        feedbackLayer.classList.remove("hidden");
                        if (isHit) {
                            feedbackIcon.innerText = "üí•"; // Explos√£o
                            score.hits++;
                            scoreHit.innerText = score.hits;
                            btnFire.innerText = "NAUFR√ÅGIO! Pr√≥ximo...";
                            btnFire.classList.replace("bg-brand-red", "bg-brand-green");
                        } else {
                            feedbackIcon.innerText = "üåä"; // √Ågua
                            score.misses++;
                            scoreMiss.innerText = score.misses;
                            btnFire.innerText = "ERROU! Tente de novo";
                        }

                        // Reset ap√≥s delay se acertou
                        if (isHit) {
                            setTimeout(() => {
                                feedbackLayer.classList.add("hidden");
                                btnFire.innerText = "Lan√ßar M√≠ssil";
                                btnFire.classList.replace("bg-brand-green", "bg-brand-red");
                                spawnTarget();
                            }, 1500);
                        } else {
                            setTimeout(() => {
                                feedbackLayer.classList.add("hidden");
                            }, 1000);
                        }
                    };

                    // 5. Listeners
                    btnFire.onclick = fire;

                    // Init
                    spawnTarget();
                },

                interactive_scale_game(container) {
                    const levels = [
                        { targetMult: 4, correctScale: 2, hint: "Quero 4x mais √°rea." },
                        { targetMult: 9, correctScale: 3, hint: "Quero 9x mais √°rea." },
                        {
                            targetMult: 0.25,
                            correctScale: 0.5,
                            hint: "Quero 1/4 da √°rea (4x menor).",
                        },
                        { targetMult: 16, correctScale: 4, hint: "Quero 16x mais √°rea!" },
                    ];
                    let currentLevel = 0;
                    let score = 0;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full items-center mb-4 border-b-2 border-gray-100 pb-2">
<h3 class="text-brand-orange font-black uppercase text-xs tracking-widest"><i class="fas fa-hard-hat"></i> Desafio do Arquiteto</h3>
<div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black shadow-sm">Pontos: <span id="score-val">0</span></div>
</div>

<div class="bg-gray-800 text-white p-4 rounded-xl w-full mb-6 relative shadow-lg">
<div class="absolute -top-3 -left-3 text-4xl">üë∑</div>
<div class="ml-8">
<p class="text-[10px] uppercase font-bold text-gray-400 mb-1">Pedido do Cliente:</p>
<p class="text-lg font-bold leading-tight" id="client-msg">...</p>
</div>
</div>

<div class="flex gap-4 items-end justify-center mb-8 h-32 w-full">
<div class="flex flex-col items-center">
<div class="w-12 h-12 bg-gray-300 rounded border-2 border-gray-400 flex items-center justify-center font-bold text-gray-600 text-xs">Original</div>
<span class="text-[10px] font-bold mt-1 text-gray-400">Lado 1</span>
</div>
<i class="fas fa-arrow-right text-gray-300 mb-6"></i>
<div class="flex flex-col items-center transition-all duration-500" id="preview-box">
<div class="bg-brand-orange border-2 border-orange-600 rounded shadow-sm flex items-center justify-center font-bold text-white transition-all duration-500" id="res-visual" style="width: 48px; height: 48px;">?</div>
<span class="text-[10px] font-bold mt-1 text-brand-orange" id="res-label">Escala ?</span>
</div>
</div>

<p class="text-xs text-gray-500 font-bold mb-2 uppercase">Escolha o Fator de Escala ($k$)</p>
<div class="grid grid-cols-4 gap-2 w-full" id="opts-grid">
</div>

<div id="feedback-msg" class="h-8 mt-4 text-sm font-black text-center"></div>

<button id="btn-next" class="hidden w-full bg-brand-green text-white font-bold py-3 rounded-xl shadow-btn mt-2 animate-pop-in">Pr√≥ximo Pedido</button>

</div>
`;

                    const clientMsg = container.querySelector("#client-msg");
                    const optsGrid = container.querySelector("#opts-grid");
                    const resVisual = container.querySelector("#res-visual");
                    const resLabel = container.querySelector("#res-label");
                    const feedbackMsg = container.querySelector("#feedback-msg");
                    const scoreVal = container.querySelector("#score-val");
                    const btnNext = container.querySelector("#btn-next");

                    const loadLevel = () => {
                        if (currentLevel >= levels.length) {
                            clientMsg.innerText = "Parab√©ns! Voc√™ √© um Mestre Arquiteto!";
                            optsGrid.innerHTML = "";
                            btnNext.classList.add("hidden");
                            return;
                        }

                        const level = levels[currentLevel];
                        clientMsg.innerText = level.hint;
                        resVisual.style.width = "48px";
                        resVisual.style.height = "48px";
                        resVisual.innerText = "?";
                        resLabel.innerText = "Escala ?";
                        feedbackMsg.innerText = "";
                        btnNext.classList.add("hidden");

                        // Gera op√ß√µes (1 correta + 3 erradas)
                        let options = [level.correctScale];
                        while (options.length < 4) {
                            const r = [0.5, 2, 3, 4, 5][Math.floor(Math.random() * 5)];
                            if (!options.includes(r)) options.push(r);
                        }
                        options.sort((a, b) => a - b);

                        optsGrid.innerHTML = "";
                        options.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-white border-2 border-brand-gray text-gray-600 font-bold py-3 rounded-xl shadow-sm hover:bg-orange-50 hover:border-brand-orange transition-all active:scale-95";
                            btn.innerText = `${opt}x`;
                            btn.onclick = () => checkAnswer(opt, btn);
                            optsGrid.appendChild(btn);
                        });
                    };

                    const checkAnswer = (val, btn) => {
                        const level = levels[currentLevel];
                        const isCorrect = val === level.correctScale;

                        // Trava bot√µes
                        Array.from(optsGrid.children).forEach((b) => (b.disabled = true));

                        // Anima√ß√£o visual do resultado
                        const size = 48 * val;
                        resVisual.style.width = `${size}px`;
                        resVisual.style.height = `${size}px`;
                        resVisual.innerText = `${val}x`;
                        resLabel.innerText = `Escala ${val}x`;

                        if (isCorrect) {
                            btn.classList.add(
                                "bg-green-100",
                                "border-green-500",
                                "text-green-800"
                            );
                            feedbackMsg.innerHTML = `<span class="text-brand-green">Acertou! √Årea = ${val * val
                                }x</span>`;
                            score += 100;
                            scoreVal.innerText = score;
                            btnNext.classList.remove("hidden");
                        } else {
                            btn.classList.add(
                                "bg-red-100",
                                "border-red-500",
                                "text-red-800"
                            );
                            feedbackMsg.innerHTML = `<span class="text-brand-red">Ops! √Årea ficou ${val * val
                                }x.</span>`;
                            setTimeout(() => {
                                currentLevel--; // Repete n√≠vel ou s√≥ reinicia
                                // btnNext.classList.remove('hidden');
                                // Para fins did√°ticos, vamos deixar tentar de novo recarregando
                                Array.from(optsGrid.children).forEach(
                                    (b) => (b.disabled = false)
                                );
                            }, 1500);
                        }
                    };

                    btnNext.onclick = () => {
                        currentLevel++;
                        loadLevel();
                    };

                    loadLevel();
                },

                interactive_grid_scaler(container) {
                    // Estado
                    let currentScale = 1;
                    const shapePoints = [
                        { x: 1, y: 1 },
                        { x: 3, y: 1 },
                        { x: 3, y: 2 },
                        { x: 2, y: 2 },
                        { x: 2, y: 3 },
                        { x: 3, y: 3 },
                        { x: 3, y: 4 },
                        { x: 2, y: 4 },
                        { x: 2, y: 6 },
                        { x: 1, y: 6 },
                    ]; // Forma de F

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Raio-X da Amplia√ß√£o</h3>

<div class="flex flex-col md:flex-row gap-8 items-start justify-center w-full mb-6">
<div class="flex flex-col items-center">
<span class="text-[10px] font-bold text-gray-400 uppercase mb-2">Original (1x)</span>
<div class="relative bg-gray-50 border border-gray-300 rounded shadow-inner overflow-hidden" style="width: 100px; height: 140px;">
<div class="absolute inset-0" style="background-image: linear-gradient(#e5e7eb 1px, transparent 1px), linear-gradient(90deg, #e5e7eb 1px, transparent 1px); background-size: 20px 20px;"></div>
<svg width="100" height="140" class="relative z-10"><path id="path-orig" d="" fill="rgba(156, 163, 175, 0.5)" stroke="#6B7280" stroke-width="2"/></svg>
</div>
<div class="mt-2 text-xs text-gray-500 font-mono font-bold">√Årea: 5 u¬≤</div>
</div>

<div class="hidden md:flex flex-col items-center justify-center h-32">
<i class="fas fa-arrow-right text-2xl text-brand-blue transform transition-transform duration-300" id="arrow-icon"></i>
<span class="text-xs font-bold text-brand-blue mt-1" id="scale-label">1x</span>
</div>

<div class="flex flex-col items-center">
<span class="text-[10px] font-bold text-brand-blue uppercase mb-2">Resultado</span>
<div class="relative bg-blue-50 border-2 border-brand-blue rounded shadow-inner overflow-hidden transition-all duration-500" style="width: 200px; height: 280px;">
<div class="absolute inset-0" style="background-image: linear-gradient(#bfdbfe 1px, transparent 1px), linear-gradient(90deg, #bfdbfe 1px, transparent 1px); background-size: 20px 20px;"></div>
<svg width="200" height="280" class="relative z-10"><path id="path-res" d="" fill="rgba(28, 176, 246, 0.3)" stroke="#1CB0F6" stroke-width="3" class="transition-all duration-500 ease-out"/></svg>
</div>
<div class="mt-2 text-sm font-bold text-brand-blue font-mono" id="area-res-text">√Årea: 5 u¬≤</div>
</div>
</div>

<div class="w-full max-w-md bg-gray-100 p-1 rounded-xl flex gap-1 mb-4">
<button class="scale-btn flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all text-gray-500 hover:bg-white" data-s="0.5">0.5x</button>
<button class="scale-btn flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all bg-white text-brand-blue shadow-sm" data-s="1">1x</button>
<button class="scale-btn flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all text-gray-500 hover:bg-white" data-s="2">2x</button>
<button class="scale-btn flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all text-gray-500 hover:bg-white" data-s="3">3x</button>
</div>

<div class="text-center bg-yellow-50 border border-yellow-200 p-3 rounded-lg w-full">
<p class="text-sm text-yellow-900" id="explain-text">A figura √© <strong>Congruente</strong> (igual). A √°rea n√£o mudou.</p>
</div>
</div>
`;

                    const pathOrig = container.querySelector("#path-orig");
                    const pathRes = container.querySelector("#path-res");
                    const areaResText = container.querySelector("#area-res-text");
                    const scaleLabel = container.querySelector("#scale-label");
                    const explainText = container.querySelector("#explain-text");
                    const arrowIcon = container.querySelector("#arrow-icon");
                    const btns = container.querySelectorAll(".scale-btn");
                    const gridUnit = 20;

                    const pointsToPath = (points, scale) => {
                        let d = "";
                        points.forEach((p, i) => {
                            const px = p.x * gridUnit * scale;
                            const py = p.y * gridUnit * scale;
                            d += (i === 0 ? "M" : "L") + ` ${px} ${py} `;
                        });
                        d += "Z";
                        return d;
                    };

                    const update = () => {
                        pathOrig.setAttribute("d", pointsToPath(shapePoints, 1));
                        pathRes.setAttribute(
                            "d",
                            pointsToPath(shapePoints, currentScale)
                        );

                        const baseArea = 5;
                        const areaMult = currentScale * currentScale;
                        const newArea = baseArea * areaMult;

                        areaResText.innerHTML = `√Årea: <span class="text-lg">${newArea}</span> u¬≤`;
                        scaleLabel.innerText = `${currentScale}x`;

                        if (currentScale === 1) {
                            explainText.innerHTML =
                                "A figura √© <strong>Congruente</strong> (tamanho igual). A √°rea mant√©m-se 5 u¬≤.";
                            arrowIcon.style.transform = "scale(1)";
                        } else if (currentScale < 1) {
                            explainText.innerHTML = `O lado caiu pela metade. A √°rea ficou <strong>4 vezes menor</strong>! (${baseArea} √∑ 4 = ${newArea})`;
                            arrowIcon.style.transform = "scale(0.8)";
                        } else {
                            explainText.innerHTML = `O lado aumentou <strong>${currentScale}x</strong>. A √°rea aumentou <strong>${areaMult}x</strong>! (${baseArea} √ó ${areaMult} = ${newArea})`;
                            arrowIcon.style.transform = "scale(1.2)";
                        }
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            currentScale = parseFloat(btn.dataset.s);
                            btns.forEach(
                                (b) =>
                                (b.className =
                                    b === btn
                                        ? "scale-btn flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all bg-white text-brand-blue shadow-sm ring-1 ring-blue-100"
                                        : "scale-btn flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all text-gray-500 hover:bg-white")
                            );
                            update();
                        };
                    });
                    update();
                },

                interactive_decimal_align(container) {
                    // Estado inicial
                    let offset = -2; // Come√ßa desalinhado

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm select-none font-sans">

<div class="text-center mb-6">
<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-1">Miss√£o: Alinhar as V√≠rgulas</h3>
<p class="text-sm text-gray-400">Arraste o n√∫mero de baixo at√© as v√≠rgulas se encontrarem!</p>
</div>

<div class="relative bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl p-8 w-full max-w-sm overflow-hidden flex flex-col items-center justify-center gap-2 mb-6 transition-colors duration-300" id="math-zone">

<div class="absolute top-0 bottom-0 left-1/2 w-0.5 bg-brand-red opacity-50 z-0 dashed-line"></div>

<div class="flex items-baseline text-4xl md:text-5xl font-mono font-bold text-gray-400 z-10 relative">
<span>12</span>
<span class="text-brand-red mx-1">,</span>
<span>5&nbsp;</span> </div>

<div class="absolute left-4 top-1/2 -translate-y-1/2 text-2xl font-bold text-gray-300">+</div>

<div id="movable-row" class="flex items-baseline text-4xl md:text-5xl font-mono font-bold text-brand-blue z-10 relative transition-transform duration-100 cursor-grab active:cursor-grabbing" style="transform: translateX(-50px)">
<span>3</span>
<span class="text-brand-red mx-1 scale-125 inline-block transition-transform" id="comma-2">,</span>
<span>42</span>
</div>

<div class="w-full border-b-4 border-gray-300 mt-2 z-10"></div>

<div id="result-display" class="h-12 mt-2 text-4xl md:text-5xl font-mono font-bold text-brand-green opacity-0 transition-all duration-300 transform translate-y-2">
15,92
</div>
</div>

<div class="w-full max-w-xs px-4">
<input type="range" id="align-slider" min="-4" max="4" value="-2" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue hover:accent-brand-blueDark">
<div class="flex justify-between text-[10px] text-gray-400 font-bold mt-2 uppercase">
<span>Esquerda</span>
<span>Direita</span>
</div>
</div>

<div id="feedback-msg" class="mt-4 font-bold text-brand-red animate-pulse">
<i class="fas fa-times-circle"></i> V√≠rgula desalinhada!
</div>

</div>
`;

                    const slider = container.querySelector("#align-slider");
                    const movableRow = container.querySelector("#movable-row");
                    const mathZone = container.querySelector("#math-zone");
                    const resultDisplay = container.querySelector("#result-display");
                    const feedbackMsg = container.querySelector("#feedback-msg");
                    const comma2 = container.querySelector("#comma-2");

                    const update = () => {
                        const val = parseInt(slider.value);

                        // Move visualmente (Aprox 24px por passo do slider para alinhar com a fonte mono)
                        // O valor 0 do slider √© o "Centro Correto"
                        const pxOffset = val * 24;
                        movableRow.style.transform = `translateX(${pxOffset}px)`;

                        if (val === 0) {
                            // ALINHADO
                            mathZone.classList.remove("border-gray-300", "bg-gray-50");
                            mathZone.classList.add("border-brand-green", "bg-green-50");

                            resultDisplay.style.opacity = 1;
                            resultDisplay.style.transform = "translateY(0)";

                            feedbackMsg.className = "mt-4 font-bold text-brand-green";
                            feedbackMsg.innerHTML = `<i class="fas fa-check-circle"></i> Perfeito! V√≠rgula sobre v√≠rgula.`;

                            comma2.classList.add("scale-150", "text-brand-green");
                        } else {
                            // DESALINHADO
                            mathZone.classList.add("border-gray-300", "bg-gray-50");
                            mathZone.classList.remove("border-brand-green", "bg-green-50");

                            resultDisplay.style.opacity = 0;
                            resultDisplay.style.transform = "translateY(10px)";

                            feedbackMsg.className = "mt-4 font-bold text-brand-red";
                            feedbackMsg.innerHTML = `<i class="fas fa-times-circle"></i> V√≠rgula desalinhada!`;

                            comma2.classList.remove("scale-150", "text-brand-green");
                        }
                    };

                    slider.addEventListener("input", update);
                    update(); // Init
                },

                interactive_percent_grid(container) {
                    // Estado
                    let percent = 50;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Visualize a Porcentagem</h3>

<div class="flex flex-col md:flex-row gap-8 items-center">

<div class="relative w-48 h-48 bg-gray-100 border-2 border-gray-300 grid grid-cols-10 grid-rows-10 gap-px p-1 rounded shadow-inner" id="grid-container">
</div>

<div class="flex flex-col gap-4 w-full max-w-xs text-center">
<div>
<div class="text-5xl font-black text-brand-blue mb-2"><span id="val-disp">50</span>%</div>
<div class="text-xs font-bold text-gray-400 uppercase tracking-wider">
<span id="frac-disp">50/100</span> ‚Ä¢ <span id="dec-disp">0,50</span>
</div>
</div>

<input type="range" id="slider" min="0" max="100" value="50" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue hover:accent-brand-blueDark">

<div class="flex justify-between w-full gap-2">
<button class="preset-btn flex-1 py-2 bg-gray-50 hover:bg-gray-100 rounded text-xs font-bold text-gray-500 transition-colors border border-gray-200" data-v="10">10%</button>
<button class="preset-btn flex-1 py-2 bg-gray-50 hover:bg-gray-100 rounded text-xs font-bold text-gray-500 transition-colors border border-gray-200" data-v="25">25%</button>
<button class="preset-btn flex-1 py-2 bg-gray-50 hover:bg-gray-100 rounded text-xs font-bold text-gray-500 transition-colors border border-gray-200" data-v="50">50%</button>
<button class="preset-btn flex-1 py-2 bg-gray-50 hover:bg-gray-100 rounded text-xs font-bold text-gray-500 transition-colors border border-gray-200" data-v="75">75%</button>
<button class="preset-btn flex-1 py-2 bg-gray-50 hover:bg-gray-100 rounded text-xs font-bold text-gray-500 transition-colors border border-gray-200" data-v="100">100%</button>
</div>
</div>

</div>
</div>
`;

                    const gridEl = container.querySelector("#grid-container");
                    const slider = container.querySelector("#slider");
                    const valDisp = container.querySelector("#val-disp");
                    const fracDisp = container.querySelector("#frac-disp");
                    const decDisp = container.querySelector("#dec-disp");
                    const presets = container.querySelectorAll(".preset-btn");

                    // Gera 100 c√©lulas
                    for (let i = 0; i < 100; i++) {
                        const cell = document.createElement("div");
                        cell.className =
                            "bg-white rounded-[1px] transition-colors duration-100";
                        gridEl.appendChild(cell);
                    }

                    const cells = gridEl.children;

                    const update = () => {
                        const val = parseInt(slider.value);
                        valDisp.innerText = val;
                        fracDisp.innerText = `${val}/100`;
                        decDisp.innerText = (val / 100).toFixed(2).replace(".", ",");

                        for (let i = 0; i < 100; i++) {
                            // Preenche de baixo para cima, esquerda para direita? Ou normal?
                            // Normal (√≠ndice < val) √© mais f√°cil de ler como texto.
                            if (i < val) {
                                cells[i].className =
                                    "bg-brand-blue rounded-[1px] transition-colors duration-100 shadow-sm";
                            } else {
                                cells[i].className =
                                    "bg-white rounded-[1px] transition-colors duration-100";
                            }
                        }
                    };

                    slider.addEventListener("input", update);
                    presets.forEach((btn) => {
                        btn.onclick = () => {
                            slider.value = btn.dataset.v;
                            update();
                        };
                    });

                    update();
                },

                interactive_discount_game(container) {
                    // Banco de Produtos
                    const items = [
                        { name: "T√™nis", price: 100, discount: 20, icon: "üëü" },
                        { name: "Bon√©", price: 50, discount: 10, icon: "üß¢" },
                        { name: "Game", price: 200, discount: 50, icon: "üéÆ" },
                        { name: "Fone", price: 80, discount: 25, icon: "üéß" },
                        { name: "Mochila", price: 120, discount: 10, icon: "üéí" },
                    ];

                    let currentItem = null;
                    let score = 0;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full items-center mb-4 border-b-2 border-gray-100 pb-2">
<h3 class="text-brand-green font-black uppercase text-xs tracking-widest"><i class="fas fa-shopping-cart"></i> Calculadora de Descontos</h3>
<div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black shadow-sm">Pontos: <span id="score-val">0</span></div>
</div>

<div class="relative bg-gray-50 rounded-2xl p-6 mb-6 w-full max-w-sm flex items-center justify-between border-2 border-gray-200 shadow-sm transition-all" id="product-card">

<div class="absolute -top-3 -right-3 bg-brand-red text-white font-black px-3 py-1 rounded-lg shadow-md transform rotate-12 text-sm animate-pulse">
-<span id="discount-val">20</span>%
</div>

<div class="text-6xl mr-4" id="prod-icon">üëü</div>

<div class="text-right">
<p class="text-xs font-bold text-gray-400 uppercase mb-1" id="prod-name">T√™nis</p>
<p class="text-3xl font-black text-brand-text decoration-2" id="prod-price">R$ 100</p>
</div>

</div>

<p class="text-sm text-gray-500 font-bold mb-4 text-center">Qual √© o pre√ßo final?</p>

<div class="grid grid-cols-2 gap-3 w-full max-w-sm" id="opts-grid">
</div>

<div id="feedback-msg" class="h-8 mt-4 text-sm font-black text-center w-full flex items-center justify-center"></div>

<button id="btn-next" class="hidden w-full bg-brand-blue text-white font-bold py-3 rounded-xl shadow-btn mt-2 animate-pop-in">Pr√≥ximo Produto</button>

</div>
`;

                    const prodIcon = container.querySelector("#prod-icon");
                    const prodName = container.querySelector("#prod-name");
                    const prodPrice = container.querySelector("#prod-price");
                    const discountVal = container.querySelector("#discount-val");
                    const optsGrid = container.querySelector("#opts-grid");
                    const scoreVal = container.querySelector("#score-val");
                    const feedbackMsg = container.querySelector("#feedback-msg");
                    const btnNext = container.querySelector("#btn-next");
                    const productCard = container.querySelector("#product-card");

                    const loadLevel = () => {
                        currentItem = items[Math.floor(Math.random() * items.length)];

                        // Renderiza Produto
                        prodIcon.innerText = currentItem.icon;
                        prodName.innerText = currentItem.name;
                        prodPrice.innerText = `R$ ${currentItem.price}`;
                        discountVal.innerText = currentItem.discount;

                        // Reseta UI
                        feedbackMsg.innerHTML = "";
                        btnNext.classList.add("hidden");
                        productCard.className =
                            "relative bg-gray-50 rounded-2xl p-6 mb-6 w-full max-w-sm flex items-center justify-between border-2 border-gray-200 shadow-sm transition-all";

                        // Calcula Resposta Correta
                        const discountAmount =
                            (currentItem.price * currentItem.discount) / 100;
                        const finalPrice = currentItem.price - discountAmount;

                        // Gera Op√ß√µes (1 correta + 3 erradas inteligentes)
                        let options = [finalPrice];

                        // Erro comum 1: Subtrair o percentual direto (ex: 100 - 20 = 80 ok, mas 80 - 25% = 60. Erro seria 80 - 25 = 55)
                        options.push(currentItem.price - currentItem.discount);

                        // Erro comum 2: Calcular apenas o valor do desconto
                        options.push(discountAmount);

                        // Erro comum 3: Valor aleat√≥rio pr√≥ximo
                        options.push(finalPrice + 10);

                        // Remove duplicatas e garante 4 op√ß√µes
                        options = [...new Set(options)].filter(
                            (o) => o > 0 && o !== finalPrice
                        );
                        while (options.length < 3)
                            options.push(Math.floor(Math.random() * currentItem.price));

                        // Readiciona a correta e embaralha
                        options = [finalPrice, ...options.slice(0, 3)];
                        options.sort(() => Math.random() - 0.5);

                        optsGrid.innerHTML = "";
                        options.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-white border-b-4 border-gray-200 text-gray-600 font-bold text-xl py-4 rounded-xl hover:bg-blue-50 hover:border-blue-200 hover:text-brand-blue transition-all active:border-b-0 active:translate-y-1 flex items-center justify-center";
                            btn.innerText = `R$ ${opt}`;
                            btn.onclick = () => checkAnswer(opt, finalPrice, btn);
                            optsGrid.appendChild(btn);
                        });
                    };

                    const checkAnswer = (val, correct, btn) => {
                        // Trava bot√µes
                        Array.from(optsGrid.children).forEach((b) => (b.disabled = true));

                        if (val === correct) {
                            score += 100;
                            scoreVal.innerText = score;

                            btn.classList.remove(
                                "bg-white",
                                "text-gray-600",
                                "border-gray-200"
                            );
                            btn.classList.add(
                                "bg-brand-green",
                                "text-white",
                                "border-green-700",
                                "transform",
                                "scale-105"
                            );
                            btn.innerHTML += ' <i class="fas fa-check ml-2"></i>';

                            feedbackMsg.innerHTML = `<span class="text-brand-green flex items-center gap-2"><i class="fas fa-check-circle"></i> Economizou R$ ${currentItem.price - correct
                                }!</span>`;
                            productCard.classList.add("border-brand-green", "bg-green-50");

                            btnNext.classList.remove("hidden");
                        } else {
                            btn.classList.remove(
                                "bg-white",
                                "text-gray-600",
                                "border-gray-200"
                            );
                            btn.classList.add(
                                "bg-brand-red",
                                "text-white",
                                "border-red-700",
                                "animate-shake"
                            );

                            feedbackMsg.innerHTML = `<span class="text-brand-red">Ops! Era R$ ${correct}</span>`;

                            // Mostra a correta
                            Array.from(optsGrid.children).forEach((b) => {
                                if (b.innerText.includes(correct)) {
                                    b.classList.add(
                                        "bg-green-100",
                                        "text-green-800",
                                        "border-green-200"
                                    );
                                }
                            });

                            btnNext.classList.remove("hidden");
                        }
                    };

                    btnNext.onclick = loadLevel;

                    // Init
                    loadLevel();

                    // CSS Shake (se n√£o tiver)
                    if (!document.getElementById("anim-shake")) {
                        const s = document.createElement("style");
                        s.id = "anim-shake";
                        s.innerHTML = `@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } } .animate-shake { animation: shake 0.3s ease-in-out; }`;
                        container.appendChild(s);
                    }
                },

                interactive_perimeter_game(container) {
                    // Configura√ß√£o dos N√≠veis
                    const levels = [
                        {
                            type: "rect",
                            w: 8,
                            h: 4,
                            missing: [],
                            hint: "F√°cil: √â um ret√¢ngulo.",
                            ans: 24,
                        },
                        {
                            type: "L",
                            w: 6,
                            h: 6,
                            cutW: 2,
                            cutH: 2,
                            missing: ["right", "top-inner"],
                            hint: "Forma L: Lados paralelos se somam.",
                            ans: 24,
                        },
                        {
                            type: "U",
                            w: 5,
                            h: 5,
                            cutW: 3,
                            cutH: 3,
                            missing: ["inner"],
                            hint: "Forma U: Cuidado com o buraco!",
                            ans: 26, // (5+5+5) externos + (3) interno base + (3+3) laterais internas? N√£o, simplificado: 5+5+1+1+3+3+1+1 = 20. Vamos fixar.
                            // U shape 5x5 com buraco 3x3 no topo
                            // Lados: 5(esq), 5(dir), 5(baixo). Topo: 1, 1. Buraco desce 3, anda 3, sobe 3.
                            // Perimetro: 5+5+5 + 1+1 + 3+3+3 = 26.
                        },
                    ];

                    let currentLevel = 0;
                    let score = 0;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full items-center mb-4 border-b-2 border-gray-100 pb-2">
<h3 class="text-brand-blue font-black uppercase text-xs tracking-widest"><i class="fas fa-ruler-combined"></i> Calculadora de Cerca</h3>
<div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black shadow-sm">Pontos: <span id="score-val">0</span></div>
</div>

<div class="relative w-64 h-48 bg-gray-50 border-2 border-dashed border-gray-200 rounded-xl mb-6 flex items-center justify-center">
<svg width="200" height="150" viewBox="0 0 200 150" id="game-svg" class="overflow-visible">
</svg>
</div>

<div class="w-full max-w-xs flex flex-col items-center gap-3">
<p class="text-xs text-gray-400 font-bold uppercase" id="hint-text">...</p>
<div class="flex gap-2 w-full">
<input type="number" id="user-ans" class="flex-1 border-2 border-brand-blue rounded-xl p-3 font-bold text-center text-xl outline-none focus:bg-blue-50 text-brand-blue" placeholder="?">
<button id="btn-check" class="bg-brand-green text-white font-bold px-6 rounded-xl shadow-btn active:scale-95 transition-all">OK</button>
</div>
</div>

<div id="feedback" class="h-8 mt-4 text-sm font-bold text-center"></div>

<button id="btn-next" class="hidden w-full bg-brand-blue text-white font-bold py-3 rounded-xl shadow-btn mt-2 animate-pop-in">Pr√≥ximo N√≠vel</button>

</div>
`;

                    const svg = container.querySelector("#game-svg");
                    const hintText = container.querySelector("#hint-text");
                    const input = container.querySelector("#user-ans");
                    const btnCheck = container.querySelector("#btn-check");
                    const btnNext = container.querySelector("#btn-next");
                    const feedback = container.querySelector("#feedback");
                    const scoreVal = container.querySelector("#score-val");

                    const loadLevel = () => {
                        if (currentLevel >= levels.length) {
                            hintText.innerText = "Voc√™ √© um mestre!";
                            svg.innerHTML =
                                '<text x="100" y="75" text-anchor="middle" font-size="40">üèÜ</text>';
                            input.disabled = true;
                            btnCheck.disabled = true;
                            btnNext.classList.add("hidden");
                            return;
                        }

                        const lvl = levels[currentLevel];
                        hintText.innerText = lvl.hint;
                        input.value = "";
                        feedback.innerText = "";
                        btnNext.classList.add("hidden");

                        // Renderiza Forma SVG
                        let d = "";
                        let labels = "";
                        const scale = 20;
                        const cx = 100,
                            cy = 75;

                        if (lvl.type === "rect") {
                            const w = lvl.w * scale;
                            const h = lvl.h * scale;
                            d = `M ${cx - w / 2} ${cy - h / 2} H ${cx + w / 2} V ${cy + h / 2
                                } H ${cx - w / 2} Z`;
                            labels += `<text x="${cx}" y="${cy - h / 2 - 5
                                }" text-anchor="middle" font-size="12" fill="#4B4B4B" font-weight="bold">${lvl.w
                                }</text>`;
                            labels += `<text x="${cx + w / 2 + 5
                                }" y="${cy}" text-anchor="start" font-size="12" fill="#4B4B4B" font-weight="bold">${lvl.h
                                }</text>`;
                        } else if (lvl.type === "L") {
                            // L Shape
                            // 0,0 -> w,0 -> w,cutH -> cutW,cutH -> cutW,h -> 0,h -> Z
                            const w = lvl.w * scale;
                            const h = lvl.h * scale;
                            const cw = (lvl.w - lvl.cutW) * scale; // largura da perna
                            const ch = (lvl.h - lvl.cutH) * scale; // altura da base

                            // Centralizando offset
                            const ox = cx - w / 2;
                            const oy = cy - h / 2;

                            d = `M ${ox} ${oy} H ${ox + cw} V ${oy + lvl.cutH * scale} H ${ox + w
                                } V ${oy + h} H ${ox} Z`;

                            // Labels
                            labels += `<text x="${ox - 10
                                }" y="${cy}" text-anchor="end" font-size="12" fill="#4B4B4B" font-weight="bold">${lvl.h
                                }</text>`; // Altura Total
                            labels += `<text x="${cx}" y="${oy + h + 15
                                }" text-anchor="middle" font-size="12" fill="#4B4B4B" font-weight="bold">${lvl.w
                                }</text>`; // Largura Total
                            labels += `<text x="${ox + cw / 2}" y="${oy - 5
                                }" text-anchor="middle" font-size="12" fill="#4B4B4B" font-weight="bold">${lvl.w - lvl.cutW
                                }</text>`; // Topo
                            labels += `<text x="${ox + w + 5}" y="${oy + h - (h - lvl.cutH * scale) / 2
                                }" text-anchor="start" font-size="12" fill="#4B4B4B" font-weight="bold">${lvl.h - lvl.cutH
                                }</text>`; // Direita Baixo
                        }

                        svg.innerHTML = `<path d="${d}" fill="rgba(28, 176, 246, 0.2)" stroke="#1CB0F6" stroke-width="3" /> ${labels}`;
                    };

                    btnCheck.onclick = () => {
                        const ans = parseInt(input.value);
                        const correct = levels[currentLevel].ans;

                        if (ans === correct) {
                            score += 100;
                            scoreVal.innerText = score;
                            feedback.innerHTML = `<span class="text-brand-green">Correto! Per√≠metro = ${ans}</span>`;
                            btnNext.classList.remove("hidden");
                        } else {
                            feedback.innerHTML = `<span class="text-brand-red">Ops! Tente somar todos os lados.</span>`;
                        }
                    };

                    btnNext.onclick = () => {
                        currentLevel++;
                        loadLevel();
                    };

                    loadLevel();
                },

                interactive_area_game(container) {
                    const levels = [
                        { type: "rect", b: 5, h: 4, hint: "Base x Altura", ans: 20 },
                        { type: "tri", b: 6, h: 4, hint: "(Base x Altura) / 2", ans: 12 },
                        {
                            type: "L",
                            w: 4,
                            h: 4,
                            cutW: 2,
                            cutH: 2,
                            hint: "Divida em dois ret√¢ngulos!",
                            ans: 12,
                        },
                        // L Shape: Total 4x4 (16) - Corte 2x2 (4) = 12. Ou (2x4) + (2x2) = 8+4 = 12.
                    ];

                    let currentLevel = 0;
                    let score = 0;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full items-center mb-4 border-b-2 border-gray-100 pb-2">
<h3 class="text-brand-green font-black uppercase text-xs tracking-widest"><i class="fas fa-hammer"></i> Mestre de Obras</h3>
<div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black shadow-sm">Pontos: <span id="score-val">0</span></div>
</div>

<div class="relative w-64 h-48 bg-gray-50 border-2 border-dashed border-gray-200 rounded-xl mb-6 flex items-center justify-center">
<div class="absolute inset-0 pointer-events-none opacity-20" style="background-image: linear-gradient(#cbd5e1 1px, transparent 1px), linear-gradient(90deg, #cbd5e1 1px, transparent 1px); background-size: 20px 20px;"></div>

<svg width="200" height="150" viewBox="0 0 200 150" id="game-svg" class="overflow-visible relative z-10">
</svg>
</div>

<div class="w-full max-w-xs flex flex-col items-center gap-3">
<p class="text-xs text-gray-400 font-bold uppercase" id="hint-text">...</p>
<div class="flex gap-2 w-full">
<input type="number" id="user-ans" class="flex-1 border-2 border-brand-blue rounded-xl p-3 font-bold text-center text-xl outline-none focus:bg-blue-50 text-brand-blue" placeholder="?">
<button id="btn-check" class="bg-brand-green text-white font-bold px-6 rounded-xl shadow-btn active:scale-95 transition-all">OK</button>
</div>
</div>

<div id="feedback" class="h-8 mt-4 text-sm font-bold text-center"></div>

<button id="btn-next" class="hidden w-full bg-brand-blue text-white font-bold py-3 rounded-xl shadow-btn mt-2 animate-pop-in">Pr√≥ximo Projeto</button>

</div>
`;

                    const svg = container.querySelector("#game-svg");
                    const hintText = container.querySelector("#hint-text");
                    const input = container.querySelector("#user-ans");
                    const btnCheck = container.querySelector("#btn-check");
                    const btnNext = container.querySelector("#btn-next");
                    const feedback = container.querySelector("#feedback");
                    const scoreVal = container.querySelector("#score-val");

                    const loadLevel = () => {
                        if (currentLevel >= levels.length) {
                            hintText.innerText = "Voc√™ √© um Engenheiro Master!";
                            svg.innerHTML =
                                '<text x="100" y="75" text-anchor="middle" font-size="40">üèóÔ∏è</text>';
                            input.disabled = true;
                            btnCheck.disabled = true;
                            btnNext.classList.add("hidden");
                            return;
                        }

                        const lvl = levels[currentLevel];
                        hintText.innerText = lvl.hint;
                        input.value = "";
                        feedback.innerText = "";
                        btnNext.classList.add("hidden");

                        // Renderiza Forma SVG (Escala 20px por unidade)
                        const scale = 20;
                        const cx = 100,
                            cy = 75;
                        let d = "";
                        let labels = "";

                        if (lvl.type === "rect") {
                            const w = lvl.b * scale;
                            const h = lvl.h * scale;
                            d = `M ${cx - w / 2} ${cy - h / 2} H ${cx + w / 2} V ${cy + h / 2
                                } H ${cx - w / 2} Z`;
                            labels += `<text x="${cx}" y="${cy - h / 2 - 5
                                }" text-anchor="middle" font-size="12" fill="#4B4B4B" font-weight="bold">${lvl.b
                                }</text>`;
                            labels += `<text x="${cx + w / 2 + 5
                                }" y="${cy}" text-anchor="start" font-size="12" fill="#4B4B4B" font-weight="bold">${lvl.h
                                }</text>`;
                        } else if (lvl.type === "tri") {
                            const w = lvl.b * scale;
                            const h = lvl.h * scale;
                            // Is√≥sceles
                            d = `M ${cx - w / 2} ${cy + h / 2} L ${cx + w / 2} ${cy + h / 2
                                } L ${cx} ${cy - h / 2} Z`;
                            labels += `<text x="${cx}" y="${cy + h / 2 + 15
                                }" text-anchor="middle" font-size="12" fill="#4B4B4B" font-weight="bold">${lvl.b
                                }</text>`;
                            // Altura tracejada
                            labels += `<line x1="${cx}" y1="${cy - h / 2}" x2="${cx}" y2="${cy + h / 2
                                }" stroke="#999" stroke-dasharray="4" />`;
                            labels += `<text x="${cx + 5
                                }" y="${cy}" text-anchor="start" font-size="12" fill="#4B4B4B" font-weight="bold">${lvl.h
                                }</text>`;
                        } else if (lvl.type === "L") {
                            // L Shape
                            const w = lvl.w * scale;
                            const h = lvl.h * scale;
                            const cw = (lvl.w - lvl.cutW) * scale;
                            const ch = (lvl.h - lvl.cutH) * scale;
                            const ox = cx - w / 2;
                            const oy = cy - h / 2;

                            d = `M ${ox} ${oy} H ${ox + cw} V ${oy + lvl.cutH * scale} H ${ox + w
                                } V ${oy + h} H ${ox} Z`;

                            // Labels parciais para for√ßar decomposi√ß√£o
                            labels += `<text x="${ox - 10
                                }" y="${cy}" text-anchor="end" font-size="12" fill="#4B4B4B" font-weight="bold">${lvl.h
                                }</text>`; // Alt total
                            labels += `<text x="${cx}" y="${oy + h + 15
                                }" text-anchor="middle" font-size="12" fill="#4B4B4B" font-weight="bold">${lvl.w
                                }</text>`; // Larg total
                            labels += `<text x="${ox + cw / 2}" y="${oy - 5
                                }" text-anchor="middle" font-size="12" fill="#4B4B4B" font-weight="bold">${lvl.w - lvl.cutW
                                }</text>`; // Topo
                            labels += `<text x="${ox + w + 5}" y="${oy + h - (h - lvl.cutH * scale) / 2
                                }" text-anchor="start" font-size="12" fill="#4B4B4B" font-weight="bold">${lvl.h - lvl.cutH
                                }</text>`; // Dir Baixo
                        }

                        svg.innerHTML = `<path d="${d}" fill="rgba(16, 185, 129, 0.2)" stroke="#10B981" stroke-width="3" /> ${labels}`;
                    };

                    btnCheck.onclick = () => {
                        const ans = parseInt(input.value);
                        const correct = levels[currentLevel].ans;

                        if (ans === correct) {
                            score += 100;
                            scoreVal.innerText = score;
                            feedback.innerHTML = `<span class="text-brand-green">Correto! √Årea = ${ans}</span>`;
                            btnNext.classList.remove("hidden");
                        } else {
                            feedback.innerHTML = `<span class="text-brand-red">Ops! A resposta certa era ${correct}.</span>`;
                            // Permite avan√ßar mesmo errando para n√£o travar
                            btnNext.classList.remove("hidden");
                        }
                    };

                    btnNext.onclick = () => {
                        currentLevel++;
                        loadLevel();
                    };

                    loadLevel();
                },

                interactive_perimeter_area_explorer(container) {
                    // Estado
                    let side = 1;

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Laborat√≥rio de Crescimento</h3>

<div class="flex flex-col md:flex-row gap-8 items-end w-full justify-center mb-8 h-64">

<div class="relative w-48 h-48 bg-gray-50 border border-gray-200 rounded-lg flex items-end justify-start p-1 overflow-hidden">
<div class="absolute inset-0" style="background-image: radial-gradient(#cbd5e1 1px, transparent 1px); background-size: 20px 20px;"></div>
<div id="square-visual" class="bg-brand-blue transition-all duration-300 border-2 border-blue-600 shadow-lg relative group">
<span class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-white font-bold text-xs opacity-0 group-hover:opacity-100 transition-opacity" id="area-label">1</span>
</div>
</div>

<div class="flex gap-6 items-end h-full w-full md:w-auto px-4">
<div class="flex flex-col items-center gap-2 h-full justify-end w-16">
<span class="text-xs font-bold text-brand-green" id="val-p">4</span>
<div id="bar-p" class="w-full bg-green-100 border-2 border-brand-green rounded-t-lg transition-all duration-300 relative group">
<div class="absolute -top-8 left-1/2 -translate-x-1/2 bg-black text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 whitespace-nowrap transition-opacity">Per√≠metro (4xL)</div>
</div>
<span class="text-[10px] font-bold text-gray-400 uppercase">Per√≠metro</span>
</div>

<div class="flex flex-col items-center gap-2 h-full justify-end w-16">
<span class="text-xs font-bold text-brand-orange" id="val-a">1</span>
<div id="bar-a" class="w-full bg-orange-100 border-2 border-brand-orange rounded-t-lg transition-all duration-300 relative group">
<div class="absolute -top-8 left-1/2 -translate-x-1/2 bg-black text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 whitespace-nowrap transition-opacity">√Årea (LxL)</div>
</div>
<span class="text-[10px] font-bold text-gray-400 uppercase">√Årea</span>
</div>
</div>

</div>

<div class="w-full max-w-xs px-4">
<div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-2">
<span>Lado: <span id="side-val" class="text-brand-blue text-lg">1</span></span>
</div>
<input type="range" id="side-slider" min="1" max="5" value="1" step="1" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue hover:accent-brand-blueDark">
<div class="flex justify-between text-[10px] text-gray-300 font-bold mt-1 px-1">
<span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
</div>
</div>

<div class="mt-6 text-center text-sm text-gray-500 italic" id="comparison-text">
Aumente o lado para ver o que acontece!
</div>

</div>
`;

                    const slider = container.querySelector("#side-slider");
                    const square = container.querySelector("#square-visual");
                    const sideVal = container.querySelector("#side-val");
                    const barP = container.querySelector("#bar-p");
                    const barA = container.querySelector("#bar-a");
                    const valP = container.querySelector("#val-p");
                    const valA = container.querySelector("#val-a");
                    const areaLabel = container.querySelector("#area-label");
                    const compText = container.querySelector("#comparison-text");

                    const update = () => {
                        const s = parseInt(slider.value);
                        sideVal.innerText = s;

                        // C√°lculos
                        const p = s * 4;
                        const a = s * s;

                        // Atualiza Visual do Quadrado (20px por unidade)
                        const pxSize = s * 20;
                        square.style.width = `${pxSize}px`;
                        square.style.height = `${pxSize}px`;
                        areaLabel.innerText = a;

                        // Atualiza Barras (Normalizadas para max 5 -> P=20, A=25)
                        // Altura m√°xima do container ~150px
                        const maxH = 150;
                        const maxVal = 25; // 5x5

                        barP.style.height = `${(p / maxVal) * maxH}px`;
                        barA.style.height = `${(a / maxVal) * maxH}px`;

                        valP.innerText = p;
                        valA.innerText = a;

                        // Texto Comparativo
                        if (s === 1) {
                            compText.innerHTML =
                                "In√≠cio: Per√≠metro ganha da √Årea (4 vs 1).";
                        } else if (s < 4) {
                            compText.innerHTML =
                                "O Per√≠metro cresce devagar... A √Årea est√° acelerando!";
                        } else if (s === 4) {
                            compText.innerHTML = "Empate! Per√≠metro 16, √Årea 16.";
                        } else {
                            compText.innerHTML =
                                "<strong>BOOM!</strong> A √Årea ultrapassou o Per√≠metro!";
                        }
                    };

                    slider.addEventListener("input", update);
                    update();
                },


                interactive_area_growth_quiz(container) {
                    const questions = [
                        { q: "Se o lado dobra (2x), a √°rea aumenta...", opts: ["2x", "4x", "6x", "8x"], ans: 1 },
                        { q: "Se o lado triplica (3x), a √°rea aumenta...", opts: ["3x", "6x", "9x", "12x"], ans: 2 },
                        { q: "Um quadrado de lado 10 tem √°rea 100. Um de lado 20 ter√°...", opts: ["200", "300", "400", "1000"], ans: 2 },
                        { q: "Para a √°rea quadruplicar (4x), o lado deve...", opts: ["Dobrar", "Triplicar", "Quadruplicar", "Ficar igual"], ans: 0 }
                    ];

                    let currentQ = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-6 border-b-2 border-gray-100 pb-2">
            <h3 class="text-brand-red font-black uppercase text-xs tracking-widest"><i class="fas fa-fire"></i> Quiz Explosivo</h3>
            <div class="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-xs font-black shadow-sm">Quest√£o <span id="q-num">1</span>/4</div>
        </div>

        <div class="mb-8 text-center w-full">
            <p class="text-xl md:text-2xl font-black text-brand-text leading-tight" id="q-text">...</p>
        </div>

        <div class="grid grid-cols-2 gap-4 w-full max-w-md" id="opts-container">
        </div>

        <div id="feedback-area" class="hidden mt-6 text-center animate-pop-in">
            <div class="text-4xl mb-2" id="fb-icon"></div>
            <p class="font-bold text-lg" id="fb-msg"></p>
            <button id="btn-next" class="mt-4 bg-brand-blue text-white font-bold py-2 px-8 rounded-xl shadow-btn active:scale-95">Pr√≥ximo</button>
        </div>

    </div>
    `;

                    const qText = container.querySelector('#q-text');
                    const qNum = container.querySelector('#q-num');
                    const optsContainer = container.querySelector('#opts-container');
                    const feedbackArea = container.querySelector('#feedback-area');
                    const fbIcon = container.querySelector('#fb-icon');
                    const fbMsg = container.querySelector('#fb-msg');
                    const btnNext = container.querySelector('#btn-next');

                    // Fun√ß√£o Interna de Reset
                    const restartGame = () => {
                        currentQ = 0;
                        score = 0;
                        loadQuestion();
                    };

                    const loadQuestion = () => {
                        if (currentQ >= questions.length) {
                            qText.innerText = "Fim de Jogo!";
                            optsContainer.innerHTML = "";
                            feedbackArea.innerHTML = `
                <div class="text-5xl mb-2">üèÜ</div>
                <p class="text-gray-500 font-bold">Voc√™ acertou ${score} de ${questions.length}!</p>
                <button id="btn-restart-quiz" class="mt-4 bg-gray-200 text-gray-700 font-bold py-2 px-8 rounded-xl hover:bg-gray-300">Jogar Novamente</button>
            `;
                            feedbackArea.classList.remove('hidden');

                            // Re-bind do bot√£o de restart gerado dinamicamente
                            const btnRestart = container.querySelector('#btn-restart-quiz');
                            btnRestart.onclick = restartGame;
                            return;
                        }

                        const q = questions[currentQ];
                        qText.innerText = q.q;
                        qNum.innerText = currentQ + 1;
                        feedbackArea.classList.add('hidden');

                        optsContainer.innerHTML = '';
                        q.opts.forEach((opt, i) => {
                            const btn = document.createElement('button');
                            btn.className = "bg-white border-b-4 border-gray-200 text-gray-600 font-bold text-lg py-4 rounded-xl hover:bg-blue-50 hover:border-blue-200 hover:text-brand-blue transition-all active:border-b-0 active:translate-y-1";
                            btn.innerText = opt;
                            btn.onclick = () => check(i, btn);
                            optsContainer.appendChild(btn);
                        });
                    };

                    const check = (selected, btn) => {
                        const q = questions[currentQ];
                        const isCorrect = selected === q.ans;

                        // Disable all
                        Array.from(optsContainer.children).forEach(b => b.disabled = true);

                        if (isCorrect) {
                            score++;
                            btn.classList.replace('border-gray-200', 'border-green-600');
                            btn.classList.add('bg-brand-green', 'text-white');
                            fbIcon.innerText = "üéâ";
                            fbMsg.innerText = "Isso a√≠! Regra do quadrado.";
                            fbMsg.className = "font-bold text-lg text-brand-green";
                        } else {
                            btn.classList.replace('border-gray-200', 'border-red-600');
                            btn.classList.add('bg-brand-red', 'text-white', 'animate-shake');
                            fbIcon.innerText = "üìâ";
                            fbMsg.innerText = "Ops! Lembre-se de elevar ao quadrado.";
                            fbMsg.className = "font-bold text-lg text-brand-red";

                            // Show correct
                            optsContainer.children[q.ans].classList.add('bg-green-100', 'text-green-800', 'border-green-200');
                        }

                        feedbackArea.classList.remove('hidden');
                    };

                    btnNext.onclick = () => {
                        currentQ++;
                        loadQuestion();
                    };

                    loadQuestion();
                },


                interactive_parity_visualizer(container) {
                    let currentNum = 7;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
<h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Raio-X de Pares</h3>

<div class="flex items-center gap-4 mb-6">
<button id="btn-minus" class="w-10 h-10 rounded-full bg-gray-100 text-gray-600 font-black hover:bg-gray-200 transition-colors">-</button>
<div class="text-4xl font-black text-brand-text w-16 text-center" id="num-display">7</div>
<button id="btn-plus" class="w-10 h-10 rounded-full bg-gray-100 text-gray-600 font-black hover:bg-gray-200 transition-colors">+</button>
</div>

<div id="dots-area" class="flex flex-wrap justify-center gap-2 max-w-xs min-h-[100px] mb-4 transition-all">
</div>

<div id="result-badge" class="px-6 py-2 rounded-full font-black text-white text-lg uppercase tracking-wider shadow-md transition-all transform scale-0">
√çMPAR
</div>
<p id="result-desc" class="text-xs text-gray-400 mt-2 font-bold"></p>

</div>
`;

                    const numDisplay = container.querySelector("#num-display");
                    const dotsArea = container.querySelector("#dots-area");
                    const resultBadge = container.querySelector("#result-badge");
                    const resultDesc = container.querySelector("#result-desc");

                    const update = () => {
                        numDisplay.innerText = currentNum;
                        dotsArea.innerHTML = "";

                        const isEven = currentNum % 2 === 0;

                        // Gera pares
                        const pairs = Math.floor(currentNum / 2);
                        const remainder = currentNum % 2;

                        for (let i = 0; i < pairs; i++) {
                            const pairDiv = document.createElement("div");
                            pairDiv.className =
                                "flex gap-1 bg-gray-50 border border-gray-200 p-1 rounded-lg animate-pop-in";
                            pairDiv.style.animationDelay = `${i * 0.1}s`;

                            pairDiv.innerHTML = `
<div class="w-6 h-6 rounded-full bg-brand-blue shadow-sm"></div>
<div class="w-6 h-6 rounded-full bg-brand-blue shadow-sm"></div>
`;
                            dotsArea.appendChild(pairDiv);
                        }

                        if (remainder) {
                            const singleDiv = document.createElement("div");
                            singleDiv.className =
                                "flex gap-1 bg-orange-50 border border-orange-200 p-1 rounded-lg animate-pop-in";
                            singleDiv.style.animationDelay = `${pairs * 0.1}s`;
                            // A bolinha solit√°ria pisca
                            singleDiv.innerHTML = `
<div class="w-6 h-6 rounded-full bg-brand-orange shadow-sm animate-pulse"></div>
`;
                            dotsArea.appendChild(singleDiv);
                        }

                        // Atualiza Badge
                        setTimeout(() => {
                            resultBadge.classList.remove("scale-0");
                            if (isEven) {
                                resultBadge.className =
                                    "px-6 py-2 rounded-full font-black text-white text-lg uppercase tracking-wider shadow-md transition-all transform scale-100 bg-brand-blue";
                                resultBadge.innerText = "PAR";
                                resultDesc.innerText = "Todo mundo tem seu par! üíë";
                            } else {
                                resultBadge.className =
                                    "px-6 py-2 rounded-full font-black text-white text-lg uppercase tracking-wider shadow-md transition-all transform scale-100 bg-brand-orange";
                                resultBadge.innerText = "√çMPAR";
                                resultDesc.innerText = "Sobrou um solit√°rio! üßç";
                            }
                        }, 300);
                    };

                    container.querySelector("#btn-minus").onclick = () => {
                        if (currentNum > 1) {
                            currentNum--;
                            resultBadge.classList.add("scale-0");
                            update();
                        }
                    };
                    container.querySelector("#btn-plus").onclick = () => {
                        if (currentNum < 20) {
                            currentNum++;
                            resultBadge.classList.add("scale-0");
                            update();
                        }
                    };

                    update();
                },

                interactive_parity_lab(container) {
                    let p1 = "even"; // even ou odd
                    let p2 = "even";

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-6">Calculadora de Tipos</h3>

<div class="flex items-center gap-2 md:gap-4 w-full justify-center mb-6">

<button id="btn-p1" class="w-24 h-12 rounded-xl border-b-4 font-bold text-sm transition-all active:border-b-0 active:translate-y-1 bg-brand-blue border-blue-700 text-white shadow-lg">PAR</button>

<div class="text-2xl text-gray-300 font-black">+</div>

<button id="btn-p2" class="w-24 h-12 rounded-xl border-b-4 font-bold text-sm transition-all active:border-b-0 active:translate-y-1 bg-brand-blue border-blue-700 text-white shadow-lg">PAR</button>

<div class="text-2xl text-gray-300 font-black">=</div>

<div id="res-lab" class="w-24 h-12 rounded-xl border-2 flex items-center justify-center font-black text-lg shadow-inner bg-gray-100 text-gray-400">
?
</div>
</div>

<div id="explanation" class="text-center text-sm font-medium text-gray-500 bg-gray-50 p-3 rounded-lg border border-gray-200 w-full animate-fade-in">
Clique nos bot√µes para mudar o tipo!
</div>
</div>
`;

                    const btn1 = container.querySelector("#btn-p1");
                    const btn2 = container.querySelector("#btn-p2");
                    const resDiv = container.querySelector("#res-lab");
                    const explain = container.querySelector("#explanation");

                    const updateBtn = (btn, type) => {
                        if (type === "even") {
                            btn.className =
                                "w-24 h-12 rounded-xl border-b-4 font-bold text-sm transition-all active:border-b-0 active:translate-y-1 bg-brand-blue border-blue-700 text-white shadow-lg";
                            btn.innerText = "PAR";
                        } else {
                            btn.className =
                                "w-24 h-12 rounded-xl border-b-4 font-bold text-sm transition-all active:border-b-0 active:translate-y-1 bg-brand-orange border-orange-700 text-white shadow-lg";
                            btn.innerText = "√çMPAR";
                        }
                    };

                    const calc = () => {
                        // L√≥gica:
                        // Par (0) + Par (0) = Par (0)
                        // Par (0) + √çmpar (1) = √çmpar (1)
                        // √çmpar (1) + √çmpar (1) = Par (2 -> 0)

                        const val1 = p1 === "even" ? 0 : 1;
                        const val2 = p2 === "even" ? 0 : 1;
                        const sum = val1 + val2;
                        const isResEven = sum % 2 === 0;

                        // Anima√ß√£o Resultado
                        resDiv.classList.add("scale-110");
                        setTimeout(() => resDiv.classList.remove("scale-110"), 200);

                        if (isResEven) {
                            resDiv.className =
                                "w-24 h-12 rounded-xl border-2 flex items-center justify-center font-black text-lg shadow-sm bg-blue-50 border-brand-blue text-brand-blue transition-all";
                            resDiv.innerText = "PAR";
                        } else {
                            resDiv.className =
                                "w-24 h-12 rounded-xl border-2 flex items-center justify-center font-black text-lg shadow-sm bg-orange-50 border-brand-orange text-brand-orange transition-all";
                            resDiv.innerText = "√çMPAR";
                        }

                        // Explica√ß√£o
                        if (p1 === "odd" && p2 === "odd") {
                            explain.innerHTML =
                                "Os dois 'solit√°rios' se encontraram e formaram um par! ‚ù§Ô∏è";
                        } else if (p1 !== p2) {
                            explain.innerHTML =
                                "O n√∫mero par n√£o ajuda o √≠mpar. O 'solit√°rio' continua sozinho.";
                        } else {
                            explain.innerHTML =
                                "Todo mundo j√° tinha par, e continuam tendo.";
                        }
                    };

                    btn1.onclick = () => {
                        p1 = p1 === "even" ? "odd" : "even";
                        updateBtn(btn1, p1);
                        calc();
                    };
                    btn2.onclick = () => {
                        p2 = p2 === "even" ? "odd" : "even";
                        updateBtn(btn2, p2);
                        calc();
                    };
                },

                interactive_parity_game(container) {
                    let score = 0;
                    let currentNumber = 0;
                    let timer = null;

                    container.innerHTML = `
<div class="bg-gray-900 border-4 border-gray-700 rounded-2xl p-6 flex flex-col items-center w-full shadow-xl font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full text-white mb-4 z-10 relative">
<div class="text-xs font-bold uppercase tracking-widest text-gray-400">Tempo: <span id="game-timer" class="text-white">Start</span></div>
<div class="bg-gray-700 px-3 py-1 rounded-full text-xs font-black">Placar: <span id="game-score" class="text-brand-green">0</span></div>
</div>

<div id="play-area" class="w-full h-40 flex items-center justify-center relative mb-6">

<div id="ball" class="w-24 h-24 rounded-full bg-white border-4 border-gray-300 shadow-2xl flex items-center justify-center text-4xl font-black text-gray-800 transform scale-0 transition-transform duration-300 z-20">
?
</div>

<div class="absolute left-0 top-0 bottom-0 w-16 border-r-2 border-dashed border-gray-600 flex items-center justify-center">
<span class="transform -rotate-90 text-brand-blue font-black text-xs uppercase tracking-widest opacity-50">Par</span>
</div>
<div class="absolute right-0 top-0 bottom-0 w-16 border-l-2 border-dashed border-gray-600 flex items-center justify-center">
<span class="transform rotate-90 text-brand-orange font-black text-xs uppercase tracking-widest opacity-50">√çmpar</span>
</div>

</div>

<div class="grid grid-cols-2 gap-4 w-full max-w-xs z-10 relative" id="controls">
<button id="btn-even" class="h-16 rounded-xl bg-brand-blue border-b-4 border-blue-800 text-white font-black text-xl shadow-lg active:scale-95 active:border-b-0 active:translate-y-1 transition-all">PAR</button>
<button id="btn-odd" class="h-16 rounded-xl bg-brand-orange border-b-4 border-orange-800 text-white font-black text-xl shadow-lg active:scale-95 active:border-b-0 active:translate-y-1 transition-all">√çMPAR</button>
</div>

<div id="start-overlay" class="absolute inset-0 bg-gray-900/90 z-30 flex flex-col items-center justify-center">
<div class="text-5xl mb-4">‚öΩ</div>
<h3 class="text-white font-black text-2xl mb-2">Desafio do Goleiro</h3>
<p class="text-gray-400 text-sm mb-6 text-center px-8">Chute para a esquerda se for PAR.<br>Chute para a direita se for √çMPAR.</p>
<button id="btn-start-game" class="bg-brand-green text-white font-bold py-3 px-8 rounded-full shadow-[0_0_20px_rgba(88,204,2,0.5)] animate-pulse">COME√áAR</button>
</div>

<div id="feedback-flash" class="absolute inset-0 pointer-events-none opacity-0 transition-opacity duration-200 z-0"></div>

</div>
`;

                    const ball = container.querySelector("#ball");
                    const scoreEl = container.querySelector("#game-score");
                    const startOverlay = container.querySelector("#start-overlay");
                    const flash = container.querySelector("#feedback-flash");
                    const btnEven = container.querySelector("#btn-even");
                    const btnOdd = container.querySelector("#btn-odd");

                    const nextRound = () => {
                        // Gera n√∫mero aleat√≥rio (1 a 100)
                        currentNumber = Math.floor(Math.random() * 99) + 1;
                        ball.innerText = currentNumber;

                        // Anima√ß√£o de entrada
                        ball.classList.remove("scale-0");
                        ball.classList.add("scale-100", "animate-bounce-small");
                    };

                    const check = (choice) => {
                        // 'even' ou 'odd'
                        const isEven = currentNumber % 2 === 0;
                        const correct =
                            (choice === "even" && isEven) || (choice === "odd" && !isEven);

                        if (correct) {
                            score += 10;
                            scoreEl.innerText = score;
                            // Flash Verde
                            flash.className =
                                "absolute inset-0 pointer-events-none transition-opacity duration-200 z-0 bg-green-500/20 opacity-100";
                            setTimeout(() => flash.classList.remove("opacity-100"), 200);

                            // Anima√ß√£o da Bola saindo
                            const direction =
                                choice === "even" ? "-translate-x-20" : "translate-x-20";
                            ball.classList.add("transform", direction, "opacity-0");

                            setTimeout(() => {
                                ball.classList.remove(
                                    "transform",
                                    direction,
                                    "opacity-0",
                                    "scale-100"
                                );
                                ball.classList.add("scale-0");
                                setTimeout(nextRound, 100);
                            }, 200);
                        } else {
                            score = Math.max(0, score - 5);
                            scoreEl.innerText = score;
                            // Flash Vermelho
                            flash.className =
                                "absolute inset-0 pointer-events-none transition-opacity duration-200 z-0 bg-red-500/20 opacity-100";
                            setTimeout(() => flash.classList.remove("opacity-100"), 200);

                            // Shake
                            ball.classList.add("animate-shake");
                            setTimeout(() => ball.classList.remove("animate-shake"), 300);
                        }
                    };

                    container.querySelector("#btn-start-game").onclick = () => {
                        startOverlay.classList.add("hidden");
                        score = 0;
                        scoreEl.innerText = 0;
                        nextRound();
                    };

                    btnEven.onclick = () => check("even");
                    btnOdd.onclick = () => check("odd");

                    // CSS Inline para Shake e Bounce
                    if (!document.getElementById("game-anims")) {
                        const s = document.createElement("style");
                        s.id = "game-anims";
                        s.innerHTML = `
@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
.animate-shake { animation: shake 0.3s ease-in-out; }
@keyframes bounceSmall { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
.animate-bounce-small { animation: bounceSmall 1s infinite; }
`;
                        container.appendChild(s);
                    }
                },

                interactive_commutative_swap(container) {
                    let state = "A_B"; // Estado inicial: A na esquerda, B na direita

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">A M√°quina de Troca</h3>

<div class="relative w-64 h-24 flex items-center justify-center mb-4">

<div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-3xl font-black text-gray-300 z-0">
+
</div>

<div id="block-A" class="absolute top-2 w-20 h-16 bg-blue-100 border-4 border-brand-blue rounded-xl flex items-center justify-center text-2xl font-black text-brand-blue shadow-md transition-all duration-700 ease-in-out z-10" style="left: 0;">
15
</div>

<div id="block-B" class="absolute top-2 w-20 h-16 bg-orange-100 border-4 border-brand-orange rounded-xl flex items-center justify-center text-2xl font-black text-brand-orange shadow-md transition-all duration-700 ease-in-out z-10" style="right: 0;">
28
</div>

</div>

<div class="bg-gray-50 px-6 py-2 rounded-lg border border-gray-200 mb-6 text-center">
<span id="label-order" class="text-xs text-gray-400 font-bold block mb-1">15 + 28</span>
Soma: <span class="text-2xl font-black text-brand-green">43</span>
</div>

<button id="btn-swap" class="bg-brand-purple hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-xl shadow-btn active:scale-95 transition-all flex items-center gap-2">
<i class="fas fa-exchange-alt"></i> TROCAR LUGAR
</button>

</div>
`;

                    const blockA = container.querySelector("#block-A");
                    const blockB = container.querySelector("#block-B");
                    const btn = container.querySelector("#btn-swap");
                    const label = container.querySelector("#label-order");

                    btn.onclick = () => {
                        // Desabilita bot√£o durante anima√ß√£o
                        btn.disabled = true;
                        btn.classList.add("opacity-50");

                        if (state === "A_B") {
                            // Trocar: A vai pra direita, B vai pra esquerda
                            blockA.style.left = "calc(100% - 5rem)"; // 5rem √© a largura do bloco (w-20)
                            blockB.style.right = "calc(100% - 5rem)";
                            label.innerText = "28 + 15";
                            state = "B_A";
                        } else {
                            // Destrocar: Voltam ao in√≠cio
                            blockA.style.left = "0";
                            blockB.style.right = "0";
                            label.innerText = "15 + 28";
                            state = "A_B";
                        }

                        setTimeout(() => {
                            btn.disabled = false;
                            btn.classList.remove("opacity-50");
                        }, 700);
                    };
                },

                interactive_associative_brackets(container) {
                    let mode = "left"; // left: (A+B)+C, right: A+(B+C)
                    const nums = [12, 8, 5];

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
<h3 class="text-brand-green font-bold uppercase text-xs tracking-widest mb-6">Quem soma primeiro?</h3>

<div class="text-3xl md:text-4xl font-mono font-bold flex items-center gap-2 mb-8 relative h-16 w-full justify-center">

<div id="brackets" class="absolute top-0 bottom-0 border-l-4 border-r-4 border-brand-purple rounded-xl transition-all duration-500 ease-in-out flex items-center justify-center bg-purple-50 -z-10 opacity-50" style="left: 0; width: 60%;"></div>

<div class="z-10">${nums[0]}</div>
<div class="z-10 text-gray-300">+</div>
<div class="z-10">${nums[1]}</div>
<div class="z-10 text-gray-300">+</div>
<div class="z-10">${nums[2]}</div>
</div>

<div class="w-full grid grid-cols-2 gap-4 mb-6">
<div id="calc-step-1" class="text-center bg-gray-50 p-2 rounded-lg border border-gray-200 transition-all">
<span class="text-xs text-gray-400 font-bold uppercase block mb-1">1¬∫ Passo</span>
<span class="text-xl font-bold text-brand-purple" id="step-1-val">${nums[0]
                        } + ${nums[1]} = ${nums[0] + nums[1]}</span>
</div>
<div id="calc-step-2" class="text-center bg-white p-2 rounded-lg border-2 border-brand-green transition-all shadow-sm">
<span class="text-xs text-gray-400 font-bold uppercase block mb-1">Resultado</span>
<span class="text-xl font-black text-brand-green" id="step-2-val">${nums[0] + nums[1]
                        } + ${nums[2]} = ${nums[0] + nums[1] + nums[2]}</span>
</div>
</div>

<div class="flex bg-gray-100 p-1 rounded-xl w-full max-w-xs relative">
<div id="toggle-bg" class="absolute top-1 bottom-1 w-[calc(50%-4px)] bg-white rounded-lg shadow-sm transition-all duration-300 left-1"></div>
<button id="btn-left" class="flex-1 py-2 z-10 text-xs font-bold uppercase transition-colors text-brand-blue">Agrupar (A+B)</button>
<button id="btn-right" class="flex-1 py-2 z-10 text-xs font-bold uppercase transition-colors text-gray-400">Agrupar (B+C)</button>
</div>

</div>
`;

                    const bracketEl = container.querySelector("#brackets");
                    const step1Val = container.querySelector("#step-1-val");
                    const step2Val = container.querySelector("#step-2-val");
                    const btnLeft = container.querySelector("#btn-left");
                    const btnRight = container.querySelector("#btn-right");
                    const toggleBg = container.querySelector("#toggle-bg");

                    const update = () => {
                        if (mode === "left") {
                            // (12 + 8)
                            bracketEl.style.left = "10%";
                            bracketEl.style.width = "35%"; // Ajuste visual aproximado
                            bracketEl.style.borderColor = "#CE82FF"; // Purple
                            bracketEl.style.backgroundColor = "#F3E8FF";

                            toggleBg.style.left = "4px";
                            btnLeft.className =
                                "flex-1 py-2 z-10 text-xs font-bold uppercase transition-colors text-brand-purple";
                            btnRight.className =
                                "flex-1 py-2 z-10 text-xs font-bold uppercase transition-colors text-gray-400";

                            step1Val.innerHTML = `${nums[0]} + ${nums[1]} = <strong>${nums[0] + nums[1]
                                }</strong>`;
                            step2Val.innerHTML = `<strong>${nums[0] + nums[1]}</strong> + ${nums[2]
                                } = ${nums[0] + nums[1] + nums[2]}`;
                        } else {
                            // (8 + 5)
                            bracketEl.style.left = "55%";
                            bracketEl.style.width = "35%";
                            bracketEl.style.borderColor = "#FF9600"; // Orange
                            bracketEl.style.backgroundColor = "#FFF7ED";

                            toggleBg.style.left = "calc(50% + 0px)";
                            btnLeft.className =
                                "flex-1 py-2 z-10 text-xs font-bold uppercase transition-colors text-gray-400";
                            btnRight.className =
                                "flex-1 py-2 z-10 text-xs font-bold uppercase transition-colors text-brand-orange";

                            step1Val.innerHTML = `${nums[1]} + ${nums[2]} = <strong>${nums[1] + nums[2]
                                }</strong>`;
                            step2Val.innerHTML = `${nums[0]} + <strong>${nums[1] + nums[2]
                                }</strong> = ${nums[0] + nums[1] + nums[2]}`;
                        }
                    };

                    btnLeft.onclick = () => {
                        mode = "left";
                        update();
                    };
                    btnRight.onclick = () => {
                        mode = "right";
                        update();
                    };

                    // Pequeno delay para calcular posi√ß√µes se necess√°rio, ou usar % fixas
                    setTimeout(update, 100);
                },

                interactive_identity_hero(container) {
                    let baseVal = 50;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-6">Teste do Elemento Neutro</h3>

<div class="flex items-center justify-center gap-2 w-full mb-8">

<div class="flex flex-col items-center">
<span class="text-[10px] font-bold text-gray-400 uppercase mb-1">Entrada</span>
<div class="w-16 h-16 bg-gray-100 rounded-xl border-2 border-gray-300 flex items-center justify-center font-black text-2xl text-gray-600">
${baseVal}
</div>
</div>

<div class="flex flex-col items-center px-2">
<div class="bg-brand-blue text-white px-3 py-1 rounded-full text-xs font-bold mb-1 shadow-sm relative z-10" id="op-badge">
???
</div>
<div class="h-1 w-16 bg-gray-300 rounded-full"></div>
</div>

<div class="flex flex-col items-center">
<span class="text-[10px] font-bold text-gray-400 uppercase mb-1">Sa√≠da</span>
<div id="output-box" class="w-16 h-16 bg-white rounded-xl border-4 border-dashed border-gray-300 flex items-center justify-center font-black text-2xl text-gray-400 transition-all duration-300">
?
</div>
</div>

</div>

<p class="text-sm text-center text-gray-600 mb-4 min-h-[40px]" id="feedback-text">
Escolha um n√∫mero para somar. Veja se o valor muda.
</p>

<div class="flex gap-4 w-full max-w-xs">
<button id="btn-somar-5" class="flex-1 bg-white border-2 border-red-200 text-red-500 hover:bg-red-50 font-bold py-3 rounded-xl transition-all active:scale-95 shadow-sm">
+ 5
</button>
<button id="btn-somar-0" class="flex-1 bg-brand-green text-white font-bold py-3 rounded-xl hover:bg-green-600 transition-all active:scale-95 shadow-btn border-b-4 border-green-700 active:border-b-0 active:translate-y-1">
+ 0
</button>
</div>

</div>
`;

                    const outBox = container.querySelector("#output-box");
                    const opBadge = container.querySelector("#op-badge");
                    const feedback = container.querySelector("#feedback-text");
                    const btn5 = container.querySelector("#btn-somar-5");
                    const btn0 = container.querySelector("#btn-somar-0");

                    const runTest = (addVal) => {
                        // Reset visual
                        outBox.className =
                            "w-16 h-16 bg-white rounded-xl border-4 border-dashed border-gray-300 flex items-center justify-center font-black text-2xl text-gray-400";
                        outBox.innerText = "...";

                        // Atualiza badge da opera√ß√£o
                        opBadge.innerText = `+ ${addVal}`;
                        opBadge.className =
                            addVal === 0
                                ? "bg-brand-green text-white px-3 py-1 rounded-full text-xs font-bold mb-1 shadow-sm relative z-10"
                                : "bg-brand-red text-white px-3 py-1 rounded-full text-xs font-bold mb-1 shadow-sm relative z-10";

                        setTimeout(() => {
                            const finalVal = baseVal + addVal;
                            outBox.innerText = finalVal;

                            if (addVal === 0) {
                                // Elemento Neutro
                                outBox.className =
                                    "w-16 h-16 bg-green-100 rounded-xl border-4 border-brand-green flex items-center justify-center font-black text-2xl text-brand-green scale-110 transition-all shadow-lg";
                                feedback.innerHTML = `<strong class="text-brand-green">INCR√çVEL!</strong> Somar zero n√£o fez nada.<br>O 50 continuou 50. Ele √© <strong>Neutro</strong>.`;
                            } else {
                                // Mudan√ßa
                                outBox.className =
                                    "w-16 h-16 bg-red-100 rounded-xl border-4 border-brand-red flex items-center justify-center font-black text-2xl text-brand-red animate-shake transition-all";
                                feedback.innerHTML = `O n√∫mero mudou para <strong>${finalVal}</strong>.<br>Somar 5 alterou a identidade dele.`;
                            }
                        }, 400);
                    };

                    btn5.onclick = () => runTest(5);
                    btn0.onclick = () => runTest(0);
                },

                interactive_property_sorter(container) {
                    // Dados
                    const cards = [
                        { text: "15 + 0 = 15", type: "neutro" },
                        { text: "2 + 3 = 3 + 2", type: "comutativa" },
                        { text: "(1+2)+3 = 1+(2+3)", type: "associativa" },
                        { text: "A + B = B + A", type: "comutativa" },
                        { text: "1.000 + 0 = 1.000", type: "neutro" },
                    ];

                    let currentCardIdx = 0;
                    let score = 0;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-4 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full mb-4">
<span class="text-xs font-bold text-gray-400 uppercase">Quiz</span>
<span class="text-xs font-bold text-brand-blue bg-blue-50 px-2 py-1 rounded">Acertos: <span id="sort-score">0</span></span>
</div>

<div id="game-area" class="w-full flex flex-col items-center gap-6 min-h-[250px]">

<div id="current-card" class="bg-white border-4 border-gray-200 rounded-2xl w-full max-w-xs h-24 flex items-center justify-center shadow-lg transform transition-all duration-300 z-10 cursor-grab active:cursor-grabbing">
<span class="font-mono font-bold text-xl text-gray-700" id="card-text">...</span>
</div>

<div class="grid grid-cols-1 gap-2 w-full max-w-xs">
<button class="cat-btn bg-blue-50 border-2 border-blue-200 text-brand-blue font-bold py-3 rounded-xl hover:bg-blue-100 transition-all" data-type="comutativa">
üîÑ Comutativa (Troca)
</button>
<button class="cat-btn bg-purple-50 border-2 border-purple-200 text-brand-purple font-bold py-3 rounded-xl hover:bg-purple-100 transition-all" data-type="associativa">
ü§ù Associativa (Grupo)
</button>
<button class="cat-btn bg-green-50 border-2 border-green-200 text-brand-green font-bold py-3 rounded-xl hover:bg-green-100 transition-all" data-type="neutro">
üëª Elemento Neutro (Zero)
</button>
</div>

</div>

<div id="end-screen" class="hidden absolute inset-0 bg-white flex-col items-center justify-center z-20">
<div class="text-6xl mb-4">üèÜ</div>
<h3 class="text-xl font-black text-brand-text">Mandou bem!</h3>
<button id="btn-restart-sort" class="mt-4 bg-brand-blue text-white font-bold py-2 px-6 rounded-lg shadow-btn active:scale-95">Jogar Novamente</button>
</div>

</div>
`;

                    const cardEl = container.querySelector("#current-card");
                    const cardText = container.querySelector("#card-text");
                    const scoreEl = container.querySelector("#sort-score");
                    const endScreen = container.querySelector("#end-screen");
                    const btns = container.querySelectorAll(".cat-btn");
                    const restartBtn = container.querySelector("#btn-restart-sort");

                    const loadCard = () => {
                        if (currentCardIdx >= cards.length) {
                            endScreen.classList.remove("hidden");
                            endScreen.classList.add("flex");
                            return;
                        }

                        cardText.innerText = cards[currentCardIdx].text;

                        // Reset Visual
                        cardEl.className =
                            "bg-white border-4 border-gray-200 rounded-2xl w-full max-w-xs h-24 flex items-center justify-center shadow-lg transform transition-all duration-300 z-10 animate-pop-in";
                    };

                    const check = (type) => {
                        const correct = cards[currentCardIdx].type;

                        if (type === correct) {
                            score++;
                            scoreEl.innerText = score;

                            // Sucesso Visual
                            cardEl.classList.remove("border-gray-200", "bg-white");
                            cardEl.classList.add(
                                "border-brand-green",
                                "bg-green-100",
                                "scale-105"
                            );

                            setTimeout(() => {
                                currentCardIdx++;
                                loadCard();
                            }, 400);
                        } else {
                            // Erro Visual
                            cardEl.classList.add(
                                "animate-shake",
                                "border-brand-red",
                                "bg-red-50"
                            );
                            setTimeout(() => {
                                cardEl.classList.remove(
                                    "animate-shake",
                                    "border-brand-red",
                                    "bg-red-50"
                                );
                            }, 500);
                        }
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => check(btn.dataset.type);
                    });

                    restartBtn.onclick = () => {
                        currentCardIdx = 0;
                        score = 0;
                        scoreEl.innerText = 0;
                        endScreen.classList.add("hidden");
                        endScreen.classList.remove("flex");
                        loadCard();
                    };

                    loadCard();
                },

                interactive_elevator_inverse(container) {
                    let currentFloor = 0; // Come√ßa no t√©rreo (0)

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Elevador Matem√°tico</h3>

<div class="flex gap-8 w-full justify-center h-64">

<div class="relative w-24 bg-gray-100 border-2 border-gray-300 rounded-t-xl overflow-hidden flex flex-col-reverse">
${[...Array(11)]
                            .map(
                                (_, i) => `
<div class="h-[10%] w-full border-t border-gray-200 flex items-center justify-center text-[8px] text-gray-400">
${i}
</div>
`
                            )
                            .join("")}

<div id="elevator-cab" class="absolute bottom-0 left-1 right-1 h-[9%] bg-brand-blue rounded shadow-md border-2 border-blue-600 transition-all duration-700 ease-in-out flex items-center justify-center text-white font-bold text-xs z-10">
0
</div>
</div>

<div class="flex flex-col justify-center gap-4 w-32">
<div class="bg-gray-50 p-3 rounded-xl border border-gray-200 text-center">
<span class="text-xs text-gray-400 uppercase font-bold block mb-1">Andar Atual</span>
<span id="floor-display" class="text-3xl font-black text-brand-text">0</span>
</div>

<button id="btn-up" class="bg-green-100 text-green-700 font-bold py-3 rounded-xl hover:bg-green-200 transition-all flex items-center justify-center gap-2 border-b-4 border-green-300 active:border-b-0 active:translate-y-1">
<i class="fas fa-arrow-up"></i> Subir 4
</button>

<button id="btn-down" class="bg-orange-100 text-orange-700 font-bold py-3 rounded-xl hover:bg-orange-200 transition-all flex items-center justify-center gap-2 border-b-4 border-orange-300 active:border-b-0 active:translate-y-1 opacity-50 cursor-not-allowed" disabled>
<i class="fas fa-arrow-down"></i> Descer 4
</button>
</div>
</div>

<p id="elevator-msg" class="text-center text-xs text-gray-500 font-bold mt-4 min-h-[20px]">
Comece subindo!
</p>
</div>
`;

                    const cab = container.querySelector("#elevator-cab");
                    const display = container.querySelector("#floor-display");
                    const btnUp = container.querySelector("#btn-up");
                    const btnDown = container.querySelector("#btn-down");
                    const msg = container.querySelector("#elevator-msg");

                    const updateElevator = (floor) => {
                        // Altura baseada em porcentagem (0 a 10 andares = 0% a 90% aprox)
                        const percent = floor * 9.1;
                        cab.style.bottom = `${percent}%`;
                        cab.innerText = floor;
                        display.innerText = floor;
                    };

                    btnUp.onclick = () => {
                        currentFloor += 4;
                        updateElevator(currentFloor);

                        msg.innerHTML = `Voc√™ subiu <strong>+4</strong> andares. Agora desfa√ßa!`;
                        msg.className =
                            "text-center text-xs text-brand-green font-bold mt-4";

                        btnUp.disabled = true;
                        btnUp.classList.add("opacity-50", "cursor-not-allowed");

                        btnDown.disabled = false;
                        btnDown.classList.remove("opacity-50", "cursor-not-allowed");
                    };

                    btnDown.onclick = () => {
                        currentFloor -= 4;
                        updateElevator(currentFloor);

                        msg.innerHTML = `Voc√™ desceu <strong>-4</strong> e voltou ao in√≠cio. <br> (+4 - 4 = 0)`;
                        msg.className =
                            "text-center text-xs text-brand-orange font-bold mt-4";

                        btnDown.disabled = true;
                        btnDown.classList.add("opacity-50", "cursor-not-allowed");

                        setTimeout(() => {
                            btnUp.disabled = false;
                            btnUp.classList.remove("opacity-50", "cursor-not-allowed");
                            msg.innerText = "Tente de novo!";
                            msg.className =
                                "text-center text-xs text-gray-500 font-bold mt-4";
                        }, 2000);
                    };
                },

                interactive_crime_scene(container) {
                    // Estado do Desafio
                    const problem = { n1: 12, n2: 7, op: "+", res: 19 }; // 12 + 7 = 19
                    let slots = [null, null, null]; // [Res, OpInversa, Num2]

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-4 md:p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<div class="flex items-center gap-2 mb-6">
<span class="text-2xl">üïµÔ∏è‚Äç‚ôÇÔ∏è</span>
<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest">Verifique a Conta</h3>
</div>

<div class="bg-gray-100 px-6 py-3 rounded-xl border-2 border-gray-300 mb-8 flex items-center gap-3 opacity-70">
<span class="font-black text-2xl text-gray-700">${problem.n1}</span>
<span class="font-black text-2xl text-brand-blue">+</span>
<span class="font-black text-2xl text-gray-700">${problem.n2}</span>
<span class="font-black text-2xl text-gray-400">=</span>
<span class="font-black text-2xl text-brand-green">${problem.res}</span>
</div>

<p class="text-xs text-brand-purple font-bold mb-2 uppercase tracking-wide">Monte a Prova Real:</p>

<div class="flex gap-2 mb-6">
<div id="slot-0" class="w-16 h-16 rounded-xl border-2 border-dashed border-gray-400 bg-gray-50 flex items-center justify-center font-bold text-xl text-brand-text cursor-pointer hover:bg-red-50 transition-colors"></div>
<div id="slot-1" class="w-16 h-16 rounded-xl border-2 border-dashed border-gray-400 bg-gray-50 flex items-center justify-center font-bold text-xl text-brand-text cursor-pointer hover:bg-red-50 transition-colors"></div>
<div id="slot-2" class="w-16 h-16 rounded-xl border-2 border-dashed border-gray-400 bg-gray-50 flex items-center justify-center font-bold text-xl text-brand-text cursor-pointer hover:bg-red-50 transition-colors"></div>

<div class="flex items-center justify-center font-black text-gray-400 text-xl">= ?</div>
</div>

<div class="flex flex-wrap justify-center gap-3" id="parts-bank">
<button class="part-btn bg-white border-b-4 border-gray-300 text-gray-700 font-bold px-4 py-2 rounded-lg active:scale-95" data-val="${problem.res}">${problem.res}</button>
<button class="part-btn bg-white border-b-4 border-gray-300 text-gray-700 font-bold px-4 py-2 rounded-lg active:scale-95" data-val="${problem.n1}">${problem.n1}</button>
<button class="part-btn bg-white border-b-4 border-gray-300 text-gray-700 font-bold px-4 py-2 rounded-lg active:scale-95" data-val="${problem.n2}">${problem.n2}</button>
<button class="part-btn bg-brand-blue border-b-4 border-blue-700 text-white font-bold px-4 py-2 rounded-lg active:scale-95" data-val="+">+</button>
<button class="part-btn bg-brand-orange border-b-4 border-orange-700 text-white font-bold px-4 py-2 rounded-lg active:scale-95" data-val="-">-</button>
</div>

<div id="crime-feedback" class="h-8 mt-4 font-bold text-sm text-center"></div>

</div>
`;

                    const bank = container.querySelector("#parts-bank");
                    const slotEls = [
                        container.querySelector("#slot-0"),
                        container.querySelector("#slot-1"),
                        container.querySelector("#slot-2"),
                    ];
                    const feedback = container.querySelector("#crime-feedback");

                    // L√≥gica
                    const checkWin = () => {
                        // Esperado: [19, -, 7] ou [19, -, 12]
                        const s0 = slots[0];
                        const s1 = slots[1];
                        const s2 = slots[2];

                        if (s0 && s1 && s2) {
                            // Verifica
                            const isCorrectStart = parseInt(s0) === problem.res;
                            const isCorrectOp = s1 === "-"; // Inverso de +
                            const isCorrectEnd =
                                parseInt(s2) === problem.n1 || parseInt(s2) === problem.n2;

                            if (isCorrectStart && isCorrectOp && isCorrectEnd) {
                                const result = parseInt(s0) - parseInt(s2);
                                feedback.innerHTML = `<span class="text-brand-green">CERTO! ${s0} - ${s2} = ${result}. A conta fecha!</span>`;
                                slotEls.forEach((el) =>
                                    el.classList.add("bg-green-100", "border-green-400")
                                );
                            } else {
                                feedback.innerHTML = `<span class="text-brand-red">Ops! A prova real come√ßa pelo Resultado e usa o sinal Inverso.</span>`;
                                slotEls.forEach((el) =>
                                    el.classList.add("bg-red-50", "border-red-300")
                                );
                            }
                        } else {
                            feedback.innerText = "";
                            slotEls.forEach((el) =>
                                el.classList.remove(
                                    "bg-green-100",
                                    "border-green-400",
                                    "bg-red-50",
                                    "border-red-300"
                                )
                            );
                        }
                    };

                    // Click nos Bot√µes do Banco
                    bank.querySelectorAll(".part-btn").forEach((btn) => {
                        btn.onclick = () => {
                            // Acha primeiro slot vazio
                            const emptyIdx = slots.indexOf(null);
                            if (emptyIdx !== -1) {
                                const val = btn.dataset.val;
                                slots[emptyIdx] = val;
                                slotEls[emptyIdx].innerText = val;

                                // Estilo visual no slot
                                if (val === "+" || val === "-") {
                                    slotEls[emptyIdx].className =
                                        "w-16 h-16 rounded-xl border-2 border-brand-text bg-white flex items-center justify-center font-black text-2xl text-brand-text cursor-pointer hover:bg-red-50";
                                } else {
                                    slotEls[emptyIdx].className =
                                        "w-16 h-16 rounded-xl border-2 border-brand-blue bg-blue-50 flex items-center justify-center font-bold text-xl text-brand-blue cursor-pointer hover:bg-red-50";
                                }

                                checkWin();
                            }
                        };
                    });

                    // Click nos Slots (Limpar)
                    slotEls.forEach((el, idx) => {
                        el.onclick = () => {
                            slots[idx] = null;
                            el.innerText = "";
                            el.className =
                                "w-16 h-16 rounded-xl border-2 border-dashed border-gray-400 bg-gray-50 flex items-center justify-center font-bold text-xl text-brand-text cursor-pointer hover:bg-red-50 transition-colors";
                            checkWin();
                        };
                    });
                },

                interactive_mystery_box(container) {
                    const questions = [
                        { q: "x + 5 = 12", start: 12, op: "-", val: 5, ans: 7 },
                        { q: "x - 3 = 10", start: 10, op: "+", val: 3, ans: 13 },
                        { q: "x + 8 = 20", start: 20, op: "-", val: 8, ans: 12 },
                    ];
                    let currentQ = 0;

                    container.innerHTML = `
<div class="bg-brand-bg border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="text-center mb-6">
<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-1">Quem √© o X?</h3>
<div class="bg-gray-800 text-white font-mono text-3xl p-4 rounded-xl shadow-lg border-b-4 border-gray-900" id="q-display">
...
</div>
</div>

<p class="text-xs text-gray-500 font-bold mb-3">Escolha a opera√ß√£o inversa correta:</p>

<div class="grid grid-cols-2 gap-3 w-full max-w-xs mb-4" id="options-area">
</div>

<div id="box-feedback" class="h-8 font-bold text-sm text-center"></div>

</div>
`;

                    const qDisplay = container.querySelector("#q-display");
                    const optsArea = container.querySelector("#options-area");
                    const feedback = container.querySelector("#box-feedback");

                    const loadQuestion = () => {
                        if (currentQ >= questions.length) {
                            qDisplay.innerText = "FIM!";
                            qDisplay.className =
                                "bg-green-500 text-white font-mono text-3xl p-4 rounded-xl shadow-lg border-b-4 border-green-700 animate-bounce";
                            optsArea.innerHTML = "";
                            feedback.innerText = "Voc√™ achou todos!";
                            return;
                        }

                        const q = questions[currentQ];
                        qDisplay.innerText = q.q;
                        qDisplay.classList.remove("animate-shake"); // Reset anim

                        // Gera op√ß√µes (1 certa + 1 errada com sinal trocado)
                        const wrongOp = q.op === "+" ? "-" : "+";

                        // Texto dos bot√µes: "12 - 5"
                        const correctText = `${q.start} ${q.op} ${q.val}`;
                        const wrongText = `${q.start} ${wrongOp} ${q.val}`;

                        const opts = [
                            { text: correctText, isCorrect: true },
                            { text: wrongText, isCorrect: false },
                        ].sort(() => Math.random() - 0.5);

                        optsArea.innerHTML = "";
                        opts.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-white border-2 border-brand-blue text-brand-blue font-bold py-3 rounded-xl hover:bg-blue-50 active:scale-95 transition-all text-lg shadow-sm";
                            btn.innerText = opt.text;
                            btn.onclick = () => check(opt.isCorrect, btn);
                            optsArea.appendChild(btn);
                        });
                    };

                    const check = (isCorrect, btn) => {
                        // Bloqueia
                        Array.from(optsArea.children).forEach((b) => (b.disabled = true));

                        if (isCorrect) {
                            const q = questions[currentQ];
                            btn.classList.remove(
                                "bg-white",
                                "border-brand-blue",
                                "text-brand-blue"
                            );
                            btn.classList.add(
                                "bg-brand-green",
                                "border-green-600",
                                "text-white"
                            );

                            qDisplay.innerText = `x = ${q.ans}`;
                            qDisplay.classList.add(
                                "bg-green-100",
                                "text-green-800",
                                "border-green-300"
                            );
                            qDisplay.classList.remove(
                                "bg-gray-800",
                                "text-white",
                                "border-gray-900"
                            );

                            feedback.innerHTML = `<span class="text-brand-green">Isso! ${q.ans
                                } ${q.op === "+" ? "-" : "+"} ${q.val
                                } volta para o in√≠cio.</span>`;

                            setTimeout(() => {
                                currentQ++;
                                // Reset estilos do display
                                qDisplay.classList.remove(
                                    "bg-green-100",
                                    "text-green-800",
                                    "border-green-300"
                                );
                                qDisplay.classList.add(
                                    "bg-gray-800",
                                    "text-white",
                                    "border-gray-900"
                                );
                                feedback.innerText = "";
                                loadQuestion();
                            }, 1500);
                        } else {
                            btn.classList.add(
                                "bg-red-100",
                                "border-red-400",
                                "text-red-600",
                                "animate-shake"
                            );
                            feedback.innerHTML = `<span class="text-brand-red">Ops! Se √© soma, o inverso √© subtra√ß√£o.</span>`;
                            setTimeout(() => {
                                Array.from(optsArea.children).forEach(
                                    (b) => (b.disabled = false)
                                );
                                btn.classList.remove(
                                    "bg-red-100",
                                    "border-red-400",
                                    "text-red-600",
                                    "animate-shake"
                                );
                            }, 1000);
                        }
                    };

                    loadQuestion();
                },

                interactive_bracket_master(container) {
                    // Configura√ß√£o do Desafio
                    const problem = {
                        parts: [10, "-", 4, "+", 3], // Os elementos visuais
                        target: 3, // O alvo (10 - (4+3) = 3)
                        // Se fosse sem parenteses: 10-4=6, 6+3=9.
                    };

                    let hasBrackets = false; // Estado: tem ou n√£o tem par√™nteses?

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full items-center mb-6">
<h3 class="text-brand-purple font-black uppercase text-xs tracking-widest"><i class="fas fa-puzzle-piece"></i> Complete a Conta</h3>
<div class="bg-gray-100 text-gray-500 px-3 py-1 rounded-full text-xs font-black shadow-sm">Alvo: <span class="text-brand-blue text-lg">${problem.target}</span></div>
</div>

<div class="flex items-center justify-center gap-2 mb-8 bg-gray-50 p-6 rounded-2xl border-2 border-dashed border-gray-300 w-full relative transition-all" id="expr-box">

<span class="text-3xl font-mono font-bold text-gray-700">${problem.parts[0]}</span>
<span class="text-2xl font-mono font-bold text-gray-400">${problem.parts[1]}</span>

<div class="relative px-2 py-1 transition-all duration-300 cursor-pointer group rounded-lg hover:bg-purple-100" id="bracket-zone">
<span class="absolute left-0 top-0 bottom-0 text-4xl text-brand-purple font-light opacity-0 transition-opacity" id="brace-l">(</span>

<span class="text-3xl font-mono font-bold text-gray-700">${problem.parts[2]}</span>
<span class="text-2xl font-mono font-bold text-gray-400 mx-1">${problem.parts[3]}</span>
<span class="text-3xl font-mono font-bold text-gray-700">${problem.parts[4]}</span>

<span class="absolute right-0 top-0 bottom-0 text-4xl text-brand-purple font-light opacity-0 transition-opacity" id="brace-r">)</span>

<div class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] text-brand-purple font-bold opacity-0 group-hover:opacity-100 uppercase tracking-widest whitespace-nowrap">Clique aqui</div>
</div>

<span class="text-2xl font-mono font-bold text-gray-400">=</span>
<span class="text-3xl font-mono font-black text-brand-blue" id="current-result">?</span>

</div>

<button id="btn-check" class="w-full max-w-xs bg-brand-green text-white font-bold py-3 rounded-xl shadow-btn active:shadow-none active:translate-y-1 transition-all text-lg uppercase tracking-widest">
Verificar
</button>

<div id="feedback-msg" class="h-10 mt-4 flex items-center justify-center font-bold text-sm text-center"></div>

</div>
`;

                    const zone = container.querySelector("#bracket-zone");
                    const braceL = container.querySelector("#brace-l");
                    const braceR = container.querySelector("#brace-r");
                    const currentRes = container.querySelector("#current-result");
                    const btnCheck = container.querySelector("#btn-check");
                    const feedback = container.querySelector("#feedback-msg");
                    const exprBox = container.querySelector("#expr-box");

                    // L√≥gica de c√°lculo
                    const calculate = () => {
                        // Valores fixos do exemplo: 10 - 4 + 3
                        if (hasBrackets) {
                            // 10 - (4 + 3)
                            return 10 - (4 + 3);
                        } else {
                            // 10 - 4 + 3
                            return 10 - 4 + 3;
                        }
                    };

                    // Toggle Par√™nteses
                    zone.onclick = () => {
                        hasBrackets = !hasBrackets;
                        if (hasBrackets) {
                            braceL.classList.remove("opacity-0");
                            braceR.classList.remove("opacity-0");
                            zone.classList.add(
                                "bg-purple-50",
                                "border",
                                "border-purple-200"
                            );
                        } else {
                            braceL.classList.add("opacity-0");
                            braceR.classList.add("opacity-0");
                            zone.classList.remove(
                                "bg-purple-50",
                                "border",
                                "border-purple-200"
                            );
                        }
                        // Reseta feedback
                        feedback.innerText = "";
                        currentRes.innerText = "?";
                        currentRes.className =
                            "text-3xl font-mono font-black text-brand-blue";
                        exprBox.classList.remove(
                            "border-green-400",
                            "bg-green-50",
                            "border-red-400",
                            "bg-red-50"
                        );
                    };

                    btnCheck.onclick = () => {
                        const res = calculate();
                        currentRes.innerText = res;

                        if (res === problem.target) {
                            // Acertou
                            feedback.innerHTML = `<span class="text-brand-green flex items-center gap-2"><i class="fas fa-check-circle"></i> Parab√©ns! 10 - 7 = 3.</span>`;
                            exprBox.classList.remove("border-dashed", "border-gray-300");
                            exprBox.classList.add(
                                "border-solid",
                                "border-green-400",
                                "bg-green-50"
                            );
                            currentRes.classList.add("text-brand-green");

                            // Confetti effect (simulado visualmente)
                            btnCheck.innerText = "MUITO BEM!";
                            btnCheck.classList.add("pointer-events-none", "opacity-80");
                        } else {
                            // Errou
                            feedback.innerHTML = `<span class="text-brand-red flex items-center gap-2"><i class="fas fa-times-circle"></i> Ops! Deu ${res}. Tente ${hasBrackets ? "tirar" : "colocar"
                                } os par√™nteses.</span>`;
                            exprBox.classList.add(
                                "border-red-400",
                                "bg-red-50",
                                "animate-shake"
                            );
                            currentRes.classList.add("text-brand-red");
                            setTimeout(
                                () => exprBox.classList.remove("animate-shake"),
                                500
                            );
                        }
                    };
                },

                interactive_word_sorter(container) {
                    // Banco de Palavras
                    const words = [
                        { text: "Ganhou", type: "add" },
                        { text: "Perdeu", type: "sub" },
                        { text: "Diferen√ßa", type: "sub" },
                        { text: "Total", type: "add" },
                        { text: "Acrescentou", type: "add" },
                        { text: "Resto", type: "sub" },
                        { text: "Juntou", type: "add" },
                        { text: "Quanto falta", type: "sub" },
                        { text: "Soma", type: "add" },
                        { text: "Gastou", type: "sub" },
                    ];

                    let currentIdx = 0;
                    let score = 0;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full mb-4">
<span class="text-xs font-bold text-gray-400 uppercase">Tradutor</span>
<span class="text-xs font-bold text-brand-blue bg-blue-50 px-2 py-1 rounded">Pontos: <span id="word-score">0</span></span>
</div>

<div class="relative w-full h-32 flex items-center justify-center mb-6">
<div id="word-card" class="absolute w-48 h-24 bg-gray-100 border-b-4 border-gray-300 rounded-2xl flex items-center justify-center text-xl font-black text-gray-700 shadow-lg transform transition-all duration-300 z-10">
...
</div>

<div id="word-feedback" class="absolute font-black text-4xl opacity-0 transition-all duration-500 z-20"></div>
</div>

<div class="flex gap-4 w-full max-w-xs">
<button id="btn-sub" class="flex-1 h-16 rounded-xl bg-red-100 border-b-4 border-red-300 text-red-600 text-2xl font-black shadow-sm active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center justify-center">
<i class="fas fa-minus"></i>
<span class="text-[10px] font-bold uppercase">Subtra√ß√£o</span>
</button>

<button id="btn-add" class="flex-1 h-16 rounded-xl bg-green-100 border-b-4 border-green-300 text-green-600 text-2xl font-black shadow-sm active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center justify-center">
<i class="fas fa-plus"></i>
<span class="text-[10px] font-bold uppercase">Adi√ß√£o</span>
</button>
</div>

<div id="end-message" class="hidden absolute inset-0 bg-white flex-col items-center justify-center z-30">
<div class="text-6xl mb-4">üß†</div>
<h3 class="text-xl font-black text-brand-text mb-2">Fim do Treino!</h3>
<button id="btn-restart-words" class="bg-brand-blue text-white font-bold py-2 px-6 rounded-lg shadow-btn active:scale-95">Jogar Novamente</button>
</div>

</div>
`;

                    const card = container.querySelector("#word-card");
                    const scoreEl = container.querySelector("#word-score");
                    const feedback = container.querySelector("#word-feedback");
                    const endScreen = container.querySelector("#end-message");

                    // Embaralha array
                    const shuffledWords = [...words].sort(() => Math.random() - 0.5);

                    const loadWord = () => {
                        if (currentIdx >= shuffledWords.length) {
                            endScreen.classList.remove("hidden");
                            endScreen.classList.add("flex");
                            return;
                        }

                        const w = shuffledWords[currentIdx];
                        card.innerText = w.text;
                        card.className =
                            "absolute w-48 h-24 bg-white border-b-4 border-gray-200 rounded-2xl flex items-center justify-center text-xl font-black text-gray-700 shadow-lg transform transition-all duration-300 z-10 animate-pop-in";
                    };

                    const handleChoice = (type) => {
                        const correct = shuffledWords[currentIdx].type;

                        if (type === correct) {
                            score++;
                            scoreEl.innerText = score;

                            // Anima√ß√£o de Sucesso (Sai para cima)
                            card.classList.add(
                                "translate-y-[-50px]",
                                "opacity-0",
                                "bg-green-50",
                                "border-green-200"
                            );
                            feedback.innerHTML =
                                '<i class="fas fa-check text-brand-green"></i>';
                            feedback.classList.remove("opacity-0", "scale-0");
                            feedback.classList.add("opacity-100", "scale-150");

                            setTimeout(() => {
                                currentIdx++;
                                feedback.classList.add("opacity-0", "scale-0");
                                loadWord();
                            }, 400);
                        } else {
                            // Anima√ß√£o de Erro (Shake)
                            card.classList.add(
                                "animate-shake",
                                "bg-red-50",
                                "border-red-200"
                            );
                            feedback.innerHTML =
                                '<i class="fas fa-times text-brand-red"></i>';
                            feedback.classList.remove("opacity-0", "scale-0");
                            feedback.classList.add("opacity-100", "scale-150");

                            setTimeout(() => {
                                card.classList.remove(
                                    "animate-shake",
                                    "bg-red-50",
                                    "border-red-200"
                                );
                                feedback.classList.add("opacity-0", "scale-0");
                            }, 500);
                        }
                    };

                    container.querySelector("#btn-add").onclick = () =>
                        handleChoice("add");
                    container.querySelector("#btn-sub").onclick = () =>
                        handleChoice("sub");

                    container.querySelector("#btn-restart-words").onclick = () => {
                        currentIdx = 0;
                        score = 0;
                        scoreEl.innerText = 0;
                        shuffledWords.sort(() => Math.random() - 0.5);
                        endScreen.classList.add("hidden");
                        endScreen.classList.remove("flex");
                        loadWord();
                    };

                    loadWord();
                },

                interactive_market_rpg(container) {
                    // Configura√ß√£o
                    const budget = 50;
                    const items = [
                        {
                            name: "üéÆ Jogo",
                            price: 25,
                            icon: "fa-gamepad",
                            color: "text-purple-600 bg-purple-100",
                        },
                        {
                            name: "üçî Lanche",
                            price: 12,
                            icon: "fa-hamburger",
                            color: "text-orange-600 bg-orange-100",
                        },
                        {
                            name: "üß¢ Bon√©",
                            price: 18,
                            icon: "fa-hat-cowboy",
                            color: "text-blue-600 bg-blue-100",
                        },
                        {
                            name: "üç´ Chocolate",
                            price: 5,
                            icon: "fa-cookie-bite",
                            color: "text-amber-700 bg-amber-100",
                        },
                    ];

                    let cart = []; // √çndices dos itens selecionados

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-4 flex flex-col items-center w-full shadow-sm font-sans select-none">

<div class="flex justify-between items-center w-full mb-4 bg-gray-800 text-white p-3 rounded-xl shadow-lg">
<div class="flex flex-col">
<span class="text-[10px] font-bold uppercase text-gray-400">Sua Carteira</span>
<span class="text-2xl font-mono font-bold text-green-400">R$ ${budget},00</span>
</div>
<div class="text-right flex flex-col items-end">
<span class="text-[10px] font-bold uppercase text-gray-400">Carrinho</span>
<span class="text-xl font-mono font-bold" id="cart-total">R$ 0,00</span>
</div>
</div>

<h4 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 w-full text-left">Loja</h4>

<div class="grid grid-cols-2 gap-3 w-full mb-6">
${items
                            .map(
                                (item, i) => `
<button class="shop-item relative bg-white border-2 border-gray-200 rounded-xl p-3 flex flex-col items-center gap-1 transition-all hover:border-brand-blue hover:shadow-md active:scale-95 group" data-idx="${i}">
<div class="w-10 h-10 rounded-full ${item.color} flex items-center justify-center text-lg mb-1">
<i class="fas ${item.icon}"></i>
</div>
<span class="font-bold text-gray-700 text-sm leading-tight">${item.name}</span>
<span class="font-mono text-xs font-bold text-brand-green bg-green-50 px-2 py-0.5 rounded">R$ ${item.price}</span>

<div class="absolute top-2 right-2 text-brand-green opacity-0 check-icon transition-opacity">
<i class="fas fa-check-circle"></i>
</div>
</button>
`
                            )
                            .join("")}
</div>

<div class="w-full bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl p-3 text-center transition-colors" id="result-area">
<p class="text-sm text-gray-500 font-bold" id="result-msg">Selecione os itens para comprar.</p>
</div>

<button id="btn-buy" class="w-full mt-4 bg-brand-blue text-white font-bold py-3 rounded-xl shadow-btn opacity-50 cursor-not-allowed transition-all">
Calcular Troco
</button>

</div>
`;

                    const cartTotalEl = container.querySelector("#cart-total");
                    const resultArea = container.querySelector("#result-area");
                    const resultMsg = container.querySelector("#result-msg");
                    const btnBuy = container.querySelector("#btn-buy");
                    const shopItems = container.querySelectorAll(".shop-item");

                    const updateCart = () => {
                        const total = cart.reduce(
                            (sum, idx) => sum + items[idx].price,
                            0
                        );
                        cartTotalEl.innerText = `R$ ${total},00`;

                        // Verifica estado
                        if (total === 0) {
                            btnBuy.innerText = "Selecione algo";
                            btnBuy.classList.add(
                                "opacity-50",
                                "cursor-not-allowed",
                                "bg-brand-blue"
                            );
                            btnBuy.classList.remove(
                                "bg-brand-green",
                                "bg-brand-red",
                                "shadow-none"
                            );
                            resultArea.className =
                                "w-full bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl p-3 text-center";
                            resultMsg.innerText = "Selecione os itens para comprar.";
                            resultMsg.className = "text-sm text-gray-500 font-bold";
                        } else if (total > budget) {
                            // Estourou
                            btnBuy.innerText = "Saldo Insuficiente";
                            btnBuy.classList.add(
                                "opacity-100",
                                "bg-brand-red",
                                "cursor-not-allowed"
                            );
                            btnBuy.classList.remove(
                                "opacity-50",
                                "bg-brand-blue",
                                "bg-brand-green"
                            );

                            resultArea.className =
                                "w-full bg-red-50 border-2 border-red-300 rounded-xl p-3 text-center";
                            resultMsg.innerHTML = `Faltam <strong class="text-brand-red">R$ ${total - budget
                                },00</strong>! Tire algo do carrinho.`;
                            resultMsg.className = "text-sm text-red-800";
                        } else {
                            // Pode comprar
                            btnBuy.innerText = "Finalizar Compra";
                            btnBuy.classList.remove(
                                "opacity-50",
                                "cursor-not-allowed",
                                "bg-brand-red",
                                "bg-brand-blue"
                            );
                            btnBuy.classList.add("bg-brand-green", "shadow-btn");

                            resultArea.className =
                                "w-full bg-blue-50 border-2 border-blue-200 rounded-xl p-3 text-center";
                            resultMsg.innerText = "Clique para calcular o troco.";
                            resultMsg.className = "text-sm text-brand-blue font-bold";

                            // Habilita clique para finalizar
                            btnBuy.onclick = () => showReceipt(total);
                        }
                    };

                    const showReceipt = (total) => {
                        const change = budget - total;
                        resultArea.className =
                            "w-full bg-green-100 border-2 border-green-400 rounded-xl p-4 text-center animate-pop-in";

                        resultMsg.innerHTML = `
<div class="text-xs uppercase font-bold text-green-700 mb-1">Compra Realizada!</div>
<div class="font-mono text-sm text-green-800">
${budget} - ${total} = <span class="text-2xl font-black block mt-1">R$ ${change},00</span>
</div>
<div class="text-[10px] font-bold text-green-600 mt-1 uppercase">de Troco</div>
`;

                        btnBuy.onclick = null; // Trava
                        btnBuy.innerText = "Sucesso!";
                    };

                    shopItems.forEach((btn) => {
                        btn.onclick = () => {
                            const idx = parseInt(btn.dataset.idx);
                            const check = btn.querySelector(".check-icon");

                            if (cart.includes(idx)) {
                                // Remove
                                cart = cart.filter((i) => i !== idx);
                                btn.classList.remove("border-brand-blue", "bg-blue-50");
                                btn.classList.add("border-gray-200", "bg-white");
                                check.classList.add("opacity-0");
                            } else {
                                // Adiciona
                                cart.push(idx);
                                btn.classList.add("border-brand-blue", "bg-blue-50");
                                btn.classList.remove("border-gray-200", "bg-white");
                                check.classList.remove("opacity-0");
                            }
                            updateCart();
                        };
                    });
                },

                interactive_lines_lab(container) {
                    let angle = 0; // 0 = Paralela

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<div class="flex justify-between w-full mb-4 items-center">
<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest">Analisador de Posi√ß√£o</h3>
<span id="status-badge" class="bg-blue-100 text-brand-blue px-3 py-1 rounded-full text-xs font-black uppercase transition-colors">Paralelas</span>
</div>

<div class="relative w-64 h-64 bg-gray-50 rounded-full border-4 border-gray-200 flex items-center justify-center overflow-hidden mb-6 shadow-inner">
<div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(#000 1px, transparent 1px); background-size: 20px 20px;"></div>

<div class="absolute w-full h-2 bg-brand-blue rounded-full shadow-sm"></div>

<div id="moving-line" class="absolute w-full h-2 bg-brand-red rounded-full shadow-sm transition-transform duration-100 ease-out origin-center" style="transform: rotate(0deg);"></div>

<div id="right-angle-mark" class="absolute w-8 h-8 border-2 border-gray-400 opacity-0 transition-opacity duration-300"></div>
</div>

<div class="w-full max-w-xs px-4">
<input type="range" id="rotation-slider" min="0" max="180" value="0" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-red hover:accent-red-600">
<div class="flex justify-between text-[10px] text-gray-400 font-bold mt-2 uppercase">
<span>0¬∞</span>
<span>90¬∞</span>
<span>180¬∞</span>
</div>
</div>

<p class="text-center text-sm text-gray-500 mt-4 italic min-h-[20px]" id="desc-text">
As retas n√£o se tocam. A dist√¢ncia √© sempre a mesma.
</p>

</div>
`;

                    const slider = container.querySelector("#rotation-slider");
                    const line = container.querySelector("#moving-line");
                    const badge = container.querySelector("#status-badge");
                    const desc = container.querySelector("#desc-text");
                    const mark = container.querySelector("#right-angle-mark");

                    const update = () => {
                        angle = parseInt(slider.value);
                        line.style.transform = `rotate(${angle}deg)`;

                        // L√≥gica de Classifica√ß√£o
                        if (angle === 0 || angle === 180) {
                            // Paralelas
                            badge.innerText = "Paralelas";
                            badge.className =
                                "bg-blue-100 text-brand-blue px-3 py-1 rounded-full text-xs font-black uppercase transition-colors";
                            desc.innerText = "Como trilhos de trem. Nunca se encontram.";
                            mark.classList.add("opacity-0");
                        } else if (angle === 90) {
                            // Perpendiculares
                            badge.innerText = "Perpendiculares";
                            badge.className =
                                "bg-purple-100 text-brand-purple px-3 py-1 rounded-full text-xs font-black uppercase transition-colors";
                            desc.innerText =
                                "Formam uma cruz perfeita de 90¬∞ (√Çngulo Reto).";
                            mark.classList.remove("opacity-0");
                        } else {
                            // Concorrentes (Ob√≠quas)
                            badge.innerText = "Concorrentes";
                            badge.className =
                                "bg-orange-100 text-brand-orange px-3 py-1 rounded-full text-xs font-black uppercase transition-colors";
                            desc.innerText = "Elas se cruzam, mas o √¢ngulo n√£o √© reto.";
                            mark.classList.add("opacity-0");
                        }
                    };

                    slider.addEventListener("input", update);
                },

                interactive_city_challenge(container) {
                    // Dados do Jogo
                    const questions = [
                        { q: "Selecione uma rua <strong>PARALELA</strong> √† Rua A (Azul).", target: "rua-c", hint: "Paralelas nunca se cruzam." },
                        { q: "Selecione uma rua <strong>PERPENDICULAR</strong> √† Rua A (Azul).", target: "rua-b", hint: "Perpendiculares formam 90¬∞." },
                        { q: "Selecione uma rua <strong>CONCORRENTE</strong> (mas n√£o perpendicular).", target: "rua-d", hint: "Concorrentes se cruzam em qualquer √¢ngulo." },
                    ];

                    let currentQ = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-300 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-4 bg-white p-3 rounded-lg shadow-sm z-10">
            <div class="flex items-center gap-2">
                <span class="text-2xl">üë∑</span>
                <div class="flex flex-col">
                    <span class="text-[10px] font-bold text-gray-400 uppercase">Miss√£o</span>
                    <span class="text-xs font-bold text-gray-800" id="mission-num">1/3</span>
                </div>
            </div>
            <div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black shadow-sm">Pts: <span id="city-score">0</span></div>
        </div>

        <div class="w-full text-center mb-4 min-h-[40px] bg-white rounded-lg p-2 border border-gray-200 shadow-sm">
            <p class="text-sm text-gray-700" id="question-text">Carregando...</p>
        </div>

        <div class="relative w-full max-w-sm aspect-square bg-[#e5e5f7] rounded-xl border-4 border-gray-400 overflow-hidden shadow-inner cursor-pointer" id="map-area">
            <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(#444cf7 1px, transparent 1px); background-size: 20px 20px;"></div>
            
            <svg class="absolute inset-0 w-full h-full z-0" viewBox="0 0 300 300">
                <rect x="0" y="135" width="300" height="30" fill="#1CB0F6" opacity="0.8" />
                <text x="10" y="155" font-family="sans-serif" font-size="12" font-weight="bold" fill="white">RUA A (REF)</text>

                <g class="street-group cursor-pointer hover:opacity-80 transition-opacity" data-id="rua-c">
                    <rect x="0" y="220" width="300" height="25" fill="#6B7280" />
                    <line x1="0" y1="232.5" x2="300" y2="232.5" stroke="white" stroke-dasharray="10,10" stroke-width="2" />
                    <text x="10" y="237" font-family="sans-serif" font-size="10" font-weight="bold" fill="white">RUA C</text>
                    <rect x="0" y="210" width="300" height="45" fill="transparent" />
                </g>

                <g class="street-group cursor-pointer hover:opacity-80 transition-opacity" data-id="rua-b">
                    <rect x="100" y="0" width="25" height="300" fill="#6B7280" />
                    <line x1="112.5" y1="0" x2="112.5" y2="300" stroke="white" stroke-dasharray="10,10" stroke-width="2" />
                    <text x="103" y="20" font-family="sans-serif" font-size="10" font-weight="bold" fill="white" transform="rotate(90, 103, 20)">RUA B</text>
                    <rect x="90" y="0" width="45" height="300" fill="transparent" />
                </g>

                <g class="street-group cursor-pointer hover:opacity-80 transition-opacity" data-id="rua-d">
                    <line x1="200" y="0" x2="300" y2="300" stroke="#6B7280" stroke-width="25" />
                    <line x1="200" y="0" x2="300" y2="300" stroke="white" stroke-dasharray="10,10" stroke-width="2" />
                    <text x="240" y="150" font-family="sans-serif" font-size="10" font-weight="bold" fill="white" transform="rotate(72, 240, 150)">RUA D</text>
                    <line x1="200" y1="0" x2="300" y2="300" stroke="transparent" stroke-width="50" />
                </g>
            </svg>

            <div id="city-feedback" class="absolute inset-0 bg-white/95 hidden flex-col items-center justify-center z-30 animate-fade-in text-center p-4">
                <div class="text-6xl mb-2" id="fb-icon"></div>
                <h3 class="text-xl font-black text-brand-text mb-1" id="fb-title"></h3>
                <p class="text-sm text-gray-600 mb-4" id="fb-msg"></p>
                <button id="btn-next-city" class="bg-brand-blue text-white font-bold py-3 px-8 rounded-full shadow-lg active:scale-95 transition-all">Continuar</button>
            </div>
        </div>
    </div>
    `;

                    const qText = container.querySelector('#question-text');
                    const scoreEl = container.querySelector('#city-score');
                    const missionNum = container.querySelector('#mission-num');
                    const streets = container.querySelectorAll('.street-group');
                    const feedbackLayer = container.querySelector('#city-feedback');
                    const fbIcon = container.querySelector('#fb-icon');
                    const fbTitle = container.querySelector('#fb-title');
                    const fbMsg = container.querySelector('#fb-msg');
                    const btnNext = container.querySelector('#btn-next-city');

                    // Fun√ß√£o de Reset Interna
                    const resetGame = () => {
                        currentQ = 0;
                        score = 0;
                        scoreEl.innerText = 0;
                        loadLevel();
                    };

                    const loadLevel = () => {
                        if (currentQ >= questions.length) {
                            // Tela de Vit√≥ria
                            qText.innerHTML = `<span class="text-brand-green font-black">Cidade Constru√≠da!</span>`;

                            fbIcon.innerText = "üèÜ";
                            fbTitle.innerText = "Engenheiro Chefe!";
                            fbMsg.innerText = `Pontua√ß√£o Final: ${score}`;

                            btnNext.innerText = "Reiniciar Jogo";
                            // Corre√ß√£o: Agora chama a fun√ß√£o interna resetGame
                            btnNext.onclick = resetGame;

                            feedbackLayer.classList.remove('hidden');
                            feedbackLayer.classList.add('flex');
                            return;
                        }

                        const q = questions[currentQ];
                        qText.innerHTML = q.q;
                        missionNum.innerText = `${currentQ + 1}/${questions.length}`;

                        // Reset Cores
                        streets.forEach(s => {
                            const rect = s.querySelector('rect');
                            const line = s.querySelector('line:not([stroke="white"])');
                            if (rect) rect.setAttribute('fill', '#6B7280');
                            if (line) line.setAttribute('stroke', '#6B7280');
                        });

                        feedbackLayer.classList.add('hidden');
                        feedbackLayer.classList.remove('flex');

                        // Restaura bot√£o para modo "Continuar"
                        btnNext.innerText = "Continuar";
                        btnNext.onclick = nextLevel;
                    };

                    const nextLevel = () => {
                        currentQ++;
                        loadLevel();
                    };

                    const check = (selectedId) => {
                        const q = questions[currentQ];
                        const isCorrect = selectedId === q.target;
                        const selectedEl = container.querySelector(`[data-id="${selectedId}"]`);

                        const visualPart = selectedEl.querySelector('rect') || selectedEl.querySelector('line:not([stroke="white"])');

                        if (isCorrect) {
                            score += 100;
                            scoreEl.innerText = score;
                            if (visualPart) {
                                if (visualPart.tagName === 'rect') visualPart.setAttribute('fill', '#10B981');
                                else visualPart.setAttribute('stroke', '#10B981');
                            }

                            fbIcon.innerText = "‚úÖ";
                            fbTitle.innerText = "Excelente!";
                            fbTitle.className = "text-xl font-black text-brand-green mb-1";
                            fbMsg.innerText = "Essa √© a rua correta.";
                        } else {
                            if (visualPart) {
                                if (visualPart.tagName === 'rect') visualPart.setAttribute('fill', '#EF4444');
                                else visualPart.setAttribute('stroke', '#EF4444');
                            }

                            fbIcon.innerText = "üöß";
                            fbTitle.innerText = "Obra Embargada!";
                            fbTitle.className = "text-xl font-black text-brand-red mb-1";
                            fbMsg.innerText = q.hint;
                        }

                        feedbackLayer.classList.remove('hidden');
                        feedbackLayer.classList.add('flex');
                    };

                    streets.forEach(btn => {
                        btn.onclick = () => check(btn.dataset.id);
                    });

                    // Inicia
                    loadLevel();
                },

                interactive_line_cutter(container) {
                    let state = 0; // 0: Reta, 1: Semirreta, 2: Segmento

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">

<div class="flex justify-between w-full items-center mb-6">
<h3 class="text-brand-purple font-black uppercase text-xs tracking-widest">Transformador Geom√©trico</h3>
<div id="shape-label" class="bg-gray-100 text-gray-500 px-3 py-1 rounded-full text-xs font-black uppercase transition-colors">Reta</div>
</div>

<div class="relative w-full h-32 flex items-center justify-center bg-gray-50 rounded-xl border border-gray-200 mb-6 cursor-pointer group" id="click-zone">

<p class="absolute top-2 text-[10px] text-gray-400 font-bold uppercase group-hover:text-brand-purple transition-colors">Clique na linha para cortar!</p>

<svg width="100%" height="100%" class="overflow-visible transition-all duration-500">
<line id="geo-line" x1="0%" y1="50%" x2="100%" y2="50%" stroke="#4B4B4B" stroke-width="4" stroke-linecap="round" class="transition-all duration-500" />

<path id="arrow-left" d="M 10,50 L 20,40 M 10,50 L 20,60" fill="none" stroke="#4B4B4B" stroke-width="4" stroke-linecap="round" class="transition-opacity duration-300" />
<path id="arrow-right" d="M calc(100% - 10px),50 L calc(100% - 20px),40 M calc(100% - 10px),50 L calc(100% - 20px),60" fill="none" stroke="#4B4B4B" stroke-width="4" stroke-linecap="round" class="transition-opacity duration-300" />

<circle id="point-A" cx="20%" cy="50%" r="0" fill="#FF9600" class="transition-all duration-300" />
<circle id="point-B" cx="80%" cy="50%" r="0" fill="#58CC02" class="transition-all duration-300" />

<text x="50%" y="40%" font-size="24" class="opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none" style="transform-box: fill-box; transform-origin: center;">‚úÇÔ∏è</text>
</svg>

</div>

<div class="flex gap-2 text-center text-sm text-gray-600 min-h-[40px]" id="desc-geo">
Tem setas nos dois lados. √â infinita!
</div>

<button id="btn-reset-geo" class="mt-2 text-xs font-bold text-gray-400 underline hover:text-brand-blue hidden">Reiniciar</button>

</div>
`;

                    const clickZone = container.querySelector("#click-zone");
                    const shapeLabel = container.querySelector("#shape-label");
                    const descGeo = container.querySelector("#desc-geo");
                    const btnReset = container.querySelector("#btn-reset-geo");

                    const line = container.querySelector("#geo-line");
                    const arrowL = container.querySelector("#arrow-left");
                    const arrowR = container.querySelector("#arrow-right");
                    const pointA = container.querySelector("#point-A");
                    const pointB = container.querySelector("#point-B");

                    const updateVisuals = () => {
                        if (state === 0) {
                            // RETA
                            shapeLabel.innerText = "Reta";
                            shapeLabel.className =
                                "bg-gray-100 text-gray-500 px-3 py-1 rounded-full text-xs font-black uppercase";
                            descGeo.innerHTML =
                                "Infinita para os dois lados.<br>N√£o tem come√ßo nem fim.";

                            line.setAttribute("x1", "0%");
                            line.setAttribute("x2", "100%");
                            line.setAttribute("stroke", "#4B4B4B");

                            arrowL.style.opacity = "1";
                            arrowR.style.opacity = "1";

                            pointA.setAttribute("r", "0");
                            pointB.setAttribute("r", "0");

                            btnReset.classList.add("hidden");
                        } else if (state === 1) {
                            // SEMIRRETA
                            shapeLabel.innerText = "Semirreta";
                            shapeLabel.className =
                                "bg-orange-100 text-brand-orange px-3 py-1 rounded-full text-xs font-black uppercase";
                            descGeo.innerHTML =
                                "Voc√™ cortou um lado!<br>Tem come√ßo (Ponto A), mas n√£o tem fim.";

                            // Come√ßa em 20%
                            line.setAttribute("x1", "20%");
                            line.setAttribute("x2", "100%");
                            line.setAttribute("stroke", "#FF9600");

                            arrowL.style.opacity = "0"; // Some seta esq
                            arrowR.style.opacity = "1";

                            pointA.setAttribute("r", "6"); // Aparece ponto A
                            pointB.setAttribute("r", "0");

                            btnReset.classList.remove("hidden");
                        } else if (state === 2) {
                            // SEGMENTO
                            shapeLabel.innerText = "Segmento";
                            shapeLabel.className =
                                "bg-green-100 text-brand-green px-3 py-1 rounded-full text-xs font-black uppercase";
                            descGeo.innerHTML =
                                "Cortou o outro lado!<br>Agora √© um peda√ßo com come√ßo e fim.";

                            // De 20% a 80%
                            line.setAttribute("x1", "20%");
                            line.setAttribute("x2", "80%");
                            line.setAttribute("stroke", "#58CC02");

                            arrowL.style.opacity = "0";
                            arrowR.style.opacity = "0"; // Some seta dir

                            pointA.setAttribute("r", "6");
                            pointB.setAttribute("r", "6"); // Aparece ponto B
                        }
                    };

                    clickZone.onclick = () => {
                        if (state < 2) {
                            state++;
                            updateVisuals();
                        } else {
                            // Shake effect pra dizer que n√£o d√° pra cortar mais
                            clickZone.classList.add("animate-shake");
                            setTimeout(
                                () => clickZone.classList.remove("animate-shake"),
                                300
                            );
                        }
                    };

                    btnReset.onclick = (e) => {
                        e.stopPropagation();
                        state = 0;
                        updateVisuals();
                    };
                },

                interactive_segment_ruler(container) {
                    // Gera tamanho aleat√≥rio entre 3cm e 9cm (aprox visual)
                    let targetWidthCm = Math.floor(Math.random() * 6) + 3;

                    // Fator de convers√£o visual: digamos que 30px = 1cm na tela do widget
                    const pxPerCm = 30;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full items-center mb-6">
<h3 class="text-brand-blue font-black uppercase text-xs tracking-widest"><i class="fas fa-pencil-ruler"></i> Qual o tamanho?</h3>
<button id="btn-new-measure" class="text-xs font-bold text-brand-blue hover:underline">Novo Item</button>
</div>

<div class="relative w-full h-48 bg-gray-50 rounded-xl border border-gray-200 mb-4 overflow-hidden" id="measure-zone">

<div id="target-object" class="absolute top-10 left-8 h-4 rounded-full bg-brand-purple shadow-sm flex items-center justify-center text-white text-[10px] font-bold z-0 transition-all duration-500">
?
</div>
<div class="absolute top-10 left-8 bottom-0 border-l border-dashed border-purple-300"></div>
<div id="guide-line-right" class="absolute top-10 bottom-0 border-l border-dashed border-purple-300 transition-all duration-500"></div>

<div id="ruler" class="absolute bottom-4 left-4 w-[320px] h-12 bg-yellow-100 border border-yellow-600 rounded shadow-lg cursor-grab active:cursor-grabbing flex items-end z-10 select-none">
${[...Array(11)]
                            .map(
                                (_, i) => `
<div class="h-full flex flex-col justify-end items-center relative" style="width:${pxPerCm}px; flex-shrink:0;">
<span class="text-[10px] font-bold mb-1 text-yellow-900 absolute top-1">${i}</span>
<div class="w-px h-3 bg-yellow-800"></div>
</div>
`
                            )
                            .join("")}
</div>

</div>

<div class="flex gap-2 w-full max-w-xs items-end">
<div class="flex-1">
<label class="text-[10px] font-bold text-gray-400 uppercase">Sua Medida (cm)</label>
<input type="number" id="input-measure" class="w-full border-2 border-brand-blue rounded-lg p-2 text-center font-bold text-xl outline-none focus:bg-blue-50 text-brand-text" placeholder="0">
</div>
<button id="btn-check-measure" class="bg-brand-green text-white font-bold py-3 px-6 rounded-lg shadow-btn active:scale-95 active:shadow-none transition-all mb-0.5">
Conferir
</button>
</div>

<div id="measure-feedback" class="h-8 mt-2 text-sm font-bold text-center"></div>

</div>
`;

                    const targetObj = container.querySelector("#target-object");
                    const guideRight = container.querySelector("#guide-line-right");
                    const ruler = container.querySelector("#ruler");
                    const input = container.querySelector("#input-measure");
                    const btnCheck = container.querySelector("#btn-check-measure");
                    const btnNew = container.querySelector("#btn-new-measure");
                    const feedback = container.querySelector("#measure-feedback");

                    // L√≥gica da R√©gua (Drag and Drop Simples)
                    let isDragging = false;
                    let startX, startLeft;

                    const startDrag = (e) => {
                        isDragging = true;
                        startX = e.pageX || e.touches[0].pageX;
                        startLeft = ruler.offsetLeft;
                        ruler.classList.add("cursor-grabbing");
                    };

                    const stopDrag = () => {
                        isDragging = false;
                        ruler.classList.remove("cursor-grabbing");
                    };

                    const doDrag = (e) => {
                        if (!isDragging) return;
                        e.preventDefault(); // Evita scroll em touch
                        const x = e.pageX || e.touches[0].pageX;
                        const walk = x - startX;
                        let newLeft = startLeft + walk;

                        // Limites
                        const maxLeft = container.offsetWidth - ruler.offsetWidth;
                        if (newLeft > 20) newLeft = 20;
                        if (newLeft < -200) newLeft = -200;

                        ruler.style.left = `${newLeft}px`;
                    };

                    ruler.addEventListener("mousedown", startDrag);
                    ruler.addEventListener("touchstart", startDrag);
                    window.addEventListener("mouseup", stopDrag);
                    window.addEventListener("touchend", stopDrag);
                    window.addEventListener("mousemove", doDrag);
                    window.addEventListener("touchmove", doDrag);

                    // L√≥gica do Jogo
                    const newRound = () => {
                        targetWidthCm = Math.floor(Math.random() * 6) + 3; // 3 a 8 cm
                        const widthPx = targetWidthCm * pxPerCm;

                        targetObj.style.width = `${widthPx}px`;
                        targetObj.innerText = "?";
                        targetObj.className =
                            "absolute top-10 left-8 h-4 rounded-full bg-brand-purple shadow-sm flex items-center justify-center text-white text-[10px] font-bold z-0 transition-all duration-500";

                        // Ajusta linha guia
                        // left inicial √© 32px (2rem = left-8 do tailwind)
                        // 32px + widthPx
                        guideRight.style.left = `calc(2rem + ${widthPx}px)`;

                        input.value = "";
                        feedback.innerText = "";
                        ruler.style.left = "16px"; // Reseta posi√ß√£o da r√©gua
                    };

                    btnCheck.onclick = () => {
                        const val = parseInt(input.value);
                        if (val === targetWidthCm) {
                            feedback.innerHTML = `<span class="text-brand-green">Exato! Mede ${targetWidthCm} cm.</span>`;
                            targetObj.innerText = `${targetWidthCm} cm`;
                            targetObj.classList.replace(
                                "bg-brand-purple",
                                "bg-brand-green"
                            );
                        } else {
                            feedback.innerHTML = `<span class="text-brand-red">Quase! Tente ajustar a r√©gua. (Dica: o zero no in√≠cio)</span>`;
                        }
                    };

                    btnNew.onclick = newRound;

                    newRound();
                },

                interactive_virtual_ruler(container) {
                    // Objeto aleat√≥rio para medir (entre 3cm e 9cm visualmente)
                    const targetSizeCm = Math.floor(Math.random() * 6) + 3;
                    // Fator de escala: vamos dizer que 1cm = 30px na tela
                    const pxPerCm = 30;
                    const objectWidth = targetSizeCm * pxPerCm;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">

<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Laborat√≥rio de Medidas</h3>

<div class="relative w-full h-40 bg-gray-50 rounded-xl border border-gray-200 mb-4 overflow-hidden" id="workspace">

<div class="absolute top-8 left-1/2 -translate-x-1/2 h-4 bg-orange-400 rounded-full shadow-sm flex items-center justify-center z-0" style="width: ${objectWidth}px;">
<div class="w-full h-1 bg-orange-300 rounded-full"></div>
</div>

<div class="absolute top-4 bottom-4 left-1/2 -translate-x-1/2 border-l border-r border-dashed border-gray-300 w-full pointer-events-none" style="width: ${objectWidth}px;"></div>

<div id="ruler-tool" class="absolute bottom-4 cursor-grab active:cursor-grabbing shadow-lg transition-transform duration-75" style="left: 10px;">
<div class="w-[400px] h-12 bg-yellow-100 border border-yellow-600 rounded flex items-end px-4 relative">
${[...Array(13)]
                            .map(
                                (_, i) => `
<div class="absolute bottom-0 h-full flex flex-col justify-end items-center" style="left: ${40 + i * pxPerCm
                                    }px;">
<div class="h-4 w-0.5 bg-black"></div>
<span class="text-[10px] font-bold absolute bottom-5">${i}</span>
</div>
${i < 12
                                        ? `<div class="absolute bottom-0 h-2 w-px bg-gray-500" style="left: ${40 + i * pxPerCm + pxPerCm / 2
                                        }px;"></div>`
                                        : ""
                                    }
`
                            )
                            .join("")}
</div>
</div>

</div>

<div class="flex flex-col items-center gap-2 w-full max-w-xs">
<p class="text-xs font-bold text-gray-400 uppercase">Qual o tamanho do objeto?</p>
<div class="flex gap-2 w-full">
<input type="number" id="input-measure" class="flex-1 border-2 border-brand-blue rounded-xl p-2 text-center font-bold text-xl outline-none focus:bg-blue-50 text-brand-blue" placeholder="0">
<button id="btn-verify" class="bg-brand-green text-white font-bold px-6 rounded-xl shadow-btn active:scale-95 transition-all">
Verificar
</button>
</div>
<div id="ruler-feedback" class="h-6 text-sm font-bold text-center"></div>
</div>

<p class="text-[10px] text-gray-400 mt-2 text-center">Arraste a r√©gua amarela para medir. Alinhe o 0!</p>
</div>
`;

                    const ruler = container.querySelector("#ruler-tool");
                    const input = container.querySelector("#input-measure");
                    const btn = container.querySelector("#btn-verify");
                    const feedback = container.querySelector("#ruler-feedback");
                    const workspace = container.querySelector("#workspace");

                    // L√≥gica de Arrastar (Drag)
                    let isDragging = false;
                    let startX, startLeft;

                    const startDrag = (e) => {
                        isDragging = true;
                        startX = e.type.includes("mouse") ? e.pageX : e.touches[0].pageX;
                        startLeft = parseInt(ruler.style.left || 10);
                        ruler.style.cursor = "grabbing";
                    };

                    const doDrag = (e) => {
                        if (!isDragging) return;
                        e.preventDefault(); // Evita scroll no mobile
                        const x = e.type.includes("mouse") ? e.pageX : e.touches[0].pageX;
                        const walk = x - startX;
                        // Limites simples para n√£o sumir da tela
                        let newLeft = startLeft + walk;
                        if (newLeft < -200) newLeft = -200;
                        if (newLeft > 200) newLeft = 200;

                        ruler.style.left = `${newLeft}px`;
                    };

                    const stopDrag = () => {
                        isDragging = false;
                        ruler.style.cursor = "grab";
                    };

                    ruler.addEventListener("mousedown", startDrag);
                    ruler.addEventListener("touchstart", startDrag);
                    window.addEventListener("mousemove", doDrag);
                    window.addEventListener("touchmove", doDrag, { passive: false });
                    window.addEventListener("mouseup", stopDrag);
                    window.addEventListener("touchend", stopDrag);

                    // Verifica√ß√£o
                    btn.onclick = () => {
                        const val = parseFloat(input.value);
                        if (val === targetSizeCm) {
                            feedback.innerHTML = `<span class="text-brand-green flex items-center gap-2 justify-center"><i class="fas fa-check-circle"></i> Exato! ${targetSizeCm} cm.</span>`;
                            input.classList.add("border-green-500", "text-green-600");
                            // Confetti effect could go here
                        } else {
                            feedback.innerHTML = `<span class="text-brand-red">Ops! Tente alinhar o 0 bem no in√≠cio.</span>`;
                            input.classList.add("animate-shake", "border-red-500");
                            setTimeout(() => input.classList.remove("animate-shake"), 500);
                        }
                    };
                },

                interactive_precision_game(container) {
                    // Configura√ß√£o
                    const rulerMax = 20; // 20cm
                    let targetVal = 0;
                    let currentVal = 0;
                    let direction = 1; // 1 = direita, -1 = esquerda
                    let speed = 0.15; // Velocidade base (cm por frame)
                    let isRunning = false;
                    let animId = null;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">

<div class="flex justify-between w-full items-center mb-6">
<h3 class="text-brand-red font-black uppercase text-xs tracking-widest"><i class="fas fa-bullseye"></i> Desafio de Precis√£o</h3>
<div class="bg-gray-100 text-gray-500 px-3 py-1 rounded-full text-xs font-black shadow-sm">Alvo: <span id="target-display" class="text-brand-blue text-lg">?</span> cm</div>
</div>

<div class="relative w-full h-32 bg-gray-50 border-b-4 border-gray-400 mb-6" id="ruler-body">

<div class="absolute inset-0 flex justify-between items-end px-[2px]">
${Array.from({ length: 21 })
                            .map(
                                (_, i) => `
<div class="flex flex-col items-center justify-end h-full" style="width: 1px;">
<div class="${i % 5 === 0 ? "h-8 bg-gray-800" : "h-4 bg-gray-400"} w-0.5"></div>
${i % 5 === 0
                                        ? `<span class="text-[10px] font-bold text-gray-600 mt-1 absolute bottom-10">${i}</span>`
                                        : ""
                                    }
</div>
`
                            )
                            .join("")}
</div>

<div id="cursor" class="absolute top-0 bottom-0 w-1 bg-brand-red z-20 shadow-[0_0_10px_rgba(239,68,68,0.6)]" style="left: 0%;">
<div class="absolute -top-3 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-t-[8px] border-t-brand-red"></div>
<div class="absolute -bottom-3 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-b-[8px] border-b-brand-red"></div>
</div>

<div id="target-zone" class="absolute top-0 bottom-0 w-1 bg-brand-blue/30 z-10 border-x border-brand-blue/50 box-content" style="left: 0; width: 0;"></div>

</div>

<div class="text-center mb-6 h-12">
<p class="text-xs text-gray-400 font-bold uppercase mb-1">Sua Medida</p>
<p class="text-4xl font-mono font-black text-brand-text" id="current-display">0.00 cm</p>
</div>

<button id="btn-action" class="w-full max-w-xs bg-brand-blue text-white font-bold py-4 rounded-xl shadow-btn active:shadow-none active:translate-y-1 transition-all text-xl uppercase tracking-widest">
PARAR!
</button>

<div id="feedback-msg" class="h-8 mt-4 font-bold text-sm text-center"></div>

</div>
`;

                    const cursor = container.querySelector("#cursor");
                    const targetZone = container.querySelector("#target-zone");
                    const targetDisp = container.querySelector("#target-display");
                    const currentDisp = container.querySelector("#current-display");
                    const btn = container.querySelector("#btn-action");
                    const feedback = container.querySelector("#feedback-msg");

                    // L√≥gica do Jogo
                    const startGame = () => {
                        // Define Alvo Aleat√≥rio (entre 2cm e 18cm para n√£o ficar nas bordas)
                        targetVal = Math.random() * 16 + 2;
                        targetVal = Math.round(targetVal * 10) / 10; // 1 casa decimal (ex: 12.5)

                        // UI Setup
                        targetDisp.innerText = targetVal.toFixed(1);
                        currentDisp.innerText = "0.00 cm";
                        currentDisp.className =
                            "text-4xl font-mono font-black text-brand-text";
                        feedback.innerText = "";

                        btn.innerText = "PARAR!";
                        btn.className =
                            "w-full max-w-xs bg-brand-red text-white font-bold py-4 rounded-xl shadow-btn active:shadow-none active:translate-y-1 transition-all text-xl uppercase tracking-widest";

                        // Posiciona a Zona Alvo Visual (Toler√¢ncia de 0.5cm visual)
                        const tolerancePx = (0.5 / rulerMax) * 100; // % de largura
                        const targetPos = (targetVal / rulerMax) * 100;

                        targetZone.style.left = `calc(${targetPos}% - ${tolerancePx}%)`;
                        targetZone.style.width = `${tolerancePx * 2}%`;

                        // Reset Variaveis
                        currentVal = 0;
                        direction = 1;
                        isRunning = true;

                        loop();
                    };

                    const loop = () => {
                        if (!isRunning) return;

                        // Atualiza Posi√ß√£o Matem√°tica
                        currentVal += speed * direction;

                        // Colis√£o com bordas (Ping-pong)
                        if (currentVal >= rulerMax) {
                            currentVal = rulerMax;
                            direction = -1;
                        } else if (currentVal <= 0) {
                            currentVal = 0;
                            direction = 1;
                        }

                        // Atualiza Visual (Sincronia total)
                        const pct = (currentVal / rulerMax) * 100;
                        cursor.style.left = `${pct}%`;
                        currentDisp.innerText = currentVal.toFixed(2) + " cm";

                        animId = requestAnimationFrame(loop);
                    };

                    const stopGame = () => {
                        isRunning = false;
                        cancelAnimationFrame(animId);

                        const diff = Math.abs(currentVal - targetVal);
                        const tolerance = 0.5; // 0.5 cm de margem

                        if (diff <= tolerance) {
                            // Vit√≥ria
                            const accuracy = (100 - diff * 10).toFixed(0); // Score fake
                            feedback.innerHTML = `<span class="text-brand-green flex items-center justify-center gap-2"><i class="fas fa-check-circle"></i> Na mosca! Diferen√ßa de apenas ${diff.toFixed(
                                2
                            )} cm.</span>`;
                            currentDisp.className =
                                "text-4xl font-mono font-black text-brand-green scale-110 transition-transform";
                            btn.className =
                                "w-full max-w-xs bg-brand-green text-white font-bold py-4 rounded-xl shadow-btn transition-all text-xl uppercase tracking-widest";
                            btn.innerText = "Pr√≥ximo N√≠vel";
                        } else {
                            // Derrota
                            feedback.innerHTML = `<span class="text-brand-red flex items-center justify-center gap-2"><i class="fas fa-times-circle"></i> Passou longe! Diferen√ßa de ${diff.toFixed(
                                2
                            )} cm.</span>`;
                            currentDisp.className =
                                "text-4xl font-mono font-black text-brand-red";
                            btn.className =
                                "w-full max-w-xs bg-gray-500 text-white font-bold py-4 rounded-xl shadow-btn transition-all text-xl uppercase tracking-widest";
                            btn.innerText = "Tentar de Novo";
                        }

                        btn.onclick = () => {
                            btn.onclick = stopGame; // Restaura fun√ß√£o original
                            startGame();
                        };
                    };

                    btn.onclick = stopGame;

                    // Init
                    startGame();
                },

                interactive_compass_transport(container) {
                    let radius = 50; // Raio inicial

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
<h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-4">Simulador de Compasso</h3>

<div class="relative w-full h-64 bg-white border border-gray-200 rounded-xl mb-6 shadow-inner cursor-crosshair overflow-hidden" id="paper">
<div class="absolute inset-0 opacity-20 pointer-events-none" style="background-image: linear-gradient(#ccc 1px, transparent 1px), linear-gradient(90deg, #ccc 1px, transparent 1px); background-size: 20px 20px;"></div>

<div class="absolute top-1/2 left-1/2 w-2 h-2 bg-gray-800 rounded-full -translate-x-1/2 -translate-y-1/2 z-20"></div>

<svg class="absolute inset-0 w-full h-full pointer-events-none z-10">
<circle cx="50%" cy="50%" r="${radius}" stroke="#FF9600" stroke-width="3" fill="rgba(255, 150, 0, 0.1)" stroke-dasharray="0 1000" id="draw-circle" transform="rotate(-90 50% 50%)" />
</svg>

<div id="compass-visual" class="absolute top-1/2 left-1/2 w-4 h-32 origin-top transition-transform duration-300 z-30 pointer-events-none" style="transform: rotate(0deg);">
<div class="absolute top-0 left-1/2 w-1 h-32 bg-gray-400 origin-top transform -rotate-12"></div>
<div class="absolute top-0 left-1/2 w-1 h-32 bg-brand-orange origin-top transform rotate-12" id="leg-movable">
<div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-2 h-4 bg-gray-800"></div> </div>
<div class="absolute top-[-5px] left-1/2 -translate-x-1/2 w-4 h-6 bg-gray-600 rounded-full"></div>
</div>
</div>

<div class="w-full max-w-xs space-y-4">
<div>
<div class="flex justify-between text-xs font-bold uppercase text-gray-500 mb-1">
<span>Abertura (Raio)</span>
<span id="rad-val" class="text-brand-orange">${radius} mm</span>
</div>
<input type="range" id="radius-slider" min="20" max="100" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-orange">
</div>

<button id="btn-draw" class="w-full bg-brand-orange hover:bg-orange-600 text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all flex items-center justify-center gap-2">
<i class="fas fa-pencil-alt"></i> Tra√ßar C√≠rculo
</button>
</div>

<p class="text-[10px] text-gray-400 mt-3 text-center italic">
O compasso "transporta" a medida da abertura para o papel, criando pontos √† mesma dist√¢ncia do centro.
</p>

</div>
`;

                    const slider = container.querySelector("#radius-slider");
                    const radVal = container.querySelector("#rad-val");
                    const circle = container.querySelector("#draw-circle");
                    const legMovable = container.querySelector("#leg-movable");
                    const compassVisual = container.querySelector("#compass-visual");
                    const btnDraw = container.querySelector("#btn-draw");

                    // Ajusta a abertura visual das pernas do compasso
                    const updateVisuals = (r) => {
                        radVal.innerText = `${r} mm`;
                        // Ajuste simples de √¢ngulo para simular abertura
                        const angle = r * 0.4;
                        legMovable.style.transform = `rotate(${angle}deg)`;

                        // Reseta c√≠rculo
                        circle.setAttribute("r", r);
                        circle.style.strokeDasharray = `0 1000`; // Esconde
                        circle.style.transition = "none";
                        compassVisual.style.transform = "rotate(0deg)";
                    };

                    slider.oninput = (e) => {
                        radius = e.target.value;
                        updateVisuals(radius);
                    };

                    btnDraw.onclick = () => {
                        // Anima√ß√£o de Desenho
                        const circumference = 2 * Math.PI * radius;

                        // Prepara anima√ß√£o
                        circle.style.transition = "stroke-dasharray 2s linear";
                        circle.style.strokeDasharray = `${circumference} 1000`; // Preenche

                        // Gira o compasso visualmente
                        compassVisual.style.transition = "transform 2s linear";
                        compassVisual.style.transform = "rotate(360deg)";

                        btnDraw.disabled = true;
                        btnDraw.classList.add("opacity-50");

                        setTimeout(() => {
                            btnDraw.disabled = false;
                            btnDraw.classList.remove("opacity-50");
                        }, 2000);
                    };

                    updateVisuals(radius);
                },

                interactive_angle_regions(container) {
                    let angle = 45;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Classificador de √Çngulos</h3>

<div class="relative w-64 h-64 bg-gray-50 rounded-full border-4 border-gray-200 flex items-center justify-center mb-8 shadow-inner">
<div class="absolute w-full h-px bg-gray-300"></div>
<div class="absolute h-full w-px bg-gray-300"></div>

<svg class="absolute inset-0 w-full h-full overflow-visible pointer-events-none">
<path id="angle-arc" d="" fill="rgba(206, 130, 255, 0.2)" stroke="#CE82FF" stroke-width="2" />
</svg>

<div class="absolute w-1/2 h-1 bg-gray-800 right-0 origin-left rounded-full"></div>

<div id="moving-arm" class="absolute w-1/2 h-1 bg-brand-purple origin-left left-1/2 rounded-full shadow-sm transition-transform duration-100 ease-out" style="transform: rotate(0deg);">
<div class="absolute right-0 top-1/2 -translate-y-1/2 w-4 h-4 bg-brand-purple rounded-full border-2 border-white shadow-sm"></div>
</div>

<div class="absolute w-4 h-4 bg-white border-2 border-gray-800 rounded-full z-10"></div>
</div>

<div class="flex flex-col items-center gap-2 w-full max-w-xs">
<div class="flex justify-between w-full items-end">
<span id="angle-val" class="text-3xl font-black text-brand-text">45¬∞</span>
<span id="angle-name" class="px-3 py-1 rounded-lg bg-purple-100 text-brand-purple font-bold text-sm uppercase">Agudo</span>
</div>

<input type="range" id="ang-slider" min="0" max="360" value="45" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-purple hover:accent-purple-600">

<div class="flex justify-between w-full text-[10px] text-gray-400 font-bold uppercase mt-1">
<span>0¬∞</span>
<span>90¬∞</span>
<span>180¬∞</span>
<span>270¬∞</span>
<span>360¬∞</span>
</div>
</div>

<div class="grid grid-cols-3 gap-2 mt-6 w-full">
<button class="snap-btn bg-white border border-gray-200 rounded py-1 text-xs font-bold text-gray-500 hover:bg-gray-50" data-v="0">Nulo</button>
<button class="snap-btn bg-white border border-gray-200 rounded py-1 text-xs font-bold text-gray-500 hover:bg-gray-50" data-v="90">Reto</button>
<button class="snap-btn bg-white border border-gray-200 rounded py-1 text-xs font-bold text-gray-500 hover:bg-gray-50" data-v="180">Raso</button>
<button class="snap-btn bg-white border border-gray-200 rounded py-1 text-xs font-bold text-gray-500 hover:bg-gray-50" data-v="270">C√¥ncavo</button>
<button class="snap-btn bg-white border border-gray-200 rounded py-1 text-xs font-bold text-gray-500 hover:bg-gray-50" data-v="360">Completo</button>
</div>

</div>
`;

                    const slider = container.querySelector("#ang-slider");
                    const arm = container.querySelector("#moving-arm");
                    const valDisplay = container.querySelector("#angle-val");
                    const nameDisplay = container.querySelector("#angle-name");
                    const arcPath = container.querySelector("#angle-arc");
                    const snapBtns = container.querySelectorAll(".snap-btn");

                    const update = () => {
                        angle = parseInt(slider.value);

                        // Rota√ß√£o do Bra√ßo (CSS roda sentido hor√°rio, mas matem√°tica √© anti-hor√°rio.
                        // Aqui, para simplificar a visualiza√ß√£o do input range, vamos usar sentido hor√°rio como 'crescente')
                        // Obs: No widget anterior usamos anti-hor√°rio. Vamos manter o padr√£o visual de rel√≥gio aqui para 6¬∫ ano ser mais intuitivo com o slider
                        // 0 graus na direita (3h).
                        arm.style.transform = `rotate(-${angle}deg)`; // Negativo para ir anti-hor√°rio (matem√°tico padr√£o)

                        valDisplay.innerText = `${angle}¬∞`;

                        // Classifica√ß√£o
                        let name = "";
                        let color = "text-gray-500 bg-gray-100";

                        if (angle === 0) {
                            name = "Nulo";
                            color = "text-gray-500 bg-gray-200";
                        } else if (angle < 90) {
                            name = "Agudo";
                            color = "text-green-600 bg-green-100";
                        } else if (angle === 90) {
                            name = "Reto";
                            color = "text-blue-600 bg-blue-100";
                        } else if (angle < 180) {
                            name = "Obtuso";
                            color = "text-orange-600 bg-orange-100";
                        } else if (angle === 180) {
                            name = "Raso (Meia Volta)";
                            color = "text-red-600 bg-red-100";
                        } else if (angle < 360) {
                            name = "C√¥ncavo (Reflexo)";
                            color = "text-purple-600 bg-purple-100";
                        } else if (angle === 360) {
                            name = "Completo (Uma Volta)";
                            color = "text-brand-text bg-gray-200";
                        }

                        nameDisplay.innerText = name;
                        nameDisplay.className = `px-3 py-1 rounded-lg font-bold text-sm uppercase transition-colors ${color}`;

                        // Desenhar Arco SVG
                        if (angle > 0) {
                            const rad = angle * (Math.PI / 180);
                            // Centro (128, 128) - Raio 40
                            const cx = 128,
                                cy = 128,
                                r = 40;
                            // Ponto Final (Anti-hor√°rio)
                            // Lembre que Y do SVG cresce pra baixo.
                            const endX = cx + r * Math.cos(-rad);
                            const endY = cy + r * Math.sin(-rad);

                            const largeArc = angle > 180 ? 1 : 0;

                            // M (Move to Start on Right) A (Arc)
                            const d = `M ${cx + r
                                } ${cy} A ${r} ${r} 0 ${largeArc} 0 ${endX} ${endY} L ${cx} ${cy} Z`;
                            arcPath.setAttribute("d", d);
                            arcPath.style.opacity = 1;
                        } else {
                            arcPath.style.opacity = 0;
                        }
                    };

                    slider.oninput = update;

                    snapBtns.forEach((btn) => {
                        btn.onclick = () => {
                            slider.value = btn.dataset.v;
                            update();
                        };
                    });

                    update();
                },

                interactive_combinatorics(container) {
                    // Configura√ß√£o do Cen√°rio
                    const breadOptions = [
                        {
                            name: "P√£o Franc√™s",
                            icon: "ü•ñ",
                            color: "bg-orange-100 border-orange-300",
                        },
                        {
                            name: "P√£o de Forma",
                            icon: "üçû",
                            color: "bg-yellow-100 border-yellow-300",
                        },
                        {
                            name: "P√£o de Hamb√∫rguer",
                            icon: "üçî",
                            color: "bg-red-100 border-red-300",
                        },
                    ];

                    const fillingOptions = [
                        { name: "Queijo", icon: "üßÄ", color: "bg-yellow-200" },
                        { name: "Presunto", icon: "üçñ", color: "bg-pink-200" },
                    ];

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-green font-bold uppercase text-xs tracking-widest mb-4">F√°brica de Lanches (Combinat√≥ria)</h3>

<div class="flex justify-center items-center gap-4 mb-6 text-xl font-mono font-bold bg-green-50 p-3 rounded-lg border border-green-200">
<div class="text-center">
<span class="text-brand-orange text-3xl block mb-1">${breadOptions.length}</span>
<span class="text-[10px] text-gray-500 uppercase">Tipos de P√£o</span>
</div>
<div class="text-gray-300">√ó</div>
<div class="text-center">
<span class="text-brand-purple text-3xl block mb-1">${fillingOptions.length}</span>
<span class="text-[10px] text-gray-500 uppercase">Recheios</span>
</div>
<div class="text-gray-300">=</div>
<div class="text-center">
<span class="text-brand-green text-4xl block mb-1" id="total-combos">?</span>
<span class="text-[10px] text-gray-500 uppercase">Combina√ß√µes</span>
</div>
</div>

<button id="btn-generate" class="bg-brand-blue hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-xl shadow-btn active:scale-95 transition-all mb-6">
Mostrar Todas as Possibilidades
</button>

<div id="tree-display" class="w-full flex flex-col gap-4 opacity-50 blur-sm transition-all duration-500">
<p class="text-center text-gray-400 italic">Clique no bot√£o para ver a √°rvore.</p>
</div>

</div>
`;

                    const treeDisplay = container.querySelector("#tree-display");
                    const btn = container.querySelector("#btn-generate");
                    const totalEl = container.querySelector("#total-combos");

                    const renderTree = () => {
                        treeDisplay.innerHTML = "";

                        breadOptions.forEach((bread, i) => {
                            // Container do Ramo (P√£o)
                            const branch = document.createElement("div");
                            branch.className = "flex items-center gap-4 animate-slide-up";
                            branch.style.animationDelay = `${i * 0.2}s`;

                            // O N√≥ do P√£o
                            const breadNode = document.createElement("div");
                            breadNode.className = `w-32 p-2 rounded-lg border-2 ${bread.color} flex items-center gap-2 shadow-sm z-10 relative`;
                            breadNode.innerHTML = `<span class="text-2xl">${bread.icon}</span> <span class="text-xs font-bold text-gray-700 leading-tight">${bread.name}</span>`;

                            // Conector (Linhas)
                            const connector = document.createElement("div");
                            connector.className =
                                "flex flex-col gap-2 relative pl-8 border-l-2 border-gray-300 ml-4";

                            // As Folhas (Recheios)
                            fillingOptions.forEach((fill) => {
                                const leaf = document.createElement("div");
                                leaf.className = `flex items-center gap-2 bg-white border border-gray-200 p-1 rounded-md shadow-sm relative`;

                                // Linha horizontal conectora
                                const line = document.createElement("div");
                                line.className =
                                    "absolute top-1/2 -left-8 w-8 h-0.5 bg-gray-300";

                                leaf.innerHTML = `
${line.outerHTML}
<span class="text-lg">${fill.icon}</span> 
<span class="text-[10px] font-bold text-gray-600">${bread.icon} + ${fill.icon}</span>
`;
                                connector.appendChild(leaf);
                            });

                            branch.appendChild(breadNode);
                            branch.appendChild(connector);
                            treeDisplay.appendChild(branch);
                        });

                        // Atualiza Total
                        totalEl.innerText = breadOptions.length * fillingOptions.length;
                        totalEl.classList.add("scale-125", "text-brand-green");

                        // Remove blur
                        treeDisplay.classList.remove("opacity-50", "blur-sm");

                        btn.innerText = "Reiniciar";
                        btn.onclick = () => {
                            treeDisplay.classList.add("opacity-50", "blur-sm");
                            totalEl.innerText = "?";
                            setTimeout(() => {
                                btn.onclick = renderTree;
                                btn.innerText = "Mostrar Todas as Possibilidades";
                            }, 300);
                        };
                    };

                    btn.onclick = renderTree;
                },

                interactive_protractor_reader(container) {
                    let currentAngle = 0;
                    let direction = 1; // 1 = Direita (Anti-hor√°rio), -1 = Esquerda (Hor√°rio)

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative">

<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Qual √© a medida?</h3>

<div class="relative w-[300px] h-[170px] mb-6 flex justify-center items-end overflow-hidden">

<div class="absolute bottom-5 left-1/2 w-full h-[200px] origin-bottom-left" id="angle-display-area" style="transform: translateX(-50%);">
<div class="absolute bottom-0 left-1/2 w-[140px] h-1 bg-black origin-left" id="ray-base"></div>
<div class="absolute bottom-0 left-1/2 w-[140px] h-1 bg-brand-red origin-left transition-transform duration-500" id="ray-move"></div>
<div class="absolute bottom-0 left-1/2 w-12 h-12 rounded-full border-2 border-brand-red opacity-50" id="ray-arc"></div>
</div>

<svg viewBox="0 0 300 160" class="absolute bottom-0 w-full h-full pointer-events-none opacity-90">
<path d="M 10 150 A 140 140 0 0 1 290 150 L 260 150 A 110 110 0 0 0 40 150 Z" fill="#e0f2fe" stroke="#1CB0F6" stroke-width="2"/>
<line x1="150" y1="150" x2="150" y2="140" stroke="black" stroke-width="2"/> <line x1="10" y1="150" x2="290" y2="150" stroke="black" stroke-width="1"/> ${[
                            ...Array(19),
                        ]
                            .map((_, i) => {
                                const deg = i * 10;
                                const rad = (deg * Math.PI) / 180;
                                // Escala Externa (0 na esquerda -> 180 direita)
                                const x1 = 150 - 130 * Math.cos(rad);
                                const y1 = 150 - 130 * Math.sin(rad);
                                // Escala Interna (180 na esquerda -> 0 direita)
                                const x2 = 150 - 115 * Math.cos(rad);
                                const y2 = 150 - 115 * Math.sin(rad);

                                // Texto
                                return `
<line x1="${x1}" y1="${y1}" x2="${150 - 135 * Math.cos(rad)}" y2="${150 - 135 * Math.sin(rad)
                                    }" stroke="#1CB0F6" stroke-width="1" />
<text x="${x2}" y="${y2}" font-size="8" text-anchor="middle" fill="#555" transform="rotate(${90 - deg
                                    } ${x2} ${y2})">${180 - deg}</text>
<text x="${x1}" y="${y1}" font-size="8" text-anchor="middle" fill="#000" font-weight="bold" transform="rotate(${90 - deg
                                    } ${x1} ${y1})">${deg}</text>
`;
                            })
                            .join("")}
</svg>
</div>

<div class="flex gap-2 w-full max-w-xs">
<input type="number" id="user-guess" class="flex-1 border-2 border-brand-blue rounded-xl p-3 font-bold text-center text-xl outline-none focus:bg-blue-50 text-brand-blue placeholder-gray-300" placeholder="0">
<button id="btn-check-angle" class="bg-brand-green text-white font-bold px-6 rounded-xl shadow-btn active:scale-95 transition-all">OK</button>
</div>

<div id="prot-feedback" class="h-12 mt-4 text-sm font-bold text-center flex items-center justify-center px-4"></div>
<button id="btn-next-angle" class="hidden mt-2 text-xs font-bold text-gray-400 uppercase hover:text-brand-blue">Pr√≥ximo √Çngulo <i class="fas fa-arrow-right"></i></button>

</div>
`;

                    const rayBase = container.querySelector("#ray-base");
                    const rayMove = container.querySelector("#ray-move");
                    const input = container.querySelector("#user-guess");
                    const btnCheck = container.querySelector("#btn-check-angle");
                    const btnNext = container.querySelector("#btn-next-angle");
                    const feedback = container.querySelector("#prot-feedback");

                    const newAngle = () => {
                        // Gera √¢ngulo m√∫ltiplo de 10 para facilitar leitura (10 a 170)
                        currentAngle = (Math.floor(Math.random() * 16) + 1) * 10;

                        // Decide lado (0 na direita ou esquerda?)
                        // Vamos manter o padr√£o de 0 na DIREITA (anti-hor√°rio) para este widget para simplificar a visualiza√ß√£o inicial,
                        // ou randomizar para testar a "dupla escala".
                        // Vamos randomizar!
                        direction = Math.random() > 0.5 ? 1 : -1;

                        if (direction === 1) {
                            // Base na direita, abre pra esquerda
                            rayBase.style.transform = "rotate(0deg)";
                            rayMove.style.transform = `rotate(-${currentAngle}deg)`;
                        } else {
                            // Base na esquerda, abre pra direita
                            rayBase.style.transform = "rotate(180deg)";
                            rayMove.style.transform = `rotate(${180 + currentAngle}deg)`; // Gira para baixo? N√£o, 180 + angulo vai girar horario
                            // Ajuste matem√°tico para SVG Y invertido e rota√ß√£o CSS
                            // 180deg aponta pra esquerda. Queremos subir 'currentAngle'.
                            rayMove.style.transform = `rotate(${180 + currentAngle}deg)`;
                        }

                        input.value = "";
                        feedback.innerText = "";
                        feedback.className =
                            "h-12 mt-4 text-sm font-bold text-center flex items-center justify-center px-4";
                        btnNext.classList.add("hidden");
                        input.focus();
                    };

                    btnCheck.onclick = () => {
                        const guess = parseInt(input.value);
                        if (isNaN(guess)) return;

                        if (guess === currentAngle) {
                            feedback.innerHTML = `<span class="text-brand-green">Perfeito! ${currentAngle}¬∞ na mosca.</span>`;
                            btnNext.classList.remove("hidden");
                        } else if (guess === 180 - currentAngle) {
                            feedback.innerHTML = `<span class="text-brand-orange">Cuidado! Voc√™ leu a escala errada.<br>Olhe onde est√° o zero!</span>`;
                        } else {
                            feedback.innerHTML = `<span class="text-brand-red">N√£o. Tente de novo.<br>O √¢ngulo √© ${currentAngle > 90 ? "Obtuso (Aberto)" : "Agudo (Fechado)"
                                }.</span>`;
                        }
                    };

                    btnNext.onclick = newAngle;

                    // Init
                    // Pequeno delay para garantir renderiza√ß√£o do CSS transform
                    setTimeout(newAngle, 100);
                },

                interactive_cannon_game(container) {
                    // Configura√ß√£o do Jogo
                    const state = {
                        angle: 45,
                        target: { x: 250, y: 250, r: 15 }, // Alvo
                        gravity: 0,
                        score: 0,
                    };

                    // 1. HTML ESTRUTURAL
                    // Mantivemos a altura h-[400px] e removemos o texto sobre vento
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-4 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">

<div class="flex justify-between w-full items-center mb-4 border-b-2 border-gray-100 pb-2">
<h3 class="text-brand-red font-black uppercase text-xs tracking-widest"><i class="fas fa-bomb"></i> Artilharia de √Çngulos</h3>
<div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black shadow-sm">Acertos: <span id="cannon-score">0</span></div>
</div>

<div class="relative w-full max-w-lg h-[400px] bg-blue-50 rounded-xl border-4 border-brand-blue overflow-hidden shadow-inner cursor-crosshair" id="game-sky">

<div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(#1e3a8a 1px, transparent 1px); background-size: 20px 20px;"></div>

<svg id="cannon-svg" class="absolute inset-0 w-full h-full" viewBox="0 0 500 400" preserveAspectRatio="xMidYMax meet">

<g id="target-group">
<circle cx="0" cy="0" r="15" fill="#EF4444" stroke="white" stroke-width="2" />
<circle cx="0" cy="0" r="10" fill="white" />
<circle cx="0" cy="0" r="5" fill="#EF4444" />
</g>

<path id="trajectory-path" d="" fill="none" stroke="#93C5FD" stroke-width="2" stroke-dasharray="5,5" />

<circle id="cannon-ball" cx="-20" cy="-20" r="6" fill="#1F2937" />

</svg>

<div class="absolute bottom-4 left-4 w-12 h-12 z-10 pointer-events-none">
<div id="cannon-barrel" class="w-16 h-8 bg-gray-800 rounded-r-lg origin-center-left absolute top-2 left-2 border-2 border-gray-600 transition-transform duration-100" style="transform: rotate(-45deg); transform-origin: 10px 50%;"></div>
<div class="w-10 h-10 bg-gray-900 rounded-full absolute top-1 left-1 border-4 border-gray-700"></div>
</div>

<div id="game-feedback" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 font-black text-2xl hidden z-20 drop-shadow-md"></div>

</div>

<div class="w-full max-w-sm mt-6 flex items-center gap-4">
<div class="flex-1">
<div class="flex justify-between text-xs font-bold uppercase mb-1 text-gray-500">
<span>√Çngulo de Tiro</span>
<span id="angle-display" class="text-brand-red text-lg">45¬∞</span>
</div>
<input type="range" id="angle-input" min="0" max="90" value="45" class="w-full h-4 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-red hover:accent-red-600">
</div>

<button id="btn-fire" class="h-14 w-14 rounded-full bg-brand-red text-white font-black text-xl shadow-btn active:scale-95 active:shadow-none transition-all border-b-4 border-red-800 flex items-center justify-center">
<i class="fas fa-fire"></i>
</button>
</div>

<p class="text-[10px] text-gray-400 mt-2 text-center">
Ajuste a inclina√ß√£o para alcan√ßar a dist√¢ncia correta.
</p>

</div>
`;

                    // 2. SELETORES
                    const svg = container.querySelector("#cannon-svg");
                    const targetGroup = container.querySelector("#target-group");
                    const ball = container.querySelector("#cannon-ball");
                    const barrel = container.querySelector("#cannon-barrel");
                    const angleInput = container.querySelector("#angle-input");
                    const angleDisplay = container.querySelector("#angle-display");
                    const btnFire = container.querySelector("#btn-fire");
                    const feedback = container.querySelector("#game-feedback");
                    const scoreEl = container.querySelector("#cannon-score");
                    const pathTrace = container.querySelector("#trajectory-path");

                    // 3. L√ìGICA DO JOGO

                    const spawnTarget = () => {
                        // Alvo no ch√£o ou ar (X: 200-450, Y: 100-300)
                        state.target.x = Math.floor(Math.random() * 250) + 200;
                        state.target.y = Math.floor(Math.random() * 200) + 100;

                        targetGroup.setAttribute(
                            "transform",
                            `translate(${state.target.x}, ${state.target.y})`
                        );

                        // Limpa rastro e bola
                        pathTrace.setAttribute("d", "");
                        ball.setAttribute("cx", -20);
                    };

                    const fireCannon = () => {
                        if (btnFire.disabled) return;

                        btnFire.disabled = true;
                        btnFire.classList.add("opacity-50", "cursor-not-allowed");

                        // Posi√ß√£o inicial (boca do canh√£o aprox)
                        let posX = 30;
                        let posY = 370;

                        // Velocidade (Constante, sem vento)
                        const rad = state.angle * (Math.PI / 180);
                        let velX = Math.cos(rad) * 13; // Aumentei levemente a for√ßa para compensar a tela mais alta
                        let velY = -Math.sin(rad) * 13;

                        const pathData = [`M ${posX} ${posY}`];
                        let steps = 0;

                        const interval = setInterval(() => {
                            posX += velX;
                            posY += velY;
                            velY += state.gravity;

                            ball.setAttribute("cx", posX);
                            ball.setAttribute("cy", posY);

                            if (steps % 2 === 0) {
                                pathData.push(`L ${posX} ${posY}`);
                                pathTrace.setAttribute("d", pathData.join(" "));
                            }

                            // Colis√£o
                            const dx = posX - state.target.x;
                            const dy = posY - state.target.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);

                            if (distance < 20) {
                                clearInterval(interval);
                                handleHit();
                            }

                            // Saiu da tela (Limites atualizados para 500x400)
                            if (posY > 400 || posX > 500) {
                                clearInterval(interval);
                                handleMiss();
                            }

                            steps++;
                        }, 20);
                    };

                    const handleHit = () => {
                        state.score += 100;
                        scoreEl.innerText = state.score;

                        feedback.innerHTML =
                            "<span class='text-brand-green'>NA MOSCA!</span>";
                        feedback.classList.remove("hidden", "scale-0");
                        feedback.classList.add("animate-pop-in");
                        targetGroup.style.display = "none";

                        setTimeout(() => {
                            feedback.classList.add("hidden");
                            targetGroup.style.display = "block";
                            btnFire.disabled = false;
                            btnFire.classList.remove("opacity-50", "cursor-not-allowed");
                            spawnTarget();
                        }, 1500);
                    };

                    const handleMiss = () => {
                        feedback.innerHTML =
                            "<span class='text-gray-400'>Passou perto...</span>";
                        feedback.classList.remove("hidden");

                        setTimeout(() => {
                            feedback.classList.add("hidden");
                            btnFire.disabled = false;
                            btnFire.classList.remove("opacity-50", "cursor-not-allowed");
                        }, 1000);
                    };

                    angleInput.oninput = (e) => {
                        state.angle = e.target.value;
                        angleDisplay.innerText = `${state.angle}¬∞`;
                        barrel.style.transform = `rotate(-${state.angle}deg)`;
                    };

                    btnFire.onclick = fireCannon;
                    spawnTarget();
                },

                interactive_multiplication_builder(container) {
                    let rows = 3;
                    let cols = 4;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<div class="flex flex-col md:flex-row gap-8 w-full items-center justify-center mb-6">

<div class="flex flex-col gap-4 w-full max-w-xs">
<div>
<div class="flex justify-between text-xs font-bold uppercase mb-1">
<span class="text-brand-purple">Linhas (Grupos)</span>
<span id="val-rows" class="font-black text-lg">3</span>
</div>
<input type="range" id="range-rows" min="1" max="6" value="3" class="w-full h-2 bg-purple-100 rounded-lg appearance-none cursor-pointer accent-brand-purple">
</div>
<div>
<div class="flex justify-between text-xs font-bold uppercase mb-1">
<span class="text-brand-orange">Colunas (Itens)</span>
<span id="val-cols" class="font-black text-lg">4</span>
</div>
<input type="range" id="range-cols" min="1" max="6" value="4" class="w-full h-2 bg-orange-100 rounded-lg appearance-none cursor-pointer accent-brand-orange">
</div>
</div>

<div id="grid-visual" class="bg-gray-50 border-2 border-gray-200 rounded-xl p-2 gap-1 grid transition-all duration-300 shadow-inner">
</div>

</div>

<div class="w-full bg-blue-50 border-l-4 border-brand-blue p-4 rounded-r-xl transition-all">
<p class="text-xs font-bold text-gray-500 uppercase mb-2">Tradu√ß√£o:</p>
<div class="font-mono text-lg md:text-xl flex flex-wrap gap-2 items-center">
<span id="text-addition" class="text-gray-600">4 + 4 + 4</span>
<span class="font-black text-brand-blue mx-2">‚ûú</span>
<span id="text-multiplication" class="font-bold text-brand-text">3 √ó 4 = 12</span>
</div>
</div>

</div>
`;

                    const rangeRows = container.querySelector("#range-rows");
                    const rangeCols = container.querySelector("#range-cols");
                    const valRows = container.querySelector("#val-rows");
                    const valCols = container.querySelector("#val-cols");
                    const gridEl = container.querySelector("#grid-visual");
                    const textAdd = container.querySelector("#text-addition");
                    const textMult = container.querySelector("#text-multiplication");

                    const update = () => {
                        rows = parseInt(rangeRows.value);
                        cols = parseInt(rangeCols.value);

                        valRows.innerText = rows;
                        valCols.innerText = cols;

                        // Atualiza Grid CSS
                        gridEl.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
                        gridEl.innerHTML = "";

                        // Cria bolinhas
                        for (let i = 0; i < rows * cols; i++) {
                            const dot = document.createElement("div");
                            dot.className =
                                "w-8 h-8 rounded-full bg-brand-blue shadow-sm border border-blue-400 animate-pop-in";
                            // Delay para efeito cascata
                            dot.style.animationDelay = `${i * 0.05}s`;
                            gridEl.appendChild(dot);
                        }

                        // Atualiza Texto da Soma (4 + 4 + 4...)
                        const addParts = Array(rows).fill(cols).join(" + ");
                        textAdd.innerHTML = addParts;

                        // Atualiza Texto da Multiplica√ß√£o
                        textMult.innerHTML = `<span class="text-brand-purple">${rows}</span> √ó <span class="text-brand-orange">${cols}</span> = <span class="text-brand-green font-black text-2xl">${rows * cols
                            }</span>`;
                    };

                    rangeRows.oninput = update;
                    rangeCols.oninput = update;
                    update();
                },

                interactive_rhythm_multiplier(container) {
                    let target = 12;
                    let step = 3;
                    let current = 0;
                    let taps = 0;

                    container.innerHTML = `
<div class="bg-gray-900 border-4 border-gray-700 rounded-2xl p-6 flex flex-col items-center w-full shadow-xl font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full text-white mb-6 z-10 relative">
<div class="text-xs font-bold uppercase tracking-widest text-gray-400">Pulo: <span class="text-brand-orange text-lg">+${step}</span></div>
<div class="text-xs font-bold uppercase tracking-widest text-gray-400">Alvo: <span class="text-brand-green text-lg">${target}</span></div>
</div>

<div class="relative w-40 h-40 flex items-center justify-center mb-8">
<div class="absolute inset-0 border-4 border-gray-700 rounded-full"></div>

<div id="rhythm-display" class="text-6xl font-black text-white z-10 transition-all transform scale-100">
0
</div>

<div id="rhythm-wave" class="absolute inset-0 bg-brand-blue rounded-full opacity-0"></div>
</div>

<button id="btn-tap" class="w-full max-w-xs h-20 bg-brand-blue hover:bg-blue-600 text-white font-black text-2xl rounded-2xl shadow-[0_6px_0_#1e3a8a] active:shadow-none active:translate-y-2 transition-all flex flex-col items-center justify-center z-10">
<span>BATER!</span>
<span class="text-[10px] font-normal opacity-70 uppercase tracking-widest">Adicionar +${step}</span>
</button>

<div id="rhythm-feedback" class="absolute inset-0 bg-gray-900/90 flex flex-col items-center justify-center z-20 hidden">
<div class="text-5xl mb-2">ü•Å</div>
<h3 class="text-white font-black text-2xl mb-2">No Ritmo!</h3>
<p class="text-brand-green font-mono text-lg mb-6" id="final-calc">4 x 3 = 12</p>
<button id="btn-retry" class="bg-white text-gray-900 font-bold py-3 px-8 rounded-full hover:scale-105 transition-transform">Pr√≥ximo</button>
</div>

</div>
`;

                    const display = container.querySelector("#rhythm-display");
                    const wave = container.querySelector("#rhythm-wave");
                    const btn = container.querySelector("#btn-tap");
                    const feedback = container.querySelector("#rhythm-feedback");
                    const finalCalc = container.querySelector("#final-calc");
                    const btnRetry = container.querySelector("#btn-retry");

                    const reset = () => {
                        // Gera novo desafio
                        step = Math.floor(Math.random() * 4) + 2; // 2 a 5
                        const times = Math.floor(Math.random() * 4) + 3; // 3 a 6 vezes
                        target = step * times;

                        current = 0;
                        taps = 0;
                        display.innerText = 0;
                        feedback.classList.add("hidden");

                        // Atualiza UI labels
                        container.querySelector(
                            ".text-brand-orange"
                        ).innerText = `+${step}`;
                        container.querySelector(
                            ".text-brand-green"
                        ).innerText = `${target}`;
                        container.querySelector(
                            "span.opacity-70"
                        ).innerText = `Adicionar +${step}`;

                        display.className =
                            "text-6xl font-black text-white z-10 transition-all transform scale-100";
                    };

                    btn.onclick = () => {
                        current += step;
                        taps++;

                        display.innerText = current;

                        // Anima√ß√£o de Onda e Escala
                        display.classList.remove("scale-100");
                        display.classList.add("scale-125", "text-brand-blue");
                        wave.classList.add("animate-ping", "opacity-50");

                        setTimeout(() => {
                            display.classList.remove("scale-125", "text-brand-blue");
                            display.classList.add("scale-100");
                            wave.classList.remove("animate-ping", "opacity-50");
                        }, 200);

                        // Verifica Vit√≥ria
                        if (current === target) {
                            setTimeout(() => {
                                feedback.classList.remove("hidden");
                                feedback.classList.add("flex", "animate-fade-in");
                                finalCalc.innerText = `${taps} √ó ${step} = ${target}`;
                            }, 500);
                        } else if (current > target) {
                            // Passou do ponto (n√£o deve acontecer se a l√≥gica estiver certa, mas por seguran√ßa)
                            current = 0;
                            taps = 0;
                            display.innerText = "OPS!";
                            display.classList.add("text-red-500");
                            setTimeout(reset, 1000);
                        }
                    };

                    btnRetry.onclick = reset;

                    // Init
                    // reset(); // Se chamado direto pode bugar se o DOM n√£o estiver pronto, melhor deixar os valores padr√£o iniciais
                },

                interactive_multiplication_grid(container) {
                    let rows = 4;
                    let cols = 5;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<div class="flex justify-between w-full items-center mb-6 border-b-2 border-gray-100 pb-2">
<h3 class="text-brand-blue font-black uppercase text-xs tracking-widest"><i class="fas fa-th"></i> Visualizador</h3>
<div class="text-2xl font-mono font-black text-brand-text">
<span id="disp-rows" class="text-brand-blue">4</span> 
<span class="text-gray-300">√ó</span> 
<span id="disp-cols" class="text-brand-orange">5</span> 
<span class="text-gray-300">=</span> 
<span id="disp-total" class="text-brand-green">20</span>
</div>
</div>

<div class="flex gap-6 w-full max-w-md items-start">

<div class="flex flex-col items-center gap-2 h-48 justify-center">
<input type="range" id="range-rows" min="1" max="10" value="4" orient="vertical" class="h-32 w-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue" style="writing-mode: bt-lr; -webkit-appearance: slider-vertical;">
<span class="text-[10px] font-bold text-gray-400 uppercase rotate-180" style="writing-mode: vertical-rl;">Linhas</span>
</div>

<div class="flex-1 flex flex-col items-center">
<div id="grid-visual" class="bg-gray-800 p-2 rounded-xl shadow-inner grid gap-1 transition-all duration-300" style="grid-template-columns: repeat(5, 1fr);">
</div>

<div class="w-full mt-4 flex flex-col items-center gap-2">
<input type="range" id="range-cols" min="1" max="10" value="5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-orange">
<span class="text-[10px] font-bold text-gray-400 uppercase">Colunas</span>
</div>
</div>

</div>

</div>
`;

                    const rangeRows = container.querySelector("#range-rows");
                    const rangeCols = container.querySelector("#range-cols");
                    const gridVisual = container.querySelector("#grid-visual");
                    const dispRows = container.querySelector("#disp-rows");
                    const dispCols = container.querySelector("#disp-cols");
                    const dispTotal = container.querySelector("#disp-total");

                    const update = () => {
                        rows = parseInt(rangeRows.value);
                        cols = parseInt(rangeCols.value);

                        // Atualiza Textos
                        dispRows.innerText = rows;
                        dispCols.innerText = cols;
                        dispTotal.innerText = rows * cols;

                        // Atualiza Grid CSS
                        gridVisual.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

                        // Gera Itens (Cadeiras)
                        let html = "";
                        for (let i = 0; i < rows * cols; i++) {
                            // Delay escalonado para efeito cascata bonito
                            const delay = (i % cols) * 0.05 + Math.floor(i / cols) * 0.05;
                            html += `<div class="w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-t-md opacity-0 animate-pop-in shadow-sm" style="animation-delay: ${delay}s; animation-fill-mode: forwards;"></div>`;
                        }
                        gridVisual.innerHTML = html;
                    };

                    rangeRows.addEventListener("input", update);
                    rangeCols.addEventListener("input", update);

                    // Init
                    update();
                },

                interactive_garden_builder(container) {
                    // N√≠veis: Alvo de √°rea
                    const levels = [
                        { target: 12, hint: "Dica: Pode ser 3x4 ou 2x6..." },
                        { target: 18, hint: "Dica: Tente 3 fileiras." },
                        { target: 24, hint: "Um jardim grande! 4x6?" },
                        {
                            target: 7,
                            hint: "Esse √© um n√∫mero primo! S√≥ tem um jeito (uma fila).",
                        },
                    ];

                    let currentLvl = 0;
                    let userRows = 2;
                    let userCols = 2;

                    container.innerHTML = `
<div class="bg-green-50 border-2 border-green-200 rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="absolute top-0 left-0 bg-green-200 text-green-800 px-3 py-1 rounded-br-xl text-xs font-black uppercase">N√≠vel <span id="lvl-num">1</span></div>

<div class="text-center mb-6 mt-2">
<h3 class="text-brand-green font-black text-xl mb-1">Miss√£o: <span id="target-val" class="text-3xl">12</span> Flores</h3>
<p class="text-xs text-green-700 font-bold" id="lvl-hint">Dica: Pode ser 3x4 ou 2x6...</p>
</div>

<div class="bg-amber-100 border-4 border-amber-300 rounded-xl p-1 mb-6 shadow-inner relative transition-all" id="garden-plot">
<div id="flower-grid" class="grid gap-1 transition-all" style="grid-template-columns: repeat(2, 1fr);">
</div>

<div class="absolute -left-8 top-0 bottom-0 flex items-center justify-center">
<div class="flex flex-col items-center">
<button class="w-6 h-6 bg-white rounded-full text-green-600 font-bold shadow-sm hover:scale-110 mb-1" id="btn-row-add">+</button>
<span class="font-mono font-bold text-green-800 text-lg" id="user-rows">2</span>
<button class="w-6 h-6 bg-white rounded-full text-green-600 font-bold shadow-sm hover:scale-110 mt-1" id="btn-row-sub">-</button>
</div>
</div>

<div class="absolute -bottom-8 left-0 right-0 flex items-center justify-center">
<div class="flex items-center gap-2">
<button class="w-6 h-6 bg-white rounded-full text-green-600 font-bold shadow-sm hover:scale-110" id="btn-col-sub">-</button>
<span class="font-mono font-bold text-green-800 text-lg" id="user-cols">2</span>
<button class="w-6 h-6 bg-white rounded-full text-green-600 font-bold shadow-sm hover:scale-110" id="btn-col-add">+</button>
</div>
</div>
</div>

<div class="mt-4 flex items-center gap-4">
<div class="text-center">
<span class="text-[10px] font-bold uppercase text-green-600">Total Atual</span>
<div class="text-2xl font-black text-green-800" id="current-total">4</div>
</div>
<button id="btn-plant" class="bg-brand-green text-white font-bold py-3 px-8 rounded-xl shadow-[0_4px_0_#2e8b01] active:shadow-none active:translate-y-1 transition-all">
PLANTAR!
</button>
</div>

<div id="garden-feedback" class="h-8 mt-4 font-bold text-sm text-center"></div>

</div>
`;

                    const flowerGrid = container.querySelector("#flower-grid");
                    const uRows = container.querySelector("#user-rows");
                    const uCols = container.querySelector("#user-cols");
                    const cTotal = container.querySelector("#current-total");
                    const tVal = container.querySelector("#target-val");
                    const lHint = container.querySelector("#lvl-hint");
                    const lNum = container.querySelector("#lvl-num");
                    const feedback = container.querySelector("#garden-feedback");
                    const btnPlant = container.querySelector("#btn-plant");

                    const renderGarden = () => {
                        flowerGrid.innerHTML = "";
                        flowerGrid.style.gridTemplateColumns = `repeat(${userCols}, 1fr)`;

                        uRows.innerText = userRows;
                        uCols.innerText = userCols;
                        cTotal.innerText = userRows * userCols;

                        for (let i = 0; i < userRows * userCols; i++) {
                            const flower = document.createElement("div");
                            // √çcone de flor usando emoji ou CSS
                            flower.className =
                                "w-6 h-6 md:w-8 md:h-8 flex items-center justify-center text-lg animate-pop-in";
                            flower.innerHTML = "üåª";
                            flowerGrid.appendChild(flower);
                        }
                    };

                    const loadLevel = () => {
                        if (currentLvl >= levels.length) {
                            tVal.innerText = "FIM";
                            lHint.innerText = "Jardim Completo!";
                            feedback.innerHTML = "üèÜ Voc√™ √© um Mestre Jardineiro!";
                            btnPlant.classList.add("hidden");
                            return;
                        }

                        const lvl = levels[currentLvl];
                        tVal.innerText = lvl.target;
                        lHint.innerText = lvl.hint;
                        lNum.innerText = currentLvl + 1;
                        feedback.innerText = "";

                        // Reset para um tamanho errado para o usu√°rio ajustar
                        userRows = 2;
                        userCols = 2;
                        renderGarden();
                    };

                    const check = () => {
                        const total = userRows * userCols;
                        const target = levels[currentLvl].target;

                        if (total === target) {
                            feedback.innerHTML = `<span class="text-green-700 bg-white px-2 py-1 rounded shadow-sm">üå∏ Perfeito! ${userRows} x ${userCols} = ${target}</span>`;

                            // Confetti effect (simples)
                            flowerGrid.classList.add("scale-110");
                            setTimeout(() => {
                                flowerGrid.classList.remove("scale-110");
                                currentLvl++;
                                loadLevel();
                            }, 1500);
                        } else if (total < target) {
                            feedback.innerHTML = `<span class="text-red-500">Faltam flores! Voc√™ tem ${total}, precisa de ${target}.</span>`;
                        } else {
                            feedback.innerHTML = `<span class="text-red-500">Muitas flores! Passou do ponto (${total}).</span>`;
                        }
                    };

                    // Controles
                    container.querySelector("#btn-row-add").onclick = () => {
                        if (userRows < 8) userRows++;
                        renderGarden();
                    };
                    container.querySelector("#btn-row-sub").onclick = () => {
                        if (userRows > 1) userRows--;
                        renderGarden();
                    };
                    container.querySelector("#btn-col-add").onclick = () => {
                        if (userCols < 8) userCols++;
                        renderGarden();
                    };
                    container.querySelector("#btn-col-sub").onclick = () => {
                        if (userCols > 1) userCols--;
                        renderGarden();
                    };

                    btnPlant.onclick = check;

                    loadLevel();
                },

                interactive_distributive_shower(container) {
                    // Estado inicial
                    const data = { factor: 4, part1: 10, part2: 3 };

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
<h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-8">Simulador de Chuveirinho</h3>

<div class="relative w-full max-w-sm h-32 flex justify-center items-center font-mono text-3xl font-bold transition-all" id="equation-area">

<div id="factor" class="absolute left-4 top-1/2 -translate-y-1/2 text-brand-purple transition-all duration-700 z-20 bg-white px-1 rounded">
${data.factor}
</div>

<div id="bracket-group" class="flex items-center gap-2 transition-opacity duration-500">
<span class="text-gray-400 text-4xl">√ó (</span>
<span class="text-brand-blue">${data.part1}</span>
<span class="text-gray-400">+</span>
<span class="text-brand-orange">${data.part2}</span>
<span class="text-gray-400 text-4xl">)</span>
</div>

<svg class="absolute top-0 left-0 w-full h-full pointer-events-none z-10 opacity-0 transition-opacity duration-300" id="arrows-svg">
<path d="M 40 40 Q 90 10 140 40" fill="none" stroke="#CE82FF" stroke-width="3" marker-end="url(#arrowhead)" />
<path d="M 40 40 Q 150 -10 220 40" fill="none" stroke="#CE82FF" stroke-width="3" marker-end="url(#arrowhead)" />
<defs>
<marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
<polygon points="0 0, 10 3.5, 0 7" fill="#CE82FF" />
</marker>
</defs>
</svg>

<div id="expanded-form" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex items-center gap-2 opacity-0 scale-90 transition-all duration-700 w-full justify-center text-xl md:text-2xl">
<span class="bg-blue-50 border border-blue-200 rounded px-2 text-brand-blue">(${data.factor
                        }√ó${data.part1})</span>
<span class="text-gray-400">+</span>
<span class="bg-orange-50 border border-orange-200 rounded px-2 text-brand-orange">(${data.factor
                        }√ó${data.part2})</span>
</div>

</div>

<div class="flex gap-4 w-full justify-center mt-4">
<button id="btn-distribute" class="bg-brand-purple hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-xl shadow-btn active:scale-95 transition-all flex items-center gap-2">
<i class="fas fa-tint"></i> Distribuir
</button>
<button id="btn-reset-dist" class="text-gray-400 font-bold uppercase text-xs hover:text-brand-purple hidden">
<i class="fas fa-undo"></i>
</button>
</div>

<div id="final-res" class="mt-6 text-center font-black text-2xl text-brand-green opacity-0 transition-opacity">
${data.factor * 10} + ${data.factor * 3} = ${data.factor * 13}
</div>

</div>
`;

                    const btn = container.querySelector("#btn-distribute");
                    const btnReset = container.querySelector("#btn-reset-dist");
                    const arrows = container.querySelector("#arrows-svg");
                    const brackets = container.querySelector("#bracket-group");
                    const expanded = container.querySelector("#expanded-form");
                    const factor = container.querySelector("#factor");
                    const finalRes = container.querySelector("#final-res");

                    btn.onclick = async () => {
                        btn.disabled = true;
                        btn.classList.add("opacity-50", "cursor-not-allowed");

                        // 1. Mostra as setas
                        arrows.classList.remove("opacity-0");

                        // 2. Anima√ß√£o de pulso no n√∫mero
                        factor.classList.add("scale-125");
                        await new Promise((r) => setTimeout(r, 600));
                        factor.classList.remove("scale-125");

                        // 3. Troca para a forma expandida
                        arrows.classList.add("opacity-0"); // Esconde setas
                        brackets.classList.add("opacity-0", "scale-0"); // Some o (10+3)
                        factor.classList.add("opacity-0"); // Some o 4 isolado

                        setTimeout(() => {
                            expanded.classList.remove("opacity-0", "scale-90");
                            expanded.classList.add("opacity-100", "scale-100");
                        }, 300);

                        // 4. Mostra resultado final
                        setTimeout(() => {
                            finalRes.classList.remove("opacity-0");
                            btn.classList.add("hidden");
                            btnReset.classList.remove("hidden");
                        }, 1200);
                    };

                    btnReset.onclick = () => {
                        // Reset tudo
                        arrows.classList.add("opacity-0");
                        brackets.classList.remove("opacity-0", "scale-0");
                        factor.classList.remove("opacity-0");
                        expanded.classList.add("opacity-0", "scale-90");
                        expanded.classList.remove("opacity-100", "scale-100");
                        finalRes.classList.add("opacity-0");

                        btn.disabled = false;
                        btn.classList.remove(
                            "hidden",
                            "opacity-50",
                            "cursor-not-allowed"
                        );
                        btnReset.classList.add("hidden");
                    };
                },

                interactive_distributive_area(container) {
                    // Configura√ß√£o: 5 x (10 + 4)
                    const h = 5;
                    const w1 = 10;
                    const w2 = 4;
                    const scale = 15; // px por unidade

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-4">Corte de √Årea: $${h} \\times (${w1} + ${w2})$</h3>

<div class="flex items-end justify-center mb-6 relative">

<div class="bg-blue-100 border-2 border-brand-blue flex items-center justify-center relative group transition-all duration-500" 
style="width: ${w1 * scale}px; height: ${h * scale
                        }px; border-right-style: dashed;">
<span class="text-brand-blue font-bold text-lg group-hover:scale-110 transition-transform">${h * w1
                        }</span>

<span class="absolute -left-6 text-xs font-bold text-gray-400">${h}</span>
<span class="absolute -top-6 text-xs font-bold text-brand-blue">${w1}</span>
</div>

<div class="bg-orange-100 border-2 border-brand-orange flex items-center justify-center relative group transition-all duration-500" 
style="width: ${w2 * scale}px; height: ${h * scale}px; border-left: none;">
<span class="text-brand-orange font-bold text-lg group-hover:scale-110 transition-transform">${h * w2
                        }</span>

<span class="absolute -top-6 text-xs font-bold text-brand-orange">${w2}</span>
</div>

<div id="scissor-icon" class="absolute top-[-10px] text-2xl text-gray-600 transition-all duration-500 cursor-pointer hover:text-brand-red" style="left: ${w1 * scale - 12
                        }px;">
‚úÇÔ∏è
</div>

</div>

<div class="bg-gray-50 border border-gray-200 rounded-lg p-3 w-full max-w-sm text-center">
<p class="text-sm text-gray-600 mb-1">√Årea Total:</p>
<div class="font-mono text-xl font-bold">
<span class="text-brand-blue">${h * w1}</span> + 
<span class="text-brand-orange">${h * w2}</span> = 
<span class="text-brand-green">${h * (w1 + w2)}</span>
</div>
</div>

<div class="mt-4 flex gap-2">
<button id="btn-split" class="bg-white border-2 border-brand-gray text-gray-600 font-bold py-2 px-4 rounded-lg hover:bg-gray-50 text-xs uppercase">Separar</button>
<button id="btn-join" class="bg-white border-2 border-brand-gray text-gray-600 font-bold py-2 px-4 rounded-lg hover:bg-gray-50 text-xs uppercase hidden">Juntar</button>
</div>

</div>
`;

                    const btnSplit = container.querySelector("#btn-split");
                    const btnJoin = container.querySelector("#btn-join");
                    const scissor = container.querySelector("#scissor-icon");
                    const rects = container.querySelectorAll(".bg-orange-100"); // Pega o segundo

                    btnSplit.onclick = () => {
                        rects[0].style.marginLeft = "20px"; // Separa
                        scissor.style.opacity = "0"; // Esconde tesoura
                        btnSplit.classList.add("hidden");
                        btnJoin.classList.remove("hidden");
                    };

                    btnJoin.onclick = () => {
                        rects[0].style.marginLeft = "0px"; // Junta
                        scissor.style.opacity = "1";
                        btnJoin.classList.add("hidden");
                        btnSplit.classList.remove("hidden");
                    };
                },

                interactive_mental_math_ninja(container) {
                    const questions = [
                        {
                            q: "5 x 12",
                            opts: ["5x1 + 5x2", "5x10 + 5x2", "5x5 + 5x6"],
                            ans: 1,
                        },
                        {
                            q: "3 x 104",
                            opts: ["3x100 + 3x4", "3x10 + 3x4", "3x1 + 3x4"],
                            ans: 0,
                        },
                        {
                            q: "6 x 15",
                            opts: ["6x5 + 6x5", "6x10 + 6x5", "6x1 + 6x5"],
                            ans: 1,
                        },
                        {
                            q: "4 x 21",
                            opts: ["4x2 + 4x1", "4x20 + 4x10", "4x20 + 4x1"],
                            ans: 2,
                        },
                    ];
                    let currentQ = 0;
                    let score = 0;

                    container.innerHTML = `
<div class="bg-gray-900 border-4 border-gray-700 rounded-2xl p-6 flex flex-col items-center w-full shadow-xl font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full text-white mb-6 z-10">
<div class="flex items-center gap-2"><span class="text-2xl">ü•∑</span> <span class="font-bold uppercase tracking-widest text-xs">Dojo Mental</span></div>
<div class="bg-gray-700 px-3 py-1 rounded-full text-xs font-black text-brand-yellow">XP: <span id="ninja-score">0</span></div>
</div>

<div class="text-center mb-8 z-10">
<p class="text-gray-400 text-xs font-bold uppercase mb-2">Qual o melhor corte?</p>
<div class="bg-white text-gray-900 font-mono text-4xl p-4 rounded-xl shadow-[0_0_20px_rgba(255,255,255,0.3)] font-black" id="ninja-q">
...
</div>
</div>

<div class="grid grid-cols-1 gap-3 w-full max-w-xs z-10" id="ninja-opts">
</div>

<div id="ninja-feedback" class="h-8 mt-4 font-bold text-sm text-center text-white z-10"></div>

<div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
</div>
`;

                    const qEl = container.querySelector("#ninja-q");
                    const optsEl = container.querySelector("#ninja-opts");
                    const scoreEl = container.querySelector("#ninja-score");
                    const feedback = container.querySelector("#ninja-feedback");

                    const loadQuestion = () => {
                        if (currentQ >= questions.length) {
                            qEl.innerText = "Mestre!";
                            qEl.className =
                                "bg-brand-yellow text-yellow-900 font-mono text-4xl p-4 rounded-xl shadow-lg font-black animate-bounce";
                            optsEl.innerHTML = `<button onclick="app.renderLesson(document.getElementById('main-container'), app.currentLessonName)" class="bg-gray-700 text-white font-bold py-3 rounded-xl hover:bg-gray-600 transition-all w-full">Treinar Novamente</button>`;
                            feedback.innerText = `Pontua√ß√£o Final: ${score}`;
                            return;
                        }

                        const q = questions[currentQ];
                        qEl.innerText = q.q;
                        optsEl.innerHTML = "";

                        q.opts.forEach((opt, i) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-gray-800 border-2 border-gray-600 text-gray-300 font-mono font-bold py-3 rounded-xl hover:bg-gray-700 hover:border-gray-500 hover:text-white transition-all active:scale-95";
                            btn.innerText = opt;
                            btn.onclick = () => check(i, btn);
                            optsEl.appendChild(btn);
                        });
                    };

                    const check = (selected, btn) => {
                        // Bloqueia
                        Array.from(optsEl.children).forEach((b) => (b.disabled = true));
                        const correct = questions[currentQ].ans;

                        if (selected === correct) {
                            score += 100;
                            scoreEl.innerText = score;
                            btn.className =
                                "bg-green-600 border-2 border-green-400 text-white font-mono font-bold py-3 rounded-xl shadow-[0_0_15px_rgba(34,197,94,0.6)] transform scale-105";
                            feedback.innerHTML = "Corte Perfeito! üó°Ô∏è";
                        } else {
                            btn.className =
                                "bg-red-600 border-2 border-red-400 text-white font-mono font-bold py-3 rounded-xl animate-shake";
                            feedback.innerHTML = "Corte Errado! ü§ï";
                            // Mostra o certo
                            optsEl.children[correct].classList.add(
                                "border-green-500",
                                "text-green-400"
                            );
                        }

                        setTimeout(() => {
                            currentQ++;
                            feedback.innerText = "";
                            loadQuestion();
                        }, 1200);
                    };

                    loadQuestion();
                },

                interactive_division_relation(container) {
                    // Estado Inicial: 13 moedas para 4 piratas
                    let D = 13;
                    let d = 4;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
<h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">A Partilha do Tesouro</h3>

<div class="flex gap-4 w-full max-w-sm mb-6 bg-gray-50 p-2 rounded-xl border border-gray-200 justify-center">
<div class="flex flex-col items-center">
<label class="text-[10px] font-bold text-gray-400 uppercase">Tesouro (D)</label>
<input type="number" id="in-D" value="${D}" min="1" max="50" class="w-16 text-center font-bold text-xl text-yellow-600 bg-white border-2 border-yellow-200 rounded-lg outline-none focus:border-yellow-500">
</div>
<div class="text-2xl text-gray-300 mt-4">√∑</div>
<div class="flex flex-col items-center">
<label class="text-[10px] font-bold text-gray-400 uppercase">Piratas (d)</label>
<input type="number" id="in-d" value="${d}" min="1" max="10" class="w-16 text-center font-bold text-xl text-blue-600 bg-white border-2 border-blue-200 rounded-lg outline-none focus:border-blue-500">
</div>
</div>

<div class="w-full mb-6">
<div id="groups-container" class="flex flex-wrap justify-center gap-4 mb-4"></div>

<div class="flex justify-center items-center gap-2">
<span class="text-xs font-bold text-gray-400 uppercase">Sobrou (r):</span>
<div id="remainder-container" class="flex gap-1 p-2 bg-red-50 rounded-lg border border-red-200 min-w-[50px] justify-center min-h-[40px]"></div>
</div>
</div>

<div class="w-full bg-gray-800 text-white p-4 rounded-xl text-center shadow-lg transition-all duration-300 transform hover:scale-105">
<div class="text-xs text-gray-400 uppercase font-bold mb-2">Prova Real</div>
<div class="font-mono text-lg md:text-xl flex flex-wrap justify-center gap-2 items-center">
<span class="text-yellow-400 font-bold" id="form-D">13</span>
<span>=</span>
<span class="text-blue-400 font-bold" id="form-d">4</span>
<span>√ó</span>
<span class="text-green-400 font-bold" id="form-q">3</span>
<span>+</span>
<span class="text-red-400 font-bold" id="form-r">1</span>
</div>
</div>

</div>
`;

                    const inD = container.querySelector("#in-D");
                    const ind = container.querySelector("#in-d");
                    const groupsContainer =
                        container.querySelector("#groups-container");
                    const remainderContainer = container.querySelector(
                        "#remainder-container"
                    );

                    const formD = container.querySelector("#form-D");
                    const formd = container.querySelector("#form-d");
                    const formq = container.querySelector("#form-q");
                    const formr = container.querySelector("#form-r");

                    const update = () => {
                        let valD = parseInt(inD.value) || 0;
                        let vald = parseInt(ind.value) || 1;
                        if (vald < 1) vald = 1; // Evita div por zero

                        const q = Math.floor(valD / vald);
                        const r = valD % vald;

                        // Atualiza F√≥rmula
                        formD.innerText = valD;
                        formd.innerText = vald;
                        formq.innerText = q;
                        formr.innerText = r;

                        // Renderiza Grupos (Piratas)
                        groupsContainer.innerHTML = "";
                        for (let i = 0; i < vald; i++) {
                            const group = document.createElement("div");
                            group.className =
                                "flex flex-col items-center bg-blue-50 border-2 border-brand-blue rounded-xl p-2 min-w-[60px] animate-pop-in";
                            group.style.animationDelay = `${i * 0.05}s`;

                            // Cabe√ßa do Pirata
                            const pirate = document.createElement("div");
                            pirate.className = "text-xl mb-1";
                            pirate.innerText = "üè¥‚Äç‚ò†Ô∏è";
                            group.appendChild(pirate);

                            // Moedas do Pirata
                            const coinsDiv = document.createElement("div");
                            coinsDiv.className =
                                "flex flex-wrap justify-center gap-1 max-w-[80px]";

                            for (let j = 0; j < q; j++) {
                                const coin = document.createElement("div");
                                coin.className =
                                    "w-4 h-4 rounded-full bg-yellow-400 border border-yellow-600 shadow-sm";
                                coinsDiv.appendChild(coin);
                            }
                            group.appendChild(coinsDiv);

                            // Label Quociente
                            const lbl = document.createElement("span");
                            lbl.className = "text-xs font-bold text-brand-blue mt-1";
                            lbl.innerText = q;
                            group.appendChild(lbl);

                            groupsContainer.appendChild(group);
                        }

                        // Renderiza Resto
                        remainderContainer.innerHTML = "";
                        for (let k = 0; k < r; k++) {
                            const coin = document.createElement("div");
                            coin.className =
                                "w-6 h-6 rounded-full bg-red-400 border border-red-600 shadow-sm flex items-center justify-center text-[10px] text-white font-bold animate-bounce";
                            coin.style.animationDelay = `${k * 0.1}s`;
                            coin.innerText = "R";
                            remainderContainer.appendChild(coin);
                        }
                    };

                    inD.addEventListener("input", update);
                    ind.addEventListener("input", update);
                    update();
                },

                interactive_bar_model(container) {
                    // Estado Inicial
                    let total = 60;
                    let multiplier = 2; // "O Dobro" (A = 2 * B)

                    // 1. HTML
                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Simulador de Partilha</h3>

<div class="flex flex-col md:flex-row gap-6 w-full items-center justify-center mb-8">

<div class="flex flex-col items-center">
<label class="text-[10px] font-bold text-gray-400 uppercase mb-1">Valor Total</label>
<div class="relative">
<span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 font-bold">R$</span>
<input type="number" id="in-total" value="${total}" step="10" class="w-32 pl-8 text-center border-2 border-brand-gray rounded-lg p-2 font-bold text-xl outline-none focus:border-brand-purple text-brand-text">
</div>
</div>

<div class="flex flex-col items-center">
<label class="text-[10px] font-bold text-gray-400 uppercase mb-1">Rela√ß√£o</label>
<div class="flex bg-gray-100 p-1 rounded-lg">
<button class="rel-btn px-3 py-1 rounded text-xs font-bold transition-colors bg-white text-brand-purple shadow-sm" data-m="2">Dobro</button>
<button class="rel-btn px-3 py-1 rounded text-xs font-bold transition-colors text-gray-400 hover:bg-white" data-m="3">Triplo</button>
<button class="rel-btn px-3 py-1 rounded text-xs font-bold transition-colors text-gray-400 hover:bg-white" data-m="4">Qu√°druplo</button>
</div>
</div>

</div>

<div class="w-full max-w-md space-y-4 relative">

<div class="flex items-center gap-3">
<div class="w-16 text-right text-xs font-bold text-brand-blue uppercase">Pessoa A</div>
<div id="bar-a" class="flex gap-1 flex-1 transition-all duration-500">
</div>
<div id="val-a" class="w-16 font-bold text-brand-blue text-lg">?</div>
</div>

<div class="flex items-center gap-3">
<div class="w-16 text-right text-xs font-bold text-brand-orange uppercase">Pessoa B</div>
<div id="bar-b" class="flex gap-1 flex-1 transition-all duration-500">
</div>
<div id="val-b" class="w-16 font-bold text-brand-orange text-lg">?</div>
</div>

<div class="absolute -right-4 top-0 bottom-0 w-4 border-r-2 border-t-2 border-b-2 border-gray-300 rounded-r-lg flex items-center justify-center">
<div class="bg-white text-[10px] font-bold text-gray-400 -mr-8 bg-gray-100 px-1 rounded transform rotate-90 whitespace-nowrap">Total: <span id="disp-total">60</span></div>
</div>

</div>

<div class="mt-8 bg-gray-50 border border-gray-200 rounded-xl p-4 w-full text-center">
<p class="text-sm text-gray-600">
Total de partes: <span id="calc-parts" class="font-black text-brand-purple">3</span>
</p>
<p class="text-lg font-mono mt-1">
<span id="calc-division">60 √∑ 3</span> = <strong class="text-brand-green" id="val-unit">20</strong> (cada caixa)
</p>
</div>

</div>
`;

                    // 2. Seletores
                    const inTotal = container.querySelector("#in-total");
                    const btns = container.querySelectorAll(".rel-btn");
                    const barA = container.querySelector("#bar-a");
                    const barB = container.querySelector("#bar-b");
                    const valA = container.querySelector("#val-a");
                    const valB = container.querySelector("#val-b");
                    const dispTotal = container.querySelector("#disp-total");
                    const calcParts = container.querySelector("#calc-parts");
                    const calcDiv = container.querySelector("#calc-division");
                    const valUnit = container.querySelector("#val-unit");

                    // 3. L√≥gica de Renderiza√ß√£o
                    const update = () => {
                        const t = parseInt(inTotal.value) || 0;
                        const m = multiplier;

                        // Total de Partes = Multiplicador (A) + 1 (B)
                        const totalParts = m + 1;
                        const unitValue = t / totalParts;

                        // Verifica se √© exato para formata√ß√£o
                        const isExact = Number.isInteger(unitValue);
                        const displayUnit = isExact ? unitValue : unitValue.toFixed(2);
                        const displayA = isExact
                            ? unitValue * m
                            : (unitValue * m).toFixed(2);
                        const displayB = displayUnit;

                        // Atualiza Textos
                        dispTotal.innerText = t;
                        valA.innerText = displayA;
                        valB.innerText = displayB;

                        calcParts.innerText = `${m} + 1 = ${totalParts}`;
                        calcDiv.innerText = `${t} √∑ ${totalParts}`;
                        valUnit.innerText = displayUnit;

                        // Renderiza Blocos Visuais
                        // A Pessoa B sempre tem 1 bloco
                        renderBlocks(
                            barB,
                            1,
                            "bg-orange-200 border-orange-400 text-orange-800",
                            displayUnit
                        );

                        // A Pessoa A tem 'm' blocos
                        renderBlocks(
                            barA,
                            m,
                            "bg-blue-200 border-blue-400 text-blue-800",
                            displayUnit
                        );
                    };

                    const renderBlocks = (el, count, classes, val) => {
                        el.innerHTML = "";
                        for (let i = 0; i < count; i++) {
                            const block = document.createElement("div");
                            // Anima√ß√£o de entrada
                            block.className = `h-12 flex-1 rounded-lg border-2 flex items-center justify-center font-bold text-sm shadow-sm animate-pop-in ${classes}`;
                            block.style.animationDelay = `${i * 0.1}s`;
                            block.innerText = val;

                            // CORRE√á√ÉO: A linha quebrada foi removida daqui.
                            // O pr√≥prio c√≥digo acima j√° cria o visual correto.

                            el.appendChild(block);
                        }
                    };

                    // 4. Listeners
                    inTotal.addEventListener("input", update);

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            // Atualiza estado
                            multiplier = parseInt(btn.dataset.m);

                            // Atualiza UI dos bot√µes
                            btns.forEach((b) => {
                                if (b === btn) {
                                    b.className =
                                        "rel-btn px-3 py-1 rounded text-xs font-bold transition-colors bg-white text-brand-purple shadow-sm ring-1 ring-purple-200";
                                } else {
                                    b.className =
                                        "rel-btn px-3 py-1 rounded text-xs font-bold transition-colors text-gray-400 hover:bg-white";
                                }
                            });

                            update();
                        };
                    });

                    // Init
                    update();
                },

                interactive_compass_rosette(container) {
                    let step = 0;
                    const totalSteps = 7; // C√≠rculo base + 6 c√≠rculos/p√©talas

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-4">A M√°gica do Compasso</h3>

<div class="relative w-64 h-64 bg-white border border-gray-200 rounded-xl mb-6 shadow-inner flex items-center justify-center overflow-hidden">
<div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: radial-gradient(#aaa 1px, transparent 1px); background-size: 20px 20px;"></div>

<svg width="240" height="240" viewBox="0 0 240 240" class="overflow-visible">
<circle cx="120" cy="120" r="50" fill="none" stroke="#4B4B4B" stroke-width="2" class="transition-all duration-500 opacity-20" id="base-circle" />

<g id="petals-group"></g>

<circle cx="120" cy="120" r="3" fill="#FF9600" id="compass-point" class="transition-all duration-500" />
</svg>
</div>

<p class="text-center text-sm font-bold text-gray-500 mb-4 h-10 flex items-center justify-center" id="step-desc">
Vamos come√ßar desenhando o c√≠rculo central.
</p>

<div class="flex gap-4 w-full max-w-xs">
<button id="btn-reset" class="w-12 h-12 rounded-full bg-gray-100 text-gray-500 font-bold hover:bg-gray-200 transition-all">
<i class="fas fa-undo"></i>
</button>
<button id="btn-step" class="flex-1 bg-brand-orange text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all flex items-center justify-center gap-2">
<i class="fas fa-compass"></i> Pr√≥ximo Passo
</button>
</div>

</div>
`;

                    const baseCircle = container.querySelector("#base-circle");
                    const petalsGroup = container.querySelector("#petals-group");
                    const compassPoint = container.querySelector("#compass-point");
                    const btnStep = container.querySelector("#btn-step");
                    const btnReset = container.querySelector("#btn-reset");
                    const stepDesc = container.querySelector("#step-desc");

                    const r = 50; // Raio
                    const cx = 120;
                    const cy = 120;

                    const update = () => {
                        if (step === 0) {
                            baseCircle.classList.remove("opacity-20");
                            baseCircle.classList.add("opacity-100", "stroke-brand-text");
                            stepDesc.innerText = "1. C√≠rculo principal desenhado.";
                            compassPoint.setAttribute("cx", cx);
                            compassPoint.setAttribute("cy", cy);
                        } else if (step <= 6) {
                            // Calcula posi√ß√£o da ponta do compasso na borda
                            // Come√ßa em 0 graus (direita) e vai girando 60 graus
                            const angle = (step - 1) * 60 * (Math.PI / 180);
                            const px = cx + r * Math.cos(angle);
                            const py = cy + r * Math.sin(angle);

                            // Move a agulha
                            compassPoint.setAttribute("cx", px);
                            compassPoint.setAttribute("cy", py);

                            // Cria o novo c√≠rculo (p√©tala)
                            const petal = document.createElementNS(
                                "http://www.w3.org/2000/svg",
                                "circle"
                            );
                            petal.setAttribute("cx", px);
                            petal.setAttribute("cy", py);
                            petal.setAttribute("r", r);
                            petal.setAttribute("fill", "none");
                            petal.setAttribute("stroke", "#FF9600");
                            petal.setAttribute("stroke-width", "2");
                            petal.setAttribute(
                                "class",
                                "animate-draw opacity-0 transition-opacity duration-500"
                            );

                            // Adiciona ao DOM
                            petalsGroup.appendChild(petal);

                            // For√ßa reflow para anima√ß√£o
                            setTimeout(() => petal.classList.remove("opacity-0"), 50);

                            stepDesc.innerHTML = `Ponta seca na borda. <span class="text-brand-orange">Passo ${step}/6</span>`;
                        } else {
                            stepDesc.innerHTML = `<span class="text-brand-green font-black">Ros√°cea Completa!</span> O raio cabe 6x na volta.`;
                            btnStep.innerText = "Reiniciar";
                            btnStep.onclick = reset;
                            compassPoint.style.opacity = 0;
                        }
                    };

                    const next = () => {
                        if (step <= 6) {
                            step++;
                            update();
                        }
                    };

                    const reset = () => {
                        step = 0;
                        petalsGroup.innerHTML = "";
                        baseCircle.classList.remove("opacity-100", "stroke-brand-text");
                        baseCircle.classList.add("opacity-20");
                        compassPoint.style.opacity = 1;
                        btnStep.innerHTML = `<i class="fas fa-compass"></i> Pr√≥ximo Passo`;
                        btnStep.onclick = next;
                        stepDesc.innerText =
                            "Vamos come√ßar desenhando o c√≠rculo central.";
                    };

                    btnStep.onclick = next;
                    btnReset.onclick = reset;
                },

                interactive_angle_dojo(container) {
                    let currentAngle = 0;
                    let score = 0;
                    let isPlaying = false;

                    container.innerHTML = `
<div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">

<div class="flex justify-between w-full items-center mb-6 z-10">
<h3 class="font-black uppercase text-xs tracking-widest text-gray-400">Doj√¥ Matem√°tico</h3>
<div class="bg-gray-700 px-3 py-1 rounded-full text-xs font-black">Score: <span id="dojo-score" class="text-brand-yellow">0</span></div>
</div>

<div class="relative w-48 h-48 bg-gray-800 rounded-full border-4 border-gray-600 flex items-center justify-center mb-8 shadow-inner z-10">
<div class="absolute w-1/2 h-1 bg-white right-0 top-1/2 -translate-y-1/2 origin-left"></div>
<div id="dojo-arm" class="absolute w-1/2 h-1 bg-brand-yellow right-0 top-1/2 -translate-y-1/2 origin-left transition-transform duration-300" style="transform: rotate(0deg); left: 50%; right: auto;"></div>
<div class="absolute w-4 h-4 bg-brand-red rounded-full z-20"></div>

<div class="absolute top-0 w-0.5 h-6 bg-gray-600 left-1/2 -translate-x-1/2"></div>
</div>

<div id="start-overlay" class="absolute inset-0 bg-gray-900/90 z-30 flex flex-col items-center justify-center">
<div class="text-5xl mb-4">ü•ã</div>
<h3 class="text-white font-black text-2xl mb-2">Treino de Reflexo</h3>
<p class="text-gray-400 text-sm mb-6">Classifique o √¢ngulo rapidamente!</p>
<button id="btn-start-dojo" class="bg-brand-red text-white font-bold py-3 px-8 rounded-full shadow-[0_0_20px_rgba(255,75,75,0.5)] animate-pulse">LUTAR!</button>
</div>

<div class="grid grid-cols-3 gap-3 w-full z-10 relative">
<button class="dojo-btn bg-gray-700 border-b-4 border-gray-900 hover:bg-gray-600 text-white font-bold py-3 rounded-xl active:border-b-0 active:translate-y-1 transition-all text-sm" data-type="acute">AGUDO<br><90¬∞</button>
<button class="dojo-btn bg-gray-700 border-b-4 border-gray-900 hover:bg-gray-600 text-white font-bold py-3 rounded-xl active:border-b-0 active:translate-y-1 transition-all text-sm" data-type="right">RETO<br>90¬∞</button>
<button class="dojo-btn bg-gray-700 border-b-4 border-gray-900 hover:bg-gray-600 text-white font-bold py-3 rounded-xl active:border-b-0 active:translate-y-1 transition-all text-sm" data-type="obtuse">OBTUSO<br>>90¬∞</button>
</div>

<div id="dojo-feedback" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-6xl font-black opacity-0 pointer-events-none transition-all duration-300 z-40"></div>

</div>
`;

                    const arm = container.querySelector("#dojo-arm");
                    const scoreEl = container.querySelector("#dojo-score");
                    const feedback = container.querySelector("#dojo-feedback");
                    const startOverlay = container.querySelector("#start-overlay");
                    const btns = container.querySelectorAll(".dojo-btn");

                    const nextRound = () => {
                        // Gera √¢ngulo aleat√≥rio (evita 0 e 180 para simplificar)
                        // 5% de chance de ser exatamente 90 (Reto) para n√£o ser imposs√≠vel de sair
                        if (Math.random() < 0.2) {
                            currentAngle = 90;
                        } else {
                            currentAngle = Math.floor(Math.random() * 170) + 5;
                            if (currentAngle === 90) currentAngle = 91; // Evita duplicata do if acima
                        }

                        // Gira o bra√ßo (negativo para anti-hor√°rio visual)
                        arm.style.transform = `rotate(-${currentAngle}deg)`;
                    };

                    const check = (type) => {
                        let correctType = "";
                        if (currentAngle < 90) correctType = "acute";
                        else if (currentAngle === 90) correctType = "right";
                        else correctType = "obtuse";

                        if (type === correctType) {
                            score += 10;
                            scoreEl.innerText = score;
                            feedback.innerText = "HIT!";
                            feedback.className =
                                "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-5xl font-black text-brand-green scale-150 opacity-100 z-40 transition-all";

                            setTimeout(() => {
                                feedback.className =
                                    "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-5xl font-black opacity-0 scale-50 transition-all";
                                nextRound();
                            }, 400);
                        } else {
                            score = Math.max(0, score - 5);
                            scoreEl.innerText = score;
                            feedback.innerText = "MISS";
                            feedback.className =
                                "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-5xl font-black text-brand-red scale-150 opacity-100 z-40 transition-all animate-shake";
                            setTimeout(() => {
                                feedback.className =
                                    "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-5xl font-black opacity-0 scale-50 transition-all";
                            }, 400);
                        }
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => check(btn.dataset.type);
                    });

                    container.querySelector("#btn-start-dojo").onclick = () => {
                        startOverlay.classList.add("hidden");
                        score = 0;
                        scoreEl.innerText = 0;
                        nextRound();
                    };
                },

                interactive_ice_cream_builder(container) {
                    // Dados
                    const cones = ["Cestinha", "Casquinha"];
                    const flavors = ["Chocolate", "Morango", "Baunilha"];
                    const toppings = ["Granulado", "Calda", "Cereja"];

                    let selected = { c: 0, f: 0, t: 0 };

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">

<h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Combinat√≥ria: Monte seu Sorvete</h3>

<div class="flex flex-col md:flex-row gap-8 items-start w-full">

<div class="flex-1 flex flex-col gap-4 w-full">

<div class="bg-orange-50 p-3 rounded-lg border border-orange-200">
<span class="text-xs font-bold text-orange-800 uppercase block mb-2">1. Base (${cones.length
                        } op√ß√µes)</span>
<div class="flex gap-2">
${cones
                            .map(
                                (c, i) =>
                                    `<button class="opt-btn flex-1 py-2 bg-white border border-orange-300 rounded text-xs font-bold text-orange-600 hover:bg-orange-100 ${i === 0 ? "ring-2 ring-orange-500" : ""
                                    }" data-g="c" data-i="${i}">${c}</button>`
                            )
                            .join("")}
</div>
</div>

<div class="bg-pink-50 p-3 rounded-lg border border-pink-200">
<span class="text-xs font-bold text-pink-800 uppercase block mb-2">2. Sabor (${flavors.length
                        } op√ß√µes)</span>
<div class="flex gap-2">
${flavors
                            .map(
                                (f, i) =>
                                    `<button class="opt-btn flex-1 py-2 bg-white border border-pink-300 rounded text-xs font-bold text-pink-600 hover:bg-pink-100 ${i === 0 ? "ring-2 ring-pink-500" : ""
                                    }" data-g="f" data-i="${i}">${f}</button>`
                            )
                            .join("")}
</div>
</div>

<div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
<span class="text-xs font-bold text-blue-800 uppercase block mb-2">3. Cobertura (${toppings.length
                        } op√ß√µes)</span>
<div class="flex gap-2">
${toppings
                            .map(
                                (t, i) =>
                                    `<button class="opt-btn flex-1 py-2 bg-white border border-blue-300 rounded text-xs font-bold text-blue-600 hover:bg-blue-100 ${i === 0 ? "ring-2 ring-blue-500" : ""
                                    }" data-g="t" data-i="${i}">${t}</button>`
                            )
                            .join("")}
</div>
</div>

</div>

<div class="w-full md:w-40 flex flex-col items-center">
<div class="relative w-32 h-40 flex flex-col items-center justify-end animate-pop-in" id="preview-area">
</div>
<div class="mt-4 text-center bg-gray-800 text-white p-3 rounded-lg shadow-lg">
<div class="text-[10px] text-gray-400 uppercase font-bold">Total de Combina√ß√µes</div>
<div class="font-mono text-lg font-bold">
<span class="text-brand-orange">${cones.length}</span> √ó 
<span class="text-brand-purple">${flavors.length}</span> √ó 
<span class="text-brand-blue">${toppings.length}</span> = 
<span class="text-brand-green text-2xl">${cones.length * flavors.length * toppings.length
                        }</span>
</div>
</div>
</div>

</div>
</div>
`;

                    const preview = container.querySelector("#preview-area");
                    const btns = container.querySelectorAll(".opt-btn");

                    const renderIceCream = () => {
                        // Cores
                        const flavorColors = [
                            "bg-[#5D4037]",
                            "bg-[#FF80AB]",
                            "bg-[#FFF9C4]",
                        ]; // Choc, Morango, Baunilha

                        let html = "";

                        // Base
                        if (selected.c === 0) {
                            // Cestinha
                            html += `<div class="w-24 h-12 bg-[#D7CCC8] border-b-4 border-[#A1887F] rounded-b-3xl relative z-10"></div>`;
                        } else {
                            // Casquinha
                            html += `<div class="w-0 h-0 border-l-[25px] border-l-transparent border-r-[25px] border-r-transparent border-t-[60px] border-t-[#D7CCC8] relative z-10"></div>`;
                        }

                        // Bola (Sabor)
                        // Posicionamento muda levemente dependendo da base
                        const ballBottom = selected.c === 0 ? "bottom-8" : "bottom-12";
                        html += `<div class="absolute ${ballBottom} w-20 h-20 rounded-full ${flavorColors[selected.f]
                            } border-2 border-black/5 shadow-inner z-0"></div>`;

                        // Cobertura
                        const topEmoji = ["üç¨", "üç´", "üçí"][selected.t];
                        html += `<div class="absolute ${ballBottom} mb-16 text-3xl z-20 drop-shadow-md animate-bounce">${topEmoji}</div>`;

                        preview.innerHTML = html;
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            const group = btn.dataset.g;
                            const idx = parseInt(btn.dataset.i);

                            // Atualiza estado
                            selected[group] = idx;

                            // Atualiza bot√µes visuais
                            container
                                .querySelectorAll(`[data-g="${group}"]`)
                                .forEach((b) =>
                                    b.classList.remove(
                                        "ring-2",
                                        "ring-orange-500",
                                        "ring-pink-500",
                                        "ring-blue-500"
                                    )
                                );

                            const ringColor =
                                group === "c"
                                    ? "ring-orange-500"
                                    : group === "f"
                                        ? "ring-pink-500"
                                        : "ring-blue-500";
                            btn.classList.add("ring-2", ringColor);

                            renderIceCream();
                        };
                    });

                    renderIceCream();
                },

                interactive_combo_challenge(container) {
                    const problems = [
                        {
                            text: "Tenho 3 camisetas e 2 cal√ßas. Quantos looks posso criar?",
                            ans: 6,
                            icon: "üëï",
                        },
                        {
                            text: "Uma senha tem 2 d√≠gitos. Cada d√≠gito pode ser 1, 2 ou 3. Quantas senhas existem?",
                            ans: 9,
                            icon: "üîí",
                        }, // 3x3
                        {
                            text: "Para ir de A at√© B tenho 2 caminhos. De B at√© C tenho 4. Quantos caminhos de A at√© C?",
                            ans: 8,
                            icon: "üó∫Ô∏è",
                        },
                    ];

                    let current = 0;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-6">Desafio do Cofre</h3>

<div class="bg-gray-800 text-white rounded-3xl p-6 w-full max-w-sm flex flex-col items-center shadow-2xl relative border-b-8 border-gray-900">

<div class="text-4xl mb-4 animate-bounce" id="prob-icon">üëï</div>
<p class="text-center text-sm md:text-base font-medium mb-6 px-4" id="prob-text">...</p>

<div class="bg-black text-brand-green font-mono text-4xl px-8 py-4 rounded-lg border-4 border-gray-600 shadow-inner mb-6 tracking-widest" id="lock-display">
00
</div>

<div class="grid grid-cols-3 gap-2 w-full max-w-[200px]">
${[1, 2, 3, 4, 5, 6, 7, 8, 9]
                            .map(
                                (n) =>
                                    `<button class="key-btn bg-gray-700 hover:bg-gray-600 rounded p-3 font-bold shadow-sm active:translate-y-1 transition-all">${n}</button>`
                            )
                            .join("")}
<button class="key-btn col-span-1 bg-red-800 hover:bg-red-700 rounded p-3 font-bold text-xs flex items-center justify-center shadow-sm active:translate-y-1 transition-all" id="btn-del">DEL</button>
<button class="key-btn bg-gray-700 hover:bg-gray-600 rounded p-3 font-bold shadow-sm active:translate-y-1 transition-all">0</button>
<button class="key-btn col-span-1 bg-green-700 hover:bg-green-600 rounded p-3 font-bold text-xs flex items-center justify-center shadow-sm active:translate-y-1 transition-all" id="btn-enter">OK</button>
</div>

</div>

<div id="combo-feedback" class="h-10 mt-4 flex items-center justify-center font-bold text-sm"></div>

</div>
`;

                    const probText = container.querySelector("#prob-text");
                    const probIcon = container.querySelector("#prob-icon");
                    const display = container.querySelector("#lock-display");
                    const feedback = container.querySelector("#combo-feedback");
                    const keys = container.querySelectorAll(
                        ".key-btn:not(#btn-del):not(#btn-enter)"
                    );
                    const btnDel = container.querySelector("#btn-del");
                    const btnEnter = container.querySelector("#btn-enter");

                    let inputVal = "";

                    const loadProblem = () => {
                        if (current >= problems.length) {
                            probText.innerText = "Cofre Aberto! Voc√™ venceu.";
                            probIcon.innerText = "üí∞";
                            display.innerText = "OPEN";
                            display.classList.add("text-brand-yellow");
                            return;
                        }
                        const p = problems[current];
                        probText.innerText = p.text;
                        probIcon.innerText = p.icon;
                        inputVal = "";
                        updateDisplay();
                    };

                    const updateDisplay = () => {
                        display.innerText = inputVal.padStart(2, "0");
                    };

                    keys.forEach((btn) => {
                        btn.onclick = () => {
                            if (inputVal.length < 2) {
                                inputVal += btn.innerText;
                                updateDisplay();
                            }
                        };
                    });

                    btnDel.onclick = () => {
                        inputVal = inputVal.slice(0, -1);
                        updateDisplay();
                    };

                    btnEnter.onclick = () => {
                        const ans = parseInt(inputVal);
                        if (ans === problems[current].ans) {
                            feedback.innerHTML = `<span class="text-brand-green">Correto!</span>`;
                            display.classList.add("bg-green-900");
                            setTimeout(() => {
                                display.classList.remove("bg-green-900");
                                current++;
                                loadProblem();
                                feedback.innerHTML = "";
                            }, 800);
                        } else {
                            feedback.innerHTML = `<span class="text-brand-red">Senha Incorreta</span>`;
                            display.classList.add("animate-shake", "bg-red-900");
                            setTimeout(() => {
                                display.classList.remove("animate-shake", "bg-red-900");
                                inputVal = "";
                                updateDisplay();
                            }, 500);
                        }
                    };

                    loadProblem();
                },

                interactive_division_detective(container) {
                    const cases = [
                        {
                            D: 25,
                            d: 4,
                            q: 6,
                            r: 1,
                            valid: true,
                            hint: "6 x 4 = 24, + 1 = 25. Resto 1 < 4.",
                        },
                        {
                            D: 30,
                            d: 5,
                            q: 5,
                            r: 5,
                            valid: false,
                            hint: "Resto 5 n√£o pode ser igual ao divisor 5! D√° pra dividir mais.",
                        },
                        {
                            D: 18,
                            d: 3,
                            q: 5,
                            r: 3,
                            valid: false,
                            hint: "Resto 3 igual ao divisor. E 3x5+3 = 18.",
                        },
                        {
                            D: 42,
                            d: 5,
                            q: 8,
                            r: 2,
                            valid: true,
                            hint: "5 x 8 = 40, + 2 = 42. Resto 2 < 5.",
                        },
                        {
                            D: 22,
                            d: 4,
                            q: 4,
                            r: 6,
                            valid: false,
                            hint: "Resto 6 √© maior que o divisor 4! O pirata roubou moedas!",
                        },
                        {
                            D: 15,
                            d: 2,
                            q: 8,
                            r: -1,
                            valid: false,
                            hint: "Resto negativo n√£o existe aqui!",
                        },
                    ];

                    let currentCase = 0;
                    let score = 0;

                    container.innerHTML = `
<div class="bg-white border-2 border-brand-gray rounded-xl p-4 md:p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">

<div class="flex justify-between w-full items-center mb-6 border-b-2 border-gray-100 pb-2">
<h3 class="text-brand-purple font-black uppercase text-xs tracking-widest"><i class="fas fa-search"></i> Investiga√ß√£o</h3>
<div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black shadow-sm">Score: <span id="det-score">0</span></div>
</div>

<div class="relative w-full max-w-sm mb-8" id="case-card">
<div class="flex justify-center font-mono text-3xl md:text-4xl text-brand-text bg-gray-50 border-2 border-gray-200 rounded-xl p-6 shadow-md relative">

<div class="flex gap-4">
<div class="font-bold" id="disp-D">25</div>
<div class="border-l-2 border-b-2 border-brand-text pl-2 pb-1 text-center">
<span id="disp-d" class="text-brand-blue">4</span>
<div class="text-brand-green mt-1 text-2xl" id="disp-q">6</div>
</div>
</div>

<div class="absolute bottom-4 left-10 text-brand-red font-bold text-2xl" id="disp-r">
(1)
</div>

<div class="absolute top-2 right-2 text-xs font-sans font-bold text-gray-300 uppercase">Caso #<span id="case-num">1</span></div>
</div>
</div>

<p class="text-center text-sm font-bold text-gray-500 mb-4">Essa conta est√° correta?</p>

<div class="flex gap-4 w-full max-w-xs z-10 relative">
<button id="btn-fake" class="flex-1 bg-red-100 text-red-600 border-b-4 border-red-300 font-bold py-3 rounded-xl hover:bg-red-200 active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center">
<i class="fas fa-times text-2xl"></i>
<span class="text-[10px] uppercase mt-1">√â Falsa!</span>
</button>
<button id="btn-true" class="flex-1 bg-green-100 text-green-600 border-b-4 border-green-300 font-bold py-3 rounded-xl hover:bg-green-200 active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center">
<i class="fas fa-check text-2xl"></i>
<span class="text-[10px] uppercase mt-1">Verdadeira</span>
</button>
</div>

<div id="feedback-layer" class="absolute inset-0 bg-white/95 flex flex-col items-center justify-center text-center p-6 hidden z-20">
<div class="text-6xl mb-4" id="fb-icon"></div>
<h3 class="text-xl font-black text-brand-text mb-2" id="fb-title"></h3>
<p class="text-sm text-gray-600 mb-6 font-medium" id="fb-desc"></p>
<button id="btn-next-case" class="bg-brand-blue text-white font-bold py-3 px-8 rounded-full shadow-lg active:scale-95 transition-all">Pr√≥ximo Caso</button>
</div>

</div>
`;

                    const dispD = container.querySelector("#disp-D");
                    const dispd = container.querySelector("#disp-d");
                    const dispq = container.querySelector("#disp-q");
                    const dispr = container.querySelector("#disp-r");
                    const caseNum = container.querySelector("#case-num");
                    const scoreEl = container.querySelector("#det-score");

                    const feedbackLayer = container.querySelector("#feedback-layer");
                    const fbIcon = container.querySelector("#fb-icon");
                    const fbTitle = container.querySelector("#fb-title");
                    const fbDesc = container.querySelector("#fb-desc");
                    const btnNext = container.querySelector("#btn-next-case");

                    const loadCase = () => {
                        if (currentCase >= cases.length) {
                            fbIcon.innerText = "üèÜ";
                            fbTitle.innerText = "Mestre Detetive!";
                            fbDesc.innerText = `Voc√™ completou todas as investiga√ß√µes com ${score} pontos.`;
                            feedbackLayer.classList.remove("hidden");
                            btnNext.innerText = "Reiniciar";
                            btnNext.onclick = () => {
                                currentCase = 0;
                                score = 0;
                                scoreEl.innerText = 0;
                                loadCase();
                                feedbackLayer.classList.add("hidden");
                            };
                            return;
                        }

                        const c = cases[currentCase];
                        dispD.innerText = c.D;
                        dispd.innerText = c.d;
                        dispq.innerText = c.q;
                        dispr.innerText = c.r;
                        caseNum.innerText = currentCase + 1;
                        feedbackLayer.classList.add("hidden");
                    };

                    const check = (userChoice) => {
                        const c = cases[currentCase];
                        const isCorrect = userChoice === c.valid;

                        feedbackLayer.classList.remove("hidden");
                        feedbackLayer.classList.add("animate-fade-in");

                        if (isCorrect) {
                            score += 100;
                            scoreEl.innerText = score;
                            fbIcon.innerText = "üïµÔ∏è‚Äç‚ôÇÔ∏è";
                            fbTitle.innerText = "Elementar, meu caro!";
                            fbTitle.className = "text-xl font-black text-brand-green mb-2";
                            fbDesc.innerHTML = `Voc√™ acertou! <br>${c.hint}`;
                        } else {
                            fbIcon.innerText = "üí•";
                            fbTitle.innerText = "Investiga√ß√£o Falhou!";
                            fbTitle.className = "text-xl font-black text-brand-red mb-2";
                            fbDesc.innerHTML = `Ops! A an√°lise correta seria: <br>${c.hint}`;
                        }
                    };

                    container.querySelector("#btn-true").onclick = () => check(true);
                    container.querySelector("#btn-fake").onclick = () => check(false);

                    btnNext.onclick = () => {
                        currentCase++;
                        loadCase();
                    };

                    loadCase();
                },

                interactive_exponent_pattern(container) {
                    let base = 2;
                    let step = 3; // Come√ßa em base^3

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-6">
            <h3 class="text-brand-purple font-black uppercase text-xs tracking-widest">Descubra o Padr√£o</h3>
            <select id="base-select" class="bg-gray-100 border border-gray-200 text-gray-700 text-xs font-bold rounded p-1 outline-none">
                <option value="2">Base 2</option>
                <option value="3">Base 3</option>
                <option value="4">Base 4</option>
                <option value="10">Base 10</option>
            </select>
        </div>

        <div class="w-full max-w-sm space-y-2 mb-6" id="steps-container">
            </div>

        <button id="btn-descend" class="w-full bg-brand-blue hover:bg-blue-600 text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all flex items-center justify-center gap-2">
            <i class="fas fa-arrow-down"></i> Dividir por <span id="btn-base-val">2</span>
        </button>

        <div id="final-msg" class="hidden mt-4 text-center animate-pop-in">
            <p class="text-xs text-gray-400 font-bold uppercase mb-1">Conclus√£o:</p>
            <p class="text-xl font-black text-brand-green border-2 border-brand-green bg-green-50 p-2 rounded-lg">
                Qualquer n√∫mero‚Å∞ = 1
            </p>
        </div>

    </div>
    `;

                    const stepsContainer = container.querySelector("#steps-container");
                    const btn = container.querySelector("#btn-descend");
                    const select = container.querySelector("#base-select");
                    const btnBaseVal = container.querySelector("#btn-base-val");
                    const msg = container.querySelector("#final-msg");

                    const renderStep = (exp) => {
                        const val = Math.pow(base, exp);
                        const prevVal = Math.pow(base, exp + 1);

                        const row = document.createElement("div");
                        row.className =
                            "flex items-center justify-between bg-gray-50 p-3 rounded-lg border border-gray-200 animate-slide-up relative";

                        // Se n√£o for o primeiro (top), mostra a seta de divis√£o
                        let divisionHtml = "";
                        if (exp < 3) {
                            divisionHtml = `
                <div class="absolute -top-4 right-8 text-[10px] font-bold text-gray-400 bg-white px-1 border border-gray-200 rounded-full z-10">
                    √∑ ${base}
                </div>
            `;
                        }

                        row.innerHTML = `
            ${divisionHtml}
            <div class="font-mono text-lg font-bold text-gray-600">
                ${base}<sup class="text-brand-purple">${exp}</sup>
            </div>
            <div class="flex-1 border-b border-dotted border-gray-300 mx-4"></div>
            <div class="font-mono text-xl font-black ${exp === 0 ? "text-brand-green scale-125" : "text-brand-text"
                            } transition-transform">
                ${val}
            </div>
        `;

                        stepsContainer.appendChild(row);

                        // Scroll para baixo
                        // stepsContainer.scrollTop = stepsContainer.scrollHeight;
                    };

                    const reset = () => {
                        base = parseInt(select.value);
                        step = 3;
                        stepsContainer.innerHTML = "";
                        btnBaseVal.innerText = base;
                        msg.classList.add("hidden");
                        btn.innerHTML = `<i class="fas fa-arrow-down"></i> Dividir por ${base}`;
                        btn.disabled = false;
                        btn.classList.remove(
                            "opacity-50",
                            "cursor-not-allowed",
                            "bg-gray-400"
                        );
                        btn.classList.add("bg-brand-blue");

                        // Renderiza o primeiro (topo)
                        renderStep(3);
                    };

                    btn.onclick = () => {
                        if (step > 0) {
                            step--;
                            renderStep(step);

                            if (step === 0) {
                                btn.disabled = true;
                                btn.innerHTML = "Chegamos ao Zero!";
                                btn.classList.replace("bg-brand-blue", "bg-gray-400");
                                btn.classList.add("cursor-not-allowed");
                                msg.classList.remove("hidden");
                            }
                        }
                    };

                    select.onchange = reset;

                    reset();
                },

                interactive_power_reaction(container) {
                    const questions = [
                        // Expoente 0
                        { txt: "7‚Å∞", ans: 1 },
                        { txt: "154‚Å∞", ans: 1 },
                        { txt: "1‚Å∞", ans: 1 },
                        { txt: "1000‚Å∞", ans: 1 },
                        // Expoente 1
                        { txt: "8¬π", ans: "base" }, // Special flag for "base value"
                        { txt: "25¬π", ans: "base" },
                        { txt: "1¬π", ans: 1 }, // 1^1 = 1 e base tamb√©m √© 1. Ambos corretos.
                        // Base 0 (Pra confundir)
                        { txt: "0‚Åµ", ans: 0 },
                        { txt: "0‚Åπ‚Åπ", ans: 0 },
                        // Pegadinhas Visuais
                        { txt: "50¬π", ans: "base" },
                        { txt: "10‚Å∞", ans: 1 },
                    ];

                    let currentQ = null;
                    let score = 0;
                    let streak = 0;
                    let currentBaseVal = 0; // Para quando a resposta √© "a pr√≥pria base"

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-2xl p-6 flex flex-col items-center w-full shadow-xl font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full text-white mb-6 z-10">
            <div class="flex items-center gap-2"><span class="text-2xl">‚ö°</span> <span class="font-bold uppercase tracking-widest text-xs">Reator</span></div>
            <div class="bg-gray-700 px-3 py-1 rounded-full text-xs font-black text-brand-yellow">Energia: <span id="react-score">0</span></div>
        </div>

        <div class="relative w-40 h-40 flex items-center justify-center mb-8 z-10">
            <div class="absolute inset-0 rounded-full border-4 border-brand-blue shadow-[0_0_30px_rgba(28,176,246,0.5)] animate-pulse"></div>
            <div class="bg-white w-32 h-32 rounded-full flex items-center justify-center z-20 shadow-inner">
                <span id="power-disp" class="font-mono font-black text-4xl text-gray-800">Start</span>
            </div>
        </div>

        <p class="text-gray-400 text-xs font-bold uppercase mb-4 z-10">Qual √© o resultado?</p>

        <div class="grid grid-cols-3 gap-3 w-full max-w-xs z-10" id="controls">
            <button class="react-btn bg-gray-800 border-b-4 border-gray-950 text-white font-black text-xl py-4 rounded-xl hover:bg-gray-700 active:scale-95 active:border-b-0 active:translate-y-1 transition-all" data-ans="0">
                0
            </button>
            <button class="react-btn bg-gray-800 border-b-4 border-gray-950 text-white font-black text-xl py-4 rounded-xl hover:bg-gray-700 active:scale-95 active:border-b-0 active:translate-y-1 transition-all" data-ans="1">
                1
            </button>
            <button class="react-btn bg-gray-800 border-b-4 border-gray-950 text-white font-bold text-xs py-4 rounded-xl hover:bg-gray-700 active:scale-95 active:border-b-0 active:translate-y-1 transition-all" data-ans="base">
                PR√ìPRIO<br>N√öMERO
            </button>
        </div>

        <div id="react-feedback" class="absolute inset-0 flex items-center justify-center bg-gray-900/90 z-30 hidden flex-col">
            <div class="text-6xl mb-2" id="fb-icon"></div>
            <div class="text-xl font-black text-white" id="fb-text"></div>
            <button id="btn-next-react" class="mt-6 bg-brand-blue text-white font-bold py-2 px-8 rounded-full">Continuar</button>
        </div>

    </div>
    `;

                    const display = container.querySelector("#power-disp");
                    const scoreEl = container.querySelector("#react-score");
                    const feedbackOverlay = container.querySelector("#react-feedback");
                    const fbIcon = container.querySelector("#fb-icon");
                    const fbText = container.querySelector("#fb-text");
                    const btnNext = container.querySelector("#btn-next-react");
                    const btns = container.querySelectorAll(".react-btn");

                    const nextRound = () => {
                        feedbackOverlay.classList.add("hidden");

                        // Pega quest√£o aleat√≥ria
                        const q = questions[Math.floor(Math.random() * questions.length)];
                        currentQ = q;

                        // Extrai a base num√©rica (regex simples) para valida√ß√£o
                        // Ex: "154‚Å∞" -> 154
                        const baseMatch = q.txt.match(/(\d+)/);
                        currentBaseVal = baseMatch ? parseInt(baseMatch[0]) : 0;

                        display.innerHTML = q.txt;

                        // Anima√ß√£o de entrada
                        display.classList.remove("animate-pop-in");
                        void display.offsetWidth;
                        display.classList.add("animate-pop-in");
                    };

                    const check = (userAns) => {
                        let isCorrect = false;

                        // L√≥gica de Valida√ß√£o Especial
                        if (currentQ.ans === "base") {
                            // A resposta esperada √© a pr√≥pria base
                            // O usu√°rio pode ter clicado em "PR√ìPRIO N√öMERO" (userAns="base")
                            // OU se a base for 0 ou 1, ele pode ter clicado nos bot√µes 0 ou 1.
                            if (userAns === "base") isCorrect = true;
                            if (userAns === "0" && currentBaseVal === 0) isCorrect = true;
                            if (userAns === "1" && currentBaseVal === 1) isCorrect = true;
                        } else {
                            // Resposta √© um n√∫mero fixo (0 ou 1)
                            // Se o usu√°rio clicou no n√∫mero:
                            if (parseInt(userAns) === currentQ.ans) isCorrect = true;

                            // Se a resposta √© igual √† base (ex: 1^0 = 1, base √© 1), e o usu√°rio clicou "PR√ìPRIO N√öMERO"
                            if (userAns === "base" && currentBaseVal === currentQ.ans)
                                isCorrect = true;
                        }

                        if (isCorrect) {
                            score += 10 + streak * 2;
                            streak++;
                            scoreEl.innerText = score;

                            // Feedback R√°pido (sem parar o jogo se poss√≠vel, mas aqui vamos pausar para ensinar)
                            // Para fluidez, se acertar, s√≥ pisca verde e vai pro pr√≥ximo.
                            display.parentElement.classList.add("bg-green-100");
                            setTimeout(() => {
                                display.parentElement.classList.remove("bg-green-100");
                                nextRound();
                            }, 300);
                        } else {
                            streak = 0;
                            // Erro mostra overlay
                            fbIcon.innerText = "üí•";
                            fbText.innerText = "Falha no Reator!";

                            // Explica√ß√£o
                            let correctMsg = "";
                            if (currentQ.txt.includes("‚Å∞"))
                                correctMsg = "Expoente 0 vira 1!";
                            else if (currentQ.txt.includes("¬π"))
                                correctMsg = "Expoente 1 √© ele mesmo!";
                            else if (currentQ.txt.startsWith("0"))
                                correctMsg = "Base 0 vira 0!";

                            fbText.innerHTML = `<span class="block text-sm font-normal text-gray-300 mt-2">${correctMsg}</span>`;

                            feedbackOverlay.classList.remove("hidden");
                        }
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => check(btn.dataset.ans);
                    });

                    btnNext.onclick = nextRound;

                    // Start
                    nextRound();
                },

                interactive_power10_explorer(container) {
                    // Dados de Escala
                    const scales = [
                        { exp: 0, label: "Unidade", icon: "üë§", desc: "Uma pessoa" },
                        { exp: 1, label: "Dezena", icon: "üñêÔ∏è", desc: "Dedos das m√£os" },
                        {
                            exp: 2,
                            label: "Centena",
                            icon: "üöå",
                            desc: "Um √¥nibus lotado",
                        },
                        { exp: 3, label: "Milhar", icon: "üèüÔ∏è", desc: "Torcida pequena" },
                        {
                            exp: 4,
                            label: "Dez Milhares",
                            icon: "üèôÔ∏è",
                            desc: "Uma cidade pequena",
                        },
                        {
                            exp: 5,
                            label: "Cem Milhares",
                            icon: "üèüÔ∏èüèüÔ∏è",
                            desc: "Um est√°dio gigante (Maracan√£)",
                        },
                        { exp: 6, label: "Milh√£o", icon: "üåç", desc: "Uma metr√≥pole" },
                        {
                            exp: 7,
                            label: "Dez Milh√µes",
                            icon: "üáßüá∑",
                            desc: "Popula√ß√£o de SP",
                        },
                        {
                            exp: 8,
                            label: "Cem Milh√µes",
                            icon: "üåé",
                            desc: "Popula√ß√£o do Brasil",
                        },
                        {
                            exp: 9,
                            label: "Bilh√£o",
                            icon: "üåå",
                            desc: "Popula√ß√£o da China/√çndia",
                        },
                    ];

                    let exp = 3;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Escala do Universo</h3>

        <div class="relative w-full max-w-md h-32 bg-gray-900 rounded-2xl flex flex-col items-center justify-center text-white mb-6 overflow-hidden shadow-inner border-4 border-gray-700">
            
            <div class="absolute inset-0 opacity-30" style="background-image: radial-gradient(white 1px, transparent 1px); background-size: 20px 20px;"></div>

            <div class="z-10 flex items-baseline gap-1">
                <span class="text-gray-400 text-2xl font-bold">10</span>
                <span class="text-brand-yellow text-4xl font-black mb-4" id="exp-val">3</span>
            </div>

            <div class="z-10 text-center px-4">
                <div class="text-brand-green font-mono font-bold text-lg md:text-2xl break-all leading-none" id="full-num">1.000</div>
                <div class="text-[10px] text-gray-400 mt-1 uppercase tracking-widest font-bold" id="zeros-count">3 Zeros</div>
            </div>

        </div>

        <div class="w-full max-w-md bg-blue-50 border border-blue-100 rounded-xl p-4 flex items-center gap-4 mb-6 transition-all duration-300">
            <div class="text-4xl" id="scale-icon">üèüÔ∏è</div>
            <div>
                <h4 class="font-black text-brand-blue text-sm uppercase" id="scale-label">Milhar</h4>
                <p class="text-xs text-gray-600 font-medium" id="scale-desc">Torcida pequena</p>
            </div>
        </div>

        <div class="w-full max-w-xs px-4">
            <input type="range" id="exp-slider" min="0" max="9" value="3" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue hover:accent-brand-blueDark">
            <div class="flex justify-between text-[10px] text-gray-400 font-bold mt-2 px-1">
                <span>0</span>
                <span>9</span>
            </div>
        </div>

    </div>
    `;

                    const expVal = container.querySelector("#exp-val");
                    const fullNum = container.querySelector("#full-num");
                    const zerosCount = container.querySelector("#zeros-count");
                    const icon = container.querySelector("#scale-icon");
                    const label = container.querySelector("#scale-label");
                    const desc = container.querySelector("#scale-desc");
                    const slider = container.querySelector("#exp-slider");

                    const update = () => {
                        const val = parseInt(slider.value);
                        const data = scales[val];

                        // Anima√ß√£o num√©rica
                        expVal.innerText = val;

                        // Formata n√∫mero com pontos (1.000.000)
                        const numStr = Math.pow(10, val).toLocaleString("pt-BR");
                        fullNum.innerText = numStr;

                        zerosCount.innerText = val === 1 ? "1 Zero" : `${val} Zeros`;

                        // Atualiza Info
                        icon.innerText = data.icon;
                        label.innerText = data.label;
                        desc.innerText = data.desc;

                        // Ajusta tamanho da fonte para n√∫meros grandes
                        if (val > 6)
                            fullNum.className =
                                "text-brand-green font-mono font-bold text-lg break-all leading-none";
                        else
                            fullNum.className =
                                "text-brand-green font-mono font-bold text-2xl break-all leading-none";
                    };

                    slider.oninput = update;
                    update();
                },

                interactive_number_dissector(container) {
                    let currentNumber = 2345;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Dissecador Num√©rico</h3>

        <div class="flex items-center gap-2 mb-6 w-full max-w-xs">
            <input type="number" id="input-dissect" value="2345" min="1" max="999999" class="flex-1 text-center text-3xl font-mono font-bold text-brand-text border-b-4 border-brand-purple outline-none focus:border-purple-600 transition-colors bg-transparent" placeholder="0">
            <button id="btn-dissect" class="bg-brand-purple text-white w-12 h-12 rounded-xl shadow-btn active:shadow-none active:translate-y-1 transition-all flex items-center justify-center text-xl">
                <i class="fas fa-search"></i>
            </button>
        </div>

        <div id="results-area" class="w-full flex flex-col gap-4">
            <div class="bg-gray-50 border border-gray-200 rounded-xl p-3 opacity-0 transition-all duration-500 transform translate-y-4" id="layer-add">
                <span class="text-[10px] font-bold text-gray-400 uppercase block mb-1">Soma dos Valores</span>
                <div class="font-mono text-lg text-gray-700 font-bold flex flex-wrap justify-center gap-1" id="text-add">
                    2000 + 300 + 40 + 5
                </div>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded-xl p-3 opacity-0 transition-all duration-500 transform translate-y-4 delay-100" id="layer-mult">
                <span class="text-[10px] font-bold text-blue-400 uppercase block mb-1">Multiplica√ß√£o</span>
                <div class="font-mono text-sm md:text-base text-blue-800 font-bold flex flex-wrap justify-center gap-2" id="text-mult">
                    (2x1000) + (3x100) + ...
                </div>
            </div>

            <div class="bg-brand-text text-white rounded-xl p-4 opacity-0 transition-all duration-500 transform translate-y-4 delay-200 shadow-lg relative overflow-hidden" id="layer-pow">
                <div class="absolute top-0 right-0 p-2 opacity-10 text-4xl">üöÄ</div>
                <span class="text-[10px] font-bold text-gray-400 uppercase block mb-2">Nota√ß√£o Cient√≠fica / Pot√™ncias</span>
                <div class="font-mono text-lg md:text-xl font-bold flex flex-wrap justify-center gap-x-2 gap-y-1" id="text-pow">
                    2¬∑10¬≥ + 3¬∑10¬≤ ...
                </div>
            </div>

        </div>

    </div>
    `;

                    const input = container.querySelector("#input-dissect");
                    const btn = container.querySelector("#btn-dissect");
                    const layerAdd = container.querySelector("#layer-add");
                    const layerMult = container.querySelector("#layer-mult");
                    const layerPow = container.querySelector("#layer-pow");
                    const textAdd = container.querySelector("#text-add");
                    const textMult = container.querySelector("#text-mult");
                    const textPow = container.querySelector("#text-pow");

                    const dissect = () => {
                        const valStr = input.value;
                        if (!valStr) return;

                        // Reset anima√ß√µes
                        [layerAdd, layerMult, layerPow].forEach((el) => {
                            el.classList.remove("opacity-100", "translate-y-0");
                            el.classList.add("opacity-0", "translate-y-4");
                        });

                        // Prepara dados
                        const digits = valStr.split("");
                        const len = digits.length;

                        let htmlAdd = [];
                        let htmlMult = [];
                        let htmlPow = [];

                        digits.forEach((d, i) => {
                            const power = len - 1 - i; // Ex: 2345 -> 2 √© index 0, power 3 (10^3)
                            const zeroString = "0".repeat(power);
                            const value = d + zeroString;

                            if (d !== "0") {
                                // Pula zeros na decomposi√ß√£o visual para ficar mais limpo
                                htmlAdd.push(
                                    `<span class="bg-white px-1 rounded shadow-sm border border-gray-200">${value}</span>`
                                );

                                htmlMult.push(
                                    `<span class="whitespace-nowrap">(${d} √ó 1${zeroString})</span>`
                                );

                                htmlPow.push(
                                    `<span class="whitespace-nowrap"><span class="text-brand-yellow">${d}</span>¬∑10<sup class="text-brand-green">${power}</sup></span>`
                                );
                            }
                        });

                        textAdd.innerHTML = htmlAdd.join(
                            ' <span class="text-gray-400">+</span> '
                        );
                        textMult.innerHTML = htmlMult.join(
                            ' <span class="text-blue-300">+</span> '
                        );
                        textPow.innerHTML = htmlPow.join(
                            ' <span class="text-gray-500">+</span> '
                        );

                        // Dispara anima√ß√µes
                        setTimeout(() => {
                            layerAdd.classList.remove("opacity-0", "translate-y-4");
                            layerAdd.classList.add("opacity-100", "translate-y-0");
                        }, 100);

                        setTimeout(() => {
                            layerMult.classList.remove("opacity-0", "translate-y-4");
                            layerMult.classList.add("opacity-100", "translate-y-0");
                        }, 300);

                        setTimeout(() => {
                            layerPow.classList.remove("opacity-0", "translate-y-4");
                            layerPow.classList.add("opacity-100", "translate-y-0");
                        }, 500);
                    };

                    btn.onclick = dissect;
                    input.addEventListener("keypress", (e) => {
                        if (e.key === "Enter") dissect();
                    });

                    // Init
                    setTimeout(dissect, 500);
                },

                interactive_scientific_mission(container) {
                    // N√≠veis: Planeta, Dist√¢ncia, Resposta (Expoente)
                    const levels = [
                        {
                            name: "Lua",
                            dist: "384.000 km",
                            base: 3,
                            mantissa: "3,84",
                            exp: 5,
                            hint: "Conte as casas decimais ap√≥s o 3.",
                        },
                        // 3,84 x 10^5 (5 casas: 8,4,0,0,0)

                        {
                            name: "Sol",
                            dist: "150.000.000 km",
                            base: 1.5,
                            mantissa: "1,5",
                            exp: 8,
                            hint: "Mova a v√≠rgula do fim at√© ficar entre 1 e 5.",
                        },

                        {
                            name: "Marte",
                            dist: "225.000.000 km",
                            base: 2.25,
                            mantissa: "2,25",
                            exp: 8,
                            hint: "Conte quantos d√≠gitos h√° depois do primeiro 2.",
                        },

                        {
                            name: "Voyager 1",
                            dist: "24.000.000.000 km",
                            base: 2.4,
                            mantissa: "2,4",
                            exp: 10,
                            hint: "S√£o muitos zeros! Conte com cuidado.",
                        },
                    ];

                    let currentLvl = 0;
                    let userExp = 0;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[450px]">
        
        <div class="flex justify-between w-full items-center mb-4 z-20">
            <div class="bg-gray-800 text-white px-3 py-1 rounded-full text-xs font-bold border border-gray-600 uppercase tracking-wider">
                <i class="fas fa-rocket text-brand-red"></i> Miss√£o <span id="mission-num">1</span>
            </div>
            <div class="text-white text-xs font-mono" id="planet-name">LUA</div>
        </div>

        <div class="relative w-full flex-1 bg-black rounded-lg border-2 border-gray-600 mb-4 overflow-hidden flex flex-col items-center justify-center group">
            <div class="absolute inset-0 opacity-50 animate-pulse" style="background-image: radial-gradient(white 1px, transparent 1px); background-size: 30px 30px;"></div>
            
            <div class="z-10 text-center">
                <p class="text-gray-400 text-[10px] uppercase font-bold mb-2">Dist√¢ncia Alvo</p>
                <p class="text-2xl md:text-3xl font-mono text-green-400 font-bold mb-4 animate-typewriter" id="target-dist">384.000 km</p>
                
                <div class="bg-gray-800 p-3 rounded-xl border border-gray-600 inline-block">
                    <span class="text-white font-mono text-xl" id="mantissa-disp">3,84</span>
                    <span class="text-gray-400 font-mono text-xl">√ó 10</span>
                    <sup class="text-brand-yellow font-black text-2xl bg-gray-700 px-2 rounded ml-1 border border-yellow-600" id="user-exp-disp">0</sup>
                </div>
            </div>

            <div class="absolute bottom-4 left-1/2 -translate-x-1/2 text-4xl transition-all duration-1000" id="spaceship">üöÄ</div>
        </div>

        <div class="w-full bg-gray-800 rounded-t-2xl p-4 border-t-4 border-gray-600 z-20">
            <p class="text-center text-[10px] text-gray-400 uppercase font-bold mb-2">Ajuste a Pot√™ncia do Motor</p>
            
            <div class="flex items-center gap-4">
                <button id="btn-dec" class="w-12 h-12 rounded-full bg-red-600 text-white font-black text-xl shadow-lg active:scale-95 border-b-4 border-red-800">-</button>
                
                <div class="flex-1">
                    <input type="range" id="exp-control" min="0" max="12" value="0" class="w-full h-4 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-brand-yellow">
                    <div class="flex justify-between text-[10px] text-gray-500 font-mono mt-1 px-1">
                        <span>0</span><span>6</span><span>12</span>
                    </div>
                </div>

                <button id="btn-inc" class="w-12 h-12 rounded-full bg-green-600 text-white font-black text-xl shadow-lg active:scale-95 border-b-4 border-green-800">+</button>
            </div>

            <button id="btn-launch" class="w-full mt-4 bg-brand-blue text-white font-black uppercase tracking-widest py-3 rounded-xl shadow-[0_4px_0_#1899D6] active:shadow-none active:translate-y-1 transition-all">
                WARP SPEED! üõ∏
            </button>
        </div>

        <div id="space-feedback" class="absolute inset-0 bg-black/90 flex flex-col items-center justify-center z-30 hidden">
            <div class="text-6xl mb-4" id="fb-icon">üí•</div>
            <h3 class="text-white font-black text-2xl mb-2" id="fb-title">Falha no Motor!</h3>
            <p class="text-gray-400 text-sm mb-6 text-center px-8" id="fb-msg">Voc√™ colocou pouca pot√™ncia.</p>
            <button id="btn-retry" class="bg-white text-gray-900 font-bold py-2 px-6 rounded-full">Tentar de Novo</button>
        </div>

    </div>
    `;

                    const missionNum = container.querySelector("#mission-num");
                    const planetName = container.querySelector("#planet-name");
                    const targetDist = container.querySelector("#target-dist");
                    const mantissaDisp = container.querySelector("#mantissa-disp");
                    const userExpDisp = container.querySelector("#user-exp-disp");
                    const expControl = container.querySelector("#exp-control");
                    const btnDec = container.querySelector("#btn-dec");
                    const btnInc = container.querySelector("#btn-inc");
                    const btnLaunch = container.querySelector("#btn-launch");
                    const spaceship = container.querySelector("#spaceship");

                    const feedback = container.querySelector("#space-feedback");
                    const fbIcon = container.querySelector("#fb-icon");
                    const fbTitle = container.querySelector("#fb-title");
                    const fbMsg = container.querySelector("#fb-msg");
                    const btnRetry = container.querySelector("#btn-retry");

                    const loadLevel = () => {
                        if (currentLvl >= levels.length) {
                            feedback.classList.remove("hidden");
                            fbIcon.innerText = "üåå";
                            fbTitle.innerText = "Conquistador do Universo!";
                            fbMsg.innerText = "Voc√™ dominou a nota√ß√£o cient√≠fica.";
                            btnRetry.innerText = "Reiniciar Miss√£o";
                            btnRetry.onclick = () => {
                                currentLvl = 0;
                                loadLevel();
                                feedback.classList.add("hidden");
                            };
                            return;
                        }

                        const lvl = levels[currentLvl];
                        missionNum.innerText = currentLvl + 1;
                        planetName.innerText = lvl.name.toUpperCase();
                        targetDist.innerText = lvl.dist;
                        mantissaDisp.innerText = lvl.mantissa;

                        userExp = 0; // Reset
                        expControl.value = 0;
                        userExpDisp.innerText = 0;

                        spaceship.style.transform = "translate(-50%, 0) scale(1)"; // Reset nave

                        feedback.classList.add("hidden");
                    };

                    const updateExp = (val) => {
                        userExp = parseInt(val);
                        expControl.value = userExp;
                        userExpDisp.innerText = userExp;
                        // Efeito sonoro fake (vibra√ß√£o visual)
                        userExpDisp.classList.add("scale-125", "text-white");
                        setTimeout(
                            () => userExpDisp.classList.remove("scale-125", "text-white"),
                            100
                        );
                    };

                    const launch = () => {
                        const lvl = levels[currentLvl];

                        if (userExp === lvl.exp) {
                            // Sucesso
                            spaceship.style.transform =
                                "translate(-50%, -200px) scale(0.1)"; // Voa para o fundo
                            spaceship.style.opacity = "0";

                            setTimeout(() => {
                                fbIcon.innerText = "ü™ê";
                                fbTitle.innerText = "Pouso Confirmado!";
                                fbTitle.className =
                                    "text-brand-green font-black text-2xl mb-2";
                                fbMsg.innerText = `C√°lculo perfeito: ${lvl.mantissa} x 10^${lvl.exp}`;
                                feedback.classList.remove("hidden");

                                btnRetry.innerText = "Pr√≥ximo Planeta";
                                btnRetry.onclick = () => {
                                    currentLvl++;
                                    spaceship.style.opacity = "1"; // Volta
                                    loadLevel();
                                };
                            }, 1000);
                        } else {
                            // Falha
                            spaceship.classList.add("animate-shake"); // Treme
                            setTimeout(
                                () => spaceship.classList.remove("animate-shake"),
                                500
                            );

                            fbIcon.innerText = "‚ö†Ô∏è";
                            fbTitle.innerText = "Erro de Navega√ß√£o";
                            fbTitle.className = "text-brand-red font-black text-2xl mb-2";
                            fbMsg.innerText = lvl.hint;

                            // Pequeno delay para mostrar overlay
                            setTimeout(() => {
                                feedback.classList.remove("hidden");
                                btnRetry.innerText = "Tentar de Novo";
                                btnRetry.onclick = () => feedback.classList.add("hidden");
                            }, 600);
                        }
                    };

                    // Listeners
                    expControl.oninput = (e) => updateExp(e.target.value);
                    btnDec.onclick = () => {
                        if (userExp > 0) updateExp(userExp - 1);
                    };
                    btnInc.onclick = () => {
                        if (userExp < 12) updateExp(userExp + 1);
                    };
                    btnLaunch.onclick = launch;

                    // CSS Inline para anima√ß√µes
                    if (!document.getElementById("space-anims")) {
                        const s = document.createElement("style");
                        s.id = "space-anims";
                        s.innerHTML = `
            @keyframes typewriter { from { width: 0; } to { width: 100%; } }
        `;
                        container.appendChild(s);
                    }

                    loadLevel();
                },

                interactive_geometric_root(container) {
                    let side = 3;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Raio-X do Quadrado</h3>

        <div class="flex flex-col md:flex-row gap-8 items-center justify-center w-full mb-6">
            
            <div class="relative bg-gray-50 border border-gray-200 rounded-lg p-1 transition-all duration-300 shadow-inner" style="width: 220px; height: 220px; display: flex; align-items: center; justify-content: center;">
                
                <div class="absolute inset-0 opacity-20" style="background-image: linear-gradient(#ccc 1px, transparent 1px), linear-gradient(90deg, #ccc 1px, transparent 1px); background-size: 20px 20px;"></div>

                <div id="square-geo" class="bg-brand-purple/20 border-2 border-brand-purple relative transition-all duration-300 grid" style="width: 60px; height: 60px;">
                    </div>
                
                <div class="absolute bottom-2 w-full text-center text-xs font-bold text-brand-purple transition-all" id="label-side-bottom">Lado = 3</div>
                <div class="absolute left-2 top-1/2 -translate-y-1/2 -rotate-90 text-xs font-bold text-brand-purple transition-all" id="label-side-left">Lado = 3</div>

            </div>

            <div class="flex flex-col gap-4 w-full max-w-xs">
                
                <div class="bg-purple-50 p-4 rounded-xl border border-purple-200 text-center">
                    <p class="text-xs font-bold text-gray-400 uppercase mb-1">√Årea Total (Quadradinhos)</p>
                    <div class="text-4xl font-black text-brand-text mb-2" id="val-area">9</div>
                    <div class="h-px w-full bg-purple-200 my-2"></div>
                    <p class="font-mono text-lg text-brand-purple font-bold">‚àö<span id="math-area">9</span> = <span id="math-side" class="text-2xl">3</span></p>
                </div>

                <div>
                    <div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-2">
                        <span>Ajustar Lado</span>
                        <span id="slider-val" class="text-brand-blue">3</span>
                    </div>
                    <input type="range" id="geo-slider" min="1" max="10" value="3" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-purple">
                </div>

            </div>

        </div>
    </div>
    `;

                    const slider = container.querySelector("#geo-slider");
                    const square = container.querySelector("#square-geo");
                    const valArea = container.querySelector("#val-area");
                    const mathArea = container.querySelector("#math-area");
                    const mathSide = container.querySelector("#math-side");
                    const sliderVal = container.querySelector("#slider-val");
                    const labelBottom = container.querySelector("#label-side-bottom");
                    const labelLeft = container.querySelector("#label-side-left");

                    const update = () => {
                        const s = parseInt(slider.value);
                        const area = s * s;
                        const pxPerUnit = 20; // 20px por unidade do grid

                        // Atualiza Textos
                        valArea.innerText = area;
                        mathArea.innerText = area;
                        mathSide.innerText = s;
                        sliderVal.innerText = s;
                        labelBottom.innerText = `Lado = ${s}`;
                        labelLeft.innerText = `Lado = ${s}`;

                        // Atualiza Quadrado Visual
                        square.style.width = `${s * pxPerUnit}px`;
                        square.style.height = `${s * pxPerUnit}px`;

                        // Gera Grid Interno (Quadradinhos)
                        // Usamos background-image para simular os quadradinhos internos de forma perform√°tica
                        square.style.backgroundImage = `linear-gradient(#A568CC 1px, transparent 1px), linear-gradient(90deg, #A568CC 1px, transparent 1px)`;
                        square.style.backgroundSize = `${pxPerUnit}px ${pxPerUnit}px`;
                        square.style.backgroundColor = "rgba(206, 130, 255, 0.2)";
                    };

                    slider.addEventListener("input", update);
                    update();
                },

                interactive_root_challenge(container) {
                    const targets = [9, 16, 25, 36, 49, 64]; // √Åreas alvo (Quadrados perfeitos)
                    let currentTarget = 16;
                    let currentSide = 1; // Come√ßa errado propositalmente
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">
        
        <div class="flex justify-between w-full items-center mb-6 z-10">
            <div class="flex flex-col">
                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Encomenda</span>
                <span class="text-xl font-black text-brand-yellow">√Årea: <span id="target-area" class="text-3xl">16</span> m¬≤</span>
            </div>
            <div class="bg-gray-700 px-3 py-1 rounded-full text-xs font-black">Score: <span id="root-score" class="text-brand-green">0</span></div>
        </div>

        <div class="relative w-64 h-64 bg-gray-800 rounded-xl border-2 border-gray-600 mb-6 flex items-center justify-center overflow-hidden shadow-inner z-10">
            <div class="absolute inset-0 opacity-10" style="background-image: linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, #fff 1px, transparent 1px); background-size: 20px 20px;"></div>

            <div id="player-square" class="bg-brand-green/30 border-2 border-brand-green transition-all duration-200 flex items-center justify-center relative" style="width: 20px; height: 20px;">
                <span id="current-area-val" class="text-xs font-bold text-white drop-shadow-md">1</span>
            </div>
        </div>

        <div class="flex items-center gap-4 w-full max-w-xs z-10 mb-4">
            <button id="btn-dec" class="w-12 h-12 rounded-xl bg-gray-700 hover:bg-gray-600 text-white font-black text-xl shadow-sm active:scale-95 transition-all">-</button>
            
            <div class="flex-1 text-center">
                <p class="text-[10px] text-gray-400 uppercase font-bold">Lado da Cerca</p>
                <p class="text-3xl font-mono font-bold text-white"><span id="side-val">1</span> m</p>
            </div>

            <button id="btn-inc" class="w-12 h-12 rounded-xl bg-gray-700 hover:bg-gray-600 text-white font-black text-xl shadow-sm active:scale-95 transition-all">+</button>
        </div>

        <button id="btn-confirm-root" class="w-full max-w-xs bg-brand-green text-white font-bold py-3 rounded-xl shadow-[0_0_15px_rgba(34,197,94,0.4)] active:scale-95 transition-all z-10 uppercase tracking-widest text-sm">
            Entregar Obra
        </button>
        
        <div id="root-feedback" class="h-8 mt-2 font-bold text-sm text-center z-10"></div>

    </div>
    `;

                    const targetDisplay = container.querySelector("#target-area");
                    const playerSquare = container.querySelector("#player-square");
                    const areaVal = container.querySelector("#current-area-val");
                    const sideVal = container.querySelector("#side-val");
                    const btnInc = container.querySelector("#btn-inc");
                    const btnDec = container.querySelector("#btn-dec");
                    const btnConfirm = container.querySelector("#btn-confirm-root");
                    const feedback = container.querySelector("#root-feedback");
                    const scoreEl = container.querySelector("#root-score");

                    const pxPerUnit = 20; // Escala visual

                    const updateVisuals = () => {
                        const sizePx = currentSide * pxPerUnit;
                        const currentArea = currentSide * currentSide;

                        playerSquare.style.width = `${sizePx}px`;
                        playerSquare.style.height = `${sizePx}px`;

                        areaVal.innerText = currentArea;
                        sideVal.innerText = currentSide;

                        // Feedback sutil se passou do ponto
                        if (currentArea > currentTarget) {
                            playerSquare.classList.replace(
                                "border-brand-green",
                                "border-red-400"
                            );
                            playerSquare.classList.replace(
                                "bg-brand-green/30",
                                "bg-red-500/30"
                            );
                        } else {
                            playerSquare.classList.replace(
                                "border-red-400",
                                "border-brand-green"
                            );
                            playerSquare.classList.replace(
                                "bg-red-500/30",
                                "bg-brand-green/30"
                            );
                        }
                    };

                    const nextLevel = () => {
                        // Escolhe novo alvo diferente do atual
                        let newTarget;
                        do {
                            newTarget = targets[Math.floor(Math.random() * targets.length)];
                        } while (newTarget === currentTarget);

                        currentTarget = newTarget;
                        targetDisplay.innerText = currentTarget;

                        // Reseta lado para 1 ou um valor aleat√≥rio baixo
                        currentSide = Math.floor(Math.random() * 3) + 1;

                        feedback.innerText = "";
                        btnConfirm.disabled = false;
                        btnConfirm.classList.remove("opacity-50", "cursor-not-allowed");
                        btnConfirm.innerText = "Entregar Obra";

                        updateVisuals();
                    };

                    btnInc.onclick = () => {
                        if (currentSide < 10) {
                            currentSide++;
                            updateVisuals();
                        }
                    };

                    btnDec.onclick = () => {
                        if (currentSide > 1) {
                            currentSide--;
                            updateVisuals();
                        }
                    };

                    btnConfirm.onclick = () => {
                        const area = currentSide * currentSide;

                        if (area === currentTarget) {
                            score += 100;
                            scoreEl.innerText = score;
                            feedback.innerHTML = `<span class="text-brand-green">PERFEITO! ‚àö${area} = ${currentSide}</span>`;

                            // Efeito visual
                            playerSquare.classList.add("scale-110", "bg-green-400");
                            setTimeout(
                                () =>
                                    playerSquare.classList.remove("scale-110", "bg-green-400"),
                                300
                            );

                            btnConfirm.innerText = "Pr√≥ximo...";
                            btnConfirm.disabled = true;
                            setTimeout(nextLevel, 1500);
                        } else {
                            feedback.innerHTML = `<span class="text-brand-red">ERRO! √Årea Atual: ${area} m¬≤. Alvo: ${currentTarget} m¬≤.</span>`;
                            playerSquare.classList.add("animate-shake");
                            setTimeout(
                                () => playerSquare.classList.remove("animate-shake"),
                                500
                            );
                        }
                    };

                    updateVisuals();
                },

                interactive_hierarchy_pyramid(container) {
                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">A Pir√¢mide do Poder</h3>
        
        <div class="relative w-full max-w-xs flex flex-col items-center gap-1">
            
            <div class="w-1/3 bg-brand-purple text-white p-2 rounded-t-xl text-center shadow-lg transform transition-all hover:scale-110 cursor-pointer z-30 group">
                <div class="text-2xl font-black mb-1">1¬∫</div>
                <div class="text-[10px] font-bold uppercase group-hover:hidden">S√≠mbolos</div>
                <div class="hidden group-hover:block text-xs font-bold animate-pop-in">
                    ( ) [ ] { }
                </div>
            </div>

            <div class="w-2/3 bg-brand-red text-white p-2 text-center shadow-md transform transition-all hover:scale-105 cursor-pointer z-20 group">
                <div class="text-xl font-black mb-1">2¬∫</div>
                <div class="text-[10px] font-bold uppercase group-hover:hidden">Pot√™ncia / Raiz</div>
                <div class="hidden group-hover:block text-xs font-bold animate-pop-in">
                    $x^2$ e $\\sqrt{x}$
                </div>
            </div>

            <div class="w-5/6 bg-brand-orange text-white p-2 text-center shadow-sm transform transition-all hover:scale-105 cursor-pointer z-10 group">
                <div class="text-lg font-black mb-1">3¬∫</div>
                <div class="text-[10px] font-bold uppercase group-hover:hidden">Mult. / Divis√£o</div>
                <div class="hidden group-hover:block text-xs font-bold animate-pop-in">
                    $\\times$ e $\\div$
                </div>
            </div>

            <div class="w-full bg-brand-green text-white p-2 rounded-b-xl text-center shadow-sm transform transition-all hover:scale-105 cursor-pointer z-0 group">
                <div class="text-base font-black mb-1">4¬∫</div>
                <div class="text-[10px] font-bold uppercase group-hover:hidden">Soma / Subtra√ß√£o</div>
                <div class="hidden group-hover:block text-xs font-bold animate-pop-in">
                    $+$ e $-$
                </div>
            </div>

        </div>
        
        <p class="text-xs text-gray-400 mt-4 text-center">Passe o mouse (ou toque) nos n√≠veis para ver os detalhes.</p>
    </div>
    `;

                    // Renderiza Latex se necess√°rio (para as ra√≠zes)
                    if (window.renderMathInElement) {
                        renderMathInElement(container, {
                            delimiters: [{ left: "$", right: "$", display: false }],
                        });
                    }
                },

                interactive_nested_explorer(container) {
                    // Express√£o: { 20 - [ 2 + ( 3 x 4 ) ] }
                    // Passos visuais
                    const steps = [
                        {
                            html: `<span class="text-gray-400">{</span> 20 - <span class="text-gray-400">[</span> 2 + <span class="text-brand-purple font-bold text-xl scale-110 inline-block bg-purple-50 px-1 rounded">( 3 √ó 4 )</span> <span class="text-gray-400">] }</span>`,
                            desc: "1. Resolva o Par√™nteses (Miolo)",
                        },
                        {
                            html: `<span class="text-gray-400">{</span> 20 - <span class="text-brand-blue font-bold text-xl scale-110 inline-block bg-blue-50 px-1 rounded">[ 2 + 12 ]</span> <span class="text-gray-400">}</span>`,
                            desc: "2. Resolva o Colchete",
                        },
                        {
                            html: `<span class="text-brand-orange font-bold text-xl scale-110 inline-block bg-orange-50 px-1 rounded">{ 20 - 14 }</span>`,
                            desc: "3. Resolva as Chaves",
                        },
                        {
                            html: `<span class="text-brand-green font-black text-3xl animate-bounce inline-block">6</span>`,
                            desc: "Resultado Final",
                        },
                    ];

                    let current = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none h-64 justify-between">
        
        <div class="w-full text-center">
             <h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-2">De Dentro para Fora</h3>
             <div class="h-1 w-12 bg-gray-200 mx-auto rounded-full"></div>
        </div>

        <div id="nested-display" class="font-mono text-xl md:text-2xl text-center transition-all duration-500 flex items-center justify-center h-20 w-full">
            </div>

        <div class="w-full text-center">
            <p id="nested-desc" class="text-sm font-bold text-gray-500 mb-4 h-6">...</p>
            
            <div class="flex justify-between w-full">
                <button id="btn-prev" class="text-gray-400 hover:text-brand-blue disabled:opacity-30"><i class="fas fa-chevron-left text-2xl"></i></button>
                <div class="flex gap-1 items-center" id="dots-indicator"></div>
                <button id="btn-next" class="text-brand-blue hover:text-brand-blueDark disabled:opacity-30"><i class="fas fa-chevron-right text-2xl"></i></button>
            </div>
        </div>

    </div>
    `;

                    const display = container.querySelector("#nested-display");
                    const desc = container.querySelector("#nested-desc");
                    const dotsContainer = container.querySelector("#dots-indicator");
                    const btnPrev = container.querySelector("#btn-prev");
                    const btnNext = container.querySelector("#btn-next");

                    const update = () => {
                        const s = steps[current];

                        // Anima√ß√£o de troca
                        display.style.opacity = "0";
                        display.style.transform = "scale(0.9)";

                        setTimeout(() => {
                            display.innerHTML = s.html;
                            desc.innerText = s.desc;
                            display.style.opacity = "1";
                            display.style.transform = "scale(1)";
                        }, 200);

                        // Atualiza Bot√µes
                        btnPrev.disabled = current === 0;
                        btnNext.disabled = current === steps.length - 1;

                        // Atualiza Dots
                        dotsContainer.innerHTML = steps
                            .map(
                                (_, i) =>
                                    `<div class="w-2 h-2 rounded-full transition-colors ${i === current ? "bg-brand-blue" : "bg-gray-300"
                                    }"></div>`
                            )
                            .join("");
                    };

                    btnNext.onclick = () => {
                        if (current < steps.length - 1) {
                            current++;
                            update();
                        }
                    };
                    btnPrev.onclick = () => {
                        if (current > 0) {
                            current--;
                            update();
                        }
                    };

                    update();
                },

                interactive_bomb_defusal(container) {
                    // N√≠veis
                    const levels = [
                        {
                            expr: "2 + 5 √ó 3",
                            opts: [
                                {
                                    text: "Somar 2 + 5",
                                    correct: false,
                                    feedback: "Errado! Multiplica√ß√£o vence Soma.",
                                },
                                {
                                    text: "Multiplicar 5 √ó 3",
                                    correct: true,
                                    nextExpr: "2 + 15",
                                    feedback: "Certo! 5x3=15",
                                },
                            ],
                            final: 17,
                        },
                        {
                            expr: "4¬≤ - 10 √∑ 2",
                            opts: [
                                {
                                    text: "Dividir 10 √∑ 2",
                                    correct: false,
                                    feedback: "Cuidado! Pot√™ncia √© prioridade m√°xima.",
                                },
                                {
                                    text: "Pot√™ncia 4¬≤",
                                    correct: true,
                                    nextExpr: "16 - 10 √∑ 2",
                                    feedback: "Boa! 4¬≤ = 16",
                                },
                            ],
                            step2: {
                                opts: [
                                    {
                                        text: "Subtrair 16 - 10",
                                        correct: false,
                                        feedback: "N√£o! Divis√£o vence Subtra√ß√£o.",
                                    },
                                    {
                                        text: "Dividir 10 √∑ 2",
                                        correct: true,
                                        nextExpr: "16 - 5",
                                        feedback: "Isso! 10√∑2 = 5",
                                    },
                                ],
                            },
                            final: 11,
                        },
                    ];

                    let currentLvl = 0;
                    let currentStep = 0; // 0 = inicio, 1 = segundo passo (se houver)
                    let isExploded = false;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-2xl font-sans select-none relative overflow-hidden">
        
        <div class="absolute top-4 right-4 font-mono text-red-500 text-xl animate-pulse">00:15</div>

        <h3 class="text-white font-black uppercase text-xs tracking-widest mb-6 border-b border-gray-700 pb-2 w-full text-center">Esquadr√£o Antibombas</h3>

        <div class="bg-black border-4 border-gray-600 rounded-lg p-6 mb-8 w-full text-center relative shadow-[0_0_15px_rgba(0,0,0,0.8)]">
            <div id="bomb-display" class="font-mono text-3xl md:text-4xl text-green-400 font-bold tracking-wider">
                ...
            </div>
            
            <div id="explosion-overlay" class="absolute inset-0 bg-red-600 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-100 z-20">
                <span class="text-white font-black text-5xl transform scale-150">BOOM!</span>
            </div>
        </div>

        <p class="text-gray-400 text-sm mb-4 font-bold">Qual fio cortar primeiro?</p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full" id="wire-container">
            </div>

        <div id="bomb-feedback" class="h-12 mt-4 text-center font-bold text-sm flex items-center justify-center px-4 w-full rounded bg-gray-800 text-white border border-gray-700">
            Aguardando comando...
        </div>

        <button id="btn-next-bomb" class="hidden mt-4 w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg shadow-lg transition-all">
            Pr√≥xima Bomba
        </button>

    </div>
    `;

                    const display = container.querySelector("#bomb-display");
                    const wires = container.querySelector("#wire-container");
                    const feedback = container.querySelector("#bomb-feedback");
                    const explosion = container.querySelector("#explosion-overlay");
                    const btnNext = container.querySelector("#btn-next-bomb");

                    const loadLevel = () => {
                        if (currentLvl >= levels.length) {
                            display.innerText = "DEFUSED";
                            display.className =
                                "font-mono text-3xl md:text-4xl text-blue-400 font-bold tracking-wider";
                            wires.innerHTML = "";
                            feedback.innerText = "Parab√©ns! Voc√™ salvou o dia! üèÜ";
                            feedback.className =
                                "h-12 mt-4 text-center font-bold text-sm flex items-center justify-center px-4 w-full rounded bg-blue-900 text-blue-100 border border-blue-700";
                            return;
                        }

                        const lvl = levels[currentLvl];
                        let currentData = lvl; // Come√ßa no n√≠vel base

                        // Se estiver no passo 2
                        if (currentStep === 1 && lvl.step2) {
                            display.innerText = lvl.opts.find((o) => o.correct).nextExpr; // Pega o resultado do passo anterior
                            currentData = lvl.step2; // Carrega op√ß√µes do passo 2
                        } else {
                            display.innerText = lvl.expr;
                        }

                        display.className =
                            "font-mono text-3xl md:text-4xl text-green-400 font-bold tracking-wider";
                        isExploded = false;
                        explosion.classList.remove("opacity-100");
                        btnNext.classList.add("hidden");
                        feedback.innerText = "Selecione a opera√ß√£o priorit√°ria.";
                        feedback.className =
                            "h-12 mt-4 text-center font-bold text-sm flex items-center justify-center px-4 w-full rounded bg-gray-800 text-gray-300 border border-gray-700";

                        wires.innerHTML = "";

                        // Renderiza Fios (Bot√µes)
                        currentData.opts.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "relative bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 rounded-xl border-l-8 border-l-red-500 shadow-md transition-all active:scale-95 flex items-center justify-start px-4 gap-3";
                            btn.innerHTML = `<i class="fas fa-cut text-gray-400"></i> <span>${opt.text}</span>`;

                            btn.onclick = () => {
                                if (isExploded) return;

                                if (opt.correct) {
                                    // Acertou
                                    feedback.innerText = opt.feedback;
                                    feedback.className =
                                        "h-12 mt-4 text-center font-bold text-sm flex items-center justify-center px-4 w-full rounded bg-green-900 text-green-100 border border-green-700";
                                    btn.classList.remove("border-l-red-500");
                                    btn.classList.add("border-l-green-500", "bg-gray-600");

                                    // Verifica se tem pr√≥ximo passo ou n√≠vel
                                    if (currentStep === 0 && lvl.step2) {
                                        currentStep++;
                                        setTimeout(loadLevel, 1000);
                                    } else {
                                        // Acabou o n√≠vel
                                        display.innerText = opt.nextExpr || lvl.final;
                                        display.classList.replace(
                                            "text-green-400",
                                            "text-blue-400"
                                        );
                                        wires.innerHTML = ""; // Limpa fios
                                        btnNext.classList.remove("hidden");
                                    }
                                } else {
                                    // Errou - BOOM
                                    isExploded = true;
                                    explosion.classList.add("opacity-100");
                                    feedback.innerText = opt.feedback;
                                    feedback.className =
                                        "h-12 mt-4 text-center font-bold text-sm flex items-center justify-center px-4 w-full rounded bg-red-900 text-red-100 border border-red-700";

                                    // Shake screen
                                    container.classList.add("animate-shake");
                                    setTimeout(
                                        () => container.classList.remove("animate-shake"),
                                        500
                                    );

                                    // Bot√£o de Retry
                                    btnNext.innerText = "Tentar de Novo";
                                    btnNext.classList.remove(
                                        "hidden",
                                        "bg-blue-600",
                                        "hover:bg-blue-500"
                                    );
                                    btnNext.classList.add("bg-gray-600", "hover:bg-gray-500");
                                    btnNext.onclick = () => {
                                        currentStep = 0; // Reinicia do come√ßo do n√≠vel
                                        loadLevel();
                                        btnNext.onclick = nextLevel; // Restaura fun√ß√£o
                                        btnNext.innerText = "Pr√≥xima Bomba";
                                        btnNext.classList.add("bg-blue-600", "hover:bg-blue-500");
                                        btnNext.classList.remove(
                                            "bg-gray-600",
                                            "hover:bg-gray-500"
                                        );
                                    };
                                }
                            };
                            wires.appendChild(btn);
                        });
                    };

                    const nextLevel = () => {
                        currentLvl++;
                        currentStep = 0;
                        loadLevel();
                    };

                    btnNext.onclick = nextLevel;

                    // CSS Shake
                    if (!document.getElementById("anim-shake")) {
                        const s = document.createElement("style");
                        s.id = "anim-shake";
                        s.innerHTML = `@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } } .animate-shake { animation: shake 0.3s ease-in-out; }`;
                        container.appendChild(s);
                    }

                    loadLevel();
                },

                interactive_factor_rectangles(container) {
                    // Estado
                    const targetNumber = 12;
                    let w = 1;
                    let h = 1;
                    let foundPairs = []; // Armazena strings "3x4"

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-4">
            <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest">Arquiteto de Fatores</h3>
            <div class="bg-blue-50 text-brand-blue px-3 py-1 rounded-full text-xs font-black">Alvo: <span class="text-xl">${targetNumber}</span></div>
        </div>

        <div class="relative bg-gray-100 border-2 border-gray-300 rounded-xl mb-6 flex items-center justify-center overflow-hidden shadow-inner" style="width: 260px; height: 260px;">
            <div class="absolute inset-0 opacity-20 pointer-events-none" style="background-image: linear-gradient(#ccc 1px, transparent 1px), linear-gradient(90deg, #ccc 1px, transparent 1px); background-size: 20px 20px;"></div>
            
            <div id="user-rect" class="bg-brand-blue transition-all duration-300 shadow-lg border-2 border-white relative grid place-items-center" style="width: 20px; height: 20px;">
                <span class="text-white font-bold text-xs drop-shadow-md" id="area-label">1</span>
            </div>
        </div>

        <div class="flex gap-8 w-full justify-center mb-6">
            <div class="flex flex-col items-center">
                <label class="text-[10px] font-bold text-gray-400 uppercase mb-1">Largura</label>
                <input type="range" id="slider-w" min="1" max="12" value="1" class="w-24 h-2 bg-gray-200 rounded-lg cursor-pointer accent-brand-blue">
                <span id="val-w" class="font-mono font-bold text-brand-blue mt-1">1</span>
            </div>
            <div class="flex flex-col items-center">
                <label class="text-[10px] font-bold text-gray-400 uppercase mb-1">Altura</label>
                <input type="range" id="slider-h" min="1" max="12" value="1" class="w-24 h-2 bg-gray-200 rounded-lg cursor-pointer accent-brand-blue">
                <span id="val-h" class="font-mono font-bold text-brand-blue mt-1">1</span>
            </div>
        </div>

        <button id="btn-check-factor" class="w-full max-w-xs bg-gray-400 text-white font-bold py-3 rounded-xl shadow-sm transition-all mb-4 pointer-events-none">
            √Årea: 1 (Busque ${targetNumber})
        </button>

        <div class="w-full bg-gray-50 rounded-xl p-3 border border-gray-200 min-h-[60px]">
            <p class="text-[10px] text-gray-400 font-bold uppercase mb-2 text-center">Pares Encontrados:</p>
            <div id="found-list" class="flex flex-wrap gap-2 justify-center">
                </div>
        </div>

    </div>
    `;

                    const sliderW = container.querySelector("#slider-w");
                    const sliderH = container.querySelector("#slider-h");
                    const valW = container.querySelector("#val-w");
                    const valH = container.querySelector("#val-h");
                    const rect = container.querySelector("#user-rect");
                    const label = container.querySelector("#area-label");
                    const btn = container.querySelector("#btn-check-factor");
                    const list = container.querySelector("#found-list");

                    const update = () => {
                        w = parseInt(sliderW.value);
                        h = parseInt(sliderH.value);
                        const area = w * h;

                        valW.innerText = w;
                        valH.innerText = h;
                        label.innerText = area;

                        // Atualiza visual (20px por unidade)
                        rect.style.width = `${w * 20}px`;
                        rect.style.height = `${h * 20}px`;

                        // Configura Grid interno do ret√¢ngulo para mostrar os bloquinhos
                        rect.style.backgroundImage = `linear-gradient(white 1px, transparent 1px), linear-gradient(90deg, white 1px, transparent 1px)`;
                        rect.style.backgroundSize = `20px 20px`;

                        // L√≥gica do Bot√£o
                        if (area === targetNumber) {
                            const pairId = w > h ? `${h} x ${w}` : `${w} x ${h}`; // Normaliza 3x4 e 4x3 como o mesmo par visual? Ou consideramos diferentes?
                            // Vamos considerar 3x4 e 4x3 distintos visualmente, mas matematicamente comutativos.
                            // Para "Divisores", queremos achar os n√∫meros.
                            // Vamos salvar a string exata "3 x 4".
                            const exactPair = `${w} √ó ${h}`;

                            if (foundPairs.includes(exactPair)) {
                                btn.className =
                                    "w-full max-w-xs bg-green-100 text-green-700 font-bold py-3 rounded-xl border border-green-300 cursor-default";
                                btn.innerHTML = `<i class="fas fa-check"></i> J√° encontrou ${exactPair}!`;
                                rect.classList.remove("bg-brand-blue");
                                rect.classList.add("bg-brand-green");
                            } else {
                                btn.className =
                                    "w-full max-w-xs bg-brand-green text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all cursor-pointer animate-pulse";
                                btn.innerText = `Salvar ${exactPair}`;
                                btn.classList.remove("pointer-events-none", "bg-gray-400");
                                rect.classList.remove("bg-brand-blue");
                                rect.classList.add("bg-brand-green");

                                btn.onclick = () => {
                                    foundPairs.push(exactPair);
                                    addBadge(exactPair);
                                    btn.onclick = null;
                                    update(); // Refresh state
                                };
                            }
                        } else {
                            btn.className =
                                "w-full max-w-xs bg-gray-400 text-white font-bold py-3 rounded-xl shadow-sm transition-all pointer-events-none";
                            btn.innerText = `√Årea: ${area} (Busque ${targetNumber})`;
                            rect.classList.add("bg-brand-blue");
                            rect.classList.remove("bg-brand-green");
                        }
                    };

                    const addBadge = (text) => {
                        const badge = document.createElement("span");
                        badge.className =
                            "bg-white border border-brand-green text-brand-green px-3 py-1 rounded-lg text-xs font-bold shadow-sm animate-pop-in";
                        badge.innerText = text;
                        list.appendChild(badge);
                    };

                    sliderW.addEventListener("input", update);
                    sliderH.addEventListener("input", update);
                    update();
                },

                interactive_factor_rainbow(container) {
                    // Configura√ß√£o
                    let number = 18;
                    // Divisores de 18: 1, 2, 3, 6, 9, 18
                    // Pares: (1,18), (2,9), (3,6)

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-8">
            <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest">T√©cnica do Arco-√çris</h3>
            <div class="flex gap-2">
                <button class="num-sel-btn bg-purple-100 text-brand-purple w-8 h-8 rounded font-bold text-xs hover:bg-purple-200 transition-colors" data-n="12">12</button>
                <button class="num-sel-btn bg-gray-100 text-gray-500 w-8 h-8 rounded font-bold text-xs hover:bg-gray-200 transition-colors" data-n="18">18</button>
                <button class="num-sel-btn bg-gray-100 text-gray-500 w-8 h-8 rounded font-bold text-xs hover:bg-gray-200 transition-colors" data-n="20">20</button>
            </div>
        </div>

        <div class="relative w-full h-40 flex items-end justify-center mb-4" id="rainbow-area">
            <svg id="arcs-svg" class="absolute inset-0 w-full h-full pointer-events-none overflow-visible">
            </svg>

            <div id="numbers-row" class="flex justify-between w-full max-w-md px-4 z-10">
                </div>
        </div>

        <p class="text-center text-xs text-gray-400 italic">
            Clique nos pares (o menor e o maior) para conectar!
        </p>

    </div>
    `;

                    const svg = container.querySelector("#arcs-svg");
                    const row = container.querySelector("#numbers-row");
                    const btns = container.querySelectorAll(".num-sel-btn");

                    let selectedNums = []; // IDs dos bot√µes selecionados
                    let connectedPairs = []; // Pares j√° formados

                    const getDivisors = (n) => {
                        let divs = [];
                        for (let i = 1; i <= n; i++) if (n % i === 0) divs.push(i);
                        return divs;
                    };

                    const loadNumber = (n) => {
                        number = n;
                        selectedNums = [];
                        connectedPairs = [];
                        svg.innerHTML = "";
                        row.innerHTML = "";

                        const divisors = getDivisors(n);

                        divisors.forEach((d, idx) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "w-8 h-8 md:w-10 md:h-10 rounded-full border-2 border-gray-300 bg-white text-gray-600 font-bold hover:border-brand-purple hover:text-brand-purple transition-all active:scale-95 z-20 relative";
                            btn.innerText = d;
                            btn.dataset.val = d;
                            btn.dataset.idx = idx; // Posi√ß√£o visual

                            btn.onclick = () => handleSelect(btn, d);
                            row.appendChild(btn);
                        });
                    };

                    const handleSelect = (btn, val) => {
                        // Se j√° est√° conectado, ignora
                        if (btn.classList.contains("bg-green-100")) return;

                        // Toggle sele√ß√£o
                        if (selectedNums.includes(btn)) {
                            selectedNums = selectedNums.filter((b) => b !== btn);
                            btn.classList.remove(
                                "bg-purple-100",
                                "border-brand-purple",
                                "ring-2",
                                "ring-purple-300"
                            );
                        } else {
                            if (selectedNums.length < 2) {
                                selectedNums.push(btn);
                                btn.classList.add(
                                    "bg-purple-100",
                                    "border-brand-purple",
                                    "ring-2",
                                    "ring-purple-300"
                                );
                            }
                        }

                        // Verifica par
                        if (selectedNums.length === 2) {
                            const v1 = parseInt(selectedNums[0].dataset.val);
                            const v2 = parseInt(selectedNums[1].dataset.val);

                            if (v1 * v2 === number) {
                                // Sucesso!
                                drawArc(selectedNums[0], selectedNums[1]);
                                selectedNums.forEach((b) => {
                                    b.classList.remove(
                                        "bg-purple-100",
                                        "border-brand-purple",
                                        "ring-2",
                                        "ring-purple-300"
                                    );
                                    b.classList.add(
                                        "bg-green-100",
                                        "border-green-500",
                                        "text-green-700"
                                    );
                                });
                                selectedNums = [];
                            } else {
                                // Erro visual
                                selectedNums.forEach((b) => {
                                    b.classList.add("bg-red-100", "animate-shake");
                                    setTimeout(
                                        () => b.classList.remove("bg-red-100", "animate-shake"),
                                        500
                                    );
                                });
                            }
                        }
                    };

                    const drawArc = (el1, el2) => {
                        // Pega posi√ß√µes relativas ao container SVG
                        const rect1 = el1.getBoundingClientRect();
                        const rect2 = el2.getBoundingClientRect();
                        const svgRect = svg.getBoundingClientRect();

                        const x1 = rect1.left - svgRect.left + rect1.width / 2;
                        const x2 = rect2.left - svgRect.left + rect2.width / 2;
                        const y = svgRect.height - 10; // Base (pouco acima do fundo)

                        // Altura do arco depende da dist√¢ncia
                        const dist = Math.abs(x2 - x1);
                        const height = dist * 0.4; // Propor√ß√£o da altura

                        // Cores do arco-√≠ris
                        const colors = [
                            "#FF4B4B",
                            "#FF9600",
                            "#FFC800",
                            "#58CC02",
                            "#1CB0F6",
                            "#CE82FF",
                        ];
                        const color = colors[connectedPairs.length % colors.length];
                        connectedPairs.push(1);

                        // Path SVG (B√©zier quadr√°tica)
                        const path = document.createElementNS(
                            "http://www.w3.org/2000/svg",
                            "path"
                        );
                        const d = `M ${x1} ${y} Q ${(x1 + x2) / 2} ${y - height * 2
                            } ${x2} ${y}`;

                        path.setAttribute("d", d);
                        path.setAttribute("fill", "none");
                        path.setAttribute("stroke", color);
                        path.setAttribute("stroke-width", "4");
                        path.setAttribute("stroke-linecap", "round");
                        path.setAttribute("class", "animate-draw");

                        // Anima√ß√£o CSS para o stroke
                        path.style.strokeDasharray = "1000";
                        path.style.strokeDashoffset = "1000";
                        path.style.animation = "dash 1s linear forwards";

                        svg.appendChild(path);
                    };

                    // Listeners de Menu
                    btns.forEach((b) => {
                        b.onclick = () => {
                            btns.forEach(
                                (x) =>
                                (x.className =
                                    "num-sel-btn bg-gray-100 text-gray-500 w-8 h-8 rounded font-bold text-xs hover:bg-gray-200 transition-colors")
                            );
                            b.className =
                                "num-sel-btn bg-purple-100 text-brand-purple w-8 h-8 rounded font-bold text-xs shadow-sm ring-1 ring-purple-300 transition-colors";
                            loadNumber(parseInt(b.dataset.n));
                        };
                    });

                    // CSS para anima√ß√£o do tra√ßo
                    if (!document.getElementById("anim-dash-draw")) {
                        const s = document.createElement("style");
                        s.id = "anim-dash-draw";
                        s.innerHTML = `@keyframes dash { to { stroke-dashoffset: 0; } }`;
                        container.appendChild(s);
                    }

                    // Init
                    loadNumber(18); // Default
                    btns[1].className =
                        "num-sel-btn bg-purple-100 text-brand-purple w-8 h-8 rounded font-bold text-xs shadow-sm ring-1 ring-purple-300 transition-colors";
                },

                interactive_falling_divisors(container) {
                    const target = 12; // N√∫mero base
                    let score = 0;
                    let lives = 3;
                    let isPlaying = false;
                    let gameLoop, spawnLoop;
                    let items = []; // Objetos caindo

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[400px]">
        
        <div class="flex justify-between w-full items-center mb-2 z-20">
            <div class="text-white font-bold bg-gray-800 px-3 py-1 rounded-full text-xs">Alvo: <span class="text-brand-yellow text-xl">${target}</span></div>
            <div class="flex gap-2">
                <div class="text-white font-bold text-xs">‚ù§Ô∏è <span id="lives-disp">3</span></div>
                <div class="text-white font-bold text-xs">Pts: <span id="score-disp" class="text-green-400">0</span></div>
            </div>
        </div>

        <div id="game-area" class="absolute inset-0 top-12 z-10 cursor-crosshair">
            </div>

        <div id="overlay" class="absolute inset-0 bg-gray-900/90 z-30 flex flex-col items-center justify-center text-center p-6">
            <div class="text-5xl mb-4">‚òî</div>
            <h3 class="text-2xl font-black text-white mb-2" id="ov-title">Chuva de Divisores</h3>
            <p class="text-gray-400 text-sm mb-6" id="ov-desc">Clique APENAS nos n√∫meros que dividem ${target}.</p>
            <button id="btn-play" class="bg-brand-blue text-white font-bold py-3 px-10 rounded-full shadow-[0_0_15px_rgba(28,176,246,0.6)] animate-pulse">JOGAR</button>
        </div>

        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20 pointer-events-none z-0"></div>
    </div>
    `;

                    const gameArea = container.querySelector("#game-area");
                    const overlay = container.querySelector("#overlay");
                    const btnPlay = container.querySelector("#btn-play");
                    const scoreDisp = container.querySelector("#score-disp");
                    const livesDisp = container.querySelector("#lives-disp");
                    const ovTitle = container.querySelector("#ov-title");
                    const ovDesc = container.querySelector("#ov-desc");

                    const spawnItem = () => {
                        if (!isPlaying) return;

                        const isDivisor = Math.random() > 0.6; // 40% chance de ser divisor (mais raro)
                        let val;

                        if (isDivisor) {
                            const divisors = [1, 2, 3, 4, 6, 12];
                            val = divisors[Math.floor(Math.random() * divisors.length)];
                        } else {
                            // Gera n√£o-divisor
                            do {
                                val = Math.floor(Math.random() * 20) + 1;
                            } while ([1, 2, 3, 4, 6, 12].includes(val));
                        }

                        const el = document.createElement("div");
                        // Posi√ß√£o X aleat√≥ria (0 a 90%)
                        const left = Math.random() * 85;

                        el.className =
                            "absolute w-12 h-12 rounded-full bg-gray-800 border-2 border-gray-600 text-white flex items-center justify-center font-bold text-lg shadow-lg cursor-pointer hover:scale-110 active:scale-95 transition-transform select-none";
                        el.style.left = `${left}%`;
                        el.style.top = `-50px`;
                        el.innerText = val;

                        // Dados para l√≥gica
                        el.dataset.val = val;
                        el.dataset.y = -50;
                        el.dataset.speed = Math.random() * 1.5 + 1; // Velocidade varia

                        el.onmousedown = (e) => {
                            e.stopPropagation(); // Evita bugs
                            checkHit(el, val);
                        };
                        // Touch support
                        el.ontouchstart = (e) => {
                            e.stopPropagation();
                            checkHit(el, val);
                        };

                        gameArea.appendChild(el);
                        items.push(el);
                    };

                    const checkHit = (el, val) => {
                        if (!isPlaying || !el.parentNode) return;

                        const isCorrect = target % val === 0;

                        if (isCorrect) {
                            // Acerto
                            score += 10;
                            scoreDisp.innerText = score;
                            createExplosion(el, "green");
                            el.remove();
                            items = items.filter((i) => i !== el);
                        } else {
                            // Erro (Clicou em intruso)
                            lives--;
                            livesDisp.innerText = lives;
                            createExplosion(el, "red");
                            el.remove();
                            items = items.filter((i) => i !== el);
                            if (lives <= 0) gameOver();
                        }
                    };

                    const createExplosion = (el, color) => {
                        const rect = el.getBoundingClientRect();
                        const parentRect = gameArea.getBoundingClientRect();

                        const burst = document.createElement("div");
                        burst.className = `absolute text-2xl font-black ${color === "green" ? "text-green-400" : "text-red-500"
                            } animate-ping`;
                        burst.style.left = el.style.left;
                        burst.style.top = el.style.top;
                        burst.innerText = color === "green" ? "+10" : "-1 ‚ù§Ô∏è";

                        gameArea.appendChild(burst);
                        setTimeout(() => burst.remove(), 500);
                    };

                    const updateGame = () => {
                        if (!isPlaying) return;

                        items.forEach((el) => {
                            let y = parseFloat(el.dataset.y);
                            y += parseFloat(el.dataset.speed);
                            el.dataset.y = y;
                            el.style.top = `${y}px`;

                            // Checa se saiu da tela (Game Over se deixou passar divisor?)
                            // Vamos simplificar: Se deixar passar divisor, perde vida. Se intruso passar, ok.
                            if (y > 350) {
                                const val = parseInt(el.dataset.val);
                                const isDivisor = target % val === 0;

                                if (isDivisor) {
                                    lives--;
                                    livesDisp.innerText = lives;
                                    // Feedback visual na base
                                    const miss = document.createElement("div");
                                    miss.className =
                                        "absolute bottom-0 w-full h-1 bg-red-500 animate-pulse";
                                    gameArea.appendChild(miss);
                                    setTimeout(() => miss.remove(), 200);

                                    if (lives <= 0) gameOver();
                                }

                                el.remove();
                                items = items.filter((i) => i !== el);
                            }
                        });

                        gameLoop = requestAnimationFrame(updateGame);
                    };

                    const startGame = () => {
                        score = 0;
                        lives = 3;
                        items.forEach((i) => i.remove());
                        items = [];
                        scoreDisp.innerText = 0;
                        livesDisp.innerText = 3;

                        overlay.classList.add("hidden");
                        isPlaying = true;

                        gameLoop = requestAnimationFrame(updateGame);
                        spawnLoop = setInterval(spawnItem, 1200); // 1.2s spawn rate
                    };

                    const gameOver = () => {
                        isPlaying = false;
                        cancelAnimationFrame(gameLoop);
                        clearInterval(spawnLoop);

                        ovTitle.innerText = "Fim de Jogo!";
                        ovDesc.innerHTML = `Voc√™ fez <strong class="text-brand-green">${score}</strong> pontos.<br>Divisores capturados.`;
                        btnPlay.innerText = "TENTAR NOVAMENTE";
                        overlay.classList.remove("hidden");
                    };

                    btnPlay.onclick = startGame;
                },

                interactive_digit_sum_explorer(container) {
                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Raio-X: Soma dos D√≠gitos</h3>
        
        <input type="number" id="num-input" class="text-4xl md:text-5xl font-mono font-black text-center w-full max-w-sm border-b-4 border-brand-gray focus:border-brand-purple outline-none bg-transparent mb-8 text-brand-text transition-all placeholder-gray-200" placeholder="Digite..." value="123">

        <div id="animation-stage" class="h-24 w-full flex items-center justify-center gap-2 mb-4 text-3xl font-bold text-gray-400 relative">
            </div>

        <div id="result-box" class="opacity-0 transition-all duration-500 transform translate-y-4 flex flex-col items-center">
            <div class="text-xs font-bold text-gray-400 uppercase mb-1">Soma</div>
            <div class="text-5xl font-black text-brand-purple mb-2" id="sum-display">0</div>
            <div id="verdict" class="flex gap-2"></div>
        </div>

        <button id="btn-analyze" class="mt-6 bg-brand-purple text-white font-bold py-3 px-8 rounded-xl shadow-btn active:scale-95 transition-all w-full max-w-xs">
            Analisar
        </button>
    </div>
    `;

                    const input = container.querySelector("#num-input");
                    const stage = container.querySelector("#animation-stage");
                    const resBox = container.querySelector("#result-box");
                    const sumDisp = container.querySelector("#sum-display");
                    const verdict = container.querySelector("#verdict");
                    const btn = container.querySelector("#btn-analyze");

                    btn.onclick = async () => {
                        const val = input.value;
                        if (!val) return;

                        // Reset
                        stage.innerHTML = "";
                        resBox.classList.remove("opacity-100", "translate-y-0");
                        resBox.classList.add("opacity-0", "translate-y-4");
                        btn.disabled = true;

                        const digits = val.split("");

                        // 1. Cria elementos visuais para cada d√≠gito
                        const digitEls = digits.map((d) => {
                            const el = document.createElement("div");
                            el.className =
                                "w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center border-2 border-gray-200 shadow-sm transition-all duration-500";
                            el.innerText = d;
                            stage.appendChild(el);
                            return el;
                        });

                        // Adiciona sinais de + entre eles
                        for (let i = 0; i < digits.length - 1; i++) {
                            const plus = document.createElement("div");
                            plus.innerText = "+";
                            plus.className =
                                "text-gray-300 opacity-0 transition-opacity duration-500";
                            stage.insertBefore(plus, digitEls[i + 1]);

                            // Anima√ß√£o sequencial
                            await new Promise((r) => setTimeout(r, 200));
                            plus.classList.remove("opacity-0");
                        }

                        // 2. Anima√ß√£o de Soma (Juntar tudo)
                        await new Promise((r) => setTimeout(r, 500));

                        // Calcula Soma
                        const sum = digits.reduce((a, b) => parseInt(a) + parseInt(b), 0);

                        // Mostra Resultado
                        sumDisp.innerText = sum;
                        resBox.classList.remove("opacity-0", "translate-y-4");
                        resBox.classList.add("opacity-100", "translate-y-0");

                        // Veredito
                        const div3 = sum % 3 === 0;
                        const div9 = sum % 9 === 0;

                        verdict.innerHTML = `
            <span class="px-3 py-1 rounded text-xs font-bold ${div3 ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700"
                            }">Por 3: ${div3 ? "SIM" : "N√ÉO"}</span>
            <span class="px-3 py-1 rounded text-xs font-bold ${div9 ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700"
                            }">Por 9: ${div9 ? "SIM" : "N√ÉO"}</span>
        `;

                        btn.disabled = false;
                    };
                },

                interactive_fruit_ninja_divisibility(container) {
                    let score = 0;
                    let isPlaying = false;
                    let spawnInterval;
                    const targetDivisor = 3; // Cortar m√∫ltiplos de 3

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[400px]">
        
        <div class="flex justify-between w-full items-center mb-2 z-20">
            <div class="text-white font-bold text-xs uppercase bg-gray-800 px-3 py-1 rounded-full">Alvo: M√∫ltiplos de <span class="text-brand-yellow text-lg">${targetDivisor}</span></div>
            <div class="text-white font-black text-xl">Score: <span id="ninja-score" class="text-brand-green">0</span></div>
        </div>

        <div id="game-canvas" class="absolute inset-0 top-12 z-10 cursor-crosshair touch-none"></div>

        <div id="start-screen" class="absolute inset-0 bg-gray-900/95 z-30 flex flex-col items-center justify-center text-center p-6">
            <div class="text-6xl mb-4">üçâ</div>
            <h3 class="text-2xl font-black text-white mb-2">Math Ninja</h3>
            <p class="text-gray-400 text-sm mb-6">Corte APENAS os n√∫meros divis√≠veis por ${targetDivisor}!<br>(Soma dos algarismos = 3, 6, 9...)</p>
            <button id="btn-play-ninja" class="bg-brand-red text-white font-bold py-3 px-10 rounded-full shadow-[0_0_15px_rgba(239,68,68,0.6)] animate-pulse">JOGAR</button>
        </div>
    </div>
    `;

                    const canvas = container.querySelector("#game-canvas");
                    const scoreEl = container.querySelector("#ninja-score");
                    const startScreen = container.querySelector("#start-screen");
                    const btnPlay = container.querySelector("#btn-play-ninja");

                    const createNumber = () => {
                        if (!isPlaying) return;

                        const el = document.createElement("div");
                        const isTarget = Math.random() > 0.5;
                        let val;

                        if (isTarget) {
                            val = targetDivisor * (Math.floor(Math.random() * 30) + 1);
                        } else {
                            do {
                                val = Math.floor(Math.random() * 100) + 1;
                            } while (val % targetDivisor === 0);
                        }

                        // Estilo "Fruta"
                        el.className =
                            "absolute flex items-center justify-center w-16 h-16 rounded-full font-black text-2xl shadow-lg border-4 transition-transform select-none";
                        el.style.backgroundColor = isTarget ? "#10B981" : "#EF4444"; // Verde (alvo) ou Vermelho (isca) - mas pro aluno descobrir
                        // Na verdade, vamos deixar tudo de uma cor para for√ßar o c√°lculo, ou cores aleat√≥rias de frutas
                        const colors = ["#FFC800", "#A855F7", "#3B82F6", "#F97316"];
                        const color = colors[Math.floor(Math.random() * colors.length)];
                        el.style.backgroundColor = color;
                        el.style.borderColor = "rgba(0,0,0,0.2)";
                        el.style.color = "white";
                        el.innerText = val;

                        // F√≠sica
                        let x = Math.random() * (canvas.offsetWidth - 60);
                        let y = canvas.offsetHeight;
                        let vx = (Math.random() - 0.5) * 4;
                        let vy = -(Math.random() * 5 + 10); // Impulso para cima
                        let rot = 0;
                        let vrot = (Math.random() - 0.5) * 10;

                        el.style.left = `${x}px`;
                        el.style.top = `${y}px`;

                        // Intera√ß√£o
                        const slice = () => {
                            if (isTarget) {
                                score += 10;
                                scoreEl.innerText = score;
                                // Efeito visual corte
                                el.style.transform = `scale(1.5) rotate(${rot}deg)`;
                                el.style.opacity = 0;
                                // Part√≠culas (Simulado)
                                const splash = document.createElement("div");
                                splash.className =
                                    "absolute text-4xl animate-ping pointer-events-none";
                                splash.style.left = el.style.left;
                                splash.style.top = el.style.top;
                                splash.innerText = "‚ú®";
                                canvas.appendChild(splash);
                                setTimeout(() => splash.remove(), 500);
                            } else {
                                score = Math.max(0, score - 5);
                                scoreEl.innerText = score;
                                el.classList.add(
                                    "bg-gray-800",
                                    "border-gray-600",
                                    "text-gray-500"
                                ); // "Podre"
                            }
                            el.remove(); // Remove do DOM
                        };

                        el.onmouseenter = slice; // PC
                        el.ontouchstart = slice; // Mobile

                        canvas.appendChild(el);

                        // Loop de Anima√ß√£o do Elemento
                        const update = () => {
                            if (!isPlaying || !el.parentNode) return;
                            x += vx;
                            y += vy;
                            vy += 0.4; // Gravidade
                            rot += vrot;

                            el.style.left = `${x}px`;
                            el.style.top = `${y}px`;
                            el.style.transform = `rotate(${rot}deg)`;

                            if (y > canvas.offsetHeight + 100) {
                                el.remove();
                            } else {
                                requestAnimationFrame(update);
                            }
                        };
                        requestAnimationFrame(update);
                    };

                    btnPlay.onclick = () => {
                        startScreen.classList.add("hidden");
                        isPlaying = true;
                        score = 0;
                        scoreEl.innerText = 0;

                        spawnInterval = setInterval(createNumber, 1000); // 1 fruta por segundo

                        // Game Over ap√≥s 30s
                        setTimeout(() => {
                            isPlaying = false;
                            clearInterval(spawnInterval);
                            startScreen.classList.remove("hidden");
                            startScreen.querySelector("h3").innerText = "Tempo Esgotado!";
                            startScreen.querySelector(
                                "p"
                            ).innerText = `Pontua√ß√£o Final: ${score}`;
                        }, 30000);
                    };
                },

                interactive_rule_6_lock(container) {
                    let currentNum = 12;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Cofre do 6</h3>
        
        <div class="flex items-center gap-4 mb-6">
            <button id="btn-dec" class="w-10 h-10 rounded-full bg-gray-100 text-gray-600 font-bold hover:bg-gray-200">-</button>
            <div class="text-5xl font-black text-brand-text w-24 text-center" id="lock-num">12</div>
            <button id="btn-inc" class="w-10 h-10 rounded-full bg-gray-100 text-gray-600 font-bold hover:bg-gray-200">+</button>
        </div>

        <div class="flex gap-4 w-full justify-center mb-6">
            <div class="flex flex-col items-center gap-2 transition-all opacity-50" id="light-2">
                <div class="w-4 h-4 rounded-full bg-gray-300 shadow-inner" id="bulb-2"></div>
                <span class="text-[10px] font-bold uppercase text-gray-400">√â Par?</span>
            </div>
            <div class="flex flex-col items-center gap-2 transition-all opacity-50" id="light-3">
                <div class="w-4 h-4 rounded-full bg-gray-300 shadow-inner" id="bulb-3"></div>
                <span class="text-[10px] font-bold uppercase text-gray-400">Soma √∑ 3?</span>
            </div>
        </div>

        <div class="w-32 h-32 bg-gray-800 rounded-full flex items-center justify-center shadow-lg relative cursor-pointer transition-transform active:scale-95" id="safe-handle">
            <div class="w-24 h-24 rounded-full border-4 border-gray-600 border-dashed flex items-center justify-center">
                <i class="fas fa-lock text-4xl text-gray-400" id="lock-icon"></i>
            </div>
            <div class="absolute w-4 h-4 bg-white rounded-full top-2"></div>
        </div>
        
        <p class="mt-4 text-sm font-bold text-gray-500" id="status-msg">Trancado</p>
    </div>
    `;

                    const numDisp = container.querySelector("#lock-num");
                    const bulb2 = container.querySelector("#bulb-2");
                    const bulb3 = container.querySelector("#bulb-3");
                    const l2 = container.querySelector("#light-2");
                    const l3 = container.querySelector("#light-3");
                    const handle = container.querySelector("#safe-handle");
                    const icon = container.querySelector("#lock-icon");
                    const msg = container.querySelector("#status-msg");

                    const check = () => {
                        numDisp.innerText = currentNum;

                        // Regra 2 (Par)
                        const isPar = currentNum % 2 === 0;
                        if (isPar) {
                            bulb2.className =
                                "w-4 h-4 rounded-full bg-green-400 shadow-[0_0_10px_#4ade80]";
                            l2.classList.remove("opacity-50");
                        } else {
                            bulb2.className =
                                "w-4 h-4 rounded-full bg-gray-300 shadow-inner";
                            l2.classList.add("opacity-50");
                        }

                        // Regra 3 (Soma)
                        const sum = String(currentNum)
                            .split("")
                            .reduce((a, b) => parseInt(a) + parseInt(b), 0);
                        const isDiv3 = sum % 3 === 0;
                        if (isDiv3) {
                            bulb3.className =
                                "w-4 h-4 rounded-full bg-green-400 shadow-[0_0_10px_#4ade80]";
                            l3.classList.remove("opacity-50");
                        } else {
                            bulb3.className =
                                "w-4 h-4 rounded-full bg-gray-300 shadow-inner";
                            l3.classList.add("opacity-50");
                        }

                        // Cofre
                        if (isPar && isDiv3) {
                            handle.classList.add("border-green-500", "rotate-90"); // Gira
                            icon.className = "fas fa-lock-open text-4xl text-green-400";
                            msg.innerText = "ABERTO! (Divis√≠vel por 6)";
                            msg.className =
                                "mt-4 text-sm font-black text-brand-green uppercase";
                        } else {
                            handle.classList.remove("rotate-90");
                            icon.className = "fas fa-lock text-4xl text-gray-400";
                            msg.innerText = "Trancado";
                            msg.className = "mt-4 text-sm font-bold text-gray-500";
                        }
                    };

                    container.querySelector("#btn-dec").onclick = () => {
                        if (currentNum > 1) currentNum--;
                        check();
                    };
                    container.querySelector("#btn-inc").onclick = () => {
                        currentNum++;
                        check();
                    };

                    check();
                },

                interactive_tail_scanner(container) {
                    let num = 1248;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-4">Scanner de Final</h3>
        
        <input type="number" id="scan-input" value="${num}" class="text-center text-3xl font-mono font-bold w-full border-b-2 mb-6 outline-none focus:border-brand-orange">

        <div class="flex gap-4 w-full">
            <div class="flex-1 bg-gray-50 p-4 rounded-xl border border-gray-200 text-center relative overflow-hidden group hover:border-brand-blue cursor-pointer transition-all" id="scan-4">
                <div class="text-xs font-bold text-gray-400 uppercase mb-2">Teste do 4</div>
                <div class="text-2xl font-mono text-gray-300 tracking-widest relative z-10" id="disp-4">
                    <span class="text-brand-blue font-black bg-blue-50 px-1 rounded">48</span>
                </div>
                <div class="absolute inset-0 bg-blue-100 opacity-0 group-hover:opacity-20 transition-opacity"></div>
                <div class="mt-2 text-[10px] font-bold" id="res-4">...</div>
            </div>

            <div class="flex-1 bg-gray-50 p-4 rounded-xl border border-gray-200 text-center relative overflow-hidden group hover:border-brand-purple cursor-pointer transition-all" id="scan-8">
                <div class="text-xs font-bold text-gray-400 uppercase mb-2">Teste do 8</div>
                <div class="text-2xl font-mono text-gray-300 tracking-widest relative z-10" id="disp-8">
                    <span class="text-brand-purple font-black bg-purple-50 px-1 rounded">248</span>
                </div>
                <div class="absolute inset-0 bg-purple-100 opacity-0 group-hover:opacity-20 transition-opacity"></div>
                <div class="mt-2 text-[10px] font-bold" id="res-8">...</div>
            </div>
        </div>
    </div>
    `;

                    const input = container.querySelector("#scan-input");
                    const disp4 = container.querySelector("#disp-4");
                    const disp8 = container.querySelector("#disp-8");
                    const res4 = container.querySelector("#res-4");
                    const res8 = container.querySelector("#res-8");

                    const update = () => {
                        const val = input.value;
                        if (val.length < 2) return;

                        // L√≥gica do 4 (√∫ltimos 2)
                        const tail2 = val.slice(-2);
                        const head2 = val.slice(0, -2);
                        disp4.innerHTML = `${head2}<span class="text-brand-blue font-black bg-blue-50 px-1 rounded border border-blue-200">${tail2}</span>`;

                        if (parseInt(tail2) % 4 === 0) {
                            res4.innerHTML = `<span class="text-brand-green">SIM! ${tail2} √∑ 4 = ${parseInt(tail2) / 4
                                }</span>`;
                        } else {
                            res4.innerHTML = `<span class="text-brand-red">N√ÉO.</span>`;
                        }

                        // L√≥gica do 8 (√∫ltimos 3)
                        const tail3 = val.slice(-3);
                        const head3 = val.slice(0, -3);
                        // Se n√∫mero for pequeno, adapta
                        const displayTail3 = val.length < 3 ? val : tail3;
                        const displayHead3 = val.length < 3 ? "" : head3;

                        disp8.innerHTML = `${displayHead3}<span class="text-brand-purple font-black bg-purple-50 px-1 rounded border border-purple-200">${displayTail3}</span>`;

                        if (parseInt(displayTail3) % 8 === 0) {
                            res8.innerHTML = `<span class="text-brand-green">SIM! ${displayTail3} √∑ 8 = ${parseInt(displayTail3) / 8
                                }</span>`;
                        } else {
                            res8.innerHTML = `<span class="text-brand-red">N√ÉO.</span>`;
                        }
                    };

                    input.addEventListener("input", update);
                    update();
                },

                interactive_factory_sorter(container) {
                    // Estado
                    const boxes = [
                        { val: 16, types: [4, 8] },
                        { val: 24, types: [4, 6, 8] },
                        { val: 18, types: [6] },
                        { val: 32, types: [4, 8] },
                        { val: 30, types: [6] },
                        { val: 100, types: [4] },
                    ];
                    let currentBox = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-300 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="w-full flex justify-between text-xs font-bold text-gray-500 mb-4">
            <span>F√ÅBRICA DE DIVIS√ÉO</span>
            <span>SCORE: <span id="factory-score" class="text-brand-blue text-lg">0</span></span>
        </div>

        <div class="relative w-full h-24 bg-gray-300 border-y-4 border-gray-400 mb-4 flex items-center justify-center overflow-hidden">
            <div class="absolute inset-0 opacity-20" style="background: repeating-linear-gradient(90deg, transparent, transparent 20px, #000 20px, #000 22px);"></div>
            
            <div id="box" class="w-16 h-16 bg-brand-orange border-b-4 border-orange-700 rounded shadow-lg flex items-center justify-center text-white font-black text-2xl relative z-10 transition-all duration-500">
                ${boxes[0].val}
            </div>
        </div>

        <p class="text-center text-xs text-gray-500 font-bold mb-2">Para qual caminh√£o vai?</p>

        <div class="grid grid-cols-3 gap-2 w-full">
            <button class="truck-btn bg-blue-100 border-b-4 border-blue-300 text-blue-700 py-3 rounded-lg font-black text-sm hover:bg-blue-200 active:translate-y-1 transition-all" data-div="4">
                üöõ 4
            </button>
            <button class="truck-btn bg-yellow-100 border-b-4 border-yellow-300 text-yellow-700 py-3 rounded-lg font-black text-sm hover:bg-yellow-200 active:translate-y-1 transition-all" data-div="6">
                üöõ 6
            </button>
            <button class="truck-btn bg-purple-100 border-b-4 border-purple-300 text-purple-700 py-3 rounded-lg font-black text-sm hover:bg-purple-200 active:translate-y-1 transition-all" data-div="8">
                üöõ 8
            </button>
        </div>
        
        <div id="factory-feedback" class="h-6 mt-2 text-xs font-bold text-center"></div>

    </div>
    `;

                    const boxEl = container.querySelector("#box");
                    const scoreEl = container.querySelector("#factory-score");
                    const btns = container.querySelectorAll(".truck-btn");
                    const feedback = container.querySelector("#factory-feedback");

                    const nextBox = () => {
                        currentBox = (currentBox + 1) % boxes.length; // Loop infinito
                        const b = boxes[currentBox];

                        // Anima√ß√£o de entrada (direita para esquerda)
                        boxEl.style.transform = "translateX(200%)";
                        boxEl.innerText = b.val;

                        setTimeout(() => {
                            boxEl.style.transform = "translateX(0)";
                        }, 50);
                    };

                    const check = (div) => {
                        const b = boxes[currentBox];
                        const isCorrect = b.types.includes(parseInt(div));

                        if (isCorrect) {
                            score += 10;
                            scoreEl.innerText = score;
                            feedback.innerHTML = `<span class="text-brand-green">Boa! ${b.val} divide por ${div}.</span>`;

                            // Anima√ß√£o de sa√≠da (cai no caminh√£o)
                            boxEl.style.transform = "translateY(100px) scale(0)";
                            setTimeout(nextBox, 500);
                        } else {
                            score = Math.max(0, score - 5);
                            scoreEl.innerText = score;
                            feedback.innerHTML = `<span class="text-brand-red">Erro! ${b.val} n√£o divide por ${div}.</span>`;
                            boxEl.classList.add("animate-shake");
                            setTimeout(() => boxEl.classList.remove("animate-shake"), 500);
                        }
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => check(btn.dataset.div);
                    });
                },

                interactive_factor_tree(container) {
                    let rootNum = 24;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-auto">
        <h3 class="text-brand-green font-bold uppercase text-xs tracking-widest mb-6">√Årvore de Fatores</h3>
        
        <div id="tree-canvas" class="flex flex-col items-center min-h-[200px] w-full">
            </div>

        <button id="btn-reset-tree" class="mt-4 text-xs text-gray-400 font-bold underline">Reiniciar com outro n√∫mero</button>
    </div>
    `;

                    const canvas = container.querySelector("#tree-canvas");
                    const btnReset = container.querySelector("#btn-reset-tree");

                    // Fun√ß√£o Recursiva para criar n√≥
                    const createNode = (n, parent) => {
                        const node = document.createElement("div");
                        node.className =
                            "flex flex-col items-center animate-pop-in relative";

                        // O valor
                        const bubble = document.createElement("button");
                        const isPrime = checkPrime(n);

                        bubble.className = `w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg border-2 shadow-sm transition-all z-10 ${isPrime
                            ? "bg-brand-green text-white border-green-600"
                            : "bg-white text-gray-700 border-gray-300 hover:border-brand-blue"
                            }`;
                        bubble.innerText = n;

                        if (!isPrime) {
                            bubble.onclick = () => splitNode(n, node, bubble);
                            // Dica visual
                            const hint = document.createElement("span");
                            hint.className =
                                "absolute -top-4 text-[10px] text-gray-400 bg-white px-1 opacity-0 hover:opacity-100 transition-opacity pointer-events-none";
                            hint.innerText = "Clique para quebrar";
                            node.appendChild(hint);
                        }

                        node.appendChild(bubble);
                        parent.appendChild(node);
                    };

                    const checkPrime = (num) => {
                        for (let i = 2, s = Math.sqrt(num); i <= s; i++)
                            if (num % i === 0) return false;
                        return num > 1;
                    };

                    const splitNode = (n, containerEl, btnEl) => {
                        // Acha fatores (o primeiro par poss√≠vel para simplificar)
                        let f1 = 0,
                            f2 = 0;
                        for (let i = 2; i < n; i++) {
                            if (n % i === 0) {
                                f1 = i;
                                f2 = n / i;
                                break;
                            }
                        }

                        // Desabilita bot√£o pai
                        btnEl.disabled = true;
                        btnEl.classList.add("bg-gray-100", "text-gray-400");

                        // Cria container para os filhos (galhos)
                        const branches = document.createElement("div");
                        branches.className =
                            "flex gap-8 mt-4 border-t-2 border-gray-300 pt-4 relative";

                        // Linhas decorativas (SVG ou CSS pseudo seriam melhores, mas vamos simples)

                        createNode(f1, branches);
                        createNode(f2, branches);

                        containerEl.appendChild(branches);
                    };

                    // Init
                    createNode(rootNum, canvas);

                    btnReset.onclick = () => {
                        canvas.innerHTML = "";
                        rootNum = rootNum === 24 ? 36 : 24; // Alterna exemplo
                        createNode(rootNum, canvas);
                    };
                },

                interactive_mmc_visualizer(container) {
                    let n1 = 4;
                    let n2 = 6;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Corrida dos M√∫ltiplos</h3>

        <div class="flex gap-4 mb-6">
            <div class="flex flex-col items-center">
                <label class="text-[10px] font-bold text-brand-blue uppercase">Saltos Azul</label>
                <input type="number" id="in-n1" value="4" min="2" max="10" class="w-16 text-center border-2 border-brand-blue rounded-lg font-bold text-xl text-brand-blue outline-none">
            </div>
            <div class="flex flex-col items-center">
                <label class="text-[10px] font-bold text-brand-orange uppercase">Saltos Laranja</label>
                <input type="number" id="in-n2" value="6" min="2" max="10" class="w-16 text-center border-2 border-brand-orange rounded-lg font-bold text-xl text-brand-orange outline-none">
            </div>
        </div>

        <div class="w-full overflow-x-auto pb-4 custom-scrollbar">
            <div class="relative min-w-[600px] h-32 pt-10" id="track-container">
                
                <div class="absolute top-1/2 left-0 w-full h-1 bg-gray-200 rounded-full"></div>
                <div id="ticks" class="absolute inset-0"></div>

                <svg id="paths-svg" class="absolute inset-0 w-full h-full pointer-events-none" style="overflow: visible;">
                    <path id="path-1" fill="none" stroke="#1CB0F6" stroke-width="3" stroke-linecap="round" class="opacity-70" />
                    <path id="path-2" fill="none" stroke="#FF9600" stroke-width="3" stroke-linecap="round" class="opacity-70" />
                </svg>

                <div id="markers-container" class="absolute inset-0"></div>
            </div>
        </div>

        <div class="mt-4 text-center">
            <p class="text-xs text-gray-400 font-bold uppercase">Primeiro Encontro (MMC)</p>
            <div class="text-4xl font-black text-brand-green animate-pop-in" id="mmc-result">12</div>
        </div>

    </div>
    `;

                    const in1 = container.querySelector("#in-n1");
                    const in2 = container.querySelector("#in-n2");
                    const svg = container.querySelector("#paths-svg");
                    const path1 = container.querySelector("#path-1");
                    const path2 = container.querySelector("#path-2");
                    const ticks = container.querySelector("#ticks");
                    const markers = container.querySelector("#markers-container");
                    const resEl = container.querySelector("#mmc-result");

                    const gcd = (a, b) => (b === 0 ? a : gcd(b, a % b));
                    const lcm = (a, b) => (a * b) / gcd(a, b);

                    const draw = () => {
                        n1 = parseInt(in1.value) || 2;
                        n2 = parseInt(in2.value) || 2;

                        // Limita visualiza√ß√£o
                        const mmcVal = lcm(n1, n2);
                        const limit = Math.min(Math.max(mmcVal * 1.5, 20), 50); // Mostra um pouco al√©m do MMC

                        const unit = 40; // px por unidade

                        // Desenha R√©gua
                        let ticksHTML = "";
                        for (let i = 0; i <= limit; i++) {
                            ticksHTML += `
                <div class="absolute top-1/2" style="left: ${i * unit
                                }px; transform: translateX(-50%);">
                    <div class="w-0.5 h-3 bg-gray-300 mx-auto"></div>
                    <span class="text-[10px] text-gray-400 font-bold block text-center mt-1">${i}</span>
                </div>
            `;
                        }
                        ticks.innerHTML = ticksHTML;

                        // Container Width
                        container.querySelector("#track-container").style.width = `${(limit + 1) * unit
                            }px`;

                        // Gera Paths (Arcos)
                        const genPath = (step, yOffset, direction) => {
                            let d = `M 0 ${64 + yOffset}`; // Meio (64) + offset
                            for (let i = step; i <= limit; i += step) {
                                const startX = (i - step) * unit;
                                const endX = i * unit;
                                const midX = (startX + endX) / 2;
                                // Altura do arco proporcional ao passo
                                const arcH = Math.min(step * 10, 40) * direction;
                                d += ` Q ${midX} ${64 + yOffset + arcH} ${endX} ${64 + yOffset
                                    }`;
                            }
                            return d;
                        };

                        path1.setAttribute("d", genPath(n1, -5, -1)); // Pula por cima
                        path2.setAttribute("d", genPath(n2, 5, 1)); // Pula por baixo

                        // Marcadores de Encontro
                        markers.innerHTML = "";
                        for (let i = mmcVal; i <= limit; i += mmcVal) {
                            const mark = document.createElement("div");
                            mark.className =
                                "absolute top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-brand-green border-4 border-white shadow-lg flex items-center justify-center text-white font-black text-xs z-10 animate-bounce";
                            mark.style.left = `${i * unit}px`;
                            mark.style.transform = "translate(-50%, -50%)";
                            mark.innerText = "‚òÖ";
                            markers.appendChild(mark);
                        }

                        resEl.innerText = mmcVal;
                    };

                    in1.addEventListener("input", draw);
                    in2.addEventListener("input", draw);

                    // Pequeno delay para renderizar SVG corretamente
                    setTimeout(draw, 100);
                },

                interactive_mmc_decomposition_tool(container) {
                    let nums = [12, 18];
                    let rows = []; // { values: [12, 18], divisor: 2 }

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">M√©todo Pr√°tico</h3>

        <div class="flex gap-2 mb-6 items-center">
            <span class="text-sm font-bold text-gray-500">MMC de:</span>
            <input type="number" id="start-n1" value="12" class="w-14 text-center border-2 border-gray-200 rounded-lg p-1 font-bold text-brand-text outline-none focus:border-brand-purple">
            <span class="text-gray-300">e</span>
            <input type="number" id="start-n2" value="18" class="w-14 text-center border-2 border-gray-200 rounded-lg p-1 font-bold text-brand-text outline-none focus:border-brand-purple">
            <button id="btn-start" class="bg-brand-purple text-white px-4 py-1 rounded-lg font-bold text-sm shadow-sm hover:bg-purple-600 ml-2">Iniciar</button>
        </div>

        <div class="flex relative mb-4 font-mono text-lg md:text-xl">
            <div class="flex flex-col items-end pr-4 border-r-2 border-brand-text gap-2" id="col-left">
                </div>
            <div class="flex flex-col items-start pl-4 gap-2" id="col-right">
                </div>
        </div>

        <div class="flex flex-col items-center w-full max-w-xs gap-3" id="controls-area">
            <p class="text-xs text-gray-500 font-bold" id="step-msg">Dividir por qual primo?</p>
            <div class="flex gap-2">
                <button class="prime-btn bg-blue-50 text-brand-blue border border-blue-200 px-3 py-2 rounded-lg font-bold hover:bg-blue-100 transition-all shadow-sm" data-p="2">2</button>
                <button class="prime-btn bg-blue-50 text-brand-blue border border-blue-200 px-3 py-2 rounded-lg font-bold hover:bg-blue-100 transition-all shadow-sm" data-p="3">3</button>
                <button class="prime-btn bg-blue-50 text-brand-blue border border-blue-200 px-3 py-2 rounded-lg font-bold hover:bg-blue-100 transition-all shadow-sm" data-p="5">5</button>
                <button class="prime-btn bg-blue-50 text-brand-blue border border-blue-200 px-3 py-2 rounded-lg font-bold hover:bg-blue-100 transition-all shadow-sm" data-p="7">7</button>
            </div>
        </div>

        <div id="final-res" class="hidden mt-4 text-center animate-pop-in bg-green-50 p-4 rounded-xl border border-green-200 w-full">
            <p class="text-xs font-bold text-green-700 uppercase mb-1">Multiplique tudo:</p>
            <div class="text-xl font-mono text-brand-green font-bold" id="mult-str">2 x 2 x 3 x 3 = 36</div>
        </div>

    </div>
    `;

                    const colLeft = container.querySelector("#col-left");
                    const colRight = container.querySelector("#col-right");
                    const controls = container.querySelector("#controls-area");
                    const stepMsg = container.querySelector("#step-msg");
                    const finalRes = container.querySelector("#final-res");
                    const multStr = container.querySelector("#mult-str");
                    const btnStart = container.querySelector("#btn-start");
                    const primeBtns = container.querySelectorAll(".prime-btn");

                    let currentVals = [];
                    let divisors = [];

                    const renderRow = (vals, div = null) => {
                        const rowL = document.createElement("div");
                        rowL.className = "h-8 flex items-center";
                        rowL.innerHTML = `<span class="${vals[0] === 1 ? "text-green-500" : "text-brand-text"
                            }">${vals[0]}</span>, <span class="${vals[1] === 1 ? "text-green-500" : "text-brand-text"
                            }">${vals[1]}</span>`;
                        colLeft.appendChild(rowL);

                        const rowR = document.createElement("div");
                        rowR.className =
                            "h-8 flex items-center text-brand-purple font-bold";
                        if (div) rowR.innerText = div;
                        colRight.appendChild(rowR);
                    };

                    const checkStep = (p) => {
                        const v1 = currentVals[0];
                        const v2 = currentVals[1];

                        // Verifica se P divide algu√©m
                        if (v1 % p !== 0 && v2 % p !== 0) {
                            stepMsg.innerHTML = `<span class="text-red-500">O primo ${p} n√£o divide ${v1} nem ${v2}! Tente outro.</span>`;
                            return;
                        }

                        // Adiciona divisor visual
                        // O ultimo elemento da colRight est√° vazio? N√£o, criamos um novo para o divisor
                        // Na verdade, o divisor fica na linha ATUAL.
                        // Vamos limpar e redesenhar tudo √© mais f√°cil ou append.

                        // Adiciona o divisor na linha atual (que j√° foi desenhada sem divisor)
                        colRight.lastElementChild.innerText = p;
                        colRight.lastElementChild.classList.add("animate-pop-in");
                        divisors.push(p);

                        // Calcula pr√≥xima linha
                        const nextV1 = v1 % p === 0 ? v1 / p : v1;
                        const nextV2 = v2 % p === 0 ? v2 / p : v2;
                        currentVals = [nextV1, nextV2];

                        // Desenha nova linha
                        renderRow(currentVals);

                        stepMsg.innerText = "Dividir por qual primo?";
                        stepMsg.className = "text-xs text-gray-500 font-bold";

                        // Verifica Fim
                        if (nextV1 === 1 && nextV2 === 1) {
                            finish();
                        } else {
                            // Scroll suave se precisar
                            // container.scrollIntoView({ behavior: 'smooth', block: 'end' });
                        }
                    };

                    const finish = () => {
                        controls.classList.add("hidden");
                        finalRes.classList.remove("hidden");

                        const total = divisors.reduce((a, b) => a * b, 1);
                        multStr.innerHTML = `${divisors.join(
                            " √ó "
                        )} = <strong class="text-3xl">${total}</strong>`;

                        // Adiciona linha final na direita
                        colRight.lastElementChild.innerHTML =
                            '<span class="text-gray-300">Stop</span>';
                    };

                    const start = () => {
                        const n1 = parseInt(container.querySelector("#start-n1").value);
                        const n2 = parseInt(container.querySelector("#start-n2").value);

                        currentVals = [n1, n2];
                        divisors = [];

                        colLeft.innerHTML = "";
                        colRight.innerHTML = "";
                        finalRes.classList.add("hidden");
                        controls.classList.remove("hidden");
                        stepMsg.innerText = "Dividir por qual primo?";

                        renderRow(currentVals);
                    };

                    primeBtns.forEach((btn) => {
                        btn.onclick = () => checkStep(parseInt(btn.dataset.p));
                    });

                    btnStart.onclick = start;

                    // Init Visual
                    renderRow([12, 18]);
                },

                interactive_mmc_scheduler(container) {
                    const problems = [
                        {
                            name: "Gripe",
                            drugs: [
                                { n: "A", t: 4 },
                                { n: "B", t: 6 },
                            ],
                            ans: 12,
                        },
                        {
                            name: "Infec√ß√£o",
                            drugs: [
                                { n: "X", t: 6 },
                                { n: "Y", t: 8 },
                            ],
                            ans: 24,
                        },
                        {
                            name: "Vitamina",
                            drugs: [
                                { n: "C", t: 3 },
                                { n: "D", t: 5 },
                            ],
                            ans: 15,
                        },
                        {
                            name: "Complexo",
                            drugs: [
                                { n: "K", t: 4 },
                                { n: "L", t: 10 },
                            ],
                            ans: 20,
                        },
                    ];
                    let currentP = 0;

                    container.innerHTML = `
    <div class="bg-blue-50 border-2 border-brand-blue rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <div class="flex items-center gap-2 mb-4">
            <span class="text-3xl bg-white p-2 rounded-full shadow-sm">üë©‚Äç‚öïÔ∏è</span>
            <div>
                <h3 class="text-brand-blue font-black uppercase text-xs tracking-widest">Enfermaria</h3>
                <p class="text-xs text-gray-500 font-bold" id="patient-name">Caso: Gripe</p>
            </div>
        </div>

        <div class="w-full max-w-sm bg-white rounded-xl p-4 shadow-sm mb-6 border border-blue-100">
            <p class="text-center text-sm font-bold text-gray-600 mb-4">O paciente tomou os dois rem√©dios agora (0h).</p>
            
            <div class="flex justify-around items-center" id="pills-container">
                </div>
        </div>

        <div class="text-center mb-4">
            <p class="text-xs font-bold text-brand-text mb-2 uppercase">Daqui a quantas horas tomarei juntos de novo?</p>
            <div class="flex gap-2 justify-center" id="options-container">
                </div>
        </div>

        <div id="nurse-feedback" class="h-10 flex items-center justify-center font-bold text-sm w-full"></div>

    </div>
    `;

                    const pName = container.querySelector("#patient-name");
                    const pContainer = container.querySelector("#pills-container");
                    const optContainer = container.querySelector("#options-container");
                    const feedback = container.querySelector("#nurse-feedback");

                    const loadLevel = () => {
                        if (currentP >= problems.length) {
                            container.innerHTML = `
                <div class="bg-green-100 border-4 border-green-400 rounded-xl p-8 text-center w-full">
                    <div class="text-6xl mb-4">üè•</div>
                    <h3 class="text-2xl font-black text-brand-green">Plant√£o Conclu√≠do!</h3>
                    <p class="text-green-800 font-bold mt-2">Todos os pacientes medicados corretamente.</p>
                    <button onclick="app.renderLesson(document.getElementById('main-container'), app.currentLessonName)" class="mt-6 bg-white text-green-700 font-bold py-2 px-6 rounded-lg shadow-sm hover:bg-green-50">Reiniciar</button>
                </div>
            `;
                            return;
                        }

                        const prob = problems[currentP];
                        pName.innerText = `Caso: ${prob.name}`;

                        // Render Pills
                        pContainer.innerHTML = prob.drugs
                            .map(
                                (d) => `
            <div class="flex flex-col items-center gap-1 animate-pop-in">
                <div class="w-12 h-6 bg-${d.n === prob.drugs[0].n ? "red" : "blue"
                                    }-400 rounded-full shadow-sm"></div>
                <span class="text-xs font-bold text-gray-500">A cada ${d.t
                                    }h</span>
            </div>
        `
                            )
                            .join('<span class="text-2xl text-gray-300">+</span>');

                        // Render Options (1 Certa + 2 Erradas)
                        // Erros comuns: Soma (4+6=10), Produto (4x6=24 - as vezes √© mmc, as vezes n√£o), MDC (2)
                        const correct = prob.ans;
                        let opts = [correct];

                        const sum = prob.drugs[0].t + prob.drugs[1].t;
                        const prod = prob.drugs[0].t * prob.drugs[1].t;

                        if (sum !== correct) opts.push(sum);
                        if (prod !== correct && !opts.includes(prod)) opts.push(prod);

                        // Se faltar, completa com aleat√≥rio
                        while (opts.length < 3) {
                            const r = correct + Math.floor(Math.random() * 5) + 1;
                            if (!opts.includes(r)) opts.push(r);
                        }
                        opts.sort((a, b) => a - b);

                        optContainer.innerHTML = "";
                        opts.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-white border-2 border-brand-blue text-brand-blue font-bold py-3 px-4 rounded-xl hover:bg-blue-50 active:scale-95 transition-all shadow-sm min-w-[60px]";
                            btn.innerText = `${opt}h`;
                            btn.onclick = () => check(opt, btn);
                            optContainer.appendChild(btn);
                        });
                    };

                    const check = (val, btn) => {
                        const correct = problems[currentP].ans;
                        Array.from(optContainer.children).forEach(
                            (b) => (b.disabled = true)
                        );

                        if (val === correct) {
                            btn.classList.remove(
                                "bg-white",
                                "border-brand-blue",
                                "text-brand-blue"
                            );
                            btn.classList.add(
                                "bg-brand-green",
                                "border-green-600",
                                "text-white",
                                "transform",
                                "scale-110"
                            );
                            feedback.innerHTML = `<span class="text-brand-green bg-white px-3 py-1 rounded-full shadow-sm">Correto! MMC de ${problems[currentP].drugs[0].t} e ${problems[currentP].drugs[1].t} √© ${correct}.</span>`;

                            setTimeout(() => {
                                currentP++;
                                feedback.innerText = "";
                                loadLevel();
                            }, 1500);
                        } else {
                            btn.classList.add(
                                "bg-red-100",
                                "border-red-400",
                                "text-red-600",
                                "animate-shake"
                            );
                            feedback.innerHTML = `<span class="text-brand-red">Errado! O rel√≥gio n√£o vai bater.</span>`;

                            setTimeout(() => {
                                feedback.innerText = "";
                                Array.from(optContainer.children).forEach((b) => {
                                    b.disabled = false;
                                    b.classList.remove(
                                        "bg-red-100",
                                        "border-red-400",
                                        "text-red-600",
                                        "animate-shake"
                                    );
                                });
                            }, 1000);
                        }
                    };

                    loadLevel();
                },

                interactive_prime_climber(container) {
                    // Estado
                    const target = 60;
                    let current = target;
                    let factors = [];

                    // Primos dispon√≠veis para escolha
                    const primes = [2, 3, 5, 7];

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Escada de Fatores</h3>

        <div class="flex gap-8 w-full justify-center mb-6">
            
            <div class="flex relative">
                <div class="absolute left-1/2 top-0 bottom-0 w-1 bg-gray-300 -translate-x-1/2 rounded"></div>

                <div class="flex flex-col items-end pr-6 gap-2" id="col-left">
                    <div class="text-2xl font-black text-brand-text h-10 flex items-center">${current}</div>
                </div>

                <div class="flex flex-col items-start pl-6 gap-2" id="col-right">
                    </div>
            </div>

        </div>

        <div class="bg-purple-50 p-4 rounded-xl border border-purple-200 w-full max-w-xs text-center mb-4">
            <p class="text-xs font-bold text-gray-500 uppercase mb-2">Dividir por qual primo?</p>
            <div class="flex gap-2 justify-center">
                ${primes
                            .map(
                                (p) =>
                                    `<button class="prime-btn w-10 h-10 rounded-full bg-white border-2 border-brand-purple text-brand-purple font-black shadow-sm hover:bg-purple-600 hover:text-white transition-all active:scale-95" data-p="${p}">${p}</button>`
                            )
                            .join("")}
            </div>
            <p id="climber-feedback" class="text-xs font-bold text-red-500 mt-2 h-4"></p>
        </div>

        <div id="final-result" class="hidden text-center animate-pop-in">
            <p class="text-xs font-bold text-gray-400 uppercase">Fatora√ß√£o Completa</p>
            <div class="text-xl font-mono font-bold text-brand-green mt-1" id="factor-string"></div>
            <button id="btn-reset-climber" class="mt-4 text-xs font-bold text-brand-blue hover:underline">Reiniciar</button>
        </div>

    </div>
    `;

                    const colLeft = container.querySelector("#col-left");
                    const colRight = container.querySelector("#col-right");
                    const feedback = container.querySelector("#climber-feedback");
                    const finalRes = container.querySelector("#final-result");
                    const factorString = container.querySelector("#factor-string");
                    const btnReset = container.querySelector("#btn-reset-climber");
                    const btns = container.querySelectorAll(".prime-btn");

                    const addStep = (p) => {
                        // Verifica divisibilidade
                        if (current % p !== 0) {
                            feedback.innerText = `Ops! ${current} n√£o divide por ${p}.`;
                            return;
                        }

                        feedback.innerText = "";

                        // Adiciona visualmente o fator na direita (na altura atual)
                        const factorDiv = document.createElement("div");
                        factorDiv.className =
                            "text-2xl font-black text-brand-purple h-10 flex items-center animate-slide-left";
                        factorDiv.innerText = p;
                        colRight.appendChild(factorDiv);

                        // Calcula pr√≥ximo n√∫mero
                        current = current / p;
                        factors.push(p);

                        // Adiciona novo n√∫mero na esquerda (abaixo)
                        const numDiv = document.createElement("div");
                        numDiv.className =
                            "text-2xl font-black text-brand-text h-10 flex items-center animate-slide-up";
                        numDiv.innerText = current;
                        colLeft.appendChild(numDiv);

                        // Verifica Fim
                        if (current === 1) {
                            endGame();
                        }
                    };

                    const endGame = () => {
                        // Desabilita bot√µes
                        btns.forEach((b) => (b.disabled = true));

                        // Formata string final (2¬≤ x 3 x 5)
                        // Agrupa
                        const counts = {};
                        factors.forEach((x) => {
                            counts[x] = (counts[x] || 0) + 1;
                        });
                        const str = Object.keys(counts)
                            .map((k) => {
                                return counts[k] > 1 ? `${k}<sup>${counts[k]}</sup>` : k;
                            })
                            .join(" √ó ");

                        factorString.innerHTML = `${target} = ${str}`;
                        finalRes.classList.remove("hidden");
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => addStep(parseInt(btn.dataset.p));
                    });

                    btnReset.onclick = () => {
                        // Reset simples recriando o widget ou limpando o estado
                        app.widgets.interactive_prime_climber(container);
                    };
                },

                interactive_dna_scanner(container) {
                    let currentTarget = 0;
                    let currentVal = 0;
                    let score = 0;
                    let timeLeft = 30;
                    let timer = null;
                    let isPlaying = false;

                    // Primos para o teclado
                    const primes = [2, 3, 5, 7, 11];

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full text-white mb-4 z-10">
            <div class="font-mono text-brand-green">DNA SCANNER v1.0</div>
            <div class="bg-gray-800 px-3 py-1 rounded text-xs font-bold text-yellow-400">PTS: <span id="dna-score">0</span></div>
        </div>

        <div class="relative w-48 h-48 bg-black rounded-full border-4 border-green-500/50 shadow-[0_0_30px_rgba(34,197,94,0.2)] flex items-center justify-center mb-6 z-10 overflow-hidden">
            <div class="absolute inset-0 bg-[linear-gradient(0deg,transparent_24%,rgba(0,255,0,.1)_25%,rgba(0,255,0,.1)_26%,transparent_27%,transparent_74%,rgba(0,255,0,.1)_75%,rgba(0,255,0,.1)_76%,transparent_77%,transparent),linear-gradient(90deg,transparent_24%,rgba(0,255,0,.1)_25%,rgba(0,255,0,.1)_26%,transparent_27%,transparent_74%,rgba(0,255,0,.1)_75%,rgba(0,255,0,.1)_76%,transparent_77%,transparent)] bg-[length:30px_30px]"></div>
            <div class="absolute w-full h-1 bg-green-500/50 top-1/2 animate-scan"></div>
            
            <div class="text-6xl font-mono font-black text-white z-20 transition-all" id="dna-target">?</div>
        </div>

        <p class="text-xs text-gray-400 mb-2 uppercase font-bold z-10">Extraia os componentes:</p>
        <div class="flex gap-3 z-10" id="dna-controls">
            ${primes
                            .map(
                                (p) =>
                                    `<button class="dna-btn w-12 h-12 rounded-lg bg-gray-700 border-b-4 border-gray-900 text-white font-black text-xl hover:bg-gray-600 active:border-b-0 active:translate-y-1 transition-all" data-p="${p}">${p}</button>`
                            )
                            .join("")}
        </div>

        <div class="absolute bottom-0 left-0 h-2 bg-brand-red w-full z-10 transition-all duration-1000 ease-linear" id="dna-timer" style="width: 100%"></div>

        <div id="dna-overlay" class="absolute inset-0 bg-gray-900/95 z-30 flex flex-col items-center justify-center text-center p-6">
            <div class="text-6xl mb-4">üß¨</div>
            <h3 class="text-2xl font-black text-white mb-2">Descodifique o N√∫mero</h3>
            <p class="text-gray-400 text-sm mb-6">Divida o n√∫mero pelos primos corretos at√© chegar em 1. Seja r√°pido!</p>
            <button id="btn-start-dna" class="bg-brand-green text-white font-bold py-3 px-10 rounded-full shadow-[0_0_15px_rgba(34,197,94,0.6)] animate-pulse">INICIAR AN√ÅLISE</button>
        </div>

    </div>
    `;

                    const targetDisp = container.querySelector("#dna-target");
                    const scoreEl = container.querySelector("#dna-score");
                    const timerBar = container.querySelector("#dna-timer");
                    const overlay = container.querySelector("#dna-overlay");
                    const startBtn = container.querySelector("#btn-start-dna");
                    const btns = container.querySelectorAll(".dna-btn");

                    // Gera n√∫meros compostos f√°ceis (produto de primos pequenos)
                    const generateTarget = () => {
                        // Gera 2 a 4 fatores aleat√≥rios da lista [2, 2, 3, 3, 5]
                        const factors = [];
                        const possible = [2, 2, 2, 3, 3, 5, 5, 7];
                        const count = Math.floor(Math.random() * 3) + 2; // 2 a 4 fatores

                        for (let i = 0; i < count; i++) {
                            factors.push(
                                possible[Math.floor(Math.random() * possible.length)]
                            );
                        }

                        const num = factors.reduce((a, b) => a * b, 1);
                        if (num > 100) return generateTarget(); // Tenta de novo se for muito grande
                        return num;
                    };

                    const nextRound = () => {
                        currentTarget = generateTarget();
                        currentVal = currentTarget;
                        targetDisp.innerText = currentVal;
                        targetDisp.classList.remove("text-brand-green");
                        targetDisp.classList.add("text-white");
                    };

                    const hit = (p) => {
                        if (!isPlaying) return;

                        if (currentVal % p === 0) {
                            // Acerto
                            currentVal = currentVal / p;

                            // Anima√ß√£o de Sucesso
                            targetDisp.classList.add("scale-125", "text-green-400");
                            setTimeout(
                                () =>
                                    targetDisp.classList.remove("scale-125", "text-green-400"),
                                100
                            );

                            if (currentVal === 1) {
                                // Completou o n√∫mero
                                score += 50;
                                scoreEl.innerText = score;
                                timeLeft += 5; // B√¥nus de tempo
                                nextRound();
                            } else {
                                targetDisp.innerText = currentVal;
                                score += 10;
                                scoreEl.innerText = score;
                            }
                        } else {
                            // Erro
                            targetDisp.classList.add("animate-shake", "text-red-500");
                            setTimeout(
                                () =>
                                    targetDisp.classList.remove(
                                        "animate-shake",
                                        "text-red-500"
                                    ),
                                400
                            );
                            timeLeft -= 3; // Penalidade
                        }
                    };

                    const start = () => {
                        score = 0;
                        timeLeft = 45;
                        scoreEl.innerText = 0;
                        isPlaying = true;
                        overlay.classList.add("hidden");
                        nextRound();

                        clearInterval(timer);
                        timer = setInterval(() => {
                            timeLeft--;
                            const pct = (timeLeft / 45) * 100;
                            timerBar.style.width = `${pct}%`;

                            if (timeLeft <= 0) {
                                endGame();
                            }
                        }, 1000);
                    };

                    const endGame = () => {
                        isPlaying = false;
                        clearInterval(timer);
                        overlay.classList.remove("hidden");
                        overlay.querySelector("h3").innerText = "Tempo Esgotado!";
                        overlay.querySelector(
                            "p"
                        ).innerText = `Pontua√ß√£o Final: ${score}`;
                        startBtn.innerText = "TENTAR NOVAMENTE";
                    };

                    startBtn.onclick = start;
                    btns.forEach((b) => {
                        b.onclick = () => hit(parseInt(b.dataset.p));
                    });
                },

                interactive_mdc_visualizer(container) {
                    let n1 = 12;
                    let n2 = 18;
                    let selectedDivisor = 1;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-6">Comparador de Medidas (MDC)</h3>

        <div class="flex gap-4 mb-8 items-end">
            <div class="flex flex-col items-center">
                <div class="w-full h-8 bg-brand-blue rounded flex items-center justify-center text-white font-bold transition-all" style="width: 120px;" id="bar-1">12</div>
                <input type="range" id="in-n1" min="4" max="24" value="12" class="mt-2 w-24 h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer accent-brand-blue">
            </div>
            <div class="flex flex-col items-center">
                <div class="w-full h-8 bg-brand-purple rounded flex items-center justify-center text-white font-bold transition-all" style="width: 180px;" id="bar-2">18</div>
                <input type="range" id="in-n2" min="4" max="24" value="18" class="mt-2 w-24 h-2 bg-purple-100 rounded-lg appearance-none cursor-pointer accent-brand-purple">
            </div>
        </div>

        <div class="w-full bg-gray-50 border border-gray-200 rounded-xl p-4 mb-6">
            <p class="text-xs text-gray-500 font-bold mb-2 uppercase">Testando bloco de tamanho: <span id="divisor-val" class="text-brand-orange text-lg">1</span></p>
            <input type="range" id="divisor-slider" min="1" max="12" value="1" class="w-full h-2 bg-orange-100 rounded-lg appearance-none cursor-pointer accent-brand-orange mb-4">
            
            <div class="flex flex-col gap-2">
                <div class="relative h-8 bg-blue-100 rounded w-full overflow-hidden" id="track-1">
                    </div>
                <div class="relative h-8 bg-purple-100 rounded w-full overflow-hidden" id="track-2">
                    </div>
            </div>
        </div>

        <div id="mdc-feedback" class="h-8 text-sm font-bold text-center"></div>

    </div>
    `;

                    const in1 = container.querySelector("#in-n1");
                    const in2 = container.querySelector("#in-n2");
                    const bar1 = container.querySelector("#bar-1");
                    const bar2 = container.querySelector("#bar-2");
                    const sliderDiv = container.querySelector("#divisor-slider");
                    const divVal = container.querySelector("#divisor-val");
                    const track1 = container.querySelector("#track-1");
                    const track2 = container.querySelector("#track-2");
                    const feedback = container.querySelector("#mdc-feedback");

                    const gcd = (a, b) => (b === 0 ? a : gcd(b, a % b));

                    const update = () => {
                        n1 = parseInt(in1.value);
                        n2 = parseInt(in2.value);
                        selectedDivisor = parseInt(sliderDiv.value);
                        const trueMDC = gcd(n1, n2);

                        // Atualiza UI Topo
                        const scale = 10; // px por unidade
                        bar1.style.width = `${n1 * scale}px`;
                        bar1.innerText = n1;
                        bar2.style.width = `${n2 * scale}px`;
                        bar2.innerText = n2;

                        divVal.innerText = selectedDivisor;

                        // Ajusta limite do slider de divisor
                        const maxDiv = Math.min(n1, n2);
                        sliderDiv.max = maxDiv;

                        // Renderiza Blocos nos Trilhos
                        renderTrack(track1, n1, selectedDivisor, "bg-brand-blue");
                        renderTrack(track2, n2, selectedDivisor, "bg-brand-purple");

                        // Feedback
                        const fit1 = n1 % selectedDivisor === 0;
                        const fit2 = n2 % selectedDivisor === 0;

                        if (fit1 && fit2) {
                            if (selectedDivisor === trueMDC) {
                                feedback.innerHTML = `<span class="text-brand-green flex items-center justify-center gap-2"><i class="fas fa-trophy"></i> √â O MDC! O maior divisor comum.</span>`;
                            } else {
                                feedback.innerHTML = `<span class="text-brand-orange">√â um divisor comum, mas n√£o o MAIOR. Tente aumentar!</span>`;
                            }
                        } else {
                            feedback.innerHTML = `<span class="text-gray-400">N√£o encaixa perfeitamente (sobra espa√ßo).</span>`;
                        }
                    };

                    const renderTrack = (el, total, size, colorClass) => {
                        el.style.width = `${total * 10}px`;
                        el.innerHTML = "";

                        const count = Math.floor(total / size);
                        const remainder = total % size;

                        for (let i = 0; i < count; i++) {
                            const block = document.createElement("div");
                            block.className = `absolute h-full border-r border-white ${colorClass} opacity-80`;
                            block.style.width = `${size * 10}px`;
                            block.style.left = `${i * size * 10}px`;
                            el.appendChild(block);
                        }

                        if (remainder > 0) {
                            const remBlock = document.createElement("div");
                            remBlock.className = `absolute h-full bg-red-400 opacity-50 animate-pulse`;
                            remBlock.style.width = `${remainder * 10}px`;
                            remBlock.style.left = `${count * size * 10}px`;
                            el.appendChild(remBlock);
                        }
                    };

                    in1.addEventListener("input", update);
                    in2.addEventListener("input", update);
                    sliderDiv.addEventListener("input", update);

                    update();
                },

                interactive_mdc_method(container) {
                    let nums = [20, 30];
                    let stepsData = [];
                    let commonFactors = [];

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">M√©todo Pr√°tico do MDC</h3>

        <div class="flex gap-2 mb-6 items-center justify-center">
            <input type="number" id="mdc-n1" value="20" class="w-14 text-center border-2 border-gray-200 rounded-lg p-1 font-bold text-brand-text outline-none focus:border-brand-blue">
            <span class="text-gray-300">&</span>
            <input type="number" id="mdc-n2" value="30" class="w-14 text-center border-2 border-gray-200 rounded-lg p-1 font-bold text-brand-text outline-none focus:border-brand-blue">
            <button id="btn-mdc-start" class="bg-brand-blue text-white px-4 py-1 rounded-lg font-bold text-sm shadow-sm hover:bg-blue-600 ml-2">Iniciar</button>
        </div>

        <div class="flex relative mb-6 font-mono text-lg md:text-xl w-full max-w-xs justify-center">
            <div class="flex flex-col items-end pr-4 border-r-2 border-brand-text gap-2" id="mdc-col-left"></div>
            <div class="flex flex-col items-start pl-4 gap-2" id="mdc-col-right"></div>
        </div>

        <div id="mdc-controls" class="hidden flex flex-col items-center gap-3 w-full">
            <p class="text-xs text-gray-500 font-bold" id="mdc-step-msg">Dividir por qual primo?</p>
            <div class="flex gap-2">
                <button class="prime-btn bg-blue-50 text-brand-blue border border-blue-200 px-3 py-2 rounded-lg font-bold hover:bg-blue-100 transition-all shadow-sm" data-p="2">2</button>
                <button class="prime-btn bg-blue-50 text-brand-blue border border-blue-200 px-3 py-2 rounded-lg font-bold hover:bg-blue-100 transition-all shadow-sm" data-p="3">3</button>
                <button class="prime-btn bg-blue-50 text-brand-blue border border-blue-200 px-3 py-2 rounded-lg font-bold hover:bg-blue-100 transition-all shadow-sm" data-p="5">5</button>
            </div>
        </div>

        <div id="mdc-result" class="hidden mt-4 text-center animate-pop-in bg-orange-50 p-4 rounded-xl border border-orange-200 w-full">
            <p class="text-xs font-bold text-orange-700 uppercase mb-2">Multiplique os marcados:</p>
            <div class="text-2xl font-black text-brand-orange" id="mdc-final-val">?</div>
        </div>

    </div>
    `;

                    const colLeft = container.querySelector("#mdc-col-left");
                    const colRight = container.querySelector("#mdc-col-right");
                    const controls = container.querySelector("#mdc-controls");
                    const stepMsg = container.querySelector("#mdc-step-msg");
                    const resultBox = container.querySelector("#mdc-result");
                    const finalVal = container.querySelector("#mdc-final-val");
                    const btnStart = container.querySelector("#btn-mdc-start");
                    const primeBtns = container.querySelectorAll(".prime-btn");

                    let currentVals = [];

                    const renderRow = (vals) => {
                        const row = document.createElement("div");
                        row.className = "h-8 flex items-center";
                        row.innerHTML = `<span class="${vals[0] === 1 ? "text-green-400" : "text-gray-600"
                            }">${vals[0]}</span>, <span class="${vals[1] === 1 ? "text-green-400" : "text-gray-600"
                            }">${vals[1]}</span>`;
                        colLeft.appendChild(row);
                    };

                    const addDivisor = (p, isCommon) => {
                        const divBox = document.createElement("div");
                        divBox.className = "h-8 flex items-center gap-2 animate-pop-in";

                        // Se for comum, adiciona c√≠rculo ou estrela
                        const mark = isCommon
                            ? '<i class="fas fa-check-circle text-brand-orange text-xs"></i>'
                            : "";
                        const color = isCommon
                            ? "text-brand-orange font-black scale-110"
                            : "text-gray-400";

                        divBox.innerHTML = `<span class="${color}">${p}</span> ${mark}`;
                        colRight.appendChild(divBox);

                        // Espa√ßo vazio na esquerda para alinhar
                        // (J√° tratado pelo layout flex col)
                    };

                    const step = (p) => {
                        const v1 = currentVals[0];
                        const v2 = currentVals[1];

                        if (v1 % p !== 0 && v2 % p !== 0) {
                            stepMsg.innerText = `O primo ${p} n√£o divide ningu√©m!`;
                            stepMsg.className = "text-xs text-red-500 font-bold";
                            return;
                        }

                        const divides1 = v1 % p === 0;
                        const divides2 = v2 % p === 0;
                        const isCommon = divides1 && divides2;

                        if (isCommon) commonFactors.push(p);

                        addDivisor(p, isCommon);

                        const nextV1 = divides1 ? v1 / p : v1;
                        const nextV2 = divides2 ? v2 / p : v2;
                        currentVals = [nextV1, nextV2];

                        renderRow(currentVals);
                        stepMsg.innerText = "Dividir por qual primo?";
                        stepMsg.className = "text-xs text-gray-500 font-bold";

                        if (nextV1 === 1 && nextV2 === 1) {
                            finish();
                        }
                    };

                    const finish = () => {
                        controls.classList.add("hidden");
                        resultBox.classList.remove("hidden");

                        if (commonFactors.length > 0) {
                            const mdc = commonFactors.reduce((a, b) => a * b, 1);
                            finalVal.innerHTML = `${commonFactors.join(" √ó ")} = ${mdc}`;
                        } else {
                            finalVal.innerHTML = "1 (Primos entre si)";
                        }
                    };

                    const start = () => {
                        const n1 = parseInt(container.querySelector("#mdc-n1").value);
                        const n2 = parseInt(container.querySelector("#mdc-n2").value);

                        currentVals = [n1, n2];
                        commonFactors = [];
                        colLeft.innerHTML = "";
                        colRight.innerHTML = "";
                        resultBox.classList.add("hidden");
                        controls.classList.remove("hidden");

                        renderRow(currentVals);
                    };

                    primeBtns.forEach(
                        (b) => (b.onclick = () => step(parseInt(b.dataset.p)))
                    );
                    btnStart.onclick = start;

                    // Auto-start
                    renderRow([20, 30]);
                },

                interactive_tile_master(container) {
                    // Configura√ß√£o
                    const roomW = 12;
                    const roomH = 8; // MDC = 4
                    let currentTile = 2; // Tamanho do azulejo escolhido

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-6 border-b-2 border-gray-100 pb-2">
            <h3 class="text-brand-blue font-black uppercase text-xs tracking-widest"><i class="fas fa-th"></i> Mestre dos Azulejos</h3>
            <div class="text-xs font-bold text-gray-500">Sala: ${roomW}m √ó ${roomH}m</div>
        </div>

        <div class="relative bg-gray-100 border-4 border-gray-400 shadow-inner mb-6 transition-all duration-500" id="room-floor" style="width: ${roomW * 20
                        }px; height: ${roomH * 20}px;">
            </div>

        <div class="flex flex-col items-center gap-4 w-full max-w-sm">
            <p class="text-xs text-gray-400 font-bold uppercase">Escolha o tamanho do piso (quadrado)</p>
            
            <div class="flex gap-2">
                <button class="tile-btn w-12 h-12 bg-white border-2 border-brand-blue rounded-lg font-bold text-brand-blue shadow-sm hover:bg-blue-50 focus:ring-2 focus:ring-blue-300" data-s="1">1m</button>
                <button class="tile-btn w-12 h-12 bg-white border-2 border-brand-blue rounded-lg font-bold text-brand-blue shadow-sm hover:bg-blue-50 focus:ring-2 focus:ring-blue-300" data-s="2">2m</button>
                <button class="tile-btn w-12 h-12 bg-white border-2 border-brand-blue rounded-lg font-bold text-brand-blue shadow-sm hover:bg-blue-50 focus:ring-2 focus:ring-blue-300" data-s="3">3m</button>
                <button class="tile-btn w-12 h-12 bg-white border-2 border-brand-blue rounded-lg font-bold text-brand-blue shadow-sm hover:bg-blue-50 focus:ring-2 focus:ring-blue-300" data-s="4">4m</button>
                <button class="tile-btn w-12 h-12 bg-white border-2 border-brand-blue rounded-lg font-bold text-brand-blue shadow-sm hover:bg-blue-50 focus:ring-2 focus:ring-blue-300" data-s="5">5m</button>
            </div>

            <button id="btn-pave" class="w-full bg-brand-green text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all uppercase tracking-widest mt-2">
                Pavimentar!
            </button>
        </div>

        <div id="tile-feedback" class="h-12 mt-4 text-sm font-bold text-center flex items-center justify-center"></div>

    </div>
    `;

                    const floor = container.querySelector("#room-floor");
                    const feedback = container.querySelector("#tile-feedback");
                    const btnPave = container.querySelector("#btn-pave");
                    const tileBtns = container.querySelectorAll(".tile-btn");

                    // Sele√ß√£o
                    tileBtns.forEach((b) => {
                        b.onclick = () => {
                            tileBtns.forEach((x) =>
                                x.classList.remove("bg-brand-blue", "text-white")
                            );
                            b.classList.add("bg-brand-blue", "text-white");
                            currentTile = parseInt(b.dataset.s);
                        };
                    });
                    // Seleciona o 2 por padr√£o visualmente
                    tileBtns[1].click();

                    const pave = () => {
                        floor.innerHTML = "";
                        const size = currentTile;
                        const scale = 20; // 20px por metro

                        // Verifica encaixe
                        const fitsW = roomW % size === 0;
                        const fitsH = roomH % size === 0;
                        const isPerfect = fitsW && fitsH;

                        // Renderiza
                        // Se n√£o encaixar, vamos desenhar "cortado" (overflow hidden no container j√° cuida visualmente, mas vamos mostrar vermelho)

                        const cols = Math.ceil(roomW / size);
                        const rows = Math.ceil(roomH / size);

                        for (let y = 0; y < rows; y++) {
                            for (let x = 0; x < cols; x++) {
                                const tile = document.createElement("div");
                                tile.className =
                                    "absolute border border-white/50 flex items-center justify-center text-[10px] text-white/50 font-bold animate-pop-in";
                                tile.style.width = `${size * scale}px`;
                                tile.style.height = `${size * scale}px`;
                                tile.style.left = `${x * size * scale}px`;
                                tile.style.top = `${y * size * scale}px`;
                                tile.style.animationDelay = `${(x + y) * 0.05}s`;

                                // Cor
                                if (isPerfect) {
                                    tile.classList.add("bg-brand-blue");
                                } else {
                                    // Verifica se este azulejo espec√≠fico precisa ser cortado
                                    const rightEdge = (x + 1) * size;
                                    const bottomEdge = (y + 1) * size;
                                    if (rightEdge > roomW || bottomEdge > roomH) {
                                        tile.classList.add("bg-red-400"); // Cortado/Quebrado
                                        tile.innerText = "‚úÇÔ∏è";
                                    } else {
                                        tile.classList.add("bg-gray-400");
                                    }
                                }

                                floor.appendChild(tile);
                            }
                        }

                        // Feedback
                        if (isPerfect) {
                            // Verifica se √© o MAIOR poss√≠vel (MDC)
                            // MDC de 12 e 8 √© 4.
                            const mdc = 4;
                            if (currentTile === mdc) {
                                feedback.innerHTML = `<span class="text-brand-green">PARAB√âNS! Voc√™ usou o maior piso poss√≠vel (${size}m). Economizou rejunte!</span>`;
                            } else {
                                feedback.innerHTML = `<span class="text-brand-orange">Encaixou, mas voc√™ poderia usar um piso MAIOR para trabalhar menos.</span>`;
                            }
                        } else {
                            feedback.innerHTML = `<span class="text-brand-red">Ops! Teve que cortar pe√ßas. O piso ${size}m n√£o √© divisor comum de ${roomW} e ${roomH}.</span>`;
                        }
                    };

                    btnPave.onclick = pave;
                },

                interactive_fraction_reader(container) {
                    let num = 1;
                    let den = 2;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Tradutor de Fra√ß√µes</h3>

        <div class="flex items-center gap-4 mb-6">
            <div class="flex flex-col items-center gap-2">
                <input type="number" id="read-n" value="${num}" min="1" max="999" class="w-20 text-center border-2 border-brand-blue rounded-xl p-2 font-bold text-2xl outline-none text-brand-blue focus:bg-blue-50">
                <div class="w-full h-1 bg-brand-text rounded-full"></div>
                <input type="number" id="read-d" value="${den}" min="1" max="999" class="w-20 text-center border-2 border-brand-orange rounded-xl p-2 font-bold text-2xl outline-none text-brand-orange focus:bg-orange-50">
            </div>

            <div class="text-4xl text-gray-300"><i class="fas fa-arrow-right"></i></div>

            <div class="flex-1 bg-gray-50 border-2 border-gray-200 rounded-xl p-4 flex items-center justify-center min-h-[100px] w-full max-w-xs text-center">
                <p id="text-output" class="text-lg md:text-xl font-black text-brand-text capitalize leading-tight">Um meio</p>
            </div>
        </div>

        <div class="flex flex-wrap gap-2 justify-center">
            <button class="preset-btn bg-white border border-gray-200 px-3 py-1 rounded-lg text-xs font-bold text-gray-500 hover:border-brand-blue hover:text-brand-blue" data-n="1" data-d="2">1/2</button>
            <button class="preset-btn bg-white border border-gray-200 px-3 py-1 rounded-lg text-xs font-bold text-gray-500 hover:border-brand-blue hover:text-brand-blue" data-n="3" data-d="4">3/4</button>
            <button class="preset-btn bg-white border border-gray-200 px-3 py-1 rounded-lg text-xs font-bold text-gray-500 hover:border-brand-blue hover:text-brand-blue" data-n="7" data-d="10">7/10</button>
            <button class="preset-btn bg-white border border-gray-200 px-3 py-1 rounded-lg text-xs font-bold text-gray-500 hover:border-brand-blue hover:text-brand-blue" data-n="5" data-d="12">5/12</button>
            <button class="preset-btn bg-white border border-gray-200 px-3 py-1 rounded-lg text-xs font-bold text-gray-500 hover:border-brand-blue hover:text-brand-blue" data-n="8" data-d="4">8/4</button>
        </div>
    </div>
    `;

                    const inpN = container.querySelector("#read-n");
                    const inpD = container.querySelector("#read-d");
                    const output = container.querySelector("#text-output");
                    const presets = container.querySelectorAll(".preset-btn");

                    // Fun√ß√£o para converter n√∫mero em extenso (Simples 1-999)
                    const numbers = {
                        1: "um",
                        2: "dois",
                        3: "tr√™s",
                        4: "quatro",
                        5: "cinco",
                        6: "seis",
                        7: "sete",
                        8: "oito",
                        9: "nove",
                        10: "dez",
                        // ... simplificado para demo, ideal seria uma lib ou fun√ß√£o completa
                    };

                    // Nomes especiais do denominador
                    const specials = {
                        1: "inteiro",
                        2: "meio",
                        3: "ter√ßo",
                        4: "quarto",
                        5: "quinto",
                        6: "sexto",
                        7: "s√©timo",
                        8: "oitavo",
                        9: "nono",
                        10: "d√©cimo",
                        100: "cent√©simo",
                        1000: "mil√©simo",
                    };

                    const numExtenso = (n) => {
                        // Implementa√ß√£o simplificada para o widget
                        return n.toString();
                        // Para uma implementa√ß√£o real, usar√≠amos a fun√ß√£o completa de extenso que j√° temos no widget de leitura de n√∫meros
                        // ou reutilizar√≠amos o helper do `interactive_place_value_extended`.
                        // Vou usar o n√∫mero ar√°bico misturado com texto para facilitar a leitura neste contexto,
                        // mas idealmente seria "Tr√™s quartos".
                        // Vamos tentar mapear os b√°sicos de 1 a 10 para ficar bonito.
                    };

                    const mapSmallNum = (n) => {
                        const small = [
                            "",
                            "um",
                            "dois",
                            "tr√™s",
                            "quatro",
                            "cinco",
                            "seis",
                            "sete",
                            "oito",
                            "nove",
                            "dez",
                        ];
                        return small[n] || n;
                    };

                    const update = () => {
                        const n = parseInt(inpN.value) || 1;
                        const d = parseInt(inpD.value) || 1;

                        let nText = mapSmallNum(n);
                        let dText = "";

                        // Regra do Denominador
                        if (specials[d]) {
                            dText = specials[d];
                        } else {
                            dText = `${mapSmallNum(d)} avos`;
                        }

                        // Plural
                        if (n > 1) {
                            if (dText.endsWith("o")) dText += "s"; // meio -> meios
                            // avos n√£o muda
                        }

                        // Exce√ß√£o "Meio" -> "Metade" as vezes, mas "Meio" √© o termo matem√°tico da fra√ß√£o

                        output.innerText = `${nText} ${dText}`;
                    };

                    inpN.oninput = update;
                    inpD.oninput = update;

                    presets.forEach((btn) => {
                        btn.onclick = () => {
                            inpN.value = btn.dataset.n;
                            inpD.value = btn.dataset.d;
                            update();
                        };
                    });

                    update();
                },

                interactive_fraction_shaper(container) {
                    let num = 3;
                    let den = 4;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-6">
            <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest">Classificador</h3>
            <div id="class-badge" class="bg-green-100 text-green-700 px-4 py-1 rounded-full text-xs font-black uppercase shadow-sm transition-all">Pr√≥pria</div>
        </div>

        <div class="flex items-center gap-6 mb-8 w-full justify-center">
            <div class="flex flex-col items-center gap-2">
                <div class="flex items-center gap-2">
                    <button class="w-8 h-8 bg-gray-100 rounded hover:bg-gray-200 font-bold" onclick="this.nextElementSibling.stepDown(); this.nextElementSibling.dispatchEvent(new Event('input'))">-</button>
                    <input type="number" id="shp-n" value="${num}" min="1" class="w-16 text-center border-2 border-brand-purple rounded-lg p-2 font-black text-2xl outline-none text-brand-purple">
                    <button class="w-8 h-8 bg-gray-100 rounded hover:bg-gray-200 font-bold" onclick="this.previousElementSibling.stepUp(); this.previousElementSibling.dispatchEvent(new Event('input'))">+</button>
                </div>
                <div class="w-24 h-1 bg-gray-300 rounded-full"></div>
                <div class="flex items-center gap-2">
                    <button class="w-8 h-8 bg-gray-100 rounded hover:bg-gray-200 font-bold" onclick="this.nextElementSibling.stepDown(); this.nextElementSibling.dispatchEvent(new Event('input'))">-</button>
                    <input type="number" id="shp-d" value="${den}" min="1" class="w-16 text-center border-2 border-brand-orange rounded-lg p-2 font-black text-2xl outline-none text-brand-orange">
                    <button class="w-8 h-8 bg-gray-100 rounded hover:bg-gray-200 font-bold" onclick="this.previousElementSibling.stepUp(); this.previousElementSibling.dispatchEvent(new Event('input'))">+</button>
                </div>
            </div>

            <div class="flex-1 overflow-x-auto custom-scrollbar pb-2">
                <div id="pizza-row" class="flex gap-4 items-center min-w-[200px] h-32 px-4">
                    </div>
            </div>
        </div>

        <div id="status-msg" class="text-center text-sm font-bold text-gray-500 bg-gray-50 p-3 rounded-xl w-full border border-gray-200">
            ...
        </div>

    </div>
    `;

                    const inpN = container.querySelector("#shp-n");
                    const inpD = container.querySelector("#shp-d");
                    const badge = container.querySelector("#class-badge");
                    const pizzaRow = container.querySelector("#pizza-row");
                    const msg = container.querySelector("#status-msg");

                    const renderPizzas = (n, d) => {
                        pizzaRow.innerHTML = "";

                        // Quantas pizzas inteiras precisamos?
                        const totalPizzas = Math.ceil(n / d);

                        for (let i = 0; i < totalPizzas; i++) {
                            const svg = document.createElementNS(
                                "http://www.w3.org/2000/svg",
                                "svg"
                            );
                            svg.setAttribute("viewBox", "0 0 100 100");
                            svg.setAttribute("class", "w-24 h-24 shrink-0 animate-pop-in");
                            svg.style.animationDelay = `${i * 0.1}s`;

                            // Fundo da pizza
                            const bgCircle = document.createElementNS(
                                "http://www.w3.org/2000/svg",
                                "circle"
                            );
                            bgCircle.setAttribute("cx", "50");
                            bgCircle.setAttribute("cy", "50");
                            bgCircle.setAttribute("r", "48");
                            bgCircle.setAttribute("fill", "#F3F4F6");
                            bgCircle.setAttribute("stroke", "#D1D5DB");
                            bgCircle.setAttribute("stroke-width", "2");
                            svg.appendChild(bgCircle);

                            // Fatias
                            // Quantas fatias nesta pizza espec√≠fica?
                            // Se for a √∫ltima pizza, √© o resto. Se n√£o, √© cheia.
                            const slicesInThisPizza =
                                i === totalPizzas - 1 && n % d !== 0 ? n % d : d;

                            // Desenhar fatias (Path de setor circular)
                            if (slicesInThisPizza === d) {
                                // Pizza cheia
                                const full = document.createElementNS(
                                    "http://www.w3.org/2000/svg",
                                    "circle"
                                );
                                full.setAttribute("cx", "50");
                                full.setAttribute("cy", "50");
                                full.setAttribute("r", "48");
                                full.setAttribute("fill", "#CE82FF");
                                full.setAttribute("stroke", "#FFF");
                                full.setAttribute("stroke-width", "1");
                                svg.appendChild(full);
                            } else {
                                // Fatias parciais
                                for (let s = 0; s < slicesInThisPizza; s++) {
                                    const startAngle = (s * 360) / d;
                                    const endAngle = ((s + 1) * 360) / d;

                                    // Coordenadas
                                    const x1 =
                                        50 + 48 * Math.cos((Math.PI * (startAngle - 90)) / 180);
                                    const y1 =
                                        50 + 48 * Math.sin((Math.PI * (startAngle - 90)) / 180);
                                    const x2 =
                                        50 + 48 * Math.cos((Math.PI * (endAngle - 90)) / 180);
                                    const y2 =
                                        50 + 48 * Math.sin((Math.PI * (endAngle - 90)) / 180);

                                    const largeArc = endAngle - startAngle > 180 ? 1 : 0;

                                    const path = document.createElementNS(
                                        "http://www.w3.org/2000/svg",
                                        "path"
                                    );
                                    path.setAttribute(
                                        "d",
                                        `M 50 50 L ${x1} ${y1} A 48 48 0 ${largeArc} 1 ${x2} ${y2} Z`
                                    );
                                    path.setAttribute("fill", "#CE82FF");
                                    path.setAttribute("stroke", "#FFF");
                                    path.setAttribute("stroke-width", "1");
                                    svg.appendChild(path);
                                }
                            }

                            // Linhas de corte (grade) para visualizar o denominador
                            if (d > 1) {
                                const linesGroup = document.createElementNS(
                                    "http://www.w3.org/2000/svg",
                                    "g"
                                );
                                for (let l = 0; l < d; l++) {
                                    const angle = (l * 360) / d;
                                    const x =
                                        50 + 48 * Math.cos((Math.PI * (angle - 90)) / 180);
                                    const y =
                                        50 + 48 * Math.sin((Math.PI * (angle - 90)) / 180);
                                    const line = document.createElementNS(
                                        "http://www.w3.org/2000/svg",
                                        "line"
                                    );
                                    line.setAttribute("x1", "50");
                                    line.setAttribute("y1", "50");
                                    line.setAttribute("x2", x);
                                    line.setAttribute("y2", y);
                                    line.setAttribute("stroke", "rgba(255,255,255,0.5)");
                                    line.setAttribute("stroke-width", "1");
                                    linesGroup.appendChild(line);
                                }
                                svg.appendChild(linesGroup);
                            }

                            pizzaRow.appendChild(svg);
                        }
                    };

                    const update = () => {
                        let n = parseInt(inpN.value) || 1;
                        let d = parseInt(inpD.value) || 1;

                        // Classifica√ß√£o
                        let type = "";
                        let colorClass = "";
                        let message = "";

                        if (n % d === 0) {
                            type = "Aparente";
                            colorClass = "bg-purple-100 text-purple-800";
                            const inteiro = n / d;
                            message = `Parece fra√ß√£o, mas √© o n√∫mero inteiro <strong>${inteiro}</strong>!`;
                        } else if (n > d) {
                            type = "Impr√≥pria";
                            colorClass = "bg-orange-100 text-orange-800";
                            message = `A cabe√ßa √© maior que o corpo! Precisa de <strong>${Math.ceil(
                                n / d
                            )}</strong> inteiros.`;
                        } else {
                            type = "Pr√≥pria";
                            colorClass = "bg-green-100 text-green-800";
                            message = `Comportada! Cabe dentro de um √∫nico inteiro.`;
                        }

                        badge.innerText = type;
                        badge.className = `${colorClass} px-4 py-1 rounded-full text-xs font-black uppercase shadow-sm transition-all`;
                        msg.innerHTML = message;

                        renderPizzas(n, d);
                    };

                    inpN.oninput = update;
                    inpD.oninput = update;

                    update();
                },

                interactive_fraction_sorter(container) {
                    const fractions = [
                        { n: 1, d: 2, type: "propria" },
                        { n: 5, d: 4, type: "impropria" },
                        { n: 8, d: 4, type: "aparente" },
                        { n: 3, d: 3, type: "aparente" }, // Igual √© aparente (1 inteiro)
                        { n: 2, d: 5, type: "propria" },
                        { n: 7, d: 2, type: "impropria" },
                        { n: 10, d: 2, type: "aparente" },
                        { n: 99, d: 100, type: "propria" },
                        { n: 100, d: 99, type: "impropria" },
                    ];

                    let currentIdx = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-300 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[400px]">
        
        <div class="flex justify-between w-full z-10 mb-4">
            <div class="bg-white border px-3 py-1 rounded-full text-xs font-bold text-gray-500">Separador de Reciclagem</div>
            <div class="bg-white border border-brand-green px-3 py-1 rounded-full text-xs font-black text-brand-green">Pts: <span id="sort-score">0</span></div>
        </div>

        <div class="flex-1 w-full relative flex justify-center items-center z-10">
            <div id="falling-card" class="w-32 h-32 bg-white rounded-2xl shadow-xl border-b-4 border-gray-200 flex flex-col items-center justify-center transition-all duration-300 transform">
                <span class="text-5xl font-black text-brand-blue" id="card-n">?</span>
                <div class="w-16 h-1 bg-gray-800 my-1"></div>
                <span class="text-5xl font-black text-brand-orange" id="card-d">?</span>
            </div>
            
            <div id="sort-feedback" class="absolute top-0 text-6xl font-black opacity-0 transition-all duration-500"></div>
        </div>

        <div class="grid grid-cols-3 gap-2 w-full z-10 mt-auto">
            <button class="bin-btn flex flex-col items-center bg-green-100 border-b-4 border-green-300 rounded-xl p-2 active:border-b-0 active:translate-y-1 transition-all" data-t="propria">
                <span class="text-2xl">üë∂</span>
                <span class="text-[10px] font-black text-green-800 uppercase">Pr√≥pria</span>
            </button>
            <button class="bin-btn flex flex-col items-center bg-orange-100 border-b-4 border-orange-300 rounded-xl p-2 active:border-b-0 active:translate-y-1 transition-all" data-t="impropria">
                <span class="text-2xl">ü§Ø</span>
                <span class="text-[10px] font-black text-orange-800 uppercase">Impr√≥pria</span>
            </button>
            <button class="bin-btn flex flex-col items-center bg-purple-100 border-b-4 border-purple-300 rounded-xl p-2 active:border-b-0 active:translate-y-1 transition-all" data-t="aparente">
                <span class="text-2xl">üïµÔ∏è</span>
                <span class="text-[10px] font-black text-purple-800 uppercase">Aparente</span>
            </button>
        </div>

        <div id="end-screen" class="absolute inset-0 bg-white/95 z-20 flex-col items-center justify-center text-center hidden">
            <h3 class="text-3xl font-black text-brand-text mb-2">Fim de Turno!</h3>
            <p class="text-gray-500 mb-6">Voc√™ organizou <span id="final-score">0</span> fra√ß√µes.</p>
            <button id="btn-restart" class="bg-brand-blue text-white font-bold py-3 px-8 rounded-full shadow-lg active:scale-95">Trabalhar Novamente</button>
        </div>

    </div>
    `;

                    const card = container.querySelector("#falling-card");
                    const cardN = container.querySelector("#card-n");
                    const cardD = container.querySelector("#card-d");
                    const scoreEl = container.querySelector("#sort-score");
                    const feedback = container.querySelector("#sort-feedback");
                    const endScreen = container.querySelector("#end-screen");
                    const btns = container.querySelectorAll(".bin-btn");
                    const btnRestart = container.querySelector("#btn-restart");

                    // Embaralha
                    const queue = [...fractions].sort(() => Math.random() - 0.5);

                    const loadNext = () => {
                        if (currentIdx >= queue.length) {
                            endScreen.querySelector("#final-score").innerText = score;
                            endScreen.classList.remove("hidden");
                            endScreen.classList.add("flex");
                            return;
                        }

                        const f = queue[currentIdx];
                        cardN.innerText = f.n;
                        cardD.innerText = f.d;

                        // Reset anima√ß√£o card
                        card.className =
                            "w-32 h-32 bg-white rounded-2xl shadow-xl border-b-4 border-gray-200 flex flex-col items-center justify-center transition-all duration-300 transform scale-0 opacity-0";
                        setTimeout(() => {
                            card.className =
                                "w-32 h-32 bg-white rounded-2xl shadow-xl border-b-4 border-gray-200 flex flex-col items-center justify-center transition-all duration-300 transform scale-100 opacity-100 animate-bounce-small";
                        }, 50);

                        feedback.className =
                            "absolute top-0 text-6xl font-black opacity-0 transition-all duration-500";
                    };

                    const check = (type) => {
                        const correct = queue[currentIdx].type;

                        // Regra de prioridade: Aparente √© tecnicamente impr√≥pria tamb√©m, mas no jogo "Aparente" ganha se for inteiro.
                        // O dataset j√° classifica corretamente (ex: 8/4 √© aparente).
                        // Se o usu√°rio clicar "impropria" para 8/4, tecnicamente √© verdade na matem√°tica, mas no jogo queremos a classifica√ß√£o mais espec√≠fica.
                        // Vamos ser rigorosos: 8/4 deve ir para aparente.

                        if (type === correct) {
                            score += 10;
                            scoreEl.innerText = score;
                            feedback.innerText = "‚úÖ";
                            feedback.classList.remove("opacity-0");
                            feedback.classList.add("scale-150", "text-green-500");

                            // Card sai voando para a caixa
                            card.style.transform = "translateY(200px) scale(0)";
                            card.style.opacity = "0";
                        } else {
                            score = Math.max(0, score - 5);
                            scoreEl.innerText = score;
                            feedback.innerText = "‚ùå";
                            feedback.classList.remove("opacity-0");
                            feedback.classList.add("scale-150", "text-red-500");

                            card.classList.add(
                                "animate-shake",
                                "bg-red-50",
                                "border-red-200"
                            );
                        }

                        setTimeout(() => {
                            currentIdx++;
                            loadNext();
                        }, 600);
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => check(btn.dataset.t);
                    });

                    btnRestart.onclick = () => {
                        currentIdx = 0;
                        score = 0;
                        scoreEl.innerText = 0;
                        queue.sort(() => Math.random() - 0.5);
                        endScreen.classList.add("hidden");
                        endScreen.classList.remove("flex");
                        loadNext();
                    };

                    loadNext();
                },

                interactive_mixed_visualizer(container) {
                    // Estado
                    let integer = 2;
                    let num = 1;
                    let den = 4;
                    let isMixedView = true;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Metamorfose da Fra√ß√£o</h3>

        <div class="flex flex-wrap justify-center gap-4 mb-8 min-h-[120px] transition-all duration-500" id="visual-area">
            </div>

        <div class="flex items-center gap-8 mb-6">
            
            <div class="flex flex-col items-center">
                <span class="text-[10px] font-bold text-gray-400 uppercase">Inteiros</span>
                <div class="flex items-center gap-2">
                    <button class="w-8 h-8 rounded-full bg-gray-100 text-gray-600 font-bold hover:bg-gray-200" onclick="app.widgets.updateMixed(this, 'int', -1)">-</button>
                    <span id="val-int" class="text-3xl font-black text-brand-purple w-8 text-center">2</span>
                    <button class="w-8 h-8 rounded-full bg-gray-100 text-gray-600 font-bold hover:bg-gray-200" onclick="app.widgets.updateMixed(this, 'int', 1)">+</button>
                </div>
            </div>

            <div class="flex flex-col items-center">
                <span class="text-[10px] font-bold text-gray-400 uppercase">Fra√ß√£o</span>
                <div class="flex items-center font-bold text-xl text-brand-blue">
                    <div class="flex flex-col items-center gap-1">
                        <div class="flex items-center gap-1">
                            <button class="text-xs bg-gray-100 rounded px-1 hover:bg-gray-200" onclick="app.widgets.updateMixed(this, 'num', 1)">‚ñ≤</button>
                            <span id="val-num">1</span>
                            <button class="text-xs bg-gray-100 rounded px-1 hover:bg-gray-200" onclick="app.widgets.updateMixed(this, 'num', -1)">‚ñº</button>
                        </div>
                        <div class="w-full h-0.5 bg-current"></div>
                        <span id="val-den">4</span>
                    </div>
                </div>
            </div>

        </div>

        <div class="relative w-full max-w-sm bg-gray-100 p-2 rounded-xl flex items-center justify-between cursor-pointer border-2 border-gray-200 transition-all hover:border-brand-blue" id="toggle-btn">
            
            <div id="mode-text-left" class="flex-1 text-center text-sm font-bold text-brand-blue transition-opacity">
                N√∫mero Misto
                <div class="text-xs font-mono text-gray-500" id="mixed-display">2 1/4</div>
            </div>

            <div class="w-12 h-12 bg-white rounded-full shadow-md flex items-center justify-center text-xl transition-transform duration-500 z-10" id="toggle-icon">
                üîÑ
            </div>

            <div id="mode-text-right" class="flex-1 text-center text-sm font-bold text-gray-400 transition-opacity">
                Fra√ß√£o Impr√≥pria
                <div class="text-xs font-mono text-gray-400" id="improper-display">9/4</div>
            </div>

            <div id="toggle-bg" class="absolute inset-y-1 left-1 w-[calc(50%-4px)] bg-white rounded-lg shadow-sm -z-0 transition-all duration-500"></div>
        </div>

    </div>
    `;

                    const visualArea = container.querySelector("#visual-area");
                    const valInt = container.querySelector("#val-int");
                    const valNum = container.querySelector("#val-num");
                    const valDen = container.querySelector("#val-den");
                    const mixedDisp = container.querySelector("#mixed-display");
                    const improperDisp = container.querySelector("#improper-display");
                    const toggleBtn = container.querySelector("#toggle-btn");
                    const toggleBg = container.querySelector("#toggle-bg");
                    const toggleIcon = container.querySelector("#toggle-icon");
                    const textLeft = container.querySelector("#mode-text-left");
                    const textRight = container.querySelector("#mode-text-right");

                    const render = () => {
                        // Atualiza Valores
                        valInt.innerText = integer;
                        valNum.innerText = num;
                        valDen.innerText = den;

                        const improperNum = integer * den + num;
                        mixedDisp.innerText = `${integer} ${num}/${den}`;
                        improperDisp.innerText = `${improperNum}/${den}`;

                        // Renderiza Visual (Pizzas)
                        visualArea.innerHTML = "";

                        // Pizzas Inteiras
                        for (let i = 0; i < integer; i++) {
                            visualArea.appendChild(createPizza(den, den, true));
                        }
                        // Pizza Fracionada
                        if (num > 0) {
                            visualArea.appendChild(createPizza(den, num, false));
                        }
                    };

                    const createPizza = (d, n, isFull) => {
                        // Cria SVG
                        const size = 60;
                        const svg = document.createElementNS(
                            "http://www.w3.org/2000/svg",
                            "svg"
                        );
                        svg.setAttribute("viewBox", "0 0 100 100");
                        svg.setAttribute(
                            "class",
                            "w-16 h-16 md:w-20 md:h-20 animate-pop-in"
                        );

                        // Fundo (Borda)
                        const bg = document.createElementNS(
                            "http://www.w3.org/2000/svg",
                            "circle"
                        );
                        bg.setAttribute("cx", "50");
                        bg.setAttribute("cy", "50");
                        bg.setAttribute("r", "48");
                        bg.setAttribute("fill", "#FFF");
                        bg.setAttribute("stroke", "#E5E7EB");
                        bg.setAttribute("stroke-width", "2");
                        svg.appendChild(bg);

                        // Fatias
                        // Se isMixedView e isFull, mostra um c√≠rculo s√≥lido.
                        // Se isMixedView e !isFull, mostra fatias.
                        // Se !isMixedView (Impr√≥pria), mostra SEMPRE fatias individuais.

                        const showSlices = !isMixedView || !isFull;
                        const color = isFull ? "#CE82FF" : "#FF9600"; // Inteiro=Roxo, Parcial=Laranja

                        if (!showSlices) {
                            // Inteiro S√≥lido
                            const full = document.createElementNS(
                                "http://www.w3.org/2000/svg",
                                "circle"
                            );
                            full.setAttribute("cx", "50");
                            full.setAttribute("cy", "50");
                            full.setAttribute("r", "46");
                            full.setAttribute("fill", color);
                            // Adiciona linhas de corte leves para refer√™ncia
                            full.setAttribute("stroke", "white");
                            full.setAttribute("stroke-width", "1");
                            svg.appendChild(full);
                        }

                        // Desenha fatias (sempre desenha se for parcial ou se estiver no modo impr√≥pria)
                        if (showSlices || !isFull) {
                            for (let i = 0; i < n; i++) {
                                const startA = (i * 360) / d;
                                const endA = ((i + 1) * 360) / d;

                                // Coords
                                const x1 =
                                    50 + 48 * Math.cos(((startA - 90) * Math.PI) / 180);
                                const y1 =
                                    50 + 48 * Math.sin(((startA - 90) * Math.PI) / 180);
                                const x2 = 50 + 48 * Math.cos(((endA - 90) * Math.PI) / 180);
                                const y2 = 50 + 48 * Math.sin(((endA - 90) * Math.PI) / 180);

                                const large = endA - startA > 180 ? 1 : 0;

                                const path = document.createElementNS(
                                    "http://www.w3.org/2000/svg",
                                    "path"
                                );
                                path.setAttribute(
                                    "d",
                                    `M 50 50 L ${x1} ${y1} A 48 48 0 ${large} 1 ${x2} ${y2} Z`
                                );
                                path.setAttribute("fill", color);
                                path.setAttribute("stroke", "white");
                                path.setAttribute("stroke-width", "1");

                                // Anima√ß√£o de "explos√£o" se estiver no modo impr√≥pria
                                if (!isMixedView) {
                                    // Leve deslocamento do centro para parecer fatias soltas
                                    const midA = (startA + endA) / 2;
                                    const dx = 2 * Math.cos(((midA - 90) * Math.PI) / 180);
                                    const dy = 2 * Math.sin(((midA - 90) * Math.PI) / 180);
                                    path.setAttribute("transform", `translate(${dx}, ${dy})`);
                                }

                                svg.appendChild(path);
                            }
                        }

                        return svg;
                    };

                    // Helper Global para os bot√µes (j√° que onclick HTML string n√£o v√™ escopo local)
                    app.widgets.updateMixed = (el, type, val) => {
                        if (type === "int") {
                            integer += val;
                            if (integer < 0) integer = 0;
                            if (integer > 5) integer = 5;
                        } else {
                            num += val;
                            if (num < 0) num = 0;
                            if (num >= den) num = den - 1; // Mant√©m fra√ß√£o pr√≥pria na parte fracion√°ria
                        }
                        render();
                    };

                    toggleBtn.onclick = () => {
                        isMixedView = !isMixedView;

                        if (isMixedView) {
                            toggleBg.style.left = "4px";
                            toggleBg.style.transform = "translateX(0)";
                            toggleIcon.style.transform = "rotate(0deg)";

                            textLeft.className =
                                "flex-1 text-center text-sm font-bold text-brand-blue transition-opacity";
                            textRight.className =
                                "flex-1 text-center text-sm font-bold text-gray-400 transition-opacity";
                        } else {
                            toggleBg.style.transform = "translateX(100%)";
                            toggleIcon.style.transform = "rotate(180deg)";

                            textLeft.className =
                                "flex-1 text-center text-sm font-bold text-gray-400 transition-opacity";
                            textRight.className =
                                "flex-1 text-center text-sm font-bold text-brand-orange transition-opacity";
                        }
                        render();
                    };

                    render();
                },

                interactive_pizza_packer(container) {
                    // Dados: N√≠vel { num: 13, den: 4 } => 13/4
                    const levels = [
                        { n: 5, d: 2, hint: "Quantos 2 cabem em 5?" }, // 2 inteiros e 1/2
                        { n: 7, d: 3, hint: "Quantos 3 cabem em 7?" }, // 2 inteiros e 1/3
                        { n: 11, d: 4, hint: "Tabuada do 4..." }, // 2 inteiros e 3/4
                        { n: 4, d: 3, hint: "Passou um pouquinho de 1." }, // 1 inteiro e 1/3
                        { n: 15, d: 5, hint: "Divis√£o exata!" }, // 3 inteiros e 0/5
                    ];

                    let currentLvl = 0;

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-300 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-4 z-10">
            <h3 class="font-black text-gray-500 uppercase text-xs tracking-widest"><i class="fas fa-box"></i> Pizzaria Express</h3>
            <div class="bg-white border border-gray-200 px-3 py-1 rounded-full text-xs font-black text-brand-orange">N√≠vel <span id="lvl-disp">1</span></div>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-brand-orange mb-6 w-full max-w-xs flex items-center justify-between relative z-10">
            <div>
                <p class="text-[10px] font-bold text-gray-400 uppercase">Pedido:</p>
                <div class="font-mono text-3xl font-black text-brand-orange flex items-center">
                    <span id="req-n">5</span><span class="mx-1">/</span><span id="req-d">2</span>
                    <span class="text-sm text-gray-400 ml-2 font-bold">fatias</span>
                </div>
            </div>
            <div class="text-4xl">üçï</div>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-lg w-full max-w-sm flex flex-col items-center gap-4 z-10">
            <p class="text-sm font-bold text-gray-600">Quantas caixas inteiras?</p>
            
            <div class="flex items-end gap-4">
                <div class="flex flex-col items-center">
                    <input type="number" id="ans-int" class="w-16 h-16 text-center border-2 border-brand-blue rounded-xl text-3xl font-black text-brand-blue outline-none focus:bg-blue-50 transition-colors" placeholder="0">
                    <span class="text-[10px] font-bold text-brand-blue mt-1 uppercase">Inteiros</span>
                </div>

                <div class="flex flex-col items-center pb-2">
                    <div class="flex flex-col items-center gap-1">
                        <input type="number" id="ans-num" class="w-12 h-10 text-center border-2 border-brand-purple rounded-lg text-xl font-bold text-brand-purple outline-none focus:bg-purple-50 transition-colors" placeholder="0">
                        <div class="w-full h-0.5 bg-gray-400"></div>
                        <div class="text-xl font-bold text-gray-500" id="ans-den">2</div>
                    </div>
                    <span class="text-[10px] font-bold text-brand-purple mt-1 uppercase">Sobra</span>
                </div>
            </div>

            <button id="btn-pack" class="w-full bg-brand-green text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all mt-2 uppercase tracking-widest">
                Empacotar
            </button>
        </div>

        <div id="packer-feedback" class="h-12 mt-4 flex items-center justify-center text-center font-bold text-sm z-10 w-full px-4"></div>

        <div class="absolute inset-0 opacity-5 pointer-events-none" style="background-image: radial-gradient(#000 1px, transparent 1px); background-size: 20px 20px;"></div>

    </div>
    `;

                    const reqN = container.querySelector("#req-n");
                    const reqD = container.querySelector("#req-d");
                    const ansInt = container.querySelector("#ans-int");
                    const ansNum = container.querySelector("#ans-num");
                    const ansDen = container.querySelector("#ans-den");
                    const lvlDisp = container.querySelector("#lvl-disp");
                    const btnPack = container.querySelector("#btn-pack");
                    const feedback = container.querySelector("#packer-feedback");

                    const loadLevel = () => {
                        if (currentLvl >= levels.length) {
                            container.innerHTML = `
                <div class="bg-green-100 border-4 border-green-400 rounded-xl p-8 text-center w-full">
                    <div class="text-6xl mb-4">üõµ</div>
                    <h3 class="text-2xl font-black text-brand-green">Entregas Feitas!</h3>
                    <p class="text-green-800 font-bold mt-2">Voc√™ dominou os n√∫meros mistos.</p>
                    <button onclick="app.renderLesson(document.getElementById('main-container'), app.currentLessonName)" class="mt-6 bg-white text-green-700 font-bold py-2 px-6 rounded-lg shadow-sm hover:bg-green-50">Reiniciar</button>
                </div>
            `;
                            return;
                        }

                        const l = levels[currentLvl];
                        reqN.innerText = l.n;
                        reqD.innerText = l.d;
                        ansDen.innerText = l.d; // Denominador j√° vem preenchido (n√£o muda)

                        ansInt.value = "";
                        ansNum.value = "";
                        lvlDisp.innerText = currentLvl + 1;
                        feedback.innerText = "";

                        btnPack.disabled = false;
                        btnPack.classList.remove("opacity-50", "cursor-not-allowed");
                    };

                    btnPack.onclick = () => {
                        const l = levels[currentLvl];
                        const uInt = parseInt(ansInt.value);
                        const uNum = parseInt(ansNum.value);

                        if (isNaN(uInt) || isNaN(uNum)) {
                            feedback.innerHTML = `<span class="text-brand-orange">Preencha os campos!</span>`;
                            return;
                        }

                        // Verifica a matem√°tica: (Inteiro * Den + Num) deve ser igual ao Numerador Original
                        const check = uInt * l.d + uNum;

                        // Verifica tamb√©m se o resto (num) √© menor que o divisor (den), sen√£o n√£o est√° simplificado
                        if (uNum >= l.d) {
                            feedback.innerHTML = `<span class="text-brand-orange">Ainda cabe mais pizza inteira! A sobra (${uNum}) √© maior que ${l.d}.</span>`;
                            return;
                        }

                        if (check === l.n) {
                            feedback.innerHTML = `<span class="text-brand-green flex items-center gap-2 justify-center"><i class="fas fa-check-circle"></i> Perfeito! ${uInt} pizzas e ${uNum}/${l.d}.</span>`;
                            btnPack.disabled = true;
                            btnPack.classList.add("opacity-50", "cursor-not-allowed");
                            setTimeout(() => {
                                currentLvl++;
                                loadLevel();
                            }, 1500);
                        } else {
                            feedback.innerHTML = `<span class="text-brand-red">Conta errada. ${uInt}x${l.d} + ${uNum} = ${check}. Precisamos de ${l.n}.</span>`;
                            container
                                .querySelector(".bg-white")
                                .classList.add("animate-shake");
                            setTimeout(
                                () =>
                                    container
                                        .querySelector(".bg-white")
                                        .classList.remove("animate-shake"),
                                500
                            );
                        }
                    };

                    loadLevel();
                },

                interactive_division_transformer(container) {
                    // Estado inicial
                    let num = 3;
                    let den = 4;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Laborat√≥rio de Equival√™ncia</h3>

        <div class="flex items-center gap-4 mb-8">
            <div class="flex flex-col items-center">
                <input type="number" id="in-n" value="${num}" class="w-16 text-center text-2xl font-black text-brand-blue border-b-2 border-blue-200 outline-none focus:border-brand-blue transition-colors">
                <span class="text-[10px] text-gray-400 uppercase font-bold mt-1">Numerador</span>
            </div>
            <div class="flex flex-col items-center">
                <input type="number" id="in-d" value="${den}" min="1" class="w-16 text-center text-2xl font-black text-brand-orange border-b-2 border-orange-200 outline-none focus:border-brand-orange transition-colors">
                <span class="text-[10px] text-gray-400 uppercase font-bold mt-1">Denominador</span>
            </div>
        </div>

        <div class="flex flex-col md:flex-row items-center justify-center gap-4 w-full bg-gray-50 rounded-2xl p-6 border border-gray-200">
            
            <div class="flex flex-col items-center group cursor-default transition-transform hover:scale-105">
                <div class="flex flex-col items-center text-4xl font-mono font-bold">
                    <span class="text-brand-blue" id="disp-n-frac">${num}</span>
                    <div class="w-12 h-1 bg-gray-800 my-1 rounded-full"></div>
                    <span class="text-brand-orange" id="disp-d-frac">${den}</span>
                </div>
                <span class="text-xs font-bold text-gray-400 mt-2 uppercase">Fra√ß√£o</span>
            </div>

            <div class="text-2xl text-gray-300"><i class="fas fa-equals"></i></div>

            <div class="flex flex-col items-center group cursor-default transition-transform hover:scale-105">
                <div class="flex items-center gap-2 text-3xl font-mono font-bold bg-white px-4 py-2 rounded-lg border border-gray-200 shadow-sm">
                    <span class="text-brand-blue" id="disp-n-div">${num}</span>
                    <span class="text-gray-600">√∑</span>
                    <span class="text-brand-orange" id="disp-d-div">${den}</span>
                </div>
                <span class="text-xs font-bold text-gray-400 mt-2 uppercase">Divis√£o</span>
            </div>

            <div class="text-2xl text-gray-300"><i class="fas fa-equals"></i></div>

            <div class="flex flex-col items-center group cursor-default transition-transform hover:scale-105">
                <div class="text-4xl font-mono font-black text-brand-green bg-green-50 px-4 py-2 rounded-lg border border-green-200 shadow-sm" id="disp-res">
                    0,75
                </div>
                <span class="text-xs font-bold text-green-600 mt-2 uppercase">Decimal</span>
            </div>

        </div>

        <p class="text-center text-sm text-gray-500 mt-6 italic">
            "A fra√ß√£o <strong class="text-brand-blue">${num}</strong> sobre <strong class="text-brand-orange">${den}</strong> √© o mesmo que dividir <strong class="text-brand-blue">${num}</strong> por <strong class="text-brand-orange">${den}</strong>."
        </p>

    </div>
    `;

                    const inN = container.querySelector("#in-n");
                    const inD = container.querySelector("#in-d");

                    const dispNFrac = container.querySelector("#disp-n-frac");
                    const dispDFrac = container.querySelector("#disp-d-frac");

                    const dispNDiv = container.querySelector("#disp-n-div");
                    const dispDDiv = container.querySelector("#disp-d-div");

                    const dispRes = container.querySelector("#disp-res");

                    const update = () => {
                        let n = parseFloat(inN.value) || 0;
                        let d = parseFloat(inD.value);

                        // Previne divis√£o por zero visualmente
                        if (isNaN(d) || d === 0) {
                            d = 1;
                            // N√£o alteramos o input para n√£o atrapalhar a digita√ß√£o, mas usamos 1 no c√°lculo
                        }

                        // Atualiza UI
                        dispNFrac.innerText = n;
                        dispDFrac.innerText = d;

                        dispNDiv.innerText = n;
                        dispDDiv.innerText = d;

                        const res = n / d;

                        // Formata decimal (max 4 casas) e troca ponto por v√≠rgula
                        let resFormatted = parseFloat(res.toFixed(4))
                            .toString()
                            .replace(".", ",");
                        dispRes.innerText = resFormatted;
                    };

                    inN.addEventListener("input", update);
                    inD.addEventListener("input", update);

                    update();
                },

                interactive_connection_game(container) {
                    // Configura√ß√£o dos Pares (Fra√ß√£o <-> Divis√£o/Decimal)
                    // Usamos IDs para identificar pares corretos
                    const levels = [
                        [
                            { id: 1, text: "1/2", type: "frac" },
                            { id: 1, text: "1 √∑ 2", type: "div" },
                            { id: 2, text: "3/4", type: "frac" },
                            { id: 2, text: "0,75", type: "dec" },
                            { id: 3, text: "1/5", type: "frac" },
                            { id: 3, text: "1 √∑ 5", type: "div" },
                            { id: 4, text: "4/2", type: "frac" },
                            { id: 4, text: "2", type: "dec" },
                        ],
                        [
                            { id: 5, text: "2/5", type: "frac" },
                            { id: 5, text: "0,4", type: "dec" },
                            { id: 6, text: "1/10", type: "frac" },
                            { id: 6, text: "0,1", type: "dec" },
                            { id: 7, text: "5/2", type: "frac" },
                            { id: 7, text: "2,5", type: "dec" },
                            { id: 8, text: "3/3", type: "frac" },
                            { id: 8, text: "1", type: "dec" },
                        ],
                    ];

                    let currentLevel = 0;
                    let selectedItem = null; // { el: element, id: number }
                    let matchesFound = 0;
                    let isLocked = false; // Trava cliques durante anima√ß√£o

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-300 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden min-h-[350px]">
        
        <div class="flex justify-between w-full items-center mb-4 z-10">
            <h3 class="font-black text-gray-500 uppercase text-xs tracking-widest"><i class="fas fa-link"></i> Conecte os Pares</h3>
            <div class="bg-white border border-gray-200 px-3 py-1 rounded-full text-xs font-black text-brand-blue">N√≠vel <span id="lvl-display">1</span></div>
        </div>

        <div id="game-grid" class="grid grid-cols-2 md:grid-cols-4 gap-3 w-full z-10">
            </div>

        <div id="win-screen" class="hidden absolute inset-0 bg-white/95 flex-col items-center justify-center z-20 animate-fade-in text-center p-6">
            <div class="text-6xl mb-4">üß©</div>
            <h3 class="text-2xl font-black text-brand-green mb-2">Conectado!</h3>
            <p class="text-gray-500 mb-6 font-medium">Voc√™ dominou as fra√ß√µes e divis√µes.</p>
            <button id="btn-next-lvl" class="bg-brand-blue text-white font-bold py-3 px-8 rounded-full shadow-lg active:scale-95 transition-all">Pr√≥ximo N√≠vel</button>
        </div>

    </div>
    `;

                    const grid = container.querySelector("#game-grid");
                    const winScreen = container.querySelector("#win-screen");
                    const lvlDisplay = container.querySelector("#lvl-display");
                    const btnNext = container.querySelector("#btn-next-lvl");

                    const renderLevel = () => {
                        if (currentLevel >= levels.length) {
                            winScreen.classList.remove("hidden");
                            winScreen.classList.add("flex");
                            winScreen.querySelector("h3").innerText =
                                "Mestre das Conex√µes!";
                            winScreen.querySelector("p").innerText =
                                "Voc√™ completou todos os n√≠veis.";
                            btnNext.innerText = "Reiniciar Tudo";
                            btnNext.onclick = () => {
                                currentLevel = 0;
                                renderLevel();
                            };
                            return;
                        }

                        lvlDisplay.innerText = currentLevel + 1;
                        winScreen.classList.add("hidden");
                        winScreen.classList.remove("flex");

                        // Embaralha
                        const cards = [...levels[currentLevel]].sort(
                            () => Math.random() - 0.5
                        );

                        matchesFound = 0;
                        selectedItem = null;
                        isLocked = false;
                        grid.innerHTML = "";

                        cards.forEach((card) => {
                            const el = document.createElement("button");

                            // Estilo visual baseado no tipo (Fra√ß√£o = Azul, Divis√£o = Laranja, Decimal = Verde)
                            let colorClass = "text-gray-700 border-gray-300";
                            if (card.type === "frac")
                                colorClass = "text-brand-blue border-blue-200 bg-blue-50";
                            if (card.type === "div")
                                colorClass =
                                    "text-brand-orange border-orange-200 bg-orange-50";
                            if (card.type === "dec")
                                colorClass = "text-brand-green border-green-200 bg-green-50";

                            el.className = `w-full h-20 rounded-xl border-b-4 font-black text-xl shadow-sm transition-all active:scale-95 flex items-center justify-center ${colorClass} hover:brightness-95`;
                            el.innerHTML = card.text;

                            el.onclick = () => handleCardClick(el, card.id);
                            grid.appendChild(el);
                        });
                    };

                    const handleCardClick = (el, id) => {
                        if (
                            isLocked ||
                            el.classList.contains("opacity-0") ||
                            el === selectedItem?.el
                        )
                            return;

                        el.classList.add("ring-4", "ring-brand-purple", "scale-105");

                        if (!selectedItem) {
                            // Primeiro clique
                            selectedItem = { el, id };
                        } else {
                            // Segundo clique - Verifica Par
                            isLocked = true;

                            if (selectedItem.id === id) {
                                // Match!
                                setTimeout(() => {
                                    el.classList.replace("border-b-4", "border-0");
                                    el.classList.add(
                                        "bg-green-400",
                                        "text-white",
                                        "scale-110",
                                        "rotate-3"
                                    );
                                    selectedItem.el.classList.replace("border-b-4", "border-0");
                                    selectedItem.el.classList.add(
                                        "bg-green-400",
                                        "text-white",
                                        "scale-110",
                                        "-rotate-3"
                                    );

                                    setTimeout(() => {
                                        el.classList.add("opacity-0", "pointer-events-none");
                                        selectedItem.el.classList.add(
                                            "opacity-0",
                                            "pointer-events-none"
                                        );

                                        matchesFound++;
                                        selectedItem = null;
                                        isLocked = false;

                                        // Verifica Fim do N√≠vel
                                        if (matchesFound === levels[currentLevel].length / 2) {
                                            setTimeout(() => {
                                                if (currentLevel < levels.length - 1) {
                                                    currentLevel++;
                                                    renderLevel();
                                                } else {
                                                    // Fim do jogo
                                                    currentLevel++;
                                                    renderLevel(); // Vai acionar a tela de fim
                                                }
                                            }, 500);
                                        }
                                    }, 600);
                                }, 200);
                            } else {
                                // Erro
                                setTimeout(() => {
                                    el.classList.add(
                                        "bg-red-400",
                                        "text-white",
                                        "animate-shake"
                                    );
                                    selectedItem.el.classList.add(
                                        "bg-red-400",
                                        "text-white",
                                        "animate-shake"
                                    );

                                    setTimeout(() => {
                                        el.classList.remove(
                                            "ring-4",
                                            "ring-brand-purple",
                                            "scale-105",
                                            "bg-red-400",
                                            "text-white",
                                            "animate-shake"
                                        );
                                        selectedItem.el.classList.remove(
                                            "ring-4",
                                            "ring-brand-purple",
                                            "scale-105",
                                            "bg-red-400",
                                            "text-white",
                                            "animate-shake"
                                        );
                                        selectedItem = null;
                                        isLocked = false;
                                    }, 800);
                                }, 200);
                            }
                        }
                    };

                    btnNext.onclick = () => {
                        currentLevel = 0; // Reinicia se estiver no fim
                        renderLevel();
                    };

                    // CSS para Shake se n√£o existir
                    if (!document.getElementById("anim-shake")) {
                        const s = document.createElement("style");
                        s.id = "anim-shake";
                        s.innerHTML = `@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } } .animate-shake { animation: shake 0.3s ease-in-out; }`;
                        container.appendChild(s);
                    }

                    renderLevel();
                },

                interactive_simplification_machine(container) {
                    // Estado inicial
                    let currentN = 24;
                    let currentD = 36;
                    let initialN = 24;
                    let initialD = 36;

                    // Helper MDC
                    const gcd = (a, b) => (b === 0 ? a : gcd(b, a % b));

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Triturador de Fra√ß√µes</h3>

        <div class="flex items-center gap-6 mb-8 transition-all duration-300" id="machine-display">
            
            <div class="flex flex-col items-center group relative">
                <input type="number" id="simp-n" value="${currentN}" class="w-20 text-center text-4xl font-black text-brand-blue bg-transparent outline-none border-b-4 border-transparent focus:border-blue-200 transition-colors">
                <span class="text-[10px] text-gray-400 font-bold uppercase absolute -top-4">Numerador</span>
            </div>

            <div class="h-20 w-2 bg-gray-300 rounded-full"></div>

            <div class="flex flex-col items-center group relative">
                <input type="number" id="simp-d" value="${currentD}" class="w-20 text-center text-4xl font-black text-brand-orange bg-transparent outline-none border-b-4 border-transparent focus:border-orange-200 transition-colors">
                <span class="text-[10px] text-gray-400 font-bold uppercase absolute -top-4">Denominador</span>
            </div>

        </div>

        <p class="text-xs text-gray-500 font-bold mb-2">Dividir por:</p>
        <div class="flex flex-wrap justify-center gap-3 w-full max-w-xs mb-6">
            <button class="div-btn w-12 h-12 rounded-full bg-white border-2 border-gray-200 text-gray-600 font-bold text-lg hover:border-brand-purple hover:text-brand-purple hover:bg-purple-50 transition-all active:scale-90 shadow-sm" data-div="2">√∑2</button>
            <button class="div-btn w-12 h-12 rounded-full bg-white border-2 border-gray-200 text-gray-600 font-bold text-lg hover:border-brand-purple hover:text-brand-purple hover:bg-purple-50 transition-all active:scale-90 shadow-sm" data-div="3">√∑3</button>
            <button class="div-btn w-12 h-12 rounded-full bg-white border-2 border-gray-200 text-gray-600 font-bold text-lg hover:border-brand-purple hover:text-brand-purple hover:bg-purple-50 transition-all active:scale-90 shadow-sm" data-div="5">√∑5</button>
            <button class="div-btn w-12 h-12 rounded-full bg-white border-2 border-brand-purple text-brand-purple font-bold text-lg hover:bg-purple-600 hover:text-white transition-all active:scale-90 shadow-sm" id="btn-mdc">MDC</button>
        </div>

        <div id="simp-feedback" class="h-8 text-sm font-bold text-center w-full mb-2"></div>
        
        <button id="btn-reset-simp" class="text-xs font-bold text-gray-400 uppercase hover:text-brand-blue underline">Nova Fra√ß√£o</button>

    </div>
    `;

                    const inpN = container.querySelector("#simp-n");
                    const inpD = container.querySelector("#simp-d");
                    const feedback = container.querySelector("#simp-feedback");
                    const divBtns = container.querySelectorAll(".div-btn");
                    const btnMdc = container.querySelector("#btn-mdc");
                    const btnReset = container.querySelector("#btn-reset-simp");
                    const display = container.querySelector("#machine-display");

                    const updateInputs = () => {
                        inpN.value = currentN;
                        inpD.value = currentD;
                        checkIrreducible();
                    };

                    const checkIrreducible = () => {
                        const common = gcd(currentN, currentD);
                        if (common === 1) {
                            feedback.innerHTML = `<span class="text-brand-green flex items-center justify-center gap-2 animate-pop-in"><i class="fas fa-gem"></i> √â Irredut√≠vel!</span>`;
                            display.classList.add("scale-110");
                            // Desabilita bot√µes
                            divBtns.forEach((b) =>
                                b.classList.add("opacity-50", "pointer-events-none")
                            );
                        } else {
                            feedback.innerHTML = `<span class="text-gray-400">Ainda d√° para simplificar...</span>`;
                            display.classList.remove("scale-110");
                            divBtns.forEach((b) =>
                                b.classList.remove("opacity-50", "pointer-events-none")
                            );
                        }
                    };

                    const tryDivide = (divisor) => {
                        if (currentN % divisor === 0 && currentD % divisor === 0) {
                            // Sucesso
                            currentN /= divisor;
                            currentD /= divisor;

                            // Anima√ß√£o Flash Verde
                            inpN.classList.add("text-green-500", "scale-125");
                            inpD.classList.add("text-green-500", "scale-125");
                            setTimeout(() => {
                                inpN.classList.remove("text-green-500", "scale-125");
                                inpD.classList.remove("text-green-500", "scale-125");
                                updateInputs();
                            }, 300);
                        } else {
                            // Erro
                            feedback.innerHTML = `<span class="text-brand-red animate-shake inline-block">N√£o divide os dois!</span>`;
                            setTimeout(() => checkIrreducible(), 1000);
                        }
                    };

                    const useMDC = () => {
                        const common = gcd(currentN, currentD);
                        if (common > 1) {
                            tryDivide(common);
                        }
                    };

                    // Listeners
                    divBtns.forEach((btn) => {
                        if (btn.id !== "btn-mdc") {
                            btn.onclick = () => tryDivide(parseInt(btn.dataset.div));
                        }
                    });

                    btnMdc.onclick = useMDC;

                    btnReset.onclick = () => {
                        // Gera nova fra√ß√£o aleat√≥ria redut√≠vel
                        const factor = Math.floor(Math.random() * 5) + 2; // Multiplicador comum
                        const a = Math.floor(Math.random() * 10) + 1;
                        const b = Math.floor(Math.random() * 10) + a; // b >= a

                        currentN = a * factor;
                        currentD = b * factor;
                        initialN = currentN;
                        initialD = currentD;

                        updateInputs();
                    };

                    // Input manual
                    const handleManualInput = () => {
                        currentN = parseInt(inpN.value) || 1;
                        currentD = parseInt(inpD.value) || 1;
                        checkIrreducible();
                    };
                    inpN.onchange = handleManualInput;
                    inpD.onchange = handleManualInput;

                    updateInputs();
                },

                interactive_diamond_mine(container) {
                    const levels = [
                        { n: 10, d: 20, ans: { n: 1, d: 2 }, hint: "Divide por 10?" },
                        { n: 6, d: 9, ans: { n: 2, d: 3 }, hint: "Tabuada do 3" },
                        { n: 12, d: 16, ans: { n: 3, d: 4 }, hint: "Divide por 4" },
                        { n: 15, d: 25, ans: { n: 3, d: 5 }, hint: "Termina em 5..." },
                        { n: 18, d: 24, ans: { n: 3, d: 4 }, hint: "Divide por 6" },
                    ];

                    let currentLvl = 0;
                    let score = 0;

                    // Helper MDC
                    const gcd = (a, b) => (b === 0 ? a : gcd(b, a % b));

                    container.innerHTML = `
    <div class="bg-gray-800 border-4 border-gray-600 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">
        
        <div class="flex justify-between w-full items-center mb-6 z-10">
            <h3 class="font-black uppercase text-xs tracking-widest text-gray-400">Mina Subterr√¢nea</h3>
            <div class="bg-gray-700 px-3 py-1 rounded-full text-xs font-black text-yellow-400">Ouro: <span id="mine-score">0</span></div>
        </div>

        <div class="relative w-48 h-48 flex items-center justify-center mb-8 z-10">
            <svg viewBox="0 0 200 200" class="absolute inset-0 w-full h-full text-gray-600 drop-shadow-xl" id="rock-svg">
                <path d="M40,100 L70,40 L150,50 L180,120 L130,170 L60,160 Z" fill="currentColor" stroke="#4B5563" stroke-width="4" />
            </svg>
            
            <div class="relative z-10 flex flex-col items-center">
                <span class="text-4xl font-black text-gray-300 drop-shadow-md" id="rock-n">10</span>
                <div class="w-16 h-1 bg-gray-400 my-1 rounded-full"></div>
                <span class="text-4xl font-black text-gray-300 drop-shadow-md" id="rock-d">20</span>
            </div>

            <div id="particles" class="absolute inset-0 pointer-events-none"></div>
        </div>

        <p class="text-xs text-gray-400 font-bold uppercase mb-2 z-10">Escolha a picareta (Divisor):</p>
        <div class="flex gap-3 z-10" id="tools-container">
            </div>

        <div id="mine-feedback" class="h-8 mt-4 font-bold text-sm text-center z-10"></div>

        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/black-scales.png')] opacity-30 z-0"></div>

    </div>
    `;

                    const rockN = container.querySelector("#rock-n");
                    const rockD = container.querySelector("#rock-d");
                    const tools = container.querySelector("#tools-container");
                    const feedback = container.querySelector("#mine-feedback");
                    const scoreEl = container.querySelector("#mine-score");
                    const rockSvg = container.querySelector("#rock-svg");

                    let currentN = 10;
                    let currentD = 20;

                    const loadLevel = () => {
                        if (currentLvl >= levels.length) {
                            container.innerHTML = `
                <div class="bg-green-600 border-4 border-green-800 rounded-xl p-8 text-center w-full text-white">
                    <div class="text-6xl mb-4">üíé</div>
                    <h3 class="text-2xl font-black">Mina Esgotada!</h3>
                    <p class="mt-2">Voc√™ encontrou todos os diamantes.</p>
                    <button onclick="app.renderLesson(document.getElementById('main-container'), app.currentLessonName)" class="mt-6 bg-white text-green-700 font-bold py-2 px-6 rounded-lg hover:bg-green-50">Reiniciar</button>
                </div>
            `;
                            return;
                        }

                        const l = levels[currentLvl];
                        currentN = l.n;
                        currentD = l.d;
                        updateRock();

                        // Gera ferramentas (divisores poss√≠veis + errados)
                        const common = gcd(currentN, currentD);
                        const opts = new Set();

                        // Adiciona divisores v√°lidos
                        if (common % 2 === 0) opts.add(2);
                        if (common % 3 === 0) opts.add(3);
                        if (common % 5 === 0) opts.add(5);
                        if (common > 1 && ![2, 3, 5].includes(common)) opts.add(common); // O pr√≥prio MDC se for primo grande

                        // Adiciona iscas
                        while (opts.size < 4) {
                            const r = [2, 3, 4, 5, 6, 7, 8, 9, 10][
                                Math.floor(Math.random() * 9)
                            ];
                            opts.add(r);
                        }

                        const sortedOpts = Array.from(opts).sort((a, b) => a - b);

                        tools.innerHTML = "";
                        sortedOpts.forEach((div) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "w-12 h-12 bg-gray-700 border-b-4 border-gray-900 rounded-lg text-white font-black text-xl hover:bg-gray-600 active:border-b-0 active:translate-y-1 transition-all shadow-lg flex items-center justify-center";
                            btn.innerHTML = `<span class="text-xs absolute top-1 left-1 opacity-50">√∑</span>${div}`;
                            btn.onclick = () => hitRock(div, btn);
                            tools.appendChild(btn);
                        });
                    };

                    const updateRock = () => {
                        rockN.innerText = currentN;
                        rockD.innerText = currentD;

                        // Verifica se terminou o n√≠vel
                        if (gcd(currentN, currentD) === 1) {
                            // N√≠vel completo!
                            feedback.innerHTML = `<span class="text-brand-yellow drop-shadow-md">üíé DIAMANTE ENCONTRADO!</span>`;
                            rockSvg.classList.add("text-blue-400"); // Vira diamante
                            rockN.classList.add("text-white");

                            setTimeout(() => {
                                score += 100;
                                scoreEl.innerText = score;
                                currentLvl++;
                                rockSvg.classList.remove("text-blue-400");
                                rockSvg.classList.add("text-gray-600");
                                feedback.innerText = "";
                                loadLevel();
                            }, 1500);
                        }
                    };

                    const hitRock = (div, btn) => {
                        if (currentN % div === 0 && currentD % div === 0) {
                            // Acerto (Divide)
                            currentN /= div;
                            currentD /= div;

                            // Anima√ß√£o de Batida
                            rockSvg.parentElement.classList.add("animate-shake");
                            setTimeout(
                                () => rockSvg.parentElement.classList.remove("animate-shake"),
                                300
                            );

                            // Som/Feedback
                            feedback.innerHTML = `<span class="text-green-400">Quebrou!</span>`;
                            updateRock();

                            // Se ainda n√£o acabou, recarrega bot√µes para novos divisores poss√≠veis
                            if (gcd(currentN, currentD) > 1) {
                                // loadLevel(); // N√£o, mantemos os bot√µes ou atualizamos?
                                // Melhor manter se ainda for divis√≠vel, ou atualizar se o divisor n√£o servir mais.
                                // Simplifica√ß√£o: apenas desabilita o bot√£o se n√£o servir mais
                                if (currentN % div !== 0 || currentD % div !== 0) {
                                    btn.disabled = true;
                                    btn.classList.add("opacity-50", "cursor-not-allowed");
                                }
                            } else {
                                tools.innerHTML = ""; // Limpa bot√µes na vit√≥ria
                            }
                        } else {
                            // Erro
                            btn.classList.add("bg-red-600", "border-red-800");
                            feedback.innerHTML = `<span class="text-red-400">A picareta quebrou! N√£o divide.</span>`;
                            setTimeout(() => {
                                btn.classList.remove("bg-red-600", "border-red-800");
                            }, 500);
                            score = Math.max(0, score - 10);
                            scoreEl.innerText = score;
                        }
                    };

                    // CSS Shake inline se n√£o existir
                    if (!document.getElementById("anim-shake")) {
                        const s = document.createElement("style");
                        s.id = "anim-shake";
                        s.innerHTML = `@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } } .animate-shake { animation: shake 0.3s ease-in-out; }`;
                        container.appendChild(s);
                    }

                    loadLevel();
                },

                interactive_fraction_balance(container) {
                    let n1 = 1,
                        d1 = 2;
                    let n2 = 3,
                        d2 = 5;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Comparador Visual</h3>

        <div class="w-full max-w-md bg-gray-50 rounded-xl p-4 border border-gray-200 mb-6 relative">
            
            <div class="mb-4">
                <div class="flex justify-between text-xs font-bold text-gray-500 mb-1">
                    <span>Fra√ß√£o A</span>
                    <span id="val-1">0.50</span>
                </div>
                <div class="relative h-10 w-full bg-gray-200 rounded-lg overflow-hidden shadow-inner">
                    <div id="bar-1" class="absolute top-0 left-0 h-full bg-brand-blue transition-all duration-500 flex items-center justify-end pr-2 text-white font-bold text-xs" style="width: 50%">
                        50%
                    </div>
                    <div class="absolute inset-0 w-full h-full" style="background-image: linear-gradient(90deg, transparent 99%, rgba(0,0,0,0.1) 99%); background-size: 10% 100%;"></div>
                </div>
            </div>

            <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 bg-white rounded-full border-2 border-gray-300 flex items-center justify-center font-black text-xl shadow-sm z-10" id="comp-sign">
                =
            </div>

            <div>
                <div class="flex justify-between text-xs font-bold text-gray-500 mb-1">
                    <span>Fra√ß√£o B</span>
                    <span id="val-2">0.60</span>
                </div>
                <div class="relative h-10 w-full bg-gray-200 rounded-lg overflow-hidden shadow-inner">
                    <div id="bar-2" class="absolute top-0 left-0 h-full bg-brand-orange transition-all duration-500 flex items-center justify-end pr-2 text-white font-bold text-xs" style="width: 60%">
                        60%
                    </div>
                    <div class="absolute inset-0 w-full h-full" style="background-image: linear-gradient(90deg, transparent 99%, rgba(0,0,0,0.1) 99%); background-size: 10% 100%;"></div>
                </div>
            </div>

        </div>

        <div class="flex gap-4 md:gap-12 w-full justify-center">
            
            <div class="flex flex-col items-center gap-1">
                <input type="number" id="in-n1" value="${n1}" class="w-14 text-center border-2 border-brand-blue rounded-lg font-bold text-xl text-brand-blue outline-none">
                <div class="w-12 h-0.5 bg-brand-blue"></div>
                <input type="number" id="in-d1" value="${d1}" min="1" class="w-14 text-center border-2 border-brand-blue rounded-lg font-bold text-xl text-brand-blue outline-none">
            </div>

            <div class="flex flex-col items-center gap-1">
                <input type="number" id="in-n2" value="${n2}" class="w-14 text-center border-2 border-brand-orange rounded-lg font-bold text-xl text-brand-orange outline-none">
                <div class="w-12 h-0.5 bg-brand-orange"></div>
                <input type="number" id="in-d2" value="${d2}" min="1" class="w-14 text-center border-2 border-brand-orange rounded-lg font-bold text-xl text-brand-orange outline-none">
            </div>

        </div>

        <div class="mt-6 text-center text-sm font-medium text-gray-500" id="cross-mult-info">
            </div>

    </div>
    `;

                    const inputs = container.querySelectorAll("input");
                    const bar1 = container.querySelector("#bar-1");
                    const bar2 = container.querySelector("#bar-2");
                    const val1El = container.querySelector("#val-1");
                    const val2El = container.querySelector("#val-2");
                    const compSign = container.querySelector("#comp-sign");
                    const crossInfo = container.querySelector("#cross-mult-info");

                    const update = () => {
                        n1 = parseFloat(container.querySelector("#in-n1").value) || 0;
                        d1 = parseFloat(container.querySelector("#in-d1").value) || 1;
                        n2 = parseFloat(container.querySelector("#in-n2").value) || 0;
                        d2 = parseFloat(container.querySelector("#in-d2").value) || 1;

                        if (d1 === 0) d1 = 1;
                        if (d2 === 0) d2 = 1;

                        const v1 = n1 / d1;
                        const v2 = n2 / d2;
                        const p1 = Math.min(v1 * 100, 100);
                        const p2 = Math.min(v2 * 100, 100);

                        // Atualiza Barras
                        bar1.style.width = `${p1}%`;
                        bar1.innerText = `${(v1 * 100).toFixed(1)}%`;
                        bar2.style.width = `${p2}%`;
                        bar2.innerText = `${(v2 * 100).toFixed(1)}%`;

                        val1El.innerText = v1.toFixed(3);
                        val2El.innerText = v2.toFixed(3);

                        // Compara
                        if (Math.abs(v1 - v2) < 0.0001) {
                            compSign.innerText = "=";
                            compSign.className =
                                "absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 bg-brand-green text-white rounded-full border-2 border-green-600 flex items-center justify-center font-black text-xl shadow-lg z-10 transition-all scale-110";
                        } else if (v1 > v2) {
                            compSign.innerText = ">";
                            compSign.className =
                                "absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 bg-brand-blue text-white rounded-full border-2 border-blue-600 flex items-center justify-center font-black text-xl shadow-lg z-10 transition-all";
                        } else {
                            compSign.innerText = "<";
                            compSign.className =
                                "absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 bg-brand-orange text-white rounded-full border-2 border-orange-600 flex items-center justify-center font-black text-xl shadow-lg z-10 transition-all";
                        }

                        // Explica√ß√£o Cruzada
                        const c1 = n1 * d2;
                        const c2 = n2 * d1;
                        crossInfo.innerHTML = `
            Prova Real (Cruzada):<br>
            <span class="text-brand-blue">${n1}</span> √ó <span class="text-brand-orange">${d2}</span> = <strong>${c1}</strong>
            &nbsp; vs &nbsp;
            <span class="text-brand-orange">${n2}</span> √ó <span class="text-brand-blue">${d1}</span> = <strong>${c2}</strong>
        `;
                    };

                    inputs.forEach((i) => (i.oninput = update));
                    update();
                },

                interactive_fraction_war(container) {
                    let score = 0;
                    let round = 1;
                    const maxRounds = 5;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[400px]">
        
        <div class="flex justify-between w-full z-10 mb-4 items-center">
            <div class="text-white font-black text-lg italic">WAR <span class="text-brand-red text-xs">FRACTIONS</span></div>
            <div class="bg-gray-700 border border-gray-600 px-3 py-1 rounded-full text-xs font-bold text-white">
                Rodada <span id="war-round">1</span>/5
            </div>
            <div class="text-brand-yellow font-black text-xl">‚òÖ <span id="war-score">0</span></div>
        </div>

        <div class="flex-1 w-full flex items-center justify-center gap-4 md:gap-8 z-10 relative">
            
            <button id="card-l" class="war-card relative w-32 h-48 bg-white rounded-xl shadow-2xl transform transition-all duration-300 hover:scale-105 hover:-translate-y-2 border-b-8 border-gray-300 active:scale-95 group">
                <div class="absolute top-2 left-2 text-xs font-bold text-gray-400">Op√ß√£o A</div>
                <div class="flex flex-col items-center justify-center h-full text-5xl font-black text-brand-blue">
                    <span id="n-l">?</span>
                    <div class="w-16 h-1 bg-brand-blue my-2 rounded"></div>
                    <span id="d-l">?</span>
                </div>
            </button>

            <div class="text-2xl font-black text-white opacity-50">VS</div>

            <button id="card-r" class="war-card relative w-32 h-48 bg-white rounded-xl shadow-2xl transform transition-all duration-300 hover:scale-105 hover:-translate-y-2 border-b-8 border-gray-300 active:scale-95 group">
                <div class="absolute top-2 left-2 text-xs font-bold text-gray-400">Op√ß√£o B</div>
                <div class="flex flex-col items-center justify-center h-full text-5xl font-black text-brand-orange">
                    <span id="n-r">?</span>
                    <div class="w-16 h-1 bg-brand-orange my-2 rounded"></div>
                    <span id="d-r">?</span>
                </div>
            </button>

        </div>

        <p class="text-white text-sm font-bold mt-6 mb-2 z-10 animate-pulse" id="war-msg">Clique na MAIOR fra√ß√£o!</p>

        <div id="war-feedback" class="absolute inset-0 flex flex-col items-center justify-center bg-gray-900/90 z-20 hidden backdrop-blur-sm">
            <div class="text-6xl mb-2" id="fb-icon"></div>
            <h3 class="text-2xl font-black text-white mb-1" id="fb-title"></h3>
            <p class="text-gray-300 font-mono text-sm" id="fb-detail"></p>
            <button id="btn-next-war" class="mt-6 bg-brand-blue text-white font-bold py-2 px-8 rounded-full shadow-lg active:scale-95">Pr√≥xima</button>
        </div>

        <div id="war-end" class="absolute inset-0 flex flex-col items-center justify-center bg-gray-800 z-30 hidden">
            <div class="text-6xl mb-4">üèÜ</div>
            <h3 class="text-3xl font-black text-white mb-2">Fim de Jogo!</h3>
            <p class="text-gray-400 mb-6">Pontua√ß√£o Final: <span class="text-brand-yellow font-bold text-xl" id="final-score"></span></p>
            <button onclick="app.renderLesson(document.getElementById('main-container'), app.currentLessonName)" class="bg-white text-gray-900 font-bold py-3 px-8 rounded-full shadow-lg hover:bg-gray-100">Jogar Novamente</button>
        </div>

        <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-gray-800 via-gray-900 to-black z-0"></div>

    </div>
    `;

                    const cardL = container.querySelector("#card-l");
                    const cardR = container.querySelector("#card-r");

                    const nL = container.querySelector("#n-l");
                    const dL = container.querySelector("#d-l");
                    const nR = container.querySelector("#n-r");
                    const dR = container.querySelector("#d-r");

                    const scoreEl = container.querySelector("#war-score");
                    const roundEl = container.querySelector("#war-round");
                    const msg = container.querySelector("#war-msg");

                    const feedback = container.querySelector("#war-feedback");
                    const fbIcon = container.querySelector("#fb-icon");
                    const fbTitle = container.querySelector("#fb-title");
                    const fbDetail = container.querySelector("#fb-detail");
                    const btnNext = container.querySelector("#btn-next-war");
                    const endScreen = container.querySelector("#war-end");

                    let valL, valR;

                    const generateFraction = () => {
                        const n = Math.floor(Math.random() * 8) + 1;
                        const d = Math.floor(Math.random() * 8) + 2; // min 2
                        return { n, d, val: n / d };
                    };

                    const nextRound = () => {
                        if (round > maxRounds) {
                            endScreen.querySelector("#final-score").innerText = score;
                            endScreen.classList.remove("hidden");
                            return;
                        }

                        roundEl.innerText = round;
                        feedback.classList.add("hidden");

                        // Gera fra√ß√µes garantindo que n√£o sejam iguais
                        do {
                            const f1 = generateFraction();
                            const f2 = generateFraction();

                            nL.innerText = f1.n;
                            dL.innerText = f1.d;
                            valL = f1.val;

                            nR.innerText = f2.n;
                            dR.innerText = f2.d;
                            valR = f2.val;
                        } while (Math.abs(valL - valR) < 0.001); // Evita empate
                    };

                    const check = (choice) => {
                        // 'left' or 'right'
                        const isLeftWinner = valL > valR;
                        const isCorrect =
                            (choice === "left" && isLeftWinner) ||
                            (choice === "right" && !isLeftWinner);

                        if (isCorrect) {
                            score += 100;
                            scoreEl.innerText = score;
                            fbIcon.innerText = "üî•";
                            fbTitle.innerText = "VENCEU!";
                            fbTitle.className = "text-2xl font-black text-brand-green mb-1";
                        } else {
                            fbIcon.innerText = "‚ùÑÔ∏è";
                            fbTitle.innerText = "PERDEU...";
                            fbTitle.className = "text-2xl font-black text-brand-red mb-1";
                        }

                        fbDetail.innerHTML = `
            <span class="text-brand-blue">${valL.toFixed(
                            2
                        )}</span> vs <span class="text-brand-orange">${valR.toFixed(
                            2
                        )}</span>
        `;

                        feedback.classList.remove("hidden");
                    };

                    btnNext.onclick = () => {
                        round++;
                        nextRound();
                    };

                    cardL.onclick = () => check("left");
                    cardR.onclick = () => check("right");

                    nextRound();
                },

                interactive_fraction_same_denom(container) {
                    let n1 = 1;
                    let n2 = 2;
                    const den = 8; // Fixo para visualiza√ß√£o de pizza

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-green font-bold uppercase text-xs tracking-widest mb-6">Soma de Fatias</h3>

        <div class="flex flex-col md:flex-row items-center gap-4 md:gap-8 mb-8">
            
            <div class="flex flex-col items-center">
                <div class="relative w-24 h-24 mb-2">
                    <svg viewBox="0 0 100 100" class="w-full h-full transform -rotate-90">
                        <circle cx="50" cy="50" r="48" fill="#F3F4F6" stroke="#E5E7EB" stroke-width="2" />
                        <path id="slice-1" d="" fill="#1CB0F6" stroke="white" stroke-width="1" />
                        ${[...Array(8)]
                            .map(
                                (_, i) =>
                                    `<line x1="50" y1="50" x2="${50 + 48 * Math.cos((i * Math.PI) / 4)
                                    }" y2="${50 + 48 * Math.sin((i * Math.PI) / 4)
                                    }" stroke="white" stroke-width="1" />`
                            )
                            .join("")}
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center font-bold text-brand-blue drop-shadow-md">+${n1}</div>
                </div>
                <div class="flex items-center gap-2">
                    <button class="w-6 h-6 rounded bg-gray-200 hover:bg-gray-300 font-bold text-gray-600" onclick="app.widgets.updateSum(this, 1, -1)">-</button>
                    <span id="txt-n1" class="font-mono font-bold text-lg">${n1}</span>
                    <button class="w-6 h-6 rounded bg-gray-200 hover:bg-gray-300 font-bold text-gray-600" onclick="app.widgets.updateSum(this, 1, 1)">+</button>
                </div>
            </div>

            <div class="text-2xl font-black text-gray-300">+</div>

            <div class="flex flex-col items-center">
                <div class="relative w-24 h-24 mb-2">
                    <svg viewBox="0 0 100 100" class="w-full h-full transform -rotate-90">
                        <circle cx="50" cy="50" r="48" fill="#F3F4F6" stroke="#E5E7EB" stroke-width="2" />
                        <path id="slice-2" d="" fill="#FF9600" stroke="white" stroke-width="1" />
                        ${[...Array(8)]
                            .map(
                                (_, i) =>
                                    `<line x1="50" y1="50" x2="${50 + 48 * Math.cos((i * Math.PI) / 4)
                                    }" y2="${50 + 48 * Math.sin((i * Math.PI) / 4)
                                    }" stroke="white" stroke-width="1" />`
                            )
                            .join("")}
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center font-bold text-brand-orange drop-shadow-md">+${n2}</div>
                </div>
                <div class="flex items-center gap-2">
                    <button class="w-6 h-6 rounded bg-gray-200 hover:bg-gray-300 font-bold text-gray-600" onclick="app.widgets.updateSum(this, 2, -1)">-</button>
                    <span id="txt-n2" class="font-mono font-bold text-lg">${n2}</span>
                    <button class="w-6 h-6 rounded bg-gray-200 hover:bg-gray-300 font-bold text-gray-600" onclick="app.widgets.updateSum(this, 2, 1)">+</button>
                </div>
            </div>

            <div class="text-2xl font-black text-gray-300">=</div>

            <div class="flex flex-col items-center">
                <div class="relative w-32 h-32 mb-2 transition-transform duration-300 hover:scale-105">
                    <svg viewBox="0 0 100 100" class="w-full h-full transform -rotate-90">
                        <circle cx="50" cy="50" r="48" fill="#F3F4F6" stroke="#E5E7EB" stroke-width="2" />
                        <path id="slice-res-1" d="" fill="#1CB0F6" stroke="white" stroke-width="1" />
                        <path id="slice-res-2" d="" fill="#FF9600" stroke="white" stroke-width="1" />
                        ${[...Array(8)]
                            .map(
                                (_, i) =>
                                    `<line x1="50" y1="50" x2="${50 + 48 * Math.cos((i * Math.PI) / 4)
                                    }" y2="${50 + 48 * Math.sin((i * Math.PI) / 4)
                                    }" stroke="white" stroke-width="1" />`
                            )
                            .join("")}
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center flex-col">
                        <span id="res-frac" class="text-2xl font-black text-brand-green bg-white/80 px-2 rounded">3/8</span>
                    </div>
                </div>
            </div>

        </div>

        <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 text-center text-sm">
            <p>Denominador mant√©m <strong>8</strong>.</p>
            <p>Numerador: <span class="text-brand-blue font-bold">${n1}</span> + <span class="text-brand-orange font-bold">${n2}</span> = <span class="text-brand-green font-bold">${n1 + n2
                        }</span></p>
        </div>
    </div>
    `;

                    // Helpers
                    const getPath = (startIdx, count, total) => {
                        if (count <= 0) return "";
                        if (count >= total)
                            return `M 50 50 L 98 50 A 48 48 0 1 1 97.9 50 Z`; // C√≠rculo quase cheio

                        const startAngle = (startIdx * 360) / total;
                        const endAngle = ((startIdx + count) * 360) / total;

                        const x1 = 50 + 48 * Math.cos((startAngle * Math.PI) / 180);
                        const y1 = 50 + 48 * Math.sin((startAngle * Math.PI) / 180);
                        const x2 = 50 + 48 * Math.cos((endAngle * Math.PI) / 180);
                        const y2 = 50 + 48 * Math.sin((endAngle * Math.PI) / 180);

                        const largeArc = count > total / 2 ? 1 : 0;

                        return `M 50 50 L ${x1} ${y1} A 48 48 0 ${largeArc} 1 ${x2} ${y2} Z`;
                    };

                    const s1 = container.querySelector("#slice-1");
                    const s2 = container.querySelector("#slice-2");
                    const sr1 = container.querySelector("#slice-res-1");
                    const sr2 = container.querySelector("#slice-res-2");
                    const t1 = container.querySelector("#txt-n1");
                    const t2 = container.querySelector("#txt-n2");
                    const resFrac = container.querySelector("#res-frac");
                    const note = container.querySelector(".bg-gray-50 p:last-child");

                    const render = () => {
                        // Atualiza textos
                        t1.innerText = n1;
                        t2.innerText = n2;
                        resFrac.innerText = `${n1 + n2}/${den}`;
                        note.innerHTML = `Numerador: <span class="text-brand-blue font-bold">${n1}</span> + <span class="text-brand-orange font-bold">${n2}</span> = <span class="text-brand-green font-bold">${n1 + n2
                            }</span>`;

                        // Atualiza Paths
                        s1.setAttribute("d", getPath(0, n1, den));
                        s2.setAttribute("d", getPath(0, n2, den)); // Come√ßa do 0 tb para mostrar quantidade isolada

                        // Resultado (Empilhado)
                        sr1.setAttribute("d", getPath(0, n1, den));
                        sr2.setAttribute("d", getPath(n1, n2, den)); // Come√ßa onde n1 terminou
                    };

                    app.widgets.updateSum = (el, target, val) => {
                        if (target === 1) {
                            if (n1 + val >= 0 && n1 + val + n2 <= den) n1 += val;
                        } else {
                            if (n2 + val >= 0 && n1 + n2 + val <= den) n2 += val;
                        }
                        render();
                    };

                    render();
                },

                interactive_natural_mult_fraction(container) {
                    let multiplier = 3;
                    let num = 2;
                    const den = 5;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">O Gar√ßom Matem√°tico</h3>

        <div class="flex items-end gap-2 mb-8">
            <div class="flex flex-col items-center">
                <label class="text-[10px] uppercase font-bold text-gray-400">Pessoas</label>
                <input type="range" id="mult-slider" min="1" max="5" value="3" class="w-24 h-2 bg-purple-100 rounded-lg accent-brand-purple cursor-pointer">
                <span id="mult-val" class="text-3xl font-black text-brand-purple mt-1">3</span>
            </div>
            <div class="text-2xl font-bold text-gray-300 pb-2">√ó</div>
            <div class="flex flex-col items-center pb-2">
                <span class="text-[10px] uppercase font-bold text-gray-400 mb-1">Pedido (Fatias)</span>
                <div class="flex flex-col items-center font-bold text-xl text-gray-600 border border-gray-300 rounded px-3 py-1 bg-gray-50">
                    <span>${num}</span>
                    <div class="w-full h-0.5 bg-gray-400"></div>
                    <span>${den}</span>
                </div>
            </div>
        </div>

        <div class="flex flex-wrap justify-center gap-4 mb-6" id="delivery-area">
            </div>

        <div class="w-full bg-green-50 border-2 border-green-200 rounded-xl p-4 flex items-center justify-between animate-pop-in">
            <div class="text-sm text-green-800">
                <strong>Soma Repetida:</strong>
                <span id="sum-text">2 + 2 + 2 = 6</span>
            </div>
            <div class="flex flex-col items-center font-black text-brand-green text-2xl">
                <span id="res-num">6</span>
                <div class="w-full h-1 bg-brand-green rounded"></div>
                <span>${den}</span>
            </div>
        </div>
    </div>
    `;

                    const slider = container.querySelector("#mult-slider");
                    const valDisp = container.querySelector("#mult-val");
                    const deliveryArea = container.querySelector("#delivery-area");
                    const sumText = container.querySelector("#sum-text");
                    const resNum = container.querySelector("#res-num");

                    const update = () => {
                        multiplier = parseInt(slider.value);
                        valDisp.innerText = multiplier;

                        deliveryArea.innerHTML = "";
                        const sumParts = [];

                        // Gera Pratos
                        for (let i = 0; i < multiplier; i++) {
                            const plate = document.createElement("div");
                            plate.className = "relative w-16 h-16 animate-pop-in";
                            plate.style.animationDelay = `${i * 0.1}s`;

                            // SVG Pizza Pequena
                            plate.innerHTML = `
                <svg viewBox="0 0 100 100" class="w-full h-full transform -rotate-90">
                    <circle cx="50" cy="50" r="48" fill="#FFF" stroke="#DDD" stroke-width="2" />
                    <path d="M 50 50 L 50 2 A 48 48 0 0 1 ${50 +
                                48 * Math.cos((num / den) * 2 * Math.PI - Math.PI / 2)
                                } ${50 + 48 * Math.sin((num / den) * 2 * Math.PI - Math.PI / 2)
                                } Z" fill="#CE82FF" stroke="none" />
                    <text x="50" y="55" text-anchor="middle" fill="#555" font-size="20" font-weight="bold" transform="rotate(90 50 50)">${num}</text>
                </svg>
            `;
                            deliveryArea.appendChild(plate);
                            sumParts.push(num);
                        }

                        // Atualiza Texto
                        sumText.innerText =
                            sumParts.join(" + ") + " = " + num * multiplier;
                        resNum.innerText = num * multiplier;
                    };

                    slider.addEventListener("input", update);
                    update();
                },

                interactive_power_root_machine(container) {
                    let mode = "power"; // power | root
                    let exp = 2;
                    let n = 2,
                        d = 3;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">
        
        <div class="flex bg-gray-800 p-1 rounded-lg mb-8 w-full max-w-xs relative">
            <div id="mode-bg" class="absolute top-1 bottom-1 w-[calc(50%-4px)] bg-brand-yellow rounded-md shadow-sm transition-all duration-300 left-1"></div>
            <button id="btn-power" class="flex-1 py-2 z-10 text-xs font-bold uppercase transition-colors text-gray-900">Pot√™ncia (x¬≤)</button>
            <button id="btn-root" class="flex-1 py-2 z-10 text-xs font-bold uppercase transition-colors text-gray-400">Raiz (‚àö)</button>
        </div>

        <div class="flex items-center gap-4 mb-8 relative">
            
            <div class="flex items-center">
                <div id="op-symbol-left" class="text-4xl text-gray-500 font-light transition-all">(</div>
                <div class="flex flex-col items-center mx-2">
                    <span class="text-3xl font-bold">${n}</span>
                    <div class="w-full h-1 bg-white rounded my-1"></div>
                    <span class="text-3xl font-bold">${d}</span>
                </div>
                <div id="op-symbol-right" class="text-4xl text-gray-500 font-light transition-all">)</div>
                <div id="exp-val" class="text-xl font-bold text-brand-yellow mb-8 -ml-1 transition-all">2</div>
            </div>

            <div class="flex flex-col gap-4 text-brand-yellow opacity-50">
                <i class="fas fa-chevron-right animate-pulse"></i>
                <i class="fas fa-chevron-right animate-pulse"></i>
            </div>

            <div class="flex flex-col items-center bg-gray-800 p-4 rounded-xl border border-gray-600 shadow-inner">
                <div class="flex items-start animate-pop-in" id="res-top">
                    <span class="text-3xl font-bold">${n}</span>
                    <span class="text-sm font-bold text-brand-yellow mt-0 op-indicator">2</span>
                </div>
                <div class="w-full h-1 bg-gray-500 rounded my-1"></div>
                <div class="flex items-start animate-pop-in" id="res-bot">
                    <span class="text-3xl font-bold">${d}</span>
                    <span class="text-sm font-bold text-brand-yellow mt-0 op-indicator">2</span>
                </div>
            </div>

            <div class="text-2xl text-gray-500 font-bold">=</div>

            <div class="flex flex-col items-center">
                <span class="text-4xl font-black text-brand-green" id="final-n">4</span>
                <div class="w-full h-1 bg-brand-green rounded my-1"></div>
                <span class="text-4xl font-black text-brand-green" id="final-d">9</span>
            </div>

        </div>

        <p class="text-sm text-gray-400 italic" id="explain-text">O expoente 2 "chove" no 2 e no 3.</p>

        <button id="btn-trigger" class="mt-4 bg-brand-yellow text-yellow-900 font-black py-3 px-8 rounded-full shadow-[0_0_15px_rgba(255,200,0,0.4)] active:scale-95 transition-all">
            ACIONAR
        </button>

    </div>
    `;

                    const btnPower = container.querySelector("#btn-power");
                    const btnRoot = container.querySelector("#btn-root");
                    const modeBg = container.querySelector("#mode-bg");

                    const opLeft = container.querySelector("#op-symbol-left");
                    const opRight = container.querySelector("#op-symbol-right");
                    const expVal = container.querySelector("#exp-val");

                    const opIndicators = container.querySelectorAll(".op-indicator");
                    const finalN = container.querySelector("#final-n");
                    const finalD = container.querySelector("#final-d");
                    const explain = container.querySelector("#explain-text");
                    const btnTrigger = container.querySelector("#btn-trigger");

                    // Configura√ß√µes
                    // Para raiz, usaremos quadrados perfeitos: 4/9, 16/25, etc.
                    // Para pot√™ncia: 2/3, 1/2, 3/4.

                    const updateMode = () => {
                        if (mode === "power") {
                            modeBg.style.left = "4px";
                            btnPower.classList.replace("text-gray-400", "text-gray-900");
                            btnRoot.classList.replace("text-gray-900", "text-gray-400");

                            // Visual Pot√™ncia
                            n = 2;
                            d = 3;
                            opLeft.innerText = "(";
                            opRight.innerText = ")";
                            expVal.innerText = "2";
                            expVal.classList.remove("hidden");

                            opIndicators.forEach((el) => {
                                el.innerText = "2";
                                el.className =
                                    "text-sm font-bold text-brand-yellow mt-0 op-indicator"; // Superscript
                            });
                        } else {
                            modeBg.style.left = "calc(50% + 0px)";
                            btnPower.classList.replace("text-gray-900", "text-gray-400");
                            btnRoot.classList.replace("text-gray-400", "text-gray-900");

                            // Visual Raiz
                            n = 16;
                            d = 25;
                            opLeft.innerText = "‚àö";
                            opRight.innerText = "";
                            expVal.classList.add("hidden");
                            opLeft.style.transform = "scaleY(1.5)"; // Estica a raiz visualmente

                            opIndicators.forEach((el) => {
                                el.innerText = "‚àö";
                                el.className =
                                    "text-lg font-bold text-brand-yellow mr-1 order-first op-indicator"; // Prefix
                            });
                        }

                        // Atualiza n√∫meros base
                        const numSpans = container.querySelectorAll(".text-3xl");
                        numSpans[0].innerText = n;
                        numSpans[1].innerText = d;
                        numSpans[2].innerText = n;
                        numSpans[3].innerText = d;

                        trigger();
                    };

                    const trigger = () => {
                        // Anima√ß√£o Simples
                        finalN.classList.add("opacity-0");
                        finalD.classList.add("opacity-0");

                        setTimeout(() => {
                            let resN, resD;
                            if (mode === "power") {
                                resN = n * n;
                                resD = d * d;
                                explain.innerText = `O expoente 2 "chove" no ${n} e no ${d}.`;
                            } else {
                                resN = Math.sqrt(n);
                                resD = Math.sqrt(d);
                                explain.innerText = `A raiz se aplica ao ${n} e ao ${d} separadamente.`;
                            }

                            finalN.innerText = resN;
                            finalD.innerText = resD;

                            finalN.classList.remove("opacity-0");
                            finalN.classList.add("animate-pop-in");
                            finalD.classList.remove("opacity-0");
                            finalD.classList.add("animate-pop-in");
                        }, 300);
                    };

                    btnPower.onclick = () => {
                        mode = "power";
                        updateMode();
                    };
                    btnRoot.onclick = () => {
                        mode = "root";
                        updateMode();
                    };
                    btnTrigger.onclick = trigger;

                    updateMode();
                },

                interactive_decimal_zoom(container) {
                    // Estado
                    let level = 0; // 0=Unidade, 1=D√©cimo, 2=Cent√©simo
                    let selection = [0, 0]; // [decimo, centesimo]

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-4">
            <h3 class="text-brand-blue font-black uppercase text-xs tracking-widest">Microsc√≥pio Num√©rico</h3>
            <button id="btn-zoom-out" class="text-xs font-bold text-gray-400 uppercase hover:text-brand-blue disabled:opacity-30" disabled>
                <i class="fas fa-search-minus"></i> Voltar Zoom
            </button>
        </div>

        <div class="w-full relative h-32 bg-gray-50 border-2 border-gray-300 rounded-xl overflow-hidden flex items-end mb-6 transition-all" id="zoom-view">
            </div>

        <div class="text-center">
            <p class="text-[10px] font-bold text-gray-400 uppercase mb-1">Valor Atual</p>
            <div class="text-4xl font-mono font-black text-brand-text transition-all" id="val-display">0</div>
            <div class="text-sm font-bold text-brand-blue mt-1" id="level-label">Unidade</div>
        </div>

    </div>
    `;

                    const view = container.querySelector("#zoom-view");
                    const display = container.querySelector("#val-display");
                    const label = container.querySelector("#level-label");
                    const btnOut = container.querySelector("#btn-zoom-out");

                    const render = () => {
                        view.innerHTML = "";
                        btnOut.disabled = level === 0;

                        let start, end, step, colorClass;

                        if (level === 0) {
                            start = 0;
                            end = 1;
                            step = 0.1;
                            colorClass = "bg-brand-blue";
                            label.innerText = "Unidade (0 a 1)";
                            display.innerText = "0";
                        } else if (level === 1) {
                            start = selection[0];
                            end = start + 0.1;
                            step = 0.01;
                            colorClass = "bg-brand-orange";
                            label.innerText = "D√©cimos";
                            display.innerText = start.toFixed(1).replace(".", ",");
                        } else {
                            start = selection[0] + selection[1];
                            end = start + 0.01;
                            step = 0.001;
                            colorClass = "bg-brand-green";
                            label.innerText = "Cent√©simos";
                            display.innerText = start.toFixed(2).replace(".", ",");
                        }

                        // Renderiza 10 blocos
                        for (let i = 0; i < 10; i++) {
                            const val = start + i * step;
                            const block = document.createElement("div");
                            block.className = `flex-1 h-full border-r border-gray-300 relative group cursor-pointer hover:bg-gray-100 transition-colors flex flex-col justify-end items-center pb-2`;

                            // Texto do valor (ajuste de precis√£o float)
                            let txt = parseFloat(val.toFixed(3))
                                .toString()
                                .replace(".", ",");

                            block.innerHTML = `
                <span class="text-xs font-bold text-gray-400 group-hover:text-brand-text transition-colors z-10">${txt}</span>
                <div class="absolute bottom-0 left-0 w-full h-0 group-hover:h-full ${colorClass} opacity-20 transition-all duration-300"></div>
            `;

                            block.onclick = () => {
                                if (level < 2) {
                                    if (level === 0) selection[0] = val;
                                    if (level === 1) selection[1] = i * 0.01;
                                    level++;
                                    render();
                                }
                            };
                            view.appendChild(block);
                        }
                    };

                    btnOut.onclick = () => {
                        if (level > 0) {
                            level--;
                            render();
                        }
                    };

                    render();
                },

                interactive_division_equalizer(container) {
                    let n1 = 1.5;
                    let n2 = 0.03;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Equalizador de Casas</h3>

        <div class="flex items-center gap-4 text-2xl md:text-4xl font-mono font-bold text-gray-700 mb-8 bg-gray-50 p-4 rounded-xl border border-gray-200 transition-all duration-500" id="eq-display">
            <span id="d-n1" class="transition-all">1,5</span>
            <span class="text-brand-purple">√∑</span>
            <span id="d-n2" class="transition-all">0,03</span>
        </div>

        <div class="flex flex-col gap-4 w-full max-w-sm">
            <div class="flex justify-between items-center bg-blue-50 p-3 rounded-lg border border-blue-100">
                <span class="text-xs font-bold text-blue-800 uppercase">Casas Decimal 1</span>
                <div class="flex gap-2">
                    <button class="w-8 h-8 rounded bg-white text-blue-600 font-bold shadow-sm" onclick="app.widgets.updateEq(this, 1, -1)">-</button>
                    <span id="c1-count" class="font-black w-4 text-center">1</span>
                    <button class="w-8 h-8 rounded bg-white text-blue-600 font-bold shadow-sm" onclick="app.widgets.updateEq(this, 1, 1)">+</button>
                </div>
            </div>

            <div class="flex justify-between items-center bg-orange-50 p-3 rounded-lg border border-orange-100">
                <span class="text-xs font-bold text-orange-800 uppercase">Casas Decimal 2</span>
                <div class="flex gap-2">
                    <button class="w-8 h-8 rounded bg-white text-orange-600 font-bold shadow-sm" onclick="app.widgets.updateEq(this, 2, -1)">-</button>
                    <span id="c2-count" class="font-black w-4 text-center">2</span>
                    <button class="w-8 h-8 rounded bg-white text-orange-600 font-bold shadow-sm" onclick="app.widgets.updateEq(this, 2, 1)">+</button>
                </div>
            </div>
        </div>

        <button id="btn-eliminate" class="w-full max-w-xs mt-6 bg-gray-400 text-white font-bold py-3 rounded-xl shadow-sm transition-all pointer-events-none cursor-not-allowed">
            Iguale as casas primeiro!
        </button>

        <div id="eq-result" class="hidden mt-6 text-center animate-pop-in">
            <p class="text-xs text-gray-400 font-bold uppercase mb-1">Nova Conta (Sem V√≠rgula)</p>
            <div class="text-3xl font-black text-brand-green" id="clean-calc">150 √∑ 3</div>
            <div class="text-lg font-bold text-gray-600 mt-2">= 50</div>
        </div>

    </div>
    `;

                    const dN1 = container.querySelector("#d-n1");
                    const dN2 = container.querySelector("#d-n2");
                    const c1Count = container.querySelector("#c1-count");
                    const c2Count = container.querySelector("#c2-count");
                    const btn = container.querySelector("#btn-eliminate");
                    const resBox = container.querySelector("#eq-result");
                    const cleanCalc = container.querySelector("#clean-calc");
                    const displayBox = container.querySelector("#eq-display");

                    // Base values (strings to manip zeros easily)
                    let base1 = "1.5";
                    let base2 = "0.03";
                    let zeros1 = 0; // Zeros extras adicionados
                    let zeros2 = 0;

                    const getDecimalPlaces = (str) => {
                        if (!str.includes(".")) return 0;
                        return str.split(".")[1].length;
                    };

                    app.widgets.updateEq = (el, target, delta) => {
                        if (target === 1) {
                            if (delta > 0) zeros1++;
                            else if (zeros1 > 0) zeros1--;
                        } else {
                            if (delta > 0) zeros2++;
                            else if (zeros2 > 0) zeros2--;
                        }
                        render();
                    };

                    const render = () => {
                        // Constr√≥i strings com zeros
                        let s1 = base1 + "0".repeat(zeros1);
                        let s2 = base2 + "0".repeat(zeros2);

                        // Atualiza contadores visuais
                        const dec1 = getDecimalPlaces(s1);
                        const dec2 = getDecimalPlaces(s2);

                        c1Count.innerText = dec1;
                        c2Count.innerText = dec2;

                        // Atualiza Display
                        dN1.innerText = s1.replace(".", ",");
                        dN2.innerText = s2.replace(".", ",");

                        // Verifica Igualdade
                        if (dec1 === dec2 && dec1 > 0) {
                            btn.className =
                                "w-full max-w-xs mt-6 bg-brand-green text-white font-bold py-3 rounded-xl shadow-btn hover:bg-green-600 transition-all cursor-pointer animate-pulse";
                            btn.innerText = "CORTAR V√çRGULAS!";
                            btn.style.pointerEvents = "auto";

                            btn.onclick = () => {
                                // Elimina
                                const clean1 = parseInt(s1.replace(".", ""));
                                const clean2 = parseInt(s2.replace(".", ""));

                                cleanCalc.innerText = `${clean1} √∑ ${clean2}`;

                                // Anima√ß√£o
                                displayBox.classList.add("opacity-0", "translate-y-4");
                                btn.classList.add("hidden");
                                resBox.classList.remove("hidden");

                                // Resultado final calculado
                                const finalRes = clean1 / clean2;
                                resBox.lastElementChild.innerText = `= ${finalRes}`;
                            };
                        } else {
                            btn.className =
                                "w-full max-w-xs mt-6 bg-gray-400 text-white font-bold py-3 rounded-xl shadow-sm transition-all pointer-events-none cursor-not-allowed";
                            if (dec1 === dec2 && dec1 === 0)
                                btn.innerText = "J√° s√£o inteiros!";
                            else btn.innerText = "Iguale as casas primeiro!";
                            btn.onclick = null;

                            // Reset se necess√°rio
                            displayBox.classList.remove("opacity-0", "translate-y-4");
                            resBox.classList.add("hidden");
                            btn.classList.remove("hidden");
                        }
                    };

                    render();
                },

                interactive_cash_register(container) {
                    // Configura√ß√£o
                    let total = 0;
                    let paid = 0;
                    let changeDue = 0;
                    let currentChange = 0;

                    const money = [
                        { v: 50, img: "üíµ", label: "R$ 50" },
                        { v: 20, img: "üíµ", label: "R$ 20" },
                        { v: 10, img: "üíµ", label: "R$ 10" },
                        { v: 5, img: "üíµ", label: "R$ 5" },
                        { v: 2, img: "üíµ", label: "R$ 2" },
                        { v: 1, img: "ü™ô", label: "R$ 1" },
                        { v: 0.5, img: "ü™ô", label: "0,50" },
                        { v: 0.25, img: "ü™ô", label: "0,25" },
                        { v: 0.1, img: "ü™ô", label: "0,10" },
                        { v: 0.05, img: "ü™ô", label: "0,05" },
                    ];

                    container.innerHTML = `
    <div class="bg-gray-800 border-4 border-gray-600 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative">
        
        <div class="w-full bg-black border-4 border-gray-500 rounded-xl p-4 mb-4 text-green-400 font-mono shadow-inner relative overflow-hidden">
            <div class="flex justify-between text-sm opacity-70 mb-2">
                <span>TOTAL: R$ <span id="reg-total">0,00</span></span>
                <span>PAGO: R$ <span id="reg-paid">0,00</span></span>
            </div>
            <div class="text-right">
                <span class="text-xs text-red-400 uppercase mr-2">Troco a Devolver:</span>
                <span class="text-3xl font-bold text-white" id="reg-due">R$ 0,00</span>
            </div>
            <div class="text-right mt-2 pt-2 border-t border-gray-700">
                <span class="text-xs text-blue-400 uppercase mr-2">Sua Contagem:</span>
                <span class="text-2xl font-bold text-blue-300" id="reg-current">R$ 0,00</span>
            </div>
        </div>

        <div class="grid grid-cols-5 gap-2 w-full mb-4">
            ${money
                            .map(
                                (m) => `
                <button class="money-btn bg-gray-100 hover:bg-white border-b-4 border-gray-300 active:border-b-0 active:translate-y-1 rounded-lg p-1 flex flex-col items-center transition-all h-16 justify-center" data-v="${m.v}">
                    <span class="text-2xl">${m.img}</span>
                    <span class="text-[10px] font-bold text-gray-700">${m.label}</span>
                </button>
            `
                            )
                            .join("")}
        </div>

        <div class="flex gap-4 w-full">
            <button id="btn-clear-money" class="flex-1 bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-lg shadow-sm">Limpar</button>
            <button id="btn-give-change" class="flex-[2] bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg shadow-btn active:scale-95 transition-all">ENTREGAR TROCO</button>
        </div>

        <div id="cashier-feedback" class="absolute inset-0 bg-gray-900/95 z-20 hidden flex-col items-center justify-center text-center p-6">
            <div class="text-6xl mb-4" id="fb-icon"></div>
            <h3 class="text-2xl font-black text-white mb-2" id="fb-title"></h3>
            <button id="btn-next-customer" class="mt-6 bg-brand-blue text-white font-bold py-3 px-8 rounded-full shadow-lg active:scale-95 transition-all">Pr√≥ximo Cliente</button>
        </div>

    </div>
    `;

                    const elTotal = container.querySelector("#reg-total");
                    const elPaid = container.querySelector("#reg-paid");
                    const elDue = container.querySelector("#reg-due");
                    const elCurrent = container.querySelector("#reg-current");
                    const btns = container.querySelectorAll(".money-btn");
                    const btnClear = container.querySelector("#btn-clear-money");
                    const btnGive = container.querySelector("#btn-give-change");
                    const feedback = container.querySelector("#cashier-feedback");
                    const btnNext = container.querySelector("#btn-next-customer");

                    const fmt = (n) =>
                        n.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });

                    const newCustomer = () => {
                        // Gera valores aleat√≥rios realistas
                        // Custo: entre 5 e 90
                        total = (Math.floor(Math.random() * 8500) + 500) / 100; // 5.00 a 90.00

                        // Pagamento: Pr√≥xima nota arredondada ou valor redondo maior
                        if (total < 10) paid = 10;
                        else if (total < 20) paid = 20;
                        else if (total < 50) paid = 50;
                        else paid = 100;

                        // Adiciona centavos quebrados √†s vezes para complicar o troco
                        if (Math.random() > 0.5) {
                            total += 0.25; // Ex: 15.25
                        }

                        changeDue = parseFloat((paid - total).toFixed(2));
                        currentChange = 0;

                        elTotal.innerText = fmt(total);
                        elPaid.innerText = fmt(paid);
                        elDue.innerText = fmt(changeDue);
                        elCurrent.innerText = fmt(0);

                        feedback.classList.add("hidden");
                        feedback.classList.remove("flex");
                    };

                    const updateCurrent = () => {
                        elCurrent.innerText = fmt(currentChange);

                        if (Math.abs(currentChange - changeDue) < 0.001) {
                            elCurrent.classList.remove("text-blue-300", "text-red-400");
                            elCurrent.classList.add("text-green-400");
                        } else if (currentChange > changeDue) {
                            elCurrent.classList.add("text-red-400");
                        } else {
                            elCurrent.classList.add("text-blue-300");
                        }
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            const val = parseFloat(btn.dataset.v);
                            currentChange = parseFloat((currentChange + val).toFixed(2));
                            updateCurrent();
                        };
                    });

                    btnClear.onclick = () => {
                        currentChange = 0;
                        updateCurrent();
                    };

                    btnGive.onclick = () => {
                        const diff = Math.abs(currentChange - changeDue);
                        const icon = feedback.querySelector("#fb-icon");
                        const title = feedback.querySelector("#fb-title");

                        if (diff < 0.001) {
                            icon.innerText = "‚úÖ";
                            title.innerText = "Troco Correto!";
                            title.className = "text-2xl font-black text-brand-green mb-2";
                        } else {
                            icon.innerText = "üò°";
                            title.innerText = "Troco Errado!";
                            title.className = "text-2xl font-black text-brand-red mb-2";
                        }

                        feedback.classList.remove("hidden");
                        feedback.classList.add("flex");
                    };

                    btnNext.onclick = newCustomer;

                    newCustomer();
                },

                interactive_triangle_sorter(container) {
                    const triangles = [
                        {
                            type: "equilatero",
                            label: "3 Lados Iguais",
                            color: "text-red-500",
                            shape: "polygon(50% 0%, 0% 100%, 100% 100%)",
                        },
                        {
                            type: "isosceles",
                            label: "2 Lados Iguais",
                            color: "text-blue-500",
                            shape: "polygon(50% 0%, 20% 100%, 80% 100%)",
                        },
                        {
                            type: "escaleno",
                            label: "0 Lados Iguais",
                            color: "text-green-500",
                            shape: "polygon(20% 0%, 0% 100%, 100% 80%)",
                        },
                        {
                            type: "retangulo",
                            label: "1 √Çngulo Reto",
                            color: "text-purple-500",
                            shape: "polygon(0% 0%, 0% 100%, 100% 100%)",
                        },
                    ];

                    let current = null;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-300 rounded-xl p-4 flex flex-col items-center w-full shadow-lg select-none relative h-[400px]">
        
        <div class="flex justify-between w-full mb-4 z-10">
            <h3 class="font-black text-gray-500 uppercase text-xs tracking-widest">Tri-Separador</h3>
            <div class="bg-white px-3 py-1 rounded-full text-xs font-black text-brand-blue">Pontos: <span id="tri-score">0</span></div>
        </div>

        <div class="relative w-full flex-1 flex items-center justify-center mb-4">
            <div id="tri-card" class="w-32 h-32 bg-white rounded-xl shadow-xl flex flex-col items-center justify-center transition-all duration-300 cursor-grab active:cursor-grabbing z-20 border-b-4 border-gray-200">
                <div id="tri-shape" class="w-20 h-20 bg-brand-text mb-2 transition-all"></div>
                <span id="tri-label" class="text-[10px] font-bold text-gray-400 uppercase text-center px-2">...</span>
            </div>
            <div id="tri-feedback" class="absolute font-black text-4xl opacity-0 transition-opacity z-30"></div>
        </div>

        <div class="grid grid-cols-2 gap-2 w-full z-10">
            <button class="bin-btn bg-red-100 border-2 border-red-300 text-red-700 font-bold py-2 rounded-lg text-xs uppercase hover:bg-red-200" data-t="equilatero">Equil√°tero</button>
            <button class="bin-btn bg-blue-100 border-2 border-blue-300 text-blue-700 font-bold py-2 rounded-lg text-xs uppercase hover:bg-blue-200" data-t="isosceles">Is√≥sceles</button>
            <button class="bin-btn bg-green-100 border-2 border-green-300 text-green-700 font-bold py-2 rounded-lg text-xs uppercase hover:bg-green-200" data-t="escaleno">Escaleno</button>
            <button class="bin-btn bg-purple-100 border-2 border-purple-300 text-purple-700 font-bold py-2 rounded-lg text-xs uppercase hover:bg-purple-200" data-t="retangulo">Ret√¢ngulo</button>
        </div>

    </div>
    `;

                    const card = container.querySelector("#tri-card");
                    const shape = container.querySelector("#tri-shape");
                    const label = container.querySelector("#tri-label");
                    const feedback = container.querySelector("#tri-feedback");
                    const scoreEl = container.querySelector("#tri-score");
                    const bins = container.querySelectorAll(".bin-btn");

                    const spawn = () => {
                        current = triangles[Math.floor(Math.random() * triangles.length)];

                        // Configura visual
                        shape.style.clipPath = current.shape;
                        // Randomiza levemente a cor para dar variedade
                        shape.className = `w-20 h-20 mb-2 transition-all ${current.color.replace(
                            "text-",
                            "bg-"
                        )}`;
                        label.innerText = current.label; // Dica visual textual

                        // Reset posi√ß√£o
                        card.style.transform = "scale(0)";
                        setTimeout(() => (card.style.transform = "scale(1)"), 50);
                    };

                    const check = (type) => {
                        if (type === current.type) {
                            score += 10;
                            feedback.innerHTML = "‚úÖ";
                            feedback.className =
                                "absolute font-black text-4xl text-green-500 animate-pop-in z-30";
                        } else {
                            score = Math.max(0, score - 5);
                            feedback.innerHTML = "‚ùå";
                            feedback.className =
                                "absolute font-black text-4xl text-red-500 animate-pop-in z-30";
                            card.classList.add("animate-shake");
                        }

                        scoreEl.innerText = score;
                        setTimeout(() => {
                            card.classList.remove("animate-shake");
                            feedback.classList.add("opacity-0");
                            spawn();
                        }, 600);
                    };

                    bins.forEach((btn) => {
                        btn.onclick = () => check(btn.dataset.t);
                    });

                    spawn();
                },

                interactive_quad_lab(container) {
                    // Estado inicial (Quadrado)
                    const points = [
                        { x: 50, y: 50 }, // Top Left
                        { x: 200, y: 50 }, // Top Right
                        { x: 200, y: 200 }, // Bottom Right
                        { x: 50, y: 200 }, // Bottom Left
                    ];
                    let draggedIdx = -1;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-4 flex flex-col items-center w-full shadow-sm select-none">
        <h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-4">Modelador de Quadril√°teros</h3>
        
        <div class="relative w-full h-64 bg-gray-50 border border-gray-200 rounded-xl overflow-hidden cursor-crosshair touch-none" id="quad-canvas">
            <svg class="w-full h-full pointer-events-none">
                <path id="q-poly" d="" fill="rgba(28, 176, 246, 0.2)" stroke="#1CB0F6" stroke-width="2" />
                <line id="diag1" stroke="#1CB0F6" stroke-dasharray="4" opacity="0.3" />
                <line id="diag2" stroke="#1CB0F6" stroke-dasharray="4" opacity="0.3" />
            </svg>
            ${[0, 1, 2, 3]
                            .map(
                                (i) =>
                                    `<div class="absolute w-4 h-4 bg-brand-blue rounded-full border-2 border-white shadow-md cursor-pointer transform -translate-x-1/2 -translate-y-1/2 hover:scale-125 transition-transform" id="h-${i}"></div>`
                            )
                            .join("")}
        </div>

        <div class="mt-4 flex gap-2">
            <button class="text-xs font-bold bg-gray-100 px-3 py-1 rounded hover:bg-gray-200" id="reset-quad">Reiniciar (Quadrado)</button>
        </div>
        
        <p class="text-[10px] text-gray-400 mt-2 text-center">Arraste os pontos azuis para criar Trap√©zios ou Pipas!</p>
    </div>
    `;

                    const canvas = container.querySelector("#quad-canvas");
                    const path = container.querySelector("#q-poly");
                    const diag1 = container.querySelector("#diag1");
                    const diag2 = container.querySelector("#diag2");
                    const handles = [0, 1, 2, 3].map((i) =>
                        container.querySelector(`#h-${i}`)
                    );

                    const update = () => {
                        // SVG Path
                        const d = `M ${points[0].x} ${points[0].y} L ${points[1].x} ${points[1].y} L ${points[2].x} ${points[2].y} L ${points[3].x} ${points[3].y} Z`;
                        path.setAttribute("d", d);

                        // Diagonais
                        diag1.setAttribute("x1", points[0].x);
                        diag1.setAttribute("y1", points[0].y);
                        diag1.setAttribute("x2", points[2].x);
                        diag1.setAttribute("y2", points[2].y);
                        diag2.setAttribute("x1", points[1].x);
                        diag2.setAttribute("y1", points[1].y);
                        diag2.setAttribute("x2", points[3].x);
                        diag2.setAttribute("y2", points[3].y);

                        // Handles
                        handles.forEach((h, i) => {
                            h.style.left = `${points[i].x}px`;
                            h.style.top = `${points[i].y}px`;
                        });
                    };

                    const handleMove = (e) => {
                        if (draggedIdx === -1) return;
                        e.preventDefault(); // Evita scroll em touch

                        const rect = canvas.getBoundingClientRect();
                        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                        const clientY = e.touches ? e.touches[0].clientY : e.clientY;

                        let x = clientX - rect.left;
                        let y = clientY - rect.top;

                        // Limites
                        x = Math.max(0, Math.min(rect.width, x));
                        y = Math.max(0, Math.min(rect.height, y));

                        points[draggedIdx] = { x, y };
                        update();
                    };

                    handles.forEach((h, i) => {
                        const start = (e) => {
                            draggedIdx = i;
                            h.classList.add("bg-brand-orange"); // Highlight
                        };
                        h.addEventListener("mousedown", start);
                        h.addEventListener("touchstart", start);
                    });

                    const stop = () => {
                        if (draggedIdx !== -1)
                            handles[draggedIdx].classList.remove("bg-brand-orange");
                        draggedIdx = -1;
                    };

                    window.addEventListener("mousemove", handleMove);
                    window.addEventListener("touchmove", handleMove, {
                        passive: false,
                    });
                    window.addEventListener("mouseup", stop);
                    window.addEventListener("touchend", stop);

                    container.querySelector("#reset-quad").onclick = () => {
                        points[0] = { x: 50, y: 50 };
                        points[1] = { x: 200, y: 50 };
                        points[2] = { x: 200, y: 200 };
                        points[3] = { x: 50, y: 200 };
                        update();
                    };

                    update(); // Init
                },

                interactive_solid_unfolder(container) {
                    let progress = 0; // 0 = closed, 100 = open

                    container.innerHTML = `
    <div class="flex flex-col items-center w-full select-none">
        
        <div class="perspective-container relative w-48 h-48 mb-6" style="perspective: 800px;">
            <div id="cube-root" class="w-20 h-20 absolute top-1/2 left-1/2 -ml-10 -mt-10 transition-transform duration-100" style="transform-style: preserve-3d; transform: rotateX(-30deg) rotateY(45deg);">
                
                <div class="face absolute w-20 h-20 bg-brand-blue opacity-80 border border-white flex items-center justify-center font-bold text-white text-xl" style="transform: rotateX(-90deg) translateZ(40px);">B</div>
                
                <div class="face-m absolute w-20 h-20 bg-blue-400 opacity-80 border border-white origin-bottom flex items-center justify-center font-bold text-white" id="f-front" style="transform: translateZ(40px);">F</div>
                <div class="face-m absolute w-20 h-20 bg-blue-500 opacity-80 border border-white origin-bottom flex items-center justify-center font-bold text-white" id="f-back" style="transform: translateZ(-40px) rotateY(180deg);">T</div>
                <div class="face-m absolute w-20 h-20 bg-blue-300 opacity-80 border border-white origin-bottom flex items-center justify-center font-bold text-white" id="f-left" style="transform: translateX(-40px) rotateY(-90deg);">E</div>
                <div class="face-m absolute w-20 h-20 bg-blue-600 opacity-80 border border-white origin-bottom flex items-center justify-center font-bold text-white" id="f-right" style="transform: translateX(40px) rotateY(90deg);">D</div>
                <div class="face-m absolute w-20 h-20 bg-brand-orange opacity-90 border border-white origin-bottom flex items-center justify-center font-bold text-white" id="f-top" style="transform: translateY(-40px) rotateX(90deg);">C</div>

            </div>
        </div>

        <input type="range" id="unfold-slider" min="0" max="100" value="0" class="w-full max-w-xs h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-brand-blue">
        <div class="flex justify-between w-full max-w-xs text-xs font-bold text-gray-500 mt-2 uppercase">
            <span>Cubo (3D)</span>
            <span>Planificado (2D)</span>
        </div>

    </div>
    `;

                    const slider = container.querySelector("#unfold-slider");
                    const fFront = container.querySelector("#f-front");
                    const fBack = container.querySelector("#f-back");
                    const fLeft = container.querySelector("#f-left");
                    const fRight = container.querySelector("#f-right");
                    const fTop = container.querySelector("#f-top");
                    const root = container.querySelector("#cube-root");

                    const update = () => {
                        const p = parseInt(slider.value);
                        const factor = p / 100; // 0 to 1

                        // Rota√ß√£o do conjunto para melhor visualiza√ß√£o ao abrir
                        // Quando fechado: rotateX(-30) rotateY(45)
                        // Quando aberto: rotateX(0) rotateY(0) (vis√£o de cima plana)
                        const rotX = -30 * (1 - factor);
                        const rotY = 45 * (1 - factor);
                        root.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;

                        // Desdobramento das faces (l√≥gica simplificada de "cruz")
                        // Base est√° em rotateX(-90). As outras se abrem relativas a ela se mudarmos a origem?
                        // N√£o, vamos simplificar: transformar o cubo fechado na cruz plana no ch√£o.

                        // Front: De 90 deg (em p√©) para 0 deg (deitado) relativo √† base?
                        // Vamos animar as rota√ß√µes relativas ao centro do cubo para posi√ß√µes planas

                        // Isso requer CSS transforms complexos. Vamos usar uma aproxima√ß√£o visual.
                        // Fechado: Cubo normal. Aberto: Cruz plana.

                        // Usaremos transforma√ß√µes hardcoded interpoladas
                        // Base: rotateX(-90) translateZ(40) -> Fica fixa como centro da cruz.

                        // Front (Baixo na cruz):
                        // Fechado: translateZ(40)
                        // Aberto: rotateX(-90) translateZ(40) translateY(80) ... complexo.

                        // Vamos simplificar: Usar origins corretas nos elementos.
                        // O HTML j√° define origins 'bottom'. Isso ajuda a "cair".

                        // Front: origin-bottom. Est√° em Z=40. Se girar X -90, deita pra frente.
                        fFront.style.transform = `translateZ(40px) rotateX(${factor * -90
                            }deg)`;

                        // Back: origin-bottom. Est√° em Z=-40, rotY(180).
                        fBack.style.transform = `translateZ(-40px) rotateY(180deg) rotateX(${factor * -90
                            }deg)`;

                        // Left: origin-bottom.
                        fLeft.style.transform = `translateX(-40px) rotateY(-90deg) rotateX(${factor * -90
                            }deg)`;

                        // Right: origin-bottom.
                        fRight.style.transform = `translateX(40px) rotateY(90deg) rotateX(${factor * -90
                            }deg)`;

                        // Top (Tampa): Prende na Front (que est√° caindo).
                        // Isso requer aninhamento de DIVs ou c√°lculo composto.
                        // Vamos simular a tampa "voando" para a posi√ß√£o final da cruz (topo distante)
                        // Posi√ß√£o final: translateY(-200px) rotateX(-90) translateZ(40)

                        // Truque: Topo preso no Back.
                        // Se Back cai, Topo cai junto e depois gira mais 90.
                        // Mas Back e Top s√£o irm√£os no DOM.
                        // Vamos fazer Top apenas transladar e girar independentemente para a posi√ß√£o final visual
                        // Fechado: translateY(-40) rotateX(90)
                        // Aberto: translateY(-40) translateZ(-80) rotateX(0)? N√£o, vamos alinhar visualmente.

                        // Solu√ß√£o simples para o "Top":
                        // Ele vai girar para tr√°s (abrir a tampa)
                        fTop.style.transform = `translateY(-40px) rotateX(${90 + factor * 90
                            }deg)`;
                        // Isso abre a tampa. Para planificar total (ficar reto com o Back), precisaria mover junto com o Back.
                        // Complicado sem reestruturar o HTML.

                        // Hack Visual: Vamos apenas abrir a tampa em 90 graus (como uma caixa aberta) no slide 50%,
                        // e no 100% separar as faces (explode view) se n√£o conseguirmos a cruz perfeita.
                        // Ou melhor: Vamos manter a "Caixa se abrindo" (Flower unfolding).
                        // Todas as faces laterais caem 90 graus para fora.

                        // Reajuste origins para "flor":
                        // Base √© o ch√£o.
                        // Front (cai pra frente): rotateX(-90)
                        // Back (cai pra tr√°s): rotateX(90)
                        // Left (cai pra esq): rotateY(-90)
                        // Right (cai pra dir): rotateY(90)

                        // Ajustando estilos dinamicamente:
                        fFront.style.transformOrigin = "bottom center";
                        fFront.style.transform = `translateZ(40px) rotateX(${-factor * 90
                            }deg)`;

                        fBack.style.transformOrigin = "bottom center";
                        fBack.style.transform = `translateZ(-40px) rotateY(180deg) rotateX(${-factor * 90
                            }deg)`;

                        fLeft.style.transformOrigin = "bottom center";
                        fLeft.style.transform = `translateX(-40px) rotateY(-90deg) rotateX(${-factor * 90
                            }deg)`;

                        fRight.style.transformOrigin = "bottom center";
                        fRight.style.transform = `translateX(40px) rotateY(90deg) rotateX(${-factor * 90
                            }deg)`;

                        // Topo: Se move com Back (simulado)
                        // Transla√ß√£o Z acompanha a queda do Back
                        const angleRad = (factor * 90 * Math.PI) / 180;
                        const topY = -40 - Math.sin(angleRad) * 80; // Afasta
                        const topZ = -40 + Math.cos(angleRad) * 80; // Desce? N√£o, geometria complexa.

                        // Simplifica√ß√£o: Topo apenas levanta e some ou vai pra longe
                        fTop.style.transform = `translateY(-40px) rotateX(${90 + factor * 90
                            }deg)`;
                    };

                    slider.addEventListener("input", update);
                    update();
                },

                interactive_view_matcher(container) {
                    // Configura√ß√£o do Desafio
                    // Pe√ßa: L Shape 3D
                    const correctAns = { top: 1, front: 0, side: 2 }; // √çndices das imagens corretas
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-6">Desafio das Vistas</h3>

        <div class="flex flex-col md:flex-row gap-8 items-center justify-center w-full mb-8">
            
            <div class="relative w-40 h-40 bg-gray-50 rounded-xl border border-gray-200 flex items-center justify-center">
                <div class="text-xs font-bold text-gray-400 absolute top-2 left-2 uppercase">Objeto</div>
                
                <div class="relative w-20 h-20">
                    <div class="absolute bottom-0 left-0 w-8 h-8 bg-yellow-400 border border-yellow-600 transform skew-y-12"></div>
                    <div class="absolute bottom-4 left-4 w-8 h-8 bg-yellow-300 border border-yellow-500 transform skew-y-12"></div> <div class="absolute bottom-0 left-8 w-4 h-8 bg-yellow-600 border border-yellow-800 transform skew-y-[-45deg] origin-bottom-left"></div> <div class="absolute bottom-8 left-0 w-8 h-8 bg-yellow-400 border border-yellow-600 transform skew-y-12"></div>
                    <div class="absolute bottom-12 left-4 w-8 h-8 bg-yellow-300 border border-yellow-500 transform skew-y-12"></div>
                </div>
                
                <div class="absolute -right-4 bottom-4 text-brand-blue font-bold text-xs">‚Üí Frente</div>
                <div class="absolute top-0 right-0 text-brand-green font-bold text-xs">‚Üì Cima</div>
            </div>

            <div class="flex flex-col gap-4 w-full max-w-xs">
                
                <div>
                    <p class="text-xs font-bold text-brand-blue uppercase mb-2">Vista Frontal (Frente)</p>
                    <div class="flex gap-2">
                        <button class="view-opt flex-1 h-12 bg-gray-100 border-2 border-transparent hover:border-brand-blue rounded flex items-center justify-center text-xl" onclick="app.widgets.checkView(this, true)">L</button>
                        <button class="view-opt flex-1 h-12 bg-gray-100 border-2 border-transparent hover:border-brand-blue rounded flex items-center justify-center text-xl" onclick="app.widgets.checkView(this, false)">‚ñ¨</button>
                    </div>
                </div>

                <div>
                    <p class="text-xs font-bold text-brand-green uppercase mb-2">Vista Superior (Cima)</p>
                    <div class="flex gap-2">
                        <button class="view-opt flex-1 h-12 bg-gray-100 border-2 border-transparent hover:border-brand-green rounded flex items-center justify-center text-xl" onclick="app.widgets.checkView(this, false)">L</button>
                        <button class="view-opt flex-1 h-12 bg-gray-100 border-2 border-transparent hover:border-brand-green rounded flex items-center justify-center text-xl" onclick="app.widgets.checkView(this, true)">‚ñÆ</button>
                    </div>
                </div>

            </div>

        </div>

        <div id="view-feedback" class="h-8 font-bold text-sm text-center"></div>

    </div>
    `;

                    // Helper global para onclick
                    app.widgets.checkView = (btn, isCorrect) => {
                        // Reseta irm√£os
                        const parent = btn.parentElement;
                        Array.from(parent.children).forEach((b) => {
                            b.classList.remove("bg-green-500", "bg-red-500", "text-white");
                            b.classList.add("bg-gray-100");
                            b.disabled = false;
                        });

                        if (isCorrect) {
                            btn.classList.remove("bg-gray-100");
                            btn.classList.add("bg-green-500", "text-white");
                            // Feedback simples
                        } else {
                            btn.classList.remove("bg-gray-100");
                            btn.classList.add("bg-red-500", "text-white", "animate-shake");
                        }
                    };
                },

                interactive_coordinate_artist(container) {
                    // Configura√ß√£o: Cora√ß√£o 5x5
                    const targetPixels = [
                        "2,2",
                        "4,2",
                        "2,3",
                        "3,3",
                        "4,3",
                        "2,4",
                        "3,4",
                        "4,4",
                        "3,5",
                    ]; // Simplificado
                    // Vamos fazer um Smile simples 5x5
                    // O grid √© 0-5.
                    const targets = ["1,4", "3,4", "0,2", "1,1", "2,1", "3,1", "4,2"]; // Sorriso
                    let found = [];

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Artista de Coordenadas</h3>
        
        <div class="flex gap-4">
            <div class="flex flex-col justify-between py-2 h-64 text-xs font-bold text-gray-400">
                <span>5</span><span>4</span><span>3</span><span>2</span><span>1</span><span>0</span>
            </div>

            <div class="grid grid-cols-6 grid-rows-6 gap-1 bg-gray-200 p-1 rounded border-2 border-gray-300" id="pixel-grid" style="width: 260px; height: 260px;">
                ${[...Array(36)]
                            .map((_, i) => {
                                const x = i % 6;
                                const y = 5 - Math.floor(i / 6); // Inverte Y visualmente
                                return `<div class="bg-white rounded-sm cursor-pointer hover:bg-purple-100 transition-colors pixel-btn" data-coord="${x},${y}"></div>`;
                            })
                            .join("")}
            </div>
        </div>

        <div class="flex justify-between w-64 pl-6 text-xs font-bold text-gray-400 mt-1">
            <span>0</span><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
        </div>

        <div class="mt-4 text-center">
            <p class="text-sm font-bold text-gray-600 mb-2">Pinte: <span id="target-coords" class="font-mono text-brand-purple"></span></p>
            <div id="artist-feedback" class="h-6 text-xs font-bold text-brand-green"></div>
        </div>
    </div>
    `;

                    const grid = container.querySelector("#pixel-grid");
                    const targetText = container.querySelector("#target-coords");
                    const feedback = container.querySelector("#artist-feedback");
                    const pixels = container.querySelectorAll(".pixel-btn");

                    // Mostra o pr√≥ximo alvo
                    const updateTarget = () => {
                        const remaining = targets.filter((t) => !found.includes(t));
                        if (remaining.length === 0) {
                            targetText.innerText = "Desenho Completo! (Sorriso)";
                            feedback.innerText = "Parab√©ns!";
                            return;
                        }
                        targetText.innerText = `(${remaining[0].replace(",", ", ")})`;
                    };

                    pixels.forEach((p) => {
                        p.onclick = () => {
                            const coord = p.dataset.coord;

                            if (targets.includes(coord)) {
                                if (!found.includes(coord)) {
                                    p.classList.remove("bg-white", "hover:bg-purple-100");
                                    p.classList.add("bg-brand-purple");
                                    found.push(coord);
                                    updateTarget();
                                }
                            } else {
                                p.classList.add("bg-red-200");
                                setTimeout(() => p.classList.remove("bg-red-200"), 300);
                            }
                        };
                    });

                    updateTarget();
                },

                interactive_grid_scaler(container) {
                    // Estado
                    let currentScale = 1;
                    // Pontos de uma figura simples (ex: Letra F ou Pol√≠gono Irregular) para mostrar orienta√ß√£o
                    const shapePoints = [
                        { x: 1, y: 1 },
                        { x: 3, y: 1 },
                        { x: 3, y: 2 },
                        { x: 2, y: 2 },
                        { x: 2, y: 3 },
                        { x: 3, y: 3 },
                        { x: 3, y: 4 },
                        { x: 2, y: 4 },
                        { x: 2, y: 6 },
                        { x: 1, y: 6 },
                    ];
                    const baseArea = 5; // √Årea da figura base (contando quadradinhos)

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Raio-X da Amplia√ß√£o (Homotetia)</h3>

        <div class="flex flex-col md:flex-row gap-8 items-start justify-center w-full mb-6">
            
            <div class="flex flex-col items-center">
                <span class="text-[10px] font-bold text-gray-400 uppercase mb-2">Original (1x)</span>
                <div class="relative bg-gray-50 border border-gray-300 rounded shadow-inner overflow-hidden" style="width: 100px; height: 140px;">
                    <div class="absolute inset-0" style="background-image: linear-gradient(#e5e7eb 1px, transparent 1px), linear-gradient(90deg, #e5e7eb 1px, transparent 1px); background-size: 20px 20px;"></div>
                    <svg width="100" height="140" class="relative z-10">
                        <path id="path-orig" d="" fill="rgba(156, 163, 175, 0.5)" stroke="#6B7280" stroke-width="2"/>
                    </svg>
                </div>
                <div class="mt-2 text-xs text-gray-500 font-mono font-bold">√Årea: ${baseArea} u¬≤</div>
            </div>

            <div class="hidden md:flex flex-col items-center justify-center h-32">
                <i class="fas fa-arrow-right text-2xl text-brand-blue transform transition-transform duration-300" id="arrow-icon"></i>
                <span class="text-xs font-bold text-brand-blue mt-1" id="scale-label">1x</span>
            </div>

            <div class="flex flex-col items-center">
                <span class="text-[10px] font-bold text-brand-blue uppercase mb-2">Transforma√ß√£o</span>
                <div class="relative bg-blue-50 border-2 border-brand-blue rounded shadow-inner overflow-hidden transition-all duration-500" style="width: 200px; height: 280px;">
                    <div class="absolute inset-0" style="background-image: linear-gradient(#bfdbfe 1px, transparent 1px), linear-gradient(90deg, #bfdbfe 1px, transparent 1px); background-size: 20px 20px;"></div>
                    <svg width="200" height="280" class="relative z-10">
                        <path id="path-res" d="" fill="rgba(28, 176, 246, 0.3)" stroke="#1CB0F6" stroke-width="3" class="transition-all duration-500 ease-out"/>
                    </svg>
                </div>
                <div class="mt-2 text-sm font-bold text-brand-blue font-mono" id="area-res-text">√Årea: ${baseArea} u¬≤</div>
            </div>
        </div>

        <div class="w-full max-w-md bg-gray-100 p-1 rounded-xl flex gap-1 mb-4">
            <button class="scale-btn flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all text-gray-500 hover:bg-white" data-s="0.5">0.5x</button>
            <button class="scale-btn flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all bg-white text-brand-blue shadow-sm" data-s="1">1x</button>
            <button class="scale-btn flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all text-gray-500 hover:bg-white" data-s="2">2x</button>
            <button class="scale-btn flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all text-gray-500 hover:bg-white" data-s="3">3x</button>
        </div>

        <div class="text-center bg-yellow-50 border border-yellow-200 p-3 rounded-lg w-full max-w-md">
            <p class="text-sm text-yellow-900" id="explain-text">A figura √© <strong>Congruente</strong> (igual). A √°rea n√£o mudou.</p>
        </div>
    </div>
    `;

                    const pathOrig = container.querySelector("#path-orig");
                    const pathRes = container.querySelector("#path-res");
                    const areaResText = container.querySelector("#area-res-text");
                    const scaleLabel = container.querySelector("#scale-label");
                    const explainText = container.querySelector("#explain-text");
                    const arrowIcon = container.querySelector("#arrow-icon");
                    const btns = container.querySelectorAll(".scale-btn");

                    const gridUnit = 20; // Tamanho do quadradinho em px

                    // Fun√ß√£o para converter coordenadas em caminho SVG
                    const pointsToPath = (points, scale) => {
                        let d = "";
                        points.forEach((p, i) => {
                            const px = p.x * gridUnit * scale;
                            const py = p.y * gridUnit * scale;
                            d += (i === 0 ? "M" : "L") + ` ${px} ${py} `;
                        });
                        d += "Z";
                        return d;
                    };

                    const update = () => {
                        // Desenha original (sempre 1x)
                        pathOrig.setAttribute("d", pointsToPath(shapePoints, 1));

                        // Desenha resultado
                        pathRes.setAttribute(
                            "d",
                            pointsToPath(shapePoints, currentScale)
                        );

                        const areaMult = currentScale * currentScale;
                        const newArea = baseArea * areaMult;

                        areaResText.innerHTML = `√Årea: <span class="text-lg">${newArea}</span> u¬≤`;
                        scaleLabel.innerText = `${currentScale}x`;

                        // L√≥gica de Explica√ß√£o
                        if (currentScale === 1) {
                            explainText.innerHTML =
                                "A figura √© <strong>Congruente</strong> (tamanho igual). A √°rea mant√©m-se original.";
                            arrowIcon.style.transform = "scale(1)";
                        } else if (currentScale < 1) {
                            explainText.innerHTML = `O lado caiu pela metade. A √°rea ficou <strong>4 vezes menor</strong>! (${baseArea} √∑ 4 = ${newArea})`;
                            arrowIcon.style.transform = "scale(0.8)";
                        } else {
                            explainText.innerHTML = `O lado aumentou <strong>${currentScale}x</strong>. A √°rea aumentou <strong>${areaMult}x</strong>! (${baseArea} √ó ${areaMult} = ${newArea})`;
                            arrowIcon.style.transform = "scale(1.2)";
                        }
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            currentScale = parseFloat(btn.dataset.s);
                            // Atualiza bot√µes
                            btns.forEach(
                                (b) =>
                                (b.className =
                                    b === btn
                                        ? "scale-btn flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all bg-white text-brand-blue shadow-sm ring-1 ring-blue-100"
                                        : "scale-btn flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all text-gray-500 hover:bg-white")
                            );
                            update();
                        };
                    });

                    update();
                },

                interactive_reflection_painter(container) {
                    // Configura√ß√£o do Grid
                    const gridSize = 6; // 6x6
                    let targetPattern = []; // C√©lulas pintadas na esquerda (alvo)
                    let userPattern = []; // C√©lulas pintadas na direita (usu√°rio)

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-4">
            <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest flex items-center gap-2">
                <i class="fas fa-arrows-alt-h"></i> Desafio do Espelho
            </h3>
            <button id="btn-new-pattern" class="text-xs font-bold text-brand-blue hover:underline">Novo Padr√£o</button>
        </div>

        <div class="relative bg-gray-800 p-2 rounded-xl shadow-lg mb-6">
            <div class="absolute left-1/2 top-2 bottom-2 w-0.5 bg-yellow-400 z-10 shadow-[0_0_10px_#FACC15] dashed-line"></div>
            
            <div class="grid grid-cols-12 gap-1" id="mirror-grid">
                </div>
        </div>

        <div class="w-full flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-gray-200">
            <p class="text-xs text-gray-500" id="status-text">Pinte o lado direito para espelhar o esquerdo!</p>
            <button id="btn-check" class="bg-brand-purple text-white font-bold py-2 px-6 rounded-lg shadow-btn active:scale-95 transition-all text-sm">
                Verificar
            </button>
        </div>

        <style>
            .dashed-line { background: repeating-linear-gradient(to bottom, #FACC15 0, #FACC15 10px, transparent 10px, transparent 15px); }
        </style>
    </div>
    `;

                    const gridEl = container.querySelector("#mirror-grid");
                    const btnCheck = container.querySelector("#btn-check");
                    const btnNew = container.querySelector("#btn-new-pattern");
                    const statusText = container.querySelector("#status-text");

                    // Fun√ß√µes L√≥gicas
                    const generatePattern = () => {
                        targetPattern = [];
                        userPattern = []; // Limpa usu√°rio

                        // Gera padr√£o aleat√≥rio na esquerda (colunas 0 a 5)
                        const numCells = 5 + Math.floor(Math.random() * 4); // 5 a 8 c√©lulas

                        for (let i = 0; i < numCells; i++) {
                            const row = Math.floor(Math.random() * gridSize);
                            const col = Math.floor(Math.random() * gridSize); // 0 a 5
                            const id = `${row}-${col}`;
                            if (!targetPattern.includes(id)) targetPattern.push(id);
                        }
                        renderGrid();
                        statusText.innerText =
                            "Pinte o lado direito para espelhar o esquerdo!";
                        statusText.className = "text-xs text-gray-500";
                        btnCheck.disabled = false;
                        btnCheck.classList.remove("opacity-50", "cursor-not-allowed");
                        btnCheck.innerText = "Verificar";
                    };

                    const toggleCell = (row, col) => {
                        // S√≥ permite pintar no lado direito (colunas 6 a 11)
                        if (col < gridSize) return;

                        const id = `${row}-${col}`;
                        const index = userPattern.indexOf(id);

                        if (index > -1) {
                            userPattern.splice(index, 1);
                        } else {
                            userPattern.push(id);
                        }
                        renderGrid();
                    };

                    const renderGrid = () => {
                        gridEl.innerHTML = "";

                        // Renderiza 6 linhas x 12 colunas
                        for (let r = 0; r < gridSize; r++) {
                            for (let c = 0; c < gridSize * 2; c++) {
                                const cell = document.createElement("div");
                                const isLeft = c < gridSize;
                                const id = `${r}-${c}`;

                                // Estilo base
                                let className =
                                    "w-6 h-6 md:w-8 md:h-8 rounded-sm border border-gray-700 transition-all duration-200 ";

                                if (isLeft) {
                                    // Lado Esquerdo (Modelo)
                                    if (targetPattern.includes(id)) {
                                        className +=
                                            "bg-brand-blue shadow-[0_0_10px_rgba(28,176,246,0.5)] border-blue-500";
                                    } else {
                                        className += "bg-gray-700 opacity-50";
                                    }
                                } else {
                                    // Lado Direito (Interativo)
                                    if (userPattern.includes(id)) {
                                        className +=
                                            "bg-brand-purple shadow-[0_0_10px_rgba(206,130,255,0.5)] border-purple-500 cursor-pointer hover:bg-purple-400";
                                    } else {
                                        className +=
                                            "bg-gray-800 cursor-pointer hover:bg-gray-700";
                                    }

                                    cell.onclick = () => toggleCell(r, c);
                                }

                                cell.className = className;
                                gridEl.appendChild(cell);
                            }
                        }
                    };

                    const checkWin = () => {
                        // L√≥gica de Espelho:
                        // Se na esquerda tem (r, c), na direita tem que ter (r, 11-c)
                        // Onde 11 √© (largura total - 1)

                        let correctCount = 0;
                        let errors = 0;

                        // Verifica se tudo que o usu√°rio pintou est√° certo
                        userPattern.forEach((uId) => {
                            const [r, c] = uId.split("-").map(Number);
                            const mirroredCol = gridSize * 2 - 1 - c;
                            const targetId = `${r}-${mirroredCol}`;

                            if (targetPattern.includes(targetId)) {
                                correctCount++;
                            } else {
                                errors++;
                            }
                        });

                        const missing = targetPattern.length - correctCount;

                        if (errors === 0 && missing === 0) {
                            statusText.innerHTML =
                                "<span class='text-brand-green font-bold'><i class='fas fa-check-circle'></i> Perfeito! Simetria exata.</span>";
                            btnCheck.innerText = "Muito Bem!";
                            btnCheck.disabled = true;
                            btnCheck.classList.add("opacity-50", "cursor-not-allowed");

                            // Efeito visual de vit√≥ria no grid
                            gridEl.classList.add("scale-105");
                            setTimeout(() => gridEl.classList.remove("scale-105"), 300);
                        } else {
                            statusText.innerHTML = `<span class='text-brand-red font-bold'>Ops! ${errors} erros e faltam ${missing}.</span>`;
                            // Anima√ß√£o de erro
                            gridEl.classList.add("animate-shake");
                            setTimeout(() => gridEl.classList.remove("animate-shake"), 500);
                        }
                    };

                    // CSS para Shake (caso n√£o exista globalmente)
                    if (!document.getElementById("anim-shake")) {
                        const s = document.createElement("style");
                        s.id = "anim-shake";
                        s.innerHTML = `@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } } .animate-shake { animation: shake 0.3s ease-in-out; }`;
                        container.appendChild(s);
                    }

                    btnNew.onclick = generatePattern;
                    btnCheck.onclick = checkWin;

                    generatePattern();
                },

                interactive_pattern_sequencer(container) {
                    // Configura√ß√£o dos N√≠veis
                    const levels = [
                        {
                            seq: ["üü¶", "üî¥", "üü¶", "üî¥", "üü¶"],
                            opts: ["üî¥", "üü¶", "üü¢"],
                            ans: "üî¥",
                            rule: "Altern√¢ncia de cores.",
                        },
                        {
                            seq: ["1", "3", "5", "7", "9"],
                            opts: ["10", "11", "12"],
                            ans: "11",
                            rule: "N√∫meros √≠mpares (Soma 2).",
                        },
                        {
                            seq: ["üî∫", "üîπ", "üî∏", "üî∫", "üîπ"],
                            opts: ["üî∫", "üî∏", "üîπ"],
                            ans: "üî∏",
                            rule: "Ciclo de 3 formas.",
                        },
                        {
                            seq: ["2", "4", "8", "16"],
                            opts: ["20", "24", "32"],
                            ans: "32",
                            rule: "Dobro do anterior (x2).",
                        },
                        {
                            seq: ["100", "90", "80", "70"],
                            opts: ["60", "50", "40"],
                            ans: "60",
                            rule: "Subtrai 10 (-10).",
                        },
                    ];

                    let currentLvl = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-6 border-b-2 border-gray-100 pb-2">
            <h3 class="text-brand-purple font-black uppercase text-xs tracking-widest"><i class="fas fa-shapes"></i> Ca√ßador de Padr√µes</h3>
            <div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black shadow-sm">Score: <span id="pat-score">0</span></div>
        </div>

        <div class="mb-8 w-full">
            <p class="text-center text-xs font-bold text-gray-400 uppercase mb-2">Complete a Sequ√™ncia:</p>
            <div class="flex flex-wrap justify-center gap-2 md:gap-4 bg-gray-50 p-4 rounded-2xl border-2 border-dashed border-gray-300 min-h-[80px] items-center" id="sequence-area">
                </div>
        </div>

        <div class="flex gap-4 justify-center w-full" id="options-area">
            </div>

        <div id="pat-feedback" class="h-12 mt-6 flex items-center justify-center text-center w-full"></div>

    </div>
    `;

                    const seqArea = container.querySelector("#sequence-area");
                    const optsArea = container.querySelector("#options-area");
                    const feedback = container.querySelector("#pat-feedback");
                    const scoreEl = container.querySelector("#pat-score");

                    const loadLevel = () => {
                        if (currentLvl >= levels.length) {
                            container.innerHTML = `
                <div class="bg-green-100 border-4 border-green-400 rounded-xl p-8 text-center w-full">
                    <div class="text-6xl mb-4">üîÆ</div>
                    <h3 class="text-2xl font-black text-brand-green">Mestre dos Padr√µes!</h3>
                    <p class="text-green-800 font-bold mt-2">Voc√™ previu o futuro corretamente.</p>
                    <button onclick="app.renderLesson(document.getElementById('main-container'), app.currentLessonName)" class="mt-6 bg-white text-green-700 font-bold py-2 px-6 rounded-lg shadow-sm hover:bg-green-50">Reiniciar</button>
                </div>
            `;
                            return;
                        }

                        const lvl = levels[currentLvl];

                        // Render Sequence
                        seqArea.innerHTML = "";
                        lvl.seq.forEach((item, i) => {
                            const el = document.createElement("div");
                            el.className =
                                "w-12 h-12 md:w-16 md:h-16 flex items-center justify-center bg-white border-2 border-gray-200 rounded-xl text-2xl font-bold shadow-sm animate-pop-in";
                            el.style.animationDelay = `${i * 0.1}s`;
                            el.innerText = item;
                            seqArea.appendChild(el);
                        });

                        // Slot Vazio
                        const empty = document.createElement("div");
                        empty.className =
                            "w-12 h-12 md:w-16 md:h-16 flex items-center justify-center bg-gray-200 border-2 border-dashed border-gray-400 rounded-xl text-2xl font-bold animate-pulse text-gray-400";
                        empty.innerText = "?";
                        empty.id = "empty-slot";
                        seqArea.appendChild(empty);

                        // Render Options
                        optsArea.innerHTML = "";
                        lvl.opts.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "w-16 h-16 bg-white border-b-4 border-brand-blue text-brand-blue rounded-xl text-2xl font-bold shadow-md active:border-b-0 active:translate-y-1 transition-all hover:bg-blue-50";
                            btn.innerText = opt;
                            btn.onclick = () => check(opt, btn);
                            optsArea.appendChild(btn);
                        });

                        feedback.innerHTML = "";
                    };

                    const check = (val, btn) => {
                        const lvl = levels[currentLvl];
                        const slot = container.querySelector("#empty-slot");

                        // Bloqueia bot√µes
                        Array.from(optsArea.children).forEach((b) => (b.disabled = true));

                        if (val === lvl.ans) {
                            // Acerto
                            score += 100;
                            scoreEl.innerText = score;

                            slot.className =
                                "w-12 h-12 md:w-16 md:h-16 flex items-center justify-center bg-brand-green border-2 border-green-600 text-white rounded-xl text-2xl font-bold shadow-lg transform scale-110 transition-all";
                            slot.innerText = val;

                            feedback.innerHTML = `
                <div class="bg-green-50 border border-green-200 px-4 py-2 rounded-lg animate-pop-in">
                    <p class="text-green-800 font-bold text-sm">Correto!</p>
                    <p class="text-xs text-green-600">Regra: ${lvl.rule}</p>
                </div>
            `;

                            setTimeout(() => {
                                currentLvl++;
                                loadLevel();
                            }, 2000);
                        } else {
                            // Erro
                            btn.classList.add(
                                "bg-red-100",
                                "border-red-400",
                                "text-red-600",
                                "animate-shake"
                            );
                            feedback.innerHTML = `<p class="text-brand-red font-bold text-sm animate-shake">Ops! Tente observar a regra de novo.</p>`;

                            setTimeout(() => {
                                Array.from(optsArea.children).forEach(
                                    (b) => (b.disabled = false)
                                );
                                btn.classList.remove(
                                    "bg-red-100",
                                    "border-red-400",
                                    "text-red-600",
                                    "animate-shake"
                                );
                                feedback.innerHTML = "";
                            }, 1000);
                        }
                    };

                    loadLevel();
                },

                interactive_variable_machine(container) {
                    let xVal = 5;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">M√°quina Alg√©brica</h3>

        <div class="flex items-center gap-2 md:gap-4 w-full justify-center mb-8 relative">
            
            <div class="flex flex-col items-center z-10">
                <div class="w-20 h-20 bg-blue-100 border-4 border-brand-blue rounded-xl flex items-center justify-center text-4xl font-black text-brand-blue shadow-md transition-all" id="box-x">
                    ${xVal}
                </div>
                <div class="mt-2 text-center">
                    <span class="text-xs font-bold text-gray-400 uppercase block">Entrada</span>
                    <span class="text-xl font-black text-brand-blue">x</span>
                </div>
            </div>

            <div class="relative w-32 h-24 bg-gray-800 rounded-lg flex items-center justify-center text-white shadow-inner mx-2">
                <div class="absolute inset-0 opacity-20" style="background: repeating-linear-gradient(45deg, #000, #000 10px, #333 10px, #333 20px);"></div>
                
                <div class="z-10 text-center">
                    <p class="text-[10px] font-bold text-brand-yellow uppercase mb-1">Regra</p>
                    <p class="text-2xl font-mono font-bold">x + 3</p>
                </div>

                <i class="fas fa-chevron-right absolute -left-4 text-gray-400"></i>
                <i class="fas fa-chevron-right absolute -right-4 text-gray-400"></i>
            </div>

            <div class="flex flex-col items-center z-10">
                <div class="w-20 h-20 bg-green-100 border-4 border-brand-green rounded-xl flex items-center justify-center text-4xl font-black text-brand-green shadow-md transition-all" id="box-y">
                    ${xVal + 3}
                </div>
                <div class="mt-2 text-center">
                    <span class="text-xs font-bold text-gray-400 uppercase block">Sa√≠da</span>
                    <span class="text-xl font-black text-brand-green">y</span>
                </div>
            </div>

        </div>

        <div class="w-full max-w-xs bg-gray-50 p-4 rounded-xl border border-gray-200 text-center">
            <p class="text-sm font-bold text-gray-600 mb-2">Mude o valor de X:</p>
            <div class="flex items-center gap-4">
                <button id="btn-dec-x" class="w-10 h-10 rounded-full bg-white border-2 border-gray-300 text-gray-500 font-black hover:border-brand-blue hover:text-brand-blue transition-colors">-</button>
                <input type="range" id="slider-x" min="0" max="20" value="${xVal}" class="flex-1 h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer accent-brand-blue">
                <button id="btn-inc-x" class="w-10 h-10 rounded-full bg-white border-2 border-gray-300 text-gray-500 font-black hover:border-brand-blue hover:text-brand-blue transition-colors">+</button>
            </div>
        </div>

        <div class="mt-6 text-center">
            <p class="text-lg font-mono text-gray-700 bg-white px-4 py-2 rounded-lg border border-gray-200 shadow-sm">
                Se <span class="text-brand-blue font-bold">x = <span id="txt-x">${xVal}</span></span>, 
                ent√£o <span class="text-brand-green font-bold">y = ${xVal} + 3 = <span id="txt-y">${xVal + 3
                        }</span></span>
            </p>
        </div>

    </div>
    `;

                    const boxX = container.querySelector("#box-x");
                    const boxY = container.querySelector("#box-y");
                    const txtX = container.querySelector("#txt-x");
                    const txtY = container.querySelector("#txt-y");
                    const slider = container.querySelector("#slider-x");
                    const btnDec = container.querySelector("#btn-dec-x");
                    const btnInc = container.querySelector("#btn-inc-x");

                    const update = () => {
                        const val = parseInt(slider.value);
                        const res = val + 3;

                        boxX.innerText = val;
                        boxY.innerText = res;
                        txtX.innerText = val;
                        txtY.innerText = res;

                        // Anima√ß√£o leve
                        boxY.classList.add("scale-110");
                        setTimeout(() => boxY.classList.remove("scale-110"), 150);
                    };

                    slider.oninput = update;

                    btnDec.onclick = () => {
                        if (slider.value > 0) {
                            slider.value--;
                            update();
                        }
                    };
                    btnInc.onclick = () => {
                        if (slider.value < 20) {
                            slider.value++;
                            update();
                        }
                    };
                },

                interactive_simple_balance(container) {
                    let targetWeight = 10;
                    let currentLeft = 10; // Fixo
                    let currentRight = 0; // Usu√°rio controla

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-2">Balan√ßa de Igualdade</h3>
        <p class="text-xs text-gray-400 mb-6">Fa√ßa o lado direito pesar igual ao esquerdo!</p>

        <div class="relative w-full max-w-sm h-40 mb-6">
            
            <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-4 h-16 bg-gray-400 rounded-t-lg"></div>
            <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-16 h-2 bg-gray-600 rounded-full"></div>

            <div id="balance-beam" class="absolute top-12 left-0 right-0 h-2 bg-brand-text rounded-full transition-transform duration-700 origin-center" style="transform: rotate(-15deg);">
                
                <div class="absolute left-0 top-0 flex flex-col items-center" style="transform: translateY(-100%);">
                    <div class="w-16 h-16 bg-blue-100 border-2 border-brand-blue rounded-lg flex items-center justify-center font-black text-2xl text-brand-blue shadow-sm">
                        ${targetWeight}
                    </div>
                    <div class="h-8 w-0.5 bg-gray-400"></div>
                </div>

                <div class="absolute right-0 top-0 flex flex-col items-center" style="transform: translateY(-100%);">
                    <div id="right-plate" class="w-16 h-16 bg-orange-50 border-2 border-brand-orange border-dashed rounded-lg flex items-center justify-center font-black text-2xl text-brand-orange shadow-sm transition-all">
                        ?
                    </div>
                    <div class="h-8 w-0.5 bg-gray-400"></div>
                </div>

            </div>

        </div>

        <div class="flex gap-2 mb-4">
            <button class="weight-btn w-12 h-12 rounded-full bg-white border-2 border-gray-300 font-bold text-gray-600 hover:bg-orange-50 hover:border-brand-orange hover:text-brand-orange transition-all shadow-sm active:scale-95" data-w="2">2</button>
            <button class="weight-btn w-12 h-12 rounded-full bg-white border-2 border-gray-300 font-bold text-gray-600 hover:bg-orange-50 hover:border-brand-orange hover:text-brand-orange transition-all shadow-sm active:scale-95" data-w="5">5</button>
            <button class="weight-btn w-12 h-12 rounded-full bg-white border-2 border-gray-300 font-bold text-gray-600 hover:bg-orange-50 hover:border-brand-orange hover:text-brand-orange transition-all shadow-sm active:scale-95" data-w="8">8</button>
            <button class="weight-btn w-12 h-12 rounded-full bg-white border-2 border-gray-300 font-bold text-gray-600 hover:bg-orange-50 hover:border-brand-orange hover:text-brand-orange transition-all shadow-sm active:scale-95" data-w="10">10</button>
        </div>

        <button id="btn-reset-bal" class="text-xs font-bold text-gray-400 underline hover:text-brand-blue hidden">Reiniciar</button>

        <div id="bal-feedback" class="h-10 flex items-center justify-center text-center w-full px-4">
            <span class="text-sm font-bold text-gray-500">Escolha um peso.</span>
        </div>

    </div>
    `;

                    const beam = container.querySelector("#balance-beam");
                    const plate = container.querySelector("#right-plate");
                    const feedback = container.querySelector("#bal-feedback");
                    const btns = container.querySelectorAll(".weight-btn");
                    const resetBtn = container.querySelector("#btn-reset-bal");

                    const updateBalance = (weight) => {
                        currentRight = weight;
                        plate.innerText = weight;
                        plate.classList.remove("border-dashed", "bg-orange-50");
                        plate.classList.add("bg-orange-100");

                        let angle = 0;
                        let msg = "";
                        let color = "";

                        if (currentRight < targetWeight) {
                            angle = -15; // Esquerda pesado
                            msg = "Muito leve! O lado esquerdo ganhou.";
                            color = "text-brand-blue";
                        } else if (currentRight > targetWeight) {
                            angle = 15; // Direita pesado
                            msg = "Muito pesado! O lado direito ganhou.";
                            color = "text-brand-red";
                        } else {
                            angle = 0; // Equil√≠brio
                            msg = "PERFEITO! A balan√ßa est√° equilibrada.";
                            color = "text-brand-green";
                            plate.classList.add(
                                "bg-green-100",
                                "border-brand-green",
                                "text-brand-green"
                            );
                            resetBtn.classList.remove("hidden");
                        }

                        beam.style.transform = `rotate(${angle}deg)`;
                        feedback.innerHTML = `<span class="${color} font-bold text-sm">${msg}</span>`;
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => updateBalance(parseInt(btn.dataset.w));
                    });

                    resetBtn.onclick = () => {
                        currentRight = 0;
                        plate.innerText = "?";
                        plate.className =
                            "w-16 h-16 bg-orange-50 border-2 border-brand-orange border-dashed rounded-lg flex items-center justify-center font-black text-2xl text-brand-orange shadow-sm transition-all";
                        beam.style.transform = "rotate(-15deg)";
                        feedback.innerHTML = `<span class="text-sm font-bold text-gray-500">Escolha um peso.</span>`;
                        resetBtn.classList.add("hidden");
                    };
                },

                interactive_algebra_translation_challenge(container) {
                    const questions = [
                        {
                            text: "O triplo de um n√∫mero",
                            ans: "3x",
                            opts: ["3 + x", "x¬≥", "3x"],
                        },
                        {
                            text: "Um n√∫mero menos 4",
                            ans: "x - 4",
                            opts: ["4 - x", "x - 4", "-4x"],
                        },
                        {
                            text: "A metade de um n√∫mero",
                            ans: "x/2",
                            opts: ["2x", "x/2", "x - 2"],
                        },
                        {
                            text: "O dobro de um n√∫mero mais 1",
                            ans: "2x + 1",
                            opts: ["2(x+1)", "2x + 1", "x¬≤ + 1"],
                        },
                        {
                            text: "O sucessor de um n√∫mero",
                            ans: "x + 1",
                            opts: ["x - 1", "2x", "x + 1"],
                        },
                    ];

                    let currentQ = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-6">
            <h3 class="text-brand-purple font-black uppercase text-xs tracking-widest"><i class="fas fa-language"></i> Tradutor</h3>
            <div class="bg-gray-100 text-gray-500 px-3 py-1 rounded-full text-xs font-black shadow-sm">Score: <span id="trans-score">0</span></div>
        </div>

        <div class="w-full bg-yellow-50 border-l-4 border-brand-yellow p-4 rounded-r-xl mb-6 shadow-sm min-h-[80px] flex items-center">
            <p class="text-lg md:text-xl font-bold text-gray-800 italic" id="q-text">...</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 w-full" id="trans-opts">
            </div>

        <div id="trans-feedback" class="h-10 mt-4 flex items-center justify-center font-bold text-sm text-center"></div>

    </div>
    `;

                    const qText = container.querySelector("#q-text");
                    const optsArea = container.querySelector("#trans-opts");
                    const scoreEl = container.querySelector("#trans-score");
                    const feedback = container.querySelector("#trans-feedback");

                    const loadQuestion = () => {
                        if (currentQ >= questions.length) {
                            container.innerHTML = `
                <div class="bg-green-100 border-4 border-green-400 rounded-xl p-8 text-center w-full">
                    <div class="text-6xl mb-4">üéì</div>
                    <h3 class="text-2xl font-black text-brand-green">Poliglota Matem√°tico!</h3>
                    <p class="text-green-800 font-bold mt-2">Voc√™ traduziu todas as frases.</p>
                    <button onclick="app.renderLesson(document.getElementById('main-container'), app.currentLessonName)" class="mt-6 bg-white text-green-700 font-bold py-2 px-6 rounded-lg shadow-sm hover:bg-green-50">Reiniciar</button>
                </div>
            `;
                            return;
                        }

                        const q = questions[currentQ];
                        qText.innerText = `"${q.text}"`;

                        optsArea.innerHTML = "";
                        // Embaralha op√ß√µes
                        const shuffledOpts = [...q.opts].sort(() => Math.random() - 0.5);

                        shuffledOpts.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-white border-2 border-brand-blue text-brand-blue font-mono font-bold text-xl py-4 rounded-xl hover:bg-blue-50 active:scale-95 transition-all shadow-sm";
                            btn.innerText = opt;
                            btn.onclick = () => check(opt, btn);
                            optsArea.appendChild(btn);
                        });
                    };

                    const check = (val, btn) => {
                        const correct = questions[currentQ].ans;
                        Array.from(optsArea.children).forEach((b) => (b.disabled = true));

                        if (val === correct) {
                            score += 100;
                            scoreEl.innerText = score;
                            btn.classList.remove(
                                "bg-white",
                                "border-brand-blue",
                                "text-brand-blue"
                            );
                            btn.classList.add(
                                "bg-brand-green",
                                "border-green-600",
                                "text-white",
                                "transform",
                                "scale-105"
                            );
                            feedback.innerHTML = `<span class="text-brand-green">Isso a√≠!</span>`;

                            setTimeout(() => {
                                currentQ++;
                                feedback.innerText = "";
                                loadQuestion();
                            }, 1000);
                        } else {
                            btn.classList.add(
                                "bg-red-100",
                                "border-red-400",
                                "text-red-600",
                                "animate-shake"
                            );
                            feedback.innerHTML = `<span class="text-brand-red">Ops! A resposta era ${correct}</span>`;

                            setTimeout(() => {
                                currentQ++; // Avan√ßa mesmo errando para n√£o frustrar no demo
                                feedback.innerText = "";
                                loadQuestion();
                            }, 1500);
                        }
                    };

                    loadQuestion();
                },

                interactive_metric_staircase(container) {
                    // Configura√ß√£o
                    const units = ["km", "hm", "dam", "m", "dm", "cm", "mm"];
                    let currentVal = 1;
                    let currentUnitIdx = 3; // Come√ßa em metros (√≠ndice 3)

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-6">
            <h3 class="text-brand-blue font-black uppercase text-xs tracking-widest">Conversor em Escada</h3>
        </div>

        <div class="w-full overflow-x-auto pb-4 mb-4 custom-scrollbar">
            <div class="flex items-end justify-center min-w-[600px] h-64 relative px-8" id="stair-container">
                </div>
        </div>

        <div class="flex flex-col items-center gap-2 bg-gray-50 p-4 rounded-xl border border-gray-200 w-full max-w-sm">
            <label class="text-[10px] font-bold text-gray-400 uppercase">Valor em <span id="current-unit-display" class="text-brand-blue font-black text-lg">m</span></label>
            <input type="number" id="input-val" value="1" class="w-full text-center text-3xl font-mono font-bold bg-transparent border-b-2 border-brand-blue outline-none text-brand-text focus:border-brand-purple transition-colors">
            <p class="text-xs text-gray-500 italic mt-1">Clique nos degraus para converter!</p>
        </div>

    </div>
    `;

                    const stairContainer = container.querySelector("#stair-container");
                    const inputVal = container.querySelector("#input-val");
                    const unitDisplay = container.querySelector(
                        "#current-unit-display"
                    );

                    const renderStairs = () => {
                        stairContainer.innerHTML = "";

                        units.forEach((u, i) => {
                            const isActive = i === currentUnitIdx;

                            // Altura do degrau (visual)
                            const height = (7 - i) * 12 + 20; // km mais alto, mm mais baixo

                            const step = document.createElement("div");
                            step.className = `flex flex-col items-center justify-end relative group cursor-pointer transition-all duration-300 hover:-translate-y-1`;
                            step.style.width = "14%";

                            // O Bloco do Degrau
                            const block = document.createElement("div");
                            block.className = `w-full rounded-t-lg border-2 border-b-0 shadow-sm transition-all duration-300 ${isActive
                                ? "bg-brand-blue border-blue-600 h-full"
                                : "bg-gray-100 border-gray-300 hover:bg-blue-50"
                                }`;
                            block.style.height = `${height}%`;

                            // Label da Unidade
                            block.innerHTML = `
                <div class="absolute bottom-2 left-0 right-0 text-center font-black uppercase text-sm ${isActive ? "text-white" : "text-gray-400"
                                }">
                    ${u}
                </div>
            `;

                            // O Boneco/Valor
                            if (isActive) {
                                const valueDisplay = document.createElement("div");
                                valueDisplay.className =
                                    "absolute -top-10 text-brand-blue font-mono font-bold text-lg bg-white px-2 py-1 rounded shadow-sm border border-blue-100 whitespace-nowrap z-10 animate-pop-in";
                                valueDisplay.innerText = parseFloat(currentVal); // Remove zeros desnecess√°rios na visualiza√ß√£o
                                step.appendChild(valueDisplay);

                                // Seta indicativa
                                const arrow = document.createElement("div");
                                arrow.className =
                                    "absolute -top-2 w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-t-[8px] border-t-brand-blue";
                                step.appendChild(arrow);
                            }

                            step.onclick = () => changeUnit(i);
                            step.appendChild(block);
                            stairContainer.appendChild(step);
                        });
                    };

                    const changeUnit = (newIdx) => {
                        if (newIdx === currentUnitIdx) return;

                        // Calcula a diferen√ßa de degraus
                        const diff = newIdx - currentUnitIdx;
                        // Se desceu (diff > 0), multiplica por 10^diff
                        // Se subiu (diff < 0), divide por 10^|diff|

                        // Fator de convers√£o: 10 elevado a (antigo - novo)
                        // Ex: km(0) para m(3). Diff = 3. km √© maior. Valor deve aumentar.
                        // Espere, a l√≥gica da escada:
                        // km (idx 0) -> m (idx 3). Desceu 3 degraus. Multiplica por 1000.
                        // mm (idx 6) -> m (idx 3). Subiu 3 degraus. Divide por 1000.

                        const stepsDown = newIdx - currentUnitIdx;
                        const factor = Math.pow(10, stepsDown);

                        // Ajuste de precis√£o para evitar 0.300000004
                        // Multiplicamos por um fator de seguran√ßa antes de dividir

                        currentVal = currentVal * factor;

                        // Limpeza de float feio
                        if (!Number.isInteger(currentVal)) {
                            currentVal = parseFloat(currentVal.toPrecision(10));
                        }

                        currentUnitIdx = newIdx;

                        // Atualiza Inputs
                        inputVal.value = currentVal;
                        unitDisplay.innerText = units[currentUnitIdx];

                        renderStairs();
                    };

                    inputVal.addEventListener("input", (e) => {
                        currentVal = parseFloat(e.target.value) || 0;
                        renderStairs(); // Apenas atualiza o bal√£ozinho
                    });

                    renderStairs();
                },

                interactive_bridge_builder(container) {
                    const levels = [
                        { gap: 100, unit: "cm", opts: ["1 m", "10 m", "100 mm"], ans: 0 }, // 100cm = 1m
                        { gap: 2, unit: "km", opts: ["200 m", "2000 m", "20 m"], ans: 1 }, // 2km = 2000m
                        { gap: 50, unit: "mm", opts: ["5 cm", "0,5 m", "50 cm"], ans: 0 }, // 50mm = 5cm
                        { gap: 1.5, unit: "m", opts: ["15 cm", "150 cm", "1500 mm"], ans: 1 } // 1.5m = 150cm
                    ];

                    let currentLevel = 0;

                    // Criar estrutura b√°sica apenas uma vez
                    container.innerHTML = `
    <div class="bg-blue-50 border-4 border-blue-300 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Engenheiro da Ponte</h3>
        
        <div class="relative w-full h-40 bg-sky-100 border-b-4 border-sky-300 mb-6 overflow-hidden flex items-end justify-between px-4">
            <div class="w-1/4 h-32 bg-stone-400 border-t-8 border-stone-600 rounded-t-lg relative z-10"></div>
            
            <div class="flex-1 h-32 relative flex flex-col justify-between items-center z-0">
                <div class="absolute top-10 text-xs font-bold text-gray-500 bg-white/80 px-2 rounded">
                    V√£o: <span id="gap-val" class="text-brand-red text-lg"></span>
                </div>
                
                <div id="bridge-plank" class="w-[90%] h-4 bg-gray-300 mt-20 opacity-50 rounded transition-all duration-500"></div>
                
                <div class="w-full h-4 bg-blue-400 animate-pulse mt-auto"></div>
            </div>

            <div class="w-1/4 h-32 bg-stone-400 border-t-8 border-stone-600 rounded-t-lg relative z-10">
                <div class="absolute -top-8 right-2 text-2xl">üöó</div>
            </div>
        </div>

        <div id="options-area" class="grid grid-cols-3 gap-4 w-full"></div>
        
        <div id="bridge-msg" class="mt-4 text-center font-bold h-10"></div>
    </div>
    `;

                    const gapDisplay = container.querySelector('#gap-val');
                    const bridge = container.querySelector('#bridge-plank');
                    const optsArea = container.querySelector('#options-area');
                    const msg = container.querySelector('#bridge-msg');

                    // Fun√ß√£o interna para reiniciar (CORRE√á√ÉO AQUI)
                    const restartGame = () => {
                        currentLevel = 0;
                        loadLevel();
                    };

                    const loadLevel = () => {
                        // Limpar estados visuais
                        msg.innerHTML = "";
                        bridge.className = "w-[90%] h-4 bg-gray-300 mt-20 opacity-50 rounded transition-all duration-500";

                        if (currentLevel >= levels.length) {
                            // Tela de Vit√≥ria
                            gapDisplay.innerText = "---";
                            optsArea.innerHTML = "";

                            // Aqui criamos o bot√£o dinamicamente e ligamos √† fun√ß√£o restartGame
                            msg.innerHTML = `
                <div class="flex flex-col items-center animate-pop-in">
                    <span class="text-brand-green text-xl mb-2">Obra Conclu√≠da! üë∑‚Äç‚ôÇÔ∏è</span>
                    <button id="btn-restart-bridge" class="bg-brand-blue text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-blue-600 transition-all">
                        Jogar Novamente
                    </button>
                </div>
            `;
                            // Bind do clique
                            setTimeout(() => {
                                const btn = container.querySelector('#btn-restart-bridge');
                                if (btn) btn.onclick = restartGame;
                            }, 0);
                            return;
                        }

                        const lvl = levels[currentLevel];
                        gapDisplay.innerText = `${lvl.gap} ${lvl.unit}`;

                        optsArea.innerHTML = '';
                        lvl.opts.forEach((opt, idx) => {
                            const btn = document.createElement('button');
                            btn.className = "bg-white border-2 border-gray-300 text-gray-600 font-bold py-3 rounded-xl hover:bg-orange-50 hover:border-brand-orange transition-all active:scale-95";
                            btn.innerText = opt;
                            btn.onclick = () => check(idx, btn);
                            optsArea.appendChild(btn);
                        });
                    };

                    const check = (idx, btn) => {
                        const lvl = levels[currentLevel];

                        // Bloqueia cliques
                        Array.from(optsArea.children).forEach(b => b.disabled = true);

                        if (idx === lvl.ans) {
                            // Acerto
                            btn.classList.replace('border-gray-300', 'border-green-500');
                            btn.classList.add('bg-green-100', 'text-green-700');

                            bridge.classList.remove('bg-gray-300', 'opacity-50');
                            bridge.classList.add('bg-brand-orange', 'opacity-100', 'scale-x-110'); // Ponte se firma

                            msg.innerHTML = "<span class='text-brand-green'>A pe√ßa encaixou! O carro passou. üöóüí®</span>";

                            setTimeout(() => {
                                currentLevel++;
                                loadLevel();
                            }, 1500);
                        } else {
                            // Erro
                            btn.classList.replace('border-gray-300', 'border-red-500');
                            btn.classList.add('bg-red-100', 'text-red-700');

                            bridge.classList.add('rotate-12', 'translate-y-4', 'bg-red-400'); // Ponte cai

                            msg.innerHTML = "<span class='text-brand-red'>A pe√ßa √© do tamanho errado! A ponte caiu. üí•</span>";

                            setTimeout(() => {
                                loadLevel(); // Reinicia n√≠vel
                            }, 1500);
                        }
                    };

                    loadLevel();
                },

                interactive_mass_scale(container) {
                    // Objetos para pesar
                    const items = [
                        { name: "Pena", weightG: 0.05, icon: "ü™∂" },
                        { name: "Formiga", weightG: 0.004, icon: "üêú" },
                        { name: "Moeda", weightG: 5, icon: "ü™ô" },
                        { name: "Ma√ß√£", weightG: 150, icon: "üçé" },
                        { name: "Gato", weightG: 4000, icon: "üêà" },
                        { name: "Humano", weightG: 70000, icon: "üßç" },
                        { name: "Carro", weightG: 1500000, icon: "üöó" },
                    ];

                    let currentItem = items[3]; // Come√ßa com a Ma√ß√£
                    let currentUnit = "g";

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Balan√ßa de Precis√£o</h3>

        <div class="w-full max-w-xs bg-gray-800 rounded-t-xl p-4 text-right border-4 border-gray-600 shadow-inner mb-0 relative">
            <span class="text-green-400 font-mono text-4xl font-black" id="scale-display">0.00</span>
            <span class="text-green-600 font-mono text-sm absolute bottom-2 right-2" id="unit-indicator">g</span>
        </div>
        
        <div class="w-full max-w-xs h-24 bg-gray-200 border-x-2 border-b-2 border-gray-300 rounded-b-xl flex items-end justify-center mb-6 relative overflow-visible">
            <div class="absolute -top-10 text-6xl transition-all duration-300 transform drop-shadow-xl animate-pop-in" id="scale-item">
                ${currentItem.icon}
            </div>
            <div class="w-3/4 h-2 bg-gray-300 rounded-full mb-2"></div>
        </div>

        <div class="flex gap-2 w-full max-w-sm mb-4 overflow-x-auto pb-2 no-scrollbar">
            ${items
                            .map(
                                (item, i) => `
                <button class="item-btn flex-shrink-0 w-12 h-12 bg-white border-2 border-gray-200 rounded-xl hover:border-brand-blue hover:bg-blue-50 text-2xl shadow-sm transition-all" data-idx="${i}">
                    ${item.icon}
                </button>
            `
                            )
                            .join("")}
        </div>

        <div class="flex gap-2 w-full max-w-sm">
            <button class="unit-btn flex-1 py-2 bg-gray-100 rounded-lg text-xs font-bold text-gray-500 hover:bg-brand-blue hover:text-white transition-colors" data-u="mg">mg</button>
            <button class="unit-btn flex-1 py-2 bg-brand-blue rounded-lg text-xs font-bold text-white shadow-sm transition-colors" data-u="g">g</button>
            <button class="unit-btn flex-1 py-2 bg-gray-100 rounded-lg text-xs font-bold text-gray-500 hover:bg-brand-blue hover:text-white transition-colors" data-u="kg">kg</button>
            <button class="unit-btn flex-1 py-2 bg-gray-100 rounded-lg text-xs font-bold text-gray-500 hover:bg-brand-blue hover:text-white transition-colors" data-u="t">t</button>
        </div>

        <p class="text-center text-xs text-gray-400 mt-4 italic" id="item-desc">Uma ma√ß√£ m√©dia.</p>
    </div>
    `;

                    const display = container.querySelector("#scale-display");
                    const unitInd = container.querySelector("#unit-indicator");
                    const visualItem = container.querySelector("#scale-item");
                    const itemDesc = container.querySelector("#item-desc");
                    const itemBtns = container.querySelectorAll(".item-btn");
                    const unitBtns = container.querySelectorAll(".unit-btn");

                    const updateDisplay = () => {
                        let val = currentItem.weightG;

                        // Convers√£o
                        if (currentUnit === "mg") val = val * 1000;
                        if (currentUnit === "kg") val = val / 1000;
                        if (currentUnit === "t") val = val / 1000000;

                        // Formata√ß√£o inteligente (evita 0.0000001 e n√∫meros gigantes)
                        let formatted;
                        if (val >= 1000)
                            formatted = val.toLocaleString("pt-BR", {
                                maximumFractionDigits: 0,
                            });
                        else if (val < 0.001) formatted = val.toExponential(2);
                        else
                            formatted = parseFloat(val.toFixed(4))
                                .toString()
                                .replace(".", ","); // Remove zeros desnecess√°rios

                        display.innerText = formatted;
                        unitInd.innerText = currentUnit;
                        visualItem.innerText = currentItem.icon;

                        // Descri√ß√£o contextual
                        itemDesc.innerText = `${currentItem.name}: Aproximadamente ${formatted} ${currentUnit}`;
                    };

                    // Listeners Itens
                    itemBtns.forEach((btn) => {
                        btn.onclick = () => {
                            // Anima√ß√£o de troca
                            visualItem.classList.remove("animate-pop-in");
                            void visualItem.offsetWidth; // Trigger reflow
                            visualItem.classList.add("animate-pop-in");

                            const idx = parseInt(btn.dataset.idx);
                            currentItem = items[idx];
                            updateDisplay();
                        };
                    });

                    // Listeners Unidades
                    unitBtns.forEach((btn) => {
                        btn.onclick = () => {
                            currentUnit = btn.dataset.u;
                            // Atualiza bot√µes
                            unitBtns.forEach((b) => {
                                b.className =
                                    "unit-btn flex-1 py-2 bg-gray-100 rounded-lg text-xs font-bold text-gray-500 hover:bg-brand-blue hover:text-white transition-colors";
                            });
                            btn.className =
                                "unit-btn flex-1 py-2 bg-brand-blue rounded-lg text-xs font-bold text-white shadow-sm transition-colors";

                            updateDisplay();
                        };
                    });

                    updateDisplay();
                },

                interactive_balance_game(container) {
                    // N√≠veis: Alvo (g) e Pesos Dispon√≠veis
                    const levels = [
                        {
                            target: 500,
                            label: "500g",
                            weights: [100, 100, 100, 200, 50, 50],
                        },
                        {
                            target: 1000,
                            label: "1kg",
                            weights: [500, 250, 250, 100, 100, 50],
                        }, // 1kg = 1000g
                        {
                            target: 2500,
                            label: "2,5kg",
                            weights: [1000, 1000, 500, 200, 200, 100],
                        },
                        {
                            target: 1200,
                            label: "1,2kg",
                            weights: [500, 500, 100, 50, 20, 20, 10],
                        }, // Desafio maior
                    ];

                    let currentLvl = 0;
                    let currentWeight = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-4 z-10">
            <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest"><i class="fas fa-balance-scale"></i> Desafio de Equil√≠brio</h3>
            <div class="bg-gray-100 text-gray-500 px-3 py-1 rounded-full text-xs font-black">N√≠vel <span id="bal-lvl">1</span></div>
        </div>

        <div class="relative w-full h-48 mb-6 flex justify-center items-end">
            
            <div class="absolute bottom-0 w-4 h-24 bg-gray-600 rounded-t-lg z-10"></div>
            <div class="absolute bottom-0 w-32 h-4 bg-gray-800 rounded-full z-10"></div>

            <div id="balance-beam" class="w-64 h-2 bg-brand-text rounded-full relative transition-transform duration-700 ease-out z-20" style="bottom: 90px; transform: rotate(-15deg);">
                
                <div class="absolute left-0 top-1/2 flex flex-col items-center" style="transform: translateY(0px);">
                    <div class="w-0.5 h-16 bg-gray-400"></div>
                    <div class="w-20 h-2 bg-brand-text rounded-full mb-1"></div>
                    <div class="w-16 h-16 bg-brand-orange rounded-lg border-2 border-orange-700 flex items-center justify-center text-white font-bold shadow-md absolute top-12 animate-bounce-small">
                        <span id="target-label">500g</span>
                    </div>
                </div>

                <div class="absolute right-0 top-1/2 flex flex-col items-center" style="transform: translateY(0px);">
                    <div class="w-0.5 h-16 bg-gray-400"></div>
                    <div class="w-20 h-2 bg-brand-text rounded-full mb-1"></div>
                    <div id="right-plate-content" class="absolute top-12 flex flex-col-reverse items-center w-20 transition-all">
                    </div>
                </div>

                <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 bg-gray-400 rounded-full border-2 border-gray-600 z-30"></div>
            </div>
        </div>

        <div class="text-center mb-2">
            <p class="text-xs text-gray-400 font-bold uppercase mb-2">Seus Pesos (Clique para adicionar)</p>
            <div id="weights-bank" class="flex flex-wrap justify-center gap-2">
            </div>
        </div>

        <div id="bal-feedback" class="h-8 mt-2 text-sm font-bold text-center w-full text-brand-blue">
            Adicione pesos para equilibrar!
        </div>

        <button id="btn-next-bal" class="hidden mt-4 bg-brand-green text-white font-bold py-2 px-8 rounded-xl shadow-btn active:scale-95 transition-all">
            Pr√≥ximo N√≠vel
        </button>

    </div>
    `;

                    const beam = container.querySelector("#balance-beam");
                    const plateRight = container.querySelector("#right-plate-content");
                    const bank = container.querySelector("#weights-bank");
                    const targetLbl = container.querySelector("#target-label");
                    const feedback = container.querySelector("#bal-feedback");
                    const btnNext = container.querySelector("#btn-next-bal");
                    const lvlDisp = container.querySelector("#bal-lvl");

                    const loadLevel = () => {
                        if (currentLvl >= levels.length) {
                            feedback.innerHTML =
                                "<span class='text-brand-green text-xl'>üèÜ Mestre do Equil√≠brio!</span>";
                            bank.innerHTML = "";
                            btnNext.classList.add("hidden");
                            beam.style.transform = "rotate(0deg)";
                            return;
                        }

                        const lvl = levels[currentLvl];
                        currentWeight = 0;
                        lvlDisp.innerText = currentLvl + 1;
                        targetLbl.innerText = lvl.label;
                        plateRight.innerHTML = "";
                        feedback.innerText = "Adicione pesos para equilibrar!";
                        feedback.className =
                            "h-8 mt-2 text-sm font-bold text-center text-brand-blue";
                        btnNext.classList.add("hidden");

                        // Inclina para a esquerda (Alvo √© mais pesado)
                        beam.style.transform = "rotate(-15deg)";

                        // Gera bot√µes de peso
                        bank.innerHTML = "";
                        lvl.weights.forEach((w, i) => {
                            const btn = document.createElement("button");

                            // Formata texto do bot√£o (1000g -> 1kg para dificultar um pouco)
                            let txt = w >= 1000 ? w / 1000 + "kg" : w + "g";

                            btn.className =
                                "w-12 h-12 rounded-lg bg-gray-200 border-b-4 border-gray-400 text-gray-700 font-bold text-xs hover:bg-gray-300 active:border-b-0 active:translate-y-1 transition-all flex items-center justify-center shadow-sm";
                            btn.innerText = txt;

                            btn.onclick = () => {
                                addWeight(w, txt);
                                btn.classList.add("opacity-0", "pointer-events-none"); // Consome o peso
                            };
                            bank.appendChild(btn);
                        });
                    };

                    const addWeight = (grams, label) => {
                        currentWeight += grams;

                        // Adiciona visualmente no prato
                        const weightBox = document.createElement("div");
                        weightBox.className =
                            "w-10 h-6 bg-brand-blue border border-blue-800 rounded mb-0.5 flex items-center justify-center text-[8px] text-white font-bold shadow-sm animate-pop-in";
                        weightBox.innerText = label;
                        plateRight.appendChild(weightBox);

                        checkBalance();
                    };

                    const checkBalance = () => {
                        const target = levels[currentLvl].target;

                        if (currentWeight < target) {
                            // Ainda leve
                            beam.style.transform = "rotate(-10deg)";
                            feedback.innerText = "Ainda est√° leve...";
                        } else if (currentWeight === target) {
                            // Equilibrado
                            beam.style.transform = "rotate(0deg)";
                            feedback.innerHTML =
                                "<span class='text-brand-green'>‚öñÔ∏è Perfeito! Equilibrado.</span>";
                            btnNext.classList.remove("hidden");

                            // Trava resto dos bot√µes
                            Array.from(bank.children).forEach((b) => (b.disabled = true));
                        } else {
                            // Pesado demais
                            beam.style.transform = "rotate(15deg)";
                            feedback.innerHTML =
                                "<span class='text-brand-red'>Muito pesado! Passou do ponto.</span>";

                            // Reiniciar n√≠vel ap√≥s erro? Ou permitir tirar?
                            // Simplifica√ß√£o: Reinicia o n√≠vel ap√≥s 1.5s
                            setTimeout(() => {
                                feedback.innerText = "Reiniciando n√≠vel...";
                                setTimeout(loadLevel, 1000);
                            }, 1000);
                        }
                    };

                    btnNext.onclick = () => {
                        currentLvl++;
                        loadLevel();
                    };

                    // CSS para anima√ß√£o bounce suave
                    if (!document.getElementById("anim-bounce-small")) {
                        const s = document.createElement("style");
                        s.id = "anim-bounce-small";
                        s.innerHTML = `@keyframes bounceSmall { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } } .animate-bounce-small { animation: bounceSmall 2s infinite; }`;
                        container.appendChild(s);
                    }

                    loadLevel();
                },

                interactive_time_calculator(container) {
                    // Estado inicial
                    let time1 = { h: 2, m: 45 };
                    let time2 = { h: 1, m: 30 };

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Calculadora Temporal</h3>

        <div class="flex flex-col gap-2 w-full max-w-sm font-mono text-2xl font-bold text-gray-700">
            
            <div class="flex items-center justify-center gap-2 bg-gray-50 p-2 rounded-lg border border-gray-200">
                <div class="flex flex-col items-center">
                    <input type="number" id="h1" value="${time1.h}" class="w-12 text-center bg-transparent outline-none border-b-2 border-brand-blue text-brand-blue" min="0">
                    <span class="text-[10px] text-gray-400 font-sans uppercase">h</span>
                </div>
                <span>:</span>
                <div class="flex flex-col items-center">
                    <input type="number" id="m1" value="${time1.m}" class="w-12 text-center bg-transparent outline-none border-b-2 border-brand-blue text-brand-blue" min="0" max="59">
                    <span class="text-[10px] text-gray-400 font-sans uppercase">min</span>
                </div>
            </div>

            <div class="text-center text-gray-400 text-lg">+</div>

            <div class="flex items-center justify-center gap-2 bg-gray-50 p-2 rounded-lg border border-gray-200">
                <div class="flex flex-col items-center">
                    <input type="number" id="h2" value="${time2.h}" class="w-12 text-center bg-transparent outline-none border-b-2 border-brand-orange text-brand-orange" min="0">
                    <span class="text-[10px] text-gray-400 font-sans uppercase">h</span>
                </div>
                <span>:</span>
                <div class="flex flex-col items-center">
                    <input type="number" id="m2" value="${time2.m}" class="w-12 text-center bg-transparent outline-none border-b-2 border-brand-orange text-brand-orange" min="0" max="59">
                    <span class="text-[10px] text-gray-400 font-sans uppercase">min</span>
                </div>
            </div>

            <div class="w-full h-0.5 bg-gray-300 my-2"></div>

            <div class="flex items-center justify-center gap-4 opacity-50" id="raw-result">
                <span>3h</span>
                <span>75min</span>
            </div>
            <div class="text-center text-xs font-bold text-red-400 hidden" id="overflow-warning">‚ö†Ô∏è Minutos > 60! Convertendo...</div>

        </div>

        <div class="text-4xl text-gray-300 my-2"><i class="fas fa-arrow-down"></i></div>

        <div class="flex items-center justify-center gap-2 bg-brand-green text-white p-4 rounded-2xl shadow-lg w-full max-w-xs transform transition-all" id="final-res-box">
            <div class="flex flex-col items-center">
                <span id="res-h" class="text-4xl font-black">4</span>
                <span class="text-xs font-bold uppercase opacity-80">Horas</span>
            </div>
            <span class="text-2xl font-black pb-4">:</span>
            <div class="flex flex-col items-center">
                <span id="res-m" class="text-4xl font-black">15</span>
                <span class="text-xs font-bold uppercase opacity-80">Minutos</span>
            </div>
        </div>

        <p class="text-center text-xs text-gray-500 mt-4 italic max-w-xs" id="logic-explain">
            75 minutos viraram <strong>1 hora</strong> e sobraram <strong>15 minutos</strong>.
        </p>

    </div>
    `;

                    const inputs = container.querySelectorAll("input");
                    const rawRes = container.querySelector("#raw-result");
                    const warn = container.querySelector("#overflow-warning");
                    const resH = container.querySelector("#res-h");
                    const resM = container.querySelector("#res-m");
                    const explain = container.querySelector("#logic-explain");
                    const resBox = container.querySelector("#final-res-box");

                    const update = () => {
                        const h1 = parseInt(container.querySelector("#h1").value) || 0;
                        const m1 = parseInt(container.querySelector("#m1").value) || 0;
                        const h2 = parseInt(container.querySelector("#h2").value) || 0;
                        const m2 = parseInt(container.querySelector("#m2").value) || 0;

                        // Soma Bruta
                        let rawH = h1 + h2;
                        let rawM = m1 + m2;

                        rawRes.innerHTML = `<span>${rawH}h</span> <span>${rawM}min</span>`;

                        // Processamento
                        let finalH = rawH;
                        let finalM = rawM;
                        let converted = false;

                        if (rawM >= 60) {
                            converted = true;
                            const extraHours = Math.floor(rawM / 60);
                            finalM = rawM % 60;
                            finalH += extraHours;

                            warn.classList.remove("hidden");
                            warn.classList.add("animate-pulse");

                            explain.innerHTML = `<span class="text-brand-orange">${rawM} minutos</span> transbordaram! <br> Criamos <strong>+${extraHours}h</strong> e sobraram <strong>${finalM}min</strong>.`;
                        } else {
                            warn.classList.add("hidden");
                            explain.innerText = "Soma simples. N√£o ultrapassou 60 minutos.";
                        }

                        // Anima√ß√£o de Atualiza√ß√£o
                        resH.innerText = finalH;
                        resM.innerText = finalM < 10 ? `0${finalM}` : finalM;

                        resBox.classList.remove("scale-105");
                        void resBox.offsetWidth; // Trigger reflow
                        resBox.classList.add("scale-105");
                    };

                    inputs.forEach((i) => i.addEventListener("input", update));
                    update();
                },

                interactive_chronos_quest(container) {
                    const questions = [
                        {
                            title: "O Cinema",
                            text: "O filme come√ßou √†s 14:30 e teve dura√ß√£o de 110 minutos. Que horas acabou?",
                            opts: ["16:20", "16:10", "15:50"],
                            ans: 0,
                            feedback:
                                "110 min = 1h 50min. <br>14:30 + 1h = 15:30. <br>15:30 + 50min = 16:20.",
                        },
                        {
                            title: "A Corrida",
                            text: "O piloto completou a volta em 1 minuto e 45 segundos. Quantos segundos no total?",
                            opts: ["145s", "105s", "100s"],
                            ans: 1,
                            feedback: "1 minuto = 60 segundos. <br>60 + 45 = 105 segundos.",
                        },
                        {
                            title: "O Bolo",
                            text: "O bolo precisa assar por 45 minutos. Voc√™ colocou no forno √†s 10:50. Quando tirar?",
                            opts: ["11:35", "11:25", "11:45"],
                            ans: 0,
                            feedback:
                                "10:50 + 10min = 11:00 (Faltam 35). <br>11:00 + 35min = 11:35.",
                        },
                    ];

                    let currentQ = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[420px]">
        
        <div class="flex justify-between w-full items-center mb-6 z-10">
            <div class="flex items-center gap-2">
                <span class="text-2xl">‚è≥</span> 
                <span class="font-bold text-white uppercase tracking-widest text-xs">Chronos Quest</span>
            </div>
            <div class="bg-gray-700 px-3 py-1 rounded-full text-xs font-black text-brand-yellow border border-yellow-600">XP: <span id="chronos-score">0</span></div>
        </div>

        <div class="relative w-full flex-1 flex flex-col items-center justify-center z-10">
            
            <div class="bg-white text-gray-800 p-6 rounded-2xl shadow-xl w-full max-w-sm text-center mb-6 border-b-4 border-gray-300 relative" id="q-card">
                <span class="absolute -top-3 left-1/2 -translate-x-1/2 bg-brand-blue text-white px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide" id="q-tag">QUEST√ÉO 1</span>
                <h4 class="font-black text-xl mb-2 text-brand-purple" id="q-title">...</h4>
                <p class="text-sm font-medium leading-relaxed" id="q-text">...</p>
            </div>

            <div class="grid grid-cols-1 gap-3 w-full max-w-xs" id="opts-area">
            </div>

        </div>

        <div id="chronos-overlay" class="absolute inset-0 bg-gray-900/95 z-20 hidden flex-col items-center justify-center text-center p-6 backdrop-blur-sm">
            <div class="text-6xl mb-4" id="fb-icon"></div>
            <h3 class="text-2xl font-black text-white mb-2" id="fb-status"></h3>
            <div class="bg-gray-800 p-4 rounded-xl border border-gray-600 mb-6">
                <p class="text-gray-300 text-sm font-mono" id="fb-detail"></p>
            </div>
            <button id="btn-next-chronos" class="bg-brand-blue text-white font-bold py-3 px-8 rounded-full shadow-lg active:scale-95 transition-all">Continuar</button>
        </div>

        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 border-4 border-gray-700 rounded-full opacity-20 pointer-events-none"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-48 h-48 border-2 border-gray-700 rounded-full opacity-20 pointer-events-none border-dashed animate-spin-slow"></div>

    </div>
    `;

                    // CSS Inline para anima√ß√£o
                    if (!document.getElementById("anim-spin-slow")) {
                        const s = document.createElement("style");
                        s.id = "anim-spin-slow";
                        s.innerHTML = `@keyframes spinSlow { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } } .animate-spin-slow { animation: spinSlow 20s linear infinite; }`;
                        container.appendChild(s);
                    }

                    const qTag = container.querySelector("#q-tag");
                    const qTitle = container.querySelector("#q-title");
                    const qText = container.querySelector("#q-text");
                    const optsArea = container.querySelector("#opts-area");
                    const scoreEl = container.querySelector("#chronos-score");

                    const overlay = container.querySelector("#chronos-overlay");
                    const fbIcon = container.querySelector("#fb-icon");
                    const fbStatus = container.querySelector("#fb-status");
                    const fbDetail = container.querySelector("#fb-detail");
                    const btnNext = container.querySelector("#btn-next-chronos");

                    const loadQuestion = () => {
                        if (currentQ >= questions.length) {
                            // Fim de jogo
                            overlay.classList.remove("hidden");
                            overlay.classList.add("flex");
                            fbIcon.innerText = "üèÜ";
                            fbStatus.innerText = "Guardi√£o do Tempo!";
                            fbDetail.innerText = `Voc√™ completou o desafio com ${score} XP.`;
                            btnNext.innerText = "Reiniciar";
                            btnNext.onclick = () => {
                                currentQ = 0;
                                score = 0;
                                scoreEl.innerText = 0;
                                loadQuestion();
                                overlay.classList.add("hidden");
                                overlay.classList.remove("flex");
                            };
                            return;
                        }

                        const q = questions[currentQ];
                        qTag.innerText = `QUEST√ÉO ${currentQ + 1}`;
                        qTitle.innerText = q.title;
                        qText.innerText = q.text;

                        optsArea.innerHTML = "";
                        q.opts.forEach((opt, idx) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "w-full bg-gray-800 hover:bg-gray-700 text-white font-mono font-bold py-3 rounded-xl border border-gray-600 transition-all active:scale-95 shadow-sm";
                            btn.innerText = opt;
                            btn.onclick = () => check(idx);
                            optsArea.appendChild(btn);
                        });

                        // Entrada Anima√ß√£o
                        const card = container.querySelector("#q-card");
                        card.classList.remove("animate-pop-in");
                        void card.offsetWidth;
                        card.classList.add("animate-pop-in");
                    };

                    const check = (selectedIdx) => {
                        const q = questions[currentQ];
                        const isCorrect = selectedIdx === q.ans;

                        overlay.classList.remove("hidden");
                        overlay.classList.add("flex");

                        if (isCorrect) {
                            score += 50;
                            scoreEl.innerText = score;
                            fbIcon.innerText = "‚úÖ";
                            fbStatus.innerText = "Correto!";
                            fbStatus.className =
                                "text-2xl font-black text-brand-green mb-2";
                        } else {
                            fbIcon.innerText = "‚ùå";
                            fbStatus.innerText = "Tempo Esgotado!";
                            fbStatus.className = "text-2xl font-black text-brand-red mb-2";
                        }

                        fbDetail.innerHTML = q.feedback;

                        btnNext.onclick = () => {
                            overlay.classList.add("hidden");
                            overlay.classList.remove("flex");
                            currentQ++;
                            loadQuestion();
                        };
                    };

                    loadQuestion();
                },

                interactive_variable_inspector(container) {
                    // Dados do Perfil
                    const profileData = [
                        {
                            label: "Nome",
                            val: "Julia",
                            type: "Qualitativa Nominal",
                            desc: "Apenas um nome, n√£o tem ordem nem n√∫mero.",
                            icon: "fa-font",
                            color: "text-brand-purple",
                        },
                        {
                            label: "Idade",
                            val: "13 anos",
                            type: "Quantitativa Discreta",
                            desc: "√â uma contagem de anos inteiros.",
                            icon: "fa-birthday-cake",
                            color: "text-brand-orange",
                        },
                        {
                            label: "Altura",
                            val: "1,62 m",
                            type: "Quantitativa Cont√≠nua",
                            desc: "√â uma medida. Pode ter v√≠rgula e precis√£o.",
                            icon: "fa-ruler-vertical",
                            color: "text-brand-orange",
                        },
                        {
                            label: "Grau de Ensino",
                            val: "7¬∫ Ano",
                            type: "Qualitativa Ordinal",
                            desc: "√â uma categoria, mas tem ordem (6¬∫ < 7¬∫ < 8¬∫).",
                            icon: "fa-graduation-cap",
                            color: "text-brand-purple",
                        },
                        {
                            label: "CEP",
                            val: "01000-000",
                            type: "Qualitativa Nominal",
                            desc: "PEGADINHA! √â n√∫mero, mas funciona como um 'nome' de regi√£o. N√£o somamos CEPs.",
                            icon: "fa-map-marker-alt",
                            color: "text-brand-red",
                        },
                        {
                            label: "N¬∫ de Pets",
                            val: "2",
                            type: "Quantitativa Discreta",
                            desc: "Resultado de contagem. N√£o existe 2,5 cachorros.",
                            icon: "fa-paw",
                            color: "text-brand-orange",
                        },
                    ];

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col md:flex-row items-center gap-8 w-full shadow-sm font-sans select-none">
        
        <div class="w-full max-w-xs bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-6 text-white shadow-lg transform transition-transform hover:scale-105 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -mr-16 -mt-16"></div>
            
            <div class="flex items-center gap-4 mb-6 border-b border-blue-400 pb-4">
                <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center text-3xl shadow-sm">üë©‚Äçüéì</div>
                <div>
                    <h3 class="font-bold text-lg">Carteira de Estudante</h3>
                    <p class="text-xs text-blue-200">MathVille High</p>
                </div>
            </div>

            <div class="space-y-3" id="fields-container">
                ${profileData
                            .map(
                                (item, idx) => `
                    <div class="profile-field bg-blue-700/50 hover:bg-white hover:text-brand-blue p-2 rounded-lg cursor-pointer transition-all flex justify-between items-center group" data-idx="${idx}">
                        <div>
                            <span class="text-[10px] uppercase opacity-70 block group-hover:text-brand-blue group-hover:font-bold">${item.label}</span>
                            <span class="font-bold">${item.val}</span>
                        </div>
                        <i class="fas fa-search opacity-0 group-hover:opacity-100 transition-opacity"></i>
                    </div>
                `
                            )
                            .join("")}
            </div>
        </div>

        <div class="flex-1 w-full bg-gray-50 border-2 border-gray-200 rounded-2xl p-6 flex flex-col items-center justify-center text-center min-h-[200px]" id="info-panel">
            <div class="text-6xl text-gray-300 mb-4 animate-bounce"><i class="fas fa-mouse-pointer"></i></div>
            <p class="text-gray-400 font-bold">Clique em um campo do cart√£o para analisar a vari√°vel.</p>
        </div>

    </div>
    `;

                    const fields = container.querySelectorAll(".profile-field");
                    const infoPanel = container.querySelector("#info-panel");

                    fields.forEach((f) => {
                        f.onclick = () => {
                            const data = profileData[f.dataset.idx];

                            // Remove active classes
                            fields.forEach((el) =>
                                el.classList.remove(
                                    "ring-2",
                                    "ring-white",
                                    "bg-white",
                                    "text-brand-blue"
                                )
                            );
                            // Add active to clicked
                            f.classList.add(
                                "ring-2",
                                "ring-white",
                                "bg-white",
                                "text-brand-blue"
                            );

                            infoPanel.innerHTML = `
                <div class="w-16 h-16 rounded-full bg-white border-4 border-gray-100 flex items-center justify-center text-3xl mb-4 shadow-sm animate-pop-in ${data.color}">
                    <i class="fas ${data.icon}"></i>
                </div>
                <h3 class="text-xl font-black ${data.color} mb-1 animate-slide-up">${data.type}</h3>
                <p class="text-gray-600 text-sm leading-relaxed animate-fade-in">${data.desc}</p>
            `;
                        };
                    });
                },

                interactive_data_sorter(container) {
                    const dataSet = [
                        {
                            text: "Peso da Mochila",
                            type: "quanti",
                            hint: "Mede-se em kg (n√∫mero).",
                        },
                        {
                            text: "Cor do Carro",
                            type: "quali",
                            hint: "√â uma caracter√≠stica (palavra).",
                        },
                        { text: "Sal√°rio", type: "quanti", hint: "√â dinheiro (n√∫mero)." },
                        {
                            text: "Time de Futebol",
                            type: "quali",
                            hint: "√â um nome/categoria.",
                        },
                        {
                            text: "Temperatura",
                            type: "quanti",
                            hint: "Mede-se em graus.",
                        },
                        {
                            text: "N√∫mero do CPF",
                            type: "quali",
                            hint: "PEGADINHA! Serve para identificar (nome), n√£o para contar.",
                        },
                        {
                            text: "Notas da Prova",
                            type: "quanti",
                            hint: "√â um valor num√©rico.",
                        },
                        {
                            text: "Humor (Feliz/Triste)",
                            type: "quali",
                            hint: "√â um estado/qualidade.",
                        },
                    ];

                    let currentIdx = 0;
                    let score = 0;
                    let queue = [...dataSet].sort(() => Math.random() - 0.5); // Embaralha

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-300 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[400px]">
        
        <div class="flex justify-between w-full items-center mb-6 z-10">
            <h3 class="font-black text-gray-500 uppercase text-xs tracking-widest"><i class="fas fa-filter"></i> Classificador de Dados</h3>
            <div class="bg-white border border-gray-200 px-3 py-1 rounded-full text-xs font-black text-brand-blue">Score: <span id="sort-score">0</span></div>
        </div>

        <div class="relative w-full flex-1 flex flex-col items-center justify-center mb-4 z-10 perspective-container">
            
            <div id="data-card" class="w-64 h-40 bg-white rounded-2xl shadow-xl border-b-8 border-gray-200 flex flex-col items-center justify-center p-4 text-center cursor-grab transition-all duration-500 transform">
                <div class="w-12 h-1 bg-gray-100 rounded-full mb-4"></div>
                <h3 class="text-2xl font-black text-gray-700 leading-tight" id="card-text">Carregando...</h3>
                <p class="text-xs text-gray-400 mt-2 font-bold uppercase">Vari√°vel</p>
            </div>

            <div id="feedback-flash" class="absolute font-black text-6xl opacity-0 transition-all duration-500 transform scale-50 z-20"></div>

        </div>

        <div class="flex gap-4 w-full max-w-md z-10">
            <button id="btn-quali" class="flex-1 bg-purple-100 border-b-4 border-purple-300 text-purple-700 font-bold py-4 rounded-xl hover:bg-purple-200 active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center gap-1 group">
                <span class="text-2xl group-hover:scale-110 transition-transform">üé®</span>
                <span class="text-xs uppercase tracking-wider">Qualitativa</span>
            </button>

            <button id="btn-quanti" class="flex-1 bg-orange-100 border-b-4 border-orange-300 text-orange-700 font-bold py-4 rounded-xl hover:bg-orange-200 active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center gap-1 group">
                <span class="text-2xl group-hover:scale-110 transition-transform">üìè</span>
                <span class="text-xs uppercase tracking-wider">Quantitativa</span>
            </button>
        </div>

        <div id="end-overlay" class="absolute inset-0 bg-white/95 z-30 hidden flex-col items-center justify-center text-center p-6">
            <div class="text-6xl mb-4">üìä</div>
            <h3 class="text-3xl font-black text-brand-text mb-2">An√°lise Completa!</h3>
            <p class="text-gray-500 mb-6">Pontua√ß√£o Final: <span id="final-score" class="font-bold text-brand-blue">0</span></p>
            <button id="btn-restart" class="bg-brand-green text-white font-bold py-3 px-8 rounded-full shadow-lg hover:scale-105 transition-transform">Nova Pilha</button>
        </div>

    </div>
    `;

                    const card = container.querySelector("#data-card");
                    const cardText = container.querySelector("#card-text");
                    const scoreEl = container.querySelector("#sort-score");
                    const feedback = container.querySelector("#feedback-flash");
                    const endOverlay = container.querySelector("#end-overlay");
                    const finalScore = container.querySelector("#final-score");

                    const btnQuali = container.querySelector("#btn-quali");
                    const btnQuanti = container.querySelector("#btn-quanti");
                    const btnRestart = container.querySelector("#btn-restart");

                    const loadCard = () => {
                        if (currentIdx >= queue.length) {
                            finalScore.innerText = score;
                            endOverlay.classList.remove("hidden");
                            endOverlay.classList.add("flex");
                            return;
                        }

                        const item = queue[currentIdx];
                        cardText.innerText = item.text;

                        // Reset Visual
                        card.style.transform = "translate(0, 0) rotate(0deg)";
                        card.style.opacity = "1";
                        card.className =
                            "w-64 h-40 bg-white rounded-2xl shadow-xl border-b-8 border-gray-200 flex flex-col items-center justify-center p-4 text-center cursor-grab transition-all duration-500 transform animate-pop-in";
                    };

                    const handleChoice = (choice) => {
                        const item = queue[currentIdx];
                        const isCorrect = choice === item.type;

                        // Anima√ß√£o de Sa√≠da
                        const xDir = choice === "quali" ? -200 : 200;
                        const rotate = choice === "quali" ? -20 : 20;

                        card.style.transform = `translate(${xDir}px, 50px) rotate(${rotate}deg)`;
                        card.style.opacity = "0";

                        if (isCorrect) {
                            score += 10;
                            scoreEl.innerText = score;
                            feedback.innerHTML = "<span class='text-green-500'>‚úì</span>";
                            // Flash Green border
                            container.classList.add("ring-4", "ring-green-200");
                            setTimeout(
                                () => container.classList.remove("ring-4", "ring-green-200"),
                                300
                            );
                        } else {
                            score = Math.max(0, score - 5);
                            scoreEl.innerText = score;
                            feedback.innerHTML = "<span class='text-red-500'>‚úï</span>";
                            // Shake
                            container.classList.add("animate-shake");
                            setTimeout(
                                () => container.classList.remove("animate-shake"),
                                300
                            );

                            // Dica (opcional, pode ser um toast)
                            // alert(item.hint);
                        }

                        feedback.classList.remove("opacity-0", "scale-50");
                        feedback.classList.add("opacity-100", "scale-150");

                        setTimeout(() => {
                            feedback.classList.add("opacity-0", "scale-50");
                            feedback.classList.remove("opacity-100", "scale-150");
                            currentIdx++;
                            loadCard();
                        }, 400);
                    };

                    btnQuali.onclick = () => handleChoice("quali");
                    btnQuanti.onclick = () => handleChoice("quanti");

                    btnRestart.onclick = () => {
                        currentIdx = 0;
                        score = 0;
                        scoreEl.innerText = 0;
                        queue = [...dataSet].sort(() => Math.random() - 0.5);
                        endOverlay.classList.add("hidden");
                        endOverlay.classList.remove("flex");
                        loadCard();
                    };

                    loadCard();
                },

                interactive_tally_sorter(container) {
                    // Dados iniciais bagun√ßados
                    const rawData = [
                        { type: "apple", icon: "üçé", label: "Ma√ß√£" },
                        { type: "banana", icon: "üçå", label: "Banana" },
                        { type: "apple", icon: "üçé", label: "Ma√ß√£" },
                        { type: "grape", icon: "üçá", label: "Uva" },
                        { type: "banana", icon: "üçå", label: "Banana" },
                        { type: "apple", icon: "üçé", label: "Ma√ß√£" },
                        { type: "grape", icon: "üçá", label: "Uva" },
                        { type: "apple", icon: "üçé", label: "Ma√ß√£" },
                        { type: "banana", icon: "üçå", label: "Banana" },
                        { type: "apple", icon: "üçé", label: "Ma√ß√£" }, // 5¬™ ma√ß√£
                        { type: "grape", icon: "üçá", label: "Uva" },
                        { type: "banana", icon: "üçå", label: "Banana" },
                    ];

                    let counts = { apple: 0, banana: 0, grape: 0 };

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Organizador de Frutas</h3>

        <div class="w-full bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl p-4 min-h-[120px] mb-6 relative" id="chaos-zone">
            <p class="text-xs text-gray-400 font-bold uppercase absolute top-2 left-2">Dados Brutos (Clique para contar)</p>
            <div class="flex flex-wrap justify-center gap-3 mt-4" id="items-container">
            </div>
        </div>

        <div class="w-full max-w-md bg-white border-2 border-brand-text rounded-xl overflow-hidden shadow-lg">
            <div class="flex bg-gray-800 text-white text-xs font-bold uppercase p-3">
                <div class="w-1/3 text-center">Fruta</div>
                <div class="w-1/3 text-center">Contagem (Tracinhos)</div>
                <div class="w-1/3 text-center">Frequ√™ncia</div>
            </div>

            <div class="flex border-b border-gray-200 p-2 items-center" id="row-apple">
                <div class="w-1/3 flex flex-col items-center">
                    <span class="text-2xl">üçé</span>
                    <span class="text-xs font-bold text-gray-600">Ma√ß√£</span>
                </div>
                <div class="w-1/3 flex justify-center gap-1 text-brand-blue font-black text-lg h-8 items-center" id="tally-apple"></div>
                <div class="w-1/3 text-center font-mono font-black text-2xl text-brand-text" id="freq-apple">0</div>
            </div>

            <div class="flex border-b border-gray-200 p-2 items-center" id="row-banana">
                <div class="w-1/3 flex flex-col items-center">
                    <span class="text-2xl">üçå</span>
                    <span class="text-xs font-bold text-gray-600">Banana</span>
                </div>
                <div class="w-1/3 flex justify-center gap-1 text-brand-orange font-black text-lg h-8 items-center" id="tally-banana"></div>
                <div class="w-1/3 text-center font-mono font-black text-2xl text-brand-text" id="freq-banana">0</div>
            </div>

            <div class="flex p-2 items-center" id="row-grape">
                <div class="w-1/3 flex flex-col items-center">
                    <span class="text-2xl">üçá</span>
                    <span class="text-xs font-bold text-gray-600">Uva</span>
                </div>
                <div class="w-1/3 flex justify-center gap-1 text-brand-purple font-black text-lg h-8 items-center" id="tally-grape"></div>
                <div class="w-1/3 text-center font-mono font-black text-2xl text-brand-text" id="freq-grape">0</div>
            </div>
        </div>
        
        <div id="sort-feedback" class="h-8 mt-4 font-bold text-sm text-center text-brand-green"></div>
        <button id="btn-reset-sort" class="hidden mt-2 text-xs font-bold text-gray-400 hover:text-brand-blue underline">Reiniciar</button>

    </div>
    `;

                    const itemsContainer = container.querySelector("#items-container");
                    const feedback = container.querySelector("#sort-feedback");
                    const btnReset = container.querySelector("#btn-reset-sort");

                    const renderTally = (count) => {
                        // Gera visualiza√ß√£o de tracinhos (grupos de 5)
                        // I I I I <s>I</s>
                        const groups = Math.floor(count / 5);
                        const remainder = count % 5;
                        let html = "";

                        for (let i = 0; i < groups; i++) {
                            html += `<span class="tracking-tighter mx-1 line-through decoration-2 decoration-red-400/50">|||||</span>`;
                        }
                        if (remainder > 0) {
                            html += `<span class="tracking-widest">${"|".repeat(
                                remainder
                            )}</span>`;
                        }
                        return html;
                    };

                    const handleItemClick = (item, element) => {
                        // Anima√ß√£o de voo
                        element.style.pointerEvents = "none";
                        element.style.transition = "all 0.5s ease-in-out";
                        element.style.opacity = "0";
                        element.style.transform = "scale(0.5) translateY(50px)";

                        // Atualiza L√≥gica
                        counts[item.type]++;

                        // Atualiza Tabela
                        const tallyEl = container.querySelector(`#tally-${item.type}`);
                        const freqEl = container.querySelector(`#freq-${item.type}`);

                        // Anima√ß√£o da tabela
                        freqEl.classList.add("scale-125", "text-brand-green");
                        setTimeout(
                            () => freqEl.classList.remove("scale-125", "text-brand-green"),
                            200
                        );

                        tallyEl.innerHTML = renderTally(counts[item.type]);
                        freqEl.innerText = counts[item.type];

                        // Verifica fim
                        const totalClicked = Object.values(counts).reduce(
                            (a, b) => a + b,
                            0
                        );
                        if (totalClicked === rawData.length) {
                            feedback.innerText = "Tabela Completa! Dados Organizados. üéâ";
                            btnReset.classList.remove("hidden");
                        }
                    };

                    const init = () => {
                        itemsContainer.innerHTML = "";
                        counts = { apple: 0, banana: 0, grape: 0 };
                        ["apple", "banana", "grape"].forEach((k) => {
                            container.querySelector(`#tally-${k}`).innerHTML = "";
                            container.querySelector(`#freq-${k}`).innerText = "0";
                        });
                        feedback.innerText = "";
                        btnReset.classList.add("hidden");

                        // Embaralha e renderiza itens
                        const shuffled = [...rawData].sort(() => Math.random() - 0.5);
                        shuffled.forEach((item) => {
                            const el = document.createElement("button");
                            el.className =
                                "w-10 h-10 bg-white border border-gray-200 rounded-lg shadow-sm text-2xl flex items-center justify-center hover:scale-110 hover:border-brand-blue transition-transform active:scale-95";
                            el.innerText = item.icon;
                            el.onclick = () => handleItemClick(item, el);
                            itemsContainer.appendChild(el);
                        });
                    };

                    btnReset.onclick = init;
                    init();
                },

                interactive_survey_game(container) {
                    let score = 0;
                    let votes = { love: 0, neutral: 0, hate: 0 }; // Op√ß√µes: Gostei, Neutro, N√£o Gostei
                    let isPlaying = false;
                    let gameInterval;
                    let spawnTimeout;

                    // Elementos do jogo
                    const opinions = [
                        {
                            type: "love",
                            icon: "üòç",
                            label: "Amei!",
                            color: "brand-green",
                        },
                        {
                            type: "neutral",
                            icon: "üòê",
                            label: "Ok...",
                            color: "brand-yellow",
                        },
                        { type: "hate", icon: "ü§¢", label: "Ruim", color: "brand-red" },
                    ];

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[450px]">
        
        <div class="flex justify-between w-full items-center mb-2 z-20">
            <div class="text-white font-bold bg-gray-800 px-3 py-1 rounded-full text-xs uppercase tracking-widest"><i class="fas fa-stopwatch text-brand-blue"></i> Tempo: <span id="survey-time">30</span>s</div>
            <div class="text-brand-green font-black text-xl">Score: <span id="survey-score">0</span></div>
        </div>

        <div id="survey-stage" class="absolute inset-0 top-10 bottom-32 z-10 overflow-hidden cursor-default">
            </div>

        <div class="absolute bottom-0 w-full bg-gray-800 border-t-4 border-gray-600 p-4 z-30 rounded-t-2xl shadow-[0_-5px_15px_rgba(0,0,0,0.5)]">
            <div class="flex justify-center gap-2 mb-2">
                <div class="text-[10px] text-gray-400 uppercase font-bold text-center w-full">Registre a opini√£o:</div>
            </div>
            <div class="grid grid-cols-3 gap-2">
                <button class="survey-btn bg-green-900 border-b-4 border-green-700 text-green-400 hover:bg-green-800 hover:text-white py-3 rounded-lg font-bold flex flex-col items-center active:border-b-0 active:translate-y-1 transition-all" data-type="love">
                    <span class="text-2xl">üòç</span>
                </button>
                <button class="survey-btn bg-yellow-900 border-b-4 border-yellow-700 text-yellow-400 hover:bg-yellow-800 hover:text-white py-3 rounded-lg font-bold flex flex-col items-center active:border-b-0 active:translate-y-1 transition-all" data-type="neutral">
                    <span class="text-2xl">üòê</span>
                </button>
                <button class="survey-btn bg-red-900 border-b-4 border-red-700 text-red-400 hover:bg-red-800 hover:text-white py-3 rounded-lg font-bold flex flex-col items-center active:border-b-0 active:translate-y-1 transition-all" data-type="hate">
                    <span class="text-2xl">ü§¢</span>
                </button>
            </div>
            <div class="flex justify-between mt-2 text-[10px] font-mono text-gray-400 px-2">
                <span>üòç: <span id="cnt-love">0</span></span>
                <span>üòê: <span id="cnt-neutral">0</span></span>
                <span>ü§¢: <span id="cnt-hate">0</span></span>
            </div>
        </div>

        <div id="survey-overlay" class="absolute inset-0 bg-gray-900/95 z-40 flex flex-col items-center justify-center text-center p-6">
            <div class="text-6xl mb-4">üìã</div>
            <h3 class="text-2xl font-black text-white mb-2" id="ov-title">Pesquisa de Cinema</h3>
            <p class="text-gray-400 text-sm mb-6 max-w-xs">As pessoas v√£o falar o que acharam do filme. Clique no bot√£o correspondente antes que elas v√£o embora!</p>
            <button id="btn-start-survey" class="bg-brand-blue text-white font-bold py-3 px-10 rounded-full shadow-[0_0_15px_rgba(28,176,246,0.6)] animate-pulse uppercase tracking-widest">Iniciar Pesquisa</button>
        </div>

    </div>
    `;

                    const stage = container.querySelector("#survey-stage");
                    const timeEl = container.querySelector("#survey-time");
                    const scoreEl = container.querySelector("#survey-score");
                    const overlay = container.querySelector("#survey-overlay");
                    const startBtn = container.querySelector("#btn-start-survey");
                    const btns = container.querySelectorAll(".survey-btn");

                    // Estado local para o "alvo atual" (a pessoa que est√° falando)
                    let currentTarget = null; // { el: DOM, type: 'love' }

                    const spawnPerson = () => {
                        if (!isPlaying) return;

                        // Limpa anterior se o jogador foi lento
                        if (currentTarget) {
                            currentTarget.el.remove();
                            score = Math.max(0, score - 5); // Penalidade por perder
                            scoreEl.innerText = score;
                            // Feedback visual de perda
                            stage.classList.add("bg-red-500/10");
                            setTimeout(() => stage.classList.remove("bg-red-500/10"), 100);
                        }

                        // Cria nova pessoa
                        const opinion =
                            opinions[Math.floor(Math.random() * opinions.length)];
                        const person = document.createElement("div");

                        // Posi√ß√£o aleat√≥ria na largura
                        const left = 20 + Math.random() * 60;

                        person.className =
                            "absolute flex flex-col items-center transition-all duration-500 animate-pop-in";
                        person.style.left = `${left}%`;
                        person.style.bottom = "10px"; // Come√ßa baixo e sobe ou fica parado? Vamos fazer aparecer.

                        // Bal√£o de Fala
                        person.innerHTML = `
            <div class="bg-white text-gray-900 border-2 border-gray-300 px-4 py-2 rounded-xl rounded-bl-none shadow-lg mb-2 font-bold text-lg animate-bounce">
                ${opinion.icon} ${opinion.label}
            </div>
            <div class="text-5xl">üë§</div>
        `;

                        stage.appendChild(person);
                        currentTarget = { el: person, type: opinion.type };

                        // Tempo para responder diminui com o tempo (dificuldade)
                        const difficulty = Math.max(800, 2000 - score * 20);

                        spawnTimeout = setTimeout(spawnPerson, difficulty);
                    };

                    const registerVote = (type) => {
                        if (!isPlaying || !currentTarget) return;

                        if (type === currentTarget.type) {
                            // Acerto
                            score += 10;
                            votes[type]++;
                            container.querySelector(`#cnt-${type}`).innerText = votes[type];

                            // Efeito de sucesso
                            currentTarget.el.innerHTML = `<div class="text-5xl text-green-400 animate-ping">‚úÖ</div>`;
                            setTimeout(() => currentTarget?.el?.remove(), 200);

                            // Cancela o timeout atual (morte natural) e spawna o pr√≥ximo imediatamente
                            clearTimeout(spawnTimeout);
                            currentTarget = null;
                            setTimeout(spawnPerson, 300); // Pequeno delay
                        } else {
                            // Erro
                            score = Math.max(0, score - 10);
                            currentTarget.el.classList.add("animate-shake");
                            // Feedback de erro
                            stage.classList.add("bg-red-500/20");
                            setTimeout(() => stage.classList.remove("bg-red-500/20"), 100);
                        }
                        scoreEl.innerText = score;
                    };

                    const gameOver = () => {
                        isPlaying = false;
                        clearTimeout(spawnTimeout);
                        stage.innerHTML = "";

                        overlay.classList.remove("hidden");
                        overlay.querySelector("h3").innerText = "Fim da Pesquisa!";
                        overlay.querySelector("p").innerHTML = `
            Entrevistados: <strong class="text-white">${votes.love + votes.neutral + votes.hate
                            }</strong><br>
            Pontua√ß√£o Final: <strong class="text-brand-green">${score}</strong>
        `;
                        startBtn.innerText = "NOVA PESQUISA";
                    };

                    const startGame = () => {
                        score = 0;
                        votes = { love: 0, neutral: 0, hate: 0 };
                        scoreEl.innerText = 0;
                        ["love", "neutral", "hate"].forEach(
                            (k) => (container.querySelector(`#cnt-${k}`).innerText = 0)
                        );

                        let timeLeft = 30;
                        timeEl.innerText = timeLeft;

                        overlay.classList.add("hidden");
                        isPlaying = true;

                        spawnPerson();

                        clearInterval(gameInterval);
                        gameInterval = setInterval(() => {
                            timeLeft--;
                            timeEl.innerText = timeLeft;
                            if (timeLeft <= 5) timeEl.classList.add("text-red-500");
                            else timeEl.classList.remove("text-red-500");

                            if (timeLeft <= 0) {
                                clearInterval(gameInterval);
                                gameOver();
                            }
                        }, 1000);
                    };

                    startBtn.onclick = startGame;
                    btns.forEach((btn) => {
                        // Usa onmousedown para resposta r√°pida (melhor sensa√ß√£o em jogos)
                        btn.onmousedown = (e) => {
                            e.preventDefault();
                            registerVote(btn.dataset.type);
                            btn.classList.add("bg-gray-700"); // Visual click
                            setTimeout(() => btn.classList.remove("bg-gray-700"), 100);
                        };
                        // Touch support
                        btn.ontouchstart = (e) => {
                            e.preventDefault();
                            registerVote(btn.dataset.type);
                        };
                    });
                },

                interactive_pictogram_legend(container) {
                    // Estado
                    let scale = 1;
                    let iconCount = 4;
                    const icon = "üç¶";

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Laborat√≥rio de Legenda</h3>

        <div class="w-full bg-blue-50 border-2 border-blue-100 rounded-2xl p-6 mb-6 text-center relative overflow-hidden">
            <div class="text-4xl md:text-5xl tracking-widest mb-2 transition-all" id="picto-row">
                üç¶üç¶üç¶üç¶
            </div>
            <p class="text-xs text-gray-400 font-bold uppercase tracking-widest">Vendas de Sorvete</p>
        </div>

        <div class="flex flex-col items-center gap-4 w-full max-w-sm">
            
            <div class="flex items-center gap-4 bg-gray-100 p-2 rounded-xl">
                <span class="text-xs font-bold text-gray-500 uppercase ml-2">Legenda:</span>
                <div class="flex items-center bg-white px-3 py-1 rounded-lg border border-gray-200 shadow-sm">
                    <span class="text-xl mr-2">üç¶</span>
                    <span class="font-bold text-gray-400 mr-2">=</span>
                    <span id="legend-val" class="font-black text-brand-blue text-xl">1</span>
                </div>
            </div>

            <input type="range" id="scale-slider" min="1" max="100" value="1" step="1" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue">
            
            <div class="flex justify-between w-full text-[10px] text-gray-400 font-bold px-1">
                <span>1</span>
                <span>10</span>
                <span>50</span>
                <span>100</span>
            </div>

        </div>

        <div class="mt-8 text-center">
            <p class="text-xs text-gray-400 font-bold uppercase mb-1">C√°lculo Real</p>
            <div class="text-lg md:text-xl font-mono text-gray-600 bg-gray-50 px-4 py-2 rounded-lg border border-gray-200 inline-block">
                <span class="text-brand-purple" id="calc-count">4</span> desenhos √ó 
                <span class="text-brand-blue" id="calc-scale">1</span> valor
            </div>
            <div class="mt-2 text-4xl font-black text-brand-green animate-pop-in" id="total-val">4</div>
            <p class="text-xs text-gray-400 font-bold mt-1 uppercase">Total de Sorvetes</p>
        </div>

    </div>
    `;

                    const slider = container.querySelector("#scale-slider");
                    const legendVal = container.querySelector("#legend-val");
                    const totalVal = container.querySelector("#total-val");
                    const calcScale = container.querySelector("#calc-scale");

                    const update = () => {
                        scale = parseInt(slider.value);

                        // Atualiza UI
                        legendVal.innerText = scale;
                        calcScale.innerText = scale;

                        const total = iconCount * scale;
                        totalVal.innerText = total.toLocaleString("pt-BR"); // Formata milhar

                        // Anima√ß√£o simples
                        totalVal.classList.remove("animate-pop-in");
                        void totalVal.offsetWidth; // Trigger reflow
                        totalVal.classList.add("animate-pop-in");
                    };

                    slider.addEventListener("input", update);
                },

                interactive_pictogram_harvest(container) {
                    // Configura√ß√£o
                    const fruits = [
                        {
                            icon: "üçé",
                            name: "Ma√ß√£s",
                            color: "text-red-500",
                            bg: "bg-red-50",
                        },
                        {
                            icon: "üçå",
                            name: "Bananas",
                            color: "text-yellow-600",
                            bg: "bg-yellow-50",
                        },
                        {
                            icon: "üçá",
                            name: "Uvas",
                            color: "text-purple-600",
                            bg: "bg-purple-50",
                        },
                        {
                            icon: "üçä",
                            name: "Laranjas",
                            color: "text-orange-500",
                            bg: "bg-orange-50",
                        },
                    ];

                    let currentFruit = null;
                    let count = 0;
                    let scale = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-6 z-10">
            <h3 class="text-white font-black uppercase text-xs tracking-widest"><i class="fas fa-tractor"></i> Colheita Feliz</h3>
            <div class="bg-gray-700 px-3 py-1 rounded-full text-xs font-black text-brand-yellow">Pontos: <span id="farm-score">0</span></div>
        </div>

        <div class="w-full bg-white rounded-xl p-4 mb-6 shadow-md z-10 relative">
            <div class="absolute -top-3 -right-3 bg-brand-yellow text-yellow-900 font-black px-3 py-1 rounded-lg shadow-sm border-2 border-yellow-500 transform rotate-12 animate-pulse">
                Legenda: <span id="legend-icon">üçé</span> = <span id="legend-number">10</span>
            </div>

            <div class="flex items-center gap-4 mb-2">
                <div class="w-16 text-right font-bold text-gray-500 text-sm" id="fruit-label">Ma√ß√£s</div>
                <div class="flex-1 bg-gray-100 rounded-lg p-2 h-12 flex items-center overflow-hidden" id="chart-row">
                    </div>
            </div>
            
            <div class="flex items-center gap-4 opacity-30 blur-[1px]">
                <div class="w-16 text-right font-bold text-gray-400 text-sm">Outros</div>
                <div class="flex-1 bg-gray-50 rounded-lg p-2 h-12 flex items-center">ü•ïü•ï</div>
            </div>
        </div>

        <p class="text-gray-400 text-sm font-bold mb-4 z-10">Quantas frutas foram colhidas?</p>

        <div class="grid grid-cols-2 gap-3 w-full max-w-xs z-10" id="opts-container">
        </div>

        <div id="farm-feedback" class="h-10 mt-2 flex items-center justify-center font-bold text-lg z-10"></div>

    </div>
    `;

                    const chartRow = container.querySelector("#chart-row");
                    const legendIcon = container.querySelector("#legend-icon");
                    const legendNum = container.querySelector("#legend-number");
                    const fruitLabel = container.querySelector("#fruit-label");
                    const optsContainer = container.querySelector("#opts-container");
                    const feedback = container.querySelector("#farm-feedback");
                    const scoreEl = container.querySelector("#farm-score");

                    const nextRound = () => {
                        feedback.innerText = "";

                        // 1. Escolhe Fruta e Escala
                        currentFruit = fruits[Math.floor(Math.random() * fruits.length)];
                        scale = [2, 5, 10, 20, 50, 100][Math.floor(Math.random() * 6)];
                        count = Math.floor(Math.random() * 6) + 2; // 2 a 7 √≠cones

                        // 2. Renderiza Gr√°fico
                        fruitLabel.innerText = currentFruit.name;
                        legendIcon.innerText = currentFruit.icon;
                        legendNum.innerText = scale;

                        chartRow.innerHTML = "";
                        chartRow.className = `flex-1 rounded-lg p-2 h-12 flex items-center overflow-hidden transition-colors ${currentFruit.bg}`;

                        // Adiciona √≠cones com atraso
                        for (let i = 0; i < count; i++) {
                            const span = document.createElement("span");
                            span.innerText = currentFruit.icon;
                            span.className = "text-2xl animate-pop-in mr-1";
                            span.style.animationDelay = `${i * 0.1}s`;
                            chartRow.appendChild(span);
                        }

                        // 3. Gera Op√ß√µes
                        const correct = count * scale;
                        let options = [correct];

                        // Erro comum 1: Contar s√≥ os √≠cones (esquecer a escala)
                        options.push(count);

                        // Erro comum 2: Erro de multiplica√ß√£o vizinho
                        options.push((count + 1) * scale);
                        options.push((count - 1) * scale);

                        // Embaralha e remove duplicatas
                        options = [...new Set(options)].sort(() => Math.random() - 0.5);
                        if (options.length < 4) options.push(correct + 10); // Fallback

                        optsContainer.innerHTML = "";
                        options.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-gray-700 hover:bg-gray-600 text-white border-b-4 border-gray-900 font-bold py-3 rounded-xl active:scale-95 transition-all text-xl";
                            btn.innerText = opt;
                            btn.onclick = () => check(opt, correct, btn);
                            optsContainer.appendChild(btn);
                        });
                    };

                    const check = (val, correct, btn) => {
                        // Bloqueia bot√µes
                        Array.from(optsContainer.children).forEach(
                            (b) => (b.disabled = true)
                        );

                        if (val === correct) {
                            score += 50;
                            scoreEl.innerText = score;
                            btn.classList.replace("bg-gray-700", "bg-brand-green");
                            btn.classList.replace("border-gray-900", "border-green-800");
                            feedback.innerHTML = `<span class="text-brand-green">CERTO! ${count} x ${scale} = ${correct}</span>`;
                            setTimeout(nextRound, 1500);
                        } else {
                            btn.classList.replace("bg-gray-700", "bg-brand-red");
                            btn.classList.replace("border-gray-900", "border-red-800");
                            btn.classList.add("animate-shake");

                            feedback.innerHTML = `<span class="text-brand-red">Ops! Lembre-se da legenda.</span>`;

                            // Destaca o certo
                            Array.from(optsContainer.children).forEach((b) => {
                                if (parseInt(b.innerText) === correct) {
                                    b.classList.replace("bg-gray-700", "bg-brand-green");
                                    b.classList.add("opacity-50");
                                }
                            });

                            setTimeout(nextRound, 2000);
                        }
                    };

                    nextRound();
                },

                interactive_context_scroller(container) {
                    const scenes = [
                        {
                            val: 20,
                            icon: "ü¶Ö",
                            label: "C√©u (P√°ssaros)",
                            color: "bg-blue-200",
                        },
                        { val: 10, icon: "‚úàÔ∏è", label: "Voo Baixo", color: "bg-blue-100" },
                        {
                            val: 0,
                            icon: "üèùÔ∏è",
                            label: "N√≠vel do Mar (Origem)",
                            color: "bg-green-200",
                        },
                        {
                            val: -10,
                            icon: "üêü",
                            label: "Mergulho Raso",
                            color: "bg-blue-300",
                        },
                        {
                            val: -20,
                            icon: "ü¶à",
                            label: "Profundezas",
                            color: "bg-blue-500",
                        },
                        {
                            val: -30,
                            icon: "üåã",
                            label: "Fundo do Mar",
                            color: "bg-blue-700",
                        },
                    ];

                    let currentVal = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex items-center justify-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <div class="flex gap-8 items-center w-full max-w-md">
            
            <div class="flex flex-col items-center">
                <input type="range" id="ctx-slider" min="-30" max="20" value="0" step="10" orient="vertical" class="h-64 w-4 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue" style="-webkit-appearance: slider-vertical;">
            </div>

            <div class="flex-1 h-64 relative bg-gray-50 rounded-xl border-4 border-gray-200 overflow-hidden flex flex-col items-center justify-center transition-colors duration-500" id="ctx-screen">
                
                <div class="absolute inset-0 opacity-20 pointer-events-none" id="ctx-bg"></div>

                <div class="z-10 text-center transform transition-all duration-300" id="ctx-content">
                    <div class="text-6xl mb-2 animate-bounce" id="ctx-icon">üèùÔ∏è</div>
                    <h3 class="font-black text-2xl text-gray-700" id="ctx-val">0m</h3>
                    <p class="text-sm font-bold text-gray-500 uppercase tracking-wide" id="ctx-label">N√≠vel do Mar</p>
                </div>

                <div class="absolute top-1/2 w-full h-0.5 bg-blue-500 border-t border-dashed border-white opacity-50"></div>
            </div>

        </div>
    </div>
    `;

                    const slider = container.querySelector("#ctx-slider");
                    const screen = container.querySelector("#ctx-screen");
                    const icon = container.querySelector("#ctx-icon");
                    const valText = container.querySelector("#ctx-val");
                    const label = container.querySelector("#ctx-label");
                    const bg = container.querySelector("#ctx-bg");

                    const update = () => {
                        const val = parseInt(slider.value);
                        // Encontra a cena mais pr√≥xima
                        const scene = scenes.reduce((prev, curr) => {
                            return Math.abs(curr.val - val) < Math.abs(prev.val - val)
                                ? curr
                                : prev;
                        });

                        valText.innerText = val > 0 ? `+${val}m` : `${val}m`;
                        if (val === 0)
                            valText.className = "font-black text-2xl text-gray-700";
                        else if (val > 0)
                            valText.className = "font-black text-2xl text-brand-green";
                        else valText.className = "font-black text-2xl text-brand-red";

                        icon.innerText = scene.icon;
                        label.innerText = scene.label;

                        // Remove cores antigas
                        screen.className = `flex-1 h-64 relative rounded-xl border-4 border-gray-200 overflow-hidden flex flex-col items-center justify-center transition-colors duration-500 ${scene.color}`;
                    };

                    slider.addEventListener("input", update);
                    update();
                },

                interactive_mirror_walk(container) {
                    let pos = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Caminhada Sim√©trica</h3>

        <div class="relative w-full max-w-lg h-24 mb-6 flex items-center">
            <div class="absolute w-full h-1 bg-gray-300 rounded"></div>
            <div class="absolute left-1/2 top-0 bottom-0 w-1 bg-gray-800 z-0"></div>
            <div class="absolute left-1/2 -bottom-6 -translate-x-1/2 font-black text-gray-800">0</div>

            <div id="char-real" class="absolute w-8 h-8 bg-brand-blue rounded-full border-2 border-white shadow-lg z-10 flex items-center justify-center text-xs font-bold text-white transition-all duration-300" style="left: 50%">
                üôÇ
            </div>

            <div id="char-mirror" class="absolute w-8 h-8 bg-brand-red rounded-full border-2 border-white shadow-lg z-10 flex items-center justify-center text-xs font-bold text-white opacity-50 transition-all duration-300" style="left: 50%">
                üôÉ
            </div>
        </div>

        <input type="range" id="mirror-slider" min="-5" max="5" step="1" value="0" class="w-full max-w-xs h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-purple mb-4">

        <div class="flex justify-between w-full max-w-xs text-sm font-bold">
            <div class="text-brand-red text-center w-1/2 border-r border-gray-200">
                Reflexo<br><span id="val-mirror" class="text-xl">0</span>
            </div>
            <div class="text-brand-blue text-center w-1/2">
                Voc√™<br><span id="val-real" class="text-xl">0</span>
            </div>
        </div>
        
        <p class="text-xs text-gray-400 mt-4 italic text-center">Note que a dist√¢ncia at√© o centro √© sempre igual!</p>
    </div>
    `;

                    const slider = container.querySelector("#mirror-slider");
                    const real = container.querySelector("#char-real");
                    const mirror = container.querySelector("#char-mirror");
                    const valReal = container.querySelector("#val-real");
                    const valMirror = container.querySelector("#val-mirror");

                    const update = () => {
                        const v = parseInt(slider.value);
                        // Mapeia -5 a 5 para porcentagem (0 a 100%)
                        // 0 √© 50%. 5 √© 90% (margem). -5 √© 10%.
                        const center = 50;
                        const scale = 8; // % por unidade

                        const pReal = center + v * scale;
                        const pMirror = center - v * scale;

                        real.style.left = `calc(${pReal}% - 16px)`; // -16px metade da largura
                        mirror.style.left = `calc(${pMirror}% - 16px)`;

                        valReal.innerText = v > 0 ? `+${v}` : v;
                        valMirror.innerText = -v > 0 ? `+${-v}` : -v;
                    };

                    slider.addEventListener("input", update);
                },

                interactive_absolute_fuel(container) {
                    let pos = 0;
                    let fuelUsed = 0;
                    let lastPos = 0;

                    container.innerHTML = `
    <div class="bg-gray-800 border-4 border-gray-600 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">
        
        <div class="flex justify-between w-full mb-6 z-10">
            <div class="flex flex-col">
                <span class="text-[10px] font-bold text-gray-400 uppercase">Posi√ß√£o (x)</span>
                <span id="pos-display" class="text-2xl font-mono font-bold text-brand-blue">0</span>
            </div>
            <div class="flex flex-col text-right">
                <span class="text-[10px] font-bold text-gray-400 uppercase">Dist√¢ncia (|x|)</span>
                <span id="dist-display" class="text-2xl font-mono font-bold text-brand-green">0</span>
            </div>
        </div>

        <div class="relative w-full h-20 bg-gray-700 rounded-lg border-2 border-gray-500 mb-6 flex items-center overflow-hidden">
            <div class="absolute top-1/2 w-full h-0.5 bg-gray-500 border-t border-dashed border-gray-400"></div>
            <div class="absolute top-0 bottom-0 left-1/2 w-0.5 bg-red-500 z-0 opacity-50"></div> <div id="car" class="absolute w-12 h-8 bg-brand-yellow rounded-lg border-2 border-white shadow-lg z-10 flex items-center justify-center text-xl transition-all duration-300" style="left: calc(50% - 24px)">
                üöó
            </div>
        </div>

        <div class="flex gap-4 w-full justify-center">
            <button id="btn-left" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-l-full border-r border-gray-800 active:scale-95 transition-all">
                <i class="fas fa-arrow-left"></i> Esquerda (-1)
            </button>
            <button id="btn-right" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-r-full border-l border-gray-800 active:scale-95 transition-all">
                Direita (+1)
            </button>
        </div>

        <div id="fuel-gauge" class="mt-4 w-full bg-gray-900 rounded-full h-4 border border-gray-600 overflow-hidden relative">
            <div id="fuel-bar" class="h-full bg-brand-orange transition-all duration-300" style="width: 0%"></div>
            <span class="absolute inset-0 flex items-center justify-center text-[8px] font-bold text-white uppercase tracking-widest">Combust√≠vel Gasto</span>
        </div>

    </div>
    `;

                    const car = container.querySelector("#car");
                    const posDisp = container.querySelector("#pos-display");
                    const distDisp = container.querySelector("#dist-display");
                    const fuelBar = container.querySelector("#fuel-bar");

                    const update = () => {
                        // Limita movimento visual (-5 a +5 para caber)
                        if (pos < -5) pos = -5;
                        if (pos > 5) pos = 5;

                        // Visual Carro
                        // 50% √© o zero. Cada unidade = 8% da largura (aprox)
                        const leftPct = 50 + pos * 8;
                        car.style.left = `calc(${leftPct}% - 24px)`;
                        // Vira o carro
                        car.style.transform = pos < lastPos ? "scaleX(-1)" : "scaleX(1)";

                        // Dados
                        posDisp.innerText = pos > 0 ? `+${pos}` : pos;
                        if (pos < 0)
                            posDisp.className =
                                "text-2xl font-mono font-bold text-brand-red";
                        else
                            posDisp.className =
                                "text-2xl font-mono font-bold text-brand-blue";

                        const abs = Math.abs(pos);
                        distDisp.innerText = abs;

                        // Barra de combust√≠vel (M√≥dulo visual)
                        // 5 unidades = 100% da barra visual neste exemplo
                        fuelBar.style.width = `${(abs / 5) * 100}%`;

                        lastPos = pos;
                    };

                    container.querySelector("#btn-left").onclick = () => {
                        pos--;
                        update();
                    };
                    container.querySelector("#btn-right").onclick = () => {
                        pos++;
                        update();
                    };
                },

                interactive_opposite_match(container) {
                    // Pares para o jogo
                    const values = [1, 2, 3, 5];
                    let cards = [];

                    // Gera cartas (+1, -1, +2, -2...)
                    values.forEach((v) => {
                        cards.push({ val: v, label: `+${v}`, type: "pos" });
                        cards.push({ val: -v, label: `-${v}`, type: "neg" });
                    });

                    // Embaralha
                    cards.sort(() => Math.random() - 0.5);

                    let selected = null; // Cart√£o selecionado
                    let matches = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-4">
            <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest">Jogo dos Opostos</h3>
            <div class="bg-purple-50 text-brand-purple px-3 py-1 rounded-full text-xs font-black">Pares: <span id="opp-score">0</span>/4</div>
        </div>

        <div class="grid grid-cols-4 gap-2 w-full max-w-sm mb-4" id="opp-grid">
        </div>

        <div id="opp-feedback" class="h-8 font-bold text-sm text-center text-gray-500">Selecione um n√∫mero...</div>

        <button id="btn-reset-opp" class="mt-2 text-xs font-bold text-brand-blue hover:underline hidden">Jogar Novamente</button>
    </div>
    `;

                    const grid = container.querySelector("#opp-grid");
                    const feedback = container.querySelector("#opp-feedback");
                    const scoreEl = container.querySelector("#opp-score");
                    const btnReset = container.querySelector("#btn-reset-opp");

                    const render = () => {
                        grid.innerHTML = "";
                        cards.forEach((card, idx) => {
                            const btn = document.createElement("button");
                            const colorClass =
                                card.type === "pos"
                                    ? "text-brand-green border-green-200"
                                    : "text-brand-red border-red-200";

                            btn.className = `h-16 rounded-xl border-2 font-black text-xl shadow-sm transition-all transform hover:scale-105 active:scale-95 flex items-center justify-center ${colorClass} bg-white`;

                            if (card.matched) {
                                btn.className =
                                    "h-16 rounded-xl border-2 border-dashed border-gray-200 bg-gray-50 text-gray-300 flex items-center justify-center opacity-50 cursor-default";
                                btn.innerText = "0"; // Cancelado
                            } else {
                                btn.innerText = card.label;
                                btn.onclick = () => handleClick(idx, btn);
                            }

                            grid.appendChild(btn);
                        });
                    };

                    const handleClick = (idx, btn) => {
                        if (cards[idx].matched) return;

                        // Highlight
                        btn.classList.add("ring-4", "ring-brand-purple");

                        if (selected === null) {
                            // Primeiro clique
                            selected = { idx, btn };
                            feedback.innerText = `Encontre o oposto de ${cards[idx].label}`;
                        } else {
                            // Segundo clique
                            if (selected.idx === idx) {
                                // Clicou no mesmo (Deselecionar)
                                selected = null;
                                btn.classList.remove("ring-4", "ring-brand-purple");
                                feedback.innerText = "Selecione um n√∫mero...";
                                return;
                            }

                            const val1 = cards[selected.idx].val;
                            const val2 = cards[idx].val;

                            if (val1 + val2 === 0) {
                                // MATCH!
                                feedback.innerHTML = `<span class="text-brand-green">BOOM! ${val1} + (${val2}) = 0</span>`;
                                cards[selected.idx].matched = true;
                                cards[idx].matched = true;
                                matches++;
                                scoreEl.innerText = matches;

                                selected = null;
                                render(); // Re-renderiza para mostrar o "0"

                                if (matches === 4) {
                                    feedback.innerText = "Parab√©ns! Tudo zerado.";
                                    btnReset.classList.remove("hidden");
                                }
                            } else {
                                // Erro
                                feedback.innerHTML = `<span class="text-brand-red">N√£o zerou! Tente de novo.</span>`;
                                btn.classList.add("animate-shake");
                                selected.btn.classList.add("animate-shake");

                                // Reset visual ap√≥s delay
                                setTimeout(() => {
                                    btn.classList.remove(
                                        "ring-4",
                                        "ring-brand-purple",
                                        "animate-shake"
                                    );
                                    selected.btn.classList.remove(
                                        "ring-4",
                                        "ring-brand-purple",
                                        "animate-shake"
                                    );
                                    selected = null;
                                    feedback.innerText = "Tente outro par.";
                                }, 600);
                            }
                        }
                    };

                    btnReset.onclick = () => {
                        matches = 0;
                        scoreEl.innerText = 0;
                        cards.forEach((c) => (c.matched = false));
                        cards.sort(() => Math.random() - 0.5);
                        btnReset.classList.add("hidden");
                        render();
                    };

                    render();
                },

                interactive_integer_battle(container) {
                    let score = 0;
                    let round = 1;
                    const maxRounds = 5;

                    // Pares desenhados para gerar d√∫vida
                    const battles = [
                        { a: -5, b: 2 },
                        { a: -100, b: -1 }, // Cl√°ssico: -1 √© maior
                        { a: 0, b: -7 },
                        { a: -15, b: -20 },
                        { a: 8, b: -50 },
                    ];

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full z-10 mb-4 items-center">
            <div class="text-white font-black text-lg italic">BATTLE <span class="text-brand-blue text-xs">INTEGERS</span></div>
            <div class="bg-gray-800 border border-gray-600 px-3 py-1 rounded-full text-xs font-bold text-white">
                Rodada <span id="bat-round">1</span>/5
            </div>
        </div>

        <p class="text-gray-400 text-xs font-bold uppercase mb-4 z-10">Clique no n√∫mero MAIOR</p>

        <div class="flex-1 w-full flex items-center justify-center gap-4 z-10 relative mb-4">
            
            <button id="card-a" class="battle-card relative w-32 h-40 bg-gray-800 rounded-xl shadow-xl border-b-4 border-gray-950 hover:bg-gray-700 transition-all active:scale-95 flex items-center justify-center group">
                <span id="val-a" class="text-4xl font-black text-white group-hover:scale-110 transition-transform">?</span>
            </button>

            <div class="text-2xl font-black text-gray-600">VS</div>

            <button id="card-b" class="battle-card relative w-32 h-40 bg-gray-800 rounded-xl shadow-xl border-b-4 border-gray-950 hover:bg-gray-700 transition-all active:scale-95 flex items-center justify-center group">
                <span id="val-b" class="text-4xl font-black text-white group-hover:scale-110 transition-transform">?</span>
            </button>

        </div>

        <div id="bat-feedback" class="h-8 font-bold text-lg text-center z-10"></div>

        <div id="bat-end" class="absolute inset-0 flex flex-col items-center justify-center bg-gray-900 z-30 hidden">
            <div class="text-6xl mb-4">üèÜ</div>
            <h3 class="text-2xl font-black text-white mb-2">Fim de Jogo!</h3>
            <p class="text-gray-400 mb-6">Voc√™ acertou <span class="text-brand-green font-bold text-xl" id="final-bat-score"></span></p>
            <button onclick="app.renderLesson(document.getElementById('main-container'), app.currentLessonName)" class="bg-white text-gray-900 font-bold py-3 px-8 rounded-full shadow-lg hover:bg-gray-200">Reiniciar</button>
        </div>

    </div>
    `;

                    const cardA = container.querySelector("#card-a");
                    const cardB = container.querySelector("#card-b");
                    const valA = container.querySelector("#val-a");
                    const valB = container.querySelector("#val-b");
                    const feedback = container.querySelector("#bat-feedback");
                    const roundEl = container.querySelector("#bat-round");
                    const endScreen = container.querySelector("#bat-end");

                    let currentPair = null;

                    const loadRound = () => {
                        if (round > maxRounds) {
                            endScreen.querySelector(
                                "#final-bat-score"
                            ).innerText = `${score} de 5`;
                            endScreen.classList.remove("hidden");
                            return;
                        }

                        // Seleciona par (ou gera aleat√≥rio se acabar os presets)
                        if (round <= battles.length) {
                            currentPair = battles[round - 1];
                        } else {
                            currentPair = {
                                a: Math.floor(Math.random() * 40) - 20,
                                b: Math.floor(Math.random() * 40) - 20,
                            };
                            if (currentPair.a === currentPair.b) currentPair.b++;
                        }

                        roundEl.innerText = round;
                        valA.innerText = currentPair.a;
                        valB.innerText = currentPair.b;

                        // Reset Cores
                        cardA.className =
                            "battle-card relative w-32 h-40 bg-gray-800 rounded-xl shadow-xl border-b-4 border-gray-950 hover:bg-gray-700 transition-all active:scale-95 flex items-center justify-center group";
                        cardB.className =
                            "battle-card relative w-32 h-40 bg-gray-800 rounded-xl shadow-xl border-b-4 border-gray-950 hover:bg-gray-700 transition-all active:scale-95 flex items-center justify-center group";

                        // Cores do texto
                        valA.className =
                            currentPair.a < 0
                                ? "text-4xl font-black text-red-400"
                                : "text-4xl font-black text-green-400";
                        valB.className =
                            currentPair.b < 0
                                ? "text-4xl font-black text-red-400"
                                : "text-4xl font-black text-green-400";

                        feedback.innerText = "";
                    };

                    const check = (choice) => {
                        // 'a' ou 'b'
                        const isAMax = currentPair.a > currentPair.b;
                        const isCorrect =
                            (choice === "a" && isAMax) || (choice === "b" && !isAMax);

                        // Trava cliques
                        cardA.disabled = true;
                        cardB.disabled = true;

                        if (isCorrect) {
                            score++;
                            feedback.innerHTML =
                                "<span class='text-brand-green'>Acertou!</span>";
                            const winner = choice === "a" ? cardA : cardB;
                            winner.classList.remove("bg-gray-800", "border-gray-950");
                            winner.classList.add("bg-green-600", "border-green-800");
                        } else {
                            feedback.innerHTML =
                                "<span class='text-brand-red'>Errou! Lembre-se da reta.</span>";
                            const loser = choice === "a" ? cardA : cardB;
                            loser.classList.remove("bg-gray-800", "border-gray-950");
                            loser.classList.add(
                                "bg-red-600",
                                "border-red-800",
                                "animate-shake"
                            );
                        }

                        setTimeout(() => {
                            round++;
                            cardA.disabled = false;
                            cardB.disabled = false;
                            loadRound();
                        }, 1200);
                    };

                    cardA.onclick = () => check("a");
                    cardB.onclick = () => check("b");

                    loadRound();
                },

                interactive_integer_battle(container) {
                    let pArmy = 5;
                    let nArmy = 3;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        <h3 class="text-white font-black uppercase text-xs tracking-widest mb-6">Simulador de Batalha</h3>
        
        <div class="flex justify-between w-full max-w-sm mb-4 text-white font-bold text-sm">
            <span class="text-blue-400">Ex√©rcito Positivo (+)</span>
            <span class="text-red-400">Ex√©rcito Negativo (-)</span>
        </div>

        <div class="flex gap-2 w-full max-w-sm mb-6 bg-gray-800 p-2 rounded-xl border border-gray-600">
            <div class="flex-1 flex flex-col gap-2">
                <input type="range" id="range-p" min="1" max="10" value="5" class="w-full h-2 bg-blue-900 rounded-lg appearance-none cursor-pointer accent-blue-500">
                <div id="army-p" class="flex flex-wrap gap-1 min-h-[40px] content-start"></div>
            </div>
            <div class="w-px bg-gray-600"></div>
            <div class="flex-1 flex flex-col gap-2">
                <input type="range" id="range-n" min="1" max="10" value="3" class="w-full h-2 bg-red-900 rounded-lg appearance-none cursor-pointer accent-red-500">
                <div id="army-n" class="flex flex-wrap gap-1 min-h-[40px] content-start justify-end"></div>
            </div>
        </div>

        <button id="btn-fight" class="bg-yellow-500 hover:bg-yellow-400 text-yellow-900 font-black py-3 px-8 rounded-xl shadow-[0_4px_0_#b45309] active:translate-y-1 active:shadow-none transition-all w-full max-w-xs uppercase tracking-widest text-lg mb-4">
            LUTAR!
        </button>

        <div id="battle-res" class="h-16 flex items-center justify-center text-center w-full">
            <span class="text-gray-500 text-sm italic">Defina os ex√©rcitos e clique em lutar.</span>
        </div>
    </div>
    `;

                    const rangeP = container.querySelector("#range-p");
                    const rangeN = container.querySelector("#range-n");
                    const armyP = container.querySelector("#army-p");
                    const armyN = container.querySelector("#army-n");
                    const btnFight = container.querySelector("#btn-fight");
                    const resBox = container.querySelector("#battle-res");

                    const renderArmies = () => {
                        armyP.innerHTML = "";
                        armyN.innerHTML = "";

                        for (let i = 0; i < pArmy; i++) {
                            const soldier = document.createElement("div");
                            soldier.className =
                                "w-6 h-6 bg-blue-500 rounded-full shadow-sm border-2 border-blue-300 flex items-center justify-center text-[10px] text-white font-bold animate-pop-in";
                            soldier.innerText = "+";
                            armyP.appendChild(soldier);
                        }
                        for (let i = 0; i < nArmy; i++) {
                            const soldier = document.createElement("div");
                            soldier.className =
                                "w-6 h-6 bg-red-500 rounded-full shadow-sm border-2 border-red-300 flex items-center justify-center text-[10px] text-white font-bold animate-pop-in";
                            soldier.innerText = "-";
                            armyN.appendChild(soldier);
                        }

                        resBox.innerHTML = `<span class="text-white font-mono text-xl">(+${pArmy}) + (-${nArmy}) = ?</span>`;
                    };

                    const fight = async () => {
                        btnFight.disabled = true;
                        btnFight.classList.add("opacity-50", "cursor-not-allowed");

                        const min = Math.min(pArmy, nArmy);
                        const result = pArmy - nArmy;
                        const winnerColor =
                            result > 0
                                ? "text-blue-400"
                                : result < 0
                                    ? "text-red-400"
                                    : "text-white";
                        const winnerText = result > 0 ? `+${result}` : result;

                        // Anima√ß√£o de elimina√ß√£o
                        const pSoldiers = Array.from(armyP.children);
                        const nSoldiers = Array.from(armyN.children);

                        for (let i = 0; i < min; i++) {
                            pSoldiers[i].classList.add(
                                "scale-150",
                                "bg-yellow-400",
                                "border-yellow-200"
                            ); // Explos√£o
                            nSoldiers[i].classList.add(
                                "scale-150",
                                "bg-yellow-400",
                                "border-yellow-200"
                            );
                            await new Promise((r) => setTimeout(r, 200));

                            pSoldiers[i].style.opacity = "0";
                            nSoldiers[i].style.opacity = "0";
                        }

                        resBox.innerHTML = `
            <div class="flex flex-col items-center animate-pop-in">
                <span class="text-xs font-bold text-gray-400 uppercase">Resultado</span>
                <span class="text-4xl font-black ${winnerColor}">${winnerText}</span>
            </div>
        `;

                        btnFight.disabled = false;
                        btnFight.classList.remove("opacity-50", "cursor-not-allowed");
                    };

                    rangeP.oninput = (e) => {
                        pArmy = parseInt(e.target.value);
                        renderArmies();
                    };
                    rangeN.oninput = (e) => {
                        nArmy = parseInt(e.target.value);
                        renderArmies();
                    };
                    btnFight.onclick = fight;

                    renderArmies();
                },

                interactive_subtraction_transform(container) {
                    // Estado
                    const problems = [
                        { a: 5, b: 2, op: "-", text: "(+5) - (+2)" },
                        { a: 3, b: -4, op: "-", text: "(+3) - (-4)" },
                        { a: -2, b: 5, op: "-", text: "(-2) - (+5)" },
                        { a: -4, b: -3, op: "-", text: "(-4) - (-3)" },
                    ];
                    let currentIdx = 1; // Come√ßa com o exemplo (- -)

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-6">Laborat√≥rio de Transforma√ß√£o</h3>

        <div class="flex items-center justify-center gap-4 mb-8 w-full">
            <button id="btn-prev" class="text-gray-300 hover:text-brand-blue text-2xl"><i class="fas fa-chevron-left"></i></button>
            
            <div class="relative bg-gray-100 p-6 rounded-2xl border-2 border-gray-300 min-w-[240px] text-center transition-all duration-500" id="math-card">
                <div class="text-3xl font-mono font-bold text-gray-700" id="problem-text">(+3) - (-4)</div>
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-300" id="magic-flash">
                    <div class="w-full h-full bg-yellow-200 rounded-2xl opacity-50 animate-ping"></div>
                </div>
            </div>

            <button id="btn-next" class="text-gray-300 hover:text-brand-blue text-2xl"><i class="fas fa-chevron-right"></i></button>
        </div>

        <button id="btn-transform" class="bg-brand-purple hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-xl shadow-btn active:translate-y-1 active:shadow-none transition-all flex items-center gap-2 mb-4">
            <i class="fas fa-magic"></i> Transformar em Adi√ß√£o
        </button>

        <div id="result-area" class="h-16 w-full text-center opacity-0 transition-opacity duration-500">
            <p class="text-xs text-gray-400 font-bold uppercase mb-1">Nova Conta</p>
            <div class="text-2xl font-black text-brand-green" id="result-text"></div>
            <p class="text-xs text-gray-500 mt-1" id="rule-text"></p>
        </div>

    </div>
    `;

                    const probText = container.querySelector("#problem-text");
                    const resArea = container.querySelector("#result-area");
                    const resText = container.querySelector("#result-text");
                    const ruleText = container.querySelector("#rule-text");
                    const btnTrans = container.querySelector("#btn-transform");
                    const card = container.querySelector("#math-card");
                    const flash = container.querySelector("#magic-flash");

                    const loadProblem = () => {
                        const p = problems[currentIdx];
                        probText.innerHTML = `<span class="text-gray-600">(${p.a > 0 ? "+" + p.a : p.a
                            })</span> <span class="text-brand-red font-black text-4xl mx-1">-</span> <span class="text-gray-600">(${p.b > 0 ? "+" + p.b : p.b
                            })</span>`;
                        resArea.classList.add("opacity-0");
                        btnTrans.disabled = false;
                        btnTrans.classList.remove("opacity-50", "cursor-not-allowed");
                        btnTrans.innerHTML = `<i class="fas fa-magic"></i> Transformar em Adi√ß√£o`;
                        card.classList.remove("border-brand-green", "bg-green-50");
                        card.classList.add("border-gray-300", "bg-gray-100");
                    };

                    btnTrans.onclick = () => {
                        const p = problems[currentIdx];

                        // Anima√ß√£o
                        flash.classList.remove("opacity-0");
                        setTimeout(() => flash.classList.add("opacity-0"), 500);

                        // Transforma√ß√£o
                        const newB = -p.b; // Oposto
                        const signB = newB > 0 ? "+" : "";
                        const signA = p.a > 0 ? "+" : "";

                        const newText = `(${signA}${p.a}) <span class="text-brand-green font-black text-4xl mx-1">+</span> (${signB}${newB})`;

                        probText.innerHTML = newText;
                        card.classList.remove("border-gray-300", "bg-gray-100");
                        card.classList.add("border-brand-green", "bg-green-50");

                        // Mostra Resultado
                        resText.innerText = `${p.a + newB > 0 ? "+" : ""}${p.a + newB}`;
                        ruleText.innerText = `Subtrair ${p.b} √© igual a somar ${newB}`;

                        resArea.classList.remove("opacity-0");

                        btnTrans.disabled = true;
                        btnTrans.classList.add("opacity-50", "cursor-not-allowed");
                        btnTrans.innerText = "Transformado!";
                    };

                    container.querySelector("#btn-prev").onclick = () => {
                        currentIdx = (currentIdx - 1 + problems.length) % problems.length;
                        loadProblem();
                    };
                    container.querySelector("#btn-next").onclick = () => {
                        currentIdx = (currentIdx + 1) % problems.length;
                        loadProblem();
                    };

                    loadProblem();
                },

                interactive_sign_smasher(container) {
                    const levels = [
                        { q: "+(-5)", ans: "-", val: 5 },
                        { q: "-(-3)", ans: "+", val: 3 },
                        { q: "-(+8)", ans: "-", val: 8 },
                        { q: "+(+2)", ans: "+", val: 2 },
                    ];
                    let currentLvl = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden h-[300px]">
        
        <div class="flex justify-between w-full items-center mb-6">
            <h3 class="text-gray-500 font-bold uppercase text-xs tracking-widest">Esmagador de Sinais üî®</h3>
            <div class="bg-gray-100 px-3 py-1 rounded-full text-xs font-black text-gray-600">Pts: <span id="smash-score">0</span></div>
        </div>

        <div class="relative w-full flex-1 flex items-center justify-center">
            
            <div class="flex items-center text-5xl font-mono font-bold text-gray-700 gap-1" id="expression-area">
                </div>

            <div id="hammer" class="absolute top-[-100px] right-10 text-6xl transition-transform duration-100 origin-bottom-right" style="transform: rotate(45deg);">
                üî®
            </div>

        </div>

        <div class="grid grid-cols-2 gap-4 w-full max-w-xs z-10" id="smash-controls">
            <button class="smash-btn bg-brand-green text-white font-black text-3xl py-4 rounded-xl shadow-btn active:scale-95 transition-all" data-sign="+">+</button>
            <button class="smash-btn bg-brand-red text-white font-black text-3xl py-4 rounded-xl shadow-btn active:scale-95 transition-all" data-sign="-">-</button>
        </div>

        <div id="smash-feedback" class="absolute inset-0 bg-white/90 flex flex-col items-center justify-center z-20 hidden">
            <div class="text-6xl mb-2" id="fb-icon"></div>
            <h3 class="text-2xl font-black text-gray-800" id="fb-text"></h3>
        </div>

    </div>
    `;

                    const area = container.querySelector("#expression-area");
                    const hammer = container.querySelector("#hammer");
                    const scoreEl = container.querySelector("#smash-score");
                    const feedback = container.querySelector("#smash-feedback");
                    const fbIcon = container.querySelector("#fb-icon");
                    const fbText = container.querySelector("#fb-text");
                    const btns = container.querySelectorAll(".smash-btn");

                    const loadLevel = () => {
                        if (currentLvl >= levels.length) currentLvl = 0; // Loop
                        const q = levels[currentLvl];

                        // Parse: +(-5) -> split chars
                        area.innerHTML = "";
                        // Cria elementos para animar
                        const part1 = document.createElement("span"); // +
                        part1.innerText = q.q[0];
                        const part2 = document.createElement("span"); // (
                        part2.innerText = q.q[1];
                        const part3 = document.createElement("span"); // -
                        part3.innerText = q.q[2];
                        part3.className = "text-brand-purple"; // Destaque
                        const part4 = document.createElement("span"); // 5
                        part4.innerText = q.q.slice(3, -1);
                        const part5 = document.createElement("span"); // )
                        part5.innerText = q.q.slice(-1);

                        area.append(part1, part2, part3, part4, part5);
                    };

                    const smash = (userSign) => {
                        const correct = levels[currentLvl].ans;

                        // Anima√ß√£o Martelo
                        hammer.style.transition = "transform 0.1s";
                        hammer.style.transform = "rotate(-45deg) translate(-20px, 50px)";

                        setTimeout(() => {
                            hammer.style.transition = "transform 0.3s ease-out";
                            hammer.style.transform = "rotate(45deg)";

                            // Verifica
                            if (userSign === correct) {
                                // Sucesso: Explos√£o e substitui√ß√£o
                                score += 10;
                                scoreEl.innerText = score;

                                area.innerHTML = `<span class="text-6xl font-black ${correct === "+" ? "text-brand-green" : "text-brand-red"
                                    } animate-pop-in">${correct}${levels[currentLvl].val}</span>`;

                                setTimeout(() => {
                                    currentLvl++;
                                    loadLevel();
                                }, 1000);
                            } else {
                                // Erro
                                score = Math.max(0, score - 5);
                                scoreEl.innerText = score;
                                area.classList.add("animate-shake");
                                setTimeout(() => area.classList.remove("animate-shake"), 500);
                            }
                        }, 100);
                    };

                    btns.forEach((b) => (b.onclick = () => smash(b.dataset.sign)));
                    loadLevel();
                },

                interactive_mult_speed_run(container) {
                    const questions = [
                        { q: "(-2) √ó (-3)", ans: 6, sign: "+" },
                        { q: "(+4) √ó (-2)", ans: -8, sign: "-" },
                        { q: "(-5) √ó (+2)", ans: -10, sign: "-" },
                        { q: "(-10) √∑ (-2)", ans: 5, sign: "+" },
                    ];
                    let qIdx = 0;

                    container.innerHTML = `
    <div class="bg-gray-800 border-4 border-gray-600 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="w-full bg-black border-4 border-gray-500 rounded-lg p-4 mb-6 font-mono text-green-400 text-center text-3xl tracking-widest shadow-inner">
            <span id="calc-display" class="animate-pulse">READY?</span>
        </div>

        <div class="grid grid-cols-2 gap-4 w-full mb-4" id="sign-pad">
            <button class="sign-btn bg-gray-700 hover:bg-gray-600 border-b-4 border-gray-900 text-white font-black text-4xl h-20 rounded-xl active:scale-95 active:border-b-0 active:translate-y-1 transition-all" data-s="+">+</button>
            <button class="sign-btn bg-gray-700 hover:bg-gray-600 border-b-4 border-gray-900 text-white font-black text-4xl h-20 rounded-xl active:scale-95 active:border-b-0 active:translate-y-1 transition-all" data-s="-">-</button>
        </div>

        <p class="text-gray-400 text-xs font-bold uppercase text-center">Qual o sinal do resultado?</p>

        <div id="result-overlay" class="absolute inset-0 bg-gray-900 flex items-center justify-center hidden z-20">
            <span class="text-6xl font-black text-white" id="overlay-text"></span>
        </div>
    </div>
    `;

                    const display = container.querySelector("#calc-display");
                    const overlay = container.querySelector("#result-overlay");
                    const overlayText = container.querySelector("#overlay-text");
                    const btns = container.querySelectorAll(".sign-btn");

                    const nextQ = () => {
                        if (qIdx >= questions.length) qIdx = 0;
                        display.innerText = questions[qIdx].q;
                        display.className = "text-white";
                    };

                    const check = (sign) => {
                        const correct = questions[qIdx].sign;
                        const val = questions[qIdx].ans;

                        overlay.classList.remove("hidden");

                        if (sign === correct) {
                            overlay.classList.add("bg-green-600");
                            overlay.classList.remove("bg-red-600");
                            overlayText.innerText = (val > 0 ? "+" : "") + val;

                            setTimeout(() => {
                                qIdx++;
                                overlay.classList.add("hidden");
                                nextQ();
                            }, 800);
                        } else {
                            overlay.classList.add("bg-red-600");
                            overlay.classList.remove("bg-green-600");
                            overlayText.innerText = "ERRO";

                            setTimeout(() => {
                                overlay.classList.add("hidden");
                            }, 500);
                        }
                    };

                    btns.forEach((b) => (b.onclick = () => check(b.dataset.s)));

                    setTimeout(nextQ, 1000);
                },

                interactive_power_switch(container) {
                    let base = -2;
                    let exp = 2;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Interruptor de Expoente</h3>

        <div class="flex items-center justify-center gap-1 mb-8 text-5xl font-mono font-black text-gray-700">
            <span>(</span><span class="text-brand-red">-2</span><span>)</span>
            <sup class="text-brand-blue transition-all" id="exp-val">2</sup>
        </div>

        <div class="relative w-full max-w-xs h-32 bg-gray-100 rounded-xl border-2 border-gray-300 flex items-center justify-center mb-6 overflow-hidden">
            <div id="bulb" class="text-6xl filter grayscale transition-all duration-300">üí°</div>
            <div class="absolute bottom-2 text-xs font-bold text-gray-400 uppercase" id="bulb-status">Desligado</div>
        </div>

        <div class="flex gap-2 w-full justify-center">
            <button class="exp-btn w-12 h-12 rounded-full bg-white border-2 border-gray-300 font-bold hover:border-brand-blue hover:text-brand-blue transition-all" data-e="1">1</button>
            <button class="exp-btn w-12 h-12 rounded-full bg-white border-2 border-brand-blue text-brand-blue font-bold shadow-md ring-2 ring-blue-100 transition-all" data-e="2">2</button>
            <button class="exp-btn w-12 h-12 rounded-full bg-white border-2 border-gray-300 font-bold hover:border-brand-blue hover:text-brand-blue transition-all" data-e="3">3</button>
            <button class="exp-btn w-12 h-12 rounded-full bg-white border-2 border-gray-300 font-bold hover:border-brand-blue hover:text-brand-blue transition-all" data-e="4">4</button>
        </div>

        <div id="calc-detail" class="mt-6 text-sm font-mono bg-gray-50 p-2 rounded w-full text-center">
            (-2) x (-2) = +4
        </div>
    </div>
    `;

                    const expVal = container.querySelector("#exp-val");
                    const bulb = container.querySelector("#bulb");
                    const status = container.querySelector("#bulb-status");
                    const detail = container.querySelector("#calc-detail");
                    const btns = container.querySelectorAll(".exp-btn");

                    const update = (e) => {
                        exp = e;
                        expVal.innerText = e;

                        // Atualiza bot√µes
                        btns.forEach((b) => {
                            if (parseInt(b.dataset.e) === e) {
                                b.className =
                                    "exp-btn w-12 h-12 rounded-full bg-white border-2 border-brand-blue text-brand-blue font-bold shadow-md ring-2 ring-blue-100 transition-all transform scale-110";
                            } else {
                                b.className =
                                    "exp-btn w-12 h-12 rounded-full bg-white border-2 border-gray-300 font-bold hover:border-brand-blue hover:text-brand-blue transition-all";
                            }
                        });

                        // L√≥gica
                        const res = Math.pow(-2, e);
                        const isPositive = res > 0;

                        // Visual
                        if (isPositive) {
                            bulb.style.filter = "none";
                            bulb.className =
                                "text-6xl text-yellow-400 drop-shadow-[0_0_15px_rgba(250,204,21,0.8)] transition-all duration-300 animate-pulse";
                            status.innerText = "Positivo (Luz Acesa)";
                            status.className =
                                "absolute bottom-2 text-xs font-bold text-yellow-600 uppercase";
                        } else {
                            bulb.style.filter = "grayscale(100%) opacity(0.3)";
                            bulb.className = "text-6xl transition-all duration-300";
                            status.innerText = "Negativo (Apagado)";
                            status.className =
                                "absolute bottom-2 text-xs font-bold text-gray-400 uppercase";
                        }

                        // Texto detalhado
                        const parts = Array(e).fill("(-2)").join(" √ó ");
                        detail.innerHTML = `${parts} = <strong class="${isPositive ? "text-brand-green" : "text-brand-red"
                            }">${res}</strong>`;
                    };

                    btns.forEach(
                        (b) => (b.onclick = () => update(parseInt(b.dataset.e)))
                    );
                    update(2);
                },

                interactive_expression_sort(container) {
                    const steps = [
                        {
                            id: 1,
                            html: '<span class="text-brand-purple">(-2)¬≥</span>',
                            val: -8,
                        },
                        {
                            id: 2,
                            html: '<span class="text-brand-blue">√ó 3</span>',
                            val: -24,
                        },
                        {
                            id: 3,
                            html: '<span class="text-brand-red">- 4</span>',
                            val: -28,
                        },
                    ];
                    // Express√£o: (-2)¬≥ * 3 - 4
                    // Ordem correta: Pot√™ncia -> Mult -> Sub

                    let currentStep = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        <h3 class="text-gray-500 font-bold uppercase text-xs tracking-widest mb-4">Quebra-Cabe√ßa de Ordem</h3>
        
        <div class="text-2xl md:text-3xl font-mono font-black text-brand-text mb-8 bg-gray-100 px-4 py-2 rounded-lg">
            (-2)¬≥ √ó 3 - 4
        </div>

        <div class="flex flex-col gap-3 w-full max-w-xs" id="drop-zone">
            <button class="step-btn bg-white border-2 border-gray-300 text-gray-400 font-bold py-3 rounded-xl hover:bg-gray-50 transition-all flex justify-between px-4 items-center group" data-id="1">
                <span>1. Resolver Pot√™ncia</span>
                <i class="fas fa-play opacity-0 group-hover:opacity-100 text-brand-blue"></i>
            </button>
            <button class="step-btn bg-white border-2 border-gray-300 text-gray-400 font-bold py-3 rounded-xl hover:bg-gray-50 transition-all flex justify-between px-4 items-center group" data-id="2">
                <span>2. Multiplicar</span>
                <i class="fas fa-play opacity-0 group-hover:opacity-100 text-brand-blue"></i>
            </button>
            <button class="step-btn bg-white border-2 border-gray-300 text-gray-400 font-bold py-3 rounded-xl hover:bg-gray-50 transition-all flex justify-between px-4 items-center group" data-id="3">
                <span>3. Subtrair</span>
                <i class="fas fa-play opacity-0 group-hover:opacity-100 text-brand-blue"></i>
            </button>
        </div>

        <div id="live-calc" class="mt-6 text-center font-mono text-xl font-bold text-gray-600 min-h-[30px]">
            ?
        </div>
        
        <div id="win-msg" class="absolute inset-0 bg-green-500 flex flex-col items-center justify-center text-white hidden z-20">
            <div class="text-6xl mb-2">üéâ</div>
            <h3 class="text-2xl font-black">Resolvido!</h3>
            <p class="font-mono text-xl mt-2">-28</p>
            <button onclick="app.renderLesson(document.getElementById('main-container'), app.currentLessonName)" class="mt-6 bg-white text-green-600 font-bold py-2 px-6 rounded-lg shadow-lg">Reiniciar</button>
        </div>

    </div>
    `;

                    const btns = container.querySelectorAll(".step-btn");
                    const display = container.querySelector("#live-calc");
                    const winMsg = container.querySelector("#win-msg");

                    // Embaralha bot√µes visualmente (simulado via flex order ou s√≥ deixando fixo pois o usu√°rio escolhe a ordem de clique)
                    // Vamos deixar fixo e o usu√°rio clica na ordem correta l√≥gica.

                    const updateDisplay = (val) => {
                        display.innerHTML = `<span class="animate-pop-in text-brand-blue">${val}</span>`;
                    };

                    const handleClick = (btn) => {
                        const id = parseInt(btn.dataset.id);

                        // Verifica se √© o pr√≥ximo passo correto (1, then 2, then 3)
                        if (id === currentStep + 1) {
                            currentStep++;
                            btn.className =
                                "bg-green-100 border-2 border-green-400 text-green-700 font-bold py-3 rounded-xl cursor-default flex justify-between px-4 items-center";
                            btn.innerHTML = `<span>Passo ${id} OK</span> <i class="fas fa-check"></i>`;
                            btn.disabled = true;

                            // Mostra resultado parcial
                            if (id === 1) updateDisplay("-8 √ó 3 - 4");
                            if (id === 2) updateDisplay("-24 - 4");
                            if (id === 3) {
                                updateDisplay("-28");
                                setTimeout(() => winMsg.classList.remove("hidden"), 800);
                            }
                        } else {
                            // Erro
                            btn.classList.add(
                                "bg-red-100",
                                "border-red-400",
                                "text-red-700",
                                "animate-shake"
                            );
                            setTimeout(() => {
                                btn.className =
                                    "step-btn bg-white border-2 border-gray-300 text-gray-400 font-bold py-3 rounded-xl hover:bg-gray-50 transition-all flex justify-between px-4 items-center group";
                            }, 500);
                        }
                    };

                    btns.forEach((b) => (b.onclick = () => handleClick(b)));
                },

                interactive_properties_memory(container) {
                    const cards = [
                        { id: 1, type: "text", val: "(-5) + 0 = -5" },
                        { id: 1, type: "prop", val: "Elem. Neutro" },
                        { id: 2, type: "text", val: "2 + 3 = 3 + 2" },
                        { id: 2, type: "prop", val: "Comutativa" },
                        { id: 3, type: "text", val: "(+4) + (-4) = 0" },
                        { id: 3, type: "prop", val: "Oposto" },
                    ];

                    let flipped = [];
                    let matched = [];

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Mem√≥ria das Propriedades</h3>
        <div class="grid grid-cols-2 gap-3 w-full max-w-sm" id="mem-grid"></div>
        <div id="mem-feedback" class="h-8 mt-4 text-sm font-bold text-center text-brand-green"></div>
    </div>
    `;

                    const grid = container.querySelector("#mem-grid");
                    const feedback = container.querySelector("#mem-feedback");

                    // Embaralha
                    cards.sort(() => Math.random() - 0.5);

                    cards.forEach((c, i) => {
                        const card = document.createElement("div");
                        card.className =
                            "bg-gray-100 h-20 rounded-xl border-2 border-gray-200 cursor-pointer flex items-center justify-center text-center p-2 hover:bg-gray-200 transition-all active:scale-95";
                        card.innerHTML = `<span class="opacity-0 font-bold text-sm text-gray-700 transition-opacity duration-300 select-none">${c.val}</span>`;

                        card.onclick = () => {
                            if (
                                flipped.length < 2 &&
                                !flipped.includes(i) &&
                                !matched.includes(c.id)
                            ) {
                                // Flip
                                card.classList.add("bg-white", "border-brand-blue");
                                card.classList.remove("bg-gray-100", "border-gray-200");
                                card.querySelector("span").classList.remove("opacity-0");
                                flipped.push({ idx: i, id: c.id, el: card });

                                if (flipped.length === 2) {
                                    // Check Match
                                    if (flipped[0].id === flipped[1].id) {
                                        // Match
                                        matched.push(c.id);
                                        flipped.forEach((f) => {
                                            f.el.classList.add("bg-green-100", "border-green-400");
                                            f.el.classList.remove("border-brand-blue");
                                        });
                                        flipped = [];
                                        if (matched.length === 3)
                                            feedback.innerText =
                                                "Parab√©ns! Voc√™ domina as propriedades.";
                                    } else {
                                        // Fail
                                        setTimeout(() => {
                                            flipped.forEach((f) => {
                                                f.el.classList.add("bg-gray-100", "border-gray-200");
                                                f.el.classList.remove(
                                                    "bg-white",
                                                    "border-brand-blue"
                                                );
                                                f.el.querySelector("span").classList.add("opacity-0");
                                            });
                                            flipped = [];
                                        }, 1000);
                                    }
                                }
                            }
                        };
                        grid.appendChild(card);
                    });
                },

                interactive_integer_division_lab(container) {
                    let n1 = -12;
                    let n2 = 4;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none transition-colors duration-500" id="lab-bg">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Simulador de Sinais</h3>

        <div class="flex items-center gap-2 md:gap-4 mb-8 text-2xl md:text-4xl font-mono font-bold">
            <input type="number" id="in-n1" value="${n1}" class="w-20 text-center border-b-2 border-brand-gray bg-transparent outline-none focus:border-brand-blue transition-colors text-brand-text">
            <span class="text-gray-400">√∑</span>
            <input type="number" id="in-n2" value="${n2}" class="w-20 text-center border-b-2 border-brand-gray bg-transparent outline-none focus:border-brand-blue transition-colors text-brand-text">
            <span class="text-gray-400">=</span>
            <span id="lab-res" class="text-brand-green opacity-50">?</span>
        </div>

        <div class="flex gap-8 w-full justify-center mb-6">
            <div class="flex flex-col items-center">
                <span class="text-[10px] font-bold uppercase text-gray-400">Sinal 1</span>
                <div id="sign-1" class="text-4xl transition-all transform scale-0"></div>
            </div>
            <div class="flex flex-col items-center">
                <span class="text-[10px] font-bold uppercase text-gray-400">Sinal 2</span>
                <div id="sign-2" class="text-4xl transition-all transform scale-0"></div>
            </div>
        </div>

        <div id="lab-feedback" class="bg-gray-100 px-6 py-3 rounded-xl text-sm font-bold text-gray-500 w-full text-center border-2 border-gray-200">
            Ajuste os n√∫meros...
        </div>
    </div>
    `;

                    const in1 = container.querySelector("#in-n1");
                    const in2 = container.querySelector("#in-n2");
                    const resEl = container.querySelector("#lab-res");
                    const s1El = container.querySelector("#sign-1");
                    const s2El = container.querySelector("#sign-2");
                    const feed = container.querySelector("#lab-feedback");
                    const bg = container.querySelector("#lab-bg");

                    const update = () => {
                        const v1 = parseInt(in1.value);
                        const v2 = parseInt(in2.value);

                        // Reset visual
                        s1El.className = "text-4xl transition-all transform scale-100";
                        s2El.className = "text-4xl transition-all transform scale-100";

                        // √çcones de humor baseados no sinal
                        s1El.innerText = v1 >= 0 ? "üôÇ" : "üò†"; // Positivo feliz, Negativo bravo
                        s2El.innerText = v2 >= 0 ? "üôÇ" : "üò†";

                        if (isNaN(v1) || isNaN(v2)) return;

                        if (v2 === 0) {
                            resEl.innerText = "üí•";
                            feed.innerHTML = `<span class="text-brand-red uppercase">Erro Cr√≠tico!</span> N√£o existe divis√£o por zero.`;
                            feed.className =
                                "bg-red-50 px-6 py-3 rounded-xl text-sm font-bold text-red-600 w-full text-center border-2 border-red-200 animate-pulse";
                            bg.classList.add("border-red-300");
                            return;
                        }

                        const res = v1 / v2;
                        const isInt = Number.isInteger(res);
                        const finalVal = isInt ? res : res.toFixed(2);

                        // L√≥gica de Sinais
                        const sameSign = (v1 >= 0 && v2 > 0) || (v1 < 0 && v2 < 0);

                        resEl.innerText = finalVal;

                        if (sameSign) {
                            resEl.className = "text-brand-green font-black";
                            feed.innerHTML =
                                "Sinais <span class='text-brand-blue'>IGUAIS</span> d√£o resultado <span class='text-brand-green'>POSITIVO</span>.";
                            feed.className =
                                "bg-green-50 px-6 py-3 rounded-xl text-sm font-bold text-green-700 w-full text-center border-2 border-green-200";
                            bg.classList.remove("border-red-300", "border-brand-gray");
                            bg.classList.add("border-green-300");
                        } else {
                            resEl.className = "text-brand-red font-black";
                            feed.innerHTML =
                                "Sinais <span class='text-brand-orange'>DIFERENTES</span> d√£o resultado <span class='text-brand-red'>NEGATIVO</span>.";
                            feed.className =
                                "bg-red-50 px-6 py-3 rounded-xl text-sm font-bold text-red-700 w-full text-center border-2 border-red-200";
                            bg.classList.remove("border-green-300", "border-brand-gray");
                            bg.classList.add("border-red-300");
                        }
                    };

                    in1.addEventListener("input", update);
                    in2.addEventListener("input", update);
                    update();
                },

                interactive_sign_sorter(container) {
                    let score = 0;
                    let isPlaying = false;
                    let spawnInterval;
                    let gameLoop;
                    let boxes = [];

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[400px]">
        
        <div class="flex justify-between w-full items-center mb-2 z-20">
            <div class="bg-gray-800 text-gray-400 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider">Separador</div>
            <div class="text-white font-black text-xl">Pts: <span id="sort-pts" class="text-brand-yellow">0</span></div>
        </div>

        <div class="absolute bottom-0 left-0 w-1/2 h-24 bg-green-900/50 border-t-4 border-green-500 flex items-center justify-center z-10">
            <span class="text-green-400 font-black text-2xl opacity-50">+</span>
        </div>
        <div class="absolute bottom-0 right-0 w-1/2 h-24 bg-red-900/50 border-t-4 border-red-500 flex items-center justify-center z-10">
            <span class="text-red-400 font-black text-2xl opacity-50">-</span>
        </div>

        <div id="game-canvas" class="absolute inset-0 z-20 overflow-hidden"></div>

        <div class="absolute bottom-4 left-4 z-30 w-[calc(50%-24px)]">
            <button id="btn-left" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-xl shadow-lg border-b-4 border-green-800 active:translate-y-1 active:border-b-0 transition-all">POSITIVO</button>
        </div>
        <div class="absolute bottom-4 right-4 z-30 w-[calc(50%-24px)]">
            <button id="btn-right" class="w-full bg-red-600 hover:bg-red-500 text-white font-bold py-4 rounded-xl shadow-lg border-b-4 border-red-800 active:translate-y-1 active:border-b-0 transition-all">NEGATIVO</button>
        </div>

        <div id="start-overlay" class="absolute inset-0 bg-gray-900/95 z-40 flex flex-col items-center justify-center text-center p-6">
            <div class="text-6xl mb-4">üì¶</div>
            <h3 class="text-2xl font-black text-white mb-2">Carga T√≥xica</h3>
            <p class="text-gray-400 text-sm mb-6">Classifique o resultado da divis√£o antes que a caixa toque o ch√£o!</p>
            <button id="btn-play" class="bg-brand-blue text-white font-bold py-3 px-10 rounded-full shadow-[0_0_15px_rgba(28,176,246,0.6)] animate-pulse">JOGAR</button>
        </div>
    </div>
    `;

                    const canvas = container.querySelector("#game-canvas");
                    const scoreEl = container.querySelector("#sort-pts");
                    const overlay = container.querySelector("#start-overlay");
                    const btnPlay = container.querySelector("#btn-play");
                    const btnPos = container.querySelector("#btn-left");
                    const btnNeg = container.querySelector("#btn-right");

                    let currentBox = null;

                    const spawnBox = () => {
                        if (!isPlaying) return;
                        if (currentBox) return; // S√≥ uma por vez para facilitar no mobile

                        // Gera problema (-10 / 2, -15 / -3, etc)
                        const n1 =
                            (Math.floor(Math.random() * 20) + 1) *
                            (Math.random() > 0.5 ? 1 : -1);
                        const n2 =
                            (Math.floor(Math.random() * 10) + 1) *
                            (Math.random() > 0.5 ? 1 : -1);
                        const res = n1 / n2;
                        const isPos = res > 0;

                        const el = document.createElement("div");
                        el.className =
                            "absolute left-1/2 -translate-x-1/2 w-32 h-16 bg-white border-4 border-gray-300 rounded-lg flex items-center justify-center font-bold text-gray-800 text-lg shadow-xl animate-bounce-small";
                        el.style.top = "-70px";
                        el.innerHTML = `${n1} √∑ ${n2 < 0 ? `(${n2})` : n2}`;

                        canvas.appendChild(el);

                        currentBox = { el, isPos, y: -70, speed: 2 + score * 0.1 };
                    };

                    const updateGame = () => {
                        if (!isPlaying) return;

                        if (currentBox) {
                            currentBox.y += currentBox.speed;
                            currentBox.el.style.top = `${currentBox.y}px`;

                            // Colis√£o com o ch√£o (Game Over)
                            if (currentBox.y > 280) {
                                // Altura aproximada antes dos bot√µes
                                gameOver();
                            }
                        } else {
                            spawnBox();
                        }

                        gameLoop = requestAnimationFrame(updateGame);
                    };

                    const check = (choiceIsPos) => {
                        if (!currentBox) return;

                        if (choiceIsPos === currentBox.isPos) {
                            // Acerto
                            score += 10;
                            scoreEl.innerText = score;

                            // Efeito visual
                            currentBox.el.classList.add("scale-0", "transition-transform");
                            setTimeout(() => {
                                currentBox.el.remove();
                                currentBox = null;
                            }, 200);
                        } else {
                            // Erro
                            gameOver();
                        }
                    };

                    const gameOver = () => {
                        isPlaying = false;
                        cancelAnimationFrame(gameLoop);

                        overlay.classList.remove("hidden");
                        overlay.querySelector("h3").innerText = "Explodiu!";
                        overlay.querySelector(
                            "p"
                        ).innerText = `Pontua√ß√£o Final: ${score}`;
                        btnPlay.innerText = "Tentar de Novo";

                        if (currentBox) {
                            currentBox.el.remove();
                            currentBox = null;
                        }
                    };

                    const start = () => {
                        score = 0;
                        scoreEl.innerText = 0;
                        isPlaying = true;
                        overlay.classList.add("hidden");
                        gameLoop = requestAnimationFrame(updateGame);
                    };

                    btnPlay.onclick = start;
                    btnPos.onclick = () => check(true);
                    btnNeg.onclick = () => check(false);
                },

                interactive_root_explorer(container) {
                    let num = 16;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Scanner de Ra√≠zes</h3>

        <div class="flex items-center gap-4 mb-8">
            <button class="w-10 h-10 rounded-full bg-gray-100 text-gray-600 font-bold hover:bg-gray-200" id="btn-dec-root">-</button>
            <div class="bg-gray-100 px-6 py-2 rounded-xl text-3xl font-mono font-black text-brand-text flex items-center gap-2">
                <span class="text-gray-400 text-2xl">‚àö</span>
                <span id="root-input">${num}</span>
            </div>
            <button class="w-10 h-10 rounded-full bg-gray-100 text-gray-600 font-bold hover:bg-gray-200" id="btn-inc-root">+</button>
        </div>

        <div class="relative w-48 h-48 bg-gray-50 border-2 border-gray-200 rounded-xl flex items-center justify-center mb-6 overflow-hidden transition-colors duration-500" id="screen-bg">
            <div id="grid-visual" class="grid gap-1 transition-all duration-500"></div>
            
            <div id="error-visual" class="absolute inset-0 bg-red-100 hidden flex-col items-center justify-center text-brand-red animate-pulse z-10">
                <div class="text-6xl mb-2">‚ö†Ô∏è</div>
                <div class="text-xs font-black uppercase">Erro de Sistema</div>
                <div class="text-[10px] font-bold">Imposs√≠vel em Z</div>
            </div>
        </div>

        <div class="text-center h-12">
            <p class="text-xs font-bold text-gray-400 uppercase mb-1">Resultado</p>
            <div id="res-display" class="text-3xl font-black text-brand-purple">4</div>
        </div>

    </div>
    `;

                    const inputDisp = container.querySelector("#root-input");
                    const grid = container.querySelector("#grid-visual");
                    const errorScreen = container.querySelector("#error-visual");
                    const resDisp = container.querySelector("#res-display");
                    const bg = container.querySelector("#screen-bg");

                    const update = () => {
                        inputDisp.innerText = num;

                        if (num < 0) {
                            // Caso Negativo (Erro)
                            errorScreen.classList.remove("hidden");
                            grid.innerHTML = "";
                            resDisp.innerText = "‚ùå";
                            resDisp.className = "text-3xl font-black text-brand-red";
                            bg.className =
                                "relative w-48 h-48 bg-red-50 border-2 border-red-300 rounded-xl flex items-center justify-center mb-6 overflow-hidden";
                        } else {
                            // Caso Positivo
                            errorScreen.classList.add("hidden");
                            const root = Math.sqrt(num);
                            const isExact = Number.isInteger(root);

                            if (isExact) {
                                resDisp.innerText = root;
                                resDisp.className = "text-3xl font-black text-brand-green";
                                bg.className =
                                    "relative w-48 h-48 bg-green-50 border-2 border-green-300 rounded-xl flex items-center justify-center mb-6 overflow-hidden";

                                // Desenha Quadrado
                                grid.style.gridTemplateColumns = `repeat(${root}, 1fr)`;
                                grid.innerHTML = "";
                                // Limita tamanho visual dos quadradinhos
                                const size = Math.min(160 / root, 30);

                                for (let i = 0; i < num; i++) {
                                    const cell = document.createElement("div");
                                    cell.style.width = `${size}px`;
                                    cell.style.height = `${size}px`;
                                    cell.className =
                                        "bg-green-400 rounded-sm shadow-sm animate-pop-in";
                                    cell.style.animationDelay = `${i * 0.02}s`;
                                    grid.appendChild(cell);
                                }
                            } else {
                                // N√£o exata
                                resDisp.innerText = `~${root.toFixed(2)}`;
                                resDisp.className = "text-3xl font-black text-gray-400";
                                bg.className =
                                    "relative w-48 h-48 bg-gray-50 border-2 border-gray-200 rounded-xl flex items-center justify-center mb-6 overflow-hidden";
                                grid.innerHTML = `<span class="text-xs text-gray-400 font-bold text-center px-4">N√£o forma um quadrado perfeito de inteiros.</span>`;
                            }
                        }
                    };

                    container.querySelector("#btn-dec-root").onclick = () => {
                        num -= 1; // Permite ir para negativos
                        update();
                    };
                    container.querySelector("#btn-inc-root").onclick = () => {
                        num += 1;
                        update();
                    };

                    update();
                },

                interactive_root_imposter(container) {
                    // Banco de quest√µes
                    // valid: true se existe em Z, false se n√£o existe (negativo)
                    const problems = [
                        { q: "‚àö4", val: true },
                        { q: "‚àö-9", val: false },
                        { q: "‚àö16", val: true },
                        { q: "‚àö-25", val: false },
                        { q: "‚àö-1", val: false },
                        { q: "‚àö0", val: true },
                        { q: "‚àö100", val: true },
                        { q: "‚àö-81", val: false },
                    ];

                    let current = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-6 border-b-2 border-gray-100 pb-2">
            <h3 class="text-brand-blue font-black uppercase text-xs tracking-widest"><i class="fas fa-shield-alt"></i> Seguran√ßa Matem√°tica</h3>
            <div class="bg-gray-100 px-3 py-1 rounded-full text-xs font-black text-gray-600">Score: <span id="imp-score">0</span></div>
        </div>

        <div class="text-center mb-8">
            <p class="text-xs text-gray-400 uppercase font-bold mb-2">Analise o n√∫mero:</p>
            <div class="w-full max-w-xs bg-gray-800 text-white font-mono text-4xl p-6 rounded-xl shadow-lg border-b-4 border-gray-900 relative" id="card-display">
                <span id="prob-text">...</span>
                <div class="absolute top-2 right-2 w-3 h-3 rounded-full bg-red-500 animate-pulse"></div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 w-full max-w-xs mb-4">
            <button id="btn-allow" class="bg-green-100 border-b-4 border-green-300 text-green-700 font-black py-4 rounded-xl active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center">
                <i class="fas fa-check-circle text-2xl mb-1"></i>
                <span class="text-[10px] uppercase">Existe</span>
            </button>
            <button id="btn-deny" class="bg-red-100 border-b-4 border-red-300 text-red-700 font-black py-4 rounded-xl active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center">
                <i class="fas fa-ban text-2xl mb-1"></i>
                <span class="text-[10px] uppercase">Imposs√≠vel</span>
            </button>
        </div>

        <div id="imp-feedback" class="h-8 font-bold text-sm text-center"></div>

        <div id="end-imp" class="absolute inset-0 bg-white flex-col items-center justify-center hidden z-20">
            <div class="text-6xl mb-4">üõ°Ô∏è</div>
            <h3 class="text-2xl font-black text-brand-blue">Turno Encerrado!</h3>
            <p class="text-gray-500 mt-2 font-bold">Pontua√ß√£o Final: <span id="final-imp-score">0</span></p>
            <button id="btn-restart-imp" class="mt-6 bg-brand-blue text-white font-bold py-2 px-6 rounded-lg shadow-btn">Jogar Novamente</button>
        </div>

    </div>
    `;

                    const probText = container.querySelector("#prob-text");
                    const feedback = container.querySelector("#imp-feedback");
                    const scoreEl = container.querySelector("#imp-score");
                    const endScreen = container.querySelector("#end-imp");
                    const card = container.querySelector("#card-display");

                    // Embaralha
                    let queue = [];

                    const start = () => {
                        queue = [...problems].sort(() => Math.random() - 0.5);
                        current = 0;
                        score = 0;
                        scoreEl.innerText = 0;
                        endScreen.classList.add("hidden");
                        endScreen.classList.remove("flex");
                        loadNext();
                    };

                    const loadNext = () => {
                        if (current >= queue.length) {
                            container.querySelector("#final-imp-score").innerText = score;
                            endScreen.classList.remove("hidden");
                            endScreen.classList.add("flex");
                            return;
                        }

                        const p = queue[current];
                        probText.innerText = p.q;

                        // Reset Visual
                        card.classList.remove(
                            "animate-shake",
                            "border-green-500",
                            "border-red-500"
                        );
                        card.classList.add("border-gray-900");
                        feedback.innerText = "";
                    };

                    const handleChoice = (userSaysExists) => {
                        const p = queue[current];
                        const isCorrect = userSaysExists === p.val;

                        if (isCorrect) {
                            score += 100;
                            scoreEl.innerText = score;
                            feedback.innerHTML = `<span class="text-green-500">Correto! Acesso ${p.val ? "Permitido" : "Negado"
                                }.</span>`;
                            card.classList.add("border-green-500");
                            card.classList.remove("border-gray-900");
                        } else {
                            score = Math.max(0, score - 50);
                            scoreEl.innerText = score;
                            feedback.innerHTML = `<span class="text-red-500">Erro! ${p.val ? "Essa raiz existe." : "Raiz negativa n√£o existe em Z!"
                                }</span>`;
                            card.classList.add("animate-shake", "border-red-500");
                            card.classList.remove("border-gray-900");
                        }

                        setTimeout(() => {
                            current++;
                            loadNext();
                        }, 800);
                    };

                    container.querySelector("#btn-allow").onclick = () =>
                        handleChoice(true);
                    container.querySelector("#btn-deny").onclick = () =>
                        handleChoice(false);
                    container.querySelector("#btn-restart-imp").onclick = start;

                    start();
                },

                interactive_rational_zoom(container) {
                    // Estado inicial: 0 e 1
                    let left = { n: 0, d: 1, val: 0 };
                    let right = { n: 1, d: 1, val: 1 };
                    let depth = 0;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">
        
        <div class="flex justify-between w-full items-center mb-6 z-10">
            <h3 class="font-black uppercase text-xs tracking-widest text-gray-400">Microsc√≥pio Racional</h3>
            <div class="bg-gray-800 px-3 py-1 rounded-full text-xs font-bold text-brand-blue">Zoom: <span id="zoom-depth">1x</span></div>
        </div>

        <div class="relative w-full h-32 flex items-center justify-center mb-4">
            <div class="absolute w-full h-1 bg-gray-500 rounded-full"></div>
            
            <div class="absolute left-0 h-4 w-0.5 bg-white top-1/2 -translate-y-1/2"></div>
            <div class="absolute right-0 h-4 w-0.5 bg-white top-1/2 -translate-y-1/2"></div>
            
            <div class="absolute left-0 top-2/3 text-xl font-bold text-brand-blue" id="label-left">0</div>
            <div class="absolute right-0 top-2/3 text-xl font-bold text-brand-blue" id="label-right">1</div>

            <div id="mid-point" class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-brand-yellow rounded-full shadow-[0_0_15px_rgba(255,200,0,0.6)] flex items-center justify-center text-gray-900 font-black text-xs cursor-pointer hover:scale-125 transition-transform z-20 animate-pulse">
                ?
            </div>
            
            <div class="absolute inset-0 pointer-events-none border-2 border-dashed border-gray-600 rounded-lg opacity-30"></div>
        </div>

        <p class="text-center text-sm text-gray-400 mb-6" id="zoom-msg">Quem est√° exatamente no meio?</p>

        <div class="flex gap-4 w-full justify-center">
            <button id="btn-zoom-left" class="hidden bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg text-xs transition-all">üîç Zoom Esquerda</button>
            <button id="btn-reset-zoom" class="hidden bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-4 rounded-lg text-xs transition-all">Reiniciar</button>
            <button id="btn-zoom-right" class="hidden bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg text-xs transition-all">Zoom Direita üîç</button>
        </div>

    </div>
    `;

                    const midBtn = container.querySelector("#mid-point");
                    const lblL = container.querySelector("#label-left");
                    const lblR = container.querySelector("#label-right");
                    const msg = container.querySelector("#zoom-msg");
                    const zoomDisp = container.querySelector("#zoom-depth");
                    const btnReset = container.querySelector("#btn-reset-zoom");
                    const btnL = container.querySelector("#btn-zoom-left");
                    const btnR = container.querySelector("#btn-zoom-right");

                    const updateUI = () => {
                        // Formata fra√ß√µes
                        const fmt = (o) => (o.d === 1 ? o.n : `${o.n}/${o.d}`);
                        lblL.innerText = fmt(left);
                        lblR.innerText = fmt(right);

                        // Calcula o meio: (a/b + c/d) / 2
                        // Simplificado: Soma das fra√ß√µes dividido por 2
                        // nNew = n1*d2 + n2*d1, dNew = d1*d2 * 2
                        const nNew = left.n * right.d + right.n * left.d;
                        const dNew = left.d * right.d * 2;

                        // Simplifica√ß√£o b√°sica (opcional, mas bom para visualiza√ß√£o)
                        // No contexto do zoom bin√°rio, os denominadores s√£o pot√™ncias de 2, ent√£o dNew √© sempre v√°lido

                        midBtn.dataset.n = nNew;
                        midBtn.dataset.d = dNew;
                        midBtn.innerText = "?";
                        midBtn.classList.remove("hidden");

                        btnL.classList.add("hidden");
                        btnR.classList.add("hidden");

                        msg.innerText = `Existe um n√∫mero entre ${fmt(left)} e ${fmt(
                            right
                        )}?`;
                    };

                    midBtn.onclick = () => {
                        const n = midBtn.dataset.n;
                        const d = midBtn.dataset.d;
                        midBtn.innerText = `${n}/${d}`;
                        depth++;
                        zoomDisp.innerText = `${depth}x`;
                        msg.innerText = "Sempre existe! Para onde quer dar zoom agora?";

                        btnL.classList.remove("hidden");
                        btnR.classList.remove("hidden");
                        btnReset.classList.remove("hidden");

                        // Atualiza bot√µes de dire√ß√£o com valores pr√©vios para UX
                        btnL.innerText = `Entre ${lblL.innerText} e ${n}/${d}`;
                        btnR.innerText = `Entre ${n}/${d} e ${lblR.innerText}`;

                        // Define l√≥gica dos bot√µes
                        btnL.onclick = () => {
                            right = { n: parseInt(n), d: parseInt(d) };
                            updateUI();
                        };

                        btnR.onclick = () => {
                            left = { n: parseInt(n), d: parseInt(d) };
                            updateUI();
                        };
                    };

                    btnReset.onclick = () => {
                        left = { n: 0, d: 1 };
                        right = { n: 1, d: 1 };
                        depth = 1;
                        zoomDisp.innerText = "1x";
                        btnReset.classList.add("hidden");
                        updateUI();
                    };
                },

                interactive_decimal_sorter(container) {
                    const problems = [
                        { f: "1/2", val: 0.5, type: "exact" },
                        { f: "1/3", val: 0.333, type: "periodic" },
                        { f: "1/4", val: 0.25, type: "exact" },
                        { f: "1/5", val: 0.2, type: "exact" },
                        { f: "1/6", val: 0.166, type: "periodic" },
                        { f: "2/9", val: 0.222, type: "periodic" },
                        { f: "3/8", val: 0.375, type: "exact" },
                        { f: "4/9", val: 0.444, type: "periodic" },
                        { f: "7/10", val: 0.7, type: "exact" },
                        { f: "5/11", val: 0.4545, type: "periodic" },
                    ];

                    let currentIdx = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full mb-4">
            <span class="text-xs font-bold text-gray-400 uppercase">F√°brica de Decimais</span>
            <span class="text-xs font-bold text-brand-blue bg-blue-50 px-2 py-1 rounded">Score: <span id="ds-score">0</span></span>
        </div>

        <div class="relative w-full h-32 flex items-center justify-center mb-6">
            <div id="frac-card" class="w-40 h-28 bg-gray-800 text-white rounded-2xl flex flex-col items-center justify-center shadow-lg transition-all duration-300 z-10 relative">
                <span class="text-3xl font-black" id="frac-disp">1/2</span>
                <span class="text-xs font-mono text-gray-400 mt-2 opacity-0 transition-opacity" id="decimal-hint">0.5</span>
            </div>
        </div>

        <div class="flex gap-4 w-full max-w-sm">
            <button id="btn-exact" class="flex-1 h-14 rounded-xl bg-green-100 border-b-4 border-green-300 text-green-700 font-bold shadow-sm active:border-b-0 active:translate-y-1 transition-all text-xs uppercase">
                Decimal Exato<br>(Finito)
            </button>
            <button id="btn-periodic" class="flex-1 h-14 rounded-xl bg-orange-100 border-b-4 border-orange-300 text-orange-700 font-bold shadow-sm active:border-b-0 active:translate-y-1 transition-all text-xs uppercase">
                D√≠zima<br>(Infinito)
            </button>
        </div>

        <div id="ds-feedback" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-6xl opacity-0 pointer-events-none transition-all duration-500 z-20"></div>

    </div>
    `;

                    const card = container.querySelector("#frac-card");
                    const disp = container.querySelector("#frac-disp");
                    const hint = container.querySelector("#decimal-hint");
                    const scoreEl = container.querySelector("#ds-score");
                    const feedback = container.querySelector("#ds-feedback");

                    // Embaralha
                    const queue = [...problems].sort(() => Math.random() - 0.5);

                    const loadCard = () => {
                        if (currentIdx >= queue.length) {
                            disp.innerText = "FIM";
                            hint.innerText = `Final: ${score}/${queue.length}`;
                            hint.classList.remove("opacity-0");
                            return;
                        }
                        const p = queue[currentIdx];
                        disp.innerText = p.f;
                        hint.innerText = p.val + (p.type === "periodic" ? "..." : "");
                        hint.classList.add("opacity-0");

                        // Reset card pos
                        card.style.transform = "translate(0,0) rotate(0deg)";
                        card.className =
                            "w-40 h-28 bg-gray-800 text-white rounded-2xl flex flex-col items-center justify-center shadow-lg transition-all duration-300 z-10 relative animate-pop-in";
                    };

                    const handleChoice = (choice) => {
                        const p = queue[currentIdx];
                        const isCorrect = choice === p.type;

                        hint.classList.remove("opacity-0"); // Mostra a resposta

                        if (isCorrect) {
                            score++;
                            scoreEl.innerText = score;
                            feedback.innerText = "‚úÖ";
                            card.classList.replace("bg-gray-800", "bg-green-500");

                            // Sai voando
                            const dir = choice === "exact" ? -200 : 200;
                            card.style.transform = `translate(${dir}px, 50px) rotate(${dir / 10
                                }deg)`;
                            card.style.opacity = "0";
                        } else {
                            feedback.innerText = "‚ùå";
                            card.classList.replace("bg-gray-800", "bg-red-500");
                            card.classList.add("animate-shake");
                        }

                        feedback.classList.remove("opacity-0", "scale-0");
                        feedback.classList.add("opacity-100", "scale-150");

                        setTimeout(() => {
                            feedback.classList.add("opacity-0", "scale-0");
                            feedback.classList.remove("opacity-100", "scale-150");
                            currentIdx++;
                            loadCard();
                        }, 1200);
                    };

                    container.querySelector("#btn-exact").onclick = () =>
                        handleChoice("exact");
                    container.querySelector("#btn-periodic").onclick = () =>
                        handleChoice("periodic");

                    loadCard();
                },

                interactive_generating_fraction(container) {
                    let step = 0;

                    // Exemplo: 0,333...
                    const example = {
                        x: "0,333...",
                        x10: "3,333...",
                        sub: "3",
                        res: "3/9",
                        simp: "1/3",
                    };

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Gerador de Fra√ß√£o</h3>
        
        <div class="w-full bg-gray-50 border border-gray-200 rounded-xl p-4 font-mono text-lg text-gray-700 min-h-[200px] relative overflow-hidden">
            
            <div id="step-0" class="transition-all duration-500">
                <span class="text-brand-blue font-bold">x</span> = ${example.x}
            </div>

            <div id="step-1" class="hidden opacity-0 transition-all duration-500 mt-2 pl-4 border-l-2 border-green-400">
                <span class="text-green-600 font-bold">10x</span> = ${example.x10} <span class="text-xs text-gray-400">(Multiplicou por 10)</span>
            </div>

            <div id="step-2" class="hidden opacity-0 transition-all duration-500 mt-2 relative">
                <div class="absolute -left-2 top-0 bottom-0 w-1 bg-red-400"></div>
                <div class="text-red-500 text-sm font-bold mb-1">Subtraindo (10x - x):</div>
                <div class="flex justify-between w-40 border-b border-gray-300">
                    <span>10x = ${example.x10}</span>
                </div>
                <div class="flex justify-between w-40">
                    <span>- x = ${example.x}</span>
                </div>
            </div>

            <div id="step-3" class="hidden opacity-0 transition-all duration-500 mt-2 font-black text-xl text-brand-purple">
                9x = ${example.sub}
            </div>

            <div id="step-4" class="hidden opacity-0 transition-all duration-500 mt-4 text-center bg-white p-2 rounded shadow-sm border border-purple-100">
                x = ${example.res} <span class="text-gray-300 mx-2">‚ûú</span> <strong class="text-brand-green text-2xl">${example.simp}</strong>
            </div>

        </div>

        <div class="flex justify-between w-full mt-6 items-center">
            <button id="btn-reset-gen" class="text-xs font-bold text-gray-400 hover:text-brand-blue hidden"><i class="fas fa-undo"></i> Reiniciar</button>
            <button id="btn-next-step" class="bg-brand-blue text-white font-bold py-2 px-6 rounded-lg shadow-btn active:scale-95 transition-all ml-auto">
                Pr√≥ximo Passo
            </button>
        </div>

    </div>
    `;

                    const btnNext = container.querySelector("#btn-next-step");
                    const btnReset = container.querySelector("#btn-reset-gen");
                    const steps = [
                        container.querySelector("#step-1"),
                        container.querySelector("#step-2"),
                        container.querySelector("#step-3"),
                        container.querySelector("#step-4"),
                    ];

                    btnNext.onclick = () => {
                        if (step < 4) {
                            const el = steps[step];
                            el.classList.remove("hidden");
                            // Timeout para permitir transi√ß√£o de opacidade
                            setTimeout(() => {
                                el.classList.remove("opacity-0");
                                el.classList.add("translate-x-2"); // Pequeno movimento
                            }, 50);
                            step++;

                            if (step === 4) {
                                btnNext.innerText = "Conclu√≠do!";
                                btnNext.classList.replace("bg-brand-blue", "bg-brand-green");
                                btnNext.disabled = true;
                                btnReset.classList.remove("hidden");
                            }
                        }
                    };

                    btnReset.onclick = () => {
                        step = 0;
                        steps.forEach((el) => {
                            el.classList.add("hidden", "opacity-0");
                            el.classList.remove("translate-x-2");
                        });
                        btnNext.disabled = false;
                        btnNext.innerText = "Pr√≥ximo Passo";
                        btnNext.classList.replace("bg-brand-green", "bg-brand-blue");
                        btnReset.classList.add("hidden");
                    };
                },

                interactive_rational_battle(container) {
                    let score = 0;
                    let streak = 0;

                    // Fun√ß√£o para gerar n√∫mero racional aleat√≥rio
                    // Retorna objeto { str: "1/2", val: 0.5 }
                    const genRat = () => {
                        const type = Math.random();
                        const sign = Math.random() > 0.5 ? 1 : -1;

                        if (type < 0.4) {
                            // Inteiro
                            const n = Math.floor(Math.random() * 10);
                            return { str: (n * sign).toString(), val: n * sign };
                        } else if (type < 0.7) {
                            // Decimal
                            const n = (Math.random() * 5).toFixed(1);
                            return {
                                str: (n * sign).toString(),
                                val: parseFloat(n) * sign,
                            };
                        } else {
                            // Fra√ß√£o
                            const d = Math.floor(Math.random() * 5) + 2;
                            const n = Math.floor(Math.random() * 10) + 1;
                            return {
                                str: (sign < 0 ? "-" : "") + `${n}/${d}`,
                                val: (n / d) * sign,
                            };
                        }
                    };

                    let itemA, itemB;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none text-white relative overflow-hidden">
        
        <div class="flex justify-between w-full mb-6 z-10">
            <div class="text-xs font-bold uppercase tracking-widest text-gray-400">Batalha Racional</div>
            <div class="bg-brand-blue px-3 py-1 rounded-full text-xs font-black">Win Streak: <span id="bt-streak">0</span></div>
        </div>

        <h3 class="text-xl font-black mb-8 text-center z-10">Quem √© MAIOR?</h3>

        <div class="flex gap-4 md:gap-8 items-center w-full justify-center z-10">
            <button id="btn-a" class="w-32 h-32 bg-gray-800 border-4 border-gray-600 rounded-2xl flex flex-col items-center justify-center hover:bg-gray-700 hover:scale-105 transition-all active:scale-95 group">
                <span class="text-3xl font-mono font-bold group-hover:text-brand-yellow transition-colors" id="txt-a">?</span>
            </button>

            <div class="text-2xl font-black text-gray-600">VS</div>

            <button id="btn-b" class="w-32 h-32 bg-gray-800 border-4 border-gray-600 rounded-2xl flex flex-col items-center justify-center hover:bg-gray-700 hover:scale-105 transition-all active:scale-95 group">
                <span class="text-3xl font-mono font-bold group-hover:text-brand-yellow transition-colors" id="txt-b">?</span>
            </button>
        </div>

        <div id="bt-feedback" class="h-12 mt-6 flex items-center justify-center font-bold text-lg w-full text-center z-10"></div>
        
        <div class="absolute inset-0 opacity-10 bg-[radial-gradient(circle,_var(--tw-gradient-stops))] from-gray-700 to-gray-900 pointer-events-none"></div>
    </div>
    `;

                    const btnA = container.querySelector("#btn-a");
                    const btnB = container.querySelector("#btn-b");
                    const txtA = container.querySelector("#txt-a");
                    const txtB = container.querySelector("#txt-b");
                    const streakEl = container.querySelector("#bt-streak");
                    const feedback = container.querySelector("#bt-feedback");

                    const nextRound = () => {
                        // Garante valores diferentes
                        do {
                            itemA = genRat();
                            itemB = genRat();
                        } while (Math.abs(itemA.val - itemB.val) < 0.01);

                        txtA.innerText = itemA.str;
                        txtB.innerText = itemB.str;

                        // Reset styles
                        btnA.className =
                            "w-32 h-32 bg-gray-800 border-4 border-gray-600 rounded-2xl flex flex-col items-center justify-center hover:bg-gray-700 hover:scale-105 transition-all active:scale-95 group cursor-pointer";
                        btnB.className =
                            "w-32 h-32 bg-gray-800 border-4 border-gray-600 rounded-2xl flex flex-col items-center justify-center hover:bg-gray-700 hover:scale-105 transition-all active:scale-95 group cursor-pointer";
                        feedback.innerHTML = "";
                    };

                    const check = (choice) => {
                        // 'a' or 'b'
                        const winner = itemA.val > itemB.val ? "a" : "b";
                        const isCorrect = choice === winner;

                        if (isCorrect) {
                            streak++;
                            feedback.innerHTML = `<span class="text-green-400">Acertou! ${choice === "a" ? itemA.val.toFixed(2) : itemB.val.toFixed(2)
                                } √© maior.</span>`;
                            // Highlight winner
                            const winBtn = choice === "a" ? btnA : btnB;
                            winBtn.classList.replace("border-gray-600", "border-green-500");
                            winBtn.classList.add("bg-green-900");
                            setTimeout(nextRound, 1000);
                        } else {
                            streak = 0;
                            feedback.innerHTML = `<span class="text-red-400">Errou! Lembre: na reta, direita √© maior.</span>`;
                            const loseBtn = choice === "a" ? btnA : btnB;
                            loseBtn.classList.replace("border-gray-600", "border-red-500");
                            loseBtn.classList.add("animate-shake");
                            setTimeout(nextRound, 1500);
                        }
                        streakEl.innerText = streak;
                    };

                    btnA.onclick = () => check("a");
                    btnB.onclick = () => check("b");

                    nextRound();
                },

                interactive_rational_mirror(container) {
                    let val = -2.5;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Simulador de Simetria</h3>

        <div class="relative w-full h-24 mb-6">
            <div class="absolute top-1/2 left-0 w-full h-1 bg-gray-300 -translate-y-1/2"></div>
            <div class="absolute top-1/2 left-1/2 w-1 h-6 bg-gray-800 -translate-x-1/2 -translate-y-1/2"></div>
            <div class="absolute top-2/3 left-1/2 -translate-x-1/2 text-xs font-bold text-gray-500">0</div>
            
            <div id="point-p" class="absolute top-1/2 w-6 h-6 bg-brand-blue rounded-full -translate-y-1/2 border-2 border-white shadow-md transition-all duration-300 flex items-center justify-center text-[10px] text-white font-bold z-10" style="left: 20%">
                P
            </div>
            
            <div id="point-sym" class="absolute top-1/2 w-6 h-6 bg-brand-orange/50 rounded-full -translate-y-1/2 border-2 border-dashed border-brand-orange transition-all duration-300 flex items-center justify-center text-[10px] text-orange-800 font-bold opacity-0" style="left: 80%">
                P'
            </div>
            
            <div id="dist-line-l" class="absolute top-1/2 h-1 bg-brand-blue/30 -translate-y-1/2 transition-all duration-300" style="left: 20%; width: 30%"></div>
            <div id="dist-line-r" class="absolute top-1/2 h-1 bg-brand-orange/30 -translate-y-1/2 transition-all duration-300 opacity-0" style="left: 50%; width: 30%"></div>

        </div>

        <input type="range" id="mirror-slider" min="-5" max="5" step="0.5" value="-2.5" class="w-full mb-6 accent-brand-blue">

        <div class="grid grid-cols-2 gap-4 w-full text-center">
            <div class="bg-blue-50 p-2 rounded-lg border border-blue-200">
                <span class="text-[10px] uppercase font-bold text-gray-400">Valor de P</span>
                <div class="text-xl font-black text-brand-blue" id="val-p">-2.5</div>
            </div>
            <div class="bg-orange-50 p-2 rounded-lg border border-orange-200">
                <span class="text-[10px] uppercase font-bold text-gray-400">Sim√©trico (Oposto)</span>
                <div class="text-xl font-black text-brand-orange" id="val-sym">+2.5</div>
            </div>
        </div>

        <div class="mt-4 bg-purple-50 p-2 rounded-lg border border-purple-200 w-full text-center">
             <span class="text-[10px] uppercase font-bold text-gray-400">M√≥dulo (Dist√¢ncia)</span>
             <div class="text-xl font-black text-brand-purple">|<span id="mod-in">-2.5</span>| = <span id="mod-out">2.5</span></div>
        </div>

    </div>
    `;

                    const slider = container.querySelector("#mirror-slider");
                    const p = container.querySelector("#point-p");
                    const sym = container.querySelector("#point-sym");
                    const distL = container.querySelector("#dist-line-l");
                    const distR = container.querySelector("#dist-line-r");
                    const valP = container.querySelector("#val-p");
                    const valSym = container.querySelector("#val-sym");
                    const modIn = container.querySelector("#mod-in");
                    const modOut = container.querySelector("#mod-out");

                    const update = () => {
                        val = parseFloat(slider.value);

                        // Mapeia -5 a 5 para 0% a 100%
                        // 0 √© 50%
                        const pct = ((val + 5) / 10) * 100;
                        const symPct = 100 - pct;

                        p.style.left = `calc(${pct}% - 12px)`;
                        sym.style.left = `calc(${symPct}% - 12px)`;
                        sym.style.opacity = val === 0 ? 0 : 1; // Esconde se for zero

                        // Linhas de Dist√¢ncia (sempre partem do centro 50%)
                        if (val < 0) {
                            distL.style.left = `${pct}%`;
                            distL.style.width = `${50 - pct}%`;
                            distR.style.left = `50%`;
                            distR.style.width = `${50 - pct}%`;
                        } else {
                            distL.style.left = `50%`;
                            distL.style.width = `${pct - 50}%`;
                            distR.style.left = `${100 - pct}%`;
                            distR.style.width = `${pct - 50}%`;
                        }
                        distR.style.opacity = val === 0 ? 0 : 1;

                        valP.innerText = val;
                        valSym.innerText = -val;
                        modIn.innerText = val;
                        modOut.innerText = Math.abs(val);
                    };

                    slider.oninput = update;
                    update();
                },

                interactive_submarine_mission(container) {
                    let currentDepth = -5.5;
                    let targetDepth = -12.0;

                    container.innerHTML = `
    <div class="bg-blue-900 border-4 border-blue-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[400px]">
        
        <div class="absolute inset-0 z-0">
            <div class="absolute top-0 w-full h-16 bg-blue-300 opacity-50 z-10 border-b border-white"></div> <div class="grid grid-rows-[repeat(20,1fr)] h-full w-full opacity-20 pointer-events-none">
                ${[...Array(20)]
                            .map(
                                (_, i) =>
                                    `<div class="border-b border-white text-white text-[10px] pl-1 pt-1">-${i}m</div>`
                            )
                            .join("")}
            </div>
        </div>

        <div class="flex justify-between w-full z-20 text-white mb-2">
            <div class="bg-blue-800/80 px-3 py-1 rounded-lg border border-blue-500 text-xs font-bold">
                Atual: <span id="depth-val" class="text-brand-yellow text-lg">${currentDepth}m</span>
            </div>
            <div class="bg-red-900/80 px-3 py-1 rounded-lg border border-red-500 text-xs font-bold animate-pulse">
                Alvo: ${targetDepth}m
            </div>
        </div>

        <div id="sub-visual" class="absolute left-1/2 -translate-x-1/2 w-24 h-12 bg-yellow-400 rounded-full shadow-lg z-10 transition-all duration-1000 flex items-center justify-center border-2 border-yellow-600" style="top: 100px;">
            <div class="w-3 h-3 bg-blue-300 rounded-full border-2 border-gray-600 mr-2"></div>
            <div class="w-3 h-3 bg-blue-300 rounded-full border-2 border-gray-600"></div>
            <div class="absolute -top-3 left-1/2 w-4 h-4 bg-yellow-400 rounded-t-lg border-t-2 border-x-2 border-yellow-600"></div>
        </div>

        <div class="absolute bottom-4 w-full px-4 z-20 flex flex-col gap-2">
            <p class="text-center text-white text-xs font-bold bg-black/30 rounded py-1">Ajuste os lastros para chegar ao alvo</p>
            <div class="flex gap-2 justify-center">
                <button class="move-btn bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg border-b-4 border-red-800 active:translate-y-1 active:border-b-0" data-val="-2.5">
                    <i class="fas fa-arrow-down"></i> -2.5
                </button>
                <button class="move-btn bg-red-400 hover:bg-red-500 text-white font-bold py-2 px-4 rounded-lg shadow-lg border-b-4 border-red-700 active:translate-y-1 active:border-b-0" data-val="-1.0">
                    <i class="fas fa-arrow-down"></i> -1.0
                </button>
                <button class="move-btn bg-green-400 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-lg shadow-lg border-b-4 border-green-700 active:translate-y-1 active:border-b-0" data-val="+1.0">
                    <i class="fas fa-arrow-up"></i> +1.0
                </button>
                <button class="move-btn bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg border-b-4 border-green-800 active:translate-y-1 active:border-b-0" data-val="+2.5">
                    <i class="fas fa-arrow-up"></i> +2.5
                </button>
            </div>
        </div>

        <div id="sub-msg" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white/95 p-4 rounded-xl text-center shadow-xl hidden z-30">
        </div>
    </div>
    `;

                    const sub = container.querySelector("#sub-visual");
                    const depthVal = container.querySelector("#depth-val");
                    const msgBox = container.querySelector("#sub-msg");
                    const btns = container.querySelectorAll(".move-btn");

                    // Escala: 400px de altura. 0m √© top 60px. -20m √© bottom.
                    // 1m = aprox 15px.
                    const zeroPos = 60;
                    const pxPerMeter = 15;

                    const updateSub = () => {
                        // Render Position
                        // Profundidade √© negativa, mas Y cresce para baixo.
                        // -5m deve estar abaixo de 0m.
                        // Y = zeroPos + (abs(depth) * pxPerMeter)
                        const y = zeroPos + Math.abs(currentDepth) * pxPerMeter;
                        sub.style.top = `${y}px`;
                        depthVal.innerText = currentDepth.toFixed(1) + "m";

                        // Check Win
                        if (Math.abs(currentDepth - targetDepth) < 0.1) {
                            msgBox.innerHTML = `
                <div class="text-4xl mb-2">üèÜ</div>
                <h3 class="text-xl font-black text-brand-green">Alvo Localizado!</h3>
                <p class="text-sm text-gray-600">Sonar ativo. Miss√£o cumprida.</p>
                <button class="mt-2 bg-brand-blue text-white px-4 py-2 rounded-lg font-bold" onclick="this.parentElement.classList.add('hidden')">Ok</button>
            `;
                            msgBox.classList.remove("hidden");
                            sub.classList.add("animate-bounce");
                        }
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            const val = parseFloat(btn.dataset.val);
                            currentDepth += val;
                            // Limites do mar
                            if (currentDepth > 0) currentDepth = 0; // N√£o voa
                            if (currentDepth < -20) currentDepth = -20; // Fundo
                            updateSub();
                        };
                    });

                    updateSub();
                },

                interactive_sniper_math(container) {
                    let target = -6;
                    let base = 12;
                    let factor = -0.5;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <h3 class="text-brand-green font-black uppercase text-xs tracking-widest mb-4"><i class="fas fa-crosshairs"></i> Sniper Racional</h3>
        
        <div class="relative w-full h-16 bg-gray-800 rounded-full border border-gray-600 mb-8 flex items-center px-4">
            <div class="absolute left-1/2 top-0 bottom-0 w-0.5 bg-gray-500"></div> <div class="absolute left-1/2 top-full mt-1 text-[10px] text-gray-500 -translate-x-1/2">0</div>

            <div id="target-marker" class="absolute w-4 h-4 bg-red-500 rounded-full shadow-[0_0_10px_#ef4444] animate-pulse transition-all duration-500" style="left: 20%;">
                <div class="absolute -top-6 left-1/2 -translate-x-1/2 text-red-400 font-bold text-xs whitespace-nowrap">Alvo: <span id="lbl-target">-6</span></div>
            </div>

            <div id="shot-marker" class="absolute w-4 h-4 bg-brand-green border-2 border-white rounded-full shadow-lg transition-all duration-500 z-10" style="left: 80%;">
                <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-green-400 font-bold text-xs whitespace-nowrap" id="lbl-current">?</div>
            </div>
        </div>

        <div class="bg-gray-800 p-4 rounded-xl border border-gray-600 w-full max-w-sm flex flex-col gap-4">
            <div class="flex justify-between items-center text-white font-mono text-lg">
                <span class="text-blue-400 font-bold">${base}</span>
                <span>√ó</span>
                <span class="text-yellow-400 font-bold border-b-2 border-yellow-400 px-2 min-w-[60px] text-center" id="factor-display">-0.5</span>
                <span>=</span>
                <span class="text-brand-green font-bold" id="result-display">?</span>
            </div>

            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase">Ajuste o Fator (Multiplicador)</label>
                <input type="range" id="factor-slider" min="-200" max="200" value="-50" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-brand-yellow">
                <div class="flex justify-between text-[10px] text-gray-500 font-mono mt-1">
                    <span>-2.0</span>
                    <span>0</span>
                    <span>+2.0</span>
                </div>
            </div>

            <button id="btn-fire-sniper" class="w-full bg-brand-green text-gray-900 font-black py-3 rounded-xl shadow-[0_0_15px_rgba(34,197,94,0.4)] active:scale-95 transition-all">
                DISPARAR
            </button>
        </div>
        
        <div id="sniper-feedback" class="h-8 mt-2 font-bold text-center text-sm text-white"></div>
    </div>
    `;

                    const slider = container.querySelector("#factor-slider");
                    const factorDisp = container.querySelector("#factor-display");
                    const resDisp = container.querySelector("#result-display");
                    const btn = container.querySelector("#btn-fire-sniper");
                    const shot = container.querySelector("#shot-marker");
                    const lblCurrent = container.querySelector("#lbl-current");
                    const feedback = container.querySelector("#sniper-feedback");
                    const targetMarker = container.querySelector("#target-marker");

                    // Mapeamento visual (Reta vai de -24 a +24 visualmente)
                    // 0 = 50%
                    const mapPos = (val) => {
                        const percent = 50 + (val / 48) * 100;
                        return Math.max(2, Math.min(98, percent)); // Clamp
                    };

                    // Posiciona alvo inicialmente
                    targetMarker.style.left = `${mapPos(target)}%`;

                    const update = () => {
                        const raw = parseInt(slider.value);
                        factor = raw / 100; // -2.00 a 2.00
                        factorDisp.innerText = factor.toFixed(2);

                        const res = base * factor;
                        resDisp.innerText = res.toFixed(1);

                        // Move o marcador "fantasma" antes de atirar? N√£o, move s√≥ no tiro para suspense?
                        // Vamos mover em tempo real para ser educativo
                        shot.style.left = `${mapPos(res)}%`;
                        lblCurrent.innerText = res.toFixed(1);
                    };

                    btn.onclick = () => {
                        const res = base * factor;
                        const diff = Math.abs(res - target);

                        if (diff < 0.5) {
                            feedback.innerHTML = `<span class="text-green-400">NA MOSCA!</span>`;
                            targetMarker.classList.add("scale-150", "bg-white");
                            // Confetti effect here logic
                        } else {
                            const hint =
                                Math.abs(factor) < 1
                                    ? "Multiplicar por 0,x diminui!"
                                    : "Passou longe!";
                            const signHint = res > 0 && target < 0 ? "Sinal errado!" : "";
                            feedback.innerHTML = `<span class="text-red-400">ERROU! ${signHint || hint
                                }</span>`;
                            container.classList.add("animate-shake");
                            setTimeout(
                                () => container.classList.remove("animate-shake"),
                                500
                            );
                        }
                    };

                    slider.oninput = update;
                    update();
                },

                interactive_kitchen_flip(container) {
                    let state = "waiting"; // waiting, flipped, cooking
                    const recipe = { n1: 2, d1: 3, n2: 4, d2: 5 }; // 2/3 √∑ 4/5

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <div class="flex items-center gap-2 mb-4">
            <span class="text-4xl">üë®‚Äçüç≥</span>
            <div>
                <h3 class="text-brand-orange font-black uppercase text-xs tracking-widest">Cozinha de Fra√ß√µes</h3>
                <p class="text-xs text-gray-500 font-bold">Toque na frigideira para virar!</p>
            </div>
        </div>

        <div class="flex items-center gap-2 md:gap-4 text-3xl font-mono font-black text-gray-700 mb-8 bg-gray-50 p-4 rounded-2xl border-b-4 border-gray-200">
            <div class="flex flex-col items-center">
                <span class="text-brand-blue">${recipe.n1}</span>
                <div class="w-full h-1 bg-gray-400 rounded"></div>
                <span class="text-brand-blue">${recipe.d1}</span>
            </div>

            <div id="operator" class="text-brand-orange transition-all duration-300">√∑</div>

            <div id="pan" class="relative group cursor-pointer transition-transform duration-500 hover:scale-105 active:rotate-12">
                
                <div id="pancake" class="flex flex-col items-center transition-all duration-700">
                    <span id="p-top" class="text-brand-orange">${recipe.n2}</span>
                    <div class="w-full h-1 bg-gray-400 rounded"></div>
                    <span id="p-bot" class="text-brand-orange">${recipe.d2}</span>
                </div>
                
                <div class="absolute -bottom-2 -right-8 w-12 h-3 bg-gray-800 rounded-full transform -rotate-12 -z-10"></div>
                <div class="absolute -bottom-4 left-1/2 -translate-x-1/2 w-20 h-4 bg-gray-300 rounded-b-full border border-gray-400 -z-10"></div>
            </div>
        </div>

        <div id="kitchen-feedback" class="h-10 text-center font-bold text-sm text-brand-green opacity-0 transition-opacity">
            Agora multiplique reto!
        </div>

        <button id="btn-cook" class="bg-gray-400 text-white font-bold py-3 px-8 rounded-xl shadow-none transition-all cursor-not-allowed" disabled>
            Finalizar Prato
        </button>

    </div>
    `;

                    const pan = container.querySelector("#pan");
                    const pancake = container.querySelector("#pancake");
                    const pTop = container.querySelector("#p-top");
                    const pBot = container.querySelector("#p-bot");
                    const op = container.querySelector("#operator");
                    const feedback = container.querySelector("#kitchen-feedback");
                    const btn = container.querySelector("#btn-cook");

                    pan.onclick = () => {
                        if (state !== "waiting") return;
                        state = "flipping";

                        // Anima√ß√£o de Flip
                        pancake.style.transform = "rotateX(180deg) translateY(-10px)"; // Pulo e giro
                        op.style.transform = "scale(0)";

                        setTimeout(() => {
                            // Troca visual dos n√∫meros (para n√£o ficarem de cabe√ßa para baixo)
                            const oldTop = pTop.innerText;
                            pTop.innerText = pBot.innerText;
                            pBot.innerText = oldTop;

                            pancake.style.transition = "none";
                            pancake.style.transform = "rotateX(0deg)"; // Reset rota√ß√£o sem anim

                            // Troca Operador
                            op.innerText = "√ó";
                            op.classList.replace("text-brand-orange", "text-brand-green");
                            op.style.transform = "scale(1.2)";

                            // Feedback
                            feedback.innerText = "Invertido! Agora virou multiplica√ß√£o.";
                            feedback.classList.remove("opacity-0");

                            // Habilita Bot√£o
                            btn.disabled = false;
                            btn.classList.remove(
                                "bg-gray-400",
                                "cursor-not-allowed",
                                "shadow-none"
                            );
                            btn.classList.add(
                                "bg-brand-green",
                                "shadow-btn",
                                "active:scale-95",
                                "animate-pulse"
                            );

                            state = "flipped";
                        }, 350);
                    };

                    btn.onclick = () => {
                        // Mostra c√°lculo final
                        const resN = recipe.n1 * recipe.d2;
                        const resD = recipe.d1 * recipe.n2;

                        container.innerHTML = `
            <div class="bg-green-50 border-4 border-green-200 rounded-xl p-8 flex flex-col items-center w-full text-center animate-pop-in">
                <div class="text-6xl mb-4">üç≥</div>
                <h3 class="text-brand-green font-black text-2xl mb-2">Prato Pronto!</h3>
                <div class="font-mono text-3xl font-bold text-gray-700">
                    ${resN} / ${resD}
                </div>
                <button onclick="app.widgets.interactive_kitchen_flip(this.closest('.widget-placeholder'))" class="mt-6 text-xs font-bold text-gray-400 underline">Cozinhar de novo</button>
            </div>
        `;
                    };
                },

                interactive_exponent_elevator(container) {
                    let exponent = 2;
                    const base = { n: 2, d: 1 }; // Base 2

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Elevador de Pot√™ncia</h3>

        <div class="flex gap-8 items-center justify-center w-full mb-8">
            
            <div class="w-16 h-64 bg-gray-200 rounded-full relative border-4 border-gray-300 shadow-inner flex flex-col justify-between py-4 items-center">
                <div class="absolute right-full mr-2 text-xs font-bold text-gray-400 flex flex-col justify-between h-full py-4">
                    <span>+3</span><span>0</span><span>-3</span>
                </div>
                
                <div id="elevator-cab" class="w-12 h-12 bg-brand-blue rounded-full shadow-lg border-2 border-white flex items-center justify-center text-white font-black text-lg transition-all duration-500 absolute cursor-grab active:cursor-grabbing" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">
                    0
                </div>
            </div>

            <div class="flex flex-col items-center">
                <div id="fraction-display" class="flex flex-col items-center text-5xl font-mono font-black text-brand-text transition-all duration-500">
                    <span id="el-top">2</span>
                    <div class="w-full h-2 bg-gray-800 rounded my-1 opacity-0" id="el-bar"></div>
                    <span id="el-bot" class="opacity-0">1</span>
                </div>
                <div class="mt-4 bg-gray-100 px-4 py-2 rounded-lg font-mono font-bold text-gray-500" id="calc-display">2‚Å∞ = 1</div>
            </div>

        </div>
        
        <input type="range" id="floor-slider" min="-3" max="3" step="1" value="0" class="w-full max-w-xs h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer accent-brand-blue">
        <p class="text-center text-xs text-gray-400 mt-2 font-bold uppercase">Arraste para mudar o andar</p>

    </div>
    `;

                    const cab = container.querySelector("#elevator-cab");
                    const slider = container.querySelector("#floor-slider");
                    const elTop = container.querySelector("#el-top");
                    const elBot = container.querySelector("#el-bot");
                    const elBar = container.querySelector("#el-bar");
                    const calcDisp = container.querySelector("#calc-display");
                    const fracDisp = container.querySelector("#fraction-display");

                    const update = () => {
                        const exp = parseInt(slider.value);

                        // Move Elevador (Invertido: +3 no topo = 0%, -3 no fundo = 100%)
                        // Range -3 a 3.
                        // -3 -> 100% top
                        // 3 -> 0% top
                        // map: (exp - (-3)) / (3 - (-3)) = (exp + 3) / 6.
                        // Invert to css top: 1 - ratio
                        const ratio = (exp + 3) / 6;
                        const topPos = (1 - ratio) * 80 + 10; // 10% padding

                        cab.style.top = `${topPos}%`;
                        cab.innerText = exp;

                        // Cor do elevador muda no subsolo
                        if (exp < 0) {
                            cab.classList.replace("bg-brand-blue", "bg-brand-red");
                            fracDisp.classList.add("scale-90"); // Encolhe um pouco (fra√ß√£o)
                        } else {
                            cab.classList.replace("bg-brand-red", "bg-brand-blue");
                            fracDisp.classList.remove("scale-90");
                        }

                        // L√≥gica Matem√°tica
                        const val = Math.pow(2, Math.abs(exp));

                        if (exp > 0) {
                            // Inteiro Grande
                            elTop.innerText = val;
                            elBot.classList.add("opacity-0");
                            elBar.classList.add("opacity-0");
                            calcDisp.innerText = `2^${exp} = ${val}`;
                        } else if (exp === 0) {
                            // Um
                            elTop.innerText = "1";
                            elBot.classList.add("opacity-0");
                            elBar.classList.add("opacity-0");
                            calcDisp.innerText = `2‚Å∞ = 1`;
                        } else {
                            // Fra√ß√£o (Subsolo)
                            elTop.innerText = "1";
                            elBot.innerText = val;
                            elBot.classList.remove("opacity-0");
                            elBar.classList.remove("opacity-0");
                            calcDisp.innerText = `2^(${exp}) = 1/${val}`;
                        }
                    };

                    slider.oninput = update;
                    update();
                },

                interactive_ops_tower(container) {
                    // Express√£o: ( -4 + 1 )¬≤ √∑ 3 - 0,5
                    // Passos:
                    // 1. Par√™nteses: -4+1 = -3
                    // 2. Pot√™ncia: (-3)¬≤ = 9
                    // 3. Divis√£o: 9 √∑ 3 = 3
                    // 4. Subtra√ß√£o: 3 - 0,5 = 2,5

                    const steps = [
                        {
                            html: `<span class="p-btn cursor-pointer bg-blue-100 hover:bg-blue-200 border-b-2 border-blue-400 rounded px-1 text-blue-800" data-id="1">( -4 + 1 )</span><sup class="text-gray-400">2</sup> √∑ 3 - 0,5`,
                            correctId: 1,
                            nextVal: `<span class="font-bold text-brand-purple">-3</span>`,
                            feedback: "Boa! Primeiro resolvemos o par√™nteses.",
                        },
                        {
                            html: `<span class="p-btn cursor-pointer bg-purple-100 hover:bg-purple-200 border-b-2 border-purple-400 rounded px-1 text-purple-800" data-id="2"><span class="font-bold text-brand-purple">-3</span><sup class="text-gray-600">2</sup></span> √∑ 3 - 0,5`,
                            correctId: 2,
                            nextVal: `9`,
                            feedback: "Isso! Pot√™ncia vem antes de divis√£o.",
                        },
                        {
                            html: `<span class="p-btn cursor-pointer bg-orange-100 hover:bg-orange-200 border-b-2 border-orange-400 rounded px-1 text-orange-800" data-id="3">9 √∑ 3</span> - 0,5`,
                            correctId: 3,
                            nextVal: `3`,
                            feedback: "Exato! Divis√£o ganha da subtra√ß√£o.",
                        },
                        {
                            html: `<span class="p-btn cursor-pointer bg-green-100 hover:bg-green-200 border-b-2 border-green-400 rounded px-1 text-green-800" data-id="4">3 - 0,5</span>`,
                            correctId: 4,
                            nextVal: `2,5`,
                            feedback: "Vit√≥ria! O resultado final √© 2,5.",
                        },
                    ];

                    let current = 0;

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-300 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none min-h-[300px]">
        
        <h3 class="text-brand-blue font-black uppercase text-xs tracking-widest mb-6">Torre de Opera√ß√µes</h3>
        
        <div class="w-full bg-white rounded-2xl p-8 shadow-inner border-2 border-gray-200 text-center mb-6">
            <div id="tower-display" class="font-mono text-2xl md:text-3xl font-bold text-gray-700 transition-all">
                </div>
        </div>

        <div id="tower-feedback" class="h-12 bg-gray-800 text-white rounded-lg flex items-center justify-center px-4 text-sm font-bold w-full max-w-sm opacity-0 transition-opacity">
            ...
        </div>

        <button id="btn-reset-tower" class="mt-4 text-xs font-bold text-gray-400 uppercase hover:text-brand-red hidden">Reiniciar</button>

    </div>
    `;

                    const display = container.querySelector("#tower-display");
                    const feedback = container.querySelector("#tower-feedback");
                    const resetBtn = container.querySelector("#btn-reset-tower");

                    const render = () => {
                        if (current >= steps.length) {
                            display.innerHTML = `<span class="text-5xl font-black text-brand-green animate-bounce">2,5</span>`;
                            feedback.innerHTML = "üèÜ EXPRESS√ÉO RESOLVIDA!";
                            feedback.className =
                                "h-12 bg-brand-green text-white rounded-lg flex items-center justify-center px-4 text-sm font-bold w-full max-w-sm shadow-lg";
                            feedback.classList.remove("opacity-0");
                            resetBtn.classList.remove("hidden");
                            return;
                        }

                        const step = steps[current];
                        display.innerHTML = step.html;

                        // Add Listeners
                        const btns = display.querySelectorAll(".p-btn");
                        btns.forEach((b) => {
                            b.onclick = () => {
                                const id = parseInt(b.dataset.id);
                                if (id === step.correctId) {
                                    // Acertou
                                    feedback.innerText = step.feedback;
                                    feedback.classList.remove("opacity-0");
                                    feedback.classList.replace("bg-red-500", "bg-gray-800"); // Reset cor erro

                                    // Anima√ß√£o de substitui√ß√£o
                                    b.outerHTML = `<span class="text-brand-green animate-pop-in">${step.nextVal}</span>`;

                                    setTimeout(() => {
                                        current++;
                                        render();
                                    }, 1000);
                                } else {
                                    // Errou (embora neste design linear s√≥ haja uma op√ß√£o clic√°vel visualmente destacada por vez para guiar,
                                    // se quis√©ssemos dificultar, colocar√≠amos outras partes clic√°veis erradas.
                                    // Neste modelo educativo, o clique confirma o passo).
                                }
                            };
                        });
                    };

                    resetBtn.onclick = () => {
                        current = 0;
                        feedback.classList.add("opacity-0");
                        resetBtn.classList.add("hidden");
                        render();
                    };

                    render();
                },

                interactive_algebra_translator(container) {
                    const questions = [
                        { text: "O dobro de um n√∫mero", ans: "2x" },
                        { text: "Um n√∫mero mais cinco", ans: "x+5" },
                        { text: "A ter√ßa parte de um n√∫mero", ans: "x/3" },
                        { text: "O triplo de um n√∫mero menos dois", ans: "3x-2" },
                        { text: "O quadrado de um n√∫mero", ans: "x¬≤" },
                    ];

                    let current = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-4">
            <h3 class="text-brand-blue font-black uppercase text-xs tracking-widest"><i class="fas fa-language"></i> Tradutor Alg√©brico</h3>
            <div class="bg-blue-50 text-brand-blue px-3 py-1 rounded-full text-xs font-black">Pts: <span id="trans-score">0</span></div>
        </div>

        <div class="w-full bg-gray-100 rounded-xl p-6 mb-6 text-center border-b-4 border-gray-200">
            <p class="text-xs font-bold text-gray-400 uppercase mb-2">Portugu√™s</p>
            <p class="text-xl md:text-2xl font-bold text-gray-700 leading-tight" id="q-text">...</p>
        </div>

        <p class="text-xs font-bold text-gray-400 uppercase mb-2">Selecione a tradu√ß√£o em Matematiqu√™s:</p>
        
        <div class="grid grid-cols-2 gap-3 w-full" id="options-grid">
        </div>

        <div id="trans-feedback" class="h-10 mt-4 flex items-center justify-center font-bold text-sm"></div>

    </div>
    `;

                    const qText = container.querySelector("#q-text");
                    const optsGrid = container.querySelector("#options-grid");
                    const scoreEl = container.querySelector("#trans-score");
                    const feedback = container.querySelector("#trans-feedback");

                    const loadQuestion = () => {
                        if (current >= questions.length) {
                            container.innerHTML = `
                <div class="bg-green-100 border-4 border-green-400 rounded-xl p-8 text-center w-full">
                    <div class="text-6xl mb-4">üéì</div>
                    <h3 class="text-2xl font-black text-brand-green">Fluente em √Ålgebra!</h3>
                    <p class="text-green-800 font-bold mt-2">Voc√™ traduziu tudo corretamente.</p>
                </div>`;
                            return;
                        }

                        const q = questions[current];
                        qText.innerText = `"${q.text}"`;
                        feedback.innerHTML = "";

                        // Gerar op√ß√µes (1 certa + 3 erradas aleat√≥rias de outras perguntas ou geradas)
                        let opts = [q.ans];
                        const distractors = [
                            "x+2",
                            "2x+5",
                            "x-3",
                            "x/2",
                            "3x",
                            "x+10",
                            "x¬≤-1",
                        ];

                        while (opts.length < 4) {
                            const d =
                                distractors[Math.floor(Math.random() * distractors.length)];
                            if (!opts.includes(d)) opts.push(d);
                        }
                        opts.sort(() => Math.random() - 0.5);

                        optsGrid.innerHTML = "";
                        opts.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-white border-2 border-brand-blue text-brand-blue font-mono font-bold text-lg py-3 rounded-xl hover:bg-blue-50 active:scale-95 transition-all shadow-sm";
                            btn.innerText = opt;
                            btn.onclick = () => check(opt, btn);
                            optsGrid.appendChild(btn);
                        });
                    };

                    const check = (val, btn) => {
                        const correct = questions[current].ans;
                        // Bloqueia todos
                        Array.from(optsGrid.children).forEach((b) => (b.disabled = true));

                        if (val === correct) {
                            score += 10;
                            scoreEl.innerText = score;
                            btn.classList.replace("border-brand-blue", "border-green-500");
                            btn.classList.replace("text-brand-blue", "text-green-600");
                            btn.classList.add("bg-green-100");
                            feedback.innerHTML = `<span class="text-brand-green">Correto!</span>`;
                            setTimeout(() => {
                                current++;
                                loadQuestion();
                            }, 1000);
                        } else {
                            btn.classList.replace("border-brand-blue", "border-red-500");
                            btn.classList.replace("text-brand-blue", "text-red-600");
                            btn.classList.add("bg-red-100", "animate-shake");
                            feedback.innerHTML = `<span class="text-brand-red">Ops! A resposta era <strong>${correct}</strong></span>`;
                            setTimeout(() => {
                                current++;
                                loadQuestion();
                            }, 2000);
                        }
                    };

                    loadQuestion();
                },

                interactive_substitution_machine(container) {
                    let xVal = 2;

                    container.innerHTML = `
    <div class="bg-gray-800 border-4 border-gray-600 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <h3 class="text-white font-bold uppercase text-xs tracking-widest mb-6">Processador Num√©rico</h3>

        <div class="flex items-center gap-2 mb-8 relative">
            
            <div class="flex flex-col items-center z-10">
                <label class="text-[10px] font-bold text-gray-400 uppercase mb-1">Entrada (x)</label>
                <div class="flex items-center gap-2">
                    <button class="w-8 h-8 rounded bg-gray-700 text-white hover:bg-gray-600 font-bold" id="btn-dec-x">-</button>
                    <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center font-black text-2xl text-gray-800 border-b-4 border-gray-300" id="input-slot">${xVal}</div>
                    <button class="w-8 h-8 rounded bg-gray-700 text-white hover:bg-gray-600 font-bold" id="btn-inc-x">+</button>
                </div>
            </div>

            <div class="w-16 h-2 bg-gray-600 relative overflow-hidden">
                <div class="absolute inset-0 bg-[repeating-linear-gradient(90deg,transparent,transparent_5px,#4b5563_5px,#4b5563_10px)] animate-move-right"></div>
            </div>

            <div class="relative bg-brand-purple p-4 rounded-xl border-b-8 border-purple-800 shadow-lg text-center z-10 w-32">
                <div class="text-[10px] font-bold text-purple-200 uppercase mb-1">Fun√ß√£o</div>
                <div class="font-mono font-black text-2xl text-white">2x + 1</div>
                <div class="absolute -bottom-10 left-1/2 -translate-x-1/2 w-4 h-10 bg-gradient-to-b from-purple-800 to-transparent opacity-50"></div>
            </div>

            <div class="w-16 h-2 bg-gray-600 relative overflow-hidden">
                <div class="absolute inset-0 bg-[repeating-linear-gradient(90deg,transparent,transparent_5px,#4b5563_5px,#4b5563_10px)] animate-move-right"></div>
            </div>

            <div class="flex flex-col items-center z-10">
                <label class="text-[10px] font-bold text-brand-green uppercase mb-1">Sa√≠da</label>
                <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center font-black text-3xl text-white border-4 border-green-600 shadow-[0_0_15px_rgba(34,197,94,0.6)] transition-all transform scale-100" id="output-slot">
                    5
                </div>
            </div>

        </div>

        <div class="bg-gray-900 p-3 rounded-lg border border-gray-700 text-center font-mono text-green-400 text-sm">
            C√°lculo: 2 ¬∑ <span id="calc-x" class="text-white font-bold">${xVal}</span> + 1 = <span id="calc-res" class="font-bold">5</span>
        </div>

    </div>

    <style>
        @keyframes moveRight { from { background-position: 0 0; } to { background-position: 20px 0; } }
        .animate-move-right { animation: moveRight 1s linear infinite; }
    </style>
    `;

                    const inputSlot = container.querySelector("#input-slot");
                    const outputSlot = container.querySelector("#output-slot");
                    const calcX = container.querySelector("#calc-x");
                    const calcRes = container.querySelector("#calc-res");

                    const update = () => {
                        inputSlot.innerText = xVal;
                        calcX.innerText = xVal;

                        // Anima√ß√£o de processamento
                        outputSlot.classList.remove("scale-110", "bg-green-400");
                        outputSlot.classList.add(
                            "scale-90",
                            "bg-green-700",
                            "opacity-50"
                        );

                        setTimeout(() => {
                            const res = 2 * xVal + 1;
                            outputSlot.innerText = res;
                            calcRes.innerText = res;

                            outputSlot.classList.remove(
                                "scale-90",
                                "bg-green-700",
                                "opacity-50"
                            );
                            outputSlot.classList.add("scale-110", "bg-green-400");
                        }, 300);
                    };

                    container.querySelector("#btn-dec-x").onclick = () => {
                        xVal--;
                        update();
                    };
                    container.querySelector("#btn-inc-x").onclick = () => {
                        xVal++;
                        update();
                    };

                    update();
                },

                interactive_key_tester(container) {
                    const equation = (x) => 2 * x - 4;
                    const target = 6;
                    const correctKey = 5; // 2*5 - 4 = 6

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="mb-6 text-center">
            <div class="text-4xl mb-2">üîí</div>
            <div class="text-2xl font-mono font-black text-gray-700 bg-gray-100 px-4 py-2 rounded-lg border border-gray-300">
                2x - 4 = <span class="text-brand-red">${target}</span>
            </div>
        </div>

        <p class="text-xs font-bold text-gray-400 uppercase mb-2">Escolha uma chave (Valor de X):</p>
        
        <div class="flex flex-wrap justify-center gap-3 mb-6">
            ${[3, 4, 5, 6, 7]
                            .map(
                                (k) => `
                <button class="key-btn w-12 h-16 bg-yellow-100 border-b-4 border-yellow-400 rounded-lg flex flex-col items-center justify-center hover:bg-yellow-200 active:scale-95 transition-all shadow-sm group" data-val="${k}">
                    <div class="w-3 h-3 rounded-full bg-white border border-yellow-300 mb-1"></div>
                    <span class="font-black text-yellow-800 text-lg group-hover:scale-110 transition-transform">${k}</span>
                    <span class="text-[8px] text-yellow-600 mt-1">üîë</span>
                </button>
            `
                            )
                            .join("")}
        </div>

        <div id="key-feedback" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-4 min-h-[80px] flex flex-col items-center justify-center text-center transition-all">
            <span class="text-gray-400 text-sm italic">Teste uma chave para ver o c√°lculo.</span>
        </div>

    </div>
    `;

                    const feedback = container.querySelector("#key-feedback");
                    const btns = container.querySelectorAll(".key-btn");

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            const val = parseInt(btn.dataset.val);
                            const res = equation(val);
                            const isCorrect = res === target;

                            // Reset visual
                            btns.forEach((b) => b.classList.remove("opacity-50"));
                            btn.classList.add("opacity-100"); // Mant√©m ativo

                            if (isCorrect) {
                                feedback.className =
                                    "w-full bg-green-50 border border-green-200 rounded-xl p-4 min-h-[80px] flex flex-col items-center justify-center text-center transition-all animate-pop-in";
                                feedback.innerHTML = `
                    <div class="text-green-600 font-bold text-lg mb-1"><i class="fas fa-lock-open"></i> ABERTO!</div>
                    <div class="text-sm font-mono text-green-800">2(${val}) - 4 = <strong>${res}</strong></div>
                    <div class="text-xs text-green-600 mt-1">Logo, <strong>S = {${val}}</strong></div>
                `;
                            } else {
                                feedback.className =
                                    "w-full bg-red-50 border border-red-200 rounded-xl p-4 min-h-[80px] flex flex-col items-center justify-center text-center transition-all animate-shake";
                                feedback.innerHTML = `
                    <div class="text-red-500 font-bold text-lg mb-1"><i class="fas fa-times-circle"></i> FALHOU</div>
                    <div class="text-sm font-mono text-red-800">2(${val}) - 4 = <strong>${res}</strong></div>
                    <div class="text-xs text-red-500 mt-1">Precisamos de ${target}.</div>
                `;
                            }
                        };
                    });
                },

                interactive_balance_gym(container) {
                    let leftWeight = 10; // X + 5
                    let rightWeight = 10; // 10
                    let userX = 5; // X impl√≠cito
                    let isBalanced = true;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Academia de Equa√ß√µes</h3>

        <div class="relative w-64 h-32 mb-8">
            <div id="balance-beam" class="absolute top-1/2 left-0 w-full h-2 bg-gray-700 rounded-full transition-transform duration-500 origin-center" style="transform: rotate(0deg)"></div>
            <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-4 h-16 bg-gray-400"></div>
            <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-20 h-2 bg-gray-400 rounded-full"></div>
            
            <div id="plate-left" class="absolute top-0 left-0 w-24 h-24 flex flex-col justify-end items-center transition-transform duration-500" style="transform: translateY(0px)">
                <div class="w-16 h-16 bg-blue-100 border-2 border-brand-blue rounded-lg flex items-center justify-center font-bold text-brand-blue shadow-sm mb-1">X + 5</div>
                <div class="w-20 h-1 bg-gray-700"></div>
                <div class="w-0.5 h-16 bg-gray-400"></div>
            </div>

            <div id="plate-right" class="absolute top-0 right-0 w-24 h-24 flex flex-col justify-end items-center transition-transform duration-500" style="transform: translateY(0px)">
                <div class="w-16 h-16 bg-gray-100 border-2 border-gray-400 rounded-lg flex items-center justify-center font-bold text-gray-600 shadow-sm mb-1">10</div>
                <div class="w-20 h-1 bg-gray-700"></div>
                <div class="w-0.5 h-16 bg-gray-400"></div>
            </div>
        </div>

        <div class="flex gap-4 w-full justify-center">
            <button class="gym-btn bg-red-100 text-red-600 font-bold py-2 px-4 rounded-lg border-b-4 border-red-300 active:scale-95 active:border-b-0 transition-all" data-op="-5">
                Tirar 5kg
            </button>
            <button class="gym-btn bg-green-100 text-green-600 font-bold py-2 px-4 rounded-lg border-b-4 border-green-300 active:scale-95 active:border-b-0 transition-all" data-op="+5">
                P√¥r 5kg
            </button>
        </div>

        <p class="text-xs text-gray-400 mt-4 text-center italic" id="bal-status">A balan√ßa est√° equilibrada.</p>
        <button id="btn-reset-bal" class="text-xs font-bold text-brand-blue underline mt-2 hidden">Reiniciar</button>

    </div>
    `;

                    const beam = container.querySelector("#balance-beam");
                    const pLeft = container.querySelector("#plate-left");
                    const pRight = container.querySelector("#plate-right");
                    const status = container.querySelector("#bal-status");
                    const btnReset = container.querySelector("#btn-reset-bal");
                    const btns = container.querySelectorAll(".gym-btn");

                    // Estado interno visual
                    let lVal = 10;
                    let rVal = 10;

                    const updateBalance = () => {
                        const diff = lVal - rVal;

                        let rot = 0;
                        let yL = 0;
                        let yR = 0;

                        if (diff > 0) {
                            rot = -15; // Esquerda pesa mais -> gira anti-hor√°rio
                            yL = 10;
                            yR = -10;
                            status.innerHTML = `<span class="text-red-500">DESEQUILIBRADO!</span> Esquerda mais pesada.`;
                        } else if (diff < 0) {
                            rot = 15;
                            yL = -10;
                            yR = 10;
                            status.innerHTML = `<span class="text-red-500">DESEQUILIBRADO!</span> Direita mais pesada.`;
                        } else {
                            rot = 0;
                            status.innerHTML = `<span class="text-green-500">EQUILIBRADO!</span> Perfeito.`;

                            // Se chegou na solu√ß√£o (X = 5)
                            if (lVal === 5 && rVal === 5) {
                                status.innerHTML = `<span class="text-brand-green font-black text-lg">PARAB√âNS! X = 5</span>`;
                            }
                        }

                        beam.style.transform = `rotate(${rot}deg)`;
                        pLeft.style.transform = `translateY(${yL}px)`;
                        pRight.style.transform = `translateY(${yR}px)`;
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            const op = parseInt(btn.dataset.op);
                            // Aplica a opera√ß√£o EM AMBOS OS LADOS (O usu√°rio deve aprender a clicar duas vezes ou o bot√£o aplica nos dois?
                            // Para ensinar o princ√≠pio, vamos fazer o usu√°rio aplicar em UM lado por vez clicando em "Esq" ou "Dir" seria ideal,
                            // mas para simplificar a UI mobile, vamos fazer o bot√£o aplicar a AMBOS e mostrar o sucesso,
                            // OU melhor: Bot√µes separados para "Lado Esq" e "Lado Dir".

                            // Vamos mudar a estrat√©gia: Bot√µes aplicam a AMBOS para mostrar o sucesso da regra,
                            // ou bot√µes aplicam a UM lado e quebram a balan√ßa?
                            // Vamos fazer o bot√£o aplicar a AMBOS e mostrar que o equil√≠brio se mant√©m.
                            // MAS o objetivo √© isolar o X. Ent√£o o usu√°rio tem que escolher a opera√ß√£o certa (-5).

                            // Se o usu√°rio escolher +5: (x+10) = 15. Equilibra mas n√£o resolve.
                            // Se escolher -5: (x) = 5. Resolve.

                            lVal += op;
                            rVal += op;

                            // Atualiza visual dos n√∫meros
                            const lText =
                                lVal === 5
                                    ? "X"
                                    : lVal > 5
                                        ? `X + ${lVal - 5}`
                                        : `X - ${5 - lVal}`;
                            pLeft.querySelector(".font-bold").innerText = lText;
                            pRight.querySelector(".font-bold").innerText = rVal;

                            updateBalance();
                            btnReset.classList.remove("hidden");
                        };
                    });

                    btnReset.onclick = () => {
                        lVal = 10;
                        rVal = 10;
                        pLeft.querySelector(".font-bold").innerText = "X + 5";
                        pRight.querySelector(".font-bold").innerText = "10";
                        updateBalance();
                        btnReset.classList.add("hidden");
                    };
                },

                interactive_archer_distributive(container) {
                    const problems = [
                        { exp: "2(x + 4)", ans: "2x + 8" },
                        { exp: "3(x - 2)", ans: "3x - 6" },
                        { exp: "5(2x + 1)", ans: "10x + 5" },
                        { exp: "-2(x + 3)", ans: "-2x - 6" },
                    ];

                    let current = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[350px]">
        
        <div class="absolute top-4 left-4 text-white font-bold text-xs uppercase bg-gray-800 px-3 py-1 rounded-full border border-gray-600">Alvo <span id="arch-lvl">1</span>/4</div>
        <div class="absolute top-4 right-4 text-brand-yellow font-black text-xl">PTS: <span id="arch-score">0</span></div>

        <div class="mt-12 mb-8 relative">
            <div class="text-4xl font-mono font-black text-white bg-gray-800 px-6 py-3 rounded-xl border-2 border-gray-500 shadow-[0_0_15px_rgba(255,255,255,0.2)]" id="arch-q">
                ...
            </div>
            <div class="absolute -left-12 top-1/2 text-2xl text-brand-green animate-pulse">üèπ</div>
        </div>

        <p class="text-gray-400 text-xs font-bold uppercase mb-4">Escolha o disparo correto:</p>

        <div class="grid grid-cols-1 gap-3 w-full max-w-xs" id="arch-opts">
        </div>

        <div id="arch-feedback" class="absolute inset-0 bg-black/90 z-20 hidden flex-col items-center justify-center">
            <div class="text-6xl mb-4" id="fb-icon">üéØ</div>
            <h3 class="text-2xl font-black text-white mb-2" id="fb-title">Na Mosca!</h3>
            <button id="btn-next-arch" class="mt-4 bg-brand-green text-white font-bold py-2 px-8 rounded-full shadow-lg">Pr√≥ximo</button>
        </div>

    </div>
    `;

                    const qEl = container.querySelector("#arch-q");
                    const optsEl = container.querySelector("#arch-opts");
                    const scoreEl = container.querySelector("#arch-score");
                    const lvlEl = container.querySelector("#arch-lvl");
                    const feedback = container.querySelector("#arch-feedback");
                    const fbIcon = container.querySelector("#fb-icon");
                    const fbTitle = container.querySelector("#fb-title");
                    const btnNext = container.querySelector("#btn-next-arch");

                    const loadLevel = () => {
                        if (current >= problems.length) {
                            container.innerHTML = `
                <div class="bg-green-600 border-4 border-green-800 rounded-xl p-8 text-center w-full text-white">
                    <div class="text-6xl mb-4">üèπ</div>
                    <h3 class="text-2xl font-black">Mestre Arqueiro!</h3>
                    <p class="mt-2 font-bold">Voc√™ dominou a distributiva.</p>
                </div>
            `;
                            return;
                        }

                        const p = problems[current];
                        qEl.innerText = p.exp;
                        lvlEl.innerText = current + 1;
                        feedback.classList.add("hidden");

                        // Gera op√ß√µes erradas inteligentes
                        let options = [p.ans];
                        // Erro comum: multiplicar s√≥ o primeiro (2x + 4)
                        const parts = p.exp.match(/(-?\d+)\((.*)\)/);
                        if (parts) {
                            const num = parseInt(parts[1]);
                            const content = parts[2]; // x + 4
                            options.push(`${num}x + ${content.split(" ")[2]}`); // Erro: 2x + 4
                            options.push(
                                `${num}x + ${parseInt(content.split(" ")[2]) + num}`
                            ); // Erro: Soma (2x + 6)
                        }

                        // Completa com gen√©ricos
                        while (options.length < 3) options.push("Erro " + Math.random());
                        options = options.slice(0, 3).sort(() => Math.random() - 0.5);

                        optsEl.innerHTML = "";
                        options.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "w-full bg-gray-700 hover:bg-gray-600 border-l-4 border-brand-blue text-white font-mono font-bold text-lg py-3 rounded-r-xl text-left px-4 transition-all active:scale-95";
                            btn.innerText = opt;
                            btn.onclick = () => check(opt, p.ans);
                            optsEl.appendChild(btn);
                        });
                    };

                    const check = (val, correct) => {
                        if (val === correct) {
                            score += 100;
                            scoreEl.innerText = score;
                            fbIcon.innerText = "üéØ";
                            fbTitle.innerText = "NA MOSCA!";
                            fbTitle.className = "text-2xl font-black text-brand-green mb-2";
                        } else {
                            fbIcon.innerText = "üí®";
                            fbTitle.innerText = "ERROU...";
                            fbTitle.className = "text-2xl font-black text-brand-red mb-2";
                        }
                        feedback.classList.remove("hidden");
                    };

                    btnNext.onclick = () => {
                        current++;
                        loadLevel();
                    };

                    loadLevel();
                },

                interactive_fraction_crusher(container) {
                    // Equa√ß√£o: x/2 + x/3 = 10
                    // MMC: 6

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden relative">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-6">Esmagador de Denominadores</h3>

        <div class="text-2xl md:text-3xl font-mono font-black text-gray-700 mb-8 flex items-center gap-2 transition-all" id="eq-display">
            <div class="flex flex-col items-center">
                <span>x</span>
                <div class="w-full h-1 bg-gray-700"></div>
                <span class="text-brand-blue" id="den-1">2</span>
            </div>
            <span>+</span>
            <div class="flex flex-col items-center">
                <span>x</span>
                <div class="w-full h-1 bg-gray-700"></div>
                <span class="text-brand-orange" id="den-2">3</span>
            </div>
            <span>= 10</span>
        </div>

        <p class="text-xs font-bold text-gray-400 mb-2 uppercase text-center">Multiplicar tudo por:</p>

        <div class="flex gap-3 w-full justify-center mb-4">
            <button class="crush-btn w-12 h-12 rounded-full bg-gray-100 border-2 border-gray-300 text-gray-600 font-black text-xl hover:bg-brand-red hover:text-white hover:border-red-600 transition-all shadow-sm" data-val="2">2</button>
            <button class="crush-btn w-12 h-12 rounded-full bg-gray-100 border-2 border-gray-300 text-gray-600 font-black text-xl hover:bg-brand-red hover:text-white hover:border-red-600 transition-all shadow-sm" data-val="3">3</button>
            <button class="crush-btn w-12 h-12 rounded-full bg-gray-100 border-2 border-gray-300 text-gray-600 font-black text-xl hover:bg-brand-green hover:text-white hover:border-green-600 transition-all shadow-sm" data-val="6">6</button>
            <button class="crush-btn w-12 h-12 rounded-full bg-gray-100 border-2 border-gray-300 text-gray-600 font-black text-xl hover:bg-brand-red hover:text-white hover:border-red-600 transition-all shadow-sm" data-val="12">12</button>
        </div>

        <div id="crush-feedback" class="h-10 text-sm font-bold text-center"></div>

        <div id="hammer" class="absolute top-0 right-0 text-6xl transform rotate-45 opacity-0 pointer-events-none transition-all duration-300">üî®</div>

    </div>
    `;

                    const display = container.querySelector("#eq-display");
                    const feedback = container.querySelector("#crush-feedback");
                    const hammer = container.querySelector("#hammer");
                    const btns = container.querySelectorAll(".crush-btn");

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            const val = parseInt(btn.dataset.val);

                            if (val === 6) {
                                // MMC Correto
                                // Anima√ß√£o do Martelo
                                hammer.style.opacity = "1";
                                hammer.style.top = "30%";
                                hammer.style.right = "40%";
                                hammer.classList.add("animate-swing"); // Definir no CSS global ou inline

                                setTimeout(() => {
                                    // Efeito de esmagamento
                                    display.classList.add("scale-110");
                                    display.innerHTML = `<span class="text-brand-green">3x + 2x = 60</span>`;
                                    feedback.innerHTML = `<span class="text-green-600">BOOM! Fra√ß√µes eliminadas. (MMC = 6)</span>`;
                                    hammer.style.opacity = "0";

                                    // Trava bot√µes
                                    btns.forEach((b) => (b.disabled = true));
                                }, 400);
                            } else {
                                feedback.innerHTML = `<span class="text-red-500">Isso n√£o elimina todos os denominadores. Tente o MMC!</span>`;
                                btn.classList.add("opacity-50", "cursor-not-allowed");
                            }
                        };
                    });

                    // CSS Inline para swing do martelo
                    if (!document.getElementById("anim-swing")) {
                        const s = document.createElement("style");
                        s.id = "anim-swing";
                        s.innerHTML = `@keyframes swing { 0% { transform: rotate(45deg); } 50% { transform: rotate(-45deg); } 100% { transform: rotate(45deg); } } .animate-swing { animation: swing 0.3s ease-in-out; }`;
                        container.appendChild(s);
                    }
                },

                interactive_detective_rpg(container) {
                    const cases = [
                        {
                            story:
                                "A soma de um n√∫mero com seu dobro √© 30. Quem √© o n√∫mero?",
                            opts: ["x + 2 = 30", "x + 2x = 30", "x . 2x = 30"],
                            correctIdx: 1,
                            solution: "10",
                        },
                        {
                            story: "O triplo de um n√∫mero menos 5 √© igual a 16.",
                            opts: ["3x - 5 = 16", "3(x - 5) = 16", "x^3 - 5 = 16"],
                            correctIdx: 0,
                            solution: "7",
                        },
                    ];

                    let current = 0;

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-400 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex items-center gap-3 w-full mb-4 bg-white p-3 rounded-lg shadow-sm border-l-4 border-brand-blue">
            <div class="text-3xl">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
            <div>
                <h4 class="font-bold text-gray-800 text-xs uppercase">Caso #${current + 1
                        }</h4>
                <p class="text-sm font-medium text-gray-600 leading-tight" id="case-story">...</p>
            </div>
        </div>

        <p class="text-xs font-bold text-gray-400 uppercase mb-2 text-center w-full">Qual a equa√ß√£o correta?</p>

        <div class="flex flex-col gap-2 w-full" id="rpg-opts">
        </div>

        <div id="rpg-feedback" class="mt-4 w-full bg-gray-800 text-green-400 font-mono p-3 rounded-lg hidden text-center border-2 border-green-500">
            SOLU√á√ÉO ENCONTRADA!<br>x = <span id="rpg-sol">?</span>
        </div>

        <button id="btn-next-case" class="mt-4 bg-brand-blue text-white font-bold py-2 px-6 rounded-lg shadow-btn w-full hidden">Pr√≥ximo Caso</button>

    </div>
    `;

                    const storyEl = container.querySelector("#case-story");
                    const optsEl = container.querySelector("#rpg-opts");
                    const feedback = container.querySelector("#rpg-feedback");
                    const solEl = container.querySelector("#rpg-sol");
                    const btnNext = container.querySelector("#btn-next-case");

                    const loadCase = () => {
                        if (current >= cases.length) {
                            container.innerHTML = `<div class="p-6 text-center text-gray-500 font-bold">Todos os casos resolvidos! üéñÔ∏è</div>`;
                            return;
                        }

                        const c = cases[current];
                        storyEl.innerText = c.story;
                        feedback.classList.add("hidden");
                        btnNext.classList.add("hidden");

                        optsEl.innerHTML = "";
                        c.opts.forEach((opt, idx) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "w-full bg-white border-2 border-gray-300 text-gray-600 font-mono font-bold py-3 rounded-xl hover:border-brand-blue hover:text-brand-blue transition-all text-lg";
                            btn.innerText = opt;
                            btn.onclick = () => check(idx, btn);
                            optsEl.appendChild(btn);
                        });
                    };

                    const check = (idx, btn) => {
                        const c = cases[current];

                        // Bloqueia
                        Array.from(optsEl.children).forEach((b) => {
                            b.disabled = true;
                            b.classList.add("opacity-50");
                        });
                        btn.classList.remove("opacity-50");

                        if (idx === c.correctIdx) {
                            btn.classList.replace("border-gray-300", "border-green-500");
                            btn.classList.replace("text-gray-600", "text-green-600");
                            btn.classList.add("bg-green-50");

                            solEl.innerText = c.solution;
                            feedback.classList.remove("hidden");
                            feedback.classList.add("animate-pop-in");

                            btnNext.classList.remove("hidden");
                        } else {
                            btn.classList.replace("border-gray-300", "border-red-500");
                            btn.classList.replace("text-gray-600", "text-red-600");
                            btn.classList.add("animate-shake");

                            // Permite tentar de novo ap√≥s delay
                            setTimeout(() => {
                                Array.from(optsEl.children).forEach((b) => {
                                    b.disabled = false;
                                    b.classList.remove("opacity-50");
                                });
                                btn.classList.replace("border-red-500", "border-gray-300");
                                btn.classList.replace("text-red-600", "text-gray-600");
                                btn.classList.remove("animate-shake");
                            }, 1000);
                        }
                    };

                    btnNext.onclick = () => {
                        current++;
                        loadCase();
                    };

                    loadCase();
                },

                interactive_equation_steps(container) {
                    // 1. Estilos CSS para a anima√ß√£o espec√≠fica deste widget
                    const style = document.createElement("style");
                    style.innerHTML = `
        @keyframes jumpOver {
            0% { transform: translate(0, 0); color: #1CB0F6; }
            40% { transform: translate(0, -40px) scale(1.1); color: #1CB0F6; }
            50% { transform: translate(60px, -40px) scale(1.1); color: #FF4B4B; } /* Troca de cor no ar */
            100% { transform: translate(120px, 0) scale(1); color: #FF4B4B; }
        }
        .animate-jump { animation: jumpOver 1.2s forwards ease-in-out; }
        .fade-out { opacity: 0; pointer-events: none; transition: opacity 0.5s; }
        .fade-in { opacity: 1; transition: opacity 0.5s; }
    `;
                    container.appendChild(style);

                    // 2. HTML Estrutural
                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none h-[320px] relative overflow-hidden">
        
        <h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-8">Resolvendo: 2x + 4 = 10</h3>

        <div class="relative flex items-center justify-center gap-4 text-4xl md:text-5xl font-mono font-bold text-brand-text w-full mb-8">
            <div class="flex gap-4 relative" id="lhs">
                <span class="text-brand-purple transition-all duration-500" id="term-x">2x</span>
                <span id="term-num" class="text-brand-blue inline-block relative z-10">+ 4</span>
            </div>

            <span class="text-gray-300">=</span>

            <div class="flex gap-4 relative" id="rhs">
                <span id="term-res">10</span>
                <span id="landing-spot" class="text-brand-red opacity-0 w-0 transition-all duration-500">- 4</span> 
            </div>
        </div>

        <div id="control-panel" class="w-full max-w-xs text-center transition-all duration-500 absolute bottom-6">
            <p class="text-sm text-gray-500 mb-4 font-medium" id="instruction">
                O <strong class="text-brand-blue">+4</strong> est√° somando. Para deixar o <strong>2x</strong> sozinho, o que fazemos?
            </p>
            
            <div class="grid grid-cols-2 gap-3">
                <button class="action-btn bg-white border-2 border-gray-200 text-gray-400 font-bold py-3 rounded-xl hover:bg-red-50 hover:border-red-200 hover:text-red-400 transition-all" onclick="app.widgets.shakeEq(this)">
                    + 4
                </button>
                <button id="btn-correct" class="action-btn bg-brand-blue text-white font-bold py-3 rounded-xl shadow-[0_4px_0_#1899D6] active:shadow-none active:translate-y-[4px] transition-all border-b-4 border-brand-blueDark">
                    - 4 (Inverso)
                </button>
            </div>
        </div>

        <div id="success-msg" class="absolute bottom-6 flex-col items-center translate-y-20 opacity-0 transition-all duration-500 flex">
            <div class="text-brand-green font-black text-3xl mb-2 bg-green-50 px-6 py-2 rounded-xl border-2 border-brand-green">x = 3</div>
            <button onclick="app.renderLesson(document.getElementById('main-container'), 'Resolu√ß√£o de Equa√ß√µes Simples (ax + b = c)')" class="text-xs text-gray-400 font-bold uppercase hover:text-brand-blue flex items-center gap-2 mt-2 p-2">
                <i class="fas fa-undo"></i> Reiniciar
            </button>
        </div>

    </div>
    `;

                    // 3. Seletores e L√≥gica
                    const termNum = container.querySelector("#term-num");
                    const termX = container.querySelector("#term-x"); // Para centralizar depois
                    const termRes = container.querySelector("#term-res");
                    const landingSpot = container.querySelector("#landing-spot");
                    const btnCorrect = container.querySelector("#btn-correct");
                    const controlPanel = container.querySelector("#control-panel");
                    const successMsg = container.querySelector("#success-msg");
                    const instruction = container.querySelector("#instruction");

                    // Fun√ß√£o de Erro (Tremida) - Adicionada ao escopo do app para ser acessada pelo onclick inline se necess√°rio, ou via closure aqui
                    app.widgets.shakeEq = (btn) => {
                        btn.classList.add(
                            "animate-pulse",
                            "bg-red-100",
                            "border-red-300"
                        );
                        setTimeout(
                            () =>
                                btn.classList.remove(
                                    "animate-pulse",
                                    "bg-red-100",
                                    "border-red-300"
                                ),
                            500
                        );
                        instruction.innerHTML =
                            "<span class='text-brand-red'>N√£o!</span> Se ele est√° somando, somar mais vai piorar!";
                    };

                    // Fun√ß√£o Principal: A Anima√ß√£o
                    btnCorrect.onclick = async () => {
                        // 1. Bloqueia bot√µes
                        btnCorrect.disabled = true;

                        // 2. Anima√ß√£o do Pulo
                        // O CSS keyframe 'jumpOver' cuida do movimento e da troca de cor
                        termNum.classList.add("animate-jump");

                        // 3. Espera a anima√ß√£o (1.2s)
                        await new Promise((r) => setTimeout(r, 1200));

                        // 4. Ajuste do Layout p√≥s-pulo
                        termNum.classList.add("hidden"); // Esconde o original que voou
                        landingSpot.classList.remove("opacity-0", "w-0"); // Mostra o novo no lugar certo

                        // Centraliza o X visualmente (opcional, mas fica bonito)
                        // termX.classList.add('translate-x-8');

                        // 5. Fase de C√°lculo
                        instruction.innerText =
                            "Agora resolva: 10 - 4 = 6. E divida por 2.";

                        // Troca os bot√µes por "Calcular"
                        controlPanel.innerHTML = `
            <button class="bg-brand-green text-white font-bold py-3 px-8 rounded-xl shadow-[0_4px_0_#46A302] active:shadow-none active:translate-y-[4px] text-xl w-full animate-pop-in" id="btn-calc">
                Calcular Final
            </button>
        `;

                        const btnCalc = container.querySelector("#btn-calc");

                        btnCalc.onclick = () => {
                            // 6. Finaliza√ß√£o
                            controlPanel.classList.add("opacity-0", "translate-y-10"); // Esconde painel
                            landingSpot.classList.add("hidden"); // Some o -4
                            termRes.classList.add("hidden"); // Some o 10

                            // Aqui seria legal mostrar a divis√£o visual, mas para simplificar vamos ao resultado
                            termX.innerHTML = "x";

                            successMsg.classList.remove("translate-y-20", "opacity-0"); // Sobe o sucesso
                        };
                    };
                },

                interactive_equation_safe_cracker(container) {
                    // Configura√ß√£o dos N√≠veis (Equa√ß√µes geradas: ax + b = c)
                    const levels = [
                        { a: 2, b: 4, c: 14, ans: 5 }, // 2x + 4 = 14 -> 2x=10 -> x=5
                        { a: 3, b: -2, c: 10, ans: 4 }, // 3x - 2 = 10 -> 3x=12 -> x=4
                        { a: 5, b: 5, c: 30, ans: 5 }, // 5x + 5 = 30 -> 5x=25 -> x=5
                        { a: 4, b: 0, c: 20, ans: 5 }, // 4x = 20 -> x=5 (b=0)
                        { a: 1, b: 7, c: 10, ans: 3 }, // x + 7 = 10 -> x=3
                    ];

                    let currentLvl = 0;
                    let score = 0;
                    let inputVal = "";

                    container.innerHTML = `
    <div class="bg-gray-800 border-4 border-gray-600 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[450px]">
        
        <div class="flex justify-between w-full text-white mb-6 z-10">
            <h3 class="font-black uppercase text-xs tracking-widest text-gray-400">Cofre de Seguran√ßa</h3>
            <div class="bg-gray-700 px-3 py-1 rounded-full text-xs font-black text-brand-yellow">Pontos: <span id="safe-score">0</span></div>
        </div>

        <div class="bg-black border-4 border-gray-500 rounded-lg p-4 mb-6 w-full text-center relative shadow-[inset_0_0_20px_rgba(0,0,0,1)]">
            <p class="text-xs text-green-500 font-mono mb-1 uppercase">Senha Requerida</p>
            <div id="equation-display" class="font-mono text-3xl md:text-4xl text-white font-bold tracking-wider animate-pulse">
                ...
            </div>
            
            <div class="mt-4 flex gap-2 justify-center">
                <div class="w-12 h-12 bg-gray-900 border border-gray-600 rounded flex items-center justify-center text-green-400 font-mono text-2xl font-bold" id="display-input">_</div>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-3 w-full max-w-[240px] z-10">
            ${[1, 2, 3, 4, 5, 6, 7, 8, 9]
                            .map(
                                (n) =>
                                    `<button class="safe-btn bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded shadow-sm border-b-4 border-gray-900 active:border-b-0 active:translate-y-1 transition-all text-xl">${n}</button>`
                            )
                            .join("")}
            
            <button class="bg-red-900 hover:bg-red-800 text-white font-bold py-3 rounded border-b-4 border-black active:border-b-0 active:translate-y-1 text-xs" id="btn-del">DEL</button>
            <button class="safe-btn bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded border-b-4 border-gray-900 active:border-b-0 active:translate-y-1 text-xl">0</button>
            <button class="bg-green-700 hover:bg-green-600 text-white font-bold py-3 rounded border-b-4 border-black active:border-b-0 active:translate-y-1 text-xs" id="btn-enter">OK</button>
        </div>

        <div id="safe-feedback" class="absolute inset-0 bg-green-500 flex flex-col items-center justify-center z-30 hidden transition-all">
            <div class="text-6xl mb-4 text-white animate-bounce">üîì</div>
            <h3 class="text-white font-black text-2xl">ABERTO!</h3>
        </div>
        
        <div id="safe-error" class="absolute inset-0 bg-red-600/90 flex flex-col items-center justify-center z-30 hidden">
            <div class="text-6xl mb-4 text-white animate-shake">üîí</div>
            <h3 class="text-white font-black text-2xl">SENHA ERRADA</h3>
        </div>

    </div>
    `;

                    const display = container.querySelector("#equation-display");
                    const inputDisplay = container.querySelector("#display-input");
                    const scoreEl = container.querySelector("#safe-score");
                    const feedback = container.querySelector("#safe-feedback");
                    const errorScreen = container.querySelector("#safe-error");

                    // Gera equa√ß√£o aleat√≥ria al√©m dos n√≠veis fixos para replay
                    const generateEquation = () => {
                        if (currentLvl < levels.length) return levels[currentLvl];

                        // Gerador procedural simples
                        const ans = Math.floor(Math.random() * 9) + 1; // Resposta 1 a 9
                        const a = Math.floor(Math.random() * 4) + 2; // Coeficiente 2 a 5
                        const b = Math.floor(Math.random() * 10) - 5; // Constante -5 a 5
                        const c = a * ans + b;
                        return { a, b, c, ans };
                    };

                    let currentEq = generateEquation();

                    const renderEquation = () => {
                        // Formata: 2x + 4 = 14 ou 2x - 4 = 14
                        const sign = currentEq.b >= 0 ? "+" : "-";
                        const valB = Math.abs(currentEq.b);
                        const termB = currentEq.b === 0 ? "" : `${sign} ${valB}`;

                        display.innerText = `${currentEq.a}x ${termB} = ${currentEq.c}`;
                        inputVal = "";
                        inputDisplay.innerText = "_";
                    };

                    const updateInput = () => {
                        inputDisplay.innerText = inputVal || "_";
                    };

                    // Listeners do Teclado
                    container.querySelectorAll(".safe-btn").forEach((btn) => {
                        btn.onclick = () => {
                            if (inputVal.length < 2) {
                                // Limita a 2 d√≠gitos
                                inputVal += btn.innerText;
                                updateInput();
                            }
                        };
                    });

                    container.querySelector("#btn-del").onclick = () => {
                        inputVal = inputVal.slice(0, -1);
                        updateInput();
                    };

                    container.querySelector("#btn-enter").onclick = () => {
                        const attempt = parseInt(inputVal);

                        if (attempt === currentEq.ans) {
                            // Sucesso
                            score += 100;
                            scoreEl.innerText = score;
                            feedback.classList.remove("hidden");

                            setTimeout(() => {
                                feedback.classList.add("hidden");
                                currentLvl++;
                                currentEq = generateEquation();
                                renderEquation();
                            }, 1500);
                        } else {
                            // Erro
                            errorScreen.classList.remove("hidden");
                            setTimeout(() => {
                                errorScreen.classList.add("hidden");
                                inputVal = "";
                                updateInput();
                            }, 1000);
                        }
                    };

                    // Inicia
                    renderEquation();
                },

                interactive_inequality_signs(container) {
                    let n1 = 5;
                    let n2 = 3;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-green font-bold uppercase text-xs tracking-widest mb-6">Comparador Visual</h3>
        
        <div class="flex items-center gap-4 mb-8 text-4xl font-black text-gray-700">
            <span id="val-1" class="transition-all">5</span>
            
            <div class="w-20 h-20 flex items-center justify-center bg-gray-100 rounded-xl border-4 border-gray-200 transition-all duration-300 transform hover:scale-110" id="sign-box">
                <span id="sign-display" class="text-brand-blue text-5xl">></span>
            </div>
            
            <span id="val-2" class="transition-all">3</span>
        </div>

        <div class="flex flex-col gap-4 w-full max-w-xs">
            <div class="flex items-center gap-2">
                <span class="text-xs font-bold text-gray-400 w-8">Esq</span>
                <input type="range" id="range-1" min="-10" max="10" value="5" class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-gray-600">
            </div>
            <div class="flex items-center gap-2">
                <span class="text-xs font-bold text-gray-400 w-8">Dir</span>
                <input type="range" id="range-2" min="-10" max="10" value="3" class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-gray-600">
            </div>
        </div>

        <p class="text-center text-xs text-gray-400 mt-6 italic" id="gator-text">
            O jacar√© come o 5 porque √© maior!
        </p>
    </div>
    `;

                    const r1 = container.querySelector("#range-1");
                    const r2 = container.querySelector("#range-2");
                    const v1 = container.querySelector("#val-1");
                    const v2 = container.querySelector("#val-2");
                    const signBox = container.querySelector("#sign-box");
                    const signDisplay = container.querySelector("#sign-display");
                    const text = container.querySelector("#gator-text");

                    const update = () => {
                        n1 = parseInt(r1.value);
                        n2 = parseInt(r2.value);

                        v1.innerText = n1;
                        v2.innerText = n2;

                        // Visual Feedback
                        v1.style.transform = `scale(${1 + (n1 - n2) / 20})`; // Leve zoom no maior
                        v2.style.transform = `scale(${1 + (n2 - n1) / 20})`;

                        if (n1 > n2) {
                            signDisplay.innerText = ">";
                            signDisplay.className =
                                "text-brand-blue text-5xl animate-pop-in";
                            signBox.className =
                                "w-20 h-20 flex items-center justify-center bg-blue-50 rounded-xl border-4 border-brand-blue shadow-md transition-all";
                            text.innerHTML = `O jacar√© come o <strong>${n1}</strong>!`;
                        } else if (n1 < n2) {
                            signDisplay.innerText = "<";
                            signDisplay.className =
                                "text-brand-orange text-5xl animate-pop-in";
                            signBox.className =
                                "w-20 h-20 flex items-center justify-center bg-orange-50 rounded-xl border-4 border-brand-orange shadow-md transition-all";
                            text.innerHTML = `O jacar√© come o <strong>${n2}</strong>!`;
                        } else {
                            signDisplay.innerText = "=";
                            signDisplay.className = "text-gray-400 text-5xl animate-pop-in";
                            signBox.className =
                                "w-20 h-20 flex items-center justify-center bg-gray-50 rounded-xl border-4 border-gray-300 shadow-inner transition-all";
                            text.innerHTML = `Eles s√£o iguais! O jacar√© fica confuso. üòµ`;
                        }
                    };

                    r1.oninput = update;
                    r2.oninput = update;
                    update();
                },

                interactive_sign_ninja(container) {
                    let score = 0;
                    let timeLeft = 30;
                    let timer = null;
                    let currentPair = { a: 0, b: 0 };
                    let isPlaying = false;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[350px]">
        
        <div class="flex justify-between w-full items-center mb-2 z-20">
            <div class="text-white font-bold text-xs uppercase bg-gray-800 px-3 py-1 rounded-full"><i class="fas fa-clock"></i> <span id="ninja-timer">30</span>s</div>
            <div class="text-white font-black text-xl">Pts: <span id="ninja-pts" class="text-brand-yellow">0</span></div>
        </div>

        <div class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-10">
            <i class="fas fa-dragon text-9xl text-white"></i>
        </div>

        <div id="game-stage" class="relative w-full flex-1 flex flex-col items-center justify-center z-10 transition-opacity">
            <div class="flex items-center gap-8 mb-8">
                <div class="text-5xl font-black text-white" id="num-a">?</div>
                <div class="w-16 h-16 bg-gray-800 border-2 border-gray-600 rounded flex items-center justify-center text-3xl font-bold text-gray-500">?</div>
                <div class="text-5xl font-black text-white" id="num-b">?</div>
            </div>

            <div class="grid grid-cols-3 gap-4 w-full max-w-xs">
                <button class="ninja-btn bg-gray-700 hover:bg-gray-600 border-b-4 border-gray-900 text-white font-black text-2xl py-4 rounded-lg active:border-b-0 active:translate-y-1 transition-all" data-s="<"><</button>
                <button class="ninja-btn bg-gray-700 hover:bg-gray-600 border-b-4 border-gray-900 text-white font-black text-2xl py-4 rounded-lg active:border-b-0 active:translate-y-1 transition-all" data-s="=">=</button>
                <button class="ninja-btn bg-gray-700 hover:bg-gray-600 border-b-4 border-gray-900 text-white font-black text-2xl py-4 rounded-lg active:border-b-0 active:translate-y-1 transition-all" data-s=">">></button>
            </div>
        </div>

        <div id="ninja-overlay" class="absolute inset-0 bg-gray-900/95 z-30 flex flex-col items-center justify-center text-center p-6">
            <div class="text-6xl mb-4">ü•∑</div>
            <h3 class="text-2xl font-black text-white mb-2" id="ov-title">Ninja dos Sinais</h3>
            <p class="text-gray-400 text-sm mb-6">Compare os n√∫meros o mais r√°pido poss√≠vel!</p>
            <button id="btn-start-ninja" class="bg-brand-red text-white font-bold py-3 px-10 rounded-full shadow-[0_0_15px_rgba(239,68,68,0.6)] animate-pulse">JOGAR</button>
        </div>
    </div>
    `;

                    const numA = container.querySelector("#num-a");
                    const numB = container.querySelector("#num-b");
                    const timerEl = container.querySelector("#ninja-timer");
                    const scoreEl = container.querySelector("#ninja-pts");
                    const overlay = container.querySelector("#ninja-overlay");
                    const btnStart = container.querySelector("#btn-start-ninja");
                    const ovTitle = container.querySelector("#ov-title");
                    const btns = container.querySelectorAll(".ninja-btn");
                    const stage = container.querySelector("#game-stage");

                    const generateRound = () => {
                        const a = Math.floor(Math.random() * 20) - 10; // -10 a 10
                        const b = Math.floor(Math.random() * 20) - 10;
                        currentPair = { a, b };
                        numA.innerText = a;
                        numB.innerText = b;

                        // Animacaozinha
                        stage.classList.remove("opacity-0");
                        stage.classList.add("animate-pop-in");
                    };

                    const check = (sign) => {
                        if (!isPlaying) return;

                        let correct = "";
                        if (currentPair.a > currentPair.b) correct = ">";
                        else if (currentPair.a < currentPair.b) correct = "<";
                        else correct = "=";

                        if (sign === correct) {
                            score += 10;
                            scoreEl.innerText = score;
                            // Feedback verde sutil
                            container.style.borderColor = "#4ade80";
                            setTimeout(
                                () => (container.style.borderColor = "#374151"),
                                100
                            );
                            generateRound();
                        } else {
                            score = Math.max(0, score - 5);
                            scoreEl.innerText = score;
                            // Shake screen
                            container.classList.add("animate-shake");
                            container.style.borderColor = "#ef4444";
                            setTimeout(() => {
                                container.classList.remove("animate-shake");
                                container.style.borderColor = "#374151";
                            }, 300);
                        }
                    };

                    const gameOver = () => {
                        isPlaying = false;
                        clearInterval(timer);
                        overlay.classList.remove("hidden");
                        ovTitle.innerText = "Fim do Treino!";
                        container.querySelector(
                            "p"
                        ).innerText = `Pontua√ß√£o Final: ${score}`;
                        btnStart.innerText = "Tentar de Novo";
                    };

                    btnStart.onclick = () => {
                        score = 0;
                        timeLeft = 30;
                        scoreEl.innerText = 0;
                        isPlaying = true;
                        overlay.classList.add("hidden");
                        generateRound();

                        timer = setInterval(() => {
                            timeLeft--;
                            timerEl.innerText = timeLeft;
                            if (timeLeft <= 0) gameOver();
                        }, 1000);
                    };

                    btns.forEach((btn) => (btn.onclick = () => check(btn.dataset.s)));
                },

                interactive_inequality_flip(container) {
                    let multiplier = 1;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Multiplicador Inversor</h3>

        <div class="flex items-center justify-center gap-4 mb-8 text-3xl font-black transition-all duration-700" id="ineq-display">
            <span class="text-gray-700" id="flip-a">2</span>
            <span class="text-brand-blue bg-blue-100 px-2 rounded" id="flip-sign">&lt;</span>
            <span class="text-gray-700" id="flip-b">5</span>
        </div>

        <div class="relative w-full max-w-sm h-12 bg-gray-100 rounded-full mb-6 overflow-hidden flex items-center px-2">
            <div class="w-full h-0.5 bg-gray-400 relative">
                <div class="absolute w-0.5 h-3 bg-black left-1/2 top-1/2 -translate-y-1/2"></div> <div id="dot-a" class="absolute w-4 h-4 bg-brand-blue rounded-full top-1/2 -translate-y-1/2 transition-all duration-700" style="left: 60%"></div>
                <div id="dot-b" class="absolute w-4 h-4 bg-brand-orange rounded-full top-1/2 -translate-y-1/2 transition-all duration-700" style="left: 75%"></div>
            </div>
        </div>

        <div class="flex gap-2 w-full max-w-xs">
            <button class="flip-btn flex-1 bg-white border-2 border-green-500 text-green-700 font-bold py-2 rounded-lg hover:bg-green-50" data-m="1">√ó 1 (Positivo)</button>
            <button class="flip-btn flex-1 bg-white border-2 border-red-500 text-red-700 font-bold py-2 rounded-lg hover:bg-red-50" data-m="-1">√ó -1 (Negativo)</button>
        </div>

        <p class="text-center text-xs text-gray-500 mt-4 font-medium" id="flip-feedback">
            Multiplicar por positivo mant√©m a ordem.
        </p>

    </div>
    `;

                    const display = container.querySelector("#ineq-display");
                    const sign = container.querySelector("#flip-sign");
                    const valA = container.querySelector("#flip-a");
                    const valB = container.querySelector("#flip-b");
                    const dotA = container.querySelector("#dot-a");
                    const dotB = container.querySelector("#dot-b");
                    const feedback = container.querySelector("#flip-feedback");
                    const btns = container.querySelectorAll(".flip-btn");

                    const update = () => {
                        // Base values: 2 and 5
                        const a = 2 * multiplier;
                        const b = 5 * multiplier;

                        valA.innerText = a;
                        valB.innerText = b;

                        // Number Line Logic (0 is 50%, range -10 to 10)
                        // pos% = 50 + (val * 5)
                        const posA = 50 + a * 4;
                        const posB = 50 + b * 4;

                        dotA.style.left = `${posA}%`;
                        dotB.style.left = `${posB}%`;

                        // Animation logic
                        if (multiplier === -1) {
                            sign.innerText = ">";
                            sign.className =
                                "text-brand-red bg-red-100 px-2 rounded transform rotate-180 transition-all duration-700"; // rotate simulates flip
                            feedback.innerHTML = `<span class="text-brand-red font-bold">ALERTA!</span> Multiplicou por negativo, o sinal INVERTEU!`;
                            display.classList.add("scale-110");
                        } else {
                            sign.innerText = "<";
                            sign.className =
                                "text-brand-blue bg-blue-100 px-2 rounded transition-all duration-700";
                            feedback.innerHTML = `Multiplicar por positivo mant√©m a ordem.`;
                            display.classList.remove("scale-110");
                        }
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            multiplier = parseInt(btn.dataset.m);
                            update();
                        };
                    });
                },

                interactive_interval_painter(container) {
                    let mode = "greater"; // greater, less
                    let type = "open"; // open, closed
                    let number = 2;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-2">Pintor de Intervalos</h3>
        
        <div class="bg-gray-100 px-6 py-2 rounded-lg border border-gray-200 mb-6">
            <span class="text-gray-500 font-bold mr-2">x</span>
            <span class="text-2xl font-black text-brand-purple" id="int-symbol">></span>
            <span class="text-gray-700 font-bold ml-2" id="int-num">2</span>
        </div>

        <div class="relative w-full h-24 flex items-center justify-center mb-6 overflow-hidden">
            <div class="absolute w-full h-1 bg-gray-300"></div>
            ${[-3, -2, -1, 0, 1, 2, 3, 4, 5]
                            .map(
                                (i) =>
                                    `<div class="absolute top-1/2 -translate-y-1/2 flex flex-col items-center gap-2" style="left: ${50 + (i - number) * 12
                                    }%">
                    <div class="w-0.5 h-3 bg-gray-400"></div>
                    <span class="text-xs text-gray-400 font-mono">${i}</span>
                </div>`
                            )
                            .join("")}

            <div id="paint-line" class="absolute top-1/2 -translate-y-1/2 h-2 bg-brand-purple opacity-80 transition-all duration-300 rounded" style="left: 50%; width: 50%;"></div>
            
            <div id="paint-dot" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 border-4 border-brand-purple bg-white rounded-full z-10 transition-all duration-300"></div>
        </div>

        <div class="grid grid-cols-2 gap-4 w-full max-w-sm">
            <div class="flex flex-col gap-2">
                <span class="text-[10px] font-bold text-gray-400 uppercase">Dire√ß√£o</span>
                <button class="paint-ctrl bg-white border border-gray-200 py-2 rounded font-bold text-brand-blue hover:bg-blue-50 text-sm active" data-cat="dir" data-val="greater">Maior (>)</button>
                <button class="paint-ctrl bg-white border border-gray-200 py-2 rounded font-bold text-gray-500 hover:bg-gray-50 text-sm" data-cat="dir" data-val="less">Menor (<)</button>
            </div>
            <div class="flex flex-col gap-2">
                <span class="text-[10px] font-bold text-gray-400 uppercase">Bolinha</span>
                <button class="paint-ctrl bg-white border border-gray-200 py-2 rounded font-bold text-brand-blue hover:bg-blue-50 text-sm active" data-cat="type" data-val="open">Aberta (‚ö™)</button>
                <button class="paint-ctrl bg-white border border-gray-200 py-2 rounded font-bold text-gray-500 hover:bg-gray-50 text-sm" data-cat="type" data-val="closed">Fechada (‚ö´)</button>
            </div>
        </div>

    </div>
    `;

                    const symbol = container.querySelector("#int-symbol");
                    const line = container.querySelector("#paint-line");
                    const dot = container.querySelector("#paint-dot");
                    const btns = container.querySelectorAll(".paint-ctrl");

                    const update = () => {
                        // Atualiza Simbolo Texto
                        let symStr = "";
                        if (mode === "greater") symStr = type === "open" ? ">" : "‚â•";
                        else symStr = type === "open" ? "<" : "‚â§";
                        symbol.innerText = symStr;

                        // Atualiza Visual
                        // Bolinha
                        if (type === "open") {
                            dot.style.backgroundColor = "white";
                        } else {
                            dot.style.backgroundColor = "#CE82FF"; // brand-purple
                        }

                        // Linha
                        if (mode === "greater") {
                            line.style.left = "50%";
                            line.style.width = "50%"; // Vai at√© o fim da direita
                            line.style.borderTopLeftRadius = "0";
                            line.style.borderBottomLeftRadius = "0";
                            line.style.borderTopRightRadius = "99px";
                            line.style.borderBottomRightRadius = "99px";
                        } else {
                            line.style.left = "0%";
                            line.style.width = "50%"; // Vem do inicio at√© o meio
                            line.style.borderTopLeftRadius = "99px";
                            line.style.borderBottomLeftRadius = "99px";
                            line.style.borderTopRightRadius = "0";
                            line.style.borderBottomRightRadius = "0";
                        }
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            const cat = btn.dataset.cat;
                            const val = btn.dataset.val;

                            // Update State
                            if (cat === "dir") mode = val;
                            if (cat === "type") type = val;

                            // Update UI Buttons
                            container
                                .querySelectorAll(`.paint-ctrl[data-cat="${cat}"]`)
                                .forEach((b) => {
                                    if (b === btn) {
                                        b.classList.add(
                                            "border-brand-purple",
                                            "text-brand-purple",
                                            "bg-purple-50"
                                        );
                                        b.classList.remove(
                                            "border-gray-200",
                                            "text-gray-500",
                                            "bg-white"
                                        );
                                    } else {
                                        b.classList.remove(
                                            "border-brand-purple",
                                            "text-brand-purple",
                                            "bg-purple-50"
                                        );
                                        b.classList.add(
                                            "border-gray-200",
                                            "text-gray-500",
                                            "bg-white"
                                        );
                                    }
                                });

                            update();
                        };
                    });

                    // Set initial state visual
                    container.querySelector('[data-val="greater"]').click();
                    container.querySelector('[data-val="open"]').click();
                },

                interactive_ratio_potions(container) {
                    let redParts = 1;
                    let blueParts = 3;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Misturador de Po√ß√µes</h3>

        <div class="flex gap-8 w-full justify-center mb-6">
            <div class="flex flex-col items-center">
                <div class="w-16 h-24 bg-red-100 rounded-b-xl border-2 border-red-300 relative overflow-hidden flex items-end justify-center mb-2">
                    <div id="liquid-red" class="w-full bg-red-500 transition-all duration-300" style="height: 20%"></div>
                    <span class="absolute bottom-1 text-xs font-bold text-red-900 drop-shadow-md z-10" id="val-red">1</span>
                </div>
                <div class="flex gap-2">
                    <button class="w-8 h-8 rounded-full bg-gray-100 font-bold hover:bg-gray-200" onclick="app.widgets.updatePotion(this, 'r', -1)">-</button>
                    <button class="w-8 h-8 rounded-full bg-gray-100 font-bold hover:bg-gray-200" onclick="app.widgets.updatePotion(this, 'r', 1)">+</button>
                </div>
                <span class="text-[10px] uppercase font-bold text-red-500 mt-1">Sangue (A)</span>
            </div>

            <div class="flex flex-col items-center justify-center">
                <span class="text-2xl font-black text-gray-300">:</span>
            </div>

            <div class="flex flex-col items-center">
                <div class="w-16 h-24 bg-blue-100 rounded-b-xl border-2 border-blue-300 relative overflow-hidden flex items-end justify-center mb-2">
                    <div id="liquid-blue" class="w-full bg-blue-500 transition-all duration-300" style="height: 60%"></div>
                    <span class="absolute bottom-1 text-xs font-bold text-blue-900 drop-shadow-md z-10" id="val-blue">3</span>
                </div>
                <div class="flex gap-2">
                    <button class="w-8 h-8 rounded-full bg-gray-100 font-bold hover:bg-gray-200" onclick="app.widgets.updatePotion(this, 'b', -1)">-</button>
                    <button class="w-8 h-8 rounded-full bg-gray-100 font-bold hover:bg-gray-200" onclick="app.widgets.updatePotion(this, 'b', 1)">+</button>
                </div>
                <span class="text-[10px] uppercase font-bold text-blue-500 mt-1">L√°grima (B)</span>
            </div>
        </div>

        <div class="w-full bg-gray-50 p-4 rounded-xl border border-gray-200 text-center">
            <p class="text-xs text-gray-500 font-bold uppercase mb-2">Resultado da Mistura</p>
            <div class="text-xl font-mono font-bold text-brand-text mb-1">
                Raz√£o: <span class="text-brand-red">${redParts}</span> para <span class="text-brand-blue">${blueParts}</span>
            </div>
            <div class="text-sm text-gray-600">
                Fra√ß√£o: <strong class="text-brand-purple">${redParts}/${redParts + blueParts
                        }</strong> √© Vermelho
            </div>
        </div>
    </div>
    `;

                    const lRed = container.querySelector("#liquid-red");
                    const lBlue = container.querySelector("#liquid-blue");
                    const vRed = container.querySelector("#val-red");
                    const vBlue = container.querySelector("#val-blue");
                    const resultDiv = container.querySelector(".text-xl");
                    const fracDiv = container.querySelector(".text-brand-purple");

                    app.widgets.updatePotion = (el, type, delta) => {
                        if (type === "r") {
                            redParts += delta;
                            if (redParts < 1) redParts = 1;
                            if (redParts > 10) redParts = 10;
                        } else {
                            blueParts += delta;
                            if (blueParts < 1) blueParts = 1;
                            if (blueParts > 10) blueParts = 10;
                        }

                        // Render
                        vRed.innerText = redParts;
                        vBlue.innerText = blueParts;
                        lRed.style.height = `${redParts * 10}%`;
                        lBlue.style.height = `${blueParts * 10}%`;

                        resultDiv.innerHTML = `Raz√£o: <span class="text-brand-red">${redParts}</span> para <span class="text-brand-blue">${blueParts}</span>`;
                        fracDiv.innerText = `${redParts}/${redParts + blueParts}`;
                    };
                },

                interactive_proportion_balance(container) {
                    let x = 0;
                    // Problema: 2/4 = x/12 -> x=6
                    const prob = { a: 2, b: 4, d: 12, ans: 6 };

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-6">Equilibre a Propor√ß√£o</h3>

        <div class="flex items-center justify-center gap-4 text-3xl font-mono font-bold mb-8">
            <div class="flex flex-col items-center">
                <span class="text-brand-blue">${prob.a}</span>
                <div class="w-12 h-1 bg-gray-300 rounded"></div>
                <span class="text-brand-blue">${prob.b}</span>
            </div>
            <div class="text-gray-400">=</div>
            <div class="flex flex-col items-center">
                <span class="text-brand-orange bg-orange-100 px-2 rounded border border-orange-200" id="prop-x">?</span>
                <div class="w-12 h-1 bg-gray-300 rounded"></div>
                <span class="text-brand-orange">${prob.d}</span>
            </div>
        </div>

        <input type="range" id="prop-slider" min="1" max="20" value="1" class="w-full max-w-xs h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-orange hover:accent-orange-600 mb-4">
        
        <div id="balance-feedback" class="h-8 font-bold text-sm text-center text-gray-500">
            Arraste para achar X
        </div>

    </div>
    `;

                    const slider = container.querySelector("#prop-slider");
                    const xDisplay = container.querySelector("#prop-x");
                    const feedback = container.querySelector("#balance-feedback");

                    slider.addEventListener("input", (e) => {
                        const val = parseInt(e.target.value);
                        xDisplay.innerText = val;

                        // Verifica Propriedade Fundamental: a*d = b*c
                        const leftProd = prob.a * prob.d;
                        const rightProd = prob.b * val;

                        if (leftProd === rightProd) {
                            feedback.innerHTML = `<span class="text-brand-green flex items-center justify-center gap-2"><i class="fas fa-check-circle"></i> Perfeito! ${prob.a}√ó${prob.d} = ${prob.b}√ó${val}</span>`;
                            xDisplay.classList.add(
                                "bg-green-100",
                                "text-green-600",
                                "border-green-300"
                            );
                            xDisplay.classList.remove(
                                "bg-orange-100",
                                "text-brand-orange",
                                "border-orange-200",
                                "bg-red-100",
                                "text-red-500"
                            );
                        } else {
                            feedback.innerHTML = `Produto cruzado: ${leftProd} ‚â† ${rightProd}`;
                            xDisplay.classList.add("bg-red-100", "text-red-500");
                            xDisplay.classList.remove(
                                "bg-orange-100",
                                "text-brand-orange",
                                "bg-green-100",
                                "text-green-600"
                            );
                        }
                    });
                },

                interactive_gdp_graph(container) {
                    let amount = 1;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-green font-bold uppercase text-xs tracking-widest mb-6">Receita de P√£o (GDP)</h3>

        <div class="flex gap-8 w-full justify-center items-end h-32 mb-6 relative border-b-2 border-l-2 border-gray-300 pl-2 pb-2">
            <div class="flex flex-col items-center w-16 group relative">
                <div id="bar-flour" class="w-full bg-brand-green rounded-t-md transition-all duration-300" style="height: 20%"></div>
                <span class="text-xs font-bold text-gray-500 mt-2">Farinha</span>
                <span class="absolute bottom-full mb-1 font-bold text-brand-green text-sm" id="lbl-flour">1kg</span>
            </div>

            <div class="flex flex-col items-center w-16 group relative">
                <div id="bar-bread" class="w-full bg-brand-orange rounded-t-md transition-all duration-300" style="height: 20%"></div>
                <span class="text-xs font-bold text-gray-500 mt-2">P√£es</span>
                <span class="absolute bottom-full mb-1 font-bold text-brand-orange text-sm" id="lbl-bread">10 un</span>
            </div>
            
            <div class="absolute top-2 right-2 text-[10px] text-gray-400 bg-white p-1 border rounded">Constante k = 10</div>
        </div>

        <div class="w-full max-w-xs flex flex-col items-center">
            <label class="text-xs font-bold text-gray-400 uppercase mb-2">Multiplicador</label>
            <input type="range" id="gdp-slider" min="1" max="5" value="1" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-green">
            <div class="flex justify-between w-full text-[10px] text-gray-400 mt-1 font-bold">
                <span>1x</span><span>2x</span><span>3x</span><span>4x</span><span>5x</span>
            </div>
        </div>
    </div>
    `;

                    const slider = container.querySelector("#gdp-slider");
                    const barF = container.querySelector("#bar-flour");
                    const barB = container.querySelector("#bar-bread");
                    const lblF = container.querySelector("#lbl-flour");
                    const lblB = container.querySelector("#lbl-bread");

                    slider.oninput = (e) => {
                        const val = parseInt(e.target.value);
                        // Altura m√°xima = 100% (para 5x)
                        const h = val * 20;

                        barF.style.height = `${h}%`;
                        barB.style.height = `${h}%`;

                        lblF.innerText = `${val}kg`;
                        lblB.innerText = `${val * 10} un`;
                    };
                },

                interactive_gip_graph(container) {
                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-6">Muro da Constru√ß√£o (GIP)</h3>

        <div class="flex gap-4 w-full justify-center items-center mb-6">
            <div class="bg-blue-50 p-3 rounded-xl border border-blue-200 w-24 text-center">
                <span class="text-2xl">üë∑</span>
                <div class="font-bold text-brand-blue text-lg" id="gip-workers">1</div>
                <span class="text-[10px] text-gray-500 uppercase">Pedreiros</span>
            </div>
            
            <div class="text-2xl text-gray-300">√ó</div>

            <div class="bg-orange-50 p-3 rounded-xl border border-orange-200 w-24 text-center">
                <span class="text-2xl">‚è±Ô∏è</span>
                <div class="font-bold text-brand-orange text-lg" id="gip-time">60</div>
                <span class="text-[10px] text-gray-500 uppercase">Dias</span>
            </div>
            
            <div class="text-2xl text-gray-300">=</div>
            
            <div class="text-center w-16">
                <span class="font-black text-gray-600 text-xl">60</span>
                <span class="text-[8px] text-gray-400 block uppercase">Trabalho Total</span>
            </div>
        </div>

        <div class="relative w-full max-w-sm h-4 bg-gray-200 rounded-full overflow-hidden mb-6">
            <div id="time-bar" class="absolute top-0 left-0 h-full bg-brand-orange transition-all duration-300" style="width: 100%"></div>
        </div>

        <div class="w-full max-w-xs flex flex-col items-center">
            <label class="text-xs font-bold text-gray-400 uppercase mb-2">Contratar Pedreiros</label>
            <input type="range" id="gip-slider" min="1" max="6" value="1" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue hover:accent-blue-600">
             <p class="text-xs text-center text-gray-500 mt-2 italic">Aumente os pedreiros, diminua o tempo!</p>
        </div>
    </div>
    `;

                    const slider = container.querySelector("#gip-slider");
                    const txtW = container.querySelector("#gip-workers");
                    const txtT = container.querySelector("#gip-time");
                    const bar = container.querySelector("#time-bar");
                    const constant = 60; // 1 pedreiro leva 60 dias

                    slider.oninput = (e) => {
                        const workers = parseInt(e.target.value);
                        const days = constant / workers;

                        txtW.innerText = workers;
                        txtT.innerText = days;

                        // Barra representa o tempo (quanto menor, melhor)
                        // Max dias = 60 (100% largura)
                        const widthPct = (days / 60) * 100;
                        bar.style.width = `${widthPct}%`;
                    };
                },

                interactive_rule_three_quiz(container) {
                    const questions = [
                        {
                            text: "Comprei 2 chocolates por R$ 5. Quanto custam 4 chocolates?",
                            type: "direta",
                            icon: "üç´",
                        },
                        {
                            text: "Um carro a 60km/h leva 2h. Se for a 120km/h, leva quanto tempo?",
                            type: "inversa",
                            icon: "üöó",
                        },
                        {
                            text: "3 impressoras imprimem 100 folhas em 10 min. 6 impressoras imprimem as mesmas 100 folhas em...",
                            type: "inversa",
                            icon: "üñ®Ô∏è",
                        },
                        {
                            text: "Para fazer 1 bolo preciso de 3 ovos. Para 2 bolos preciso de...",
                            type: "direta",
                            icon: "üéÇ",
                        },
                    ];

                    let qIdx = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-300 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative h-[300px]">
        
        <div class="flex justify-between w-full items-center mb-4 z-10">
            <h3 class="font-black text-gray-500 uppercase text-xs tracking-widest">Detetive de Propor√ß√£o</h3>
            <div class="bg-white px-3 py-1 rounded-full text-xs font-black text-brand-blue">Pts: <span id="r3-score">0</span></div>
        </div>

        <div id="card-area" class="w-full flex-1 flex items-center justify-center relative">
            <div id="r3-card" class="bg-white w-64 h-32 rounded-xl shadow-xl border-b-4 border-gray-200 flex flex-col items-center justify-center p-4 text-center transition-all transform z-10">
                <span class="text-3xl mb-2" id="q-icon">‚ùì</span>
                <p class="text-sm font-bold text-gray-700 leading-tight" id="q-text">Carregando...</p>
            </div>
            <div id="r3-feedback" class="absolute font-black text-4xl opacity-0 transition-all z-20"></div>
        </div>

        <div class="grid grid-cols-2 gap-4 w-full max-w-xs z-10 mb-2">
            <button class="choice-btn bg-blue-100 text-blue-700 border-b-4 border-blue-300 rounded-xl py-3 font-black text-xs uppercase hover:bg-blue-200 active:scale-95 transition-all" data-type="direta">
                Direta ‚ÜóÔ∏è‚ÜóÔ∏è
            </button>
            <button class="choice-btn bg-orange-100 text-orange-700 border-b-4 border-orange-300 rounded-xl py-3 font-black text-xs uppercase hover:bg-orange-200 active:scale-95 transition-all" data-type="inversa">
                Inversa ‚ÜóÔ∏è‚ÜòÔ∏è
            </button>
        </div>

        <div id="r3-end" class="hidden absolute inset-0 bg-white/95 z-30 flex-col items-center justify-center text-center">
            <div class="text-5xl mb-2">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
            <h3 class="text-xl font-black text-brand-text">Caso Encerrado!</h3>
            <button id="btn-restart-r3" class="mt-4 bg-brand-green text-white font-bold py-2 px-6 rounded-lg shadow-btn">Jogar Novamente</button>
        </div>

    </div>
    `;

                    const card = container.querySelector("#r3-card");
                    const qText = container.querySelector("#q-text");
                    const qIcon = container.querySelector("#q-icon");
                    const feedback = container.querySelector("#r3-feedback");
                    const scoreEl = container.querySelector("#r3-score");
                    const endScreen = container.querySelector("#r3-end");
                    const btns = container.querySelectorAll(".choice-btn");

                    const loadQ = () => {
                        if (qIdx >= questions.length) {
                            endScreen.classList.remove("hidden");
                            endScreen.classList.add("flex");
                            return;
                        }
                        const q = questions[qIdx];
                        qText.innerText = q.text;
                        qIcon.innerText = q.icon;

                        // Reset card anim
                        card.style.transform = "scale(1)";
                        card.style.opacity = "1";
                        feedback.style.opacity = "0";
                    };

                    const handle = (type) => {
                        const correct = questions[qIdx].type;

                        if (type === correct) {
                            score += 10;
                            scoreEl.innerText = score;
                            feedback.innerText = "‚úÖ";
                            feedback.className =
                                "absolute font-black text-5xl text-green-500 opacity-100 z-20 animate-pop-in";
                            // Anima card saindo
                            card.style.transform = "translateX(200px) rotate(10deg)";
                            card.style.opacity = "0";
                        } else {
                            score = Math.max(0, score - 5);
                            scoreEl.innerText = score;
                            feedback.innerText = "‚ùå";
                            feedback.className =
                                "absolute font-black text-5xl text-red-500 opacity-100 z-20 animate-pop-in";
                            card.classList.add("animate-shake");
                            setTimeout(() => card.classList.remove("animate-shake"), 500);
                            return; // N√£o avan√ßa se errar, ou avan√ßa? Vamos avan√ßar para fluidez
                        }

                        setTimeout(() => {
                            qIdx++;
                            card.style.transition = "none";
                            card.style.transform = "scale(0.8) translateY(20px)";

                            setTimeout(() => {
                                card.style.transition = "all 0.3s";
                                loadQ();
                            }, 50);
                        }, 600);
                    };

                    btns.forEach((b) => (b.onclick = () => handle(b.dataset.type)));
                    container.querySelector("#btn-restart-r3").onclick = () => {
                        qIdx = 0;
                        score = 0;
                        scoreEl.innerText = 0;
                        endScreen.classList.add("hidden");
                        endScreen.classList.remove("flex");
                        loadQ();
                    };

                    loadQ();
                },

                interactive_treasure_split(container) {
                    let coins = 100;
                    let powerA = 2;
                    let powerB = 3;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-6">Divis√£o de Tesouro</h3>

        <div class="flex items-end gap-2 w-full mb-6 h-32 relative px-4">
            
            <div class="flex-1 flex flex-col items-center justify-end h-full group">
                <span class="font-bold text-brand-blue mb-1" id="share-a">?</span>
                <div id="bar-a" class="w-full bg-blue-400 rounded-t-lg transition-all duration-500 relative border-x-2 border-t-2 border-blue-600 opacity-80 group-hover:opacity-100" style="height: 0%">
                    <div class="absolute bottom-2 left-1/2 -translate-x-1/2 text-2xl">üè¥‚Äç‚ò†Ô∏è</div>
                </div>
                <div class="mt-2 flex items-center gap-1 bg-gray-100 rounded-lg p-1">
                    <span class="text-[10px] font-bold uppercase text-gray-500">For√ßa</span>
                    <button class="w-6 h-6 bg-white rounded font-bold text-blue-600 shadow-sm" onclick="app.widgets.updatePirate(this, 'a', 1)">+</button>
                    <span id="pow-a" class="font-mono font-bold text-blue-800">2</span>
                </div>
            </div>

            <div class="flex-1 flex flex-col items-center justify-end h-full group">
                <span class="font-bold text-brand-red mb-1" id="share-b">?</span>
                <div id="bar-b" class="w-full bg-red-400 rounded-t-lg transition-all duration-500 relative border-x-2 border-t-2 border-red-600 opacity-80 group-hover:opacity-100" style="height: 0%">
                    <div class="absolute bottom-2 left-1/2 -translate-x-1/2 text-2xl">ü¶ú</div>
                </div>
                <div class="mt-2 flex items-center gap-1 bg-gray-100 rounded-lg p-1">
                    <span class="text-[10px] font-bold uppercase text-gray-500">For√ßa</span>
                    <button class="w-6 h-6 bg-white rounded font-bold text-red-600 shadow-sm" onclick="app.widgets.updatePirate(this, 'b', 1)">+</button>
                    <span id="pow-b" class="font-mono font-bold text-red-800">3</span>
                </div>
            </div>

        </div>

        <div class="w-full bg-yellow-50 border border-yellow-200 rounded-xl p-3 text-center">
            <p class="text-xs font-bold text-yellow-800 uppercase mb-1">C√°lculo (Constante K)</p>
            <p class="font-mono text-sm text-gray-700">
                Total (100) √∑ Soma For√ßas (<span id="sum-pow">5</span>) = <strong class="text-brand-green" id="k-val">20</strong> por ponto
            </p>
        </div>

    </div>
    `;

                    const barA = container.querySelector("#bar-a");
                    const barB = container.querySelector("#bar-b");
                    const shareA = container.querySelector("#share-a");
                    const shareB = container.querySelector("#share-b");
                    const pA = container.querySelector("#pow-a");
                    const pB = container.querySelector("#pow-b");
                    const sumPow = container.querySelector("#sum-pow");
                    const kVal = container.querySelector("#k-val");

                    app.widgets.updatePirate = (el, pirate, delta) => {
                        // Reseta ciclo (1 a 5)
                        if (pirate === "a") {
                            powerA = (powerA % 5) + 1;
                        } else {
                            powerB = (powerB % 5) + 1;
                        }
                        update();
                    };

                    const update = () => {
                        const totalPower = powerA + powerB;
                        const k = coins / totalPower;

                        const coinsA = Math.round(k * powerA);
                        const coinsB = Math.round(k * powerB); // Math.round para inteiros visuais

                        // Atualiza textos
                        pA.innerText = powerA;
                        pB.innerText = powerB;
                        sumPow.innerText = totalPower;
                        kVal.innerText = k.toFixed(1);

                        shareA.innerText = coinsA;
                        shareB.innerText = coinsB;

                        // Atualiza Barras (Altura relativa ao total de 100 moedas)
                        // Se um ganhar tudo, barra enche 100%
                        barA.style.height = `${(coinsA / coins) * 100}%`;
                        barB.style.height = `${(coinsB / coins) * 100}%`;
                    };

                    update();
                },

                interactive_percent_grid(container) {
                    // Estado
                    let percent = 50;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Visualize a Porcentagem</h3>
        
        <div class="flex flex-col md:flex-row gap-8 items-center">
            
            <div class="relative w-48 h-48 bg-gray-100 border-2 border-gray-300 grid grid-cols-10 grid-rows-10 gap-px p-1 rounded shadow-inner" id="grid-container">
            </div>

            <div class="flex flex-col gap-4 w-full max-w-xs text-center">
                <div>
                    <div class="text-5xl font-black text-brand-blue mb-2"><span id="val-disp">50</span>%</div>
                    <div class="text-xs font-bold text-gray-400 uppercase tracking-wider">
                        <span id="frac-disp">50/100</span> ‚Ä¢ <span id="dec-disp">0,50</span>
                    </div>
                </div>

                <input type="range" id="slider" min="0" max="100" value="50" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue hover:accent-brand-blueDark">
                
                <div class="flex justify-between w-full gap-2">
                    <button class="preset-btn flex-1 py-2 bg-gray-50 hover:bg-gray-100 rounded text-xs font-bold text-gray-500 transition-colors border border-gray-200" data-v="10">10%</button>
                    <button class="preset-btn flex-1 py-2 bg-gray-50 hover:bg-gray-100 rounded text-xs font-bold text-gray-500 transition-colors border border-gray-200" data-v="25">25%</button>
                    <button class="preset-btn flex-1 py-2 bg-gray-50 hover:bg-gray-100 rounded text-xs font-bold text-gray-500 transition-colors border border-gray-200" data-v="50">50%</button>
                    <button class="preset-btn flex-1 py-2 bg-gray-50 hover:bg-gray-100 rounded text-xs font-bold text-gray-500 transition-colors border border-gray-200" data-v="75">75%</button>
                    <button class="preset-btn flex-1 py-2 bg-gray-50 hover:bg-gray-100 rounded text-xs font-bold text-gray-500 transition-colors border border-gray-200" data-v="100">100%</button>
                </div>
            </div>

        </div>
    </div>
    `;

                    const gridEl = container.querySelector("#grid-container");
                    const slider = container.querySelector("#slider");
                    const valDisp = container.querySelector("#val-disp");
                    const fracDisp = container.querySelector("#frac-disp");
                    const decDisp = container.querySelector("#dec-disp");
                    const presets = container.querySelectorAll(".preset-btn");

                    // Gera 100 c√©lulas
                    for (let i = 0; i < 100; i++) {
                        const cell = document.createElement("div");
                        cell.className =
                            "bg-white rounded-[1px] transition-colors duration-100";
                        gridEl.appendChild(cell);
                    }

                    const cells = gridEl.children;

                    const update = () => {
                        const val = parseInt(slider.value);
                        valDisp.innerText = val;
                        fracDisp.innerText = `${val}/100`;
                        decDisp.innerText = (val / 100).toFixed(2).replace(".", ",");

                        for (let i = 0; i < 100; i++) {
                            // Preenche de baixo para cima, esquerda para direita? Ou normal?
                            // Normal (√≠ndice < val) √© mais f√°cil de ler como texto.
                            if (i < val) {
                                cells[i].className =
                                    "bg-brand-blue rounded-[1px] transition-colors duration-100 shadow-sm";
                            } else {
                                cells[i].className =
                                    "bg-white rounded-[1px] transition-colors duration-100";
                            }
                        }
                    };

                    slider.addEventListener("input", update);
                    presets.forEach((btn) => {
                        btn.onclick = () => {
                            slider.value = btn.dataset.v;
                            update();
                        };
                    });

                    update();
                },

                interactive_discount_game(container) {
                    // Banco de Produtos
                    const items = [
                        { name: "T√™nis", price: 100, discount: 20, icon: "üëü" },
                        { name: "Bon√©", price: 50, discount: 10, icon: "üß¢" },
                        { name: "Game", price: 200, discount: 50, icon: "üéÆ" },
                        { name: "Fone", price: 80, discount: 25, icon: "üéß" },
                        { name: "Mochila", price: 120, discount: 10, icon: "üéí" },
                    ];

                    let currentItem = null;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-4 border-b-2 border-gray-100 pb-2">
            <h3 class="text-brand-green font-black uppercase text-xs tracking-widest"><i class="fas fa-shopping-cart"></i> Calculadora de Descontos</h3>
            <div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black shadow-sm">Pontos: <span id="score-val">0</span></div>
        </div>

        <div class="relative bg-gray-50 rounded-2xl p-6 mb-6 w-full max-w-sm flex items-center justify-between border-2 border-gray-200 shadow-sm transition-all" id="product-card">
            
            <div class="absolute -top-3 -right-3 bg-brand-red text-white font-black px-3 py-1 rounded-lg shadow-md transform rotate-12 text-sm animate-pulse">
                -<span id="discount-val">20</span>%
            </div>

            <div class="text-6xl mr-4" id="prod-icon">üëü</div>
            
            <div class="text-right">
                <p class="text-xs font-bold text-gray-400 uppercase mb-1" id="prod-name">T√™nis</p>
                <p class="text-3xl font-black text-brand-text decoration-2" id="prod-price">R$ 100</p>
            </div>

        </div>

        <p class="text-sm text-gray-500 font-bold mb-4 text-center">Qual √© o pre√ßo final?</p>

        <div class="grid grid-cols-2 gap-3 w-full max-w-sm" id="opts-grid">
        </div>

        <div id="feedback-msg" class="h-8 mt-4 text-sm font-black text-center w-full flex items-center justify-center"></div>

        <button id="btn-next" class="hidden w-full bg-brand-blue text-white font-bold py-3 rounded-xl shadow-btn mt-2 animate-pop-in">Pr√≥ximo Produto</button>

    </div>
    `;

                    const prodIcon = container.querySelector("#prod-icon");
                    const prodName = container.querySelector("#prod-name");
                    const prodPrice = container.querySelector("#prod-price");
                    const discountVal = container.querySelector("#discount-val");
                    const optsGrid = container.querySelector("#opts-grid");
                    const scoreVal = container.querySelector("#score-val");
                    const feedbackMsg = container.querySelector("#feedback-msg");
                    const btnNext = container.querySelector("#btn-next");
                    const productCard = container.querySelector("#product-card");

                    const loadLevel = () => {
                        currentItem = items[Math.floor(Math.random() * items.length)];

                        // Renderiza Produto
                        prodIcon.innerText = currentItem.icon;
                        prodName.innerText = currentItem.name;
                        prodPrice.innerText = `R$ ${currentItem.price}`;
                        discountVal.innerText = currentItem.discount;

                        // Reseta UI
                        feedbackMsg.innerHTML = "";
                        btnNext.classList.add("hidden");
                        productCard.className =
                            "relative bg-gray-50 rounded-2xl p-6 mb-6 w-full max-w-sm flex items-center justify-between border-2 border-gray-200 shadow-sm transition-all";

                        // Calcula Resposta Correta
                        const discountAmount =
                            (currentItem.price * currentItem.discount) / 100;
                        const finalPrice = currentItem.price - discountAmount;

                        // Gera Op√ß√µes (1 correta + 3 erradas inteligentes)
                        let options = [finalPrice];

                        // Erro comum 1: Subtrair o percentual direto (ex: 100 - 20 = 80 ok, mas 80 - 25% = 60. Erro seria 80 - 25 = 55)
                        options.push(currentItem.price - currentItem.discount);

                        // Erro comum 2: Calcular apenas o valor do desconto
                        options.push(discountAmount);

                        // Erro comum 3: Valor aleat√≥rio pr√≥ximo
                        options.push(finalPrice + 10);

                        // Remove duplicatas e garante 4 op√ß√µes
                        options = [...new Set(options)].filter(
                            (o) => o > 0 && o !== finalPrice
                        );
                        while (options.length < 3)
                            options.push(Math.floor(Math.random() * currentItem.price));

                        // Readiciona a correta e embaralha
                        options = [finalPrice, ...options.slice(0, 3)];
                        options.sort(() => Math.random() - 0.5);

                        optsGrid.innerHTML = "";
                        options.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-white border-b-4 border-gray-200 text-gray-600 font-bold text-xl py-4 rounded-xl hover:bg-blue-50 hover:border-blue-200 hover:text-brand-blue transition-all active:border-b-0 active:translate-y-1 flex items-center justify-center";
                            btn.innerText = `R$ ${opt}`;
                            btn.onclick = () => checkAnswer(opt, finalPrice, btn);
                            optsGrid.appendChild(btn);
                        });
                    };

                    const checkAnswer = (val, correct, btn) => {
                        // Trava bot√µes
                        Array.from(optsGrid.children).forEach((b) => (b.disabled = true));

                        if (val === correct) {
                            score += 100;
                            scoreVal.innerText = score;

                            btn.classList.remove(
                                "bg-white",
                                "text-gray-600",
                                "border-gray-200"
                            );
                            btn.classList.add(
                                "bg-brand-green",
                                "text-white",
                                "border-green-700",
                                "transform",
                                "scale-105"
                            );
                            btn.innerHTML += ' <i class="fas fa-check ml-2"></i>';

                            feedbackMsg.innerHTML = `<span class="text-brand-green flex items-center gap-2"><i class="fas fa-check-circle"></i> Economizou R$ ${currentItem.price - correct
                                }!</span>`;
                            productCard.classList.add("border-brand-green", "bg-green-50");

                            btnNext.classList.remove("hidden");
                        } else {
                            btn.classList.remove(
                                "bg-white",
                                "text-gray-600",
                                "border-gray-200"
                            );
                            btn.classList.add(
                                "bg-brand-red",
                                "text-white",
                                "border-red-700",
                                "animate-shake"
                            );

                            feedbackMsg.innerHTML = `<span class="text-brand-red">Ops! Era R$ ${correct}</span>`;

                            // Mostra a correta
                            Array.from(optsGrid.children).forEach((b) => {
                                if (b.innerText.includes(correct)) {
                                    b.classList.add(
                                        "bg-green-100",
                                        "text-green-800",
                                        "border-green-200"
                                    );
                                }
                            });

                            btnNext.classList.remove("hidden");
                        }
                    };

                    btnNext.onclick = loadLevel;

                    // Init
                    loadLevel();

                    // CSS Shake (se n√£o tiver)
                    if (!document.getElementById("anim-shake")) {
                        const s = document.createElement("style");
                        s.id = "anim-shake";
                        s.innerHTML = `@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } } .animate-shake { animation: shake 0.3s ease-in-out; }`;
                        container.appendChild(s);
                    }
                },

                interactive_interest_simulator(container) {
                    let principal = 100;
                    let rate = 10; // %
                    let time = 0; // Meses

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-yellow font-black uppercase text-xs tracking-widest mb-6">M√°quina do Tempo Financeira</h3>

        <div class="flex flex-col md:flex-row gap-6 w-full items-start">
            
            <div class="flex flex-col gap-4 w-full md:w-1/2">
                <div>
                    <label class="text-xs font-bold text-gray-400 uppercase">Capital (R$)</label>
                    <input type="range" id="range-c" min="100" max="1000" step="100" value="100" class="w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer accent-brand-blue">
                    <div class="text-right font-black text-brand-blue" id="val-c">R$ 100</div>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-400 uppercase">Taxa (% ao m√™s)</label>
                    <input type="range" id="range-i" min="1" max="50" step="1" value="10" class="w-full h-2 bg-green-100 rounded-lg appearance-none cursor-pointer accent-brand-green">
                    <div class="text-right font-black text-brand-green" id="val-i">10%</div>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-400 uppercase">Tempo (Meses)</label>
                    <input type="range" id="range-t" min="0" max="12" step="1" value="0" class="w-full h-2 bg-purple-100 rounded-lg appearance-none cursor-pointer accent-brand-purple">
                    <div class="text-right font-black text-brand-purple" id="val-t">0 meses</div>
                </div>
            </div>

            <div class="w-full md:w-1/2 flex flex-col items-center justify-center bg-gray-50 rounded-xl border-2 border-dashed border-gray-200 p-4 min-h-[200px] relative">
                
                <div class="text-center mb-4">
                    <p class="text-xs font-bold text-gray-400 uppercase">Montante Final</p>
                    <p class="text-3xl font-black text-gray-800" id="final-amount">R$ 100,00</p>
                </div>

                <div class="flex items-end gap-1 w-full justify-center h-32 relative">
                    <div class="w-16 bg-blue-400 rounded-t-sm shadow-sm flex items-end justify-center text-white font-bold text-xs pb-1 relative group transition-all duration-300" id="bar-capital" style="height: 50%;">
                        <span class="absolute bottom-2 text-[10px] opacity-80">Capital</span>
                    </div>
                    
                    <div class="w-16 bg-brand-yellow rounded-t-sm shadow-sm flex items-end justify-center text-yellow-900 font-bold text-xs pb-1 transition-all duration-300 relative" id="bar-interest" style="height: 0%;">
                        <div class="absolute -top-6 text-brand-yellow font-black" id="float-juros">+0</div>
                    </div>
                </div>

                <div class="mt-4 text-xs font-mono text-gray-500 bg-white p-2 rounded border border-gray-200 w-full text-center">
                    J = <span class="text-brand-blue" id="f-c">100</span> √ó <span class="text-brand-green" id="f-i">0.10</span> √ó <span class="text-brand-purple" id="f-t">0</span> = <strong class="text-brand-yellow" id="f-j">0</strong>
                </div>

            </div>
        </div>
    </div>
    `;

                    const rC = container.querySelector("#range-c");
                    const rI = container.querySelector("#range-i");
                    const rT = container.querySelector("#range-t");

                    const vC = container.querySelector("#val-c");
                    const vI = container.querySelector("#val-i");
                    const vT = container.querySelector("#val-t");

                    const barC = container.querySelector("#bar-capital");
                    const barJ = container.querySelector("#bar-interest");

                    const finalDisplay = container.querySelector("#final-amount");
                    const floatJuros = container.querySelector("#float-juros");

                    const fC = container.querySelector("#f-c");
                    const fI = container.querySelector("#f-i");
                    const fT = container.querySelector("#f-t");
                    const fJ = container.querySelector("#f-j");

                    const update = () => {
                        principal = parseInt(rC.value);
                        rate = parseInt(rI.value);
                        time = parseInt(rT.value);

                        vC.innerText = `R$ ${principal}`;
                        vI.innerText = `${rate}%`;
                        vT.innerText = `${time} meses`;

                        // C√°lculo
                        const interest = principal * (rate / 100) * time;
                        const amount = principal + interest;

                        // Atualiza Texto Final
                        finalDisplay.innerText = `R$ ${amount.toFixed(2)}`;
                        floatJuros.innerText = `+${interest.toFixed(0)}`;

                        // Atualiza F√≥rmula
                        fC.innerText = principal;
                        fI.innerText = (rate / 100).toFixed(2);
                        fT.innerText = time;
                        fJ.innerText = interest.toFixed(2);

                        // Atualiza Barras (Visualiza√ß√£o Proporcional)
                        // Definimos uma altura m√°xima visual (ex: 100% = 1500 reais para escalar bem)
                        // O Capital sempre ocupa uma altura base visual para compara√ß√£o
                        const maxVal = principal * 2.5; // Escala din√¢mica

                        const hC = (principal / maxVal) * 100;
                        const hJ = (interest / maxVal) * 100;

                        barC.style.height = `${Math.max(hC, 10)}%`; // M√≠nimo 10%
                        barJ.style.height = `${hJ}%`;

                        // Muda cor da barra de juros se for muito alta (alerta visual de d√≠vida/lucro alto)
                        if (interest > principal) {
                            barJ.classList.remove("bg-brand-yellow", "text-yellow-900");
                            barJ.classList.add("bg-green-500", "text-white");
                        } else {
                            barJ.classList.add("bg-brand-yellow", "text-yellow-900");
                            barJ.classList.remove("bg-green-500", "text-white");
                        }
                    };

                    rC.oninput = update;
                    rI.oninput = update;
                    rT.oninput = update;

                    update();
                },

                interactive_angle_combos(container) {
                    let mode = "comp"; // 'comp' (90) ou 'supp' (180)
                    let angle = 45;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex bg-gray-100 p-1 rounded-lg mb-6 w-full max-w-xs relative">
            <div id="mode-bg-angle" class="absolute top-1 bottom-1 w-[calc(50%-4px)] bg-white rounded-md shadow-sm transition-all duration-300 left-1"></div>
            <button class="mode-btn-angle flex-1 py-2 rounded-md text-xs font-bold uppercase z-10 transition-colors text-brand-blue" data-m="comp">Complementar (90¬∞)</button>
            <button class="mode-btn-angle flex-1 py-2 rounded-md text-xs font-bold uppercase z-10 transition-colors text-gray-400" data-m="supp">Suplementar (180¬∞)</button>
        </div>

        <div class="relative w-64 h-32 flex items-end justify-center mb-6 overflow-hidden">
            <svg id="combo-svg" viewBox="0 0 200 100" class="w-full h-full overflow-visible">
                <line x1="0" y1="100" x2="200" y2="100" stroke="#4B4B4B" stroke-width="2" />
                <line id="ref-90" x1="100" y1="100" x2="100" y2="0" stroke="#E5E7EB" stroke-width="1" stroke-dasharray="4" />
                <line id="move-arm" x1="100" y1="100" x2="100" y2="10" stroke="#4B4B4B" stroke-width="3" stroke-linecap="round" />
                
                <path id="arc-a" fill="rgba(28, 176, 246, 0.2)" stroke="#1CB0F6" stroke-width="2" />
                <path id="arc-b" fill="rgba(255, 150, 0, 0.2)" stroke="#FF9600" stroke-width="2" />
            </svg>
        </div>

        <div class="flex justify-between w-full max-w-xs text-sm font-bold mb-2">
            <span class="text-brand-blue">√Çngulo A: <span id="val-a">45¬∞</span></span>
            <span class="text-brand-orange">√Çngulo B: <span id="val-b">45¬∞</span></span>
        </div>

        <input type="range" id="angle-input" min="10" max="80" value="45" class="w-full max-w-xs h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue">
    </div>
    `;

                    const svg = container.querySelector("#combo-svg");
                    const moveArm = container.querySelector("#move-arm");
                    const arcA = container.querySelector("#arc-a");
                    const arcB = container.querySelector("#arc-b");
                    const valA = container.querySelector("#val-a");
                    const valB = container.querySelector("#val-b");
                    const slider = container.querySelector("#angle-input");
                    const btns = container.querySelectorAll(".mode-btn-angle");
                    const modeBg = container.querySelector("#mode-bg-angle");
                    const ref90 = container.querySelector("#ref-90");

                    // Helper para desenhar arco SVG
                    const describeArc = (x, y, radius, startAngle, endAngle) => {
                        const start = polarToCartesian(x, y, radius, endAngle);
                        const end = polarToCartesian(x, y, radius, startAngle);
                        const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
                        return [
                            "M",
                            x,
                            y,
                            "L",
                            start.x,
                            start.y,
                            "A",
                            radius,
                            radius,
                            0,
                            largeArcFlag,
                            0,
                            end.x,
                            end.y,
                            "L",
                            x,
                            y,
                        ].join(" ");
                    };

                    const polarToCartesian = (
                        centerX,
                        centerY,
                        radius,
                        angleInDegrees
                    ) => {
                        const angleInRadians = ((angleInDegrees - 90) * Math.PI) / 180.0;
                        return {
                            x: centerX + radius * Math.cos(angleInRadians),
                            y: centerY + radius * Math.sin(angleInRadians),
                        };
                    };

                    const update = () => {
                        let maxAngle = mode === "comp" ? 90 : 180;
                        let currentVal = parseInt(slider.value);

                        // Ajusta limites visuais
                        if (mode === "comp") {
                            ref90.style.opacity = 1;
                            // No modo complementar, o bra√ßo m√≥vel varia de 0 a 90 (vertical)
                            // No SVG: 0 graus √© 12 horas (vertical), mas nossa l√≥gica matem√°tica √© a partir da horizontal direita (3h)
                            // Vamos usar coordenadas polares personalizadas: 0 = direita (horizonte), 90 = topo.
                            // SVG: (100, 100) √© origem.
                        } else {
                            ref90.style.opacity = 0;
                        }

                        let angleA = currentVal;
                        let angleB = maxAngle - currentVal;

                        valA.innerText = angleA + "¬∞";
                        valB.innerText = angleB + "¬∞";

                        // Coordenadas do bra√ßo (comprimento 90)
                        // √Çngulo em radianos (convertendo coordenadas SVG onde Y cresce para baixo)
                        // 0 graus matem√°tico = direita.
                        const rad = -angleA * (Math.PI / 180);
                        const endX = 100 + 90 * Math.cos(rad);
                        const endY = 100 + 90 * Math.sin(rad);

                        moveArm.setAttribute("x2", endX);
                        moveArm.setAttribute("y2", endY);

                        // Desenha Arcos
                        // Arco A (Azul): De 0 at√© angleA
                        // Arco B (Laranja): De angleA at√© maxAngle
                        // A fun√ß√£o describeArc usa 0 no topo (12h). Precisamos ajustar.
                        // Nossa base √© direita (90 deg na fun√ß√£o polarToCartesian padr√£o svg ou ajustar rota√ß√£o)

                        // Ajuste simples: rotacionar 90 graus a l√≥gica
                        // 0 matem√°tico = 90 no describeArc
                        // angleA matem√°tico = 90 - angleA no describeArc

                        const svgStart = 90;
                        const svgMid = 90 - angleA;
                        const svgEnd = 90 - maxAngle;

                        arcA.setAttribute(
                            "d",
                            describeArc(100, 100, 40, svgMid, svgStart)
                        );
                        arcB.setAttribute("d", describeArc(100, 100, 30, svgEnd, svgMid));
                    };

                    slider.oninput = update;

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            mode = btn.dataset.m;

                            // UI Toggle
                            if (mode === "comp") {
                                modeBg.style.left = "4px";
                                btns[0].className =
                                    "mode-btn-angle flex-1 py-2 rounded-md text-xs font-bold uppercase z-10 transition-colors text-brand-blue";
                                btns[1].className =
                                    "mode-btn-angle flex-1 py-2 rounded-md text-xs font-bold uppercase z-10 transition-colors text-gray-400";
                                slider.max = 80;
                                if (slider.value > 80) slider.value = 80;
                            } else {
                                modeBg.style.left = "calc(50% + 0px)";
                                btns[0].className =
                                    "mode-btn-angle flex-1 py-2 rounded-md text-xs font-bold uppercase z-10 transition-colors text-gray-400";
                                btns[1].className =
                                    "mode-btn-angle flex-1 py-2 rounded-md text-xs font-bold uppercase z-10 transition-colors text-brand-orange";
                                slider.max = 170;
                            }
                            update();
                        };
                    });

                    update();
                },

                interactive_scissors_opv(container) {
                    let angle = 40;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Tesoura de √Çngulos</h3>

        <div class="relative w-64 h-64 flex items-center justify-center bg-gray-50 rounded-full border border-gray-200 mb-6 overflow-hidden shadow-inner cursor-pointer" id="scissors-area">
            <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(#9CA3AF 1px, transparent 1px); background-size: 20px 20px;"></div>
            
            <div id="line-1" class="absolute w-[120%] h-2 bg-gray-800 rounded-full"></div>
            <div id="line-2" class="absolute w-[120%] h-2 bg-brand-purple rounded-full shadow-lg transition-transform duration-100 ease-out"></div>
            
            <div class="absolute w-4 h-4 bg-white border-2 border-gray-800 rounded-full z-10"></div>

            <div id="lbl-top" class="absolute top-10 font-bold text-brand-purple text-lg">?</div>
            <div id="lbl-bot" class="absolute bottom-10 font-bold text-brand-purple text-lg">?</div>
            <div id="lbl-left" class="absolute left-4 font-bold text-gray-400 text-xs">?</div>
            <div id="lbl-right" class="absolute right-4 font-bold text-gray-400 text-xs">?</div>
        </div>

        <div class="w-full max-w-xs text-center">
            <p class="text-xs font-bold text-gray-400 uppercase mb-2">Arraste para abrir/fechar</p>
            <input type="range" id="opv-slider" min="10" max="170" value="40" class="w-full h-2 bg-purple-100 rounded-lg appearance-none cursor-pointer accent-brand-purple">
        </div>

    </div>
    `;

                    const line2 = container.querySelector("#line-2");
                    const slider = container.querySelector("#opv-slider");
                    const lblTop = container.querySelector("#lbl-top");
                    const lblBot = container.querySelector("#lbl-bot");
                    const lblLeft = container.querySelector("#lbl-left");
                    const lblRight = container.querySelector("#lbl-right");

                    const update = () => {
                        angle = parseInt(slider.value);
                        // Line 1 fixa em 0 deg (horizontal)
                        // Line 2 rotaciona
                        line2.style.transform = `rotate(${angle}deg)`;

                        // √Çngulos
                        // Os angulos verticais (entre as retas)
                        const verticalAngle = angle;
                        const supplementAngle = 180 - angle;

                        lblTop.innerText = verticalAngle + "¬∞";
                        lblBot.innerText = verticalAngle + "¬∞"; // OPV

                        lblLeft.innerText = supplementAngle + "¬∞";
                        lblRight.innerText = supplementAngle + "¬∞"; // OPV
                    };

                    slider.oninput = update;
                    update();
                },

                interactive_ninja_bisector(container) {
                    // Configura√ß√£o
                    let targetAngle = 0;
                    let score = 0;
                    let isPlaying = false;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">
        
        <div class="flex justify-between w-full items-center mb-4 z-10">
            <h3 class="font-black uppercase text-xs tracking-widest text-green-400"><i class="fas fa-mask"></i> Dojo da Bissetriz</h3>
            <div class="bg-gray-800 px-3 py-1 rounded text-xs font-bold">Score: <span id="ninja-score" class="text-yellow-400">0</span></div>
        </div>

        <div class="relative w-full h-48 bg-gray-800 rounded-xl mb-4 overflow-hidden cursor-crosshair border-2 border-gray-600" id="dojo-canvas">
            
            <svg id="dojo-svg" width="100%" height="100%" class="absolute inset-0">
                <line x1="20" y1="180" x2="200" y2="180" stroke="white" stroke-width="2" />
                <line id="line-angle" x1="20" y1="180" x2="100" y2="20" stroke="white" stroke-width="2" />
                <path id="dojo-arc" fill="rgba(74, 222, 128, 0.2)" stroke="#4ade80" stroke-width="1" />

                <line id="user-cut" x1="20" y1="180" x2="200" y2="180" stroke="#facc15" stroke-width="2" stroke-dasharray="5,5" class="opacity-0" />
            </svg>

            <div id="feedback-txt" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-4xl font-black drop-shadow-lg hidden animate-pop-in">PERFEITO!</div>
        </div>

        <p class="text-center text-xs text-gray-400 mb-4">Mova o mouse e clique para cortar o √¢ngulo EXATAMENTE no meio.</p>
        <button id="btn-new-angle" class="bg-brand-green text-gray-900 font-bold py-2 px-6 rounded-full shadow-[0_0_15px_rgba(74,222,128,0.4)] animate-pulse">Novo Desafio</button>

    </div>
    `;

                    const canvas = container.querySelector("#dojo-canvas");
                    const svg = container.querySelector("#dojo-svg");
                    const lineAngle = container.querySelector("#line-angle");
                    const userCut = container.querySelector("#user-cut");
                    const dojoArc = container.querySelector("#dojo-arc");
                    const feedback = container.querySelector("#feedback-txt");
                    const btnNew = container.querySelector("#btn-new-angle");
                    const scoreEl = container.querySelector("#ninja-score");

                    const generateLevel = () => {
                        isPlaying = true;
                        feedback.classList.add("hidden");
                        userCut.classList.remove("opacity-0");

                        // Gera √¢ngulo entre 20 e 160
                        targetAngle = Math.floor(Math.random() * 140) + 20;

                        // Desenha linha do √¢ngulo
                        const len = 180;
                        const rad = -targetAngle * (Math.PI / 180);
                        const x2 = 20 + len * Math.cos(rad);
                        const y2 = 180 + len * Math.sin(rad); // SVG Y inverted, but rad negative fixes it

                        lineAngle.setAttribute("x2", x2);
                        lineAngle.setAttribute("y2", y2);

                        // Desenha arco de preenchimento
                        // M 20 180 L (base-end) A ...
                        // Simples path para preencher
                        dojoArc.setAttribute(
                            "d",
                            `M 20 180 L ${20 + 60} 180 A 60 60 0 0 0 ${20 + 60 * Math.cos(rad)
                            } ${180 + 60 * Math.sin(rad)} Z`
                        );
                    };

                    // Mouse Move Logic
                    canvas.onmousemove = (e) => {
                        if (!isPlaying) return;
                        const rect = canvas.getBoundingClientRect();
                        // Mouse relativo ao v√©rtice (20, 180)
                        const mx = e.clientX - rect.left - 20;
                        const my = e.clientY - rect.top - 180;

                        // Calcula √¢ngulo do mouse
                        let angle = Math.atan2(my, mx) * (180 / Math.PI);
                        if (angle > 0) angle = 0; // Trava se for pra baixo

                        // Atualiza linha pontilhada
                        const len = 200;
                        const userRad = angle * (Math.PI / 180);
                        userCut.setAttribute("x2", 20 + len * Math.cos(userRad));
                        userCut.setAttribute("y2", 180 + len * Math.sin(userRad));

                        userCut.dataset.angle = -angle; // Salva positivo
                    };

                    canvas.onclick = () => {
                        if (!isPlaying) return;
                        isPlaying = false;

                        const userAngle = parseFloat(userCut.dataset.angle || 0);
                        const perfectBisector = targetAngle / 2;
                        const diff = Math.abs(userAngle - perfectBisector);

                        let msg = "";
                        let color = "";

                        if (diff < 3) {
                            msg = "NINJA! ‚öîÔ∏è";
                            color = "text-brand-green";
                            score += 100;
                        } else if (diff < 8) {
                            msg = "BOM! üëç";
                            color = "text-brand-yellow";
                            score += 50;
                        } else {
                            msg = "ERROU! ‚ùå";
                            color = "text-brand-red";
                        }

                        scoreEl.innerText = score;
                        feedback.innerText = msg;
                        feedback.className = `absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-4xl font-black drop-shadow-lg animate-pop-in ${color}`;
                        feedback.classList.remove("hidden");

                        // Mostra a resposta certa (linha verde piscando)
                        const correctRad = -perfectBisector * (Math.PI / 180);
                        const cx = 20 + 180 * Math.cos(correctRad);
                        const cy = 180 + 180 * Math.sin(correctRad);

                        const correctLine = document.createElementNS(
                            "http://www.w3.org/2000/svg",
                            "line"
                        );
                        correctLine.setAttribute("x1", 20);
                        correctLine.setAttribute("y1", 180);
                        correctLine.setAttribute("x2", cx);
                        correctLine.setAttribute("y2", cy);
                        correctLine.setAttribute("stroke", "#4ade80");
                        correctLine.setAttribute("stroke-width", "3");
                        correctLine.setAttribute("class", "animate-pulse");
                        svg.appendChild(correctLine);

                        setTimeout(() => {
                            correctLine.remove();
                        }, 2000);
                    };

                    btnNew.onclick = generateLevel;
                    generateLevel();
                },

                interactive_parallel_city(container) {
                    // Estado
                    let selectedRelation = "none";

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Mapa das Rela√ß√µes</h3>

        <div class="flex gap-2 mb-6 flex-wrap justify-center">
            <button class="rel-btn px-3 py-1 rounded-full text-xs font-bold bg-white border border-gray-300 text-gray-500 hover:border-brand-blue hover:text-brand-blue transition-all" data-rel="corr">Correspondentes (F)</button>
            <button class="rel-btn px-3 py-1 rounded-full text-xs font-bold bg-white border border-gray-300 text-gray-500 hover:border-brand-green hover:text-brand-green transition-all" data-rel="alt">Alternos (Z)</button>
            <button class="rel-btn px-3 py-1 rounded-full text-xs font-bold bg-white border border-gray-300 text-gray-500 hover:border-brand-purple hover:text-brand-purple transition-all" data-rel="col">Colaterais (C)</button>
        </div>

        <div class="relative w-full max-w-sm h-64 bg-gray-50 rounded-xl border border-gray-200 overflow-hidden" id="city-map">
            <div class="absolute top-1/3 left-0 right-0 h-1 bg-gray-800"></div> <div class="absolute bottom-1/3 left-0 right-0 h-1 bg-gray-800"></div> <div class="absolute top-0 bottom-0 left-1/3 w-1 bg-brand-red transform rotate-12 origin-center scale-y-125"></div> <div class="angle-spot absolute top-[28%] left-[28%]" data-pos="TL">1</div>
            <div class="angle-spot absolute top-[28%] left-[38%]" data-pos="TR">2</div>
            <div class="angle-spot absolute top-[38%] left-[26%]" data-pos="BL">3</div>
            <div class="angle-spot absolute top-[38%] left-[36%]" data-pos="BR">4</div>

            <div class="angle-spot absolute bottom-[38%] left-[24%]" data-pos="TL2">5</div>
            <div class="angle-spot absolute bottom-[38%] left-[34%]" data-pos="TR2">6</div>
            <div class="angle-spot absolute bottom-[28%] left-[22%]" data-pos="BL2">7</div>
            <div class="angle-spot absolute bottom-[28%] left-[32%]" data-pos="BR2">8</div>

        </div>

        <div id="city-desc" class="mt-4 text-center text-sm font-bold text-gray-600 min-h-[40px]">
            Selecione um tipo de rela√ß√£o acima.
        </div>

        <style>
            .angle-spot {
                width: 24px; height: 24px; border-radius: 50%; 
                background: white; border: 2px solid #ccc; 
                display: flex; align-items: center; justify-content: center;
                font-size: 10px; font-weight: bold; color: #666;
                transition: all 0.3s;
            }
            .angle-spot.highlight { transform: scale(1.2); border-width: 0; color: white; }
        </style>
    </div>
    `;

                    const btns = container.querySelectorAll(".rel-btn");
                    const spots = container.querySelectorAll(".angle-spot");
                    const desc = container.querySelector("#city-desc");

                    const pairs = {
                        corr: [
                            ["1", "5"],
                            ["2", "6"],
                            ["3", "7"],
                            ["4", "8"],
                        ], // Correspondentes
                        alt: [
                            ["3", "6"],
                            ["4", "5"],
                            ["1", "8"],
                            ["2", "7"],
                        ], // Alternos (Internos e Externos)
                        col: [
                            ["3", "5"],
                            ["4", "6"],
                        ], // Colaterais Internos (mais comuns)
                    };

                    const colors = {
                        corr: "bg-brand-blue",
                        alt: "bg-brand-green",
                        col: "bg-brand-purple",
                    };

                    const texts = {
                        corr: "Est√£o na mesma posi√ß√£o relativa. S√£o congruentes (iguais).",
                        alt: "Alternam os lados da transversal. Formam o Z. S√£o congruentes.",
                        col: "Est√£o do mesmo lado, entre as paralelas. Somam 180¬∞.",
                    };

                    const highlight = (type) => {
                        // Reset
                        spots.forEach(
                            (s) =>
                            (s.className =
                                "angle-spot absolute " +
                                s.style.cssText
                                    .split(";")
                                    .filter(
                                        (x) =>
                                            x.includes("top") ||
                                            x.includes("left") ||
                                            x.includes("bottom")
                                    )
                                    .join(";"))
                        );

                        const color = colors[type];
                        const pList = pairs[type];

                        pList.forEach((pair, idx) => {
                            // Usa opacidade para distinguir pares diferentes
                            const opacity = idx === 0 ? "1" : "0.4";

                            pair.forEach((num) => {
                                const el = Array.from(spots).find((s) => s.innerText === num);
                                if (el) {
                                    el.classList.add("highlight", color);
                                    if (idx > 0)
                                        el.style.opacity = 0.5; // Diminui destaque de outros pares para focar num exemplo
                                    else el.style.opacity = 1;
                                }
                            });
                        });

                        desc.innerHTML = texts[type];
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            btns.forEach((b) =>
                                b.classList.remove("bg-gray-100", "ring-2")
                            );
                            btn.classList.add("bg-gray-100", "ring-2");
                            highlight(btn.dataset.rel);
                        };
                    });
                },

                interactive_angle_parking(container) {
                    // Cen√°rios: [Tipo, Ang1, Ang2(formula), Resposta]
                    // Ex: Correspondente: 50 e x -> x=50
                    // Ex: Colateral: 120 e x -> x=60
                    const scenarios = [
                        { type: "Correspondentes", a1: 60, target: 60, label: "x" },
                        { type: "Colaterais", a1: 110, target: 70, label: "x" }, // 180-110
                        { type: "Alternos", a1: 45, target: 45, label: "x" },
                        { type: "OPV", a1: 130, target: 130, label: "x" },
                    ];
                    let currentLvl = 0;

                    container.innerHTML = `
    <div class="bg-gray-800 border-4 border-gray-600 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">
        
        <h3 class="font-bold text-sm uppercase tracking-widest text-gray-400 mb-4">Estacionamento Geom√©trico</h3>

        <div class="relative w-full max-w-sm h-40 bg-gray-700 rounded-lg border-2 border-dashed border-gray-500 mb-6 overflow-hidden">
            <div class="absolute top-10 left-0 right-0 h-2 bg-white"></div>
            <div class="absolute bottom-10 left-0 right-0 h-2 bg-white"></div>
            <div class="absolute top-0 bottom-0 left-1/3 w-2 bg-yellow-400 transform rotate-[60deg] origin-center"></div>

            <div id="lbl-1" class="absolute bg-brand-blue px-2 rounded font-bold text-xs">60¬∞</div>
            <div id="lbl-2" class="absolute bg-brand-red px-2 rounded font-bold text-xs">x</div>
        </div>

        <p class="text-sm font-bold mb-4" id="park-hint">Se um √¢ngulo √© 60¬∞, qual o valor de x?</p>

        <div class="flex gap-4 w-full max-w-xs">
            <input type="number" id="park-input" class="flex-1 bg-gray-900 border-2 border-gray-500 rounded-lg p-2 text-center text-xl font-bold text-white outline-none focus:border-brand-green" placeholder="?">
            <button id="btn-park" class="bg-brand-green text-gray-900 font-bold px-6 rounded-lg hover:bg-green-400 transition-all shadow-lg active:scale-95">Estacionar</button>
        </div>

        <div id="park-feedback" class="h-8 mt-4 font-bold text-sm text-center"></div>
        
    </div>
    `;

                    const lbl1 = container.querySelector("#lbl-1");
                    const lbl2 = container.querySelector("#lbl-2");
                    const hint = container.querySelector("#park-hint");
                    const input = container.querySelector("#park-input");
                    const btn = container.querySelector("#btn-park");
                    const feedback = container.querySelector("#park-feedback");

                    const loadLevel = () => {
                        if (currentLvl >= scenarios.length) {
                            container.innerHTML = `<div class="p-8 text-center text-white"><h3 class="text-2xl font-black text-brand-green">Carteira de Motorista Tirada! üöó</h3><p class="mt-2 text-gray-400">Voc√™ domina as paralelas.</p></div>`;
                            return;
                        }

                        const s = scenarios[currentLvl];

                        // Posicionamento visual simplificado (hardcoded positions for demo)
                        // Alternar posi√ß√µes baseadas no tipo
                        if (s.type === "Correspondentes") {
                            lbl1.style.cssText = "top: 25px; left: 140px;";
                            lbl2.style.cssText = "bottom: 25px; left: 100px;"; // Posi√ß√£o correspondente visual aprox
                        } else if (s.type === "Colaterais") {
                            lbl1.style.cssText = "top: 50px; left: 150px;"; // Dentro dir
                            lbl2.style.cssText = "bottom: 50px; left: 120px;"; // Dentro dir (baixo)
                        } else {
                            lbl1.style.cssText = "top: 50px; left: 120px;";
                            lbl2.style.cssText = "bottom: 50px; left: 150px;"; // Alterno
                        }

                        lbl1.innerText = s.a1 + "¬∞";
                        lbl2.innerText = "x";
                        input.value = "";
                        feedback.innerText = "";
                    };

                    btn.onclick = () => {
                        const val = parseInt(input.value);
                        const correct = scenarios[currentLvl].target;

                        if (val === correct) {
                            feedback.innerHTML = `<span class="text-brand-green">Vaga Ocupada! ‚úÖ</span>`;
                            setTimeout(() => {
                                currentLvl++;
                                loadLevel();
                            }, 1000);
                        } else {
                            feedback.innerHTML = `<span class="text-brand-red">Batida! üí• Tente de novo.</span>`;
                            container
                                .querySelector(".bg-gray-800")
                                .classList.add("animate-shake");
                            setTimeout(
                                () =>
                                    container
                                        .querySelector(".bg-gray-800")
                                        .classList.remove("animate-shake"),
                                500
                            );
                        }
                    };

                    loadLevel();
                },

                interactive_triangle_180_proof(container) {
                    let state = 0; // 0: Normal, 1: Rasgado/Animado

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">A Prova Real</h3>
        
        <div class="relative w-full h-48 bg-gray-50 border border-gray-200 rounded-xl mb-6 flex items-end justify-center overflow-hidden">
            <div class="absolute bottom-10 left-4 right-4 h-0.5 bg-black/20"></div>
            
            <svg class="absolute inset-0 w-full h-full pointer-events-none" id="tri-svg">
                <path d="M 100 120 L 200 120 L 150 50 Z" fill="#e5e7eb" stroke="none" id="tri-base" class="transition-all duration-700"/>
            </svg>

            <div id="angle-a" class="absolute w-0 h-0 border-l-[25px] border-l-transparent border-r-[25px] border-r-transparent border-b-[40px] border-b-brand-green transition-all duration-1000 ease-in-out" style="left: 125px; top: 10px; transform-origin: bottom center;">
                <span class="absolute top-6 left-[-5px] text-[10px] font-bold text-white">A</span>
            </div>

            <div id="angle-b" class="absolute w-0 h-0 border-l-[30px] border-l-transparent border-r-[10px] border-r-transparent border-b-[30px] border-b-brand-blue transition-all duration-1000 ease-in-out" style="left: 60px; top: 90px; transform: rotate(-35deg); transform-origin: bottom left;">
                <span class="absolute top-4 left-[-10px] text-[10px] font-bold text-white">B</span>
            </div>

            <div id="angle-c" class="absolute w-0 h-0 border-l-[10px] border-l-transparent border-r-[30px] border-r-transparent border-b-[30px] border-b-brand-orange transition-all duration-1000 ease-in-out" style="left: 200px; top: 90px; transform: rotate(35deg); transform-origin: bottom right;">
                <span class="absolute top-4 left-[-5px] text-[10px] font-bold text-white">C</span>
            </div>
        </div>

        <button id="btn-tear" class="bg-brand-blue text-white font-bold py-3 px-8 rounded-xl shadow-btn active:scale-95 transition-all mb-4">
            ‚úÇÔ∏è Rasgar e Juntar Pontas
        </button>

        <p id="feedback-180" class="text-center text-sm font-bold text-gray-500 opacity-0 transition-opacity">
            Veja! Eles formam uma meia-lua perfeita (180¬∞).
        </p>
    </div>
    `;

                    const btn = container.querySelector("#btn-tear");
                    const angleA = container.querySelector("#angle-a"); // Top
                    const angleB = container.querySelector("#angle-b"); // Left
                    const angleC = container.querySelector("#angle-c"); // Right
                    const feedback = container.querySelector("#feedback-180");
                    const base = container.querySelector("#tri-base");

                    btn.onclick = () => {
                        if (state === 0) {
                            // ANIMAR: Juntar no centro inferior
                            // Coordenada alvo: Centro X ~150px, Bottom ~140px (na linha)

                            // A (Topo) -> Desce e vira
                            angleA.style.top = "100px"; // Desce
                            angleA.style.left = "125px";
                            angleA.style.transform = "rotate(0deg)"; // Fica em p√©

                            // B (Esq) -> Move pra direita e gira para encostar em A
                            angleB.style.top = "110px";
                            angleB.style.left = "95px"; // Encosta na esq de A
                            angleB.style.transform = "rotate(-80deg)"; // Ajuste visual para encaixe plano

                            // C (Dir) -> Move pra esquerda e gira
                            angleC.style.top = "110px";
                            angleC.style.left = "150px"; // Encosta na dir de A
                            angleC.style.transform = "rotate(80deg)";

                            // Esconde o corpo do tri√¢ngulo
                            base.style.opacity = "0.1";

                            feedback.classList.remove("opacity-0");
                            btn.innerText = "Reconstruir Tri√¢ngulo";
                            btn.classList.replace("bg-brand-blue", "bg-gray-500");
                            state = 1;
                        } else {
                            // RESET
                            // Posi√ß√µes originais aproximadas
                            angleA.style.top = "10px";
                            angleA.style.left = "125px";
                            angleA.style.transform = "rotate(0deg)";

                            angleB.style.top = "90px";
                            angleB.style.left = "60px";
                            angleB.style.transform = "rotate(-35deg)";

                            angleC.style.top = "90px";
                            angleC.style.left = "200px";
                            angleC.style.transform = "rotate(35deg)";

                            base.style.opacity = "1";
                            feedback.classList.add("opacity-0");
                            btn.innerText = "‚úÇÔ∏è Rasgar e Juntar Pontas";
                            btn.classList.replace("bg-gray-500", "bg-brand-blue");
                            state = 0;
                        }
                    };
                },

                interactive_external_angle(container) {
                    let angleA = 60;
                    let angleB = 60;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="relative w-full max-w-sm h-48 bg-gray-50 rounded-xl border border-gray-200 mb-6 flex items-end justify-center overflow-hidden">
            <svg width="300" height="180" viewBox="0 0 300 180" class="absolute bottom-0">
                <line x1="20" y1="150" x2="280" y2="150" stroke="#9CA3AF" stroke-width="2" stroke-dasharray="4" />
                
                <path id="tri-path-ext" d="" fill="none" stroke="#4B4B4B" stroke-width="3" />
                
                <path id="arc-in-a" d="" fill="#CE82FF" fill-opacity="0.3" stroke="#CE82FF" />
                <path id="arc-in-b" d="" fill="#1CB0F6" fill-opacity="0.3" stroke="#1CB0F6" />
                
                <path id="arc-ext" d="" fill="#FF9600" fill-opacity="0.3" stroke="#FF9600" />
                
                <text id="txt-a" x="0" y="0" font-size="12" font-weight="bold" fill="#A568CC">A</text>
                <text id="txt-b" x="0" y="0" font-size="12" font-weight="bold" fill="#1899D6">B</text>
                <text id="txt-ext" x="0" y="0" font-size="12" font-weight="bold" fill="#CC7A00">Ext</text>
            </svg>
        </div>

        <div class="flex gap-8 w-full justify-center mb-6">
            <div class="flex flex-col items-center">
                <label class="text-[10px] font-bold text-brand-purple uppercase">Interno A</label>
                <input type="range" id="slider-a-ext" min="20" max="100" value="60" class="w-24 h-2 bg-purple-100 rounded-lg accent-brand-purple">
                <span id="val-a-ext" class="font-bold text-brand-purple">60¬∞</span>
            </div>
            <div class="text-2xl text-gray-300 font-black">+</div>
            <div class="flex flex-col items-center">
                <label class="text-[10px] font-bold text-brand-blue uppercase">Interno B</label>
                <input type="range" id="slider-b-ext" min="20" max="100" value="60" class="w-24 h-2 bg-blue-100 rounded-lg accent-brand-blue">
                <span id="val-b-ext" class="font-bold text-brand-blue">60¬∞</span>
            </div>
        </div>

        <div class="bg-orange-50 border-l-4 border-brand-orange p-3 w-full max-w-sm flex justify-between items-center">
            <span class="text-xs font-bold text-orange-800 uppercase">√Çngulo Externo</span>
            <span id="res-ext" class="text-2xl font-black text-brand-orange">120¬∞</span>
        </div>

    </div>
    `;

                    // Seletores
                    const sA = container.querySelector("#slider-a-ext");
                    const sB = container.querySelector("#slider-b-ext");
                    const vA = container.querySelector("#val-a-ext");
                    const vB = container.querySelector("#val-b-ext");
                    const rE = container.querySelector("#res-ext");

                    // SVG Elems
                    const pathTri = container.querySelector("#tri-path-ext");
                    const arcA = container.querySelector("#arc-in-a");
                    const arcB = container.querySelector("#arc-in-b");
                    const arcExt = container.querySelector("#arc-ext");
                    const txtA = container.querySelector("#txt-a");
                    const txtB = container.querySelector("#txt-b");
                    const txtExt = container.querySelector("#txt-ext");

                    const update = () => {
                        angleA = parseInt(sA.value);
                        angleB = parseInt(sB.value);
                        const extAngle = angleA + angleB;

                        // Atualiza Texto
                        vA.innerText = angleA + "¬∞";
                        vB.innerText = angleB + "¬∞";
                        rE.innerText = extAngle + "¬∞";

                        // Geometria
                        // Base fixa no Y=150. V√©rtice C em (200, 150). V√©rtice A na esquerda.
                        // C √© o vertice do angulo externo.
                        // B √© o topo. A √© esquerda.
                        // Vamos desenhar: A ---- B ---- C (ext).
                        // Melhor: Base AC. O externo est√° em C. B √© o topo.
                        // √Çngulo em A = angleA. √Çngulo em B = angleB. √Çngulo em C (interno) = 180 - (A+B).

                        const cX = 200;
                        const cY = 150;
                        const baseLen = 140;

                        // Coordenadas A (Base esquerda)
                        // Precisamos calcular onde fica B (topo) baseado nos √¢ngulos A e C_interno.
                        // Usando Lei dos Senos para achar lados, ou geometria anal√≠tica simples.

                        // Vamos fixar C em (200, 150) e A em (60, 150). Base = 140.
                        const aX = 60;
                        const aY = 150;

                        // C √© o v√©rtice do externo? N√£o, o Teorema diz Ext = A + B.
                        // Ent√£o o externo deve estar no v√©rtice C.
                        // O interno C = 180 - (A+B).

                        // Achar B (x, y):
                        // tan(A) = h / x_seg1
                        // tan(C_int) = h / x_seg2
                        // x_seg1 + x_seg2 = 140
                        // h = x_seg1 * tanA => x_seg1 = h/tanA
                        // h = x_seg2 * tanC => x_seg2 = h/tanC
                        // h(1/tanA + 1/tanC) = 140 => h = 140 / (...)

                        const radA = (angleA * Math.PI) / 180;
                        const radB = (angleB * Math.PI) / 180; // Topo
                        const radCint = Math.PI - radA - radB; // Interno C

                        // Altura h
                        const h = baseLen / (1 / Math.tan(radA) + 1 / Math.tan(radCint));

                        // Proje√ß√£o de A at√© a altura (x_seg1)
                        const projA = h / Math.tan(radA);

                        const bX = aX + projA;
                        const bY = aY - h;

                        // Desenha Tri√¢ngulo
                        pathTri.setAttribute(
                            "d",
                            `M ${aX} ${aY} L ${bX} ${bY} L ${cX} ${cY} Z`
                        );

                        // Arcos
                        // Arco A
                        arcA.setAttribute("d", describeArc(aX, aY, 20, 0, -angleA));
                        txtA.setAttribute("x", aX + 25);
                        txtA.setAttribute("y", aY - 5);

                        // Arco B
                        // Angulo global da linha BA?
                        const angleBA = (Math.atan2(bY - aY, bX - aX) * 180) / Math.PI; // Negativo
                        // Angulo global da linha BC?
                        const angleBC = (Math.atan2(bY - cY, bX - cX) * 180) / Math.PI;
                        // Simplificado: apenas desenhar bolinha no topo
                        arcB.setAttribute(
                            "d",
                            `M ${bX} ${bY + 15} A 15 15 0 0 0 ${bX} ${bY + 15} Z`
                        ); // Hack visual, arco real √© complexo de calcular os vetores aqui r√°pido
                        txtB.setAttribute("x", bX);
                        txtB.setAttribute("y", bY - 10);

                        // Arco Externo (em C)
                        // Linha base √© 180. Linha CB sobe.
                        // Angulo da linha CB:
                        const angleCB = (Math.atan2(bY - cY, bX - cX) * 180) / Math.PI; // ex: -120
                        // O angulo externo come√ßa em 0 (direita, extens√£o da base) e vai at√© a linha CB (anti-horario? nao, sentido negativo)
                        // Externo √© suplementar do interno.

                        // O SVG tem Y invertido.
                        // Base est√° em 180 (esquerda) a 0 (direita).
                        // Linha CB tem √¢ngulo negativo (sobe para a esquerda). Ex: -135.
                        // Angulo interno C √© o angulo entre 180 e essa linha.
                        // Angulo externo √© entre 0 e essa linha.

                        // Para SVG Arc Path: startAngle = 0 (horizontal direita). EndAngle = angleCB.
                        // Aten√ß√£o com Y invertido e sweep flag.
                        arcExt.setAttribute("d", describeArc(cX, cY, 30, angleCB, 0));
                        txtExt.setAttribute("x", cX + 15);
                        txtExt.setAttribute("y", cY - 10);
                    };

                    // Helper para SVG Arc (x, y, radius, startAngle, endAngle)
                    function describeArc(x, y, radius, startAngle, endAngle) {
                        var start = polarToCartesian(x, y, radius, endAngle);
                        var end = polarToCartesian(x, y, radius, startAngle);
                        var largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
                        // Invertido para SVG Y
                        return [
                            "M",
                            start.x,
                            start.y,
                            "A",
                            radius,
                            radius,
                            0,
                            largeArcFlag,
                            0,
                            end.x,
                            end.y,
                        ].join(" ");
                    }

                    function polarToCartesian(
                        centerX,
                        centerY,
                        radius,
                        angleInDegrees
                    ) {
                        var angleInRadians = ((angleInDegrees - 90) * Math.PI) / 180.0; // -90 offset porque 0 √© topo no polar padrao, mas queremos 0 direita?
                        // Vamos usar Math standard: 0 = direita.
                        angleInRadians = (angleInDegrees * Math.PI) / 180.0;
                        return {
                            x: centerX + radius * Math.cos(angleInRadians),
                            y: centerY + radius * Math.sin(angleInRadians),
                        };
                    }

                    sA.addEventListener("input", update);
                    sB.addEventListener("input", update);
                    update();
                },

                interactive_triangle_explorer(container) {
                    // Estado inicial: Is√≥sceles
                    let topX = 150;
                    let topY = 50;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Classificador em Tempo Real</h3>

        <div class="relative w-full h-64 bg-gray-50 border border-gray-200 rounded-xl mb-4 cursor-crosshair touch-none" id="tri-canvas">
            <svg width="100%" height="100%" class="pointer-events-none">
                <path id="dyn-tri" d="M 50 200 L 250 200 L 150 50 Z" fill="rgba(28, 176, 246, 0.2)" stroke="#1CB0F6" stroke-width="3" stroke-linejoin="round" />
                
                <text id="lbl-side-a" x="150" y="220" font-size="10" text-anchor="middle" fill="#888">200</text>
                <text id="lbl-side-b" x="90" y="120" font-size="10" text-anchor="end" fill="#888">?</text>
                <text id="lbl-side-c" x="210" y="120" font-size="10" text-anchor="start" fill="#888">?</text>
            </svg>

            <div id="handle-top" class="absolute w-6 h-6 bg-brand-blue rounded-full border-2 border-white shadow-md cursor-grab active:cursor-grabbing transform -translate-x-1/2 -translate-y-1/2 hover:scale-110" style="left: 150px; top: 50px;"></div>
            
            <div class="absolute w-3 h-3 bg-gray-400 rounded-full left-[50px] top-[200px] transform -translate-x-1/2 -translate-y-1/2"></div>
            <div class="absolute w-3 h-3 bg-gray-400 rounded-full left-[250px] top-[200px] transform -translate-x-1/2 -translate-y-1/2"></div>
        </div>

        <div class="grid grid-cols-2 gap-4 w-full">
            <div class="bg-purple-50 p-3 rounded-lg border border-purple-200 text-center">
                <p class="text-[10px] uppercase font-bold text-gray-400">Classifica√ß√£o (Lados)</p>
                <p id="res-side" class="text-lg font-black text-brand-purple">Is√≥sceles</p>
            </div>
            <div class="bg-orange-50 p-3 rounded-lg border border-orange-200 text-center">
                <p class="text-[10px] uppercase font-bold text-gray-400">Classifica√ß√£o (√Çngulos)</p>
                <p id="res-angle" class="text-lg font-black text-brand-orange">Acut√¢ngulo</p>
            </div>
        </div>

        <p class="text-xs text-gray-400 mt-2 text-center">Arraste o ponto azul!</p>
    </div>
    `;

                    const canvas = container.querySelector("#tri-canvas");
                    const handle = container.querySelector("#handle-top");
                    const path = container.querySelector("#dyn-tri");
                    const resSide = container.querySelector("#res-side");
                    const resAngle = container.querySelector("#res-angle");
                    const lblA = container.querySelector("#lbl-side-a");
                    const lblB = container.querySelector("#lbl-side-b");
                    const lblC = container.querySelector("#lbl-side-c");

                    // Base fixa: (50, 200) e (250, 200). Comprimento = 200.
                    const A = { x: 50, y: 200 };
                    const B = { x: 250, y: 200 };

                    const update = (x, y) => {
                        // Limites
                        x = Math.max(10, Math.min(canvas.clientWidth - 10, x));
                        y = Math.max(10, Math.min(190, y)); // N√£o desce abaixo da base

                        handle.style.left = `${x}px`;
                        handle.style.top = `${y}px`;

                        // SVG Update
                        path.setAttribute(
                            "d",
                            `M ${A.x} ${A.y} L ${B.x} ${B.y} L ${x} ${y} Z`
                        );

                        // C√°lculos
                        const dist = (p1, p2) =>
                            Math.sqrt((p1.x - p2.x) ** 2 + (p1.y - p2.y) ** 2);

                        const sideC = 200; // Base
                        const sideB = dist(A, { x, y }); // Esquerda
                        const sideA = dist(B, { x, y }); // Direita

                        // Labels
                        lblB.setAttribute("x", (A.x + x) / 2 - 10);
                        lblB.setAttribute("y", (A.y + y) / 2);
                        lblB.textContent = Math.round(sideB);

                        lblC.setAttribute("x", (B.x + x) / 2 + 10);
                        lblC.setAttribute("y", (B.y + y) / 2);
                        lblC.textContent = Math.round(sideA);

                        // Classifica√ß√£o Lados
                        // Toler√¢ncia de 5px para facilitar "Equil√°tero"
                        const tol = 5;
                        let typeSide = "Escaleno";
                        if (
                            Math.abs(sideA - sideB) < tol &&
                            Math.abs(sideB - sideC) < tol
                        )
                            typeSide = "Equil√°tero";
                        else if (
                            Math.abs(sideA - sideB) < tol ||
                            Math.abs(sideB - sideC) < tol ||
                            Math.abs(sideA - sideC) < tol
                        )
                            typeSide = "Is√≥sceles";

                        resSide.innerText = typeSide;

                        // Classifica√ß√£o √Çngulos (Lei dos Cossenos)
                        // a¬≤ = b¬≤ + c¬≤ - 2bc cosA => cosA = (b¬≤ + c¬≤ - a¬≤) / 2bc
                        const getAngle = (a, b, c) =>
                            (Math.acos((b * b + c * c - a * a) / (2 * b * c)) * 180) /
                            Math.PI;

                        const angA = getAngle(sideA, sideB, sideC); // Topo
                        const angB = getAngle(sideB, sideA, sideC); // Base Dir
                        const angC = getAngle(sideC, sideA, sideB); // Base Esq (n√£o exato, apenas para l√≥gica maior)

                        const maxAngle = Math.max(angA, angB, 180 - angA - angB);

                        let typeAngle = "Acut√¢ngulo";
                        if (Math.abs(maxAngle - 90) < 3) typeAngle = "Ret√¢ngulo";
                        else if (maxAngle > 90) typeAngle = "Obtus√¢ngulo";

                        resAngle.innerText = typeAngle;
                    };

                    // Drag Logic
                    let isDragging = false;

                    const move = (e) => {
                        if (!isDragging) return;
                        const rect = canvas.getBoundingClientRect();
                        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                        update(clientX - rect.left, clientY - rect.top);
                    };

                    handle.onmousedown = () => (isDragging = true);
                    handle.ontouchstart = () => (isDragging = true);

                    window.addEventListener("mouseup", () => (isDragging = false));
                    window.addEventListener("touchend", () => (isDragging = false));
                    window.addEventListener("mousemove", move);
                    window.addEventListener("touchmove", move);

                    // Init
                    update(150, 50);
                },

                interactive_stick_builder(container) {
                    let a = 4,
                        b = 3,
                        c = 8; // Come√ßa imposs√≠vel (4+3 < 8)

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-red font-bold uppercase text-xs tracking-widest mb-4">Construtor de Tri√¢ngulos</h3>
        
        <div class="w-full h-32 relative bg-gray-50 border border-gray-200 rounded-xl mb-4 flex flex-col items-center justify-center overflow-hidden">
            <div id="bar-c" class="h-2 bg-gray-800 rounded-full transition-all duration-300 relative">
                <span class="absolute -bottom-5 left-1/2 -translate-x-1/2 text-xs font-bold text-gray-500">Base: <span id="val-c">8</span></span>
            </div>
            
            <div class="absolute w-full h-full flex justify-center items-center pointer-events-none">
                <div id="bar-a" class="h-2 bg-brand-blue rounded-full origin-left absolute transition-all duration-500 transform -rotate-12" style="left: calc(50% - 120px);"></div>
                
                <div id="bar-b" class="h-2 bg-brand-orange rounded-full origin-right absolute transition-all duration-500 transform rotate-12" style="right: calc(50% - 120px);"></div>
            </div>

            <div id="status-icon" class="absolute top-2 text-3xl opacity-0 transition-opacity">‚ùå</div>
        </div>

        <div class="space-y-4 w-full max-w-xs">
            <div class="flex items-center gap-2">
                <span class="text-xs font-bold text-brand-blue w-8">Esq</span>
                <input type="range" id="rng-a" min="1" max="10" value="4" class="flex-1 h-2 bg-blue-100 rounded-lg accent-brand-blue">
                <span class="text-xs font-bold text-brand-blue w-4" id="txt-a">4</span>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-xs font-bold text-brand-orange w-8">Dir</span>
                <input type="range" id="rng-b" min="1" max="10" value="3" class="flex-1 h-2 bg-orange-100 rounded-lg accent-brand-orange">
                <span class="text-xs font-bold text-brand-orange w-4" id="txt-b">3</span>
            </div>
            <div class="flex items-center gap-2 opacity-50 pointer-events-none">
                <span class="text-xs font-bold text-gray-500 w-8">Base</span>
                <input type="range" value="8" class="flex-1 h-2 bg-gray-300 rounded-lg" disabled>
                <span class="text-xs font-bold text-gray-500 w-4">8</span>
            </div>
        </div>

        <div id="exist-msg" class="mt-4 text-center font-bold text-sm text-brand-red bg-red-50 px-4 py-2 rounded-lg border border-red-200">
            N√£o fecha! 4 + 3 < 8
        </div>
    </div>
    `;

                    const barA = container.querySelector("#bar-a");
                    const barB = container.querySelector("#bar-b");
                    const barC = container.querySelector("#bar-c");
                    const msg = container.querySelector("#exist-msg");
                    const icon = container.querySelector("#status-icon");

                    const scale = 30; // 30px por unidade

                    const update = () => {
                        a = parseInt(container.querySelector("#rng-a").value);
                        b = parseInt(container.querySelector("#rng-b").value);
                        c = 8; // Base fixa para simplificar a visualiza√ß√£o

                        container.querySelector("#txt-a").innerText = a;
                        container.querySelector("#txt-b").innerText = b;

                        // Atualiza larguras visuais
                        barC.style.width = `${c * scale}px`;
                        barA.style.width = `${a * scale}px`;
                        barB.style.width = `${b * scale}px`;

                        // Ajusta posi√ß√£o inicial das barras A e B para as pontas de C
                        const offset = (c * scale) / 2;
                        barA.style.left = `calc(50% - ${offset}px)`;
                        barB.style.right = `calc(50% - ${offset}px)`;

                        // Verifica Exist√™ncia
                        if (a + b > c) {
                            // Fecha!
                            // Calcula altura do tri√¢ngulo para rotacionar as barras corretamente
                            // Heron para achar altura ou geometria b√°sica
                            // x = proje√ß√£o de A. x¬≤ + h¬≤ = a¬≤. (c-x)¬≤ + h¬≤ = b¬≤.
                            // a¬≤ - x¬≤ = b¬≤ - (c-x)¬≤ => a¬≤ - x¬≤ = b¬≤ - (c¬≤ - 2cx + x¬≤) => a¬≤ - b¬≤ + c¬≤ = 2cx
                            const x = (a * a - b * b + c * c) / (2 * c);
                            const h = Math.sqrt(a * a - x * x);

                            const angA = (Math.atan2(h, x) * 180) / Math.PI;
                            const angB = (Math.atan2(h, c - x) * 180) / Math.PI;

                            barA.style.transform = `rotate(${angA}deg)`;
                            barB.style.transform = `rotate(-${angB}deg)`; // Negativo pois origin right

                            msg.innerText = `Tri√¢ngulo Poss√≠vel! ${a} + ${b} > ${c}`;
                            msg.className =
                                "mt-4 text-center font-bold text-sm text-brand-green bg-green-50 px-4 py-2 rounded-lg border border-green-200";
                            icon.innerText = "‚úÖ";
                            icon.className =
                                "absolute top-2 text-3xl opacity-100 transition-opacity text-green-500 animate-pop-in";
                        } else {
                            // N√£o Fecha (Cai)
                            barA.style.transform = `rotate(0deg)`;
                            barB.style.transform = `rotate(0deg)`;

                            const diff = c - (a + b);
                            const gap =
                                diff > 0 ? `Faltam ${diff}` : "Encostam, mas n√£o sobem";

                            msg.innerText = `N√£o fecha! ${gap}.`;
                            msg.className =
                                "mt-4 text-center font-bold text-sm text-brand-red bg-red-50 px-4 py-2 rounded-lg border border-red-200";
                            icon.innerText = "‚ùå";
                            icon.className =
                                "absolute top-2 text-3xl opacity-100 transition-opacity text-red-500 animate-shake";
                        }
                    };

                    container.querySelector("#rng-a").oninput = update;
                    container.querySelector("#rng-b").oninput = update;
                    update();
                },

                interactive_poly_cave(container) {
                    let isConcave = false;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Caverna Geom√©trica</h3>
        
        <div class="relative w-64 h-64 bg-gray-50 border border-gray-200 rounded-xl mb-4 cursor-pointer group" id="poly-zone">
            <svg width="100%" height="100%">
                <polygon id="poly-shape" points="30,30 220,30 220,220 30,220" fill="#E8DAFF" stroke="#A568CC" stroke-width="4" stroke-linejoin="round" class="transition-all duration-500"/>
                
                <circle id="control-pt" cx="125" cy="125" r="8" fill="#A568CC" class="cursor-grab hover:scale-125 transition-transform" />
            </svg>
            <div class="absolute bottom-2 w-full text-center text-xs text-gray-400 font-bold opacity-0 group-hover:opacity-100 transition-opacity">Arraste o ponto roxo!</div>
        </div>

        <div id="poly-status" class="bg-green-100 text-green-700 px-6 py-2 rounded-full font-black uppercase text-xl shadow-sm transition-colors">
            CONVEXO
        </div>
    </div>
    `;

                    const shape = container.querySelector("#poly-shape");
                    const pt = container.querySelector("#control-pt");
                    const status = container.querySelector("#poly-status");
                    const zone = container.querySelector("#poly-zone");

                    // Estado do ponto m√≥vel (come√ßa no centro visual, mas n√£o afeta a forma inicialmente quadrada)
                    // Vamos fazer um pent√°gono onde o ponto m√≥vel √© o 5¬∫ v√©rtice.
                    // Base Quadrada Fixa: (30,30), (220,30), (220,220), (30,220).
                    // O ponto m√≥vel controla o v√©rtice entre (30,220) e (30,30)? Ou no topo?
                    // Vamos inserir o ponto m√≥vel na aresta superior.
                    // Pontos: (30,30) -> M√ìVEL -> (220,30) -> (220,220) -> (30,220).

                    let mx = 125,
                        my = 30; // Come√ßa alinhado (parece quadrado)

                    const updatePoly = (x, y) => {
                        // Limites
                        x = Math.max(30, Math.min(220, x));
                        y = Math.max(30, Math.min(220, y));

                        pt.setAttribute("cx", x);
                        pt.setAttribute("cy", y);

                        // Atualiza Pol√≠gono
                        // V√©rtices fixos
                        const p1 = "30,30"; // Top Left
                        const pM = `${x},${y}`; // M√≥vel
                        const p2 = "220,30"; // Top Right
                        const p3 = "220,220"; // Bottom Right
                        const p4 = "30,220"; // Bottom Left

                        shape.setAttribute("points", `${p1} ${pM} ${p2} ${p3} ${p4}`);

                        // Detec√ß√£o C√¥ncavo/Convexo
                        // Se Y > 30, ele entrou na figura (Cave)
                        if (y > 45) {
                            // Toler√¢ncia
                            status.innerText = "C√îNCAVO";
                            status.className =
                                "bg-purple-100 text-brand-purple px-6 py-2 rounded-full font-black uppercase text-xl shadow-sm transition-colors animate-pulse";
                            shape.setAttribute("fill", "#E8DAFF"); // Roxo
                            shape.setAttribute("stroke", "#A568CC");
                        } else {
                            status.innerText = "CONVEXO";
                            status.className =
                                "bg-green-100 text-green-700 px-6 py-2 rounded-full font-black uppercase text-xl shadow-sm transition-colors";
                            shape.setAttribute("fill", "#DCFCE7"); // Verde
                            shape.setAttribute("stroke", "#16A34A");
                        }
                    };

                    let dragging = false;
                    const move = (e) => {
                        if (!dragging) return;
                        const rect = zone.getBoundingClientRect();
                        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                        updatePoly(clientX - rect.left, clientY - rect.top);
                    };

                    pt.onmousedown = () => (dragging = true);
                    pt.ontouchstart = () => (dragging = true);
                    window.addEventListener("mouseup", () => (dragging = false));
                    window.addEventListener("touchend", () => (dragging = false));
                    window.addEventListener("mousemove", move);
                    window.addEventListener("touchmove", move);

                    // Init
                    updatePoly(125, 30);
                },

                interactive_polygon_slices(container) {
                    let sides = 5; // Pent√°gono

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Cortador de Pol√≠gonos</h3>
        
        <div class="flex items-center gap-4 mb-6">
            <button id="btn-less" class="w-10 h-10 bg-gray-100 rounded-full font-bold text-gray-600 hover:bg-gray-200">-</button>
            <div class="text-center">
                <div class="text-3xl font-black text-brand-text" id="sides-val">5</div>
                <div class="text-[10px] uppercase font-bold text-gray-400">Lados</div>
            </div>
            <button id="btn-more" class="w-10 h-10 bg-gray-100 rounded-full font-bold text-gray-600 hover:bg-gray-200">+</button>
        </div>

        <div class="relative w-64 h-64 mb-6">
            <svg width="100%" height="100%" viewBox="0 0 200 200">
                <polygon id="poly-s-shape" points="" fill="none" stroke="#4B4B4B" stroke-width="3" />
                <g id="tri-lines" stroke="#1CB0F6" stroke-width="2" stroke-dasharray="4"></g>
                <circle cx="100" cy="100" r="3" fill="red" id="center-pt" class="hidden"/>
            </svg>
        </div>

        <div class="bg-blue-50 p-4 rounded-xl border border-blue-200 w-full max-w-sm">
            <div class="flex justify-between items-center mb-2">
                <span class="text-xs font-bold text-blue-800 uppercase">Tri√¢ngulos</span>
                <span class="font-black text-xl text-brand-blue" id="tri-count">3</span>
            </div>
            <div class="w-full h-px bg-blue-200 mb-2"></div>
            <div class="text-center">
                <span class="text-xs text-gray-500 font-mono">Soma = Tri√¢ngulos √ó 180¬∞</span>
                <div class="text-2xl font-black text-brand-text mt-1" id="sum-res">540¬∞</div>
            </div>
        </div>
    </div>
    `;

                    const svgShape = container.querySelector("#poly-s-shape");
                    const svgLines = container.querySelector("#tri-lines");
                    const dispSides = container.querySelector("#sides-val");
                    const dispTri = container.querySelector("#tri-count");
                    const dispSum = container.querySelector("#sum-res");

                    const update = () => {
                        dispSides.innerText = sides;

                        // Gera Pol√≠gono Regular
                        const radius = 80;
                        const cx = 100,
                            cy = 100;
                        let points = [];

                        for (let i = 0; i < sides; i++) {
                            const angle = (i * 2 * Math.PI) / sides - Math.PI / 2; // Come√ßa no topo
                            const x = cx + radius * Math.cos(angle);
                            const y = cy + radius * Math.sin(angle);
                            points.push({ x, y });
                        }

                        svgShape.setAttribute(
                            "points",
                            points.map((p) => `${p.x},${p.y}`).join(" ")
                        );

                        // Triangula√ß√£o (Partindo do v√©rtice 0)
                        let linesHTML = "";
                        // Liga o v√©rtice 0 a todos os outros, exceto vizinhos (1 e last)
                        const v0 = points[0];

                        // Visualmente preenche com tri√¢ngulos coloridos transl√∫cidos?
                        // Simplesmente desenha as linhas
                        for (let i = 2; i < sides - 1; i++) {
                            const target = points[i];
                            linesHTML += `<line x1="${v0.x}" y1="${v0.y}" x2="${target.x}" y2="${target.y}" />`;
                        }
                        svgLines.innerHTML = linesHTML;

                        // C√°lculos
                        const triangles = sides - 2;
                        const sum = triangles * 180;

                        dispTri.innerText = triangles;
                        dispSum.innerText = sum + "¬∞";
                    };

                    container.querySelector("#btn-less").onclick = () => {
                        if (sides > 3) {
                            sides--;
                            update();
                        }
                    };
                    container.querySelector("#btn-more").onclick = () => {
                        if (sides < 10) {
                            sides++;
                            update();
                        }
                    };

                    update();
                },

                interactive_quadrant_explorer(container) {
                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Radar de Quadrantes</h3>
        
        <div class="relative w-64 h-64 bg-gray-50 rounded-full border-4 border-gray-200 shadow-inner overflow-hidden cursor-pointer" id="radar-bg">
            <div class="absolute top-0 bottom-0 left-1/2 w-0.5 bg-gray-400 -translate-x-1/2 z-10"></div>
            <div class="absolute left-0 right-0 top-1/2 h-0.5 bg-gray-400 -translate-y-1/2 z-10"></div>
            
            <div class="absolute top-0 right-0 w-1/2 h-1/2 hover:bg-blue-200/50 transition-colors flex items-center justify-center group q-area" data-q="1">
                <span class="text-2xl font-black text-brand-blue opacity-50 group-hover:opacity-100">1¬∫</span>
            </div>
            <div class="absolute top-0 left-0 w-1/2 h-1/2 hover:bg-orange-200/50 transition-colors flex items-center justify-center group q-area" data-q="2">
                <span class="text-2xl font-black text-brand-orange opacity-50 group-hover:opacity-100">2¬∫</span>
            </div>
            <div class="absolute bottom-0 left-0 w-1/2 h-1/2 hover:bg-green-200/50 transition-colors flex items-center justify-center group q-area" data-q="3">
                <span class="text-2xl font-black text-brand-green opacity-50 group-hover:opacity-100">3¬∫</span>
            </div>
            <div class="absolute bottom-0 right-0 w-1/2 h-1/2 hover:bg-purple-200/50 transition-colors flex items-center justify-center group q-area" data-q="4">
                <span class="text-2xl font-black text-brand-purple opacity-50 group-hover:opacity-100">4¬∫</span>
            </div>

            <div class="absolute top-1/2 left-1/2 w-3 h-3 bg-black rounded-full -translate-x-1/2 -translate-y-1/2 z-20 border-2 border-white"></div>
        </div>

        <div id="q-info" class="mt-4 text-center h-16 w-full max-w-xs bg-gray-100 rounded-xl p-2 flex flex-col justify-center border-2 border-transparent transition-colors">
            <span class="text-xs font-bold text-gray-400 uppercase">Passe o mouse ou toque</span>
            <span class="font-black text-lg text-gray-300">...</span>
        </div>
    </div>
    `;

                    const infoBox = container.querySelector("#q-info");
                    const areas = container.querySelectorAll(".q-area");

                    const data = {
                        1: {
                            title: "1¬∫ Quadrante",
                            signs: "(+, +)",
                            color: "border-brand-blue bg-blue-50 text-brand-blue",
                        },
                        2: {
                            title: "2¬∫ Quadrante",
                            signs: "(-, +)",
                            color: "border-brand-orange bg-orange-50 text-brand-orange",
                        },
                        3: {
                            title: "3¬∫ Quadrante",
                            signs: "(-, -)",
                            color: "border-brand-green bg-green-50 text-brand-green",
                        },
                        4: {
                            title: "4¬∫ Quadrante",
                            signs: "(+, -)",
                            color: "border-brand-purple bg-purple-50 text-brand-purple",
                        },
                    };

                    areas.forEach((area) => {
                        area.onmouseenter = () => {
                            const q = area.dataset.q;
                            const d = data[q];
                            infoBox.className = `mt-4 text-center h-16 w-full max-w-xs rounded-xl p-2 flex flex-col justify-center border-2 transition-all ${d.color}`;
                            infoBox.innerHTML = `<span class="text-xs font-bold uppercase opacity-70">${d.title}</span><span class="font-black text-2xl">${d.signs}</span>`;
                        };
                        // Para touch
                        area.onclick = area.onmouseenter;
                    });

                    // Reset ao sair do container
                    container.querySelector("#radar-bg").onmouseleave = () => {
                        infoBox.className =
                            "mt-4 text-center h-16 w-full max-w-xs bg-gray-100 rounded-xl p-2 flex flex-col justify-center border-2 border-transparent transition-colors";
                        infoBox.innerHTML = `<span class="text-xs font-bold text-gray-400 uppercase">Passe o mouse ou toque</span><span class="font-black text-lg text-gray-300">...</span>`;
                    };
                },

                interactive_coordinate_treasure(container) {
                    // Config
                    const gridSize = 5; // -5 a +5
                    let score = 0;
                    let target = { x: 2, y: 3 };

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative">
        
        <div class="flex justify-between w-full items-center mb-4 z-10 text-white">
            <div>
                <span class="text-[10px] font-bold uppercase text-gray-400 block">Alvo</span>
                <span class="text-2xl font-mono font-black text-brand-green" id="target-coords">(2, 3)</span>
            </div>
            <div class="text-right">
                <span class="text-[10px] font-bold uppercase text-gray-400 block">Score</span>
                <span class="text-xl font-black text-brand-yellow" id="treasure-score">0</span>
            </div>
        </div>

        <div class="relative bg-gray-800 rounded-xl border-2 border-gray-600 shadow-inner cursor-crosshair overflow-hidden" style="width: 280px; height: 280px;" id="treasure-map">
            <svg width="280" height="280" viewBox="0 0 280 280" class="pointer-events-none">
                <defs>
                    <pattern id="smallGrid" width="28" height="28" patternUnits="userSpaceOnUse">
                        <path d="M 28 0 L 0 0 0 28" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                    </pattern>
                </defs>
                <rect width="100%" height="100%" fill="url(#smallGrid)" />
                <line x1="140" y1="0" x2="140" y2="280" stroke="#4B5563" stroke-width="2" />
                <line x1="0" y1="140" x2="280" y2="140" stroke="#4B5563" stroke-width="2" />
                <circle cx="140" cy="140" r="3" fill="white" />
            </svg>
            <div id="feedback-marker" class="absolute w-4 h-4 -ml-2 -mt-2 rounded-full border-2 border-white hidden transition-all duration-500 z-20"></div>
        </div>

        <p class="text-gray-400 text-xs mt-4 text-center">Clique na intersec√ß√£o correta!</p>
    </div>
    `;

                    const map = container.querySelector("#treasure-map");
                    const targetEl = container.querySelector("#target-coords");
                    const scoreEl = container.querySelector("#treasure-score");
                    const marker = container.querySelector("#feedback-marker");

                    // Escala: 280px total, range -5 a 5 (total 10 unidades). 28px por unidade.
                    const unitPx = 28;
                    const centerPx = 140;

                    const nextTarget = () => {
                        // Gera coord inteira ou .5
                        const gen = () =>
                            Math.floor(Math.random() * 9) -
                            4 +
                            (Math.random() > 0.7 ? 0.5 : 0);
                        target = { x: gen(), y: gen() };
                        // Evita 0,0
                        if (target.x === 0 && target.y === 0) target.x = 1;

                        targetEl.innerText = `(${target.x}, ${target.y})`;
                    };

                    map.onclick = (e) => {
                        const rect = map.getBoundingClientRect();
                        const clickX = e.clientX - rect.left;
                        const clickY = e.clientY - rect.top;

                        // Converte pixel para coord
                        // X: (px - 140) / 28
                        // Y: (140 - px) / 28 (Y inverte)
                        const rawX = (clickX - centerPx) / unitPx;
                        const rawY = (centerPx - clickY) / unitPx;

                        // Dist√¢ncia do clique ao alvo
                        const dist = Math.sqrt(
                            Math.pow(rawX - target.x, 2) + Math.pow(rawY - target.y, 2)
                        );

                        // Feedback Visual (onde clicou)
                        marker.style.left = `${clickX}px`;
                        marker.style.top = `${clickY}px`;
                        marker.classList.remove(
                            "hidden",
                            "bg-green-500",
                            "bg-red-500",
                            "scale-150"
                        );

                        // Toler√¢ncia de 0.4 unidades
                        if (dist < 0.4) {
                            score += 100;
                            scoreEl.innerText = score;
                            targetEl.innerHTML = "<span class='text-white'>ACHOU!</span>";
                            marker.classList.add("bg-green-500", "scale-150");
                            setTimeout(nextTarget, 800);
                        } else {
                            score = Math.max(0, score - 20);
                            scoreEl.innerText = score;
                            marker.classList.add("bg-red-500");
                        }
                    };

                    nextTarget();
                },

                interactive_translation_game(container) {
                    let shipPos = { x: 1, y: 1 };
                    let basePos = { x: 4, y: 4 };

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-green font-bold uppercase text-xs tracking-widest mb-4">Controlador de Transla√ß√£o</h3>

        <div class="relative w-64 h-64 bg-gray-900 rounded-xl border-4 border-gray-700 mb-4 grid grid-cols-6 grid-rows-6" id="space-grid">
            </div>

        <div class="flex gap-4 w-full max-w-xs mb-4">
            <div class="flex-1">
                <label class="text-[10px] font-bold uppercase text-gray-400">Horizontal (X)</label>
                <input type="range" id="trans-x" min="0" max="5" value="1" class="w-full h-2 bg-blue-100 rounded-lg accent-brand-blue">
            </div>
            <div class="flex-1">
                <label class="text-[10px] font-bold uppercase text-gray-400">Vertical (Y)</label>
                <input type="range" id="trans-y" min="0" max="5" value="1" class="w-full h-2 bg-green-100 rounded-lg accent-brand-green">
            </div>
        </div>

        <div class="text-center font-mono text-sm bg-gray-100 p-2 rounded w-full">
            Posi√ß√£o: (<span id="pos-x" class="text-brand-blue font-bold">1</span>, <span id="pos-y" class="text-brand-green font-bold">1</span>)
        </div>
        <div id="trans-msg" class="h-6 mt-2 text-xs font-bold text-center text-brand-orange"></div>
    </div>
    `;

                    const grid = container.querySelector("#space-grid");
                    const inpX = container.querySelector("#trans-x");
                    const inpY = container.querySelector("#trans-y");
                    const dispX = container.querySelector("#pos-x");
                    const dispY = container.querySelector("#pos-y");
                    const msg = container.querySelector("#trans-msg");

                    // Gera Grid visual
                    for (let i = 0; i < 36; i++) {
                        const cell = document.createElement("div");
                        cell.className = "border border-gray-800";
                        grid.appendChild(cell);
                    }

                    const render = () => {
                        // Limpa
                        grid.querySelectorAll(".game-obj").forEach((e) => e.remove());

                        // Base
                        const base = document.createElement("div");
                        base.className =
                            "game-obj absolute w-8 h-8 bg-green-500/30 border-2 border-green-500 rounded-full flex items-center justify-center text-xs animate-pulse";
                        base.style.left = `${basePos.x * 16.66}%`;
                        base.style.bottom = `${basePos.y * 16.66}%`; // Grid Y sobe
                        base.style.marginLeft = "2px";
                        base.style.marginBottom = "2px";
                        base.innerText = "‚öë";
                        grid.appendChild(base);

                        // Nave
                        const ship = document.createElement("div");
                        ship.className =
                            "game-obj absolute w-8 h-8 flex items-center justify-center text-2xl transition-all duration-300 ease-out";
                        ship.style.left = `${shipPos.x * 16.66}%`;
                        ship.style.bottom = `${shipPos.y * 16.66}%`;
                        ship.innerText = "üöÄ";
                        grid.appendChild(ship);

                        dispX.innerText = shipPos.x;
                        dispY.innerText = shipPos.y;

                        if (shipPos.x === basePos.x && shipPos.y === basePos.y) {
                            msg.innerText = "BASE ALCAN√áADA!";
                            msg.className =
                                "h-6 mt-2 text-xs font-bold text-center text-brand-green scale-125 transition-transform";
                            // Reposiciona base aleatoriamente ap√≥s delay
                            setTimeout(() => {
                                basePos = {
                                    x: Math.floor(Math.random() * 6),
                                    y: Math.floor(Math.random() * 6),
                                };
                                render();
                            }, 1500);
                        } else {
                            msg.innerText = "";
                        }
                    };

                    const update = () => {
                        shipPos.x = parseInt(inpX.value);
                        shipPos.y = parseInt(inpY.value);
                        render();
                    };

                    inpX.oninput = update;
                    inpY.oninput = update;
                    render();
                },

                interactive_rotation_tetris(container) {
                    let angle = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="relative w-64 h-64 bg-gray-100 rounded-xl border-2 border-gray-300 mb-6 flex items-center justify-center overflow-hidden">
            <div class="absolute w-full h-px bg-gray-400"></div>
            <div class="absolute h-full w-px bg-gray-400"></div>
            
            <div id="rot-obj" class="absolute w-24 h-24 transition-transform duration-500 ease-in-out origin-center flex items-center justify-center">
                <div class="relative w-16 h-24">
                    <div class="absolute top-0 left-0 w-8 h-24 bg-brand-orange border-2 border-white rounded shadow-sm"></div>
                    <div class="absolute bottom-0 right-0 w-8 h-8 bg-brand-orange border-2 border-white rounded shadow-sm"></div>
                    <div class="absolute top-0 left-0 w-2 h-2 bg-black rounded-full -translate-x-1 -translate-y-1 z-10"></div> <span class="absolute -top-4 -left-4 font-bold text-xs text-gray-500">A</span>
                </div>
                <div class="absolute top-1/2 left-1/2 w-full h-px bg-red-400 -z-10 origin-left border-dashed border-t border-red-400 w-[200px]"></div>
            </div>
            
            <div class="absolute w-3 h-3 bg-black rounded-full z-20 border-2 border-white"></div>
        </div>

        <div class="flex gap-4 w-full justify-center">
            <button class="rot-btn bg-white border-2 border-gray-200 px-4 py-2 rounded-xl font-bold text-gray-600 hover:border-brand-purple hover:text-brand-purple transition-all active:scale-95 shadow-sm" data-a="0">0¬∞</button>
            <button class="rot-btn bg-white border-2 border-brand-purple px-4 py-2 rounded-xl font-bold text-brand-purple hover:bg-purple-50 transition-all active:scale-95 shadow-sm" data-a="90">90¬∞</button>
            <button class="rot-btn bg-white border-2 border-gray-200 px-4 py-2 rounded-xl font-bold text-gray-600 hover:border-brand-purple hover:text-brand-purple transition-all active:scale-95 shadow-sm" data-a="180">180¬∞</button>
            <button class="rot-btn bg-white border-2 border-gray-200 px-4 py-2 rounded-xl font-bold text-gray-600 hover:border-brand-purple hover:text-brand-purple transition-all active:scale-95 shadow-sm" data-a="270">270¬∞</button>
        </div>
        
        <p class="text-xs text-center text-gray-400 mt-4">Giro no sentido anti-hor√°rio (‚Üê)</p>

    </div>
    `;

                    const obj = container.querySelector("#rot-obj");
                    const btns = container.querySelectorAll(".rot-btn");

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            // Estilo bot√µes
                            btns.forEach(
                                (b) =>
                                (b.className =
                                    "rot-btn bg-white border-2 border-gray-200 px-4 py-2 rounded-xl font-bold text-gray-600 hover:border-brand-purple hover:text-brand-purple transition-all active:scale-95 shadow-sm")
                            );
                            btn.className =
                                "rot-btn bg-purple-100 border-2 border-brand-purple px-4 py-2 rounded-xl font-bold text-brand-purple transition-all active:scale-95 shadow-sm";

                            // Rota√ß√£o
                            angle = parseInt(btn.dataset.a);
                            // Negativo para sentido anti-hor√°rio no CSS visual (embora matem√°tico seja positivo, CSS roda hor√°rio por padr√£o)
                            obj.style.transform = `rotate(-${angle}deg)`;
                        };
                    });
                },

                interactive_symmetry_construction(container) {
                    // Pontos da figura esquerda (Original)
                    const leftPoints = [
                        { x: 1, y: 1 },
                        { x: 3, y: 1 },
                        { x: 3, y: 3 },
                        { x: 1, y: 3 }, // Um quadrado
                        { x: 1, y: 4 },
                        { x: 2, y: 5 }, // Uma "antena"
                    ];
                    // Pontos esperados na direita (Reflexo Eixo Y vertical no meio do grid 0-11, eixo em x=5.5? N√£o, vamos usar coordenada relativa)
                    // Vamos usar um grid 10x10. Eixo de simetria no meio (x=5).
                    // Pontos esquerdos (0-4). Pontos direitos (5-9).
                    // Ex: Ponto (3, 1). Distancia eixo = 5-3=2. Reflexo = 5+1+dist? N√£o.
                    // Espelho entre coluna 4 e 5.

                    // Simplifica√ß√£o visual: Grid 8x8. Eixo no meio.
                    // Esq: 0,1,2,3. Dir: 4,5,6,7.

                    let userPoints = [];
                    let isComplete = false;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full mb-4">
            <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest">Construtor</h3>
            <button id="btn-check-sym" class="bg-brand-green text-white px-4 py-1 rounded-full text-xs font-bold shadow-sm active:scale-95">Verificar</button>
        </div>

        <div class="relative bg-gray-100 border-2 border-gray-300 rounded-lg p-1" style="width: 260px; height: 260px;">
            <div class="absolute left-1/2 top-0 bottom-0 w-0.5 bg-brand-red border-l border-dashed border-white z-10"></div>
            
            <div class="grid grid-cols-8 grid-rows-8 gap-0.5 w-full h-full" id="sym-grid">
                </div>
        </div>

        <div id="sym-feedback" class="h-8 mt-4 font-bold text-sm text-center">Clique no lado direito para espelhar!</div>
    </div>
    `;

                    const grid = container.querySelector("#sym-grid");
                    const feedback = container.querySelector("#sym-feedback");
                    const btn = container.querySelector("#btn-check-sym");

                    // Mapa l√≥gico (8x8)
                    // Figura na esquerda (colunas 0, 1, 2, 3)
                    const shape = [
                        "1-1",
                        "1-2",
                        "2-1",
                        "2-2", // Quadrado
                        "1-3",
                        "0-4", // Antena
                    ];
                    // Reflexo esperado (colunas 4, 5, 6, 7). Eixo entre 3 e 4.
                    // Col 3 reflete em 4. Col 2 em 5. Col 1 em 6. Col 0 em 7.
                    // Formula: mirrorX = 7 - x
                    const solution = shape.map((id) => {
                        const [x, y] = id.split("-").map(Number);
                        return `${7 - x}-${y}`;
                    });

                    // Render Grid
                    for (let y = 7; y >= 0; y--) {
                        // Y cresce pra cima visualmente ou pra baixo? Vamos usar padr√£o array (0 topo)
                        for (let x = 0; x < 8; x++) {
                            const cell = document.createElement("div");
                            const id = `${x}-${y}`;
                            const isLeft = x < 4;

                            cell.className =
                                "bg-white rounded-sm cursor-pointer hover:bg-gray-200 transition-colors border border-gray-100";
                            cell.dataset.id = id;

                            // Desenha Esquerda (Fixo)
                            if (shape.includes(id)) {
                                cell.classList.add("bg-brand-blue");
                                cell.classList.remove(
                                    "bg-white",
                                    "hover:bg-gray-200",
                                    "cursor-pointer"
                                );
                            }

                            // L√≥gica Direita (Interativo)
                            if (!isLeft) {
                                cell.onclick = () => {
                                    if (isComplete) return;
                                    if (userPoints.includes(id)) {
                                        userPoints = userPoints.filter((p) => p !== id);
                                        cell.classList.remove("bg-brand-orange");
                                    } else {
                                        userPoints.push(id);
                                        cell.classList.add("bg-brand-orange");
                                    }
                                };
                            } else {
                                // Bloqueia clique na esquerda
                                cell.style.pointerEvents = "none";
                            }

                            grid.appendChild(cell);
                        }
                    }

                    btn.onclick = () => {
                        // Verifica se userPoints contem todos da solution e NENHUM extra
                        const correctCount = userPoints.filter((p) =>
                            solution.includes(p)
                        ).length;
                        const extraCount = userPoints.filter(
                            (p) => !solution.includes(p)
                        ).length;
                        const missingCount = solution.length - correctCount;

                        if (missingCount === 0 && extraCount === 0) {
                            isComplete = true;
                            feedback.innerHTML =
                                "<span class='text-brand-green'>Perfeito! Simetria exata.</span>";
                            btn.innerText = "Muito Bem!";
                            btn.disabled = true;
                            btn.classList.add("opacity-50");
                            // Anima√ß√£o de sucesso
                            userPoints.forEach((id) => {
                                const el = grid.querySelector(`[data-id="${id}"]`);
                                if (el) el.classList.add("bg-brand-green");
                            });
                        } else {
                            feedback.innerHTML = `<span class='text-brand-red'>Ops! Faltam ${missingCount} pontos e tem ${extraCount} errados.</span>`;
                            grid.classList.add("animate-shake");
                            setTimeout(() => grid.classList.remove("animate-shake"), 500);
                        }
                    };
                },

                interactive_tiling_area(container) {
                    let w = 4;
                    let h = 3;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Construtor de Pisos</h3>

        <div class="flex gap-8 mb-6">
            <div class="flex flex-col items-center">
                <span class="text-xs font-bold text-gray-400 uppercase">Base</span>
                <input type="range" id="tile-w" min="1" max="8" value="4" class="w-24 h-2 bg-blue-100 rounded-lg accent-brand-blue">
                <span id="disp-w" class="font-black text-brand-blue text-xl">4</span>
            </div>
            <div class="flex flex-col items-center">
                <span class="text-xs font-bold text-gray-400 uppercase">Altura</span>
                <input type="range" id="tile-h" min="1" max="6" value="3" class="w-24 h-2 bg-orange-100 rounded-lg accent-brand-orange">
                <span id="disp-h" class="font-black text-brand-orange text-xl">3</span>
            </div>
        </div>

        <div id="grid-floor" class="bg-gray-100 border-4 border-gray-400 rounded-lg p-1 gap-1 grid transition-all duration-300 shadow-inner mb-4">
        </div>

        <div class="bg-gray-800 text-white px-6 py-3 rounded-xl text-center shadow-lg">
            <p class="text-xs text-gray-400 uppercase font-bold mb-1">√Årea Total</p>
            <p class="text-2xl font-mono">
                <span class="text-brand-blue" id="math-w">4</span> √ó 
                <span class="text-brand-orange" id="math-h">3</span> = 
                <span class="text-brand-green font-black" id="math-total">12</span>
            </p>
        </div>
    </div>
    `;

                    const grid = container.querySelector("#grid-floor");
                    const dW = container.querySelector("#disp-w");
                    const dH = container.querySelector("#disp-h");
                    const mW = container.querySelector("#math-w");
                    const mH = container.querySelector("#math-h");
                    const mT = container.querySelector("#math-total");
                    const sW = container.querySelector("#tile-w");
                    const sH = container.querySelector("#tile-h");

                    const update = () => {
                        w = parseInt(sW.value);
                        h = parseInt(sH.value);

                        dW.innerText = w;
                        dH.innerText = h;
                        mW.innerText = w;
                        mH.innerText = h;
                        mT.innerText = w * h;

                        // Configura Grid CSS
                        grid.style.gridTemplateColumns = `repeat(${w}, 1fr)`;
                        grid.innerHTML = "";

                        // Tamanho din√¢mico do quadrado para caber no container
                        const size = Math.min(300 / w, 200 / h, 40);

                        for (let i = 0; i < w * h; i++) {
                            const tile = document.createElement("div");
                            tile.className =
                                "bg-blue-400 border border-white/50 rounded-sm shadow-sm animate-pop-in";
                            tile.style.width = `${size}px`;
                            tile.style.height = `${size}px`;
                            tile.style.animationDelay = `${i * 0.05}s`;
                            // N√∫mero sequencial para mostrar contagem
                            tile.innerHTML = `<div class="w-full h-full flex items-center justify-center text-[10px] text-white font-bold">${i + 1
                                }</div>`;
                            grid.appendChild(tile);
                        }
                    };

                    sW.oninput = update;
                    sH.oninput = update;
                    update();
                },

                interactive_parallelogram_cut(container) {
                    let step = 0; // 0: Normal, 1: Cut, 2: Move, 3: Rect

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Transformador de Formas</h3>
        
        <div class="relative w-[300px] h-[160px] bg-gray-50 rounded-xl border border-gray-200 mb-6 flex items-end justify-center overflow-hidden">
            <svg width="300" height="160" viewBox="0 0 300 160" class="absolute bottom-0">
                <rect x="100" y="40" width="100" height="80" fill="#CE82FF" stroke="#A855F7" stroke-width="2" />
                
                <path id="tri-left" d="M 60 120 L 100 120 L 100 40 Z" fill="#FF9600" stroke="#D97706" stroke-width="2" class="transition-all duration-1000 ease-in-out" />
                
                <path d="M 200 120 L 240 40 L 200 40 Z" fill="none" stroke="#D1D5DB" stroke-dasharray="4" stroke-width="2" />

                <text x="150" y="140" text-anchor="middle" font-size="12" fill="#6B7280" font-weight="bold">Base</text>
                <line x1="250" y1="40" x2="250" y2="120" stroke="#6B7280" stroke-width="1" />
                <text x="260" y="85" text-anchor="start" font-size="12" fill="#6B7280" font-weight="bold">Altura</text>
            </svg>
        </div>

        <button id="btn-transform" class="bg-brand-purple text-white font-bold py-3 px-8 rounded-xl shadow-btn active:scale-95 transition-all flex items-center gap-2">
            <i class="fas fa-magic"></i> Cortar e Mover
        </button>
        
        <p id="geo-feedback" class="text-sm text-gray-500 mt-4 text-center min-h-[20px]">
            Temos um Paralelogramo.
        </p>
    </div>
    `;

                    const tri = container.querySelector("#tri-left");
                    const btn = container.querySelector("#btn-transform");
                    const feedback = container.querySelector("#geo-feedback");

                    btn.onclick = () => {
                        if (step === 0) {
                            // Mover para a direita
                            tri.style.transform = "translateX(140px)"; // 60 -> 200 = +140
                            feedback.innerHTML =
                                "Movendo o tri√¢ngulo excedente para preencher a falta...";
                            btn.innerHTML = "<i class='fas fa-undo'></i> Restaurar";
                            btn.classList.replace("bg-brand-purple", "bg-gray-500");
                            step = 1;
                        } else {
                            // Reset
                            tri.style.transform = "translateX(0px)";
                            feedback.innerHTML = "Temos um Paralelogramo.";
                            btn.innerHTML = "<i class='fas fa-magic'></i> Cortar e Mover";
                            btn.classList.replace("bg-gray-500", "bg-brand-purple");
                            step = 0;
                        }
                    };
                },

                interactive_triangle_ninja(container) {
                    // Objetivo: √Årea = 24
                    const targetArea = 24;
                    let b = 6,
                        h = 4;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">
        
        <div class="flex justify-between w-full items-center mb-6 z-10">
            <h3 class="font-black text-brand-yellow uppercase text-xs tracking-widest">Dojo Geom√©trico</h3>
            <div class="bg-gray-800 px-3 py-1 rounded text-xs font-bold">Meta: √Årea ${targetArea}</div>
        </div>

        <div class="relative w-full h-48 bg-gray-800 rounded-xl border border-gray-600 mb-6 flex items-end justify-center overflow-hidden">
            <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(white 1px, transparent 1px); background-size: 20px 20px;"></div>
            
            <svg id="ninja-svg" width="100%" height="100%" class="z-10">
                <path id="tri-shape" d="" fill="rgba(34, 197, 94, 0.5)" stroke="#22C55E" stroke-width="3" stroke-linejoin="round" />
                <rect id="rect-ghost" x="0" y="0" width="0" height="0" fill="none" stroke="white" stroke-dasharray="5,5" opacity="0.3" />
            </svg>
            
            <div class="absolute bottom-2 right-2 font-mono text-sm text-gray-400">
                √Årea = <span id="ninja-area" class="text-white font-bold text-xl">12</span>
            </div>
        </div>

        <div class="flex gap-6 w-full max-w-sm mb-4 z-10">
            <div class="flex-1">
                <label class="text-[10px] uppercase font-bold text-gray-400">Base</label>
                <input type="range" id="range-b" min="2" max="12" value="6" class="w-full h-2 bg-gray-700 rounded-lg accent-brand-green">
                <div class="text-right font-mono font-bold" id="val-b">6</div>
            </div>
            <div class="flex-1">
                <label class="text-[10px] uppercase font-bold text-gray-400">Altura</label>
                <input type="range" id="range-h" min="2" max="10" value="4" class="w-full h-2 bg-gray-700 rounded-lg accent-brand-yellow">
                <div class="text-right font-mono font-bold" id="val-h">4</div>
            </div>
        </div>

        <div id="ninja-msg" class="h-8 text-center font-bold text-sm z-10"></div>
    </div>
    `;

                    const svg = container.querySelector("#ninja-svg");
                    const path = container.querySelector("#tri-shape");
                    const ghost = container.querySelector("#rect-ghost");
                    const rB = container.querySelector("#range-b");
                    const rH = container.querySelector("#range-h");
                    const vB = container.querySelector("#val-b");
                    const vH = container.querySelector("#val-h");
                    const vA = container.querySelector("#ninja-area");
                    const msg = container.querySelector("#ninja-msg");

                    const update = () => {
                        b = parseInt(rB.value);
                        h = parseInt(rH.value);
                        const area = (b * h) / 2;

                        vB.innerText = b;
                        vH.innerText = h;
                        vA.innerText = area;

                        // Desenhar SVG (escala 20px por unidade)
                        const scale = 20;
                        const wPx = b * scale;
                        const hPx = h * scale;

                        // Centraliza
                        const svgW = svg.clientWidth;
                        const svgH = svg.clientHeight;
                        const startX = (svgW - wPx) / 2;
                        const startY = svgH - 20; // 20px padding bottom

                        // Tri√¢ngulo Is√≥sceles
                        // Topo: startX + wPx/2, startY - hPx
                        const p1 = `${startX},${startY}`; // Bottom Left
                        const p2 = `${startX + wPx},${startY}`; // Bottom Right
                        const p3 = `${startX + wPx / 2},${startY - hPx}`; // Top Center

                        path.setAttribute("d", `M ${p1} L ${p2} L ${p3} Z`);

                        // Ret√¢ngulo Fantasma (Para mostrar que √© metade)
                        ghost.setAttribute("x", startX);
                        ghost.setAttribute("y", startY - hPx);
                        ghost.setAttribute("width", wPx);
                        ghost.setAttribute("height", hPx);

                        if (area === targetArea) {
                            path.setAttribute("fill", "rgba(34, 197, 94, 0.8)"); // Verde forte
                            path.setAttribute("stroke", "#fff");
                            msg.innerHTML =
                                "<span class='text-brand-green'>MISS√ÉO CUMPRIDA! ü•∑</span>";
                        } else {
                            path.setAttribute("fill", "rgba(34, 197, 94, 0.2)");
                            msg.innerText = "";
                        }
                    };

                    rB.oninput = update;
                    rH.oninput = update;
                    // Pequeno delay para garantir que o SVG tenha tamanho
                    setTimeout(update, 100);
                },

                interactive_rhombus_box(container) {
                    let d1 = 6;
                    let d2 = 4;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-6">Losango na Caixa</h3>

        <div class="relative w-[240px] h-[160px] bg-gray-100 border border-gray-300 flex items-center justify-center mb-6">
            <div id="box-rect" class="absolute bg-orange-100 border-2 border-dashed border-gray-400 box-content transition-all duration-300"></div>
            
            <svg width="100%" height="100%" class="absolute top-0 left-0 z-10 overflow-visible">
                <polygon id="poly-rhombus" points="" fill="rgba(255, 150, 0, 0.6)" stroke="#EA580C" stroke-width="3" class="transition-all duration-300" />
                <line id="line-d1" stroke="white" stroke-width="2" stroke-dasharray="4,2" />
                <line id="line-d2" stroke="white" stroke-width="2" stroke-dasharray="4,2" />
            </svg>
        </div>

        <div class="flex gap-6 w-full max-w-xs mb-4">
            <div class="flex-1">
                <label class="text-[10px] uppercase font-bold text-gray-400">Diagonal Maior (D)</label>
                <input type="range" id="sld-d1" min="4" max="10" value="6" class="w-full h-2 bg-gray-200 rounded-lg accent-brand-orange">
                <div class="text-center font-bold text-brand-orange" id="txt-d1">6</div>
            </div>
            <div class="flex-1">
                <label class="text-[10px] uppercase font-bold text-gray-400">Diagonal Menor (d)</label>
                <input type="range" id="sld-d2" min="2" max="6" value="4" class="w-full h-2 bg-gray-200 rounded-lg accent-brand-orange">
                <div class="text-center font-bold text-brand-orange" id="txt-d2">4</div>
            </div>
        </div>

        <div class="bg-orange-50 border border-orange-200 rounded-lg p-3 text-center w-full">
            <p class="text-xs text-orange-800 font-bold mb-1">C√°lculo da √Årea</p>
            <p class="font-mono text-lg">
                <span class="text-gray-500 text-sm">Ret√¢ngulo: <span id="calc-rect">24</span></span> 
                <span class="mx-2">|</span>
                Losango: <strong class="text-brand-orange" id="calc-rhombus">12</strong>
            </p>
            <p class="text-[10px] text-orange-600 mt-1 italic">O losango √© sempre metade do ret√¢ngulo!</p>
        </div>

    </div>
    `;

                    const poly = container.querySelector("#poly-rhombus");
                    const box = container.querySelector("#box-rect");
                    const lineD1 = container.querySelector("#line-d1");
                    const lineD2 = container.querySelector("#line-d2");
                    const sldD1 = container.querySelector("#sld-d1");
                    const sldD2 = container.querySelector("#sld-d2");
                    const txtD1 = container.querySelector("#txt-d1");
                    const txtD2 = container.querySelector("#txt-d2");
                    const cRect = container.querySelector("#calc-rect");
                    const cRhomb = container.querySelector("#calc-rhombus");

                    const update = () => {
                        d1 = parseInt(sldD1.value);
                        d2 = parseInt(sldD2.value);

                        txtD1.innerText = d1;
                        txtD2.innerText = d2;

                        const scale = 20;
                        const w = d1 * scale;
                        const h = d2 * scale;

                        // Centraliza
                        const cx = 120; // Container width/2
                        const cy = 80; // Container height/2

                        // Atualiza Box
                        box.style.width = `${w}px`;
                        box.style.height = `${h}px`;
                        box.style.left = `${cx - w / 2}px`;
                        box.style.top = `${cy - h / 2}px`;

                        // Atualiza Losango
                        // Top, Right, Bottom, Left
                        const p1 = `${cx},${cy - h / 2}`;
                        const p2 = `${cx + w / 2},${cy}`;
                        const p3 = `${cx},${cy + h / 2}`;
                        const p4 = `${cx - w / 2},${cy}`;

                        poly.setAttribute("points", `${p1} ${p2} ${p3} ${p4}`);

                        // Diagonais
                        lineD1.setAttribute("x1", cx - w / 2);
                        lineD1.setAttribute("y1", cy);
                        lineD1.setAttribute("x2", cx + w / 2);
                        lineD1.setAttribute("y2", cy);

                        lineD2.setAttribute("x1", cx);
                        lineD2.setAttribute("y1", cy - h / 2);
                        lineD2.setAttribute("x2", cx);
                        lineD2.setAttribute("y2", cy + h / 2);

                        // C√°lculos
                        const areaR = d1 * d2;
                        const areaL = areaR / 2;
                        cRect.innerText = areaR;
                        cRhomb.innerText = areaL;
                    };

                    sldD1.oninput = update;
                    sldD2.oninput = update;
                    update();
                },

                interactive_volume_crane(container) {
                    let layers = 1;
                    const w = 3;
                    const d = 3;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-4">
            <h3 class="text-brand-green font-bold uppercase text-xs tracking-widest">Guindaste de Volume</h3>
            <div class="bg-green-50 text-green-700 px-3 py-1 rounded-full text-xs font-black">Volume: <span id="vol-count">9</span></div>
        </div>

        <div class="perspective-container relative w-64 h-64 border-b-4 border-gray-300 bg-blue-50/50 rounded-xl mb-6 flex items-center justify-center" style="perspective: 800px;">
            
            <div id="block-scene" class="relative transition-transform duration-500" style="transform-style: preserve-3d; transform: rotateX(-20deg) rotateY(45deg);">
                <div class="absolute w-[90px] h-[90px] bg-white/50 border border-gray-300" style="transform: translateZ(-15px) rotateX(90deg) translate(-50%, -50%);"></div>
                
                <div id="layers-group" class="relative" style="transform-style: preserve-3d;"></div>
            </div>

        </div>

        <div class="flex items-center gap-4 w-full max-w-xs">
            <button id="btn-rem-layer" class="w-12 h-12 bg-gray-200 rounded-xl font-black text-gray-600 hover:bg-red-100 hover:text-red-500 transition-colors shadow-sm">-</button>
            <div class="flex-1 text-center">
                <p class="text-[10px] text-gray-400 font-bold uppercase">Altura (h)</p>
                <p class="text-3xl font-black text-brand-green" id="h-disp">1</p>
            </div>
            <button id="btn-add-layer" class="w-12 h-12 bg-brand-green text-white rounded-xl font-black shadow-btn active:scale-95 transition-all">+</button>
        </div>

        <div class="mt-4 text-center text-xs text-gray-500 font-mono bg-gray-100 p-2 rounded">
            Base (${w}x${d} = 9) √ó Altura (<span id="h-calc">1</span>)
        </div>

    </div>
    `;

                    const scene = container.querySelector("#layers-group");
                    const hDisp = container.querySelector("#h-disp");
                    const hCalc = container.querySelector("#h-calc");
                    const vCount = container.querySelector("#vol-count");

                    // CSS 3D
                    const style = document.createElement("style");
                    style.innerHTML = `
        .cube-unit { position: absolute; width: 30px; height: 30px; transform-style: preserve-3d; }
        .c-face { position: absolute; width: 30px; height: 30px; border: 1px solid rgba(0,0,0,0.1); }
        .c-front { transform: translateZ(15px); background: #86EFAC; } /* Green-300 */
        .c-top { transform: rotateX(90deg) translateZ(15px); background: #4ADE80; } /* Green-400 */
        .c-right { transform: rotateY(90deg) translateZ(15px); background: #22C55E; } /* Green-500 */
    `;
                    container.appendChild(style);

                    const render = () => {
                        scene.innerHTML = "";
                        const size = 30;
                        const offset = 45; // Centro 1.5 * 30

                        for (let z = 0; z < layers; z++) {
                            for (let y = 0; y < d; y++) {
                                for (let x = 0; x < w; x++) {
                                    const el = document.createElement("div");
                                    el.className = "cube-unit";

                                    // X horizontal, Y profundidade (Z visual), Z altura (Y visual invertido)
                                    // Transforma√ß√µes 3D CSS
                                    const tx = x * size - offset + 15;
                                    const tz = y * size - offset + 15;
                                    const ty = -(z * size) + offset; // Cresce pra cima (Y negativo)

                                    // Anima√ß√£o de queda para a √∫ltima camada
                                    const isNewLayer = z === layers - 1;
                                    const animClass = isNewLayer ? "animate-bounce" : "";

                                    el.style.transform = `translateX(${tx}px) translateY(${ty}px) translateZ(${tz}px)`;

                                    el.innerHTML = `
                        <div class="c-face c-front"></div>
                        <div class="c-face c-top"></div>
                        <div class="c-face c-right"></div>
                    `;
                                    scene.appendChild(el);
                                }
                            }
                        }

                        hDisp.innerText = layers;
                        hCalc.innerText = layers;
                        vCount.innerText = layers * 9;
                    };

                    container.querySelector("#btn-add-layer").onclick = () => {
                        if (layers < 5) {
                            layers++;
                            render();
                        }
                    };
                    container.querySelector("#btn-rem-layer").onclick = () => {
                        if (layers > 1) {
                            layers--;
                            render();
                        }
                    };

                    render();
                },

                interactive_unit_zoom_2d(container) {
                    let zoomed = false;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Zoom: m¬≤ vs dm¬≤</h3>

        <div class="relative w-64 h-64 bg-gray-100 border-4 border-gray-800 shadow-xl overflow-hidden cursor-pointer group" id="zoom-container">
            
            <div id="big-square" class="absolute inset-0 bg-blue-500 flex items-center justify-center transition-all duration-1000 ease-in-out">
                <span class="text-white font-black text-4xl group-hover:scale-110 transition-transform">1 m¬≤</span>
                
                <div id="small-grid" class="absolute inset-0 grid grid-cols-10 grid-rows-10 opacity-0 transition-opacity duration-1000">
                    ${[...Array(100)]
                            .map(
                                () =>
                                    `<div class="border border-white/20 bg-blue-600/50"></div>`
                            )
                            .join("")}
                </div>
            </div>

            <div class="absolute bottom-2 right-2 text-white bg-black/50 px-2 py-1 rounded text-xs font-bold pointer-events-none">
                <i class="fas fa-search"></i> Clique para Zoom
            </div>
        </div>

        <div class="mt-6 text-center">
            <div id="zoom-text" class="text-2xl font-black text-gray-700">1 Quadrado Grande</div>
            <div id="zoom-sub" class="text-sm text-gray-500 font-bold">Lado = 1 metro</div>
        </div>

    </div>
    `;

                    const box = container.querySelector("#zoom-container");
                    const big = container.querySelector("#big-square");
                    const grid = container.querySelector("#small-grid");
                    const txt = container.querySelector("#zoom-text");
                    const sub = container.querySelector("#zoom-sub");

                    box.onclick = () => {
                        zoomed = !zoomed;

                        if (zoomed) {
                            // Zoom In
                            big.style.transform = "scale(3)"; // Simula aproximar
                            grid.classList.remove("opacity-0"); // Mostra os quadradinhos

                            txt.innerText = "100 Quadradinhos (dm¬≤)";
                            txt.classList.add("text-brand-blue");
                            sub.innerText = "10 fileiras de 10 (10 x 10)";
                        } else {
                            // Zoom Out
                            big.style.transform = "scale(1)";
                            grid.classList.add("opacity-0");

                            txt.innerText = "1 Quadrado Grande (m¬≤)";
                            txt.classList.remove("text-brand-blue");
                            sub.innerText = "Lado = 1 metro";
                        }
                    };
                },

                interactive_liquid_lab(container) {
                    let filled = false;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Cubo vs Litro</h3>

        <div class="flex gap-8 items-end justify-center w-full mb-8">
            
            <div class="flex flex-col items-center gap-2">
                <div class="relative w-24 h-24 border-4 border-gray-800 bg-transparent perspective-container" style="perspective: 400px;">
                    <div id="cube-water" class="absolute bottom-0 left-0 w-full bg-blue-400 opacity-80 transition-all duration-1000 ease-out" style="height: 0%;"></div>
                    
                    <div class="absolute inset-0 border border-white/30 bg-blue-100/10 backdrop-blur-[1px]"></div>
                    <span class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 font-bold text-gray-500 z-10 text-xs">1 dm¬≥</span>
                </div>
                <span class="text-xs font-bold text-gray-400 uppercase">Cubo (10cm)</span>
            </div>

            <i class="fas fa-arrow-right text-gray-300 text-2xl mb-10" id="flow-arrow"></i>

            <div class="flex flex-col items-center gap-2">
                <div class="relative w-16 h-32 bg-gray-100 rounded-t-3xl rounded-b-xl border-4 border-gray-400 overflow-hidden">
                     <div id="bottle-water" class="absolute bottom-0 left-0 w-full bg-blue-500 transition-all duration-1000 ease-out delay-100" style="height: 0%;"></div>
                     <div class="absolute top-4 left-0 w-full h-px bg-gray-300"></div>
                     <div class="absolute top-8 left-0 w-full h-px bg-gray-300"></div>
                     <div class="absolute top-12 left-0 w-full h-px bg-gray-300"></div>
                </div>
                <span class="text-xs font-bold text-gray-400 uppercase">1 Litro</span>
            </div>

        </div>

        <button id="btn-pour" class="w-full max-w-xs bg-brand-blue text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all">
            <i class="fas fa-faucet"></i> Encher e Comparar
        </button>

        <p id="lab-msg" class="mt-4 text-sm font-bold text-center h-6"></p>

    </div>
    `;

                    const btn = container.querySelector("#btn-pour");
                    const cWater = container.querySelector("#cube-water");
                    const bWater = container.querySelector("#bottle-water");
                    const msg = container.querySelector("#lab-msg");

                    btn.onclick = () => {
                        filled = !filled;

                        if (filled) {
                            btn.innerHTML = "<i class='fas fa-undo'></i> Esvaziar";
                            btn.classList.replace("bg-brand-blue", "bg-red-500");

                            cWater.style.height = "100%";
                            bWater.style.height = "90%"; // Garrafa enche

                            msg.innerHTML =
                                "Eles cabem a <span class='text-brand-green'>MESMA</span> quantidade!";
                            msg.classList.add("animate-pop-in");
                        } else {
                            btn.innerHTML =
                                "<i class='fas fa-faucet'></i> Encher e Comparar";
                            btn.classList.replace("bg-red-500", "bg-brand-blue");

                            cWater.style.height = "0%";
                            bWater.style.height = "0%";
                            msg.innerHTML = "";
                        }
                    };
                },

                interactive_mean_leveler(container) {
                    // Estado inicial: alturas das colunas
                    let cols = [2, 8, 4, 6];

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-6">
            <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest">Nivelador de M√©dia</h3>
            <div class="bg-blue-50 text-brand-blue px-3 py-1 rounded-full text-xs font-black">Soma: <span id="sum-val">20</span></div>
        </div>

        <div class="relative w-full h-48 bg-gray-50 border-b-4 border-gray-300 flex items-end justify-around px-4 mb-4 overflow-hidden" id="cols-container">
            </div>

        <div class="flex flex-col items-center gap-2 mb-4 w-full">
            <p class="text-xs text-gray-400 font-bold uppercase">Qual ser√° a altura se nivelarmos?</p>
            <div class="flex gap-2 w-full max-w-xs">
                <input type="number" id="guess-input" class="flex-1 border-2 border-brand-blue rounded-lg text-center font-bold text-xl outline-none p-2 text-brand-text" placeholder="?">
                <button id="btn-level" class="bg-brand-green text-white font-bold py-2 px-6 rounded-lg shadow-btn active:translate-y-1 active:shadow-none transition-all">NIVELAR</button>
            </div>
        </div>

        <div id="mean-feedback" class="h-8 font-bold text-sm text-center"></div>

        <button id="btn-new-cols" class="mt-2 text-xs font-bold text-gray-400 hover:text-brand-blue underline">Novos Blocos</button>

    </div>
    `;

                    const colsContainer = container.querySelector("#cols-container");
                    const sumVal = container.querySelector("#sum-val");
                    const guessInput = container.querySelector("#guess-input");
                    const btnLevel = container.querySelector("#btn-level");
                    const btnNew = container.querySelector("#btn-new-cols");
                    const feedback = container.querySelector("#mean-feedback");

                    const renderCols = (animate = false) => {
                        colsContainer.innerHTML = "";
                        const maxH = Math.max(...cols, 10);

                        // Linha da m√©dia (invis√≠vel inicialmente)
                        const mean = cols.reduce((a, b) => a + b, 0) / cols.length;
                        const meanH = (mean / maxH) * 100;

                        const meanLine = document.createElement("div");
                        meanLine.className =
                            "absolute left-0 right-0 border-t-2 border-dashed border-brand-red opacity-0 transition-opacity duration-1000 z-10 flex items-end justify-end pr-2";
                        meanLine.style.bottom = `${meanH}%`;
                        meanLine.id = "mean-line";
                        meanLine.innerHTML = `<span class="text-brand-red text-xs font-bold bg-white px-1">M√©dia: ${mean}</span>`;
                        colsContainer.appendChild(meanLine);

                        cols.forEach((h, i) => {
                            const col = document.createElement("div");
                            // Altura em %
                            const heightPct = (h / maxH) * 100;

                            col.className = `w-12 bg-brand-blue border-x-2 border-t-2 border-blue-600 rounded-t-lg relative flex items-center justify-center text-white font-bold transition-all duration-1000 ease-in-out shadow-sm`;
                            col.style.height = `${heightPct}%`;
                            col.innerText = h;

                            if (animate) {
                                // Se animar, ajusta altura para a m√©dia
                                setTimeout(() => {
                                    col.style.height = `${meanH}%`;
                                    col.innerText = mean;
                                    col.classList.replace("bg-brand-blue", "bg-brand-green");
                                    col.classList.replace(
                                        "border-blue-600",
                                        "border-green-600"
                                    );
                                }, 100);
                            }

                            colsContainer.appendChild(col);
                        });
                    };

                    const newGame = () => {
                        // Gera 4 n√∫meros que somam um m√∫ltiplo de 4 (para m√©dia inteira)
                        // Estrat√©gia: Gera m√©dia alvo (ex: 5), multiplica por 4 (20), distribui aleatoriamente.
                        const targetMean = Math.floor(Math.random() * 5) + 3; // 3 a 7
                        const total = targetMean * 4;

                        // Distribui
                        let parts = [0, 0, 0, 0];
                        let remaining = total;

                        // Preenche base m√≠nima
                        parts = parts.map(() => 1);
                        remaining -= 4;

                        // Distribui o resto
                        for (let i = 0; i < remaining; i++) {
                            const idx = Math.floor(Math.random() * 4);
                            parts[idx]++;
                        }

                        cols = parts;
                        sumVal.innerText = total;
                        guessInput.value = "";
                        guessInput.disabled = false;
                        btnLevel.disabled = false;
                        btnLevel.classList.remove("opacity-50");
                        feedback.innerText = "";

                        renderCols(false);
                    };

                    btnLevel.onclick = () => {
                        const guess = parseInt(guessInput.value);
                        const actualMean = cols.reduce((a, b) => a + b, 0) / cols.length;

                        if (guess === actualMean) {
                            feedback.innerHTML = `<span class="text-brand-green">Exato! ${cols.reduce(
                                (a, b) => a + b,
                                0
                            )} √∑ 4 = ${actualMean}</span>`;
                            // Anima√ß√£o de nivelamento
                            renderCols(true);
                            container
                                .querySelector("#mean-line")
                                .classList.remove("opacity-0");
                            btnLevel.disabled = true;
                            btnLevel.classList.add("opacity-50");
                        } else {
                            feedback.innerHTML = `<span class="text-brand-red">Tente de novo. Dica: Divida a Soma pela Quantidade.</span>`;
                            guessInput.classList.add("animate-shake");
                            setTimeout(
                                () => guessInput.classList.remove("animate-shake"),
                                500
                            );
                        }
                    };

                    btnNew.onclick = newGame;
                    newGame();
                },

                interactive_weighted_grades(container) {
                    // Estado
                    const subjects = [
                        { name: "Prova", grade: 6, weight: 3 }, // Peso alto
                        { name: "Trabalho", grade: 9, weight: 1 }, // Peso baixo
                        { name: "Atitude", grade: 8, weight: 1 },
                    ];

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Calculadora de Notas (Ponderada)</h3>

        <div class="w-full space-y-4 mb-6" id="grades-list">
            </div>

        <div class="bg-gray-800 text-white rounded-xl p-4 w-full text-center shadow-lg relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-red-500 via-yellow-500 to-green-500"></div>
            
            <p class="text-xs text-gray-400 uppercase font-bold mb-1">M√©dia Final</p>
            <div class="flex justify-center items-end gap-2">
                <span class="text-4xl font-black" id="final-avg">0.0</span>
                <span class="text-sm font-bold mb-2 text-gray-500" id="status-grade">Reprovado</span>
            </div>
            
            <div class="mt-2 text-[10px] font-mono text-gray-500" id="calc-detail">
                (6x3 + 9x1...) √∑ 5
            </div>
        </div>
        
        <p class="text-xs text-gray-400 mt-4 text-center italic">
            Arraste os sliders. Note como a nota da <strong>PROVA</strong> (Peso 3) muda a m√©dia muito mais r√°pido que o Trabalho!
        </p>

    </div>
    `;

                    const list = container.querySelector("#grades-list");
                    const finalDisplay = container.querySelector("#final-avg");
                    const statusDisplay = container.querySelector("#status-grade");
                    const calcDetail = container.querySelector("#calc-detail");

                    const renderList = () => {
                        list.innerHTML = "";
                        subjects.forEach((sub, idx) => {
                            const item = document.createElement("div");
                            item.className = "flex flex-col gap-1";
                            item.innerHTML = `
                <div class="flex justify-between items-center text-sm font-bold text-gray-600">
                    <span>${sub.name
                                } <span class="text-[10px] bg-purple-100 text-brand-purple px-2 py-0.5 rounded-full ml-1">Peso ${sub.weight
                                }</span></span>
                    <span class="text-brand-blue">${sub.grade.toFixed(1)}</span>
                </div>
                <input type="range" min="0" max="10" step="0.5" value="${sub.grade
                                }" class="w-full h-2 bg-gray-200 rounded-lg accent-brand-purple cursor-pointer grade-slider" data-idx="${idx}">
            `;
                            list.appendChild(item);
                        });

                        // Re-attach listeners
                        container.querySelectorAll(".grade-slider").forEach((s) => {
                            s.oninput = (e) => {
                                subjects[parseInt(e.target.dataset.idx)].grade = parseFloat(
                                    e.target.value
                                );
                                update();
                            };
                        });
                    };

                    const update = () => {
                        renderList(); // Atualiza valores visuais

                        let sumProd = 0;
                        let sumWeights = 0;
                        let calcStrParts = [];

                        subjects.forEach((s) => {
                            sumProd += s.grade * s.weight;
                            sumWeights += s.weight;
                            calcStrParts.push(`${s.grade}√ó${s.weight}`);
                        });

                        const avg = sumProd / sumWeights;

                        // Display
                        finalDisplay.innerText = avg.toFixed(1);
                        calcDetail.innerText = `(${calcStrParts.join(
                            " + "
                        )}) √∑ ${sumWeights}`;

                        // Cor e Status
                        if (avg >= 7) {
                            finalDisplay.className = "text-4xl font-black text-brand-green";
                            statusDisplay.innerText = "Aprovado! üéâ";
                            statusDisplay.className =
                                "text-sm font-bold mb-2 text-green-400";
                        } else if (avg >= 5) {
                            finalDisplay.className =
                                "text-4xl font-black text-brand-yellow";
                            statusDisplay.innerText = "Recupera√ß√£o ‚ö†Ô∏è";
                            statusDisplay.className =
                                "text-sm font-bold mb-2 text-yellow-400";
                        } else {
                            finalDisplay.className = "text-4xl font-black text-brand-red";
                            statusDisplay.innerText = "Reprovado üõë";
                            statusDisplay.className = "text-sm font-bold mb-2 text-red-400";
                        }
                    };

                    update(); // Init
                },

                interactive_range_finder(container) {
                    let dataSet = [];
                    let state = { min: null, max: null };

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-6">
            <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest">Ca√ßador de Amplitude</h3>
            <button id="btn-new-set" class="text-xs font-bold text-brand-blue hover:underline">Novos Dados</button>
        </div>

        <div class="flex flex-wrap justify-center gap-3 mb-6" id="numbers-grid">
            </div>

        <div class="flex gap-4 w-full max-w-sm mb-4">
            <div class="flex-1 bg-blue-50 border border-blue-200 rounded-lg p-2 text-center" id="box-min">
                <p class="text-[10px] text-gray-400 font-bold uppercase">M√≠nimo</p>
                <p class="text-xl font-black text-brand-blue" id="val-min">?</p>
            </div>
            <div class="flex-1 bg-red-50 border border-red-200 rounded-lg p-2 text-center" id="box-max">
                <p class="text-[10px] text-gray-400 font-bold uppercase">M√°ximo</p>
                <p class="text-xl font-black text-brand-red" id="val-max">?</p>
            </div>
        </div>

        <button id="btn-calc-range" class="w-full bg-brand-orange text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all opacity-50 cursor-not-allowed">
            Calcular Amplitude
        </button>

        <div id="range-result" class="hidden mt-4 text-center w-full animate-pop-in">
            <div class="text-xs font-bold text-gray-400 uppercase">Amplitude = M√°x - M√≠n</div>
            <div class="text-3xl font-black text-brand-orange mt-1">
                <span id="res-calc">20 - 5 = 15</span>
            </div>
        </div>

    </div>
    `;

                    const grid = container.querySelector("#numbers-grid");
                    const valMin = container.querySelector("#val-min");
                    const valMax = container.querySelector("#val-max");
                    const btnCalc = container.querySelector("#btn-calc-range");
                    const btnNew = container.querySelector("#btn-new-set");
                    const resBox = container.querySelector("#range-result");
                    const resCalc = container.querySelector("#res-calc");

                    const generate = () => {
                        // Gera 8 n√∫meros aleat√≥rios entre 10 e 99
                        dataSet = Array.from(
                            { length: 8 },
                            () => Math.floor(Math.random() * 89) + 10
                        );
                        state = { min: null, max: null };

                        // UI Reset
                        valMin.innerText = "?";
                        valMax.innerText = "?";
                        btnCalc.disabled = true;
                        btnCalc.classList.add("opacity-50", "cursor-not-allowed");
                        resBox.classList.add("hidden");

                        renderGrid();
                    };

                    const renderGrid = () => {
                        grid.innerHTML = "";
                        dataSet.forEach((num, idx) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "w-12 h-12 bg-white border-2 border-gray-200 rounded-lg font-bold text-gray-600 shadow-sm hover:scale-110 hover:border-gray-400 transition-all";
                            btn.innerText = num;

                            // Selecionado?
                            if (state.min === num) {
                                btn.className =
                                    "w-12 h-12 bg-blue-100 border-2 border-brand-blue rounded-lg font-bold text-brand-blue shadow-sm scale-110";
                            }
                            if (state.max === num) {
                                btn.className =
                                    "w-12 h-12 bg-red-100 border-2 border-brand-red rounded-lg font-bold text-brand-red shadow-sm scale-110";
                            }

                            btn.onclick = () => handleSelect(num);
                            grid.appendChild(btn);
                        });
                    };

                    const handleSelect = (num) => {
                        // L√≥gica inteligente: O usu√°rio clica.
                        // Se for menor que o atual min (ou min vazio), vira min.
                        // Se for maior que o atual max (ou max vazio), vira max.
                        // Se clicar num j√° selecionado, desseleciona.

                        if (state.min === num) {
                            state.min = null;
                        } else if (state.max === num) {
                            state.max = null;
                        } else {
                            if (state.min === null) state.min = num;
                            else if (state.max === null) {
                                if (num > state.min) state.max = num;
                                else {
                                    state.max = state.min;
                                    state.min = num;
                                } // Troca
                            } else {
                                // J√° tem os dois, substitui o mais l√≥gico
                                if (num < state.min) state.min = num;
                                else if (num > state.max) state.max = num;
                                else {
                                    // Est√° no meio. Substitui o mais pr√≥ximo? Ou reseta?
                                    // Vamos simplificar: Substitui min
                                    state.min = num;
                                }
                            }
                        }

                        // Garante ordem
                        if (
                            state.min !== null &&
                            state.max !== null &&
                            state.min > state.max
                        ) {
                            const temp = state.min;
                            state.min = state.max;
                            state.max = temp;
                        }

                        updateUI();
                    };

                    const updateUI = () => {
                        valMin.innerText = state.min !== null ? state.min : "?";
                        valMax.innerText = state.max !== null ? state.max : "?";
                        renderGrid();

                        if (state.min !== null && state.max !== null) {
                            btnCalc.disabled = false;
                            btnCalc.classList.remove("opacity-50", "cursor-not-allowed");
                            btnCalc.classList.add("animate-pulse");
                        } else {
                            btnCalc.disabled = true;
                            btnCalc.classList.add("opacity-50", "cursor-not-allowed");
                            btnCalc.classList.remove("animate-pulse");
                        }
                    };

                    btnCalc.onclick = () => {
                        const trueMin = Math.min(...dataSet);
                        const trueMax = Math.max(...dataSet);

                        if (state.min === trueMin && state.max === trueMax) {
                            const amp = state.max - state.min;
                            resCalc.innerHTML = `${state.max} - ${state.min} = <strong class="text-4xl">${amp}</strong>`;
                            resBox.classList.remove("hidden");
                            btnCalc.disabled = true;
                            btnCalc.classList.remove("animate-pulse");
                        } else {
                            alert(
                                "Opa! Tem certeza que esses s√£o o Menor e o Maior n√∫mero da lista? Verifique de novo."
                            );
                        }
                    };

                    btnNew.onclick = generate;
                    generate();
                },

                interactive_pie_maker(container) {
                    // Estado: Porcentagem de 3 fatias
                    let p1 = 50; // Azul
                    let p2 = 30; // Verde
                    // p3 (Laranja) √© o resto (100 - p1 - p2)

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-green font-bold uppercase text-xs tracking-widest mb-6">Pizzaiolo Estat√≠stico</h3>

        <div class="relative w-64 h-64 mb-8">
            <svg viewBox="-1 -1 2 2" style="transform: rotate(-90deg);" class="w-full h-full overflow-visible">
                <path id="pie-1" fill="#1CB0F6" stroke="white" stroke-width="0.02"></path>
                <path id="pie-2" fill="#58CC02" stroke="white" stroke-width="0.02"></path>
                <path id="pie-3" fill="#FF9600" stroke="white" stroke-width="0.02"></path>
            </svg>
            
            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                <span class="text-xs font-bold bg-white/80 px-1 rounded">Total: 100%</span>
            </div>
        </div>

        <div class="w-full space-y-4 max-w-sm">
            
            <div class="bg-blue-50 p-2 rounded-lg border border-blue-200">
                <div class="flex justify-between text-xs font-bold text-brand-blue uppercase mb-1">
                    <span>Mussarela (Azul)</span>
                    <span id="lbl-p1">50%</span>
                </div>
                <input type="range" id="sl-p1" min="0" max="100" value="50" class="w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer accent-brand-blue">
                <div class="text-[10px] text-right font-mono text-gray-500 mt-1" id="deg-p1">180¬∞</div>
            </div>

            <div class="bg-green-50 p-2 rounded-lg border border-green-200">
                <div class="flex justify-between text-xs font-bold text-brand-green uppercase mb-1">
                    <span>Calabresa (Verde)</span>
                    <span id="lbl-p2">30%</span>
                </div>
                <input type="range" id="sl-p2" min="0" max="100" value="30" class="w-full h-2 bg-green-200 rounded-lg appearance-none cursor-pointer accent-brand-green">
                <div class="text-[10px] text-right font-mono text-gray-500 mt-1" id="deg-p2">108¬∞</div>
            </div>

            <div class="bg-orange-50 p-2 rounded-lg border border-orange-200 opacity-80">
                <div class="flex justify-between text-xs font-bold text-brand-orange uppercase mb-1">
                    <span>Resto (Laranja)</span>
                    <span id="lbl-p3">20%</span>
                </div>
                <div class="w-full h-2 bg-orange-200 rounded-lg relative overflow-hidden">
                     <div class="h-full bg-brand-orange" id="bar-p3" style="width: 20%"></div>
                </div>
                <div class="text-[10px] text-right font-mono text-gray-500 mt-1" id="deg-p3">72¬∞</div>
            </div>

        </div>

    </div>
    `;

                    const path1 = container.querySelector("#pie-1");
                    const path2 = container.querySelector("#pie-2");
                    const path3 = container.querySelector("#pie-3");

                    const s1 = container.querySelector("#sl-p1");
                    const s2 = container.querySelector("#sl-p2");

                    const l1 = container.querySelector("#lbl-p1");
                    const l2 = container.querySelector("#lbl-p2");
                    const l3 = container.querySelector("#lbl-p3");
                    const bar3 = container.querySelector("#bar-p3");

                    const d1 = container.querySelector("#deg-p1");
                    const d2 = container.querySelector("#deg-p2");
                    const d3 = container.querySelector("#deg-p3");

                    // Helper SVG Arc
                    const getCoordinatesForPercent = (percent) => {
                        const x = Math.cos(2 * Math.PI * percent);
                        const y = Math.sin(2 * Math.PI * percent);
                        return [x, y];
                    };

                    const drawSlice = (path, startPercent, endPercent) => {
                        if (Math.abs(endPercent - startPercent) >= 0.999) {
                            // C√≠rculo completo (quase)
                            path.setAttribute(
                                "d",
                                "M 1 0 A 1 1 0 1 1 -1 0 A 1 1 0 1 1 1 0"
                            );
                            return;
                        }
                        if (Math.abs(endPercent - startPercent) <= 0.001) {
                            path.setAttribute("d", ""); // Vazio
                            return;
                        }

                        const [startX, startY] = getCoordinatesForPercent(startPercent);
                        const [endX, endY] = getCoordinatesForPercent(endPercent);
                        const largeArcFlag = endPercent - startPercent > 0.5 ? 1 : 0;

                        const d = [
                            `M ${startX} ${startY}`,
                            `A 1 1 0 ${largeArcFlag} 1 ${endX} ${endY}`,
                            `L 0 0`,
                        ].join(" ");

                        path.setAttribute("d", d);
                    };

                    const update = (source) => {
                        // L√≥gica de limites: p1 + p2 <= 100.
                        // Se mexer em p1, p2 encolhe se precisar.

                        let val1 = parseInt(s1.value);
                        let val2 = parseInt(s2.value);

                        if (source === "p1") {
                            if (val1 + val2 > 100) {
                                val2 = 100 - val1;
                                s2.value = val2;
                            }
                        } else {
                            if (val1 + val2 > 100) {
                                val1 = 100 - val2;
                                s1.value = val1;
                            }
                        }

                        const val3 = 100 - val1 - val2;

                        // Atualiza textos
                        l1.innerText = `${val1}%`;
                        l2.innerText = `${val2}%`;
                        l3.innerText = `${val3}%`;
                        bar3.style.width = `${val3}%`;

                        // Graus
                        d1.innerText = `${(val1 * 3.6).toFixed(1)}¬∞`;
                        d2.innerText = `${(val2 * 3.6).toFixed(1)}¬∞`;
                        d3.innerText = `${(val3 * 3.6).toFixed(1)}¬∞`;

                        // Desenha Pizza
                        // Fatia 1: 0 a p1
                        drawSlice(path1, 0, val1 / 100);
                        // Fatia 2: p1 a p1+p2
                        drawSlice(path2, val1 / 100, (val1 + val2) / 100);
                        // Fatia 3: p1+p2 a 1
                        drawSlice(path3, (val1 + val2) / 100, 1);
                    };

                    s1.oninput = () => update("p1");
                    s2.oninput = () => update("p2");

                    update("p1");
                },

                interactive_monomial_builder(container) {
                    let coeff = -5;
                    let var1 = "x";
                    let exp1 = 2;
                    let var2 = "y";
                    let exp2 = 1;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Laborat√≥rio de Mon√¥mios</h3>

        <div class="bg-gray-50 border border-gray-200 rounded-xl p-8 mb-6 flex items-center justify-center min-h-[120px] transition-all" id="monomial-display">
            </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
            
            <div class="flex flex-col gap-2 p-3 bg-purple-50 rounded-xl border border-purple-100">
                <span class="text-[10px] font-bold text-purple-800 uppercase text-center">Coeficiente</span>
                <input type="range" id="slider-coeff" min="-10" max="10" value="-5" class="w-full h-2 bg-purple-200 rounded-lg accent-brand-purple">
                <div class="text-center font-black text-brand-purple text-lg" id="val-coeff">-5</div>
            </div>

            <div class="flex flex-col gap-2 p-3 bg-blue-50 rounded-xl border border-blue-100">
                <span class="text-[10px] font-bold text-blue-800 uppercase text-center">Expoente de X</span>
                <input type="range" id="slider-exp1" min="0" max="5" value="2" class="w-full h-2 bg-blue-200 rounded-lg accent-brand-blue">
                <div class="text-center font-black text-brand-blue text-lg" id="val-exp1">2</div>
            </div>

            <div class="flex flex-col gap-2 p-3 bg-orange-50 rounded-xl border border-orange-100">
                <span class="text-[10px] font-bold text-orange-800 uppercase text-center">Expoente de Y</span>
                <input type="range" id="slider-exp2" min="0" max="5" value="1" class="w-full h-2 bg-orange-200 rounded-lg accent-brand-orange">
                <div class="text-center font-black text-brand-orange text-lg" id="val-exp2">1</div>
            </div>

        </div>

        <div class="mt-6 text-center">
            <p class="text-sm text-gray-500 font-bold uppercase">Grau do Mon√¥mio</p>
            <p class="text-3xl font-black text-brand-text animate-pop-in" id="val-degree">3</p>
            <p class="text-xs text-gray-400 mt-1">(Soma dos expoentes)</p>
        </div>

    </div>
    `;

                    const display = container.querySelector("#monomial-display");
                    const sCoeff = container.querySelector("#slider-coeff");
                    const sExp1 = container.querySelector("#slider-exp1");
                    const sExp2 = container.querySelector("#slider-exp2");
                    const vCoeff = container.querySelector("#val-coeff");
                    const vExp1 = container.querySelector("#val-exp1");
                    const vExp2 = container.querySelector("#val-exp2");
                    const vDegree = container.querySelector("#val-degree");

                    const render = () => {
                        coeff = parseInt(sCoeff.value);
                        exp1 = parseInt(sExp1.value);
                        exp2 = parseInt(sExp2.value);

                        vCoeff.innerText = coeff;
                        vExp1.innerText = exp1;
                        vExp2.innerText = exp2;

                        let html = `<div class="flex items-baseline text-5xl font-mono font-bold">`;

                        // Coeficiente
                        html += `<span class="text-brand-purple transition-all">${coeff}</span>`;

                        // X
                        if (exp1 > 0) {
                            html += `<span class="text-brand-blue ml-1">x${exp1 > 1 ? `<sup class="text-3xl">${exp1}</sup>` : ""
                                }</span>`;
                        }
                        // Y
                        if (exp2 > 0) {
                            html += `<span class="text-brand-orange ml-1">y${exp2 > 1 ? `<sup class="text-3xl">${exp2}</sup>` : ""
                                }</span>`;
                        }

                        // Se tudo for zero
                        if (exp1 === 0 && exp2 === 0) {
                            // Apenas o n√∫mero (Grau 0)
                        }

                        html += `</div>`;
                        display.innerHTML = html;

                        // Grau
                        const degree = exp1 + exp2;
                        vDegree.innerText = degree;
                    };

                    sCoeff.oninput = render;
                    sExp1.oninput = render;
                    sExp2.oninput = render;
                    render();
                },

                interactive_like_terms_sorter(container) {
                    // Configura√ß√£o do Jogo
                    const families = [
                        {
                            id: "x2",
                            label: "Fam√≠lia x¬≤",
                            color: "bg-blue-100 border-blue-300 text-blue-800",
                        },
                        {
                            id: "xy",
                            label: "Fam√≠lia xy",
                            color: "bg-orange-100 border-orange-300 text-orange-800",
                        },
                        {
                            id: "num",
                            label: "N√∫meros",
                            color: "bg-gray-200 border-gray-400 text-gray-800",
                        },
                    ];

                    const terms = [
                        { txt: "3x¬≤", type: "x2" },
                        { txt: "-5x¬≤", type: "x2" },
                        { txt: "x¬≤", type: "x2" },
                        { txt: "4xy", type: "xy" },
                        { txt: "-xy", type: "xy" },
                        { txt: "10yx", type: "xy" },
                        { txt: "7", type: "num" },
                        { txt: "-2", type: "num" },
                        { txt: "100", type: "num" },
                    ];

                    let currentTerms = [...terms].sort(() => Math.random() - 0.5);
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-4 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden h-[450px]">
        
        <div class="flex justify-between w-full mb-4 z-10">
            <h3 class="font-black text-gray-500 uppercase text-xs tracking-widest">Separador de Termos</h3>
            <div class="bg-brand-yellow text-yellow-900 px-3 py-1 rounded-full text-xs font-black">Score: <span id="sort-score">0</span></div>
        </div>

        <div class="relative w-full flex-1 flex items-center justify-center mb-4">
            <div id="term-card" class="w-32 h-32 bg-white border-b-8 border-gray-300 rounded-2xl shadow-xl flex items-center justify-center text-3xl font-mono font-black text-gray-700 cursor-grab active:cursor-grabbing transition-all z-20">
                ...
            </div>
            <div id="sort-feedback" class="absolute font-black text-5xl opacity-0 transition-opacity z-30"></div>
        </div>

        <div class="grid grid-cols-3 gap-2 w-full z-10">
            ${families
                            .map(
                                (f) => `
                <button class="fam-btn h-24 rounded-xl border-b-4 flex flex-col items-center justify-center ${f.color
                                    } hover:brightness-95 active:scale-95 transition-all shadow-sm" data-type="${f.id
                                    }">
                    <span class="text-xl font-bold mb-1">${f.id === "num" ? "123" : f.id
                                    }</span>
                    <span class="text-[10px] uppercase font-black opacity-70">${f.label
                                    }</span>
                </button>
            `
                            )
                            .join("")}
        </div>

        <div id="end-sort" class="absolute inset-0 bg-white/95 flex-col items-center justify-center z-40 hidden">
             <div class="text-6xl mb-4">üéâ</div>
             <h3 class="text-2xl font-black text-brand-text mb-2">Organizado!</h3>
             <button id="btn-restart-sort" class="bg-brand-blue text-white font-bold py-3 px-8 rounded-full shadow-lg">Jogar Novamente</button>
        </div>

    </div>
    `;

                    const card = container.querySelector("#term-card");
                    const feedback = container.querySelector("#sort-feedback");
                    const scoreEl = container.querySelector("#sort-score");
                    const endScreen = container.querySelector("#end-sort");
                    const btns = container.querySelectorAll(".fam-btn");
                    const restartBtn = container.querySelector("#btn-restart-sort");

                    let currentItem = null;

                    const loadNext = () => {
                        if (currentTerms.length === 0) {
                            endScreen.classList.remove("hidden");
                            endScreen.classList.add("flex");
                            return;
                        }
                        currentItem = currentTerms.pop();
                        card.innerText = currentItem.txt;
                        card.className =
                            "w-32 h-32 bg-white border-b-8 border-gray-300 rounded-2xl shadow-xl flex items-center justify-center text-3xl font-mono font-black text-gray-700 cursor-grab active:cursor-grabbing transition-all z-20 animate-pop-in";
                    };

                    const check = (type) => {
                        if (type === currentItem.type) {
                            score += 10;
                            feedback.innerHTML = "‚úÖ";
                            feedback.className =
                                "absolute font-black text-5xl text-green-500 animate-pop-in z-30";
                            card.classList.add("opacity-0", "scale-0");
                        } else {
                            score = Math.max(0, score - 5);
                            feedback.innerHTML = "‚ùå";
                            feedback.className =
                                "absolute font-black text-5xl text-red-500 animate-pop-in z-30";
                            card.classList.add("animate-shake", "border-red-400");
                        }

                        scoreEl.innerText = score;

                        setTimeout(() => {
                            feedback.classList.add("opacity-0");
                            loadNext();
                        }, 500);
                    };

                    btns.forEach((b) => (b.onclick = () => check(b.dataset.type)));

                    restartBtn.onclick = () => {
                        currentTerms = [...terms].sort(() => Math.random() - 0.5);
                        score = 0;
                        scoreEl.innerText = 0;
                        endScreen.classList.add("hidden");
                        endScreen.classList.remove("flex");
                        loadNext();
                    };

                    loadNext();
                },

                interactive_poly_degree_quiz(container) {
                    // Banco de perguntas gerado dinamicamente
                    const questions = [
                        {
                            poly: "3x¬≤ + 5x - 7",
                            terms: [
                                { t: "3x¬≤", d: 2 },
                                { t: "5x", d: 1 },
                                { t: "-7", d: 0 },
                            ],
                            ans: 2,
                        },
                        {
                            poly: "4x¬≥ - 2x‚Åµ + x",
                            terms: [
                                { t: "4x¬≥", d: 3 },
                                { t: "-2x‚Åµ", d: 5 },
                                { t: "x", d: 1 },
                            ],
                            ans: 5,
                        },
                        { poly: "7", terms: [{ t: "7", d: 0 }], ans: 0 },
                        {
                            poly: "x + x‚Å¥ - 2",
                            terms: [
                                { t: "x", d: 1 },
                                { t: "x‚Å¥", d: 4 },
                                { t: "-2", d: 0 },
                            ],
                            ans: 4,
                        },
                    ];

                    let current = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full items-center mb-6">
            <h3 class="text-brand-purple font-black uppercase text-xs tracking-widest">Detector de Grau</h3>
            <div class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs font-bold">Score: <span id="deg-score">0</span></div>
        </div>

        <div class="text-center mb-8">
            <p class="text-gray-400 text-xs font-bold uppercase mb-2">Qual √© o grau deste polin√¥mio?</p>
            <div class="text-3xl md:text-4xl font-mono font-bold text-brand-text bg-gray-50 p-4 rounded-xl border border-gray-200 shadow-inner" id="poly-display">
                ...
            </div>
        </div>

        <p class="text-xs text-gray-500 mb-2">Clique no termo "Chefe" (maior grau):</p>
        <div id="terms-container" class="flex flex-wrap gap-3 justify-center mb-6">
        </div>

        <div id="deg-feedback" class="h-8 font-bold text-sm text-center"></div>

    </div>
    `;

                    const polyDisplay = container.querySelector("#poly-display");
                    const termsContainer = container.querySelector("#terms-container");
                    const feedback = container.querySelector("#deg-feedback");
                    const scoreEl = container.querySelector("#deg-score");

                    const loadQuestion = () => {
                        if (current >= questions.length) {
                            polyDisplay.innerHTML = "Fim!";
                            termsContainer.innerHTML = `<button class="bg-brand-blue text-white font-bold py-2 px-6 rounded-lg" onclick="app.renderLesson(document.getElementById('main-container'), app.currentLessonName)">Reiniciar</button>`;
                            return;
                        }

                        const q = questions[current];
                        // Formata visualmente com HTML para expoentes
                        polyDisplay.innerHTML = q.poly.replace(
                            /\^(\d+)/g,
                            "<sup>$1</sup>"
                        );

                        termsContainer.innerHTML = "";

                        // Embaralha visualmente os termos para n√£o ser √≥bvio (opcional, mas aqui mantemos a ordem para leitura)
                        q.terms.forEach((term) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "term-btn bg-white border-b-4 border-gray-200 text-gray-600 font-mono font-bold text-lg py-3 px-5 rounded-xl hover:bg-blue-50 hover:border-blue-200 hover:text-brand-blue transition-all active:scale-95";
                            btn.innerHTML = term.t.replace(/\^(\d+)/g, "<sup>$1</sup>"); // Renderiza expoente bonito

                            btn.onclick = () => check(term.d, q.ans, btn);
                            termsContainer.appendChild(btn);
                        });
                    };

                    const check = (degree, correctDegree, btn) => {
                        // Bloqueia cliques
                        const allBtns = termsContainer.querySelectorAll(".term-btn");
                        allBtns.forEach((b) => (b.disabled = true));

                        if (degree === correctDegree) {
                            score += 10;
                            scoreEl.innerText = score;
                            btn.classList.add(
                                "bg-green-100",
                                "border-green-400",
                                "text-green-700"
                            );
                            feedback.innerHTML = `<span class="text-green-600">Correto! O grau √© ${degree}.</span>`;
                        } else {
                            btn.classList.add(
                                "bg-red-100",
                                "border-red-400",
                                "text-red-700",
                                "animate-shake"
                            );
                            feedback.innerHTML = `<span class="text-red-500">Ops! O grau m√°ximo √© ${correctDegree}.</span>`;

                            // Revela o certo
                            allBtns.forEach((b, i) => {
                                if (questions[current].terms[i].d === correctDegree) {
                                    b.classList.add("bg-green-50", "border-green-200");
                                }
                            });
                        }

                        setTimeout(() => {
                            current++;
                            feedback.innerHTML = "";
                            loadQuestion();
                        }, 1500);
                    };

                    loadQuestion();
                },

                interactive_alchemy_reducer(container) {
                    // Elementos para combinar
                    // x = po√ß√£o azul, y = po√ß√£o vermelha, numero = pedra
                    const levels = [
                        {
                            terms: [
                                { v: 2, type: "x" },
                                { v: 3, type: "x" },
                                { v: 4, type: "y" },
                            ],
                            goal: "5x + 4y",
                        },
                        {
                            terms: [
                                { v: 5, type: "x" },
                                { v: -2, type: "x" },
                                { v: 3, type: "num" },
                                { v: 4, type: "num" },
                            ],
                            goal: "3x + 7",
                        },
                        {
                            terms: [
                                { v: 1, type: "x2" },
                                { v: 2, type: "x" },
                                { v: 3, type: "x2" },
                                { v: -1, type: "x" },
                            ],
                            goal: "4x¬≤ + x",
                        },
                    ];

                    let currentLvl = 0;
                    let activeTerms = []; // Estado atual dos termos na mesa

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[400px]">
        
        <div class="flex justify-between w-full text-white mb-4 z-10">
            <div class="flex items-center gap-2"><span class="text-2xl">‚öóÔ∏è</span> <span class="font-bold uppercase tracking-widest text-xs">Laborat√≥rio</span></div>
            <div class="text-xs font-bold text-gray-400">N√≠vel <span id="alc-lvl">1</span></div>
        </div>

        <div id="table-top" class="relative w-full flex-1 bg-gray-800 rounded-xl border-2 border-gray-600 mb-4 overflow-hidden shadow-inner">
            <div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: radial-gradient(#fff 1px, transparent 1px); background-size: 20px 20px;"></div>
            <div id="potions-container" class="w-full h-full relative"></div>
        </div>

        <div class="text-center z-10 h-12">
            <p class="text-gray-400 text-xs mb-1" id="alc-hint">Clique em dois itens iguais para fundir!</p>
            <button id="btn-next-alc" class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full shadow-lg transition-all animate-pop-in">Pr√≥ximo N√≠vel</button>
        </div>

    </div>
    `;

                    const arena = container.querySelector("#potions-container");
                    const hint = container.querySelector("#alc-hint");
                    const btnNext = container.querySelector("#btn-next-alc");
                    const lvlDisp = container.querySelector("#alc-lvl");

                    let selectedEl = null;

                    // Configura√ß√£o Visual dos Tipos
                    const typeConfig = {
                        x: {
                            color: "bg-blue-500",
                            border: "border-blue-300",
                            icon: "üíß",
                            label: "x",
                        },
                        y: {
                            color: "bg-red-500",
                            border: "border-red-300",
                            icon: "üî•",
                            label: "y",
                        },
                        num: {
                            color: "bg-gray-500",
                            border: "border-gray-300",
                            icon: "ü™®",
                            label: "",
                        },
                        x2: {
                            color: "bg-purple-500",
                            border: "border-purple-300",
                            icon: "üîÆ",
                            label: "x¬≤",
                        },
                    };

                    const loadLevel = () => {
                        if (currentLvl >= levels.length) {
                            arena.innerHTML = `<div class="w-full h-full flex items-center justify-center text-white font-black text-2xl">Mestre Alquimista! üèÜ</div>`;
                            btnNext.classList.add("hidden");
                            hint.classList.add("hidden");
                            return;
                        }

                        lvlDisp.innerText = currentLvl + 1;
                        btnNext.classList.add("hidden");
                        hint.innerText = "Clique em dois itens iguais para fundir!";
                        hint.className = "text-gray-400 text-xs mb-1";

                        // Copia os termos para n√£o alterar o original
                        activeTerms = JSON.parse(
                            JSON.stringify(levels[currentLvl].terms)
                        );
                        renderTerms();
                    };

                    const renderTerms = () => {
                        arena.innerHTML = "";

                        // Verifica se terminou (n√£o h√° mais pares poss√≠veis)
                        const types = activeTerms.map((t) => t.type);
                        const uniqueTypes = new Set(types);
                        if (types.length === uniqueTypes.size) {
                            // N√≠vel completo
                            hint.innerHTML = `<span class="text-green-400 font-bold">Po√ß√£o Est√°vel!</span>`;
                            btnNext.classList.remove("hidden");
                            // Confetti effect simulated
                        }

                        activeTerms.forEach((term, idx) => {
                            const el = document.createElement("div");
                            const cfg = typeConfig[term.type];

                            // Posi√ß√£o aleat√≥ria (simples grid ou random com colis√£o seria melhor, mas random simples serve pro demo)
                            // Vamos usar um grid flex wrap no container pai para facilitar
                            el.className = `relative w-16 h-16 md:w-20 md:h-20 rounded-full ${cfg.color} border-4 ${cfg.border} shadow-lg flex items-center justify-center cursor-pointer transition-all duration-300 hover:scale-110 active:scale-95 m-2 float-left`;

                            if (selectedEl && selectedEl.dataset.idx == idx) {
                                el.classList.add("ring-4", "ring-white", "scale-110");
                            }

                            el.innerHTML = `
                <div class="text-2xl drop-shadow-md">${cfg.icon}</div>
                <div class="absolute -bottom-2 bg-black/50 text-white text-xs px-2 rounded-full font-mono border border-white/20">
                    ${term.v > 0 ? "+" + term.v : term.v}${cfg.label}
                </div>
            `;

                            el.dataset.idx = idx;
                            el.onclick = () => handleClick(idx);

                            arena.appendChild(el);
                        });
                    };

                    const handleClick = (idx) => {
                        const clickedTerm = activeTerms[idx];

                        if (selectedEl === null) {
                            // Seleciona o primeiro
                            selectedEl = { idx: idx, type: clickedTerm.type };
                            renderTerms();
                        } else {
                            // Segundo clique
                            if (selectedEl.idx == idx) {
                                // Cancelar sele√ß√£o (clicou no mesmo)
                                selectedEl = null;
                                renderTerms();
                                return;
                            }

                            const firstIdx = selectedEl.idx;
                            const firstTerm = activeTerms[firstIdx];

                            if (firstTerm.type === clickedTerm.type) {
                                // SUCESSO: Fundir
                                const newVal = firstTerm.v + clickedTerm.v;

                                // Cria novo termo
                                const newTerm = { v: newVal, type: firstTerm.type };

                                // Remove os dois antigos e adiciona o novo
                                // Filtrar por indice √© chato pq muda o array. Vamos marcar para deletar.

                                // Nova lista
                                const newTerms = activeTerms.filter(
                                    (_, i) => i !== firstIdx && i !== idx
                                );
                                newTerms.push(newTerm);
                                activeTerms = newTerms;

                                selectedEl = null;

                                // Feedback visual de fus√£o? (Pode ser complexo, vamos s√≥ renderizar)
                                renderTerms();
                            } else {
                                // ERRO: Tipos diferentes
                                hint.innerHTML = `<span class="text-red-400 font-bold animate-shake inline-block">N√£o misture ingredientes diferentes!</span>`;
                                selectedEl = null;
                                renderTerms();
                                setTimeout(() => {
                                    if (!btnNext.classList.contains("hidden")) return;
                                    hint.innerText = "Clique em dois itens iguais para fundir!";
                                    hint.className = "text-gray-400 text-xs mb-1";
                                }, 1500);
                            }
                        }
                    };

                    btnNext.onclick = () => {
                        currentLvl++;
                        loadLevel();
                    };

                    loadLevel();
                },

                interactive_poly_subtraction_wall(container) {
                    // Exemplo: (5x + 3) - (2x - 4)
                    // Etapa 1: Inverter sinais do segundo grupo
                    // Etapa 2: Juntar

                    let step = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Inversor de Sinais</h3>

        <div class="flex items-center gap-2 text-2xl md:text-3xl font-mono font-bold text-gray-700 mb-8 flex-wrap justify-center">
            
            <div class="bg-blue-50 p-2 rounded border border-blue-200">( 5x + 3 )</div>
            
            <div class="text-brand-red font-black text-4xl mx-2">-</div>

            <div class="bg-red-50 p-2 rounded border border-red-200 relative transition-all duration-500" id="group-2">
                ( <span id="term-2a">2x</span> <span id="term-2b">- 4</span> )
                
                <div id="zap-ray" class="absolute inset-0 bg-brand-red opacity-0 mix-blend-multiply transition-opacity duration-200 rounded"></div>
            </div>

        </div>

        <div id="result-area" class="w-full bg-gray-100 rounded-xl p-4 min-h-[80px] flex items-center justify-center gap-4 text-xl font-bold text-gray-400 border-2 border-dashed border-gray-300">
            Resultado aparecer√° aqui...
        </div>

        <button id="btn-action-sub" class="mt-6 w-full max-w-xs bg-brand-red hover:bg-red-600 text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all">
            <i class="fas fa-bolt"></i> Distribuir o Sinal
        </button>

    </div>
    `;

                    const btn = container.querySelector("#btn-action-sub");
                    const group2 = container.querySelector("#group-2");
                    const zap = container.querySelector("#zap-ray");
                    const t2a = container.querySelector("#term-2a");
                    const t2b = container.querySelector("#term-2b");
                    const resArea = container.querySelector("#result-area");

                    btn.onclick = async () => {
                        if (step === 0) {
                            // Passo 1: Choque
                            btn.disabled = true;

                            // Anima√ß√£o Flash
                            zap.classList.remove("opacity-0");
                            await new Promise((r) => setTimeout(r, 100));
                            zap.classList.add("opacity-0");
                            await new Promise((r) => setTimeout(r, 100));
                            zap.classList.remove("opacity-0");
                            await new Promise((r) => setTimeout(r, 100));
                            zap.classList.add("opacity-0");

                            // Troca Sinais
                            t2a.innerHTML = "<span class='text-brand-red'>-2x</span>";
                            t2b.innerHTML = "<span class='text-brand-red'>+ 4</span>";
                            group2.classList.add("scale-110", "border-red-500");

                            setTimeout(() => group2.classList.remove("scale-110"), 200);

                            btn.innerText = "Juntar Tudo";
                            btn.classList.replace("bg-brand-red", "bg-brand-blue");
                            btn.classList.replace("hover:bg-red-600", "hover:bg-blue-600");
                            btn.disabled = false;
                            step++;
                        } else if (step === 1) {
                            // Passo 2: Calcular
                            // 5x - 2x = 3x
                            // 3 + 4 = 7
                            resArea.innerHTML = `
                <div class="flex gap-4 animate-pop-in text-brand-text">
                    <div class="flex flex-col items-center">
                        <span class="text-xs text-gray-400">5x - 2x</span>
                        <span class="text-2xl font-black text-brand-blue">3x</span>
                    </div>
                    <div class="text-2xl">+</div>
                    <div class="flex flex-col items-center">
                        <span class="text-xs text-gray-400">3 + 4</span>
                        <span class="text-2xl font-black text-brand-orange">7</span>
                    </div>
                </div>
            `;
                            resArea.classList.remove("text-gray-400", "border-dashed");
                            resArea.classList.add("bg-white", "border-brand-green");

                            btn.classList.add("hidden");
                        }
                    };
                },

                interactive_poly_mult_area(container) {
                    // 2x * (3x + 4)

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Multiplica√ß√£o por √Årea</h3>

        <div class="flex items-end mb-1">
            <div class="text-center w-32 pb-2 text-brand-orange font-bold text-lg">3x</div>
            <div class="text-center w-24 pb-2 text-brand-green font-bold text-lg">+ 4</div>
        </div>

        <div class="flex items-start">
            <div class="h-24 flex items-center justify-center pr-4 font-bold text-brand-purple text-lg">2x</div>
            
            <div class="flex border-4 border-gray-800 rounded-lg overflow-hidden shadow-lg">
                <div class="w-32 h-24 bg-purple-100 flex flex-col items-center justify-center border-r-2 border-dashed border-gray-400 group cursor-pointer hover:bg-purple-200 transition-colors" id="area-1">
                    <span class="text-xs text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity">2x ¬∑ 3x</span>
                    <span class="text-xl font-black text-brand-purple">?</span>
                </div>
                <div class="w-24 h-24 bg-blue-100 flex flex-col items-center justify-center group cursor-pointer hover:bg-blue-200 transition-colors" id="area-2">
                    <span class="text-xs text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity">2x ¬∑ 4</span>
                    <span class="text-xl font-black text-brand-blue">?</span>
                </div>
            </div>
        </div>

        <p class="text-center text-xs text-gray-400 mt-4 font-bold uppercase">Clique nas √°reas para calcular!</p>
        
        <div id="final-poly" class="h-10 mt-2 text-2xl font-mono font-bold text-gray-700"></div>

    </div>
    `;

                    const a1 = container.querySelector("#area-1");
                    const a2 = container.querySelector("#area-2");
                    const final = container.querySelector("#final-poly");

                    let state = { a1: false, a2: false };

                    const checkComplete = () => {
                        if (state.a1 && state.a2) {
                            final.innerHTML = `<span class="text-brand-purple animate-pop-in">6x¬≤</span> + <span class="text-brand-blue animate-pop-in">8x</span>`;
                        }
                    };

                    a1.onclick = () => {
                        a1.querySelector(".text-xl").innerText = "6x¬≤";
                        a1.classList.add("bg-purple-200");
                        state.a1 = true;
                        checkComplete();
                    };

                    a2.onclick = () => {
                        a2.querySelector(".text-xl").innerText = "8x";
                        a2.classList.add("bg-blue-200");
                        state.a2 = true;
                        checkComplete();
                    };
                },

                interactive_poly_div_splitter(container) {
                    // (12x¬≥ + 8x¬≤) / 4x

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-6">Divis√£o: O Separador</h3>

        <div id="united-frac" class="text-3xl font-mono font-bold text-center transition-all duration-700">
            <div class="border-b-4 border-gray-800 px-4 mb-2">12x¬≥ + 8x¬≤</div>
            <div class="text-brand-orange">4x</div>
        </div>

        <div id="split-frac" class="hidden flex items-center gap-4 text-2xl font-mono font-bold animate-pop-in">
            <div class="flex flex-col items-center group">
                <div class="border-b-2 border-gray-400 px-2 mb-1">12x¬≥</div>
                <div class="text-brand-orange">4x</div>
                <div class="text-brand-purple mt-2 opacity-0 group-hover:opacity-100 transition-opacity text-xl">3x¬≤</div>
            </div>
            
            <div class="text-gray-400 font-black">+</div>

            <div class="flex flex-col items-center group">
                <div class="border-b-2 border-gray-400 px-2 mb-1">8x¬≤</div>
                <div class="text-brand-orange">4x</div>
                <div class="text-brand-purple mt-2 opacity-0 group-hover:opacity-100 transition-opacity text-xl">2x</div>
            </div>
        </div>

        <button id="btn-split-poly" class="mt-8 bg-brand-orange text-white font-bold py-3 px-8 rounded-xl shadow-btn active:scale-95 transition-all">
            <i class="fas fa-cut"></i> Separar
        </button>

        <p id="div-hint" class="text-center text-xs text-gray-400 mt-4 opacity-0 transition-opacity">Passe o mouse (ou toque) nas fra√ß√µes para ver o resultado!</p>

    </div>
    `;

                    const united = container.querySelector("#united-frac");
                    const split = container.querySelector("#split-frac");
                    const btn = container.querySelector("#btn-split-poly");
                    const hint = container.querySelector("#div-hint");

                    btn.onclick = () => {
                        // Anima√ß√£o de sumir
                        united.classList.add("scale-150", "opacity-0");
                        btn.classList.add("hidden");

                        setTimeout(() => {
                            united.classList.add("hidden");
                            split.classList.remove("hidden");
                            hint.classList.remove("opacity-0");
                        }, 500);
                    };
                },

                interactive_cube_diff_3d(container) {
                    // Estado inicial
                    let sizeA = 80; // Tamanho visual base
                    let sizeB = 30; // Tamanho visual corte

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Visualizando a Diferen√ßa</h3>

        <div class="perspective-container relative w-64 h-64 border-b-4 border-gray-300 bg-gray-50 rounded-xl mb-6 flex items-center justify-center overflow-hidden" style="perspective: 800px;">
            
            <div id="cube-group" class="relative transition-transform duration-500" style="transform-style: preserve-3d; transform: rotateX(-20deg) rotateY(45deg);">
                
                <div class="absolute" style="width: ${sizeA}px; height: ${sizeA}px; transform: translate3d(-${sizeA / 2
                        }px, -${sizeA / 2}px, 0); transform-style: preserve-3d;">
                    <div class="face absolute inset-0 bg-blue-500/20 border border-blue-400" style="transform: translateZ(${sizeA / 2
                        }px);"></div>
                    <div class="face absolute inset-0 bg-blue-500/20 border border-blue-400" style="transform: rotateY(90deg) translateZ(${sizeA / 2
                        }px);"></div>
                    <div class="face absolute inset-0 bg-blue-500/20 border border-blue-400" style="transform: rotateX(90deg) translateZ(${sizeA / 2
                        }px);"></div>
                </div>

                <div id="cube-b" class="absolute transition-all duration-1000 ease-in-out" style="width: ${sizeB}px; height: ${sizeB}px; transform-style: preserve-3d; top: -${sizeA / 2
                        }px; left: ${sizeA / 2 - sizeB}px; transform: translateZ(${sizeA / 2 - sizeB / 2
                        }px);">
                    <div class="absolute inset-0 bg-orange-500 border border-orange-600 opacity-90" style="transform: translateZ(${sizeB / 2
                        }px);"></div>
                    <div class="absolute inset-0 bg-orange-600 border border-orange-700 opacity-90" style="transform: rotateY(90deg) translateZ(${sizeB / 2
                        }px);"></div>
                    <div class="absolute inset-0 bg-orange-400 border border-orange-500 opacity-90" style="transform: rotateX(90deg) translateZ(${sizeB / 2
                        }px);"></div>
                    
                    <div class="absolute -top-6 left-0 w-full text-center text-[10px] font-bold text-orange-600 bg-white/80 rounded px-1">b¬≥</div>
                </div>

                <div class="absolute text-blue-600 font-black text-xl" style="transform: translate3d(-60px, 60px, 0);">a¬≥</div>

            </div>

        </div>

        <div class="flex gap-4">
            <button id="btn-toggle-cut" class="bg-brand-blue text-white font-bold py-2 px-6 rounded-xl shadow-btn active:scale-95 transition-all">
                Remover b¬≥
            </button>
        </div>

        <p class="text-xs text-gray-500 mt-4 text-center italic" id="feedback-text">O cubo laranja √© $b^3$. O azul √© $a^3$.</p>

    </div>
    `;

                    // CSS para faces (caso n√£o exista globalmente)
                    if (!document.getElementById("cube-styles")) {
                        const s = document.createElement("style");
                        s.id = "cube-styles";
                        s.innerHTML = `.face { position: absolute; }`;
                        container.appendChild(s);
                    }

                    const cubeB = container.querySelector("#cube-b");
                    const btn = container.querySelector("#btn-toggle-cut");
                    const feedback = container.querySelector("#feedback-text");
                    let isRemoved = false;

                    btn.onclick = () => {
                        isRemoved = !isRemoved;
                        if (isRemoved) {
                            // Anima√ß√£o de sa√≠da
                            cubeB.style.transform = `translate3d(50px, -50px, 100px) rotateX(20deg) rotateY(20deg)`;
                            cubeB.style.opacity = "0.5";
                            feedback.innerHTML =
                                "O que sobra √© <strong class='text-brand-purple'>$a^3 - b^3$</strong>";
                            btn.innerText = "Devolver b¬≥";
                            btn.className =
                                "bg-gray-500 text-white font-bold py-2 px-6 rounded-xl shadow-sm active:scale-95 transition-all";

                            // Re-render MathJax se necess√°rio
                            if (window.renderMathInElement) renderMathInElement(feedback);
                        } else {
                            // Reset
                            cubeB.style.transform = `translateZ(${sizeA / 2 - sizeB / 2
                                }px)`;
                            cubeB.style.opacity = "1";
                            feedback.innerHTML = "O cubo laranja √© $b^3$. O azul √© $a^3$.";
                            btn.innerText = "Remover b¬≥";
                            btn.className =
                                "bg-brand-blue text-white font-bold py-2 px-6 rounded-xl shadow-btn active:scale-95 transition-all";
                            if (window.renderMathInElement) renderMathInElement(feedback);
                        }
                    };
                },

                interactive_soap_machine(container) {
                    let mode = "minus"; // 'plus' or 'minus'

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-6">
            <h3 class="text-brand-text font-bold uppercase text-xs tracking-widest">M√°quina de Fatora√ß√£o S.O.P.</h3>
            
            <div class="flex bg-gray-100 p-1 rounded-lg">
                <button class="mode-btn px-4 py-1 rounded text-xs font-bold transition-all bg-white text-brand-orange shadow-sm" data-m="minus">a¬≥ - b¬≥</button>
                <button class="mode-btn px-4 py-1 rounded text-xs font-bold transition-all text-gray-400 hover:bg-white" data-m="plus">a¬≥ + b¬≥</button>
            </div>
        </div>

        <div class="w-full bg-gray-900 rounded-2xl p-6 text-white font-mono text-xl md:text-2xl text-center shadow-inner relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand-blue via-brand-purple to-brand-orange"></div>
            
            <div class="mb-4 opacity-50 text-sm">Problema</div>
            <div class="mb-6 font-bold tracking-widest">
                a¬≥ <span id="sign-main" class="text-brand-yellow bg-white/10 px-2 rounded">-</span> b¬≥
            </div>

            <div class="w-full h-px bg-gray-700 mb-6"></div>

            <div class="mb-2 opacity-50 text-sm">Fatora√ß√£o (S.O.P.)</div>
            <div class="flex flex-wrap justify-center items-center gap-2">
                <span>( a</span>
                <span id="sign-1" class="font-black text-brand-green bg-green-900/50 px-2 py-1 rounded border border-green-500 transition-all">-</span>
                <span>b ) ( a¬≤</span>
                <span id="sign-2" class="font-black text-brand-red bg-red-900/50 px-2 py-1 rounded border border-red-500 transition-all">+</span>
                <span>ab</span>
                <span id="sign-3" class="font-black text-brand-blue bg-blue-900/50 px-2 py-1 rounded border border-blue-500 transition-all">+</span>
                <span>b¬≤ )</span>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-4 mt-6 w-full text-center text-xs font-bold uppercase">
            <div class="p-2 bg-green-50 rounded-lg border border-green-200">
                <div class="text-brand-green text-lg mb-1">S</div>
                Same<br>(Igual)
            </div>
            <div class="p-2 bg-red-50 rounded-lg border border-red-200">
                <div class="text-brand-red text-lg mb-1">O</div>
                Opposite<br>(Oposto)
            </div>
            <div class="p-2 bg-blue-50 rounded-lg border border-blue-200">
                <div class="text-brand-blue text-lg mb-1">P</div>
                Positive<br>(Sempre +)
            </div>
        </div>

    </div>
    `;

                    const signMain = container.querySelector("#sign-main");
                    const sign1 = container.querySelector("#sign-1");
                    const sign2 = container.querySelector("#sign-2");
                    const sign3 = container.querySelector("#sign-3"); // Sempre +
                    const btns = container.querySelectorAll(".mode-btn");

                    const update = () => {
                        if (mode === "minus") {
                            signMain.innerText = "-";
                            sign1.innerText = "-"; // Same
                            sign2.innerText = "+"; // Opposite

                            signMain.className =
                                "text-brand-red bg-white/10 px-2 rounded animate-pulse";
                            sign1.className =
                                "font-black text-brand-green bg-green-900/50 px-2 py-1 rounded border border-green-500 transition-all";
                            sign2.className =
                                "font-black text-brand-red bg-red-900/50 px-2 py-1 rounded border border-red-500 transition-all";
                        } else {
                            signMain.innerText = "+";
                            sign1.innerText = "+"; // Same
                            sign2.innerText = "-"; // Opposite

                            signMain.className =
                                "text-brand-green bg-white/10 px-2 rounded animate-pulse";
                            sign1.className =
                                "font-black text-brand-green bg-green-900/50 px-2 py-1 rounded border border-green-500 transition-all";
                            sign2.className =
                                "font-black text-brand-red bg-red-900/50 px-2 py-1 rounded border border-red-500 transition-all";
                        }
                        // Sign 3 is always positive
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            mode = btn.dataset.m;
                            btns.forEach((b) => {
                                b.className =
                                    b === btn
                                        ? "mode-btn px-4 py-1 rounded text-xs font-bold transition-all bg-white text-brand-purple shadow-sm ring-1 ring-purple-200"
                                        : "mode-btn px-4 py-1 rounded text-xs font-bold transition-all text-gray-400 hover:bg-white";
                            });
                            update();
                        };
                    });
                },

                interactive_cube_ninja(container) {
                    let score = 0;
                    let isPlaying = false;
                    let spawnInterval;

                    // Lista de Cubos e Intrusos
                    const cubes = [1, 8, 27, 64, 125, 216, 343, 512, 729, 1000];
                    const fakes = [4, 9, 16, 25, 36, 49, 81, 100, 12, 18, 24, 50];

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[400px]">
        
        <div class="flex justify-between w-full items-center mb-2 z-20">
            <div class="text-white font-bold text-xs uppercase bg-gray-800 px-3 py-1 rounded-full border border-gray-600">Alvo: Cubos Perfeitos (n¬≥)</div>
            <div class="text-white font-black text-xl">Score: <span id="ninja-score" class="text-brand-green">0</span></div>
        </div>

        <div id="game-canvas" class="absolute inset-0 top-12 z-10 cursor-crosshair touch-none"></div>

        <div id="start-screen" class="absolute inset-0 bg-gray-900/95 z-30 flex flex-col items-center justify-center text-center p-6">
            <div class="text-6xl mb-4">üßä</div>
            <h3 class="text-2xl font-black text-white mb-2">Ninja dos Cubos</h3>
            <p class="text-gray-400 text-sm mb-6">Corte APENAS os cubos perfeitos (ex: 8, 27).<br>N√£o corte os quadrados (ex: 4, 9)!</p>
            <button id="btn-play-ninja" class="bg-brand-purple text-white font-bold py-3 px-10 rounded-full shadow-[0_0_15px_rgba(206,130,255,0.6)] animate-pulse">JOGAR</button>
        </div>
    </div>
    `;

                    const canvas = container.querySelector("#game-canvas");
                    const scoreEl = container.querySelector("#ninja-score");
                    const startScreen = container.querySelector("#start-screen");
                    const btnPlay = container.querySelector("#btn-play-ninja");

                    const spawnItem = () => {
                        if (!isPlaying) return;

                        const isTarget = Math.random() > 0.5;
                        let val;

                        if (isTarget) {
                            val = cubes[Math.floor(Math.random() * cubes.length)];
                        } else {
                            val = fakes[Math.floor(Math.random() * fakes.length)];
                        }

                        const el = document.createElement("div");
                        // Estilo "Bloco"
                        el.className =
                            "absolute flex items-center justify-center w-16 h-16 bg-gray-800 border-2 border-gray-600 rounded-lg text-white font-black text-2xl shadow-xl cursor-pointer hover:scale-110 active:scale-95 transition-transform select-none";

                        // Cor do texto baseada se √© alvo ou n√£o? N√£o, isso facilitaria demais. Todos brancos/cinzas.
                        // O jogador precisa saber a matem√°tica.
                        el.innerText = val;

                        // F√≠sica
                        let x = Math.random() * (canvas.offsetWidth - 60);
                        let y = canvas.offsetHeight;
                        let vx = (Math.random() - 0.5) * 3;
                        let vy = -(Math.random() * 5 + 9); // Impulso para cima
                        let rot = 0;
                        let vrot = (Math.random() - 0.5) * 10;

                        el.style.left = `${x}px`;
                        el.style.top = `${y}px`;

                        // Intera√ß√£o
                        const slice = (e) => {
                            e.stopPropagation();
                            if (isTarget) {
                                score += 10;
                                scoreEl.innerText = score;
                                // Efeito visual corte
                                el.style.transform = `scale(1.5) rotate(${rot}deg)`;
                                el.style.opacity = 0;
                                el.style.backgroundColor = "#58CC02"; // Verde
                                el.style.borderColor = "#22C55E";

                                // Part√≠culas
                                const splash = document.createElement("div");
                                splash.className =
                                    "absolute text-2xl font-bold text-green-400 animate-ping pointer-events-none";
                                splash.style.left = el.style.left;
                                splash.style.top = el.style.top;
                                splash.innerText = `‚àö = ${Math.cbrt(val)}`;
                                canvas.appendChild(splash);
                                setTimeout(() => splash.remove(), 500);
                            } else {
                                score = Math.max(0, score - 10);
                                scoreEl.innerText = score;
                                el.style.backgroundColor = "#EF4444"; // Vermelho
                                el.classList.add("animate-shake");

                                // Feedback erro
                                const splash = document.createElement("div");
                                splash.className =
                                    "absolute text-sm font-bold text-red-400 pointer-events-none";
                                splash.style.left = el.style.left;
                                splash.style.top = el.style.top;
                                splash.innerText = "N√£o √© cubo!";
                                canvas.appendChild(splash);
                                setTimeout(() => splash.remove(), 1000);
                            }
                            setTimeout(() => el.remove(), 200);
                        };

                        el.onmousedown = slice;
                        el.ontouchstart = slice;

                        canvas.appendChild(el);

                        // Loop de Anima√ß√£o do Elemento
                        const updatePos = () => {
                            if (!isPlaying || !el.parentNode) return;
                            x += vx;
                            y += vy;
                            vy += 0.3; // Gravidade
                            rot += vrot;

                            el.style.left = `${x}px`;
                            el.style.top = `${y}px`;
                            el.style.transform = `rotate(${rot}deg)`;

                            if (y > canvas.offsetHeight + 100) {
                                el.remove();
                            } else {
                                requestAnimationFrame(updatePos);
                            }
                        };
                        requestAnimationFrame(updatePos);
                    };

                    btnPlay.onclick = () => {
                        startScreen.classList.add("hidden");
                        isPlaying = true;
                        score = 0;
                        scoreEl.innerText = 0;

                        spawnInterval = setInterval(spawnItem, 1000); // 1 item por segundo

                        // Game Over ap√≥s 30s
                        setTimeout(() => {
                            isPlaying = false;
                            clearInterval(spawnInterval);
                            startScreen.classList.remove("hidden");
                            startScreen.querySelector("h3").innerText = "Tempo Esgotado!";
                            startScreen.querySelector(
                                "p"
                            ).innerText = `Pontua√ß√£o Final: ${score}`;
                            btnPlay.innerText = "JOGAR NOVAMENTE";
                            // Limpa canvas
                            canvas.innerHTML = "";
                        }, 30000);
                    };
                },

                interactive_existence_condition(container) {
                    // Configura√ß√£o: 5 / (x - 3)
                    let xVal = 0;
                    const forbidden = 3;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden relative">
        
        <h3 class="text-brand-red font-bold uppercase text-xs tracking-widest mb-6">Detector de Perigo</h3>

        <div class="flex items-center gap-4 text-4xl md:text-5xl font-mono font-bold mb-8 transition-all" id="frac-display">
            <span class="text-gray-400">5</span>
            <span class="text-gray-300 text-2xl mx-2">/</span>
            <div class="flex items-center bg-gray-100 px-4 py-2 rounded-xl border-b-4 border-gray-300 transition-colors duration-300" id="denom-box">
                <span class="text-brand-blue" id="val-x">0</span>
                <span class="text-gray-500 mx-2">-</span>
                <span class="text-gray-500">3</span>
            </div>
        </div>

        <div class="w-full max-w-xs">
            <div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-2">
                <span>Valor de X</span>
                <span id="slider-readout">0</span>
            </div>
            <input type="range" id="x-slider" min="-5" max="10" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue">
        </div>

        <div id="status-msg" class="mt-6 font-bold text-sm h-6 text-center text-brand-green">
            C√°lculo Seguro. (0 - 3 = -3)
        </div>

        <div id="boom-overlay" class="absolute inset-0 bg-red-500 flex flex-col items-center justify-center text-white opacity-0 pointer-events-none transition-opacity duration-200 z-10">
            <div class="text-6xl mb-2 animate-bounce">üí•</div>
            <div class="text-2xl font-black uppercase tracking-widest">Erro Matem√°tico!</div>
            <div class="text-sm font-bold opacity-90 mt-2">Divis√£o por Zero Imposs√≠vel</div>
        </div>

    </div>
    `;

                    const slider = container.querySelector("#x-slider");
                    const valX = container.querySelector("#val-x");
                    const readout = container.querySelector("#slider-readout");
                    const denomBox = container.querySelector("#denom-box");
                    const statusMsg = container.querySelector("#status-msg");
                    const overlay = container.querySelector("#boom-overlay");

                    const update = () => {
                        xVal = parseInt(slider.value);
                        valX.innerText = xVal < 0 ? `(${xVal})` : xVal;
                        readout.innerText = xVal;

                        const result = xVal - forbidden;

                        if (result === 0) {
                            // Perigo!
                            denomBox.className =
                                "flex items-center bg-red-100 px-4 py-2 rounded-xl border-b-4 border-red-400 text-red-600 animate-shake";
                            statusMsg.innerHTML = "";
                            overlay.classList.remove("opacity-0");
                            overlay.classList.add("opacity-100");
                        } else {
                            // Seguro
                            denomBox.className =
                                "flex items-center bg-gray-100 px-4 py-2 rounded-xl border-b-4 border-gray-300 text-gray-700";
                            statusMsg.className =
                                "mt-6 font-bold text-sm h-6 text-center text-brand-green";
                            statusMsg.innerText = `C√°lculo Seguro. Denominador = ${result}`;
                            overlay.classList.remove("opacity-100");
                            overlay.classList.add("opacity-0");
                        }
                    };

                    slider.addEventListener("input", update);
                    update();
                },

                interactive_cancel_ninja(container) {
                    // Express√£o: (2(x+1)) / (4(x+1))
                    // Termos clic√°veis
                    let state = {
                        topCoeff: true, // 2
                        topBinom: true, // (x+1)
                        botCoeff: true, // 4
                        botBinom: true, // (x+1)
                    };

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        <div class="flex justify-between w-full items-center mb-6">
            <h3 class="text-brand-purple font-black uppercase text-xs tracking-widest"><i class="fas fa-cut"></i> Simplifique!</h3>
            <button id="btn-reset-ninja" class="text-xs font-bold text-brand-blue hover:underline">Reiniciar</button>
        </div>

        <div class="flex flex-col items-center gap-2 text-2xl md:text-4xl font-mono font-bold text-gray-700 bg-gray-50 p-6 rounded-2xl border-2 border-dashed border-gray-300 transition-all duration-500" id="fraction-area">
            
            <div class="flex gap-2 items-center z-10">
                <span id="term-2" class="cursor-pointer hover:text-red-500 hover:scale-110 transition-transform p-1 rounded">2</span>
                <span class="text-gray-400">¬∑</span>
                <span id="term-x1-top" class="cursor-pointer hover:text-red-500 hover:scale-110 transition-transform p-1 rounded bg-blue-50 text-brand-blue border border-blue-100">(x + 1)</span>
            </div>

            <div class="w-full h-1 bg-gray-800 rounded-full my-1"></div>

            <div class="flex gap-2 items-center z-10">
                <span id="term-4" class="cursor-pointer hover:text-red-500 hover:scale-110 transition-transform p-1 rounded">4</span>
                <span class="text-gray-400">¬∑</span>
                <span id="term-x1-bot" class="cursor-pointer hover:text-red-500 hover:scale-110 transition-transform p-1 rounded bg-blue-50 text-brand-blue border border-blue-100">(x + 1)</span>
            </div>

            <div id="slash-effect" class="absolute pointer-events-none text-red-500 font-black text-6xl opacity-0 transition-opacity" style="text-shadow: 2px 2px 0px white;">/</div>
        </div>

        <div id="ninja-feedback" class="h-8 mt-4 font-bold text-sm text-center">
            Clique nos termos iguais ou divis√≠veis!
        </div>

        <div id="final-res-ninja" class="hidden mt-2 bg-green-100 text-green-800 px-4 py-2 rounded-xl font-bold animate-pop-in border border-green-300">
            Resultado Final: 1 / 2
        </div>

    </div>
    `;

                    const term2 = container.querySelector("#term-2");
                    const term4 = container.querySelector("#term-4");
                    const termXTop = container.querySelector("#term-x1-top");
                    const termXBot = container.querySelector("#term-x1-bot");
                    const slash = container.querySelector("#slash-effect");
                    const feedback = container.querySelector("#ninja-feedback");
                    const finalRes = container.querySelector("#final-res-ninja");
                    const fracArea = container.querySelector("#fraction-area");
                    const btnReset = container.querySelector("#btn-reset-ninja");

                    const playSlash = (x, y) => {
                        slash.style.left = `${x}px`;
                        slash.style.top = `${y}px`;
                        slash.style.opacity = 1;
                        slash.style.transform = `scale(1.5) rotate(${Math.random() * 90 - 45
                            }deg)`;
                        setTimeout(() => {
                            slash.style.opacity = 0;
                            slash.style.transform = `scale(1)`;
                        }, 300);
                    };

                    const checkWin = () => {
                        if (
                            !state.topBinom &&
                            !state.botBinom &&
                            !state.topCoeff &&
                            !state.botCoeff
                        ) {
                            feedback.innerHTML = "";
                            fracArea.classList.add("opacity-50", "scale-90", "blur-sm");
                            finalRes.classList.remove("hidden");
                        }
                    };

                    // L√≥gica Bin√¥mios (Iguais)
                    const cutBinomials = (e) => {
                        if (state.topBinom && state.botBinom) {
                            // Sucesso
                            state.topBinom = false;
                            state.botBinom = false;

                            // Efeito visual
                            termXTop.classList.add(
                                "line-through",
                                "text-red-400",
                                "opacity-50",
                                "pointer-events-none"
                            );
                            termXBot.classList.add(
                                "line-through",
                                "text-red-400",
                                "opacity-50",
                                "pointer-events-none"
                            );

                            feedback.innerHTML =
                                "<span class='text-green-600'>Boa! (x+1) dividido por (x+1) d√° 1.</span>";
                            checkWin();
                        } else {
                            feedback.innerHTML = "J√° cortado!";
                        }
                    };

                    // L√≥gica Coeficientes (2 e 4)
                    const cutCoeffs = (e) => {
                        if (state.topCoeff && state.botCoeff) {
                            state.topCoeff = false;
                            state.botCoeff = false;

                            term2.innerHTML = "<span class='text-brand-green'>1</span>";
                            term2.classList.add("pointer-events-none");

                            term4.innerHTML = "<span class='text-brand-green'>2</span>";
                            term4.classList.add("pointer-events-none");

                            feedback.innerHTML =
                                "<span class='text-green-600'>Isso! Simplificamos 2/4 por 2.</span>";
                            checkWin();
                        }
                    };

                    termXTop.onclick = cutBinomials;
                    termXBot.onclick = cutBinomials;
                    term2.onclick = cutCoeffs;
                    term4.onclick = cutCoeffs;

                    btnReset.onclick = () => {
                        app.widgets.interactive_cancel_ninja(container);
                    };
                },

                interactive_poly_lcm_builder(container) {
                    // Fra√ß√µes: 1/x  e  1/(x+1)
                    // MMC Alvo: x(x+1)
                    let built = { part1: false, part2: false };

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Construtor de MMC</h3>

        <div class="flex gap-8 mb-6 text-xl font-mono font-bold text-gray-500">
            <div class="flex flex-col items-center">
                <span>1</span>
                <div class="w-full h-0.5 bg-gray-400"></div>
                <span class="text-brand-purple">x</span>
            </div>
            <div class="flex flex-col items-center justify-center text-2xl">+</div>
            <div class="flex flex-col items-center">
                <span>1</span>
                <div class="w-full h-0.5 bg-gray-400"></div>
                <span class="text-brand-orange">(x+1)</span>
            </div>
        </div>

        <div class="w-full bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl p-4 min-h-[80px] flex items-center justify-center gap-2 mb-4 transition-all" id="drop-zone-lcm">
            <span class="text-xs font-bold text-gray-400 uppercase pointer-events-none select-none" id="drop-hint">Arraste ou Clique nos Fatores para formar o MMC</span>
        </div>

        <div class="flex gap-3 justify-center w-full">
            <button class="factor-btn bg-purple-100 border-2 border-purple-200 text-brand-purple px-4 py-2 rounded-lg font-bold shadow-sm hover:scale-105 active:scale-95 transition-all" data-val="x">x</button>
            <button class="factor-btn bg-orange-100 border-2 border-orange-200 text-brand-orange px-4 py-2 rounded-lg font-bold shadow-sm hover:scale-105 active:scale-95 transition-all" data-val="(x+1)">(x+1)</button>
            <button class="factor-btn bg-red-100 border-2 border-red-200 text-brand-red px-4 py-2 rounded-lg font-bold shadow-sm hover:scale-105 active:scale-95 transition-all" data-val="2">2</button>
        </div>

        <div id="lcm-feedback" class="h-8 mt-4 font-bold text-sm text-center"></div>

    </div>
    `;

                    const dropZone = container.querySelector("#drop-zone-lcm");
                    const btns = container.querySelectorAll(".factor-btn");
                    const feedback = container.querySelector("#lcm-feedback");
                    const hint = container.querySelector("#drop-hint");

                    const addFactor = (val, btn) => {
                        hint.style.display = "none";

                        // Verifica se √© v√°lido para este problema
                        if (val === "2") {
                            feedback.innerHTML =
                                "<span class='text-red-500'>O 2 n√£o aparece em nenhum denominador!</span>";
                            btn.classList.add("animate-shake");
                            setTimeout(() => btn.classList.remove("animate-shake"), 500);
                            return;
                        }

                        // Evita duplicatas visuais
                        if (
                            (val === "x" && built.part1) ||
                            (val === "(x+1)" && built.part2)
                        ) {
                            feedback.innerHTML =
                                "<span class='text-orange-500'>J√° adicionou esse! Pega o maior expoente (aqui √© 1).</span>";
                            return;
                        }

                        // Adiciona visualmente
                        const el = document.createElement("div");
                        el.className = `px-3 py-1 rounded font-bold text-lg animate-pop-in ${val === "x"
                            ? "bg-purple-100 text-brand-purple"
                            : "bg-orange-100 text-brand-orange"
                            }`;
                        el.innerText = val;
                        dropZone.appendChild(el);

                        if (val === "x") built.part1 = true;
                        if (val === "(x+1)") built.part2 = true;

                        btn.classList.add("opacity-50", "cursor-not-allowed");
                        feedback.innerText = "";

                        // Check Win
                        if (built.part1 && built.part2) {
                            dropZone.className =
                                "w-full bg-green-50 border-2 border-brand-green rounded-xl p-4 min-h-[80px] flex items-center justify-center gap-2 mb-4 transition-all";
                            feedback.innerHTML =
                                "<span class='text-brand-green'>Perfeito! MMC = x(x+1). Agora ajustamos os numeradores.</span>";
                        }
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => addFactor(btn.dataset.val, btn);
                    });
                },

                interactive_alg_flip_card(container) {
                    let isFlipped = false;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-8">O Truque da Divis√£o</h3>

        <div class="flex items-center gap-2 md:gap-4 text-xl md:text-3xl font-mono font-bold text-gray-600 mb-8">
            
            <div class="flex flex-col items-center">
                <span class="text-brand-blue">A</span>
                <div class="w-8 h-0.5 bg-black my-1"></div>
                <span>B</span>
            </div>

            <div id="op-symbol" class="text-brand-orange text-4xl transition-all duration-500">√∑</div>

            <div id="flip-fraction" class="flex flex-col items-center cursor-pointer transition-transform duration-700 p-2 rounded-lg hover:bg-orange-50 border-2 border-transparent hover:border-orange-200" style="transform-style: preserve-3d;">
                <span class="text-brand-green block transition-all" id="term-top">C</span>
                <div class="w-8 h-0.5 bg-black my-1"></div>
                <span class="text-brand-purple block transition-all" id="term-bot">D</span>
            </div>

        </div>

        <button id="btn-do-flip" class="bg-brand-orange hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-xl shadow-btn active:scale-95 transition-all flex items-center gap-2">
            <i class="fas fa-sync-alt"></i> Inverter e Multiplicar
        </button>

        <p id="flip-msg" class="text-center text-sm text-gray-500 mt-6 h-6">A divis√£o vira multiplica√ß√£o pelo inverso.</p>

    </div>
    `;

                    const btn = container.querySelector("#btn-do-flip");
                    const fracBox = container.querySelector("#flip-fraction");
                    const op = container.querySelector("#op-symbol");
                    const msg = container.querySelector("#flip-msg");

                    // Elementos internos para "trocar" conte√∫do ap√≥s rota√ß√£o visual
                    const topEl = container.querySelector("#term-top");
                    const botEl = container.querySelector("#term-bot");

                    btn.onclick = async () => {
                        if (isFlipped) {
                            // Reset
                            isFlipped = false;
                            btn.innerHTML = `<i class="fas fa-sync-alt"></i> Inverter e Multiplicar`;
                            btn.className =
                                "bg-brand-orange hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-xl shadow-btn active:scale-95 transition-all flex items-center gap-2";
                            msg.innerText = "A divis√£o vira multiplica√ß√£o pelo inverso.";
                            msg.className = "text-center text-sm text-gray-500 mt-6 h-6";

                            // Anima√ß√£o de volta
                            fracBox.style.transform = "rotateX(0deg)";
                            op.innerText = "√∑";
                            op.classList.replace("text-brand-green", "text-brand-orange");

                            // Troca valores no meio da anima√ß√£o seria ideal, mas aqui simplificamos mantendo a posi√ß√£o original visualmente
                            // Na verdade, 0deg √© C/D. 180deg seria D/C?
                            // Vamos fazer simples: rotate 0 -> C/D. Rotate 180 -> D/C visualmente

                            // Reverte textos
                            // Espera metade da anima√ß√£o? N√£o, CSS transform resolve a posi√ß√£o, mas os n√∫meros ficariam de cabe√ßa para baixo.
                            // Truque: Girar 360 e trocar o conte√∫do.

                            fracBox.style.transform = "rotateX(0deg)";
                            setTimeout(() => {
                                topEl.innerText = "C";
                                botEl.innerText = "D";
                            }, 150); // Troca r√°pido enquanto volta
                        } else {
                            // A√ß√£o
                            isFlipped = true;
                            btn.disabled = true;
                            btn.classList.add("opacity-50");

                            // 1. Rota√ß√£o Visual
                            fracBox.style.transform = "rotateX(180deg)";

                            // 2. Troca Operador
                            op.style.opacity = 0;
                            setTimeout(() => {
                                op.innerText = "√ó";
                                op.classList.replace("text-brand-orange", "text-brand-green");
                                op.style.opacity = 1;
                            }, 200);

                            // 3. Corrige orienta√ß√£o dos textos (pois o container girou 180)
                            // Na verdade, ao girar 180, o topo vai pra baixo e fica invertido.
                            // Precisamos trocar o texto E des-inverter o texto individualmente?
                            // Melhor: Apenas simular o giro trocando os valores com opacidade.

                            // Reset rota√ß√£o f√≠sica e anima via escala/opacidade para simular giro
                            fracBox.style.transition = "transform 0.5s";
                            fracBox.style.transform = "scaleY(0)"; // Achata

                            setTimeout(() => {
                                // Troca valores
                                topEl.innerText = "D"; // Invertido
                                botEl.innerText = "C";
                                topEl.classList.replace(
                                    "text-brand-green",
                                    "text-brand-purple"
                                ); // Troca cores
                                botEl.classList.replace(
                                    "text-brand-purple",
                                    "text-brand-green"
                                );

                                fracBox.style.transform = "scaleY(1)"; // Abre

                                btn.innerHTML = `<i class="fas fa-undo"></i> Reiniciar`;
                                btn.className =
                                    "bg-gray-400 text-white font-bold py-3 px-8 rounded-xl hover:bg-gray-500 transition-all flex items-center gap-2";
                                btn.disabled = false;
                                btn.classList.remove("opacity-50");

                                msg.innerHTML =
                                    "<span class='text-brand-green font-bold'>Pronto!</span> Agora √© s√≥ multiplicar reto: (A¬∑D) / (B¬∑C).";
                            }, 500);
                        }
                    };
                },

                interactive_linear_plotter(container) {
                    // Configura√ß√£o
                    const targetSum = 5; // x + y = 5
                    let pointsFound = [];
                    const maxPoints = 3;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Descubra a Reta: x + y = 5</h3>
        
        <div class="relative w-[280px] h-[280px] bg-white border-2 border-gray-300 rounded-xl mb-6 shadow-inner cursor-crosshair" id="plot-area">
            <div class="absolute inset-0" style="background-image: linear-gradient(#e5e7eb 1px, transparent 1px), linear-gradient(90deg, #e5e7eb 1px, transparent 1px); background-size: 28px 28px;"></div>
            
            <div class="absolute bottom-0 left-0 w-1 h-full bg-black"></div>
            <div class="absolute bottom-0 left-0 w-full h-1 bg-black"></div>
            
            <svg class="absolute inset-0 w-full h-full pointer-events-none overflow-visible">
                <line id="solution-line" x1="0" y1="280" x2="280" y2="0" stroke="#1CB0F6" stroke-width="4" stroke-linecap="round" class="opacity-0 transition-opacity duration-1000" />
            </svg>
            
            <div id="points-layer" class="absolute inset-0 w-full h-full"></div>
        </div>

        <div class="flex gap-4 w-full max-w-xs items-center mb-2">
            <div class="flex flex-col items-center flex-1">
                <label class="text-[10px] font-bold text-gray-400 uppercase">Valor X</label>
                <input type="number" id="inp-x" min="0" max="10" class="w-full border-2 border-gray-200 rounded-lg p-2 text-center font-bold text-xl outline-none focus:border-brand-blue">
            </div>
            <span class="text-2xl font-black text-gray-300">+</span>
            <div class="flex flex-col items-center flex-1">
                <label class="text-[10px] font-bold text-gray-400 uppercase">Valor Y</label>
                <input type="number" id="inp-y" min="0" max="10" class="w-full border-2 border-gray-200 rounded-lg p-2 text-center font-bold text-xl outline-none focus:border-brand-blue">
            </div>
        </div>

        <button id="btn-plot" class="w-full max-w-xs bg-brand-green text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all mb-4">
            Testar Ponto
        </button>

        <div id="plot-feedback" class="h-8 text-sm font-bold text-center"></div>

    </div>
    `;

                    const inpX = container.querySelector("#inp-x");
                    const inpY = container.querySelector("#inp-y");
                    const btnPlot = container.querySelector("#btn-plot");
                    const layer = container.querySelector("#points-layer");
                    const line = container.querySelector("#solution-line");
                    const feedback = container.querySelector("#plot-feedback");

                    // Escala: 280px / 10 unidades = 28px por unidade
                    const scale = 28;

                    const plotPoint = () => {
                        const x = parseInt(inpX.value);
                        const y = parseInt(inpY.value);

                        if (isNaN(x) || isNaN(y)) {
                            feedback.innerHTML =
                                "<span class='text-brand-orange'>Digite n√∫meros v√°lidos!</span>";
                            return;
                        }

                        // Verifica Equa√ß√£o
                        const isSolution = x + y === targetSum;

                        // Cria ponto visual
                        const pt = document.createElement("div");
                        // Coordenadas: bottom-left √© 0,0.
                        // left = x * scale. bottom = y * scale.
                        // Precisamos ajustar o tamanho do ponto (w-4 h-4 = 16px) para centralizar
                        pt.className = `absolute w-4 h-4 rounded-full border-2 border-white shadow-sm transform -translate-x-1/2 translate-y-1/2 transition-all duration-300 ${isSolution ? "bg-brand-green" : "bg-brand-red"
                            }`;
                        pt.style.left = `${x * scale}px`;
                        pt.style.bottom = `${y * scale}px`; // bottom funciona bem aqui pois os eixos estao em bottom-left

                        layer.appendChild(pt);

                        if (isSolution) {
                            // Verifica duplicatas
                            const exists = pointsFound.some((p) => p.x === x && p.y === y);
                            if (!exists) {
                                pointsFound.push({ x, y });
                                feedback.innerHTML = `<span class='text-brand-green'>Acertou! (${x}, ${y}) √© solu√ß√£o.</span>`;

                                if (pointsFound.length >= maxPoints) {
                                    line.classList.remove("opacity-0");
                                    feedback.innerHTML = `<span class='text-brand-blue font-black animate-pulse'>A RETA APARECEU!</span>`;
                                    btnPlot.disabled = true;
                                    btnPlot.classList.add("opacity-50");

                                    // Desenha linha correta no SVG baseada na equa√ß√£o x+y=5
                                    // (0,5) -> (5,0)
                                    // SVG coords: (0, 280 - 5*28) -> (5*28, 280 - 0)
                                    // (0, 140) -> (140, 280)
                                    line.setAttribute("x1", 0);
                                    line.setAttribute("y1", 280 - 5 * 28);
                                    line.setAttribute("x2", 5 * 28);
                                    line.setAttribute("y2", 280);
                                }
                            } else {
                                feedback.innerHTML =
                                    "<span class='text-brand-orange'>Voc√™ j√° achou esse ponto!</span>";
                            }
                        } else {
                            feedback.innerHTML = `<span class='text-brand-red'>Errou! ${x} + ${y} ‚â† 5. Ponto fora da reta.</span>`;
                        }
                    };

                    btnPlot.onclick = plotPoint;
                },

                interactive_system_intersection(container) {
                    // Sistema: x+y=6 (Vermelho), x-y=2 (Azul) -> Solu√ß√£o (4,2)

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Onde est√° a solu√ß√£o?</h3>

        <div class="flex gap-4 text-sm font-mono font-bold mb-4">
            <span class="text-brand-red">x + y = 6</span>
            <span class="text-brand-blue">x - y = 2</span>
        </div>
        
        <div class="relative w-[300px] h-[300px] bg-gray-50 border-2 border-gray-300 rounded-xl mb-4 cursor-pointer overflow-hidden shadow-inner group" id="system-graph">
            <div class="absolute inset-0 pointer-events-none" style="background-image: linear-gradient(#ccc 1px, transparent 1px), linear-gradient(90deg, #ccc 1px, transparent 1px); background-size: 30px 30px;"></div>
            
            <div class="absolute bottom-0 left-0 w-1 h-full bg-black z-0"></div>
            <div class="absolute bottom-0 left-0 w-full h-1 bg-black z-0"></div>

            <svg class="absolute inset-0 w-full h-full pointer-events-none z-10 overflow-visible">
                <line x1="0" y1="120" x2="180" y2="300" stroke="#FF4B4B" stroke-width="4" stroke-linecap="round" />
                <line x1="60" y1="300" x2="210" y2="150" stroke="#1CB0F6" stroke-width="4" stroke-linecap="round" />
            </svg>

            <div id="target-zone" class="absolute w-12 h-12 rounded-full z-20" style="left: 105px; top: 165px;"></div>
            
            <div id="marker" class="absolute w-4 h-4 bg-brand-green rounded-full border-2 border-white shadow-lg hidden pointer-events-none z-30 transition-all"></div>
        </div>

        <p class="text-xs text-center text-gray-500 mb-2">Clique no ponto onde as regras se encontram.</p>
        <div id="sys-feedback" class="h-8 font-bold text-sm text-center"></div>

    </div>
    `;

                    const graph = container.querySelector("#system-graph");
                    const target = container.querySelector("#target-zone");
                    const marker = container.querySelector("#marker");
                    const feedback = container.querySelector("#sys-feedback");

                    graph.onclick = (e) => {
                        const rect = graph.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;

                        // Pega bounding do target
                        const tRect = target.getBoundingClientRect();
                        const tX = tRect.left - rect.left + tRect.width / 2;
                        const tY = tRect.top - rect.top + tRect.height / 2;

                        const dist = Math.sqrt(Math.pow(x - tX, 2) + Math.pow(y - tY, 2));

                        marker.style.left = `${x - 8}px`; // -8 para centralizar (w-4=16px)
                        marker.style.top = `${y - 8}px`;
                        marker.classList.remove("hidden");

                        if (dist < 25) {
                            // Toler√¢ncia de clique
                            // Snap to center
                            marker.style.left = `${tX - 8}px`;
                            marker.style.top = `${tY - 8}px`;
                            marker.classList.add("scale-150", "bg-brand-green");
                            marker.classList.remove("bg-brand-red");
                            feedback.innerHTML =
                                "<span class='text-brand-green'>Exato! Solu√ß√£o (4, 2).</span>";
                        } else {
                            marker.classList.add("bg-brand-red");
                            marker.classList.remove("bg-brand-green", "scale-150");
                            feedback.innerHTML =
                                "<span class='text-brand-red'>Aqui n√£o! Precisa ser na intersec√ß√£o.</span>";
                        }
                    };
                },

                interactive_system_classifier(container) {
                    let slope1 = 1;
                    let offset1 = 0;
                    let slope2 = -1;
                    let offset2 = 4;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-4">
            <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest">Classificador de Sistemas</h3>
            <div id="class-badge" class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-black uppercase">SPD</div>
        </div>

        <div class="relative w-64 h-64 bg-gray-50 border border-gray-300 rounded-xl mb-6 overflow-hidden">
            <svg id="class-svg" width="100%" height="100%" viewBox="-10 -10 20 20" preserveAspectRatio="xMidYMid slice">
                <line x1="-10" y1="0" x2="10" y2="0" stroke="#ddd" stroke-width="0.1" />
                <line x1="0" y1="-10" x2="0" y2="10" stroke="#ddd" stroke-width="0.1" />
                
                <line id="line-r1" x1="-10" y1="-10" x2="10" y2="10" stroke="#1CB0F6" stroke-width="0.5" />
                <line id="line-r2" x1="-10" y1="10" x2="10" y2="-10" stroke="#FF4B4B" stroke-width="0.5" />
            </svg>
        </div>

        <div class="grid grid-cols-2 gap-6 w-full max-w-sm">
            <div class="bg-blue-50 p-3 rounded-xl border border-blue-200">
                <p class="text-[10px] font-bold text-brand-blue uppercase mb-2">Reta Azul (a)</p>
                <div class="mb-2">
                    <label class="text-[8px] text-gray-500 uppercase font-bold">Inclina√ß√£o</label>
                    <input type="range" id="slp-1" min="-3" max="3" step="0.5" value="1" class="w-full h-1 bg-blue-200 rounded appearance-none cursor-pointer">
                </div>
                <div>
                    <label class="text-[8px] text-gray-500 uppercase font-bold">Altura</label>
                    <input type="range" id="off-1" min="-5" max="5" step="1" value="0" class="w-full h-1 bg-blue-200 rounded appearance-none cursor-pointer">
                </div>
            </div>

            <div class="bg-red-50 p-3 rounded-xl border border-red-200">
                <p class="text-[10px] font-bold text-brand-red uppercase mb-2">Reta Vermelha (b)</p>
                <div class="mb-2">
                    <label class="text-[8px] text-gray-500 uppercase font-bold">Inclina√ß√£o</label>
                    <input type="range" id="slp-2" min="-3" max="3" step="0.5" value="-1" class="w-full h-1 bg-red-200 rounded appearance-none cursor-pointer">
                </div>
                <div>
                    <label class="text-[8px] text-gray-500 uppercase font-bold">Altura</label>
                    <input type="range" id="off-2" min="-5" max="5" step="1" value="4" class="w-full h-1 bg-red-200 rounded appearance-none cursor-pointer">
                </div>
            </div>
        </div>

        <p id="class-desc" class="text-xs text-center text-gray-500 mt-4 h-8">
            As retas se cruzam em um ponto.
        </p>

    </div>
    `;

                    const r1 = container.querySelector("#line-r1");
                    const r2 = container.querySelector("#line-r2");
                    const s1 = container.querySelector("#slp-1");
                    const o1 = container.querySelector("#off-1");
                    const s2 = container.querySelector("#slp-2");
                    const o2 = container.querySelector("#off-2");
                    const badge = container.querySelector("#class-badge");
                    const desc = container.querySelector("#class-desc");

                    const drawLine = (line, m, b) => {
                        // Y = mx + b. SVG Y invertido -> -y
                        // Pontos extremos x = -10 e x = 10
                        // y1 = m(-10) + b -> svgY1 = -(m*-10 + b)
                        // y2 = m(10) + b -> svgY2 = -(m*10 + b)

                        const y1 = -(m * -10 + b);
                        const y2 = -(m * 10 + b);

                        line.setAttribute("x1", -10);
                        line.setAttribute("y1", y1);
                        line.setAttribute("x2", 10);
                        line.setAttribute("y2", y2);
                    };

                    const update = () => {
                        slope1 = parseFloat(s1.value);
                        offset1 = parseFloat(o1.value);
                        slope2 = parseFloat(s2.value);
                        offset2 = parseFloat(o2.value);

                        drawLine(r1, slope1, offset1);
                        drawLine(r2, slope2, offset2);

                        // Classifica√ß√£o
                        if (slope1 === slope2) {
                            if (offset1 === offset2) {
                                badge.innerText = "SPI"; // Poss√≠vel Indeterminado
                                badge.className =
                                    "bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-xs font-black uppercase";
                                desc.innerText =
                                    "Coincidentes: Uma em cima da outra. Infinitas solu√ß√µes.";
                                r2.setAttribute("stroke-dasharray", "1, 0.5"); // Tracejado para ver que tem 2
                            } else {
                                badge.innerText = "SI"; // Imposs√≠vel
                                badge.className =
                                    "bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-black uppercase";
                                desc.innerText =
                                    "Paralelas: Nunca se tocam. Nenhuma solu√ß√£o.";
                                r2.removeAttribute("stroke-dasharray");
                            }
                        } else {
                            badge.innerText = "SPD"; // Poss√≠vel Determinado
                            badge.className =
                                "bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-black uppercase";
                            desc.innerText = "Concorrentes: Cruzam em apenas um ponto.";
                            r2.removeAttribute("stroke-dasharray");
                        }
                    };

                    s1.oninput = update;
                    o1.oninput = update;
                    s2.oninput = update;
                    o2.oninput = update;

                    update();
                },

                interactive_substitution_drag(container) {
                    // Equation:
                    // y = 2x
                    // x + y = 12
                    let solved = false;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Arrastar e Substituir</h3>

        <div class="flex flex-col gap-6 w-full max-w-sm items-center">
            
            <div class="bg-blue-50 border border-blue-200 p-3 rounded-lg flex items-center gap-2 shadow-sm z-20">
                <span class="font-mono text-xl font-bold text-gray-500">y =</span>
                <div id="drag-source" class="bg-brand-blue text-white px-3 py-1 rounded font-bold cursor-grab active:cursor-grabbing shadow hover:scale-105 transition-transform" draggable="true">
                    2x
                </div>
            </div>

            <div class="text-gray-300 text-2xl font-black">‚¨áÔ∏è</div>

            <div class="bg-gray-100 border-2 border-dashed border-gray-300 p-4 rounded-xl flex items-center gap-2 text-2xl font-mono font-bold text-gray-700 transition-colors" id="target-zone-container">
                <span>x +</span>
                <div id="drop-target" class="w-16 h-10 border-2 border-brand-purple border-dashed bg-purple-50 rounded flex items-center justify-center text-brand-purple text-sm transition-all">
                    y
                </div>
                <span>= 12</span>
            </div>

        </div>

        <div id="sub-feedback" class="h-16 mt-6 w-full text-center hidden animate-pop-in">
            <p class="text-sm font-bold text-green-600 mb-2">Sucesso! Agora resolvemos:</p>
            <div class="font-mono text-xl font-black text-gray-800">
                x + <span class="text-brand-blue">2x</span> = 12<br>
                <span class="text-brand-purple">3x = 12</span> ‚ûú x = 4
            </div>
        </div>

    </div>
    `;

                    const source = container.querySelector("#drag-source");
                    const target = container.querySelector("#drop-target");
                    const tContainer = container.querySelector(
                        "#target-zone-container"
                    );
                    const feedback = container.querySelector("#sub-feedback");

                    // Drag Events Desktop
                    source.addEventListener("dragstart", (e) => {
                        e.dataTransfer.setData("text/plain", "2x");
                        setTimeout(() => source.classList.add("opacity-50"), 0);
                    });

                    source.addEventListener("dragend", () => {
                        source.classList.remove("opacity-50");
                    });

                    target.addEventListener("dragover", (e) => {
                        e.preventDefault();
                        target.classList.add("bg-purple-200", "scale-110");
                    });

                    target.addEventListener("dragleave", () => {
                        target.classList.remove("bg-purple-200", "scale-110");
                    });

                    target.addEventListener("drop", (e) => {
                        e.preventDefault();
                        completeSubstitution();
                    });

                    // Simple Click Fallback (Mobile)
                    source.onclick = () => {
                        if (!solved) completeSubstitution();
                    };

                    const completeSubstitution = () => {
                        if (solved) return;
                        solved = true;

                        // Animation
                        target.classList.remove(
                            "bg-purple-50",
                            "border-dashed",
                            "text-sm"
                        );
                        target.classList.add(
                            "bg-brand-blue",
                            "text-white",
                            "border-solid",
                            "border-blue-600",
                            "w-auto",
                            "px-2"
                        );
                        target.innerHTML = "2x";

                        tContainer.classList.replace("bg-gray-100", "bg-green-50");
                        tContainer.classList.replace(
                            "border-gray-300",
                            "border-green-200"
                        );

                        source.style.opacity = "0.3";
                        source.draggable = false;
                        source.style.cursor = "default";

                        feedback.classList.remove("hidden");
                    };
                },

                interactive_elimination_tactics(container) {
                    // Problema:
                    // 2x + y = 10
                    // x + y = 7
                    // Objetivo: Eliminar Y. Precisa multiplicar a de baixo por -1.

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-4">Estrategista da Adi√ß√£o</h3>
        <p class="text-xs text-gray-400 mb-6 text-center">Escolha o multiplicador para cancelar o <strong class="text-brand-orange">Y</strong>.</p>

        <div class="flex gap-4 items-center mb-6">
            <div class="flex flex-col gap-2 font-mono text-xl font-bold text-gray-600 bg-gray-50 p-4 rounded-xl border border-gray-200" id="sys-display">
                <div id="row-1">2x + <span class="text-brand-orange">y</span> = 10</div>
                <div class="flex items-center gap-2 transition-all" id="row-2-container">
                    <span class="text-gray-300 text-sm hidden" id="mult-indicator">(-1) √ó </span>
                    <div id="row-2">x + <span class="text-brand-orange">y</span> = 7</div>
                </div>
            </div>
        </div>

        <div class="flex gap-2 w-full max-w-xs mb-4">
            <button class="strat-btn flex-1 bg-white border-2 border-gray-300 text-gray-600 font-bold py-2 rounded-lg hover:border-brand-purple hover:text-brand-purple active:scale-95 transition-all" data-m="1">x 1</button>
            <button class="strat-btn flex-1 bg-white border-2 border-gray-300 text-gray-600 font-bold py-2 rounded-lg hover:border-brand-purple hover:text-brand-purple active:scale-95 transition-all" data-m="-1">x (-1)</button>
            <button class="strat-btn flex-1 bg-white border-2 border-gray-300 text-gray-600 font-bold py-2 rounded-lg hover:border-brand-purple hover:text-brand-purple active:scale-95 transition-all" data-m="2">x 2</button>
        </div>

        <div id="elim-result" class="w-full bg-gray-800 text-white rounded-xl p-4 text-center hidden animate-pop-in">
            <div class="font-mono text-sm opacity-70 mb-2">Somando as equa√ß√µes:</div>
            <div class="font-mono text-xl font-bold">
                (2x <span class="text-red-400">- x</span>) + (<span class="text-brand-orange">y</span> <span class="text-red-400 line-through decoration-2 decoration-white">- y</span>) = 10 <span class="text-red-400">- 7</span>
            </div>
            <div class="mt-2 text-2xl text-brand-green font-black border-t border-gray-600 pt-2">
                x = 3
            </div>
        </div>

        <div id="elim-error" class="text-sm font-bold text-brand-red hidden animate-shake mt-2">
            Isso n√£o cancela o Y! (y + y = 2y)
        </div>

    </div>
    `;

                    const row2 = container.querySelector("#row-2");
                    const indicator = container.querySelector("#mult-indicator");
                    const resBox = container.querySelector("#elim-result");
                    const errBox = container.querySelector("#elim-error");
                    const btns = container.querySelectorAll(".strat-btn");

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            const m = parseInt(btn.dataset.m);

                            // Reset visual
                            resBox.classList.add("hidden");
                            errBox.classList.add("hidden");

                            if (m === -1) {
                                // Correto
                                indicator.classList.remove("hidden");
                                indicator.innerText = "(-1) √ó ";
                                row2.innerHTML = `<span class="text-red-500">-x - <span class="text-brand-orange">y</span> = -7</span>`;

                                setTimeout(() => {
                                    resBox.classList.remove("hidden");
                                }, 500);

                                // Desabilita bot√µes
                                btns.forEach((b) =>
                                    b.classList.add("opacity-50", "pointer-events-none")
                                );
                                btn.classList.remove("opacity-50");
                                btn.classList.add(
                                    "bg-brand-purple",
                                    "text-white",
                                    "border-brand-purple"
                                );
                            } else {
                                // Errado
                                row2.innerHTML = `x + <span class="text-brand-orange">y</span> = 7`; // Reset texto
                                if (m === 2) {
                                    indicator.classList.remove("hidden");
                                    indicator.innerText = "(2) √ó ";
                                    row2.innerHTML = `2x + 2y = 14`;
                                } else {
                                    indicator.classList.add("hidden");
                                }

                                errBox.classList.remove("hidden");
                            }
                        };
                    });
                },

                interactive_logic_detective(container) {
                    const questions = [
                        {
                            text: "Em um estacionamento h√° <strong>Carros (C)</strong> e <strong>Motos (M)</strong>. Total de 10 ve√≠culos e 32 rodas. Quantos de cada?",
                            eq1: "C + M = 10",
                            eq2: "4C + 2M = 32",
                            ans: { C: 6, M: 4 },
                            hint: "Carros t√™m 4 rodas, Motos t√™m 2.",
                        },
                        {
                            text: "Comprei 3 Canetas e 2 L√°pis por R$ 12. Se comprar 1 Caneta e 1 L√°pis, d√° R$ 5. Qual o pre√ßo?",
                            eq1: "3C + 2L = 12",
                            eq2: "C + L = 5",
                            ans: { C: 2, L: 3 },
                            hint: "Pre√ßo: Caneta (C), L√°pis (L).",
                        },
                    ];

                    let currentQ = 0;

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-300 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex items-center gap-2 mb-4 w-full">
            <span class="text-3xl">üïµÔ∏è‚Äç‚ôÄÔ∏è</span>
            <h3 class="text-gray-600 font-black uppercase text-xs tracking-widest">Enigma L√≥gico</h3>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-brand-blue mb-4 w-full">
            <p class="text-sm text-gray-700" id="logic-text">...</p>
        </div>

        <div class="flex gap-4 w-full max-w-sm mb-4 bg-gray-200 p-2 rounded-lg justify-center text-xs font-mono text-gray-600">
            <div id="eq-disp-1">...</div>
            <div class="w-px bg-gray-400"></div>
            <div id="eq-disp-2">...</div>
        </div>

        <p class="text-xs font-bold text-gray-400 uppercase mb-2">Seu Palpite:</p>
        
        <div class="flex gap-4 w-full max-w-sm mb-4">
            <div class="flex flex-col items-center flex-1">
                <label class="text-[10px] font-bold text-brand-blue uppercase mb-1" id="lbl-1">Carros</label>
                <input type="number" id="inp-1" class="w-full h-12 text-center border-2 border-gray-300 rounded-lg font-black text-xl outline-none focus:border-brand-blue">
            </div>
            <div class="flex flex-col items-center flex-1">
                <label class="text-[10px] font-bold text-brand-orange uppercase mb-1" id="lbl-2">Motos</label>
                <input type="number" id="inp-2" class="w-full h-12 text-center border-2 border-gray-300 rounded-lg font-black text-xl outline-none focus:border-brand-orange">
            </div>
        </div>

        <button id="btn-solve" class="w-full bg-brand-green text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all">VERIFICAR</button>
        
        <div id="logic-feedback" class="mt-4 text-center font-bold text-sm h-12 flex items-center justify-center px-2 w-full"></div>

    </div>
    `;

                    const txt = container.querySelector("#logic-text");
                    const eq1 = container.querySelector("#eq-disp-1");
                    const eq2 = container.querySelector("#eq-disp-2");
                    const lbl1 = container.querySelector("#lbl-1");
                    const lbl2 = container.querySelector("#lbl-2");
                    const i1 = container.querySelector("#inp-1");
                    const i2 = container.querySelector("#inp-2");
                    const btn = container.querySelector("#btn-solve");
                    const fb = container.querySelector("#logic-feedback");

                    const loadLevel = () => {
                        if (currentQ >= questions.length) {
                            container.innerHTML = `<div class="text-center py-10"><div class="text-6xl mb-4">üèÜ</div><h3 class="text-xl font-black text-brand-blue">Caso Encerrado!</h3></div>`;
                            return;
                        }

                        const q = questions[currentQ];
                        txt.innerHTML = q.text;
                        eq1.innerText = q.eq1;
                        eq2.innerText = q.eq2;

                        const keys = Object.keys(q.ans);
                        lbl1.innerText =
                            keys[0] === "C"
                                ? currentQ === 0
                                    ? "Carros"
                                    : "Canetas"
                                : keys[0];
                        lbl2.innerText = keys[1] === "M" ? "Motos" : "L√°pis";

                        i1.value = "";
                        i2.value = "";
                        fb.innerHTML = "";
                        btn.disabled = false;
                        btn.classList.remove("opacity-50");
                        btn.innerText = "VERIFICAR";
                    };

                    btn.onclick = () => {
                        const q = questions[currentQ];
                        const keys = Object.keys(q.ans);
                        const v1 = parseInt(i1.value);
                        const v2 = parseInt(i2.value);

                        if (isNaN(v1) || isNaN(v2)) {
                            fb.innerHTML =
                                "<span class='text-brand-orange'>Preencha os dois valores!</span>";
                            return;
                        }

                        if (v1 === q.ans[keys[0]] && v2 === q.ans[keys[1]]) {
                            fb.innerHTML =
                                "<span class='text-brand-green bg-green-50 px-2 py-1 rounded border border-green-200'>Correto! Mist√©rio resolvido.</span>";
                            btn.innerText = "Pr√≥ximo Caso";
                            btn.onclick = () => {
                                currentQ++;
                                btn.onclick = null; // Remove handler tempor√°rio
                                // Restaura handler original
                                btn.addEventListener("click", () => { }); // Hack r√°pido, ideal √© separar fun√ß√£o
                                loadLevel();
                                // Re-bind click
                                btn.onclick = check;
                            };
                        } else {
                            fb.innerHTML =
                                "<span class='text-brand-red'>Incorreto. Tente resolver o sistema!</span>";
                            container.classList.add("animate-shake");
                            setTimeout(
                                () => container.classList.remove("animate-shake"),
                                500
                            );
                        }
                    };

                    // Separa fun√ß√£o check para re-bind
                    const check = btn.onclick;

                    loadLevel();
                },

                interactive_linear_plotter(container) {
                    // Configura√ß√£o
                    const targetSum = 5; // x + y = 5
                    let pointsFound = [];
                    const maxPoints = 3;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Descubra a Reta: x + y = 5</h3>
        
        <div class="relative w-[280px] h-[280px] bg-white border-2 border-gray-300 rounded-xl mb-6 shadow-inner cursor-crosshair" id="plot-area">
            <div class="absolute inset-0" style="background-image: linear-gradient(#e5e7eb 1px, transparent 1px), linear-gradient(90deg, #e5e7eb 1px, transparent 1px); background-size: 28px 28px;"></div>
            
            <div class="absolute bottom-0 left-0 w-1 h-full bg-black"></div>
            <div class="absolute bottom-0 left-0 w-full h-1 bg-black"></div>
            
            <svg class="absolute inset-0 w-full h-full pointer-events-none overflow-visible">
                <line id="solution-line" x1="0" y1="280" x2="280" y2="0" stroke="#1CB0F6" stroke-width="4" stroke-linecap="round" class="opacity-0 transition-opacity duration-1000" />
            </svg>
            
            <div id="points-layer" class="absolute inset-0 w-full h-full"></div>
        </div>

        <div class="flex gap-4 w-full max-w-xs items-center mb-2">
            <div class="flex flex-col items-center flex-1">
                <label class="text-[10px] font-bold text-gray-400 uppercase">Valor X</label>
                <input type="number" id="inp-x" min="0" max="10" class="w-full border-2 border-gray-200 rounded-lg p-2 text-center font-bold text-xl outline-none focus:border-brand-blue">
            </div>
            <span class="text-2xl font-black text-gray-300">+</span>
            <div class="flex flex-col items-center flex-1">
                <label class="text-[10px] font-bold text-gray-400 uppercase">Valor Y</label>
                <input type="number" id="inp-y" min="0" max="10" class="w-full border-2 border-gray-200 rounded-lg p-2 text-center font-bold text-xl outline-none focus:border-brand-blue">
            </div>
        </div>

        <button id="btn-plot" class="w-full max-w-xs bg-brand-green text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all mb-4">
            Testar Ponto
        </button>

        <div id="plot-feedback" class="h-8 text-sm font-bold text-center"></div>

    </div>
    `;

                    const inpX = container.querySelector("#inp-x");
                    const inpY = container.querySelector("#inp-y");
                    const btnPlot = container.querySelector("#btn-plot");
                    const layer = container.querySelector("#points-layer");
                    const line = container.querySelector("#solution-line");
                    const feedback = container.querySelector("#plot-feedback");

                    // Escala: 280px / 10 unidades = 28px por unidade
                    const scale = 28;

                    const plotPoint = () => {
                        const x = parseInt(inpX.value);
                        const y = parseInt(inpY.value);

                        if (isNaN(x) || isNaN(y)) {
                            feedback.innerHTML =
                                "<span class='text-brand-orange'>Digite n√∫meros v√°lidos!</span>";
                            return;
                        }

                        // Verifica Equa√ß√£o
                        const isSolution = x + y === targetSum;

                        // Cria ponto visual
                        const pt = document.createElement("div");
                        // Coordenadas: bottom-left √© 0,0.
                        // left = x * scale. bottom = y * scale.
                        // Precisamos ajustar o tamanho do ponto (w-4 h-4 = 16px) para centralizar
                        pt.className = `absolute w-4 h-4 rounded-full border-2 border-white shadow-sm transform -translate-x-1/2 translate-y-1/2 transition-all duration-300 ${isSolution ? "bg-brand-green" : "bg-brand-red"
                            }`;
                        pt.style.left = `${x * scale}px`;
                        pt.style.bottom = `${y * scale}px`; // bottom funciona bem aqui pois os eixos estao em bottom-left

                        layer.appendChild(pt);

                        if (isSolution) {
                            // Verifica duplicatas
                            const exists = pointsFound.some((p) => p.x === x && p.y === y);
                            if (!exists) {
                                pointsFound.push({ x, y });
                                feedback.innerHTML = `<span class='text-brand-green'>Acertou! (${x}, ${y}) √© solu√ß√£o.</span>`;

                                if (pointsFound.length >= maxPoints) {
                                    line.classList.remove("opacity-0");
                                    feedback.innerHTML = `<span class='text-brand-blue font-black animate-pulse'>A RETA APARECEU!</span>`;
                                    btnPlot.disabled = true;
                                    btnPlot.classList.add("opacity-50");

                                    // Desenha linha correta no SVG baseada na equa√ß√£o x+y=5
                                    // (0,5) -> (5,0)
                                    // SVG coords: (0, 280 - 5*28) -> (5*28, 280 - 0)
                                    // (0, 140) -> (140, 280)
                                    line.setAttribute("x1", 0);
                                    line.setAttribute("y1", 280 - 5 * 28);
                                    line.setAttribute("x2", 5 * 28);
                                    line.setAttribute("y2", 280);
                                }
                            } else {
                                feedback.innerHTML =
                                    "<span class='text-brand-orange'>Voc√™ j√° achou esse ponto!</span>";
                            }
                        } else {
                            feedback.innerHTML = `<span class='text-brand-red'>Errou! ${x} + ${y} ‚â† 5. Ponto fora da reta.</span>`;
                        }
                    };

                    btnPlot.onclick = plotPoint;
                },

                interactive_system_intersection(container) {
                    // Sistema: x+y=6 (Vermelho), x-y=2 (Azul) -> Solu√ß√£o (4,2)

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Onde est√° a solu√ß√£o?</h3>

        <div class="flex gap-4 text-sm font-mono font-bold mb-4">
            <span class="text-brand-red">x + y = 6</span>
            <span class="text-brand-blue">x - y = 2</span>
        </div>
        
        <div class="relative w-[300px] h-[300px] bg-gray-50 border-2 border-gray-300 rounded-xl mb-4 cursor-pointer overflow-hidden shadow-inner group" id="system-graph">
            <div class="absolute inset-0 pointer-events-none" style="background-image: linear-gradient(#ccc 1px, transparent 1px), linear-gradient(90deg, #ccc 1px, transparent 1px); background-size: 30px 30px;"></div>
            
            <div class="absolute bottom-0 left-0 w-1 h-full bg-black z-0"></div>
            <div class="absolute bottom-0 left-0 w-full h-1 bg-black z-0"></div>

            <svg class="absolute inset-0 w-full h-full pointer-events-none z-10 overflow-visible">
                <line x1="0" y1="120" x2="180" y2="300" stroke="#FF4B4B" stroke-width="4" stroke-linecap="round" />
                <line x1="60" y1="300" x2="210" y2="150" stroke="#1CB0F6" stroke-width="4" stroke-linecap="round" />
            </svg>

            <div id="target-zone" class="absolute w-12 h-12 rounded-full z-20" style="left: 105px; top: 165px;"></div>
            
            <div id="marker" class="absolute w-4 h-4 bg-brand-green rounded-full border-2 border-white shadow-lg hidden pointer-events-none z-30 transition-all"></div>
        </div>

        <p class="text-xs text-center text-gray-500 mb-2">Clique no ponto onde as regras se encontram.</p>
        <div id="sys-feedback" class="h-8 font-bold text-sm text-center"></div>

    </div>
    `;

                    const graph = container.querySelector("#system-graph");
                    const target = container.querySelector("#target-zone");
                    const marker = container.querySelector("#marker");
                    const feedback = container.querySelector("#sys-feedback");

                    graph.onclick = (e) => {
                        const rect = graph.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;

                        // Pega bounding do target
                        const tRect = target.getBoundingClientRect();
                        const tX = tRect.left - rect.left + tRect.width / 2;
                        const tY = tRect.top - rect.top + tRect.height / 2;

                        const dist = Math.sqrt(Math.pow(x - tX, 2) + Math.pow(y - tY, 2));

                        marker.style.left = `${x - 8}px`; // -8 para centralizar (w-4=16px)
                        marker.style.top = `${y - 8}px`;
                        marker.classList.remove("hidden");

                        if (dist < 25) {
                            // Toler√¢ncia de clique
                            // Snap to center
                            marker.style.left = `${tX - 8}px`;
                            marker.style.top = `${tY - 8}px`;
                            marker.classList.add("scale-150", "bg-brand-green");
                            marker.classList.remove("bg-brand-red");
                            feedback.innerHTML =
                                "<span class='text-brand-green'>Exato! Solu√ß√£o (4, 2).</span>";
                        } else {
                            marker.classList.add("bg-brand-red");
                            marker.classList.remove("bg-brand-green", "scale-150");
                            feedback.innerHTML =
                                "<span class='text-brand-red'>Aqui n√£o! Precisa ser na intersec√ß√£o.</span>";
                        }
                    };
                },

                interactive_system_classifier(container) {
                    let slope1 = 1;
                    let offset1 = 0;
                    let slope2 = -1;
                    let offset2 = 4;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-4">
            <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest">Classificador de Sistemas</h3>
            <div id="class-badge" class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-black uppercase">SPD</div>
        </div>

        <div class="relative w-64 h-64 bg-gray-50 border border-gray-300 rounded-xl mb-6 overflow-hidden">
            <svg id="class-svg" width="100%" height="100%" viewBox="-10 -10 20 20" preserveAspectRatio="xMidYMid slice">
                <line x1="-10" y1="0" x2="10" y2="0" stroke="#ddd" stroke-width="0.1" />
                <line x1="0" y1="-10" x2="0" y2="10" stroke="#ddd" stroke-width="0.1" />
                
                <line id="line-r1" x1="-10" y1="-10" x2="10" y2="10" stroke="#1CB0F6" stroke-width="0.5" />
                <line id="line-r2" x1="-10" y1="10" x2="10" y2="-10" stroke="#FF4B4B" stroke-width="0.5" />
            </svg>
        </div>

        <div class="grid grid-cols-2 gap-6 w-full max-w-sm">
            <div class="bg-blue-50 p-3 rounded-xl border border-blue-200">
                <p class="text-[10px] font-bold text-brand-blue uppercase mb-2">Reta Azul (a)</p>
                <div class="mb-2">
                    <label class="text-[8px] text-gray-500 uppercase font-bold">Inclina√ß√£o</label>
                    <input type="range" id="slp-1" min="-3" max="3" step="0.5" value="1" class="w-full h-1 bg-blue-200 rounded appearance-none cursor-pointer">
                </div>
                <div>
                    <label class="text-[8px] text-gray-500 uppercase font-bold">Altura</label>
                    <input type="range" id="off-1" min="-5" max="5" step="1" value="0" class="w-full h-1 bg-blue-200 rounded appearance-none cursor-pointer">
                </div>
            </div>

            <div class="bg-red-50 p-3 rounded-xl border border-red-200">
                <p class="text-[10px] font-bold text-brand-red uppercase mb-2">Reta Vermelha (b)</p>
                <div class="mb-2">
                    <label class="text-[8px] text-gray-500 uppercase font-bold">Inclina√ß√£o</label>
                    <input type="range" id="slp-2" min="-3" max="3" step="0.5" value="-1" class="w-full h-1 bg-red-200 rounded appearance-none cursor-pointer">
                </div>
                <div>
                    <label class="text-[8px] text-gray-500 uppercase font-bold">Altura</label>
                    <input type="range" id="off-2" min="-5" max="5" step="1" value="4" class="w-full h-1 bg-red-200 rounded appearance-none cursor-pointer">
                </div>
            </div>
        </div>

        <p id="class-desc" class="text-xs text-center text-gray-500 mt-4 h-8">
            As retas se cruzam em um ponto.
        </p>

    </div>
    `;

                    const r1 = container.querySelector("#line-r1");
                    const r2 = container.querySelector("#line-r2");
                    const s1 = container.querySelector("#slp-1");
                    const o1 = container.querySelector("#off-1");
                    const s2 = container.querySelector("#slp-2");
                    const o2 = container.querySelector("#off-2");
                    const badge = container.querySelector("#class-badge");
                    const desc = container.querySelector("#class-desc");

                    const drawLine = (line, m, b) => {
                        // Y = mx + b. SVG Y invertido -> -y
                        // Pontos extremos x = -10 e x = 10
                        // y1 = m(-10) + b -> svgY1 = -(m*-10 + b)
                        // y2 = m(10) + b -> svgY2 = -(m*10 + b)

                        const y1 = -(m * -10 + b);
                        const y2 = -(m * 10 + b);

                        line.setAttribute("x1", -10);
                        line.setAttribute("y1", y1);
                        line.setAttribute("x2", 10);
                        line.setAttribute("y2", y2);
                    };

                    const update = () => {
                        slope1 = parseFloat(s1.value);
                        offset1 = parseFloat(o1.value);
                        slope2 = parseFloat(s2.value);
                        offset2 = parseFloat(o2.value);

                        drawLine(r1, slope1, offset1);
                        drawLine(r2, slope2, offset2);

                        // Classifica√ß√£o
                        if (slope1 === slope2) {
                            if (offset1 === offset2) {
                                badge.innerText = "SPI"; // Poss√≠vel Indeterminado
                                badge.className =
                                    "bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-xs font-black uppercase";
                                desc.innerText =
                                    "Coincidentes: Uma em cima da outra. Infinitas solu√ß√µes.";
                                r2.setAttribute("stroke-dasharray", "1, 0.5"); // Tracejado para ver que tem 2
                            } else {
                                badge.innerText = "SI"; // Imposs√≠vel
                                badge.className =
                                    "bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-black uppercase";
                                desc.innerText =
                                    "Paralelas: Nunca se tocam. Nenhuma solu√ß√£o.";
                                r2.removeAttribute("stroke-dasharray");
                            }
                        } else {
                            badge.innerText = "SPD"; // Poss√≠vel Determinado
                            badge.className =
                                "bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-black uppercase";
                            desc.innerText = "Concorrentes: Cruzam em apenas um ponto.";
                            r2.removeAttribute("stroke-dasharray");
                        }
                    };

                    s1.oninput = update;
                    o1.oninput = update;
                    s2.oninput = update;
                    o2.oninput = update;

                    update();
                },

                interactive_substitution_drag(container) {
                    // Equation:
                    // y = 2x
                    // x + y = 12
                    let solved = false;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Arrastar e Substituir</h3>

        <div class="flex flex-col gap-6 w-full max-w-sm items-center">
            
            <div class="bg-blue-50 border border-blue-200 p-3 rounded-lg flex items-center gap-2 shadow-sm z-20">
                <span class="font-mono text-xl font-bold text-gray-500">y =</span>
                <div id="drag-source" class="bg-brand-blue text-white px-3 py-1 rounded font-bold cursor-grab active:cursor-grabbing shadow hover:scale-105 transition-transform" draggable="true">
                    2x
                </div>
            </div>

            <div class="text-gray-300 text-2xl font-black">‚¨áÔ∏è</div>

            <div class="bg-gray-100 border-2 border-dashed border-gray-300 p-4 rounded-xl flex items-center gap-2 text-2xl font-mono font-bold text-gray-700 transition-colors" id="target-zone-container">
                <span>x +</span>
                <div id="drop-target" class="w-16 h-10 border-2 border-brand-purple border-dashed bg-purple-50 rounded flex items-center justify-center text-brand-purple text-sm transition-all">
                    y
                </div>
                <span>= 12</span>
            </div>

        </div>

        <div id="sub-feedback" class="h-16 mt-6 w-full text-center hidden animate-pop-in">
            <p class="text-sm font-bold text-green-600 mb-2">Sucesso! Agora resolvemos:</p>
            <div class="font-mono text-xl font-black text-gray-800">
                x + <span class="text-brand-blue">2x</span> = 12<br>
                <span class="text-brand-purple">3x = 12</span> ‚ûú x = 4
            </div>
        </div>

    </div>
    `;

                    const source = container.querySelector("#drag-source");
                    const target = container.querySelector("#drop-target");
                    const tContainer = container.querySelector(
                        "#target-zone-container"
                    );
                    const feedback = container.querySelector("#sub-feedback");

                    // Drag Events Desktop
                    source.addEventListener("dragstart", (e) => {
                        e.dataTransfer.setData("text/plain", "2x");
                        setTimeout(() => source.classList.add("opacity-50"), 0);
                    });

                    source.addEventListener("dragend", () => {
                        source.classList.remove("opacity-50");
                    });

                    target.addEventListener("dragover", (e) => {
                        e.preventDefault();
                        target.classList.add("bg-purple-200", "scale-110");
                    });

                    target.addEventListener("dragleave", () => {
                        target.classList.remove("bg-purple-200", "scale-110");
                    });

                    target.addEventListener("drop", (e) => {
                        e.preventDefault();
                        completeSubstitution();
                    });

                    // Simple Click Fallback (Mobile)
                    source.onclick = () => {
                        if (!solved) completeSubstitution();
                    };

                    const completeSubstitution = () => {
                        if (solved) return;
                        solved = true;

                        // Animation
                        target.classList.remove(
                            "bg-purple-50",
                            "border-dashed",
                            "text-sm"
                        );
                        target.classList.add(
                            "bg-brand-blue",
                            "text-white",
                            "border-solid",
                            "border-blue-600",
                            "w-auto",
                            "px-2"
                        );
                        target.innerHTML = "2x";

                        tContainer.classList.replace("bg-gray-100", "bg-green-50");
                        tContainer.classList.replace(
                            "border-gray-300",
                            "border-green-200"
                        );

                        source.style.opacity = "0.3";
                        source.draggable = false;
                        source.style.cursor = "default";

                        feedback.classList.remove("hidden");
                    };
                },

                interactive_elimination_tactics(container) {
                    // Problema:
                    // 2x + y = 10
                    // x + y = 7
                    // Objetivo: Eliminar Y. Precisa multiplicar a de baixo por -1.

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-4">Estrategista da Adi√ß√£o</h3>
        <p class="text-xs text-gray-400 mb-6 text-center">Escolha o multiplicador para cancelar o <strong class="text-brand-orange">Y</strong>.</p>

        <div class="flex gap-4 items-center mb-6">
            <div class="flex flex-col gap-2 font-mono text-xl font-bold text-gray-600 bg-gray-50 p-4 rounded-xl border border-gray-200" id="sys-display">
                <div id="row-1">2x + <span class="text-brand-orange">y</span> = 10</div>
                <div class="flex items-center gap-2 transition-all" id="row-2-container">
                    <span class="text-gray-300 text-sm hidden" id="mult-indicator">(-1) √ó </span>
                    <div id="row-2">x + <span class="text-brand-orange">y</span> = 7</div>
                </div>
            </div>
        </div>

        <div class="flex gap-2 w-full max-w-xs mb-4">
            <button class="strat-btn flex-1 bg-white border-2 border-gray-300 text-gray-600 font-bold py-2 rounded-lg hover:border-brand-purple hover:text-brand-purple active:scale-95 transition-all" data-m="1">x 1</button>
            <button class="strat-btn flex-1 bg-white border-2 border-gray-300 text-gray-600 font-bold py-2 rounded-lg hover:border-brand-purple hover:text-brand-purple active:scale-95 transition-all" data-m="-1">x (-1)</button>
            <button class="strat-btn flex-1 bg-white border-2 border-gray-300 text-gray-600 font-bold py-2 rounded-lg hover:border-brand-purple hover:text-brand-purple active:scale-95 transition-all" data-m="2">x 2</button>
        </div>

        <div id="elim-result" class="w-full bg-gray-800 text-white rounded-xl p-4 text-center hidden animate-pop-in">
            <div class="font-mono text-sm opacity-70 mb-2">Somando as equa√ß√µes:</div>
            <div class="font-mono text-xl font-bold">
                (2x <span class="text-red-400">- x</span>) + (<span class="text-brand-orange">y</span> <span class="text-red-400 line-through decoration-2 decoration-white">- y</span>) = 10 <span class="text-red-400">- 7</span>
            </div>
            <div class="mt-2 text-2xl text-brand-green font-black border-t border-gray-600 pt-2">
                x = 3
            </div>
        </div>

        <div id="elim-error" class="text-sm font-bold text-brand-red hidden animate-shake mt-2">
            Isso n√£o cancela o Y! (y + y = 2y)
        </div>

    </div>
    `;

                    const row2 = container.querySelector("#row-2");
                    const indicator = container.querySelector("#mult-indicator");
                    const resBox = container.querySelector("#elim-result");
                    const errBox = container.querySelector("#elim-error");
                    const btns = container.querySelectorAll(".strat-btn");

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            const m = parseInt(btn.dataset.m);

                            // Reset visual
                            resBox.classList.add("hidden");
                            errBox.classList.add("hidden");

                            if (m === -1) {
                                // Correto
                                indicator.classList.remove("hidden");
                                indicator.innerText = "(-1) √ó ";
                                row2.innerHTML = `<span class="text-red-500">-x - <span class="text-brand-orange">y</span> = -7</span>`;

                                setTimeout(() => {
                                    resBox.classList.remove("hidden");
                                }, 500);

                                // Desabilita bot√µes
                                btns.forEach((b) =>
                                    b.classList.add("opacity-50", "pointer-events-none")
                                );
                                btn.classList.remove("opacity-50");
                                btn.classList.add(
                                    "bg-brand-purple",
                                    "text-white",
                                    "border-brand-purple"
                                );
                            } else {
                                // Errado
                                row2.innerHTML = `x + <span class="text-brand-orange">y</span> = 7`; // Reset texto
                                if (m === 2) {
                                    indicator.classList.remove("hidden");
                                    indicator.innerText = "(2) √ó ";
                                    row2.innerHTML = `2x + 2y = 14`;
                                } else {
                                    indicator.classList.add("hidden");
                                }

                                errBox.classList.remove("hidden");
                            }
                        };
                    });
                },

                interactive_logic_detective(container) {
                    const questions = [
                        {
                            text: "Em um estacionamento h√° <strong>Carros (C)</strong> e <strong>Motos (M)</strong>. Total de 10 ve√≠culos e 32 rodas. Quantos de cada?",
                            eq1: "C + M = 10",
                            eq2: "4C + 2M = 32",
                            ans: { C: 6, M: 4 },
                            hint: "Carros t√™m 4 rodas, Motos t√™m 2.",
                        },
                        {
                            text: "Comprei 3 Canetas e 2 L√°pis por R$ 12. Se comprar 1 Caneta e 1 L√°pis, d√° R$ 5. Qual o pre√ßo?",
                            eq1: "3C + 2L = 12",
                            eq2: "C + L = 5",
                            ans: { C: 2, L: 3 },
                            hint: "Pre√ßo: Caneta (C), L√°pis (L).",
                        },
                    ];

                    let currentQ = 0;

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-300 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex items-center gap-2 mb-4 w-full">
            <span class="text-3xl">üïµÔ∏è‚Äç‚ôÄÔ∏è</span>
            <h3 class="text-gray-600 font-black uppercase text-xs tracking-widest">Enigma L√≥gico</h3>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-brand-blue mb-4 w-full">
            <p class="text-sm text-gray-700" id="logic-text">...</p>
        </div>

        <div class="flex gap-4 w-full max-w-sm mb-4 bg-gray-200 p-2 rounded-lg justify-center text-xs font-mono text-gray-600">
            <div id="eq-disp-1">...</div>
            <div class="w-px bg-gray-400"></div>
            <div id="eq-disp-2">...</div>
        </div>

        <p class="text-xs font-bold text-gray-400 uppercase mb-2">Seu Palpite:</p>
        
        <div class="flex gap-4 w-full max-w-sm mb-4">
            <div class="flex flex-col items-center flex-1">
                <label class="text-[10px] font-bold text-brand-blue uppercase mb-1" id="lbl-1">Carros</label>
                <input type="number" id="inp-1" class="w-full h-12 text-center border-2 border-gray-300 rounded-lg font-black text-xl outline-none focus:border-brand-blue">
            </div>
            <div class="flex flex-col items-center flex-1">
                <label class="text-[10px] font-bold text-brand-orange uppercase mb-1" id="lbl-2">Motos</label>
                <input type="number" id="inp-2" class="w-full h-12 text-center border-2 border-gray-300 rounded-lg font-black text-xl outline-none focus:border-brand-orange">
            </div>
        </div>

        <button id="btn-solve" class="w-full bg-brand-green text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all">VERIFICAR</button>
        
        <div id="logic-feedback" class="mt-4 text-center font-bold text-sm h-12 flex items-center justify-center px-2 w-full"></div>

    </div>
    `;

                    const txt = container.querySelector("#logic-text");
                    const eq1 = container.querySelector("#eq-disp-1");
                    const eq2 = container.querySelector("#eq-disp-2");
                    const lbl1 = container.querySelector("#lbl-1");
                    const lbl2 = container.querySelector("#lbl-2");
                    const i1 = container.querySelector("#inp-1");
                    const i2 = container.querySelector("#inp-2");
                    const btn = container.querySelector("#btn-solve");
                    const fb = container.querySelector("#logic-feedback");

                    const loadLevel = () => {
                        if (currentQ >= questions.length) {
                            container.innerHTML = `<div class="text-center py-10"><div class="text-6xl mb-4">üèÜ</div><h3 class="text-xl font-black text-brand-blue">Caso Encerrado!</h3></div>`;
                            return;
                        }

                        const q = questions[currentQ];
                        txt.innerHTML = q.text;
                        eq1.innerText = q.eq1;
                        eq2.innerText = q.eq2;

                        const keys = Object.keys(q.ans);
                        lbl1.innerText =
                            keys[0] === "C"
                                ? currentQ === 0
                                    ? "Carros"
                                    : "Canetas"
                                : keys[0];
                        lbl2.innerText = keys[1] === "M" ? "Motos" : "L√°pis";

                        i1.value = "";
                        i2.value = "";
                        fb.innerHTML = "";
                        btn.disabled = false;
                        btn.classList.remove("opacity-50");
                        btn.innerText = "VERIFICAR";
                    };

                    btn.onclick = () => {
                        const q = questions[currentQ];
                        const keys = Object.keys(q.ans);
                        const v1 = parseInt(i1.value);
                        const v2 = parseInt(i2.value);

                        if (isNaN(v1) || isNaN(v2)) {
                            fb.innerHTML =
                                "<span class='text-brand-orange'>Preencha os dois valores!</span>";
                            return;
                        }

                        if (v1 === q.ans[keys[0]] && v2 === q.ans[keys[1]]) {
                            fb.innerHTML =
                                "<span class='text-brand-green bg-green-50 px-2 py-1 rounded border border-green-200'>Correto! Mist√©rio resolvido.</span>";
                            btn.innerText = "Pr√≥ximo Caso";
                            btn.onclick = () => {
                                currentQ++;
                                btn.onclick = null; // Remove handler tempor√°rio
                                // Restaura handler original
                                btn.addEventListener("click", () => { }); // Hack r√°pido, ideal √© separar fun√ß√£o
                                loadLevel();
                                // Re-bind click
                                btn.onclick = check;
                            };
                        } else {
                            fb.innerHTML =
                                "<span class='text-brand-red'>Incorreto. Tente resolver o sistema!</span>";
                            container.classList.add("animate-shake");
                            setTimeout(
                                () => container.classList.remove("animate-shake"),
                                500
                            );
                        }
                    };

                    // Separa fun√ß√£o check para re-bind
                    const check = btn.onclick;

                    loadLevel();
                },

                interactive_triangle_balancer(container) {
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <div class="flex justify-between w-full mb-4 items-center">
            <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest">Desafio do Baricentro</h3>
            <span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs font-bold">N√≠vel <span id="level-num">1</span></span>
        </div>

        <div class="relative w-full h-64 bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl overflow-hidden cursor-crosshair touch-none" id="balance-zone">
            <svg width="100%" height="100%" id="balance-svg" class="absolute inset-0 pointer-events-none">
                <polygon id="tri-poly" points="50,200 250,200 150,50" fill="rgba(155, 89, 182, 0.2)" stroke="#9B59B6" stroke-width="3" stroke-linejoin="round" />
                
                <line id="med-1" x1="0" y1="0" x2="0" y2="0" stroke="#9B59B6" stroke-width="1" stroke-dasharray="4" class="opacity-0 transition-opacity" />
                <line id="med-2" x1="0" y1="0" x2="0" y2="0" stroke="#9B59B6" stroke-width="1" stroke-dasharray="4" class="opacity-0 transition-opacity" />
                <line id="med-3" x1="0" y1="0" x2="0" y2="0" stroke="#9B59B6" stroke-width="1" stroke-dasharray="4" class="opacity-0 transition-opacity" />
                
                <circle id="true-center" cx="0" cy="0" r="4" fill="#58CC02" class="opacity-0" />
            </svg>
            
            <div id="finger" class="absolute w-8 h-8 rounded-full bg-brand-orange border-2 border-white shadow-lg transform -translate-x-1/2 -translate-y-1/2 pointer-events-none transition-all duration-75 flex items-center justify-center text-white text-xs z-10">üëÜ</div>
        </div>

        <p class="text-xs text-gray-500 mt-3 text-center" id="balance-hint">Clique onde voc√™ acha que √© o ponto de equil√≠brio!</p>
        
        <button id="btn-next-tri" class="mt-4 bg-brand-blue text-white font-bold py-2 px-6 rounded-lg shadow-btn active:scale-95 hidden">Pr√≥ximo Tri√¢ngulo</button>
    </div>
    `;

                    const svg = container.querySelector("#balance-svg");
                    const zone = container.querySelector("#balance-zone");
                    const poly = container.querySelector("#tri-poly");
                    const finger = container.querySelector("#finger");
                    const trueCenter = container.querySelector("#true-center");
                    const hint = container.querySelector("#balance-hint");
                    const btnNext = container.querySelector("#btn-next-tri");
                    const medians = [1, 2, 3].map((i) =>
                        container.querySelector(`#med-${i}`)
                    );

                    // Estado
                    let points = []; // [{x,y}, {x,y}, {x,y}]
                    let centroid = { x: 0, y: 0 };
                    let isRevealed = false;

                    const generateTriangle = () => {
                        // Gera pontos aleat√≥rios dentro da √°rea (300x250 approx)
                        // Garante que n√£o fiquem colineares ou muito pequenos
                        const w = zone.clientWidth;
                        const h = zone.clientHeight;

                        points = [
                            {
                                x: Math.random() * (w * 0.3),
                                y: h - (Math.random() * 50 + 20),
                            }, // Canto inf esq
                            {
                                x: w - Math.random() * (w * 0.3),
                                y: h - (Math.random() * 50 + 20),
                            }, // Canto inf dir
                            { x: Math.random() * w, y: Math.random() * (h * 0.5) + 20 }, // Topo
                        ];

                        // Atualiza SVG
                        const ptsStr = points.map((p) => `${p.x},${p.y}`).join(" ");
                        poly.setAttribute("points", ptsStr);

                        // Calcula Baricentro (M√©dia das coordenadas)
                        centroid.x = (points[0].x + points[1].x + points[2].x) / 3;
                        centroid.y = (points[0].y + points[1].y + points[2].y) / 3;

                        // Calcula Medianas para revelar depois
                        // M1: P0 -> Mid(P1, P2)
                        medians[0].setAttribute("x1", points[0].x);
                        medians[0].setAttribute("y1", points[0].y);
                        medians[0].setAttribute("x2", (points[1].x + points[2].x) / 2);
                        medians[0].setAttribute("y2", (points[1].y + points[2].y) / 2);

                        // M2: P1 -> Mid(P0, P2)
                        medians[1].setAttribute("x1", points[1].x);
                        medians[1].setAttribute("y1", points[1].y);
                        medians[1].setAttribute("x2", (points[0].x + points[2].x) / 2);
                        medians[1].setAttribute("y2", (points[0].y + points[2].y) / 2);

                        // M3: P2 -> Mid(P0, P1)
                        medians[2].setAttribute("x1", points[2].x);
                        medians[2].setAttribute("y1", points[2].y);
                        medians[2].setAttribute("x2", (points[0].x + points[1].x) / 2);
                        medians[2].setAttribute("y2", (points[0].y + points[1].y) / 2);

                        trueCenter.setAttribute("cx", centroid.x);
                        trueCenter.setAttribute("cy", centroid.y);

                        // Reset visual
                        isRevealed = false;
                        medians.forEach((m) => m.classList.add("opacity-0"));
                        trueCenter.classList.add("opacity-0");
                        btnNext.classList.add("hidden");
                        hint.innerText =
                            "Clique onde voc√™ acha que √© o ponto de equil√≠brio!";
                        hint.className = "text-xs text-gray-500 mt-3 text-center";
                    };

                    zone.onclick = (e) => {
                        if (isRevealed) return;

                        const rect = zone.getBoundingClientRect();
                        const clickX = e.clientX - rect.left;
                        const clickY = e.clientY - rect.top;

                        // Move dedo
                        finger.style.left = clickX + "px";
                        finger.style.top = clickY + "px";

                        // Calcula dist√¢ncia
                        const dist = Math.sqrt(
                            Math.pow(clickX - centroid.x, 2) +
                            Math.pow(clickY - centroid.y, 2)
                        );

                        // Revela
                        isRevealed = true;
                        medians.forEach((m) => m.classList.remove("opacity-0"));
                        trueCenter.classList.remove("opacity-0");

                        if (dist < 20) {
                            hint.innerHTML = `<span class="text-brand-green font-bold">Excelente!</span> Voc√™ achou o centro de gravidade.`;
                            // Anima√ß√£o de equil√≠brio
                            poly.classList.add("animate-pulse");
                        } else {
                            hint.innerHTML = `<span class="text-brand-red font-bold">Quase!</span> O baricentro √© o encontro das medianas (linhas roxas).`;
                        }

                        btnNext.classList.remove("hidden");
                    };

                    btnNext.onclick = generateTriangle;

                    // Aguarda layout
                    setTimeout(generateTriangle, 100);
                },

                interactive_triangle_centers(container) {
                    let mode = "median"; // median, altitude, bisector, perp_bisector

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4 w-full">
            <button class="center-btn text-[10px] font-bold uppercase p-2 rounded border transition-all bg-brand-purple text-white border-purple-600" data-m="median">Baricentro<br>(Mediana)</button>
            <button class="center-btn text-[10px] font-bold uppercase p-2 rounded border transition-all bg-white text-gray-500 border-gray-200 hover:bg-gray-50" data-m="bisector">Incentro<br>(Bissetriz)</button>
            <button class="center-btn text-[10px] font-bold uppercase p-2 rounded border transition-all bg-white text-gray-500 border-gray-200 hover:bg-gray-50" data-m="altitude">Ortocentro<br>(Altura)</button>
            <button class="center-btn text-[10px] font-bold uppercase p-2 rounded border transition-all bg-white text-gray-500 border-gray-200 hover:bg-gray-50" data-m="perp_bisector">Circuncentro<br>(Mediatriz)</button>
        </div>

        <div class="relative w-full h-[300px] bg-gray-50 border border-gray-200 rounded-xl overflow-hidden cursor-move touch-none" id="geo-canvas">
            <svg width="100%" height="100%" id="geo-svg">
                <circle id="aux-circle" cx="-100" cy="-100" r="0" fill="none" stroke="rgba(0,0,0,0.1)" stroke-width="2" />

                <line id="line-1" stroke="gray" stroke-width="1" />
                <line id="line-2" stroke="gray" stroke-width="1" />
                <line id="line-3" stroke="gray" stroke-width="1" />

                <path id="tri-path" fill="rgba(28, 176, 246, 0.1)" stroke="#1CB0F6" stroke-width="3" stroke-linejoin="round" />

                <circle id="center-point" cx="-100" cy="-100" r="5" fill="#FF9600" stroke="white" stroke-width="2" />

                <circle id="v-0" r="8" fill="#1CB0F6" stroke="white" stroke-width="2" class="cursor-pointer" />
                <circle id="v-1" r="8" fill="#1CB0F6" stroke="white" stroke-width="2" class="cursor-pointer" />
                <circle id="v-2" r="8" fill="#1CB0F6" stroke="white" stroke-width="2" class="cursor-pointer" />
            </svg>
            <div class="absolute bottom-2 left-2 text-xs font-mono text-gray-400 pointer-events-none" id="coord-debug"></div>
        </div>

        <p class="text-xs text-gray-500 mt-2 text-center" id="mode-desc">
            Arraste os pontos azuis. O Baricentro √© o centro de equil√≠brio.
        </p>

    </div>
    `;

                    const svg = container.querySelector("#geo-svg");
                    const path = container.querySelector("#tri-path");
                    const centerPoint = container.querySelector("#center-point");
                    const auxCircle = container.querySelector("#aux-circle");
                    const lines = [1, 2, 3].map((i) =>
                        container.querySelector(`#line-${i}`)
                    );
                    const vertices = [0, 1, 2].map((i) =>
                        container.querySelector(`#v-${i}`)
                    );
                    const modeDesc = container.querySelector("#mode-desc");
                    const btns = container.querySelectorAll(".center-btn");

                    // Estado inicial
                    const pts = [
                        { x: 150, y: 50 },
                        { x: 50, y: 250 },
                        { x: 250, y: 250 },
                    ];

                    // Fun√ß√µes Matem√°ticas Auxiliares
                    const dist = (p1, p2) =>
                        Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));

                    // Ponto M√©dio
                    const mid = (p1, p2) => ({
                        x: (p1.x + p2.x) / 2,
                        y: (p1.y + p2.y) / 2,
                    });

                    // Interse√ß√£o de duas retas (dadas por x1,y1,x2,y2 e x3,y3,x4,y4)
                    // Simplificando: Usamos f√≥rmulas anal√≠ticas diretas para os centros

                    const update = () => {
                        // Desenha Tri√¢ngulo
                        path.setAttribute(
                            "d",
                            `M ${pts[0].x} ${pts[0].y} L ${pts[1].x} ${pts[1].y} L ${pts[2].x} ${pts[2].y} Z`
                        );

                        // Atualiza Handles
                        pts.forEach((p, i) => {
                            vertices[i].setAttribute("cx", p.x);
                            vertices[i].setAttribute("cy", p.y);
                        });

                        let center = { x: 0, y: 0 };
                        let lCoords = []; // [[x1,y1,x2,y2], ...]

                        if (mode === "median") {
                            // Baricentro: M√©dia aritm√©tica
                            center.x = (pts[0].x + pts[1].x + pts[2].x) / 3;
                            center.y = (pts[0].y + pts[1].y + pts[2].y) / 3;

                            // Linhas: V√©rtice ao ponto m√©dio oposto
                            lCoords.push([
                                pts[0].x,
                                pts[0].y,
                                (pts[1].x + pts[2].x) / 2,
                                (pts[1].y + pts[2].y) / 2,
                            ]);
                            lCoords.push([
                                pts[1].x,
                                pts[1].y,
                                (pts[0].x + pts[2].x) / 2,
                                (pts[0].y + pts[2].y) / 2,
                            ]);
                            lCoords.push([
                                pts[2].x,
                                pts[2].y,
                                (pts[0].x + pts[1].x) / 2,
                                (pts[0].y + pts[1].y) / 2,
                            ]);

                            auxCircle.setAttribute("r", 0); // Hide
                        } else if (mode === "bisector") {
                            // Incentro: (aA + bB + cC) / (a+b+c) onde a,b,c s√£o comprimentos dos lados OPOSTOS
                            const a = dist(pts[1], pts[2]); // Lado oposto a A (pts[0])
                            const b = dist(pts[0], pts[2]);
                            const c = dist(pts[0], pts[1]);
                            const p = a + b + c;

                            center.x = (a * pts[0].x + b * pts[1].x + c * pts[2].x) / p;
                            center.y = (a * pts[0].y + b * pts[1].y + c * pts[2].y) / p;

                            // Raio do c√≠rculo inscrito (√Årea / Semiper√≠metro)
                            // √Årea via Heron
                            const s = p / 2;
                            const area = Math.sqrt(s * (s - a) * (s - b) * (s - c));
                            const r = area / s;

                            auxCircle.setAttribute("cx", center.x);
                            auxCircle.setAttribute("cy", center.y);
                            auxCircle.setAttribute("r", r);
                            auxCircle.setAttribute("stroke", "#FF9600");

                            // Linhas: V√©rtice ao Incentro (segmento da bissetriz)
                            // Extrapolar visualmente at√© o lado oposto √© complexo sem interse√ß√£o de reta,
                            // vamos desenhar do v√©rtice at√© o centro para simplificar a visualiza√ß√£o
                            lCoords.push([pts[0].x, pts[0].y, center.x, center.y]);
                            lCoords.push([pts[1].x, pts[1].y, center.x, center.y]);
                            lCoords.push([pts[2].x, pts[2].y, center.x, center.y]);
                        } else if (mode === "perp_bisector" || mode === "altitude") {
                            // Matem√°gica para Circuncentro e Ortocentro
                            // D = 2(x1(y2 - y3) + x2(y3 - y1) + x3(y1 - y2))
                            const D =
                                2 *
                                (pts[0].x * (pts[1].y - pts[2].y) +
                                    pts[1].x * (pts[2].y - pts[0].y) +
                                    pts[2].x * (pts[0].y - pts[1].y));

                            if (mode === "perp_bisector") {
                                // Circuncentro formulas
                                const UXx =
                                    (1 / D) *
                                    ((pts[0].x ** 2 + pts[0].y ** 2) * (pts[1].y - pts[2].y) +
                                        (pts[1].x ** 2 + pts[1].y ** 2) * (pts[2].y - pts[0].y) +
                                        (pts[2].x ** 2 + pts[2].y ** 2) * (pts[0].y - pts[1].y));
                                const UYy =
                                    (1 / D) *
                                    ((pts[0].x ** 2 + pts[0].y ** 2) * (pts[2].x - pts[1].x) +
                                        (pts[1].x ** 2 + pts[1].y ** 2) * (pts[0].x - pts[2].x) +
                                        (pts[2].x ** 2 + pts[2].y ** 2) * (pts[1].x - pts[0].x));

                                center.x = UXx;
                                center.y = UYy;

                                // Raio = dist at√© qualquer v√©rtice
                                const R = dist(center, pts[0]);
                                auxCircle.setAttribute("cx", center.x);
                                auxCircle.setAttribute("cy", center.y);
                                auxCircle.setAttribute("r", R);
                                auxCircle.setAttribute("stroke", "#58CC02");

                                // Linhas: Do ponto m√©dio do lado at√© o centro
                                const m0 = mid(pts[1], pts[2]);
                                const m1 = mid(pts[0], pts[2]);
                                const m2 = mid(pts[0], pts[1]);
                                lCoords.push([m0.x, m0.y, center.x, center.y]);
                                lCoords.push([m1.x, m1.y, center.x, center.y]);
                                lCoords.push([m2.x, m2.y, center.x, center.y]);
                            } else {
                                // Ortocentro (H)
                                // H = A + B + C - 2*O (O = Circuncentro) (Vetorial)
                                // Ou interse√ß√£o das alturas.
                                // Vamos simplificar: Altura √© linha do v√©rtice perpendicular ao lado oposto.
                                // Vou desenhar a linha do v√©rtice at√© a proje√ß√£o no lado oposto.

                                // Helper: Proje√ß√£o de ponto P na reta AB
                                const project = (p, a, b) => {
                                    const atob = { x: b.x - a.x, y: b.y - a.y };
                                    const atop = { x: p.x - a.x, y: p.y - a.y };
                                    const len2 = atob.x * atob.x + atob.y * atob.y;
                                    const dot = atop.x * atob.x + atop.y * atob.y;
                                    const t = dot / len2;
                                    return { x: a.x + atob.x * t, y: a.y + atob.y * t };
                                };

                                const h0 = project(pts[0], pts[1], pts[2]);
                                const h1 = project(pts[1], pts[0], pts[2]);
                                const h2 = project(pts[2], pts[0], pts[1]);

                                // Interse√ß√£o (simplificada, basta calcular a interse√ß√£o de 2)
                                // Mas para o ponto central, vamos usar a propriedade vetorial do Circuncentro se j√° tivessemos calculado, ou recalcular
                                // Recalculando Circuncentro para achar Ortocentro
                                const UXx =
                                    (1 / D) *
                                    ((pts[0].x ** 2 + pts[0].y ** 2) * (pts[1].y - pts[2].y) +
                                        (pts[1].x ** 2 + pts[1].y ** 2) * (pts[2].y - pts[0].y) +
                                        (pts[2].x ** 2 + pts[2].y ** 2) * (pts[0].y - pts[1].y));
                                const UYy =
                                    (1 / D) *
                                    ((pts[0].x ** 2 + pts[0].y ** 2) * (pts[2].x - pts[1].x) +
                                        (pts[1].x ** 2 + pts[1].y ** 2) * (pts[0].x - pts[2].x) +
                                        (pts[2].x ** 2 + pts[2].y ** 2) * (pts[1].x - pts[0].x));

                                // H = P0 + P1 + P2 - 2*C
                                center.x = pts[0].x + pts[1].x + pts[2].x - 2 * UXx;
                                center.y = pts[0].y + pts[1].y + pts[2].y - 2 * UYy;

                                lCoords.push([pts[0].x, pts[0].y, h0.x, h0.y]); // V√©rtice at√© o p√© da altura
                                lCoords.push([pts[1].x, pts[1].y, h1.x, h1.y]);
                                lCoords.push([pts[2].x, pts[2].y, h2.x, h2.y]);

                                // Extens√£o at√© o ortocentro se ele estiver fora
                                // (Visualmente complexo, vamos manter s√≥ a altura interna/externa base)
                                auxCircle.setAttribute("r", 0);
                            }
                        }

                        // Desenha Linhas
                        lCoords.forEach((c, i) => {
                            lines[i].setAttribute("x1", c[0]);
                            lines[i].setAttribute("y1", c[1]);
                            lines[i].setAttribute("x2", c[2]);
                            lines[i].setAttribute("y2", c[3]);
                        });

                        // Posiciona Centro
                        centerPoint.setAttribute("cx", center.x);
                        centerPoint.setAttribute("cy", center.y);
                    };

                    // Drag and Drop Logic
                    let dragging = -1;

                    const onDown = (i) => (e) => {
                        dragging = i;
                        e.preventDefault();
                    };

                    const onMove = (e) => {
                        if (dragging === -1) return;
                        const rect = svg.getBoundingClientRect();
                        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                        const clientY = e.touches ? e.touches[0].clientY : e.clientY;

                        pts[dragging].x = Math.max(
                            10,
                            Math.min(rect.width - 10, clientX - rect.left)
                        );
                        pts[dragging].y = Math.max(
                            10,
                            Math.min(rect.height - 10, clientY - rect.top)
                        );
                        update();
                    };

                    const onUp = () => (dragging = -1);

                    vertices.forEach((v, i) => {
                        v.addEventListener("mousedown", onDown(i));
                        v.addEventListener("touchstart", onDown(i));
                    });
                    window.addEventListener("mousemove", onMove);
                    window.addEventListener("touchmove", onMove);
                    window.addEventListener("mouseup", onUp);
                    window.addEventListener("touchend", onUp);

                    // Bot√µes
                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            mode = btn.dataset.m;
                            // Estilo
                            btns.forEach(
                                (b) =>
                                (b.className =
                                    "center-btn text-[10px] font-bold uppercase p-2 rounded border transition-all bg-white text-gray-500 border-gray-200 hover:bg-gray-50")
                            );
                            btn.className =
                                "center-btn text-[10px] font-bold uppercase p-2 rounded border transition-all bg-brand-purple text-white border-purple-600";

                            // Descri√ß√£o
                            const descs = {
                                median:
                                    "O Baricentro √© o centro de gravidade (encontro das medianas).",
                                bisector:
                                    "O Incentro equidista dos lados (centro do c√≠rculo inscrito).",
                                altitude:
                                    "O Ortocentro pode ficar fora do tri√¢ngulo se houver √¢ngulo obtuso!",
                                perp_bisector:
                                    "O Circuncentro equidista dos v√©rtices (centro do c√≠rculo circunscrito).",
                            };
                            modeDesc.innerText = descs[mode];
                            update();
                        };
                    });

                    update();
                },

                interactive_congruence_machine(container) {
                    let mode = "LLL"; // LLL, LAL, ALA

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-4">M√°quina de Clonagem (Congru√™ncia)</h3>

        <div class="flex gap-2 mb-6 bg-gray-100 p-1 rounded-lg">
            <button class="cong-btn px-4 py-1 rounded text-xs font-bold bg-white text-brand-orange shadow-sm" data-m="LLL">LLL</button>
            <button class="cong-btn px-4 py-1 rounded text-xs font-bold text-gray-400 hover:bg-white" data-m="LAL">LAL</button>
            <button class="cong-btn px-4 py-1 rounded text-xs font-bold text-gray-400 hover:bg-white" data-m="ALA">ALA</button>
        </div>

        <div class="flex justify-around w-full mb-6 relative h-40">
            <div class="flex flex-col items-center">
                <span class="text-[10px] font-bold text-gray-400 uppercase mb-2">Original</span>
                <svg width="100" height="100" class="overflow-visible">
                    <path d="M 10 90 L 90 90 L 30 20 Z" fill="none" stroke="#4B4B4B" stroke-width="2" />
                    <g id="marks-lll" class="transition-opacity">
                        <circle cx="50" cy="90" r="3" fill="#FF9600" />
                        <circle cx="20" cy="55" r="3" fill="#FF9600" />
                        <circle cx="60" cy="55" r="3" fill="#FF9600" />
                    </g>
                    <g id="marks-lal" class="opacity-0 transition-opacity">
                        <circle cx="50" cy="90" r="3" fill="#FF9600" />
                        <circle cx="20" cy="55" r="3" fill="#FF9600" />
                        <path d="M 25 80 Q 20 80 15 85" stroke="#1CB0F6" fill="none" stroke-width="2" />
                    </g>
                    <g id="marks-ala" class="opacity-0 transition-opacity">
                        <circle cx="50" cy="90" r="3" fill="#FF9600" />
                        <path d="M 25 80 Q 20 80 15 85" stroke="#1CB0F6" fill="none" stroke-width="2" />
                        <path d="M 75 90 Q 80 80 85 85" stroke="#1CB0F6" fill="none" stroke-width="2" />
                    </g>
                </svg>
            </div>

            <div class="absolute left-1/2 top-10 bottom-10 w-px bg-gray-200"></div>

            <div class="flex flex-col items-center">
                <span class="text-[10px] font-bold text-gray-400 uppercase mb-2">Clone</span>
                <svg width="100" height="100" class="overflow-visible">
                    <path id="clone-path" d="M 10 90 L 90 90 L 30 20 Z" fill="rgba(255, 150, 0, 0.2)" stroke="#FF9600" stroke-width="2" class="opacity-0 transition-all duration-700" />
                </svg>
            </div>
        </div>

        <button id="btn-clone" class="bg-brand-orange text-white font-bold py-3 px-10 rounded-xl shadow-btn active:scale-95 transition-all">
            CLONAR
        </button>
        <p id="clone-msg" class="text-xs text-gray-500 mt-2 font-bold min-h-[20px]"></p>

    </div>
    `;

                    const btns = container.querySelectorAll(".cong-btn");
                    const marksLLL = container.querySelector("#marks-lll");
                    const marksLAL = container.querySelector("#marks-lal");
                    const marksALA = container.querySelector("#marks-ala");
                    const clonePath = container.querySelector("#clone-path");
                    const btnClone = container.querySelector("#btn-clone");
                    const msg = container.querySelector("#clone-msg");

                    const setMode = (m) => {
                        mode = m;
                        // Atualiza bot√µes
                        btns.forEach((b) => {
                            if (b.dataset.m === m)
                                b.className =
                                    "cong-btn px-4 py-1 rounded text-xs font-bold bg-white text-brand-orange shadow-sm";
                            else
                                b.className =
                                    "cong-btn px-4 py-1 rounded text-xs font-bold text-gray-400 hover:bg-white";
                        });

                        // Atualiza Marcas
                        marksLLL.classList.add("opacity-0");
                        marksLAL.classList.add("opacity-0");
                        marksALA.classList.add("opacity-0");

                        if (m === "LLL") marksLLL.classList.remove("opacity-0");
                        if (m === "LAL") marksLAL.classList.remove("opacity-0");
                        if (m === "ALA") marksALA.classList.remove("opacity-0");

                        // Reset clone
                        clonePath.classList.add("opacity-0");
                        clonePath.classList.remove("scale-100");
                        clonePath.style.transform = "translateX(50px) rotate(20deg)"; // Posi√ß√£o inicial bagun√ßada
                        msg.innerText = "";
                    };

                    btnClone.onclick = () => {
                        clonePath.classList.remove("opacity-0");
                        clonePath.style.transform = "translateX(0px) rotate(0deg)";

                        let txt = "";
                        if (mode === "LLL") txt = "Medindo 3 lados... Clone perfeito!";
                        if (mode === "LAL")
                            txt = "Medindo lado, √¢ngulo, lado... Clone perfeito!";
                        if (mode === "ALA")
                            txt = "Medindo √¢ngulo, lado, √¢ngulo... Clone perfeito!";

                        msg.innerText = "Calculando...";
                        setTimeout(() => {
                            msg.className =
                                "text-xs text-brand-green font-black mt-2 animate-pop-in";
                            msg.innerText = txt;
                        }, 600);
                    };

                    btns.forEach((b) => (b.onclick = () => setMode(b.dataset.m)));
                },

                interactive_triangle_properties(container) {
                    let type = "iso"; // iso, equi

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-center gap-4 mb-6">
            <button class="prop-btn bg-purple-100 text-brand-purple border-2 border-purple-300 font-bold py-2 px-4 rounded-lg text-xs transition-all" data-t="iso">Is√≥sceles</button>
            <button class="prop-btn bg-white text-gray-400 border-2 border-gray-200 font-bold py-2 px-4 rounded-lg text-xs transition-all hover:bg-gray-50" data-t="equi">Equil√°tero</button>
        </div>

        <div class="relative w-64 h-56 flex items-end justify-center mb-4">
            <svg width="240" height="220" class="overflow-visible transition-all duration-700" id="prop-svg">
                <path id="prop-path" d="" fill="rgba(155, 89, 182, 0.1)" stroke="#9B59B6" stroke-width="3" stroke-linejoin="round" class="transition-all duration-700" />
                
                <line x1="120" y1="20" x2="120" y2="200" stroke="#FF9600" stroke-width="2" stroke-dasharray="5,5" />

                <line id="mark-left" x1="75" y1="110" x2="85" y2="110" stroke="#9B59B6" stroke-width="2" transform="rotate(-60 80 110)" />
                <line id="mark-right" x1="155" y1="110" x2="165" y2="110" stroke="#9B59B6" stroke-width="2" transform="rotate(60 160 110)" />
                <line id="mark-bottom" x1="115" y1="200" x2="125" y2="200" stroke="#9B59B6" stroke-width="2" transform="rotate(90 120 200)" class="opacity-0 transition-opacity" />

                <text x="30" y="215" class="text-xs font-bold fill-brand-purple" id="ang-l">70¬∞</text>
                <text x="210" y="215" class="text-xs font-bold fill-brand-purple" id="ang-r">70¬∞</text>
                <text x="120" y="10" class="text-xs font-bold fill-brand-purple" text-anchor="middle" id="ang-t">40¬∞</text>
            </svg>
        </div>

        <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 text-center w-full">
            <p id="prop-desc" class="text-sm text-gray-700 font-medium">
                2 Lados Iguais = 2 √Çngulos da Base Iguais.<br>A linha laranja √© Altura, Mediana e Bissetriz ao mesmo tempo!
            </p>
        </div>

    </div>
    `;

                    const path = container.querySelector("#prop-path");
                    const markB = container.querySelector("#mark-bottom");
                    const desc = container.querySelector("#prop-desc");
                    const btns = container.querySelectorAll(".prop-btn");
                    const angL = container.querySelector("#ang-l");
                    const angR = container.querySelector("#ang-r");
                    const angT = container.querySelector("#ang-t");

                    const update = () => {
                        // Coordenadas Base (Centro X=120, Base Y=200)
                        // Largura base = 160 (x 40 a 200)

                        let topY;
                        if (type === "iso") {
                            // Is√≥sceles Alto
                            topY = 20;
                            // Caminho: 40,200 -> 200,200 -> 120,20
                            path.setAttribute("d", "M 40 200 L 200 200 L 120 20 Z");
                            markB.classList.add("opacity-0");
                            desc.innerHTML =
                                "2 Lados Iguais ‚ûî 2 √Çngulos da Base Iguais.<br>A linha laranja √© o eixo de simetria.";
                            angL.textContent = "70¬∞";
                            angR.textContent = "70¬∞";
                            angT.textContent = "40¬∞";
                        } else {
                            // Equil√°tero
                            // Altura = lado * sqrt(3)/2. Lado=160. Altura ~ 138.
                            // 200 - 138 = 62.
                            topY = 62;
                            path.setAttribute("d", `M 40 200 L 200 200 L 120 ${topY} Z`);
                            markB.classList.remove("opacity-0");
                            desc.innerHTML =
                                "<span class='text-brand-green font-bold'>Perfei√ß√£o!</span> 3 Lados Iguais ‚ûî 3 √Çngulos de 60¬∞.<br>Todos os pontos not√°veis coincidem no centro.";
                            angL.textContent = "60¬∞";
                            angR.textContent = "60¬∞";
                            angT.textContent = "60¬∞";
                        }
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            type = btn.dataset.t;
                            btns.forEach(
                                (b) =>
                                (b.className =
                                    "prop-btn bg-white text-gray-400 border-2 border-gray-200 font-bold py-2 px-4 rounded-lg text-xs transition-all hover:bg-gray-50")
                            );
                            btn.className =
                                "prop-btn bg-purple-100 text-brand-purple border-2 border-purple-300 font-bold py-2 px-4 rounded-lg text-xs transition-all";
                            update();
                        };
                    });

                    update();
                },

                interactive_quad_angle_sum(container) {
                    // Estado
                    const points = {
                        A: { x: 50, y: 50 },
                        B: { x: 250, y: 50 },
                        C: { x: 200, y: 200 },
                        D: { x: 100, y: 200 },
                    };
                    let dragging = null;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-4 flex flex-col items-center w-full shadow-sm select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Soma dos √Çngulos</h3>
        
        <div class="relative w-full max-w-sm h-64 bg-gray-50 border border-gray-200 rounded-xl overflow-hidden touch-none" id="quad-canvas">
            <svg width="100%" height="100%" id="svg-quad">
                <path id="tri-1" d="" fill="rgba(206, 130, 255, 0.1)" stroke="none" />
                <path id="tri-2" d="" fill="rgba(28, 176, 246, 0.1)" stroke="none" />
                <line id="diag-line" stroke="#9CA3AF" stroke-width="1" stroke-dasharray="4" />
                
                <polygon id="poly-shape" points="" fill="none" stroke="#6B7280" stroke-width="2" />
                
                <path id="arc-a" fill="#CE82FF" opacity="0.5" />
                <path id="arc-b" fill="#CE82FF" opacity="0.5" />
                <path id="arc-c" fill="#CE82FF" opacity="0.5" />
                <path id="arc-d" fill="#CE82FF" opacity="0.5" />

                <circle id="h-A" r="8" fill="#CE82FF" class="cursor-pointer hover:stroke-2 hover:stroke-white" />
                <circle id="h-B" r="8" fill="#CE82FF" class="cursor-pointer hover:stroke-2 hover:stroke-white" />
                <circle id="h-C" r="8" fill="#CE82FF" class="cursor-pointer hover:stroke-2 hover:stroke-white" />
                <circle id="h-D" r="8" fill="#CE82FF" class="cursor-pointer hover:stroke-2 hover:stroke-white" />
            </svg>
        </div>
        
        <div class="flex gap-4 mt-4 text-center">
            <div class="bg-purple-100 text-brand-purple px-4 py-2 rounded-lg font-bold">
                <span class="text-xs block text-gray-500 uppercase">Tri√¢ngulos</span>
                2 √ó 180¬∞
            </div>
            <div class="text-2xl font-black text-gray-400 self-center">=</div>
            <div class="bg-green-100 text-brand-green px-4 py-2 rounded-lg font-bold">
                <span class="text-xs block text-gray-500 uppercase">Total</span>
                360¬∞
            </div>
        </div>
        <p class="text-[10px] text-gray-400 mt-2">Arraste os pontos! A soma nunca muda.</p>
    </div>
    `;

                    const svg = container.querySelector("#svg-quad");
                    const poly = container.querySelector("#poly-shape");
                    const diag = container.querySelector("#diag-line");
                    const t1 = container.querySelector("#tri-1");
                    const t2 = container.querySelector("#tri-2");
                    const handles = {
                        A: container.querySelector("#h-A"),
                        B: container.querySelector("#h-B"),
                        C: container.querySelector("#h-C"),
                        D: container.querySelector("#h-D"),
                    };

                    // Helper de √¢ngulo
                    const getAngle = (p1, p2, p3) => {
                        const a1 = Math.atan2(p1.y - p2.y, p1.x - p2.x);
                        const a2 = Math.atan2(p3.y - p2.y, p3.x - p2.x);
                        let angle = ((a2 - a1) * 180) / Math.PI;
                        if (angle < 0) angle += 360;
                        return angle;
                    };

                    const update = () => {
                        const { A, B, C, D } = points;

                        // Atualiza Posi√ß√µes
                        Object.keys(handles).forEach((k) => {
                            handles[k].setAttribute("cx", points[k].x);
                            handles[k].setAttribute("cy", points[k].y);
                        });

                        const pts = `${A.x},${A.y} ${B.x},${B.y} ${C.x},${C.y} ${D.x},${D.y}`;
                        poly.setAttribute("points", pts);

                        // Diagonal AC
                        diag.setAttribute("x1", A.x);
                        diag.setAttribute("y1", A.y);
                        diag.setAttribute("x2", C.x);
                        diag.setAttribute("y2", C.y);

                        // Preenchimento Tri√¢ngulos
                        t1.setAttribute(
                            "d",
                            `M ${A.x} ${A.y} L ${B.x} ${B.y} L ${C.x} ${C.y} Z`
                        );
                        t2.setAttribute(
                            "d",
                            `M ${A.x} ${A.y} L ${D.x} ${D.y} L ${C.x} ${C.y} Z`
                        );
                    };

                    // Drag Logic
                    const getPos = (e) => {
                        const rect = svg.getBoundingClientRect();
                        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                        return {
                            x: Math.max(10, Math.min(rect.width - 10, clientX - rect.left)),
                            y: Math.max(10, Math.min(rect.height - 10, clientY - rect.top)),
                        };
                    };

                    Object.keys(handles).forEach((k) => {
                        const start = (e) => {
                            dragging = k;
                        };
                        handles[k].addEventListener("mousedown", start);
                        handles[k].addEventListener("touchstart", start);
                    });

                    const move = (e) => {
                        if (!dragging) return;
                        e.preventDefault();
                        points[dragging] = getPos(e);
                        update();
                    };

                    const end = () => {
                        dragging = null;
                    };

                    window.addEventListener("mousemove", move);
                    window.addEventListener("touchmove", move, { passive: false });
                    window.addEventListener("mouseup", end);
                    window.addEventListener("touchend", end);

                    update();
                },

                interactive_parallelogram_explorer(container) {
                    // Estado: Apenas 3 pontos s√£o livres, o 4¬∫ √© calculado
                    let p = [
                        { x: 50, y: 150 }, // A (Bottom Left)
                        { x: 200, y: 150 }, // B (Bottom Right)
                        { x: 230, y: 50 }, // C (Top Right)
                    ];
                    let dragging = -1;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-2">Propriedades do Paralelogramo</h3>
        
        <div class="relative w-full max-w-sm h-56 bg-gray-50 border border-gray-200 rounded-xl overflow-hidden touch-none cursor-crosshair">
            <svg width="100%" height="100%" id="para-svg">
                <polygon id="para-poly" points="" fill="rgba(28, 176, 246, 0.1)" stroke="#1CB0F6" stroke-width="2" />
                
                <line id="d1" stroke="#9CA3AF" stroke-dasharray="4" />
                <line id="d2" stroke="#9CA3AF" stroke-dasharray="4" />
                <circle id="midpoint" r="3" fill="#EF4444" />

                <circle id="h0" r="6" fill="#1CB0F6" class="cursor-move" />
                <circle id="h1" r="6" fill="#1CB0F6" class="cursor-move" />
                <circle id="h2" r="6" fill="#1CB0F6" class="cursor-move" />
                <circle id="h3" r="4" fill="white" stroke="#1CB0F6" stroke-width="2" />
            </svg>
            <div class="absolute top-2 left-2 text-[10px] text-gray-400 font-bold pointer-events-none">
                Diagonais se cruzam no meio (ponto vermelho)
            </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4 mt-4 w-full text-center">
            <div class="bg-blue-50 p-2 rounded">
                <span class="text-xs text-gray-500 block">Lado AB</span>
                <span id="val-ab" class="font-bold text-brand-blue">...</span>
            </div>
            <div class="bg-blue-50 p-2 rounded">
                <span class="text-xs text-gray-500 block">Lado CD</span>
                <span id="val-cd" class="font-bold text-brand-blue">...</span>
            </div>
        </div>
    </div>
    `;

                    const svg = container.querySelector("#para-svg");
                    const poly = container.querySelector("#para-poly");
                    const d1 = container.querySelector("#d1");
                    const d2 = container.querySelector("#d2");
                    const mid = container.querySelector("#midpoint");
                    const handles = [0, 1, 2].map((i) =>
                        container.querySelector(`#h${i}`)
                    );
                    const h3 = container.querySelector("#h3");
                    const valAB = container.querySelector("#val-ab");
                    const valCD = container.querySelector("#val-cd");

                    const dist = (p1, p2) =>
                        Math.sqrt(
                            Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2)
                        ).toFixed(0);

                    const update = () => {
                        // Calcula D baseado em A, B, C para manter paralelismo
                        // Vetor BC = C - B. D = A + BC.
                        // D.x = A.x + (C.x - B.x)
                        const D = {
                            x: p[0].x + (p[2].x - p[1].x),
                            y: p[0].y + (p[2].y - p[1].y),
                        };

                        // Renderiza Handles
                        handles.forEach((h, i) => {
                            h.setAttribute("cx", p[i].x);
                            h.setAttribute("cy", p[i].y);
                        });
                        h3.setAttribute("cx", D.x);
                        h3.setAttribute("cy", D.y);

                        // Pol√≠gono
                        poly.setAttribute(
                            "points",
                            `${p[0].x},${p[0].y} ${p[1].x},${p[1].y} ${p[2].x},${p[2].y} ${D.x},${D.y}`
                        );

                        // Diagonais
                        d1.setAttribute("x1", p[0].x);
                        d1.setAttribute("y1", p[0].y);
                        d1.setAttribute("x2", p[2].x);
                        d1.setAttribute("y2", p[2].y);

                        d2.setAttribute("x1", p[1].x);
                        d2.setAttribute("y1", p[1].y);
                        d2.setAttribute("x2", D.x);
                        d2.setAttribute("y2", D.y);

                        // Ponto M√©dio (M√©dia de A e C)
                        const mx = (p[0].x + p[2].x) / 2;
                        const my = (p[0].y + p[2].y) / 2;
                        mid.setAttribute("cx", mx);
                        mid.setAttribute("cy", my);

                        // Medidas
                        const dAB = dist(p[0], p[1]);
                        const dCD = dist(p[2], D);
                        valAB.innerText = dAB;
                        valCD.innerText = dCD;
                    };

                    // Drag Logic
                    const getPos = (e) => {
                        const rect = svg.getBoundingClientRect();
                        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                        return { x: clientX - rect.left, y: clientY - rect.top };
                    };

                    handles.forEach((h, i) => {
                        const start = (e) => {
                            dragging = i;
                        };
                        h.addEventListener("mousedown", start);
                        h.addEventListener("touchstart", start);
                    });

                    const move = (e) => {
                        if (dragging === -1) return;
                        e.preventDefault();
                        // Limites suaves
                        const pos = getPos(e);
                        p[dragging] = pos;
                        update();
                    };

                    const stop = () => {
                        dragging = -1;
                    };

                    window.addEventListener("mousemove", move);
                    window.addEventListener("touchmove", move, { passive: false });
                    window.addEventListener("mouseup", stop);
                    window.addEventListener("touchend", stop);

                    update();
                },

                interactive_midsegment_calc(container) {
                    let B = 10;
                    let b = 4;
                    let h = 6;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-6">
            <h3 class="text-brand-green font-bold uppercase text-xs tracking-widest">Calculadora de Base M√©dia</h3>
            <div id="type-badge" class="bg-gray-100 text-gray-500 px-3 py-1 rounded-full text-xs font-black uppercase">Trap√©zio</div>
        </div>

        <div class="relative w-full max-w-xs h-40 flex items-center justify-center mb-6">
            <svg width="240" height="160" class="overflow-visible">
                <path id="trap-poly" d="" fill="rgba(34, 197, 94, 0.1)" stroke="#22C55E" stroke-width="2" />
                
                <line id="line-mid" stroke="#EA580C" stroke-width="3" stroke-dasharray="4" />
                <circle id="p-mid-l" r="3" fill="#EA580C" />
                <circle id="p-mid-r" r="3" fill="#EA580C" />
                
                <text id="lbl-b" x="120" y="35" text-anchor="middle" font-weight="bold" fill="#4B4B4B" font-size="12"></text>
                <text id="lbl-B" x="120" y="145" text-anchor="middle" font-weight="bold" fill="#4B4B4B" font-size="12"></text>
                <text id="lbl-mid" x="120" y="85" text-anchor="middle" font-weight="bold" fill="#EA580C" font-size="14"></text>
            </svg>
        </div>

        <div class="w-full max-w-xs space-y-4">
            <div>
                <div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-1">Base Menor (b)</div>
                <input type="range" id="sl-b" min="0" max="10" value="4" class="w-full h-2 bg-gray-200 rounded-lg accent-brand-text cursor-pointer">
            </div>
            <div>
                <div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-1">Base Maior (B)</div>
                <input type="range" id="sl-B" min="6" max="16" value="10" class="w-full h-2 bg-gray-200 rounded-lg accent-brand-text cursor-pointer">
            </div>
        </div>

        <div class="mt-6 text-center bg-orange-50 border border-orange-200 p-3 rounded-xl w-full max-w-xs">
            <p class="text-xs text-orange-800 uppercase font-bold mb-1">C√°lculo (M√©dia)</p>
            <p class="font-mono text-lg text-gray-700">
                (<span id="val-B">10</span> + <span id="val-b">4</span>) √∑ 2 = <strong class="text-brand-orange text-2xl" id="val-mid">7</strong>
            </p>
        </div>

    </div>
    `;

                    const svgPoly = container.querySelector("#trap-poly");
                    const lineMid = container.querySelector("#line-mid");
                    const pL = container.querySelector("#p-mid-l");
                    const pR = container.querySelector("#p-mid-r");
                    const slb = container.querySelector("#sl-b");
                    const slB = container.querySelector("#sl-B");
                    const valB = container.querySelector("#val-B");
                    const valb = container.querySelector("#val-b");
                    const valMid = container.querySelector("#val-mid");
                    const badge = container.querySelector("#type-badge");
                    const lblb = container.querySelector("#lbl-b");
                    const lblB = container.querySelector("#lbl-B");
                    const lblMid = container.querySelector("#lbl-mid");

                    const update = () => {
                        b = parseInt(slb.value);
                        B = parseInt(slB.value);

                        // Garante que B >= b para visualiza√ß√£o bonita
                        if (b > B) {
                            B = b;
                            slB.value = b;
                        }

                        const scale = 10;
                        const cx = 120;
                        const cy = 80;
                        const hPx = 100;

                        // Coordenadas
                        const xTL = cx - (b * scale) / 2;
                        const xTR = cx + (b * scale) / 2;
                        const xBL = cx - (B * scale) / 2;
                        const xBR = cx + (B * scale) / 2;
                        const yTop = cy - hPx / 2;
                        const yBot = cy + hPx / 2;

                        // Desenha Trap√©zio
                        svgPoly.setAttribute(
                            "d",
                            `M ${xTL} ${yTop} L ${xTR} ${yTop} L ${xBR} ${yBot} L ${xBL} ${yBot} Z`
                        );

                        // Base M√©dia (Pontos M√©dios)
                        const midY = cy;
                        const midXL = (xTL + xBL) / 2;
                        const midXR = (xTR + xBR) / 2;

                        lineMid.setAttribute("x1", midXL);
                        lineMid.setAttribute("y1", midY);
                        lineMid.setAttribute("x2", midXR);
                        lineMid.setAttribute("y2", midY);

                        pL.setAttribute("cx", midXL);
                        pL.setAttribute("cy", midY);
                        pR.setAttribute("cx", midXR);
                        pR.setAttribute("cy", midY);

                        // Labels
                        lblb.textContent = b > 0 ? b : "";
                        lblB.textContent = B;

                        // C√°lculo
                        const midVal = (B + b) / 2;
                        lblMid.textContent = midVal;

                        valB.innerText = B;
                        valb.innerText = b;
                        valMid.innerText = midVal;

                        // L√≥gica Tri√¢ngulo vs Trap√©zio
                        if (b === 0) {
                            badge.innerText = "Tri√¢ngulo";
                            badge.className =
                                "bg-purple-100 text-brand-purple px-3 py-1 rounded-full text-xs font-black uppercase";
                            svgPoly.setAttribute("fill", "rgba(206, 130, 255, 0.1)");
                            svgPoly.setAttribute("stroke", "#CE82FF");
                        } else {
                            badge.innerText = "Trap√©zio";
                            badge.className =
                                "bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-black uppercase";
                            svgPoly.setAttribute("fill", "rgba(34, 197, 94, 0.1)");
                            svgPoly.setAttribute("stroke", "#22C55E");
                        }
                    };

                    slb.oninput = update;
                    slB.oninput = update;
                    update();
                },

                interactive_trapezoid_types(container) {
                    let type = "iso"; // iso, rect, scalene

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-6">Classificador de Trap√©zios</h3>

        <div class="relative w-full max-w-sm h-48 bg-gray-50 border border-gray-200 rounded-xl mb-6 flex items-center justify-center overflow-hidden">
            <svg width="260" height="160" class="transition-all duration-500">
                <path id="trap-path" d="" fill="rgba(255, 150, 0, 0.1)" stroke="#EA580C" stroke-width="3" stroke-linejoin="round" class="transition-all duration-700" />
                
                <path id="angle-90-top" d="M 50 40 L 60 40 L 60 50 L 50 50" fill="none" stroke="#EA580C" stroke-width="2" class="opacity-0" />
                <path id="angle-90-bot" d="M 50 120 L 60 120 L 60 110 L 50 110" fill="none" stroke="#EA580C" stroke-width="2" class="opacity-0" />

                <line id="tick-l" x1="45" y1="80" x2="55" y2="80" stroke="#EA580C" stroke-width="2" class="opacity-0" />
                <line id="tick-r" x1="205" y1="80" x2="215" y2="80" stroke="#EA580C" stroke-width="2" class="opacity-0" />
            </svg>
        </div>

        <div class="flex gap-2 w-full max-w-sm">
            <button class="trap-btn flex-1 py-3 rounded-xl border-2 font-bold text-xs uppercase transition-all bg-orange-100 border-orange-300 text-orange-800" data-t="iso">Is√≥sceles</button>
            <button class="trap-btn flex-1 py-3 rounded-xl border-2 font-bold text-xs uppercase transition-all bg-white border-gray-200 text-gray-500" data-t="rect">Ret√¢ngulo</button>
            <button class="trap-btn flex-1 py-3 rounded-xl border-2 font-bold text-xs uppercase transition-all bg-white border-gray-200 text-gray-500" data-t="scalene">Escaleno</button>
        </div>

        <p id="trap-desc" class="mt-4 text-center text-sm text-gray-600 font-medium min-h-[40px]">
            Os lados n√£o paralelos s√£o congruentes (iguais). Os √¢ngulos da base tamb√©m s√£o iguais.
        </p>

    </div>
    `;

                    const path = container.querySelector("#trap-path");
                    const desc = container.querySelector("#trap-desc");
                    const btns = container.querySelectorAll(".trap-btn");
                    const angTop = container.querySelector("#angle-90-top");
                    const angBot = container.querySelector("#angle-90-bot");
                    const tickL = container.querySelector("#tick-l");
                    const tickR = container.querySelector("#tick-r");

                    const update = () => {
                        // Coordenadas base: Y: 40 (top), 120 (bottom)
                        let d = "";

                        // Reset marcas
                        angTop.style.opacity = 0;
                        angBot.style.opacity = 0;
                        tickL.style.opacity = 0;
                        tickR.style.opacity = 0;

                        if (type === "iso") {
                            // Sim√©trico
                            d = "M 80 40 L 180 40 L 210 120 L 50 120 Z";
                            desc.innerHTML =
                                "Os lados n√£o paralelos s√£o <strong>iguais</strong>. Tem simetria.";
                            tickL.style.opacity = 1;
                            tickL.setAttribute("x1", 60);
                            tickL.setAttribute("x2", 70);
                            // Ajuste visual das marcas (hardcoded for simplicity of path)
                            // Na verdade M 80,40 -> 50,120 √© o lado esquerdo. M 180,40 -> 210,120 √© direito.
                            // Marcas no meio.
                        } else if (type === "rect") {
                            // Lado esquerdo reto
                            d = "M 50 40 L 160 40 L 200 120 L 50 120 Z";
                            desc.innerHTML =
                                "Um dos lados √© perpendicular √†s bases. Tem <strong>dois √¢ngulos de 90¬∞</strong>.";
                            angTop.style.opacity = 1;
                            angBot.style.opacity = 1;
                        } else {
                            // Torto
                            d = "M 70 40 L 150 40 L 220 120 L 30 120 Z";
                            desc.innerHTML =
                                "Todos os lados e √¢ngulos s√£o diferentes. Sem simetria.";
                        }

                        path.setAttribute("d", d);

                        // Atualiza bot√µes
                        btns.forEach((b) => {
                            if (b.dataset.t === type) {
                                b.className =
                                    "trap-btn flex-1 py-3 rounded-xl border-2 font-bold text-xs uppercase transition-all bg-orange-100 border-orange-300 text-orange-800 shadow-sm";
                            } else {
                                b.className =
                                    "trap-btn flex-1 py-3 rounded-xl border-2 font-bold text-xs uppercase transition-all bg-white border-gray-200 text-gray-500 hover:bg-gray-50";
                            }
                        });
                    };

                    btns.forEach(
                        (b) =>
                        (b.onclick = () => {
                            type = b.dataset.t;
                            update();
                        })
                    );

                    update();
                },

                interactive_quad_sorter(container) {
                    const shapes = [
                        {
                            name: "Quadrado",
                            props: [
                                "4 Lados Iguais",
                                "4 √Çngulos Retos",
                                "Diagonais Iguais",
                                "Diagonais Perpendiculares",
                            ],
                        },
                        {
                            name: "Ret√¢ngulo",
                            props: [
                                "4 √Çngulos Retos",
                                "Diagonais Iguais",
                                "Lados Opostos Iguais",
                            ],
                        },
                        {
                            name: "Losango",
                            props: [
                                "4 Lados Iguais",
                                "Diagonais Perpendiculares",
                                "Lados Opostos Paralelos",
                            ],
                        },
                        {
                            name: "Trap√©zio",
                            props: ["1 Par Paralelo", "Soma √¢ngulos lado = 180¬∞"],
                        },
                    ];

                    let currentShape = null;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">
        
        <div class="flex justify-between w-full items-center mb-6 z-10">
            <h3 class="font-black text-brand-purple uppercase text-xs tracking-widest"><i class="fas fa-search"></i> Detetive de Formas</h3>
            <div class="bg-gray-700 px-3 py-1 rounded-full text-xs font-bold text-yellow-400">Score: <span id="det-score">0</span></div>
        </div>

        <div class="bg-white text-gray-800 p-6 rounded-2xl w-full max-w-sm shadow-2xl relative z-10 text-center mb-6">
            <p class="text-[10px] uppercase font-bold text-gray-400 mb-2">Pistas Encontradas:</p>
            <ul id="clue-list" class="text-sm font-bold space-y-2 text-left list-disc list-inside">
            </ul>
            <div class="absolute -top-3 -right-3 text-4xl transform rotate-12">üïµÔ∏è‚Äç‚ôÄÔ∏è</div>
        </div>

        <p class="text-xs text-gray-500 font-bold mb-3 uppercase z-10">Quem sou eu?</p>

        <div class="grid grid-cols-2 gap-3 w-full max-w-sm z-10">
            <button class="guess-btn bg-gray-800 border-2 border-gray-600 hover:bg-gray-700 hover:border-brand-purple rounded-xl py-3 font-bold text-sm transition-all" data-n="Quadrado">Quadrado</button>
            <button class="guess-btn bg-gray-800 border-2 border-gray-600 hover:bg-gray-700 hover:border-brand-blue rounded-xl py-3 font-bold text-sm transition-all" data-n="Ret√¢ngulo">Ret√¢ngulo</button>
            <button class="guess-btn bg-gray-800 border-2 border-gray-600 hover:bg-gray-700 hover:border-brand-orange rounded-xl py-3 font-bold text-sm transition-all" data-n="Losango">Losango</button>
            <button class="guess-btn bg-gray-800 border-2 border-gray-600 hover:bg-gray-700 hover:border-brand-green rounded-xl py-3 font-bold text-sm transition-all" data-n="Trap√©zio">Trap√©zio</button>
        </div>

        <div id="det-feedback" class="h-10 mt-4 flex items-center justify-center font-bold text-lg z-10"></div>
        
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10 pointer-events-none"></div>

    </div>
    `;

                    const clueList = container.querySelector("#clue-list");
                    const feedback = container.querySelector("#det-feedback");
                    const scoreEl = container.querySelector("#det-score");
                    const btns = container.querySelectorAll(".guess-btn");

                    const nextRound = () => {
                        // Escolhe forma aleat√≥ria
                        currentShape = shapes[Math.floor(Math.random() * shapes.length)];

                        // Pega 2 ou 3 pistas aleat√≥rias
                        const clues = [...currentShape.props]
                            .sort(() => 0.5 - Math.random())
                            .slice(0, 2);

                        clueList.innerHTML = clues
                            .map((c) => `<li class="animate-slide-up">${c}</li>`)
                            .join("");
                        feedback.innerText = "";

                        btns.forEach((b) => {
                            b.disabled = false;
                            b.classList.remove(
                                "opacity-50",
                                "bg-green-600",
                                "bg-red-600",
                                "border-transparent"
                            );
                            b.classList.add("bg-gray-800", "border-gray-600");
                        });
                    };

                    const check = (guess, btn) => {
                        if (guess === currentShape.name) {
                            score += 100;
                            scoreEl.innerText = score;
                            feedback.innerHTML =
                                "<span class='text-green-400'>Elementar! üéâ</span>";
                            btn.classList.remove("bg-gray-800", "border-gray-600");
                            btn.classList.add("bg-green-600", "border-transparent");
                            setTimeout(nextRound, 1500);
                        } else {
                            score = Math.max(0, score - 50);
                            scoreEl.innerText = score;
                            feedback.innerHTML =
                                "<span class='text-red-500'>Pista Falsa! ‚ùå</span>";
                            btn.classList.remove("bg-gray-800", "border-gray-600");
                            btn.classList.add("bg-red-600", "border-transparent");
                            btn.disabled = true;
                        }
                    };

                    btns.forEach((b) => (b.onclick = () => check(b.dataset.n, b)));

                    nextRound();
                },

                interactive_circle_vs_circumference(container) {
                    let mode = "circ"; // 'circ' ou 'disk'

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex gap-4 mb-6">
            <button class="mode-btn bg-white border-2 border-brand-blue text-brand-blue font-bold py-2 px-4 rounded-xl shadow-sm hover:bg-blue-50 transition-all active:scale-95 ring-2 ring-blue-200" data-m="circ">
                Circunfer√™ncia
            </button>
            <button class="mode-btn bg-white border-2 border-gray-200 text-gray-400 font-bold py-2 px-4 rounded-xl shadow-sm hover:bg-gray-50 transition-all active:scale-95" data-m="disk">
                C√≠rculo
            </button>
        </div>

        <div class="relative w-64 h-64 flex items-center justify-center">
            <svg width="240" height="240" viewBox="0 0 240 240" class="absolute inset-0 z-10 transition-all duration-500">
                <circle cx="120" cy="120" r="100" fill="transparent" stroke="#1CB0F6" stroke-width="8" id="svg-stroke" />
            </svg>

            <div id="circle-fill" class="absolute w-[200px] h-[200px] bg-brand-orange rounded-full opacity-0 scale-0 transition-all duration-500 ease-out z-0"></div>

            <div id="label-circ" class="absolute top-0 right-0 bg-brand-blue text-white text-xs font-bold px-2 py-1 rounded shadow-md animate-bounce">Contorno</div>
            <div id="label-disk" class="absolute flex items-center justify-center inset-0 text-white font-black text-2xl opacity-0 transition-opacity">REGI√ÉO</div>
        </div>

        <p id="desc-text" class="text-center text-sm font-medium text-gray-500 mt-4 min-h-[40px]">
            Apenas a borda. Como um anel.
        </p>

    </div>
    `;

                    const fill = container.querySelector("#circle-fill");
                    const stroke = container.querySelector("#svg-stroke");
                    const lblCirc = container.querySelector("#label-circ");
                    const lblDisk = container.querySelector("#label-disk");
                    const desc = container.querySelector("#desc-text");
                    const btns = container.querySelectorAll(".mode-btn");

                    const update = () => {
                        if (mode === "circ") {
                            fill.classList.remove("scale-100", "opacity-100");
                            fill.classList.add("scale-0", "opacity-0");
                            stroke.setAttribute("stroke", "#1CB0F6");
                            stroke.setAttribute("fill", "transparent");
                            lblCirc.classList.remove("hidden");
                            lblDisk.classList.add("opacity-0");
                            desc.innerHTML =
                                "Apenas a borda. Como um <strong class='text-brand-blue'>Anel</strong>.";
                        } else {
                            fill.classList.remove("scale-0", "opacity-0");
                            fill.classList.add("scale-100", "opacity-100");
                            stroke.setAttribute("stroke", "#EA580C"); // Orange border to match
                            lblCirc.classList.add("hidden");
                            lblDisk.classList.remove("opacity-0");
                            desc.innerHTML =
                                "Tudo preenchido. Como uma <strong class='text-brand-orange'>Moeda</strong>.";
                        }

                        // Atualiza bot√µes
                        btns.forEach((b) => {
                            if (b.dataset.m === mode) {
                                b.className = `mode-btn bg-white border-2 font-bold py-2 px-4 rounded-xl shadow-sm transition-all active:scale-95 ring-2 ${mode === "circ"
                                    ? "border-brand-blue text-brand-blue ring-blue-200"
                                    : "border-brand-orange text-brand-orange ring-orange-200"
                                    }`;
                            } else {
                                b.className =
                                    "mode-btn bg-white border-2 border-gray-200 text-gray-400 font-bold py-2 px-4 rounded-xl shadow-sm hover:bg-gray-50 transition-all active:scale-95";
                            }
                        });
                    };

                    btns.forEach(
                        (b) =>
                        (b.onclick = () => {
                            mode = b.dataset.m;
                            update();
                        })
                    );
                },

                interactive_circle_anatomy(container) {
                    // Elementos Interativos
                    const elements = {
                        radius: {
                            label: "Raio",
                            desc: "Do centro √† borda.",
                            color: "#58CC02",
                        },
                        diameter: {
                            label: "Di√¢metro",
                            desc: "Corda m√°xima (2x Raio).",
                            color: "#FF4B4B",
                        },
                        chord: {
                            label: "Corda",
                            desc: "Liga dois pontos quaisquer.",
                            color: "#CE82FF",
                        },
                        sagitta: {
                            label: "Flecha",
                            desc: "Altura do arco (dist√¢ncia corda-arco).",
                            color: "#FF9600",
                        },
                        arc: {
                            label: "Arco",
                            desc: "Peda√ßo da circunfer√™ncia.",
                            color: "#1CB0F6",
                        },
                    };

                    let active = null;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-4">Anatomia Interativa</h3>
        <p class="text-xs text-gray-400 mb-6">Clique nos nomes para destacar.</p>

        <div class="flex flex-wrap gap-2 justify-center w-full mb-8">
            ${Object.keys(elements)
                            .map(
                                (k) => `
                <button class="anat-btn px-3 py-1 rounded-full border-2 text-xs font-bold uppercase transition-all hover:scale-105" 
                    data-id="${k}" style="border-color: ${elements[k].color}; color: ${elements[k].color}; bg-white">
                    ${elements[k].label}
                </button>
            `
                            )
                            .join("")}
        </div>

        <div class="relative w-64 h-64">
            <svg viewBox="0 0 200 200" class="absolute inset-0 w-full h-full drop-shadow-md">
                <circle cx="100" cy="100" r="90" fill="#f8fafc" stroke="#94a3b8" stroke-width="2" />
                <circle cx="100" cy="100" r="3" fill="#475569" /> <line id="el-diameter" x1="10" y1="100" x2="190" y2="100" stroke="#FF4B4B" stroke-width="4" class="transition-opacity duration-300 opacity-20" stroke-linecap="round" />
                
                <line id="el-radius" x1="100" y1="100" x2="163.6" y2="36.4" stroke="#58CC02" stroke-width="4" class="transition-opacity duration-300 opacity-20" stroke-linecap="round" />

                <line id="el-chord" x1="40" y1="170" x2="160" y2="170" stroke="#CE82FF" stroke-width="4" class="transition-opacity duration-300 opacity-20" stroke-linecap="round" />

                <path id="el-arc" d="M 40 170 A 90 90 0 0 0 160 170" fill="none" stroke="#1CB0F6" stroke-width="6" class="transition-opacity duration-300 opacity-20" stroke-linecap="round" />

                <line id="el-sagitta" x1="100" y1="170" x2="100" y2="190" stroke="#FF9600" stroke-width="4" class="transition-opacity duration-300 opacity-20" stroke-linecap="round" marker-end="url(#arrowhead)" />
            
                <defs>
                    <marker id="arrowhead" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                        <path d="M 0 0 L 6 3 L 0 6 Z" fill="#FF9600" />
                    </marker>
                </defs>
            </svg>
        </div>

        <div id="info-box" class="mt-6 w-full bg-gray-50 border-2 border-gray-100 rounded-xl p-4 text-center min-h-[80px] flex flex-col justify-center items-center transition-colors duration-300">
            <span class="text-sm font-bold text-gray-400">Selecione um elemento</span>
        </div>

    </div>
    `;

                    const infoBox = container.querySelector("#info-box");
                    const btns = container.querySelectorAll(".anat-btn");
                    const svgEls = {
                        radius: container.querySelector("#el-radius"),
                        diameter: container.querySelector("#el-diameter"),
                        chord: container.querySelector("#el-chord"),
                        arc: container.querySelector("#el-arc"),
                        sagitta: container.querySelector("#el-sagitta"),
                    };

                    const activate = (id) => {
                        if (active === id) {
                            // Desativar se clicar no mesmo
                            active = null;
                            reset();
                            return;
                        }
                        active = id;

                        // Reset Visuals
                        Object.values(svgEls).forEach((el) =>
                            el.classList.add("opacity-20")
                        );
                        btns.forEach((b) => {
                            b.style.backgroundColor = "white";
                            b.style.color = elements[b.dataset.id].color;
                        });

                        // Activate
                        const elData = elements[id];
                        const svgEl = svgEls[id];

                        if (svgEl) {
                            svgEl.classList.remove("opacity-20");
                            svgEl.classList.add("drop-shadow-lg");
                        }

                        const activeBtn = container.querySelector(
                            `.anat-btn[data-id="${id}"]`
                        );
                        activeBtn.style.backgroundColor = elData.color;
                        activeBtn.style.color = "white";

                        infoBox.style.borderColor = elData.color;
                        infoBox.style.backgroundColor = elData.color + "15"; // Hex alpha fake (works if 6 digit hex) or use rgba.
                        // Simplifica√ß√£o: apenas borda e texto.
                        infoBox.innerHTML = `
            <strong class="text-lg uppercase mb-1" style="color:${elData.color}">${elData.label}</strong>
            <span class="text-sm text-gray-600 font-medium">${elData.desc}</span>
        `;
                    };

                    const reset = () => {
                        Object.values(svgEls).forEach((el) =>
                            el.classList.add("opacity-20")
                        );
                        btns.forEach((b) => {
                            b.style.backgroundColor = "white";
                            b.style.color = elements[b.dataset.id].color;
                        });
                        infoBox.style.borderColor = "#f3f4f6";
                        infoBox.style.backgroundColor = "#f9fafb";
                        infoBox.innerHTML =
                            '<span class="text-sm font-bold text-gray-400">Selecione um elemento</span>';
                    };

                    btns.forEach((b) => (b.onclick = () => activate(b.dataset.id)));
                },

                interactive_line_circle_pos(container) {
                    let distance = 160; // Start external
                    const radius = 60;
                    const centerY = 100;
                    const centerX = 150;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-4">
            <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest">Reta vs Circunfer√™ncia</h3>
            <div id="pos-badge" class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-black uppercase">Externa</div>
        </div>

        <div class="relative w-[300px] h-[200px] bg-gray-50 border border-gray-200 rounded-xl mb-6 overflow-hidden shadow-inner">
            <svg width="300" height="200" viewBox="0 0 300 200" class="absolute inset-0">
                <circle cx="150" cy="100" r="${radius}" fill="rgba(28, 176, 246, 0.1)" stroke="#1CB0F6" stroke-width="3" />
                <circle cx="150" cy="100" r="3" fill="#1CB0F6" />
                
                <line id="moving-line" x1="10" y1="0" x2="10" y2="200" stroke="#4B4B4B" stroke-width="4" stroke-dasharray="0" />
                
                <line id="dist-line" x1="150" y1="100" x2="10" y2="100" stroke="#94a3b8" stroke-width="2" stroke-dasharray="4,4" />
                <text id="dist-text" x="80" y="90" font-size="10" fill="#64748b" text-anchor="middle">d</text>
            </svg>
        </div>

        <div class="w-full max-w-xs flex flex-col gap-2">
            <div class="flex justify-between text-xs font-bold text-gray-400 uppercase">
                <span>Centro</span>
                <span>Dist√¢ncia</span>
            </div>
            <input type="range" id="dist-slider" min="0" max="140" value="80" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue">
        </div>
        
        <p id="pos-desc" class="text-sm text-gray-500 text-center mt-4 h-10 font-medium">A reta est√° longe. Nenhum ponto em comum.</p>

    </div>
    `;

                    const line = container.querySelector("#moving-line");
                    const distLine = container.querySelector("#dist-line");
                    const distText = container.querySelector("#dist-text");
                    const slider = container.querySelector("#dist-slider");
                    const badge = container.querySelector("#pos-badge");
                    const desc = container.querySelector("#pos-desc");

                    const update = () => {
                        // Slider value 0 (center) to 140 (far right)
                        // Let's visualize line moving from center (0) to right
                        const val = parseInt(slider.value);
                        const lineX = centerX + val; // Move to right

                        line.setAttribute("x1", lineX);
                        line.setAttribute("x2", lineX);
                        distLine.setAttribute("x2", lineX);
                        distText.setAttribute("x", centerX + val / 2);

                        // Classification
                        // Radius is 60.
                        // d < r: Secante
                        // d = r: Tangente
                        // d > r: Externa

                        // Toler√¢ncia para o usu√°rio achar a tangente
                        const tolerance = 2;

                        if (Math.abs(val - radius) <= tolerance) {
                            // Tangente
                            badge.innerText = "Tangente";
                            badge.className =
                                "bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-black uppercase";
                            desc.innerHTML =
                                "A dist√¢ncia √© <strong>IGUAL</strong> ao raio. <br>Toca em 1 ponto √∫nico.";
                            line.setAttribute("stroke", "#1CB0F6"); // Blue
                            // Snap visual
                            // line.setAttribute('x1', centerX + radius);
                            // line.setAttribute('x2', centerX + radius);
                        } else if (val < radius) {
                            // Secante
                            badge.innerText = "Secante";
                            badge.className =
                                "bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-black uppercase";
                            desc.innerHTML =
                                "A dist√¢ncia √© <strong>MENOR</strong> que o raio. <br>Corta em 2 pontos.";
                            line.setAttribute("stroke", "#EF4444"); // Red
                        } else {
                            // Externa
                            badge.innerText = "Externa";
                            badge.className =
                                "bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-black uppercase";
                            desc.innerHTML =
                                "A dist√¢ncia √© <strong>MAIOR</strong> que o raio. <br>N√£o se tocam.";
                            line.setAttribute("stroke", "#4B4B4B"); // Gray
                        }
                    };

                    slider.addEventListener("input", update);
                    update();
                },

                interactive_tangent_prop(container) {
                    let angle = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-yellow font-bold uppercase text-xs tracking-widest mb-2">A Regra dos 90 Graus</h3>
        <p class="text-xs text-gray-400 mb-6 text-center">Gire a reta tangente. O √¢ngulo com o raio √© sempre reto!</p>

        <div class="relative w-64 h-64 bg-gray-50 rounded-full border border-gray-200 flex items-center justify-center mb-6 shadow-inner">
            <svg width="256" height="256" viewBox="0 0 256 256" class="absolute inset-0">
                <circle cx="128" cy="128" r="80" fill="white" stroke="#EAB308" stroke-width="4" />
                <circle cx="128" cy="128" r="4" fill="#4B4B4B" />

                <g id="radius-group">
                    <line x1="128" y1="128" x2="208" y2="128" stroke="#4B4B4B" stroke-width="2" stroke-dasharray="4,4" />
                    <path d="M 198 118 L 188 118 L 188 128" fill="none" stroke="#EF4444" stroke-width="2" />
                    <line x1="208" y1="28" x2="208" y2="228" stroke="#1CB0F6" stroke-width="4" />
                    <circle cx="208" cy="128" r="6" fill="#1CB0F6" />
                </g>
            </svg>
        </div>

        <input type="range" id="tan-slider" min="0" max="360" value="0" class="w-full max-w-xs h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-yellow">

    </div>
    `;

                    const group = container.querySelector("#radius-group");
                    const slider = container.querySelector("#tan-slider");

                    const update = () => {
                        angle = slider.value;
                        // SVG Rotation center 128 128
                        group.setAttribute("transform", `rotate(${angle}, 128, 128)`);
                    };

                    slider.oninput = update;
                },

                interactive_two_circles_pos(container) {
                    let dist = 180; // Distance between centers
                    const r1 = 60; // Blue
                    const r2 = 40; // Orange

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-4">
            <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest">Duas Circunfer√™ncias</h3>
            <div id="c-status" class="bg-gray-100 text-gray-500 px-3 py-1 rounded-full text-xs font-black uppercase text-center min-w-[100px]">Externas</div>
        </div>

        <div class="relative w-full h-[200px] bg-gray-50 border border-gray-200 rounded-xl mb-6 overflow-hidden flex items-center justify-center">
            <svg width="100%" height="100%" class="absolute inset-0">
                
                <circle cx="50%" cy="50%" r="${r1}" fill="rgba(28, 176, 246, 0.2)" stroke="#1CB0F6" stroke-width="2" />
                <circle cx="50%" cy="50%" r="3" fill="#1CB0F6" />

                <g id="moving-c-group">
                    <circle cx="0" cy="0" r="${r2}" fill="rgba(255, 150, 0, 0.2)" stroke="#FF9600" stroke-width="2" />
                    <circle cx="0" cy="0" r="3" fill="#FF9600" />
                </g>

                <line id="conn-line" x1="50%" y1="50%" x2="50%" y2="50%" stroke="#94a3b8" stroke-width="1" stroke-dasharray="4" />
            </svg>
        </div>

        <div class="w-full max-w-xs">
            <label class="text-[10px] font-bold text-gray-400 uppercase">Dist√¢ncia entre Centros</label>
            <input type="range" id="c-slider" min="0" max="150" value="120" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-purple">
        </div>

    </div>
    `;

                    const slider = container.querySelector("#c-slider");
                    const group = container.querySelector("#moving-c-group");
                    const line = container.querySelector("#conn-line");
                    const status = container.querySelector("#c-status");

                    // Get SVG dimensions to center
                    // We assume center is 50% 50%.
                    // To move the second circle, we just translate the group relative to center.
                    // SVG coordinates: let's assume center is (0,0) for the group transform if we put it at center initially.

                    // Actually, getting absolute pixels is safer.
                    // Let's assume container width is roughly 300px (standard mobile).
                    // Center approx 150, 100.

                    const update = () => {
                        const d = parseInt(slider.value);
                        // Map slider (0 to 150) to pixel offset from center
                        // Fixed circle R=60. Moving R=40.
                        // Tangent External: d = 100.
                        // Tangent Internal: d = 20.

                        // We need to access the parent SVG width to set line x2 properly
                        // For simplicity in this string context, let's use a fixed center assumption or percentage.
                        // transform translate works with pixels.

                        // Let's translate the moving group to (center + d, center)
                        // But SVG coordinates origin (0,0) is top-left.
                        // Fixed circle is at 50% 50%.
                        // Moving circle cx=0 cy=0 inside group.
                        // We translate group to (50% + d, 50%).

                        // CSS variable or calc is tricky inside attribute.
                        // JS approach:
                        const svgW = container.querySelector("svg").clientWidth;
                        const svgH = container.querySelector("svg").clientHeight;
                        const cx = svgW / 2;
                        const cy = svgH / 2;

                        const x2 = cx + d;

                        group.setAttribute("transform", `translate(${x2}, ${cy})`);
                        line.setAttribute("x1", cx);
                        line.setAttribute("y1", cy);
                        line.setAttribute("x2", x2);
                        line.setAttribute("y2", cy);

                        // Logic
                        const sumR = r1 + r2; // 100
                        const diffR = Math.abs(r1 - r2); // 20
                        const tolerance = 3;

                        if (d > sumR + tolerance) {
                            status.innerText = "Externas";
                            status.className =
                                "bg-gray-100 text-gray-500 px-3 py-1 rounded-full text-xs font-black uppercase text-center min-w-[100px]";
                        } else if (Math.abs(d - sumR) <= tolerance) {
                            status.innerText = "Tangentes Ext.";
                            status.className =
                                "bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-black uppercase text-center min-w-[100px]";
                        } else if (d < sumR - tolerance && d > diffR + tolerance) {
                            status.innerText = "Secantes";
                            status.className =
                                "bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs font-black uppercase text-center min-w-[100px]";
                        } else if (Math.abs(d - diffR) <= tolerance) {
                            status.innerText = "Tangentes Int.";
                            status.className =
                                "bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-xs font-black uppercase text-center min-w-[100px]";
                        } else if (d < diffR - tolerance) {
                            if (d === 0) status.innerText = "Conc√™ntricas";
                            else status.innerText = "Internas";
                            status.className =
                                "bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-black uppercase text-center min-w-[100px]";
                        }
                    };

                    slider.addEventListener("input", update);
                    // Init with delay to ensure sizing
                    setTimeout(update, 100);
                },

                interactive_angles_circle(container) {
                    let angle = 60; // Central angle

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Central vs Inscrito</h3>

        <div class="relative w-64 h-64 mb-4">
            <svg viewBox="0 0 200 200" class="w-full h-full">
                <circle cx="100" cy="100" r="90" fill="#f8fafc" stroke="#e2e8f0" stroke-width="2" />
                
                <path id="sector-central" d="" fill="rgba(168, 85, 247, 0.1)" stroke="none" />

                <line id="line-c1" x1="100" y1="100" x2="190" y2="100" stroke="#A855F7" stroke-width="2" />
                <line id="line-c2" x1="100" y1="100" x2="100" y2="10" stroke="#A855F7" stroke-width="2" />
                
                <line id="line-i1" x1="10" y1="100" x2="190" y2="100" stroke="#1CB0F6" stroke-width="2" stroke-dasharray="4,2" />
                <line id="line-i2" x1="10" y1="100" x2="100" y2="10" stroke="#1CB0F6" stroke-width="2" stroke-dasharray="4,2" />

                <circle cx="100" cy="100" r="4" fill="#A855F7" /> <circle cx="10" cy="100" r="4" fill="#1CB0F6" /> <circle id="p1" cx="190" cy="100" r="4" fill="#333" />
                <circle id="p2" cx="100" cy="10" r="4" fill="#333" />

                <path id="arc-central" d="" fill="none" stroke="#A855F7" stroke-width="2" />
            </svg>

            <div class="absolute top-1/2 left-1/2 translate-x-2 -translate-y-2 text-brand-purple font-black text-lg" id="lbl-central">60¬∞</div>
            <div class="absolute top-1/2 left-4 -translate-y-2 text-brand-blue font-black text-lg" id="lbl-inscribed">30¬∞</div>
        </div>

        <input type="range" id="ang-slider" min="20" max="160" value="60" class="w-full max-w-xs h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-purple">

        <div class="mt-4 bg-gray-800 text-white p-3 rounded-lg text-center font-mono text-sm">
            <span class="text-brand-blue">Inscrito</span> = <span class="text-brand-purple">Central</span> √∑ 2
        </div>

    </div>
    `;

                    const slider = container.querySelector("#ang-slider");
                    const lineC1 = container.querySelector("#line-c1");
                    const lineC2 = container.querySelector("#line-c2");
                    const lineI1 = container.querySelector("#line-i1");
                    const lineI2 = container.querySelector("#line-i2");
                    const p1 = container.querySelector("#p1");
                    const p2 = container.querySelector("#p2");
                    const sector = container.querySelector("#sector-central");
                    const arc = container.querySelector("#arc-central");
                    const lblC = container.querySelector("#lbl-central");
                    const lblI = container.querySelector("#lbl-inscribed");

                    const update = () => {
                        angle = parseInt(slider.value);
                        // We keep the inscribed vertex at 180 deg (left, x=10, y=100) for easier math visual
                        // The arc opens to the right.
                        // Points P1 and P2 are symmetric around the horizontal axis? Or just one moves?
                        // Let's make P1 and P2 symmetric around 0 deg (Right) so central angle is centered.
                        // Center (100, 100). Radius 90.

                        const halfAngle = angle / 2;
                        const rad1 = -halfAngle * (Math.PI / 180); // Up
                        const rad2 = halfAngle * (Math.PI / 180); // Down

                        const x1 = 100 + 90 * Math.cos(rad1);
                        const y1 = 100 + 90 * Math.sin(rad1);

                        const x2 = 100 + 90 * Math.cos(rad2);
                        const y2 = 100 + 90 * Math.sin(rad2);

                        // Update Central Lines
                        lineC1.setAttribute("x2", x1);
                        lineC1.setAttribute("y2", y1);
                        lineC2.setAttribute("x2", x2);
                        lineC2.setAttribute("y2", y2);

                        // Update Inscribed Lines (Vertex at 10, 100)
                        lineI1.setAttribute("x2", x1);
                        lineI1.setAttribute("y2", y1);
                        lineI2.setAttribute("x2", x2);
                        lineI2.setAttribute("y2", y2);

                        // Update Points
                        p1.setAttribute("cx", x1);
                        p1.setAttribute("cy", y1);
                        p2.setAttribute("cx", x2);
                        p2.setAttribute("cy", y2);

                        // Update Labels
                        lblC.innerText = angle + "¬∞";
                        lblI.innerText = (angle / 2).toFixed(1).replace(".0", "") + "¬∞";

                        // Update Arc/Sector
                        // Path command A rx ry x-axis-rotation large-arc-flag sweep-flag x y
                        const largeArc = angle > 180 ? 1 : 0;
                        const dSector = `M 100 100 L ${x1} ${y1} A 90 90 0 ${largeArc} 1 ${x2} ${y2} Z`;
                        sector.setAttribute("d", dSector);

                        // Small arc near center for angle label
                        const rSmall = 30;
                        const sx1 = 100 + rSmall * Math.cos(rad1);
                        const sy1 = 100 + rSmall * Math.sin(rad1);
                        const sx2 = 100 + rSmall * Math.cos(rad2);
                        const sy2 = 100 + rSmall * Math.sin(rad2);
                        const dArc = `M ${sx1} ${sy1} A ${rSmall} ${rSmall} 0 ${largeArc} 1 ${sx2} ${sy2}`;
                        arc.setAttribute("d", dArc);
                    };

                    slider.oninput = update;
                    update();
                },

                interactive_pi_unroll(container) {
                    let progress = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-4">Descobrindo o Pi (3,14...)</h3>

        <div class="relative w-full h-32 bg-gray-100 border-b-2 border-gray-300 mb-6 overflow-hidden">
            
            <div class="absolute bottom-0 left-0 w-full h-4 flex text-[10px] text-gray-400">
                <div style="left: 10px; position: absolute;">0</div>
                <div style="left: 110px; position: absolute;">1d</div>
                <div style="left: 210px; position: absolute;">2d</div>
                <div style="left: 310px; position: absolute;">3d</div>
                <div style="left: 324px; position: absolute; color: #EA580C; font-weight: bold;">œÄ</div>
            </div>

            <div id="wheel" class="absolute bottom-4 left-[10px] w-[100px] h-[100px] rounded-full border-4 border-brand-blue bg-blue-50 flex items-center justify-center shadow-lg origin-center" style="transform: rotate(0deg);">
                <div class="w-full h-1 bg-brand-blue absolute top-1/2 -mt-0.5"></div> <div class="h-full w-1 bg-brand-blue absolute left-1/2 -ml-0.5"></div>
                <div class="absolute bottom-0 w-2 h-2 bg-brand-orange rounded-full -mb-1"></div> </div>

            <div id="trace-line" class="absolute bottom-4 left-[60px] h-1 bg-brand-orange origin-left opacity-80" style="width: 0px;"></div>

        </div>

        <input type="range" id="roll-slider" min="0" max="314" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-orange">
        
        <p class="text-center mt-4 text-lg font-mono font-bold">
            Comprimento = <span id="pi-val" class="text-brand-orange">0.00</span> √ó Di√¢metro
        </p>

    </div>
    `;

                    const wheel = container.querySelector("#wheel");
                    const slider = container.querySelector("#roll-slider");
                    const val = container.querySelector("#pi-val");
                    const line = container.querySelector("#trace-line");

                    const update = () => {
                        const p = parseInt(slider.value); // 0 to 314 pixels
                        // Diameter is 100px (visual).
                        // Circumference is 314px.
                        // p is distance traveled.

                        wheel.style.left = `${10 + p}px`;

                        // Rotation: distance / radius radians? No, distance / radius.
                        // ArcLength = r * theta -> theta = ArcLength / r
                        // r = 50. p = arc length.
                        // theta (rad) = p / 50.
                        // deg = theta * 180/PI.
                        const deg = (p / 50) * (180 / Math.PI);
                        wheel.style.transform = `rotate(${deg}deg)`;

                        // Update Line
                        line.style.width = `${p}px`;

                        // Update Text
                        const ratio = p / 100; // p / Diameter
                        val.innerText = ratio.toFixed(2);
                    };

                    slider.oninput = update;
                },

                interactive_area_circle_derivation(container) {
                    let step = 0; // 0: Circle, 1: Cut, 2: Arrange

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-green font-bold uppercase text-xs tracking-widest mb-4">A F√≥rmula da Pizza</h3>

        <div class="relative w-64 h-48 flex items-center justify-center mb-6 overflow-hidden">
            
            <div id="slices-container" class="relative w-40 h-40 transition-all duration-1000">
                ${[...Array(8)]
                            .map((_, i) => {
                                const rot = i * 45;
                                return `
                    <div class="pizza-slice absolute w-full h-full rounded-full border-2 border-white transition-all duration-1000 ease-in-out" 
                         style="background: conic-gradient(transparent 0deg, transparent ${rot}deg, #58CC02 ${rot}deg, #58CC02 ${rot + 45
                                    }deg, transparent ${rot + 45}deg); clip-path: circle(50%);">
                    </div>
                    `;
                                // Note: Pure CSS conic gradient slices are hard to animate into rectangle.
                                // Better approach: Use SVG sectors or just simplified CSS transforms with wedge shapes.
                            })
                            .join("")}
                </div>
            
            <svg width="200" height="200" viewBox="0 0 200 200" class="absolute inset-0 transition-all duration-1000" id="pizza-svg">
                <g id="pizza-group" transform="translate(100,100)">
                    ${[...Array(8)]
                            .map((_, i) => {
                                const r = 80;
                                const a1 = (i * 45 * Math.PI) / 180;
                                const a2 = ((i + 1) * 45 * Math.PI) / 180;
                                const x1 = r * Math.cos(a1);
                                const y1 = r * Math.sin(a1);
                                const x2 = r * Math.cos(a2);
                                const y2 = r * Math.sin(a2);
                                const color = i % 2 === 0 ? "#4ADE80" : "#22C55E";
                                return `<path d="M 0 0 L ${x1} ${y1} A ${r} ${r} 0 0 1 ${x2} ${y2} Z" fill="${color}" stroke="white" stroke-width="1" class="pizza-wedge" data-i="${i}" />`;
                            })
                            .join("")}
                </g>
             </svg>
        </div>

        <p id="area-desc" class="text-sm text-center text-gray-600 mb-4 h-12">
            Um c√≠rculo normal. √Årea = ?
        </p>

        <button id="btn-transform-area" class="bg-brand-green text-white font-bold py-3 px-8 rounded-xl shadow-btn active:scale-95 transition-all">
            Cortar e Montar
        </button>

    </div>
    `;

                    // Removing the HTML string mess and using the SVG
                    container.querySelector("#slices-container").style.display = "none";

                    const svgGroup = container.querySelector("#pizza-group");
                    const wedges = container.querySelectorAll(".pizza-wedge");
                    const btn = container.querySelector("#btn-transform-area");
                    const desc = container.querySelector("#area-desc");

                    btn.onclick = () => {
                        if (step === 0) {
                            // Transform to Rectangle
                            wedges.forEach((w, i) => {
                                // Arrange in a row (teeth pattern)
                                // Top row: Indices 0, 2, 4, 6
                                // Bottom row: Indices 1, 3, 5, 7
                                const isTop = i % 2 === 0;
                                const offset = Math.floor(i / 2) * 35 - 50; // Horizontal shift

                                // Rotations: Top point down, Bottom point up
                                // Current rotations in circle are i*45 + 22.5 (center of wedge)
                                // We need to reset rotation and translate

                                // SVG transforms are applied in order.
                                // We need to overwrite the `d` or use transform attribute.
                                // Since they are paths starting at 0,0, translation moves the tip.

                                // Rotation to point Vertical:
                                // Wedge 0 (0-45 deg): Center at 22.5 deg. Needs to rotate to 270 (point down) -> rotate(247.5)?
                                // Easier: Just predefined final positions.

                                // Let's use CSS transforms on the paths if possible, but SVG 1.1 transforms are attributes.
                                // We'll set the style transform for modern browsers.

                                if (isTop) {
                                    w.style.transform = `translate(${offset}px, -40px) rotate(-90deg)`; // Point down? (Actually -90 makes 0-45 point right-up... simpler: visual hack)
                                    // Let's just say "Open" for pedagogical purpose visually
                                } else {
                                    w.style.transform = `translate(${offset}px, 40px) rotate(90deg)`;
                                }

                                // This geometric morph is complex to code perfectly in vanilla JS quickly without a library.
                                // Visual trick: Fade out circle, Fade in Rectangle made of triangles.
                            });

                            // Simplified Logic: Just change the text and show an image overlay or CSS shift if possible.
                            // Let's try a CSS class approach if the SVG allows.

                            svgGroup.style.opacity = "0";
                            setTimeout(() => {
                                svgGroup.innerHTML = `
                    <rect x="-80" y="-30" width="160" height="60" fill="#4ADE80" stroke="white" />
                    <text x="0" y="5" text-anchor="middle" fill="white" font-weight="bold">Ret√¢ngulo</text>
                    <text x="0" y="45" text-anchor="middle" fill="#065f46" font-size="10">Base ‚âà œÄ¬∑r</text>
                    <text x="-90" y="0" text-anchor="middle" fill="#065f46" font-size="10">Altura = r</text>
                `;
                                svgGroup.style.opacity = "1";
                                desc.innerHTML =
                                    "Virou um Ret√¢ngulo!<br>Base ($\\pi \\cdot r$) $\\times$ Altura ($r$) = <strong>$\\pi \\cdot r^2$</strong>";
                                btn.innerText = "Reiniciar";
                                step = 1;
                            }, 500);
                        } else {
                            // Reset
                            svgGroup.style.opacity = "0";
                            setTimeout(() => {
                                // Rebuild circle
                                container.innerHTML = ""; // Cheap reset
                                app.widgets.interactive_area_circle_derivation(container);
                                step = 0;
                            }, 500);
                        }
                    };
                },

                interactive_pfc_lock(container) {
                    // Estado
                    const wheels = [0, 0, 0]; // 3 rodas

                    container.innerHTML = `
    <div class="bg-gray-800 border-4 border-gray-600 rounded-xl p-6 flex flex-col items-center w-full shadow-2xl font-sans select-none relative overflow-hidden">
        
        <h3 class="text-white font-black uppercase text-xs tracking-widest mb-6">Cofre de Combina√ß√µes</h3>

        <div class="flex gap-2 mb-8 bg-black p-4 rounded-lg shadow-inner border border-gray-700">
            ${wheels
                            .map(
                                (_, i) => `
                <div class="flex flex-col items-center gap-2">
                    <button class="w-8 h-6 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded text-xs" onclick="app.widgets.updateLock(${i}, 1)">‚ñ≤</button>
                    <div class="w-12 h-16 bg-white rounded border-2 border-gray-400 flex items-center justify-center text-4xl font-mono font-bold text-gray-800 shadow-[inset_0_2px_5px_rgba(0,0,0,0.3)]" id="wheel-${i}">0</div>
                    <button class="w-8 h-6 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded text-xs" onclick="app.widgets.updateLock(${i}, -1)">‚ñº</button>
                    <span class="text-[10px] text-gray-500 uppercase font-bold">D√≠gito ${i + 1
                                    }</span>
                </div>
            `
                            )
                            .join("")}
        </div>

        <div class="w-full bg-gray-700 rounded-xl p-4 text-center">
            <p class="text-gray-400 text-xs uppercase font-bold mb-2">Total de Senhas Poss√≠veis</p>
            <div class="font-mono text-lg text-white">
                <span class="text-brand-blue">10</span> √ó 
                <span class="text-brand-orange">10</span> √ó 
                <span class="text-brand-green">10</span> = 
                <span class="text-yellow-400 font-black text-2xl animate-pulse">1.000</span>
            </div>
            <p class="text-gray-500 text-[10px] mt-2 italic">Cada roda tem 10 op√ß√µes (0 a 9)</p>
        </div>

    </div>
    `;

                    app.widgets.updateLock = (idx, dir) => {
                        const el = container.querySelector(`#wheel-${idx}`);
                        let val = parseInt(el.innerText);
                        val = (val + dir + 10) % 10; // Loop 0-9
                        el.innerText = val;

                        // Efeito visual de rota√ß√£o
                        el.classList.remove("animate-pop-in");
                        void el.offsetWidth; // Trigger reflow
                        el.classList.add("animate-pop-in");
                    };
                },

                interactive_sample_space_wheel(container) {
                    let sectors = 4; // Inicial

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Roleta de Amostras</h3>

        <div class="relative w-48 h-48 mb-6">
            <svg id="wheel-svg" viewBox="0 0 100 100" class="w-full h-full transform transition-transform duration-[2s] ease-out"></svg>
            <div class="absolute top-0 left-1/2 -translate-x-1/2 -mt-2 text-2xl text-red-500">‚ñº</div>
        </div>

        <div class="flex items-center gap-4 mb-4">
            <button id="btn-less" class="w-8 h-8 rounded-full bg-gray-200 hover:bg-gray-300 font-bold text-gray-600">-</button>
            <div class="text-center">
                <span class="text-xs font-bold text-gray-400 uppercase">Divis√µes</span>
                <div class="text-xl font-black text-brand-text" id="sectors-val">4</div>
            </div>
            <button id="btn-more" class="w-8 h-8 rounded-full bg-gray-200 hover:bg-gray-300 font-bold text-gray-600">+</button>
        </div>

        <div class="w-full bg-blue-50 border border-blue-200 rounded-xl p-3 text-center text-sm">
            <p class="mb-1"><strong class="text-blue-800">Espa√ßo Amostral (Œ©):</strong> <span id="omega-val">4</span> resultados poss√≠veis.</p>
            <p><strong class="text-purple-800">Prob. de cada um:</strong> 1/<span id="prob-val">4</span></p>
        </div>

        <button id="btn-spin" class="mt-4 w-full bg-brand-green text-white font-bold py-2 rounded-xl shadow-btn active:scale-95 transition-all">GIRAR</button>
    </div>
    `;

                    const svg = container.querySelector("#wheel-svg");
                    const secVal = container.querySelector("#sectors-val");
                    const omegaVal = container.querySelector("#omega-val");
                    const probVal = container.querySelector("#prob-val");

                    const colors = [
                        "#FF4B4B",
                        "#1CB0F6",
                        "#58CC02",
                        "#FFC800",
                        "#CE82FF",
                        "#FF9600",
                        "#22C55E",
                        "#3B82F6",
                    ];

                    const drawWheel = () => {
                        secVal.innerText = sectors;
                        omegaVal.innerText = sectors;
                        probVal.innerText = sectors;
                        svg.innerHTML = "";

                        let startAngle = 0;
                        const sliceAngle = 360 / sectors;

                        for (let i = 0; i < sectors; i++) {
                            const endAngle = startAngle + sliceAngle;

                            // Calc path coordinates
                            const x1 =
                                50 + 50 * Math.cos((Math.PI * (startAngle - 90)) / 180);
                            const y1 =
                                50 + 50 * Math.sin((Math.PI * (startAngle - 90)) / 180);
                            const x2 =
                                50 + 50 * Math.cos((Math.PI * (endAngle - 90)) / 180);
                            const y2 =
                                50 + 50 * Math.sin((Math.PI * (endAngle - 90)) / 180);

                            const largeArc = sliceAngle > 180 ? 1 : 0;

                            const path = document.createElementNS(
                                "http://www.w3.org/2000/svg",
                                "path"
                            );
                            path.setAttribute(
                                "d",
                                `M 50 50 L ${x1} ${y1} A 50 50 0 ${largeArc} 1 ${x2} ${y2} Z`
                            );
                            path.setAttribute("fill", colors[i % colors.length]);
                            path.setAttribute("stroke", "white");
                            path.setAttribute("stroke-width", "1");

                            // Text Label
                            const textAngle = startAngle + sliceAngle / 2;
                            const tx =
                                50 + 35 * Math.cos((Math.PI * (textAngle - 90)) / 180);
                            const ty =
                                50 + 35 * Math.sin((Math.PI * (textAngle - 90)) / 180);

                            const text = document.createElementNS(
                                "http://www.w3.org/2000/svg",
                                "text"
                            );
                            text.setAttribute("x", tx);
                            text.setAttribute("y", ty);
                            text.setAttribute("text-anchor", "middle");
                            text.setAttribute("dominant-baseline", "middle");
                            text.setAttribute("fill", "white");
                            text.setAttribute("font-size", "8");
                            text.setAttribute("font-weight", "bold");
                            text.textContent = i + 1;

                            svg.appendChild(path);
                            svg.appendChild(text);

                            startAngle += sliceAngle;
                        }
                    };

                    container.querySelector("#btn-less").onclick = () => {
                        if (sectors > 2) {
                            sectors--;
                            drawWheel();
                        }
                    };
                    container.querySelector("#btn-more").onclick = () => {
                        if (sectors < 8) {
                            sectors++;
                            drawWheel();
                        }
                    };

                    let rotation = 0;
                    container.querySelector("#btn-spin").onclick = () => {
                        rotation += Math.floor(Math.random() * 360 + 720); // 2+ spins
                        svg.style.transform = `rotate(${rotation}deg)`;
                    };

                    drawWheel();
                },

                interactive_probability_cards(container) {
                    // Deck simplificado: 4 naipes x 3 cartas (J, Q, K) + √Ås = 16 cartas para visualiza√ß√£o
                    // Total real 52, mas vamos usar um "mini deck" para o conceito visual ou simular o real matematicamente
                    // Vamos usar a matem√°tica do deck padr√£o (52 cartas)

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Baralho de Laplace</h3>

        <div class="flex gap-4 w-full justify-center mb-6">
            <div class="relative w-24 h-36 bg-white rounded-xl border-2 border-gray-200 shadow-md flex items-center justify-center text-center p-2 group cursor-pointer hover:-translate-y-2 transition-transform" id="card-deck">
                <div class="absolute inset-0 bg-blue-700 rounded-xl m-1 opacity-100 flex items-center justify-center bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')]">
                    <span class="text-white font-bold opacity-50">DECK</span>
                </div>
            </div>
            
            <div class="flex flex-col justify-center gap-2">
                <button class="prob-btn bg-red-100 text-red-600 border border-red-200 px-4 py-2 rounded-lg text-xs font-bold hover:bg-red-200 transition-all text-left" data-target="red">
                    <i class="fas fa-heart"></i> Carta Vermelha
                </button>
                <button class="prob-btn bg-gray-800 text-white border border-gray-600 px-4 py-2 rounded-lg text-xs font-bold hover:bg-gray-700 transition-all text-left" data-target="black">
                    <i class="fas fa-spade"></i> Carta Preta
                </button>
                <button class="prob-btn bg-yellow-100 text-yellow-700 border border-yellow-300 px-4 py-2 rounded-lg text-xs font-bold hover:bg-yellow-200 transition-all text-left" data-target="ace">
                    <strong class="text-lg">A</strong> Tirar um √Ås
                </button>
            </div>
        </div>

        <div id="prob-result" class="w-full bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl p-4 text-center hidden animate-fade-in">
            <p class="text-xs text-gray-500 font-bold uppercase mb-2" id="prob-title">Probabilidade de tirar Vermelha</p>
            
            <div class="flex items-center justify-center gap-4 font-mono text-xl font-bold">
                <div class="flex flex-col items-center">
                    <span class="text-brand-green" id="fav-num">26</span>
                    <div class="w-full h-0.5 bg-gray-400"></div>
                    <span class="text-gray-600">52</span>
                </div>
                <span class="text-gray-400">=</span>
                <span class="text-brand-purple" id="percent-num">50%</span>
            </div>
            <p class="text-xs text-gray-400 mt-2 italic" id="prob-desc">Existem 26 cartas vermelhas no baralho.</p>
        </div>

    </div>
    `;

                    const resultBox = container.querySelector("#prob-result");
                    const title = container.querySelector("#prob-title");
                    const favNum = container.querySelector("#fav-num");
                    const percentNum = container.querySelector("#percent-num");
                    const desc = container.querySelector("#prob-desc");

                    const data = {
                        red: {
                            title: "Carta Vermelha",
                            fav: 26,
                            desc: "Copas (13) + Ouros (13)",
                        },
                        black: {
                            title: "Carta Preta",
                            fav: 26,
                            desc: "Espadas (13) + Paus (13)",
                        },
                        ace: {
                            title: "Tirar um √Ås",
                            fav: 4,
                            desc: "Um √Ås de cada naipe (4 no total)",
                        },
                    };

                    container.querySelectorAll(".prob-btn").forEach((btn) => {
                        btn.onclick = () => {
                            const target = btn.dataset.target;
                            const info = data[target];
                            const pct = ((info.fav / 52) * 100)
                                .toFixed(1)
                                .replace(".0", "");

                            resultBox.classList.remove("hidden");
                            title.innerText = `Probabilidade: ${info.title}`;
                            favNum.innerText = info.fav;
                            percentNum.innerText = `${pct}%`;
                            desc.innerText = info.desc;

                            // Visual reset
                            resultBox.classList.remove("animate-fade-in");
                            void resultBox.offsetWidth;
                            resultBox.classList.add("animate-fade-in");
                        };
                    });
                },

                interactive_central_tendency(container) {
                    // Dados iniciais
                    let data = [2, 5, 5, 8, 10]; // Ordenado para facilitar

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Laborat√≥rio de M√©dias</h3>

        <div class="flex gap-2 items-end h-32 mb-6 w-full justify-center border-b-2 border-gray-200 pb-0 relative" id="blocks-area">
        </div>

        <div class="flex gap-2 mb-6">
            <button class="bg-gray-100 hover:bg-gray-200 text-gray-600 rounded px-3 py-1 text-xs font-bold" onclick="app.widgets.updateData([-5])">- Remover</button>
            <button class="bg-gray-100 hover:bg-gray-200 text-gray-600 rounded px-3 py-1 text-xs font-bold" onclick="app.widgets.updateData([2,3,5,5,8,9,10])">Reset</button>
            <button class="bg-gray-100 hover:bg-gray-200 text-gray-600 rounded px-3 py-1 text-xs font-bold" onclick="app.widgets.updateData([10])">+ Adicionar 10</button>
        </div>

        <div class="grid grid-cols-3 gap-2 w-full">
            <div class="bg-blue-50 border border-blue-200 p-2 rounded-lg text-center">
                <span class="text-[10px] uppercase font-bold text-blue-400">M√©dia</span>
                <div class="text-xl font-black text-brand-blue" id="val-mean">0</div>
            </div>
            <div class="bg-orange-50 border border-orange-200 p-2 rounded-lg text-center">
                <span class="text-[10px] uppercase font-bold text-orange-400">Moda</span>
                <div class="text-xl font-black text-brand-orange" id="val-mode">0</div>
            </div>
            <div class="bg-purple-50 border border-purple-200 p-2 rounded-lg text-center">
                <span class="text-[10px] uppercase font-bold text-purple-400">Mediana</span>
                <div class="text-xl font-black text-brand-purple" id="val-median">0</div>
            </div>
        </div>

    </div>
    `;

                    const blocksArea = container.querySelector("#blocks-area");
                    const valMean = container.querySelector("#val-mean");
                    const valMode = container.querySelector("#val-mode");
                    const valMedian = container.querySelector("#val-median");

                    const render = () => {
                        data.sort((a, b) => a - b);
                        blocksArea.innerHTML = "";

                        // Render Blocks
                        data.forEach((val, idx) => {
                            const h = val * 10; // Scale height
                            const el = document.createElement("div");
                            el.className =
                                "w-8 bg-brand-text text-white text-xs font-bold flex items-end justify-center pb-1 rounded-t transition-all hover:bg-brand-blue relative group animate-pop-in";
                            el.style.height = `${h}px`;
                            el.innerText = val;

                            // Highlight Median Visual
                            const mid = Math.floor(data.length / 2);
                            if (data.length % 2 !== 0 && idx === mid) {
                                el.classList.add("bg-brand-purple"); // Median exact
                            } else if (
                                data.length % 2 === 0 &&
                                (idx === mid || idx === mid - 1)
                            ) {
                                el.classList.add("bg-purple-300"); // Median pair
                            }

                            blocksArea.appendChild(el);
                        });

                        // Calculations
                        const sum = data.reduce((a, b) => a + b, 0);
                        const mean = (sum / data.length).toFixed(1);

                        // Mode
                        const counts = {};
                        data.forEach((x) => {
                            counts[x] = (counts[x] || 0) + 1;
                        });
                        let maxFreq = 0;
                        let modes = [];
                        for (const k in counts) {
                            if (counts[k] > maxFreq) {
                                maxFreq = counts[k];
                                modes = [k];
                            } else if (counts[k] === maxFreq) {
                                modes.push(k);
                            }
                        }
                        const mode = maxFreq > 1 ? modes.join(",") : "N/A";

                        // Median
                        const mid = Math.floor(data.length / 2);
                        const median =
                            data.length % 2 !== 0
                                ? data[mid]
                                : (data[mid - 1] + data[mid]) / 2;

                        valMean.innerText = mean.replace(".", ",");
                        valMode.innerText = mode;
                        valMedian.innerText = median;
                    };

                    app.widgets.updateData = (action) => {
                        if (action.length > 1) {
                            // Reset
                            data = [...action];
                        } else if (action[0] === -5) {
                            // Remove random
                            if (data.length > 2) data.pop();
                        } else {
                            // Add
                            if (data.length < 10) data.push(action[0]);
                        }
                        render();
                    };

                    render();
                },

                interactive_chart_builder_8(container) {
                    // Dados: Evolu√ß√£o da nota em Matem√°tica
                    const dataPoints = [5, 6, 8, 7, 9, 10];
                    const labels = ["Bim 1", "Bim 2", "Bim 3", "Bim 4", "Final", "Rec"]; // Labels fict√≠cios

                    let type = "line";

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex bg-gray-100 p-1 rounded-lg mb-6 w-full max-w-xs">
            <button class="flex-1 py-2 rounded text-xs font-bold uppercase transition-colors bg-white text-brand-blue shadow-sm" onclick="app.widgets.switchChart(this, 'line')">Linhas</button>
            <button class="flex-1 py-2 rounded text-xs font-bold uppercase transition-colors text-gray-400 hover:bg-white" onclick="app.widgets.switchChart(this, 'bar')">Colunas</button>
        </div>

        <div class="relative w-full h-48 border-l-2 border-b-2 border-gray-300 flex items-end justify-between px-2 pt-4 mb-2" id="chart-area">
            <div class="absolute inset-0 flex flex-col justify-between pointer-events-none opacity-20">
                <div class="w-full h-px bg-gray-400"></div>
                <div class="w-full h-px bg-gray-400"></div>
                <div class="w-full h-px bg-gray-400"></div>
                <div class="w-full h-px bg-gray-400"></div>
            </div>
            <div id="chart-bars" class="w-full h-full flex items-end justify-between gap-1 hidden"></div>
            <svg id="chart-line" class="absolute inset-0 w-full h-full overflow-visible"></svg>
        </div>

        <div class="flex justify-between w-full text-[10px] font-bold text-gray-400 uppercase px-2">
            <span>Jan</span><span>Fev</span><span>Mar</span><span>Abr</span><span>Mai</span><span>Jun</span>
        </div>

        <p id="chart-desc" class="mt-4 text-xs font-bold text-center text-brand-blue">
            √ìtimo para ver a evolu√ß√£o ao longo do tempo.
        </p>

    </div>
    `;

                    const barsContainer = container.querySelector("#chart-bars");
                    const svgLine = container.querySelector("#chart-line");
                    const desc = container.querySelector("#chart-desc");
                    const btns = container.querySelectorAll("button");

                    const render = () => {
                        // Clear
                        barsContainer.innerHTML = "";
                        svgLine.innerHTML = "";

                        if (type === "bar") {
                            // Render Bars
                            barsContainer.classList.remove("hidden");
                            svgLine.classList.add("hidden");
                            desc.innerHTML =
                                "√ìtimo para comparar quantidades (quem √© maior?).";
                            desc.className =
                                "mt-4 text-xs font-bold text-center text-brand-orange";

                            dataPoints.forEach((val) => {
                                const h = (val / 10) * 100; // 0-10 scale
                                const bar = document.createElement("div");
                                bar.className =
                                    "flex-1 bg-brand-orange rounded-t opacity-80 hover:opacity-100 transition-all relative group";
                                bar.style.height = `${h}%`;
                                bar.innerHTML = `<span class="absolute -top-5 left-1/2 -translate-x-1/2 text-xs font-bold text-gray-500 opacity-0 group-hover:opacity-100">${val}</span>`;
                                barsContainer.appendChild(bar);
                            });
                        } else {
                            // Render Line SVG
                            barsContainer.classList.add("hidden");
                            svgLine.classList.remove("hidden");
                            desc.innerHTML = "√ìtimo para ver a evolu√ß√£o ao longo do tempo.";
                            desc.className =
                                "mt-4 text-xs font-bold text-center text-brand-blue";

                            // Calculate points
                            // Width is dynamic, assume 100% coord space roughly
                            // Let's use relative coordinates logic
                            const w = svgLine.clientWidth;
                            const h = svgLine.clientHeight;
                            const stepX = w / (dataPoints.length - 1);

                            let points = "";
                            let circles = "";

                            dataPoints.forEach((val, i) => {
                                const x = i * stepX;
                                const y = h - (val / 10) * h; // Invert Y
                                points += `${x},${y} `;
                                circles += `<circle cx="${x}" cy="${y}" r="4" fill="#1CB0F6" stroke="white" stroke-width="2" />`;
                            });

                            svgLine.innerHTML = `
                <polyline points="${points}" fill="none" stroke="#1CB0F6" stroke-width="3" />
                ${circles}
            `;
                        }
                    };

                    app.widgets.switchChart = (el, t) => {
                        type = t;
                        // Visual toggle
                        btns.forEach((b) => {
                            b.className =
                                "flex-1 py-2 rounded text-xs font-bold uppercase transition-colors text-gray-400 hover:bg-white";
                        });
                        el.className = `flex-1 py-2 rounded text-xs font-bold uppercase transition-colors bg-white ${t === "line" ? "text-brand-blue" : "text-brand-orange"
                            } shadow-sm`;

                        render();
                    };

                    // Need delay for SVG width calc
                    setTimeout(render, 100);
                },

                interactive_dispersion_target(container) {
                    let spread = 1; // 0=Baixo (concentrado), 2=Alto (disperso)

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <h3 class="text-brand-red font-bold uppercase text-xs tracking-widest mb-2">Visualizando o Desvio</h3>
        <p class="text-xs text-gray-400 mb-6 text-center">Imagine flechas acertando um alvo.</p>

        <div class="relative w-48 h-48 bg-gray-100 rounded-full border-4 border-gray-300 flex items-center justify-center mb-6 shadow-inner overflow-hidden">
            <div class="absolute w-32 h-32 rounded-full border-2 border-gray-200"></div>
            <div class="absolute w-16 h-16 rounded-full border-2 border-red-200 bg-red-50"></div>
            <div class="absolute w-2 h-2 rounded-full bg-brand-red z-10"></div> <div id="shots-layer" class="absolute inset-0 transition-all duration-500">
            </div>
        </div>

        <div class="w-full max-w-xs flex flex-col gap-2">
            <div class="flex justify-between text-xs font-bold uppercase">
                <span class="text-brand-green">Consistente (Baixo Desvio)</span>
                <span class="text-brand-red">Inconstante (Alto Desvio)</span>
            </div>
            <input type="range" id="spread-slider" min="0" max="100" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-gray-600">
        </div>

        <div class="mt-4 p-3 bg-gray-50 rounded-xl border border-gray-200 text-center w-full">
            <p class="text-[10px] text-gray-400 font-bold uppercase">An√°lise</p>
            <p class="text-sm font-bold text-gray-700" id="disp-msg">Dispers√£o M√©dia</p>
        </div>

    </div>
    `;

                    const layer = container.querySelector("#shots-layer");
                    const slider = container.querySelector("#spread-slider");
                    const msg = container.querySelector("#disp-msg");

                    const generateShots = () => {
                        layer.innerHTML = "";
                        const val = parseInt(slider.value);
                        // Max radius deviation based on slider
                        // 0 slider -> 10px deviation
                        // 100 slider -> 90px deviation
                        const maxDev = 10 + val * 0.8;

                        // Generate 10 shots
                        for (let i = 0; i < 10; i++) {
                            // Random polar coordinates
                            const r = Math.random() * maxDev; // Distance from center
                            const theta = Math.random() * 2 * Math.PI;

                            const x = 96 + r * Math.cos(theta); // 96 is center (half of 192/48rem? No, 48 w = 12rem = 192px approx. Let's rely on percent or center offset)
                            // Center is 50% 50%.
                            // Let's use percent to be safe.
                            // maxDev in percent. 100% width = 192px.
                            // maxDev 90px ~ 45%.

                            const xPct = 50 + ((r * Math.cos(theta)) / 96) * 50;
                            const yPct = 50 + ((r * Math.sin(theta)) / 96) * 50;

                            const shot = document.createElement("div");
                            shot.className =
                                "absolute w-2 h-2 bg-black rounded-full transform -translate-x-1/2 -translate-y-1/2 animate-pop-in opacity-80";
                            shot.style.left = `${xPct}%`;
                            shot.style.top = `${yPct}%`;
                            shot.style.animationDelay = `${i * 0.05}s`;

                            layer.appendChild(shot);
                        }

                        // Message
                        if (val < 20) {
                            msg.innerText = "Alta Precis√£o! Desvio Padr√£o Baixo.";
                            msg.className = "text-sm font-bold text-brand-green";
                        } else if (val > 80) {
                            msg.innerText = "Muito Espalhado! Desvio Padr√£o Alto.";
                            msg.className = "text-sm font-bold text-brand-red";
                        } else {
                            msg.innerText = "Dispers√£o M√©dia.";
                            msg.className = "text-sm font-bold text-gray-700";
                        }
                    };

                    slider.addEventListener("input", generateShots); // Update on drag
                    generateShots();
                },

                interactive_sets_venn(container) {
                    // Configura√ß√£o
                    let score = 0;
                    const nums = [
                        { txt: "2", type: "N" },
                        { txt: "-5", type: "Z" },
                        { txt: "0,5", type: "Q" },
                        { txt: "œÄ", type: "I" },
                        { txt: "‚àö2", type: "I" },
                        { txt: "-3/4", type: "Q" },
                        { txt: "0", type: "N" }, // Pedagogicamente N inclui 0 na BNCC geralmente
                        { txt: "1,333...", type: "Q" },
                    ];
                    let currentIdx = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-4 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden relative">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Organize os N√∫meros</h3>

        <div class="relative w-[300px] h-[300px] mb-4">
            <div class="absolute inset-0 border-4 border-gray-300 rounded-xl bg-gray-50 flex items-end justify-end p-2">
                <span class="text-gray-400 font-black text-2xl">R</span>
            </div>

            <div class="absolute top-4 right-4 w-24 h-24 bg-purple-100 border-2 border-purple-300 rounded-full flex items-center justify-center drop-zone" data-type="I">
                <span class="text-purple-400 font-black opacity-50">I</span>
            </div>

            <div class="absolute top-4 left-4 w-48 h-64 bg-blue-100 border-2 border-blue-300 rounded-[3rem] flex flex-col items-center pt-4 drop-zone" data-type="Q">
                <span class="text-blue-400 font-black opacity-50 absolute top-2 left-4">Q</span>
                
                <div class="w-36 h-48 bg-orange-100 border-2 border-orange-300 rounded-[2.5rem] flex flex-col items-center pt-4 mt-6 drop-zone" data-type="Z">
                    <span class="text-orange-400 font-black opacity-50 absolute top-2 left-4">Z</span>
                    
                    <div class="w-24 h-24 bg-green-100 border-2 border-green-300 rounded-full flex items-center justify-center mt-6 drop-zone" data-type="N">
                        <span class="text-green-400 font-black opacity-50">N</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="drag-source" class="h-16 w-full flex items-center justify-center mb-2">
            </div>

        <div id="set-feedback" class="h-6 text-xs font-bold text-center text-brand-text">Arraste o n√∫mero para o menor conjunto poss√≠vel!</div>

    </div>
    `;

                    const source = container.querySelector("#drag-source");
                    const feedback = container.querySelector("#set-feedback");
                    const dropZones = container.querySelectorAll(".drop-zone");

                    const loadNext = () => {
                        if (currentIdx >= nums.length) {
                            source.innerHTML = `<div class="text-brand-green font-black text-xl animate-bounce">Conclu√≠do!</div>`;
                            return;
                        }

                        const n = nums[currentIdx];
                        const el = document.createElement("div");
                        el.className =
                            "w-12 h-12 bg-white border-2 border-brand-text rounded-full flex items-center justify-center font-bold text-lg shadow-lg cursor-grab active:cursor-grabbing animate-pop-in z-50";
                        el.innerText = n.txt;
                        el.draggable = true; // Simple drag logic setup needed or touch events

                        // Touch/Mouse logic simplified for "click to select, click to drop" in widgets to avoid complex DnD code in single file
                        // OR better: Simple buttons below for selection
                        source.innerHTML = "";
                        source.appendChild(el);

                        // Add selection logic
                        el.onclick = () => {
                            el.classList.add("ring-4", "ring-brand-yellow");
                            feedback.innerText = "Agora clique na caixa correta!";
                        };
                    };

                    // Click based interaction for mobile compatibility
                    dropZones.forEach((zone) => {
                        zone.onclick = (e) => {
                            e.stopPropagation(); // Prevent bubbling to parent zones
                            if (currentIdx >= nums.length) return;

                            const n = nums[currentIdx];
                            const targetType = zone.dataset.type;

                            // Logic: N is inside Z, Z inside Q.
                            // Correct if user clicks exactly the type OR a parent?
                            // Instruction says "menor conjunto poss√≠vel".
                            // So: 2 is N. Clicking Z is technically true but not precise. Clicking Q is true but imprecise.
                            // Let's require exact match for gamification challenge.

                            if (n.type === targetType) {
                                // Correct
                                feedback.innerText = "Correto!";
                                feedback.className =
                                    "h-6 text-xs font-bold text-center text-brand-green";

                                // Visual move
                                const numEl = document.createElement("span");
                                numEl.innerText = n.txt;
                                numEl.className =
                                    "font-bold text-sm text-gray-700 absolute animate-pop-in";
                                // Random position inside
                                numEl.style.left = Math.random() * 50 + 20 + "%";
                                numEl.style.top = Math.random() * 50 + 20 + "%";
                                zone.appendChild(numEl);

                                currentIdx++;
                                loadNext();
                            } else {
                                feedback.innerText =
                                    "Tente ser mais espec√≠fico ou escolha o grupo correto.";
                                feedback.className =
                                    "h-6 text-xs font-bold text-center text-brand-red animate-shake";
                                setTimeout(
                                    () => feedback.classList.remove("animate-shake"),
                                    500
                                );
                            }
                        };
                    });

                    loadNext();
                },

                interactive_exponent_sun_shadow(container) {
                    let expN = 3;
                    let expD = 4; // 4th root of x^3

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-6">Regra do Sol e Sombra</h3>

        <div class="flex items-center gap-2 mb-8">
            <span class="text-6xl font-black text-brand-text">x</span>
            <div class="flex flex-col items-center -mt-8 ml-1">
                <input type="number" id="in-n" value="${expN}" class="w-10 text-center border-2 border-brand-orange rounded font-bold text-lg bg-orange-50 text-brand-orange outline-none">
                <div class="w-full h-0.5 bg-gray-400 my-1"></div>
                <input type="number" id="in-d" value="${expD}" min="2" class="w-10 text-center border-2 border-brand-purple rounded font-bold text-lg bg-purple-50 text-brand-purple outline-none">
            </div>
            
            <div class="text-3xl absolute ml-20 -mt-16 animate-spin-slow">‚òÄÔ∏è</div>
        </div>

        <div class="text-3xl text-gray-300 mb-6"><i class="fas fa-arrow-down"></i> Transforma <i class="fas fa-arrow-down"></i></div>

        <div class="flex items-center relative">
            <span class="text-brand-purple font-black text-2xl absolute -left-4 -top-2" id="out-index">${expD}</span>
            <span class="text-6xl text-gray-400 font-light">‚àö</span>
            <div class="border-t-4 border-gray-400 w-16 absolute left-6 top-1"></div>
            
            <div class="flex items-start ml-2">
                <span class="text-6xl font-black text-brand-text">x</span>
                <span class="text-3xl font-bold text-brand-orange mt-1" id="out-power">${expN}</span>
            </div>
            
            <div class="text-2xl absolute left-8 -top-8 text-blue-400">‚òÇÔ∏è</div>
        </div>

        <div class="mt-8 text-center text-sm text-gray-500 bg-gray-50 p-3 rounded-xl border border-gray-200">
            O <strong class="text-brand-orange">${expN}</strong> estava no Sol, foi para a Sombra.<br>
            O <strong class="text-brand-purple">${expD}</strong> estava na Sombra, foi para o Sol.
        </div>

    </div>
    `;

                    const inN = container.querySelector("#in-n");
                    const inD = container.querySelector("#in-d");
                    const outIndex = container.querySelector("#out-index");
                    const outPower = container.querySelector("#out-power");
                    const textDiv = container.querySelector(".bg-gray-50");

                    const update = () => {
                        const n = inN.value;
                        const d = inD.value;

                        outIndex.innerText = d;
                        outPower.innerText = n;

                        textDiv.innerHTML = `
            O <strong class="text-brand-orange">${n}</strong> estava no Sol, foi para a Sombra.<br>
            O <strong class="text-brand-purple">${d}</strong> estava na Sombra, foi para o Sol.
        `;
                    };

                    inN.oninput = update;
                    inD.oninput = update;
                },

                interactive_scientific_notation_slider(container) {
                    let power = 0; // 10^0

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Conversor Cient√≠fico</h3>

        <div class="w-full bg-black rounded-xl p-6 text-center mb-6 overflow-hidden relative shadow-inner">
            <p class="text-xs text-gray-500 uppercase font-bold mb-2">N√∫mero Decimal</p>
            <div class="text-brand-green font-mono text-xl md:text-3xl break-all font-bold transition-all" id="decimal-disp">
                1.2
            </div>
        </div>

        <div class="flex items-center gap-4 w-full justify-center mb-6">
            <div class="text-2xl font-mono font-bold text-gray-700">
                1,2 √ó 10
            </div>
            <div class="flex flex-col items-center">
                <input type="number" id="exp-input" value="0" class="w-16 text-center border-2 border-brand-blue rounded-lg p-2 font-bold text-xl outline-none text-brand-blue">
                <span class="text-[10px] text-gray-400 font-bold uppercase">Expoente</span>
            </div>
        </div>

        <input type="range" id="sci-slider" min="-9" max="9" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue">
        
        <div class="flex justify-between w-full text-xs text-gray-400 font-bold mt-2 uppercase">
            <span>Micro</span>
            <span>Padr√£o</span>
            <span>Giga</span>
        </div>

    </div>
    `;

                    const slider = container.querySelector("#sci-slider");
                    const input = container.querySelector("#exp-input");
                    const disp = container.querySelector("#decimal-disp");

                    const update = (val) => {
                        const p = parseInt(val);
                        input.value = p;
                        slider.value = p;

                        // Calculate visual number
                        // Base 1.2
                        let numStr = "";

                        if (p === 0) {
                            numStr = "1,2";
                        } else if (p > 0) {
                            // Move right
                            // 1.2 * 10^1 = 12
                            // 1.2 * 10^2 = 120
                            // Logic: Remove dot, pad zeros
                            const zeros = p - 1;
                            if (zeros < 0)
                                numStr = "12".slice(0, p + 1) + "," + "12".slice(p + 1);
                            // Edge case not hit with 1.2 base
                            else numStr = "12" + "0".repeat(zeros);
                        } else {
                            // Move left
                            // 1.2 * 10^-1 = 0.12
                            // 1.2 * 10^-2 = 0.012
                            const zeros = Math.abs(p) - 1; // Zeros after dot before number
                            numStr = "0," + "0".repeat(zeros) + "12";
                        }

                        disp.innerText = numStr;

                        // Visual feedback on size
                        if (p > 6)
                            disp.className =
                                "text-brand-green font-mono text-xl break-all font-bold";
                        else if (p < -6)
                            disp.className =
                                "text-brand-green font-mono text-xl break-all font-bold";
                        else
                            disp.className =
                                "text-brand-green font-mono text-3xl break-all font-bold";
                    };

                    slider.oninput = (e) => update(e.target.value);
                    input.oninput = (e) => update(e.target.value);
                },

                interactive_radical_jailbreak(container) {
                    // Number: 75 = 3 * 5^2. Index 2.
                    // Factor state: Inside [3, 5, 5]

                    let inside = [3, 5, 5];
                    let outside = [];
                    let index = 2; // Square root

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-red font-bold uppercase text-xs tracking-widest mb-6">Fuga da Pris√£o ‚àö75</h3>

        <div class="flex items-center gap-2 text-4xl font-bold mb-8">
            <div id="outside-zone" class="flex gap-1 text-brand-blue">
                <span class="text-gray-300 text-sm self-center mr-2">Livres:</span>
            </div>
            
            <div class="relative flex items-center">
                <span class="text-gray-400 font-light text-6xl">‚àö</span>
                <div class="border-t-4 border-gray-400 absolute left-8 top-0 w-32"></div>
                
                <div id="inside-zone" class="flex gap-2 ml-2 p-2 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 min-w-[100px] justify-center">
                    </div>
            </div>
        </div>

        <p class="text-center text-sm text-gray-500 mb-4">
            Agrupe os n√∫meros iguais para pagar a fian√ßa (par).
        </p>

        <button id="btn-group" class="bg-brand-red text-white font-bold py-3 px-8 rounded-xl shadow-btn active:scale-95 transition-all mb-4">
            Agrupar Pares (5, 5)
        </button>
        
        <div id="jail-feedback" class="h-6 font-bold text-center text-sm text-brand-green"></div>

    </div>
    `;

                    const inZone = container.querySelector("#inside-zone");
                    const outZone = container.querySelector("#outside-zone");
                    const btn = container.querySelector("#btn-group");
                    const fb = container.querySelector("#jail-feedback");

                    const render = () => {
                        inZone.innerHTML = inside
                            .map(
                                (n) =>
                                    `<div class="w-8 h-8 bg-red-100 text-red-600 rounded flex items-center justify-center text-lg shadow-sm border border-red-200">${n}</div>`
                            )
                            .join("");

                        // Render outside (product)
                        if (outside.length > 0) {
                            const prod = outside.reduce((a, b) => a * b, 1);
                            outZone.innerHTML = `<span class="text-4xl font-black">${prod}</span>`;
                        } else {
                            outZone.innerHTML = `<span class="text-gray-300 text-sm self-center mr-2">Livres:</span>`;
                        }
                    };

                    btn.onclick = () => {
                        // Check for pairs
                        // Simple logic for 75 (3, 5, 5)
                        if (inside.filter((x) => x === 5).length >= 2) {
                            // Animate
                            inZone.innerHTML = `
                <div class="w-8 h-8 bg-red-100 text-red-600 rounded flex items-center justify-center text-lg opacity-50">3</div>
                <div class="w-16 h-8 bg-green-100 text-green-600 rounded flex items-center justify-center text-lg border-2 border-green-400 animate-pulse">5¬≤</div>
            `;

                            setTimeout(() => {
                                inside = [3];
                                outside.push(5);
                                render();
                                btn.disabled = true;
                                btn.classList.add("opacity-50", "cursor-not-allowed");
                                btn.innerText = "Fuga Conclu√≠da!";
                                fb.innerText = "O 5 pagou a fian√ßa e saiu da raiz!";
                            }, 1000);
                        }
                    };

                    render();
                },

                interactive_rationalization_cleaner(container) {
                    let step = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-green font-bold uppercase text-xs tracking-widest mb-6">Limpeza de Denominador</h3>

        <div class="text-4xl font-mono font-bold mb-8 flex items-center gap-4 transition-all" id="math-stage">
            <div class="flex flex-col items-center">
                <span>1</span>
                <div class="w-full h-1 bg-black my-1"></div>
                <span class="text-red-500 animate-pulse">‚àö2</span>
            </div>
        </div>

        <button id="btn-action-rat" class="bg-brand-blue text-white font-bold py-3 px-8 rounded-xl shadow-btn active:scale-95 transition-all flex items-center gap-2">
            <i class="fas fa-spray-can"></i> Multiplicar pelo Espelho
        </button>

        <p id="rat-desc" class="mt-4 text-sm text-gray-500 text-center">
            A raiz n√£o pode ficar no ch√£o!
        </p>

    </div>
    `;

                    const stage = container.querySelector("#math-stage");
                    const btn = container.querySelector("#btn-action-rat");
                    const desc = container.querySelector("#rat-desc");

                    btn.onclick = () => {
                        if (step === 0) {
                            // Show multiplication
                            stage.innerHTML = `
                <div class="flex flex-col items-center">
                    <span>1</span>
                    <div class="w-full h-1 bg-black my-1"></div>
                    <span class="text-red-500">‚àö2</span>
                </div>
                <span class="text-gray-400 text-2xl">√ó</span>
                <div class="flex flex-col items-center animate-pop-in">
                    <span class="text-brand-blue">‚àö2</span>
                    <div class="w-full h-1 bg-black my-1"></div>
                    <span class="text-brand-blue">‚àö2</span>
                </div>
            `;
                            desc.innerHTML =
                                "Multiplicamos em cima e embaixo por <strong class='text-brand-blue'>‚àö2</strong> (que vale 1).";
                            btn.innerHTML = "Resolver";
                            step = 1;
                        } else if (step === 1) {
                            // Solve
                            stage.innerHTML = `
                <div class="flex flex-col items-center">
                    <span class="text-brand-blue">‚àö2</span>
                    <div class="w-full h-1 bg-black my-1"></div>
                    <span class="text-brand-green font-black animate-bounce">2</span>
                </div>
            `;
                            desc.innerHTML =
                                "<strong class='text-brand-green'>Pronto!</strong> ‚àö2 √ó ‚àö2 virou 2. O ch√£o est√° limpo.";
                            btn.classList.add("hidden");
                        }
                    };
                },

                interactive_coeff_identifier(container) {
                    // Exemplo: 2x¬≤ - 5x + 3 = 0
                    let a = 2,
                        b = -5,
                        c = 3;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Laborat√≥rio de Coeficientes</h3>
        
        <div class="bg-gray-50 border-2 border-gray-200 rounded-xl p-4 mb-6 w-full text-center">
            <div class="text-3xl md:text-4xl font-mono font-black text-gray-700 transition-all" id="eq-display">
                <span class="text-brand-purple">2</span>x¬≤ <span class="text-brand-blue">- 5</span>x <span class="text-brand-orange">+ 3</span> = 0
            </div>
        </div>

        <div class="flex flex-col gap-4 w-full max-w-sm">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-full bg-purple-100 text-brand-purple font-bold flex items-center justify-center text-xs">a</div>
                <input type="range" id="slider-a" min="-5" max="5" value="2" step="1" class="flex-1 h-2 bg-purple-100 rounded-lg accent-brand-purple cursor-pointer">
                <span id="val-a" class="w-8 text-center font-bold text-brand-purple">2</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-full bg-blue-100 text-brand-blue font-bold flex items-center justify-center text-xs">b</div>
                <input type="range" id="slider-b" min="-10" max="10" value="-5" step="1" class="flex-1 h-2 bg-blue-100 rounded-lg accent-brand-blue cursor-pointer">
                <span id="val-b" class="w-8 text-center font-bold text-brand-blue">-5</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-full bg-orange-100 text-brand-orange font-bold flex items-center justify-center text-xs">c</div>
                <input type="range" id="slider-c" min="-10" max="10" value="3" step="1" class="flex-1 h-2 bg-orange-100 rounded-lg accent-brand-orange cursor-pointer">
                <span id="val-c" class="w-8 text-center font-bold text-brand-orange">3</span>
            </div>
        </div>

        <div class="mt-4 text-xs font-bold text-red-500 hidden" id="warn-a">
            ‚ö†Ô∏è O coeficiente "a" n√£o pode ser zero! (Sen√£o vira equa√ß√£o do 1¬∫ grau)
        </div>

    </div>
    `;

                    const sA = container.querySelector("#slider-a");
                    const sB = container.querySelector("#slider-b");
                    const sC = container.querySelector("#slider-c");
                    const display = container.querySelector("#eq-display");
                    const warn = container.querySelector("#warn-a");

                    const update = () => {
                        a = parseInt(sA.value);
                        b = parseInt(sB.value);
                        c = parseInt(sC.value);

                        container.querySelector("#val-a").innerText = a;
                        container.querySelector("#val-b").innerText = b;
                        container.querySelector("#val-c").innerText = c;

                        // Formata Sinais
                        const signB = b >= 0 ? "+" : "";
                        const signC = c >= 0 ? "+" : "";

                        // HTML Colorido
                        display.innerHTML = `
            <span class="text-brand-purple">${a}</span>x¬≤ 
            <span class="text-brand-blue">${signB} ${b}</span>x 
            <span class="text-brand-orange">${signC} ${c}</span> = 0
        `;

                        if (a === 0) {
                            warn.classList.remove("hidden");
                            display.classList.add("opacity-50");
                        } else {
                            warn.classList.add("hidden");
                            display.classList.remove("opacity-50");
                        }
                    };

                    sA.oninput = update;
                    sB.oninput = update;
                    sC.oninput = update;
                    update();
                },

                interactive_complete_square_geo(container) {
                    // x^2 + 6x = ?
                    // Lado do quadrado = x.
                    // Retangulos = 6x. Divididos em dois de 3x.
                    // Falta o quadrado de 3x3 = 9.

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-4 flex flex-col items-center w-full h-full shadow-sm font-sans select-none overflow-hidden relative">
        
        <div class="flex gap-1 items-end justify-center transition-all duration-1000" id="geo-stage">
            <div class="bg-blue-200 border-2 border-brand-blue flex items-center justify-center font-bold text-brand-blue w-24 h-24 relative" id="sq-main">
                x¬≤
                <span class="absolute -left-4 text-xs text-gray-400">x</span>
                <span class="absolute -top-4 text-xs text-gray-400">x</span>
            </div>

            <div class="flex flex-col gap-1" id="rect-group">
                <div class="bg-orange-200 border-2 border-brand-orange flex items-center justify-center font-bold text-brand-orange w-8 h-24 transition-all duration-700" id="rect-1">
                    3x
                </div>
                <div class="bg-orange-200 border-2 border-brand-orange flex items-center justify-center font-bold text-brand-orange w-8 h-24 transition-all duration-700" id="rect-2">
                    3x
                </div>
            </div>
            
            <div id="missing-piece" class="absolute w-8 h-8 border-2 border-dashed border-red-400 bg-red-50 flex items-center justify-center text-xs font-bold text-red-400 opacity-0 transition-all duration-700">
                ?
            </div>
        </div>

        <button id="btn-anim-sq" class="mt-4 bg-brand-blue text-white font-bold py-2 px-6 rounded-lg shadow-btn active:scale-95">
            Completar Quadrado
        </button>

        <p id="geo-explain" class="text-xs text-gray-500 mt-2 font-bold text-center">Temos $x^2 + 6x$. Como formar um quadrado perfeito?</p>

    </div>
    `;

                    const btn = container.querySelector("#btn-anim-sq");
                    const r1 = container.querySelector("#rect-1");
                    const r2 = container.querySelector("#rect-2");
                    const group = container.querySelector("#rect-group");
                    const missing = container.querySelector("#missing-piece");
                    const explain = container.querySelector("#geo-explain");
                    let state = 0;

                    btn.onclick = () => {
                        if (state === 0) {
                            // Passo 1: Separar os ret√¢ngulos
                            // R1 fica na direita. R2 vai para baixo.
                            // Para simplificar no DOM, vamos usar absolute positioning ou transform
                            // Vamos hackear visualmente:

                            // O container do rect-group precisa permitir que r2 saia
                            group.style.display = "block"; // Tira do flex
                            r1.style.position = "absolute";
                            r1.style.left = "100px"; // Ao lado do quadrado azul (que tem w-24 = 96px aprox + gap)
                            r1.style.top = "0";

                            // O quadrado azul est√° num container flex. Precisamos de coordenadas relativas ao stage.
                            // Vamos simplificar: transformar o stage em relative
                            const stage = container.querySelector("#geo-stage");
                            stage.innerHTML = `
                <div class="relative w-32 h-32">
                    <div class="absolute top-0 left-0 w-24 h-24 bg-blue-200 border-2 border-brand-blue flex items-center justify-center font-bold text-brand-blue">x¬≤</div>
                    <div class="absolute top-0 left-24 w-8 h-24 bg-orange-200 border-2 border-brand-orange flex items-center justify-center font-bold text-brand-orange text-xs">3x</div>
                    <div class="absolute top-24 left-0 w-24 h-8 bg-orange-200 border-2 border-brand-orange flex items-center justify-center font-bold text-brand-orange text-xs">3x</div>
                    <div class="absolute top-24 left-24 w-8 h-8 bg-red-100 border-2 border-dashed border-red-500 flex items-center justify-center font-bold text-red-500 text-xs animate-pulse">9</div>
                </div>
            `;

                            explain.innerHTML =
                                "Dividimos o $6x$ em dois de $3x$. Colocamos um do lado e um embaixo. <br>Falta um quadrado de $3 \\times 3 = 9$!";
                            btn.innerText = "Reiniciar";
                            state = 1;
                        } else {
                            // Reset (reconstroi o HTML original do widget)
                            app.widgets.interactive_complete_square_geo(container);
                        }
                    };
                },

                interactive_incomplete_solver(container) {
                    const types = ["c", "b"]; // Falta c, Falta b
                    let currentType = "c";

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex bg-gray-100 p-1 rounded-lg mb-4 w-full max-w-xs">
            <button class="flex-1 py-2 rounded text-xs font-bold uppercase transition-colors bg-white text-brand-blue shadow-sm" onclick="app.widgets.toggleIncType(this, 'c')">Falta b (ax¬≤ + c = 0)</button>
            <button class="flex-1 py-2 rounded text-xs font-bold uppercase transition-colors text-gray-400 hover:bg-white" onclick="app.widgets.toggleIncType(this, 'b')">Falta c (ax¬≤ + bx = 0)</button>
        </div>

        <div id="solver-stage" class="w-full text-center">
            </div>

    </div>
    `;

                    const stage = container.querySelector("#solver-stage");

                    const render = () => {
                        if (currentType === "c") {
                            // ax^2 + c = 0 (Falta b)
                            stage.innerHTML = `
                <div class="font-mono text-2xl font-bold mb-4">2x¬≤ - 32 = 0</div>
                
                <div class="flex flex-col gap-2 items-center text-sm">
                    <div class="bg-gray-50 p-2 rounded w-full border border-gray-200 animate-slide-up" style="animation-delay: 0.1s">
                        1. Isolar $x^2$: <br> 
                        <span class="font-bold text-brand-blue">2x¬≤ = 32</span>
                    </div>
                    <div class="bg-gray-50 p-2 rounded w-full border border-gray-200 animate-slide-up" style="animation-delay: 0.3s">
                        2. Dividir: <br> 
                        <span class="font-bold text-brand-blue">x¬≤ = 16</span>
                    </div>
                    <div class="bg-gray-50 p-2 rounded w-full border border-gray-200 animate-slide-up" style="animation-delay: 0.5s">
                        3. Raiz Quadrada: <br> 
                        <span class="font-black text-brand-green text-lg">x = ¬±4</span>
                    </div>
                </div>
            `;
                        } else {
                            // ax^2 + bx = 0 (Falta c)
                            stage.innerHTML = `
                <div class="font-mono text-2xl font-bold mb-4">3x¬≤ + 12x = 0</div>
                
                <div class="flex flex-col gap-2 items-center text-sm">
                    <div class="bg-gray-50 p-2 rounded w-full border border-gray-200 animate-slide-up" style="animation-delay: 0.1s">
                        1. Fator Comum (x): <br> 
                        <span class="font-bold text-brand-orange">x ¬∑ (3x + 12) = 0</span>
                    </div>
                    <div class="bg-gray-50 p-2 rounded w-full border border-gray-200 animate-slide-up" style="animation-delay: 0.3s">
                        2. Separa em dois caminhos:
                    </div>
                    <div class="flex gap-2 w-full">
                        <div class="flex-1 bg-green-50 border border-green-200 p-2 rounded font-bold text-brand-green animate-pop-in">
                            x = 0
                        </div>
                        <div class="flex-1 bg-blue-50 border border-blue-200 p-2 rounded animate-pop-in">
                            3x + 12 = 0 <br>
                            3x = -12 <br>
                            <span class="font-bold text-brand-blue">x = -4</span>
                        </div>
                    </div>
                </div>
            `;
                        }
                        if (window.renderMathInElement) renderMathInElement(stage);
                    };

                    app.widgets.toggleIncType = (btn, type) => {
                        currentType = type;
                        const btns = container.querySelectorAll("button");
                        btns.forEach(
                            (b) =>
                            (b.className =
                                "flex-1 py-2 rounded text-xs font-bold uppercase transition-colors text-gray-400 hover:bg-white")
                        );
                        btn.className =
                            "flex-1 py-2 rounded text-xs font-bold uppercase transition-colors bg-white text-brand-blue shadow-sm";
                        render();
                    };

                    render();
                },

                interactive_discriminant_roots(container) {
                    let delta = 1; // > 0

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-4">O Sem√°foro do Delta</h3>

        <div class="relative w-64 h-40 bg-gray-50 border border-gray-200 rounded-xl mb-4 overflow-hidden">
            <div class="absolute top-1/2 left-0 w-full h-0.5 bg-gray-400"></div>
            
            <svg viewBox="0 0 100 100" class="absolute inset-0 w-full h-full" preserveAspectRatio="none">
                <path id="para-curve" d="M 0 0 Q 50 100 100 0" fill="none" stroke="#EA580C" stroke-width="3" />
            </svg>
            
            <div id="root-points" class="absolute inset-0">
                <div class="absolute w-3 h-3 bg-brand-blue rounded-full top-[calc(50%-6px)] left-[20%]" id="root-1"></div>
                <div class="absolute w-3 h-3 bg-brand-blue rounded-full top-[calc(50%-6px)] right-[20%]" id="root-2"></div>
            </div>
        </div>

        <div class="flex flex-col w-full max-w-xs gap-4">
            <input type="range" id="delta-slider" min="-1" max="1" step="1" value="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-orange">
            
            <div class="flex justify-between text-xs font-bold uppercase">
                <span class="text-red-500">Negativo</span>
                <span class="text-yellow-600">Zero</span>
                <span class="text-green-600">Positivo</span>
            </div>

            <div class="text-center font-black text-xl text-brand-text" id="delta-status">
                Œî > 0
            </div>
            <div class="text-center text-sm text-gray-500" id="delta-desc">
                2 Ra√≠zes Reais
            </div>
        </div>

    </div>
    `;

                    const slider = container.querySelector("#delta-slider");
                    const curve = container.querySelector("#para-curve");
                    const r1 = container.querySelector("#root-1");
                    const r2 = container.querySelector("#root-2");
                    const status = container.querySelector("#delta-status");
                    const desc = container.querySelector("#delta-desc");

                    const update = () => {
                        const val = parseInt(slider.value);

                        if (val === 1) {
                            // Positivo
                            // Corta duas vezes (fundo da parabola abaixo do eixo)
                            curve.setAttribute("d", "M 0 0 Q 50 150 100 0");
                            r1.style.display = "block";
                            r2.style.display = "block";
                            // Ajusta posi√ß√£o visual dos pontos
                            // Interse√ß√£o visual aproximada
                            r1.style.left = "21%";
                            r2.style.left = "76%"; // (100-21) approx

                            status.innerHTML = '<span class="text-green-600">Œî > 0</span>';
                            desc.innerText = "A par√°bola corta o eixo X em 2 lugares.";
                        } else if (val === 0) {
                            // Zero
                            // Tangencia (fundo da parabola no eixo)
                            curve.setAttribute("d", "M 0 0 Q 50 100 100 0");
                            r1.style.display = "block";
                            r2.style.display = "none";
                            r1.style.left = "calc(50% - 6px)"; // Centro

                            status.innerHTML = '<span class="text-yellow-600">Œî = 0</span>';
                            desc.innerText =
                                "A par√°bola d√° um beijinho no eixo X (1 Raiz).";
                        } else {
                            // Negativo
                            // Flutua (fundo da parabola acima do eixo)
                            curve.setAttribute("d", "M 0 10 Q 50 80 100 10");
                            r1.style.display = "none";
                            r2.style.display = "none";

                            status.innerHTML = '<span class="text-red-600">Œî < 0</span>';
                            desc.innerText =
                                "A par√°bola flutua! N√£o toca o eixo X (0 Ra√≠zes Reais).";
                        }
                    };

                    slider.oninput = update;
                    update();
                },

                interactive_biquadratic_swap(container) {
                    let phase = 1; // 1: Original, 2: Swap, 3: Solve Y, 4: Solve X

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden h-[300px]">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">M√°scara Biquadrada</h3>

        <div class="text-center w-full transition-all duration-500 absolute top-16" id="stage-1">
            <div class="text-3xl font-mono font-black text-gray-700">
                <span class="group-x4 border-b-4 border-brand-purple inline-block px-1">x‚Å¥</span> - 5<span class="group-x2 border-b-4 border-brand-purple inline-block px-1">x¬≤</span> + 4 = 0
            </div>
            <p class="text-sm text-gray-500 mt-4">Isso assusta! Vamos colocar uma m√°scara.</p>
        </div>

        <div class="text-center w-full transition-all duration-500 absolute top-16 translate-x-full opacity-0" id="stage-2">
            <div class="bg-purple-100 px-4 py-2 rounded-lg inline-block mb-4 border border-purple-300">
                <span class="font-bold text-brand-purple">y = x¬≤</span>
            </div>
            <div class="text-3xl font-mono font-black text-brand-blue">
                y¬≤ - 5y + 4 = 0
            </div>
            <p class="text-sm text-gray-500 mt-2">Agora √© uma equa√ß√£o do 2¬∫ grau comum!</p>
        </div>

        <div class="text-center w-full transition-all duration-500 absolute top-16 translate-x-full opacity-0" id="stage-3">
            <p class="text-xs font-bold text-gray-400 uppercase">Resolvendo para Y...</p>
            <div class="text-3xl font-mono font-black text-brand-blue mt-2">
                y' = 1 <br> y'' = 4
            </div>
            <p class="text-sm text-gray-500 mt-2">Achamos o Y. Mas queremos o X!</p>
        </div>

        <div class="text-center w-full transition-all duration-500 absolute top-16 translate-x-full opacity-0" id="stage-4">
            <p class="text-xs font-bold text-gray-400 uppercase">Tirando a M√°scara ($x = \\pm \\sqrt{y}$)</p>
            <div class="flex gap-4 justify-center mt-2">
                <div class="bg-gray-50 p-2 rounded border">
                    x¬≤ = 1 <br> <span class="font-black text-brand-green">x = ¬±1</span>
                </div>
                <div class="bg-gray-50 p-2 rounded border">
                    x¬≤ = 4 <br> <span class="font-black text-brand-green">x = ¬±2</span>
                </div>
            </div>
            <p class="text-sm text-brand-green font-bold mt-4">4 Ra√≠zes encontradas!</p>
        </div>

        <button id="btn-bi-next" class="absolute bottom-6 w-48 bg-brand-purple text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all">
            Pr√≥ximo Passo
        </button>

    </div>
    `;

                    const s1 = container.querySelector("#stage-1");
                    const s2 = container.querySelector("#stage-2");
                    const s3 = container.querySelector("#stage-3");
                    const s4 = container.querySelector("#stage-4");
                    const btn = container.querySelector("#btn-bi-next");
                    const stages = [s1, s2, s3, s4];

                    btn.onclick = () => {
                        // Sai atual
                        stages[phase - 1].classList.add("-translate-x-full", "opacity-0");

                        phase++;
                        if (phase > 4) {
                            // Reset
                            phase = 1;
                            stages.forEach((s) => {
                                s.classList.remove(
                                    "-translate-x-full",
                                    "translate-x-full",
                                    "opacity-0"
                                );
                                s.classList.add("translate-x-full", "opacity-0"); // Manda todos pra direita
                            });
                            // Traz o 1
                            s1.classList.remove("translate-x-full", "opacity-0");
                            btn.innerText = "Pr√≥ximo Passo";
                            return;
                        }

                        // Entra proximo
                        stages[phase - 1].classList.remove(
                            "translate-x-full",
                            "opacity-0"
                        );

                        if (phase === 4) btn.innerText = "Reiniciar";
                    };
                },

                interactive_function_machine(container) {
                    // Estado
                    let inputVal = 2;
                    let rule = { mult: 2, add: 1 }; // f(x) = 2x + 1

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">A M√°quina de Fun√ß√µes</h3>

        <div class="flex items-center justify-center gap-0 relative w-full h-40">
            
            <div class="flex flex-col items-center z-10 w-24">
                <span class="text-xs font-bold text-gray-400 uppercase mb-1">Entrada (x)</span>
                <input type="number" id="func-in" value="${inputVal}" class="w-16 h-12 text-center text-2xl font-black border-4 border-gray-300 rounded-lg bg-gray-50 focus:border-brand-blue outline-none z-20 relative">
                <div class="w-20 h-4 bg-gray-300 mt-[-2px] rounded-b-lg"></div>
            </div>

            <div class="relative w-40 h-32 bg-brand-purple rounded-2xl flex items-center justify-center shadow-lg z-20 border-b-8 border-purple-800">
                <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(white 1px, transparent 1px); background-size: 10px 10px;"></div>
                <div class="bg-black/20 p-2 rounded-lg text-white font-mono font-bold text-lg border border-white/10 shadow-inner">
                    f(x) = 2x + 1
                </div>
                <i class="fas fa-cog absolute -top-4 -right-4 text-4xl text-gray-300 animate-spin-slow opacity-50"></i>
            </div>

            <div class="flex flex-col items-center z-10 w-24">
                <span class="text-xs font-bold text-gray-400 uppercase mb-1">Sa√≠da f(x)</span>
                <div id="func-out" class="w-16 h-12 flex items-center justify-center text-2xl font-black text-white bg-brand-green border-4 border-green-600 rounded-lg shadow-md transition-all scale-0 z-20 relative">
                    ?
                </div>
                <div class="w-20 h-4 bg-gray-300 mt-[-2px] rounded-b-lg"></div>
            </div>

        </div>

        <button id="btn-process" class="mt-6 bg-brand-blue text-white font-bold py-3 px-10 rounded-full shadow-btn active:scale-95 transition-all uppercase tracking-widest">
            Processar
        </button>

        <div id="calc-step" class="h-8 mt-4 font-mono text-gray-500 font-bold"></div>

    </div>
    `;

                    const input = container.querySelector("#func-in");
                    const output = container.querySelector("#func-out");
                    const btn = container.querySelector("#btn-process");
                    const calcStep = container.querySelector("#calc-step");

                    btn.onclick = () => {
                        const x = parseFloat(input.value) || 0;
                        const y = rule.mult * x + rule.add;

                        // Reset Animation
                        output.classList.remove("scale-100");
                        output.classList.add("scale-0");
                        calcStep.innerText = "Processando...";
                        btn.disabled = true;
                        btn.classList.add("opacity-50");

                        // Animation Delay
                        setTimeout(() => {
                            output.innerText = y;
                            output.classList.remove("scale-0");
                            output.classList.add("scale-100", "animate-pop-in");

                            calcStep.innerHTML = `2(${x}) + 1 = <span class="text-brand-green">${y}</span>`;

                            btn.disabled = false;
                            btn.classList.remove("opacity-50");
                        }, 800);
                    };
                },

                interactive_func_representations(container) {
                    let x = 2;
                    // Fun√ß√£o: y = x + 2

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Tr√™s Vis√µes: f(x) = x + 2</h3>

        <div class="w-full max-w-sm mb-6">
            <label class="text-xs font-bold text-gray-400 uppercase">Escolha o valor de X</label>
            <input type="range" id="x-slider" min="0" max="5" value="2" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue">
            <div class="flex justify-between text-[10px] text-gray-400 px-1 font-bold">
                <span>0</span><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-4 w-full h-40">
            
            <div class="flex justify-center items-center gap-2 bg-gray-50 rounded-lg border border-gray-200 relative overflow-hidden">
                <div class="flex flex-col gap-1 items-center">
                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center font-bold text-brand-blue text-sm border-2 border-blue-200 transition-all scale-125 shadow-md" id="diag-x">2</div>
                </div>
                <div class="w-8 h-0.5 bg-gray-400 relative">
                    <div class="absolute right-0 -top-1.5 border-t-4 border-b-4 border-l-8 border-t-transparent border-b-transparent border-l-gray-400"></div>
                </div>
                <div class="flex flex-col gap-1 items-center">
                    <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center font-bold text-brand-green text-sm border-2 border-green-200 transition-all scale-125 shadow-md" id="diag-y">4</div>
                </div>
                <div class="absolute bottom-1 w-full text-center text-[8px] text-gray-400 uppercase font-bold">Diagrama</div>
            </div>

            <div class="bg-gray-50 rounded-lg border border-gray-200 flex flex-col items-center p-2 overflow-y-auto custom-scrollbar">
                <div class="flex w-full border-b border-gray-300 pb-1 mb-1 text-[10px] font-bold text-gray-500 uppercase">
                    <span class="flex-1 text-center">X</span>
                    <span class="flex-1 text-center">Y</span>
                </div>
                <div id="table-rows" class="w-full text-sm font-mono text-center space-y-1">
                    </div>
                <div class="absolute bottom-1 w-full text-center text-[8px] text-gray-400 uppercase font-bold">Tabela</div>
            </div>

            <div class="bg-gray-50 rounded-lg border border-gray-200 relative">
                <svg width="100%" height="100%" viewBox="0 0 100 100" class="absolute inset-0">
                    <path d="M 10 90 L 90 90 M 10 10 L 10 90" stroke="#CBD5E1" stroke-width="1" />
                    <line x1="10" y1="70" x2="90" y2="-10" stroke="#1CB0F6" stroke-width="2" stroke-dasharray="2,2" />
                    <circle id="graph-pt" cx="30" cy="50" r="4" fill="#58CC02" stroke="white" stroke-width="1" class="transition-all duration-300" />
                </svg>
                <div class="absolute bottom-1 w-full text-center text-[8px] text-gray-400 uppercase font-bold">Gr√°fico</div>
            </div>

        </div>

    </div>
    `;

                    const slider = container.querySelector("#x-slider");
                    const diagX = container.querySelector("#diag-x");
                    const diagY = container.querySelector("#diag-y");
                    const tableRows = container.querySelector("#table-rows");
                    const graphPt = container.querySelector("#graph-pt");

                    const update = () => {
                        const val = parseInt(slider.value);
                        const y = val + 2;

                        // Diagram
                        diagX.innerText = val;
                        diagY.innerText = y;

                        // Table
                        let html = "";
                        for (let i = 0; i <= 5; i++) {
                            const rowY = i + 2;
                            const activeClass =
                                i === val
                                    ? "bg-blue-100 font-bold text-brand-blue rounded"
                                    : "text-gray-600";
                            html += `<div class="flex w-full ${activeClass}"><span class="flex-1">${i}</span><span class="flex-1">${rowY}</span></div>`;
                        }
                        tableRows.innerHTML = html;

                        // Graph
                        // Scale: X(0)=10, X(5)=90. Y(0)=90, Y(7)=10.
                        // dx = 16 per unit. dy = -10 approx.
                        // Let's use simplified coords: 10% padding.
                        // x goes 0->5. y goes 2->7.
                        // Map X: 10 + (val/5)*80
                        // Map Y: 90 - ((y)/8)*80 (assuming max Y around 8 for view)

                        const cx = 10 + (val / 5) * 80;
                        const cy = 90 - (y / 8) * 80;

                        graphPt.setAttribute("cx", cx + "%");
                        graphPt.setAttribute("cy", cy + "%");
                    };

                    slider.oninput = update;
                    update();
                },

                interactive_domain_range_shooter(container) {
                    // Config: f(x) = x * 2
                    const domain = [1, 2, 3];
                    const codomain = [1, 2, 3, 4, 5, 6];
                    let hits = [];

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full text-white mb-6 z-10">
            <h3 class="font-black uppercase text-xs tracking-widest text-gray-400">Mapeamento de Fun√ß√£o</h3>
            <div class="text-xs font-mono text-green-400">f(x) = 2x</div>
        </div>

        <div class="flex justify-between w-full max-w-sm mb-8 z-10 relative">
            
            <div class="flex flex-col gap-4 items-center">
                <span class="text-xs font-bold text-blue-400 uppercase bg-blue-900/50 px-2 py-1 rounded">Dom√≠nio (D)</span>
                <div class="flex flex-col gap-3">
                    ${domain
                            .map(
                                (x) => `
                        <button class="domain-btn w-10 h-10 rounded-full bg-blue-600 hover:bg-blue-500 text-white font-bold border-2 border-blue-400 shadow-lg active:scale-95 transition-all relative" data-val="${x}">
                            ${x}
                            <div class="absolute right-[-10px] top-1/2 w-2 h-2 bg-blue-400 rounded-full transform -translate-y-1/2"></div>
                        </button>
                    `
                            )
                            .join("")}
                </div>
            </div>

            <svg id="arrows-layer" class="absolute inset-0 w-full h-full pointer-events-none" style="z-index: 0;"></svg>

            <div class="flex flex-col gap-4 items-center">
                <span class="text-xs font-bold text-gray-400 uppercase bg-gray-800 px-2 py-1 rounded">Contradom√≠nio (CD)</span>
                <div class="flex flex-col gap-2">
                    ${codomain
                            .map(
                                (y) => `
                        <div class="target-spot w-10 h-10 rounded-full bg-gray-700 border-2 border-gray-600 flex items-center justify-center text-gray-400 font-bold text-sm transition-all" id="target-${y}">
                            ${y}
                        </div>
                    `
                            )
                            .join("")}
                </div>
            </div>

        </div>

        <div class="text-center h-8 text-sm font-bold text-white z-10" id="shooter-feedback">
            Clique num n√∫mero do Dom√≠nio para disparar!
        </div>

    </div>
    `;

                    const svg = container.querySelector("#arrows-layer");
                    const feedback = container.querySelector("#shooter-feedback");
                    const btns = container.querySelectorAll(".domain-btn");

                    const shoot = (btn, x) => {
                        const y = x * 2;
                        const target = container.querySelector(`#target-${y}`);

                        if (!target) return; // Should not happen with current config

                        // Coords relative to SVG container
                        const startRect = btn.getBoundingClientRect();
                        const endRect = target.getBoundingClientRect();
                        const svgRect = svg.getBoundingClientRect();

                        const x1 = startRect.right - svgRect.left;
                        const y1 = startRect.top - svgRect.top + startRect.height / 2;
                        const x2 = endRect.left - svgRect.left;
                        const y2 = endRect.top - svgRect.top + endRect.height / 2;

                        // Draw Arrow
                        const path = document.createElementNS(
                            "http://www.w3.org/2000/svg",
                            "line"
                        );
                        path.setAttribute("x1", x1);
                        path.setAttribute("y1", y1);
                        path.setAttribute("x2", x1); // Start at source
                        path.setAttribute("y2", y1);
                        path.setAttribute("stroke", "#58CC02");
                        path.setAttribute("stroke-width", "3");
                        path.setAttribute("marker-end", "url(#arrowhead)");

                        // Add defs if not exists
                        if (!container.querySelector("defs")) {
                            const defs = document.createElementNS(
                                "http://www.w3.org/2000/svg",
                                "defs"
                            );
                            defs.innerHTML = `<marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#58CC02" /></marker>`;
                            svg.appendChild(defs);
                        }
                        svg.appendChild(path);

                        // Animate Arrow
                        requestAnimationFrame(() => {
                            path.style.transition = "all 0.4s ease-out";
                            path.setAttribute("x2", x2);
                            path.setAttribute("y2", y2);
                        });

                        // Hit Effect
                        setTimeout(() => {
                            target.classList.remove(
                                "bg-gray-700",
                                "border-gray-600",
                                "text-gray-400"
                            );
                            target.classList.add(
                                "bg-green-600",
                                "border-green-400",
                                "text-white",
                                "scale-110",
                                "shadow-[0_0_15px_#22c55e]"
                            );

                            // Mark Image
                            if (!hits.includes(y)) hits.push(y);

                            if (hits.length === domain.length) {
                                feedback.innerHTML =
                                    "<span class='text-green-400'>IMAGEM COMPLETA! Im = {2, 4, 6}</span>";
                            }
                        }, 400);

                        btn.disabled = true;
                        btn.classList.add("opacity-50", "cursor-not-allowed");
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => shoot(btn, parseInt(btn.dataset.val));
                    });
                },

                interactive_affine_taxi(container) {
                    let km = 5;
                    const band = 4.0; // R$ 4,00 fixo
                    const rate = 2.5; // R$ 2,50 por km

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <h3 class="text-brand-yellow font-black uppercase text-xs tracking-widest mb-6">T√°xi Matem√°tico</h3>

        <div class="flex items-end justify-center w-full mb-8 relative">
            <div class="absolute bottom-0 w-full h-2 bg-gray-800 rounded-full z-0"></div>
            
            <div id="taxi" class="text-5xl absolute bottom-1 transition-all duration-300 z-10 transform -scale-x-100" style="left: 0;">
                üöï
            </div>
            
            <div class="w-full flex justify-between px-2 pt-8 z-0">
                ${[0, 5, 10, 15, 20]
                            .map(
                                (k) =>
                                    `<div class="flex flex-col items-center"><div class="w-1 h-3 bg-gray-500"></div><span class="text-[10px] font-bold text-gray-400">${k}km</span></div>`
                            )
                            .join("")}
            </div>
        </div>

        <div class="w-full max-w-sm mb-6">
            <label class="text-xs font-bold text-gray-500 uppercase">Dist√¢ncia da Corrida</label>
            <input type="range" id="dist-slider" min="0" max="20" value="5" class="w-full h-3 bg-yellow-100 rounded-lg appearance-none cursor-pointer accent-brand-yellow">
            <div class="text-center font-black text-brand-text text-xl"><span id="km-disp">5</span> km</div>
        </div>

        <div class="bg-gray-50 border border-gray-200 rounded-xl p-4 w-full max-w-sm">
            <div class="flex justify-between items-center text-sm text-gray-600 mb-2">
                <span>Bandeirada (Fixo):</span>
                <span class="font-bold">R$ 4,00</span>
            </div>
            <div class="flex justify-between items-center text-sm text-gray-600 mb-2 border-b border-gray-200 pb-2">
                <span>Quilometragem (Var):</span>
                <span>${km} x R$ 2,50</span>
            </div>
            <div class="flex justify-between items-center text-xl font-black text-brand-green">
                <span>Total:</span>
                <span id="price-disp">R$ 16,50</span>
            </div>
        </div>

        <div class="mt-4 text-xs font-mono text-gray-400 bg-white border border-gray-200 px-2 py-1 rounded">
            f(x) = 2,50x + 4,00
        </div>

    </div>
    `;

                    const slider = container.querySelector("#dist-slider");
                    const taxi = container.querySelector("#taxi");
                    const kmDisp = container.querySelector("#km-disp");
                    const priceDisp = container.querySelector("#price-disp");

                    const update = () => {
                        km = parseInt(slider.value);
                        kmDisp.innerText = km;

                        // Move taxi (0 to 100% minus icon width)
                        const maxPos =
                            container.querySelector(".relative").offsetWidth - 50;
                        // Approximated percent logic for simplicity in string
                        const pct = (km / 20) * 90; // 90% max to stay visible
                        taxi.style.left = `${pct}%`;

                        // Calc Price
                        const total = band + rate * km;
                        priceDisp.innerText = total.toLocaleString("pt-BR", {
                            style: "currency",
                            currency: "BRL",
                        });
                    };

                    slider.oninput = update;
                    update();
                },

                interactive_affine_explorer(container) {
                    let a = 1;
                    let b = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Laborat√≥rio Linear: f(x) = ax + b</h3>

        <div class="relative w-64 h-64 bg-gray-50 border border-gray-300 rounded-lg mb-6 overflow-hidden">
            <svg id="affine-svg" width="256" height="256" viewBox="-10 -10 20 20" class="absolute inset-0 w-full h-full">
                <line x1="-10" y1="0" x2="10" y2="0" stroke="#94a3b8" stroke-width="0.1" /> <line x1="0" y1="-10" x2="0" y2="10" stroke="#94a3b8" stroke-width="0.1" /> <line id="graph-line" x1="-10" y1="10" x2="10" y2="-10" stroke="#1CB0F6" stroke-width="0.3" />
                
                <circle id="b-point" cx="0" cy="0" r="0.4" fill="#FF9600" />
                
                <circle id="root-point" cx="0" cy="0" r="0.4" fill="#FF4B4B" />
            </svg>
        </div>

        <div class="w-full max-w-xs space-y-4">
            <div>
                <div class="flex justify-between text-xs font-bold uppercase text-brand-blue">
                    <span>Inclina√ß√£o (a)</span>
                    <span id="val-a">1</span>
                </div>
                <input type="range" id="slider-a" min="-5" max="5" step="0.5" value="1" class="w-full h-2 bg-blue-100 rounded-lg accent-brand-blue">
            </div>
            
            <div>
                <div class="flex justify-between text-xs font-bold uppercase text-brand-orange">
                    <span>Altura Inicial (b)</span>
                    <span id="val-b">0</span>
                </div>
                <input type="range" id="slider-b" min="-5" max="5" step="0.5" value="0" class="w-full h-2 bg-orange-100 rounded-lg accent-brand-orange">
            </div>
        </div>

        <div class="mt-4 flex gap-4 text-xs font-bold">
            <span class="text-brand-orange">‚óè Corta Y (b)</span>
            <span class="text-brand-red">‚óè Corta X (Raiz)</span>
        </div>

    </div>
    `;

                    const line = container.querySelector("#graph-line");
                    const ptB = container.querySelector("#b-point");
                    const ptRoot = container.querySelector("#root-point");
                    const sA = container.querySelector("#slider-a");
                    const sB = container.querySelector("#slider-b");
                    const vA = container.querySelector("#val-a");
                    const vB = container.querySelector("#val-b");

                    const update = () => {
                        a = parseFloat(sA.value);
                        b = parseFloat(sB.value);

                        vA.innerText = a;
                        vB.innerText = b;

                        // SVG Coordinate system: Center is 0,0. Y grows DOWN in SVG, but UP in math.
                        // We need to invert Y for rendering.
                        // Viewbox -10 to 10.
                        // Line equation: y = ax + b.
                        // Calculate two points at edges x=-10 and x=10.

                        const y1 = a * -10 + b;
                        const y2 = a * 10 + b;

                        // SVG Y = -Math Y (flip axis)
                        line.setAttribute("x1", -10);
                        line.setAttribute("y1", -y1);
                        line.setAttribute("x2", 10);
                        line.setAttribute("y2", -y2);

                        // B Point (0, b)
                        ptB.setAttribute("cy", -b);

                        // Root Point (y=0 -> ax+b=0 -> x = -b/a)
                        if (a !== 0) {
                            const rootX = -b / a;
                            ptRoot.setAttribute("cx", rootX);
                            ptRoot.setAttribute("cy", 0);
                            ptRoot.style.opacity = rootX >= -10 && rootX <= 10 ? 1 : 0; // Hide if out of view
                        } else {
                            ptRoot.style.opacity = 0; // Parallel to X, no root (or infinite)
                        }
                    };

                    sA.oninput = update;
                    sB.oninput = update;
                    update();
                },

                interactive_segment_ratio(container) {
                    let topVal = 4;
                    let bottomVal = 2;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-6">Calculadora Visual de Raz√£o</h3>

        <div class="flex gap-4 items-center w-full mb-6">
            <div class="flex flex-col items-end gap-4 w-1/4 text-xs font-bold text-gray-400 uppercase">
                <span>Seg. A</span>
                <span>Seg. B</span>
            </div>
            
            <div class="flex-1 flex flex-col gap-4 relative">
                <div class="relative h-8 bg-blue-100 rounded-r-lg transition-all duration-300 border-l-4 border-brand-blue" style="width: ${topVal * 10
                        }%" id="bar-a">
                    <span class="absolute right-2 top-1/2 -translate-y-1/2 text-brand-blue font-bold" id="txt-a">${topVal}cm</span>
                </div>
                <div class="relative h-8 bg-orange-100 rounded-r-lg transition-all duration-300 border-l-4 border-brand-orange" style="width: ${bottomVal * 10
                        }%" id="bar-b">
                    <span class="absolute right-2 top-1/2 -translate-y-1/2 text-brand-orange font-bold" id="txt-b">${bottomVal}cm</span>
                </div>
            </div>
        </div>

        <div class="flex gap-8 mb-6">
            <div class="flex flex-col items-center">
                <input type="range" id="range-a" min="1" max="10" value="4" class="w-24 h-2 bg-gray-200 rounded-lg accent-brand-blue">
            </div>
            <div class="flex flex-col items-center">
                <input type="range" id="range-b" min="1" max="10" value="2" class="w-24 h-2 bg-gray-200 rounded-lg accent-brand-orange">
            </div>
        </div>

        <div class="bg-gray-800 text-white p-4 rounded-xl text-center w-full max-w-xs shadow-lg">
            <p class="text-xs text-gray-400 uppercase font-bold mb-1">A Raz√£o √©:</p>
            <div class="text-3xl font-mono font-black">
                <span class="text-brand-blue" id="math-a">4</span> √∑ <span class="text-brand-orange" id="math-b">2</span> = <span class="text-brand-green" id="res-ratio">2</span>
            </div>
        </div>
    </div>
    `;

                    const barA = container.querySelector("#bar-a");
                    const barB = container.querySelector("#bar-b");
                    const txtA = container.querySelector("#txt-a");
                    const txtB = container.querySelector("#txt-b");
                    const mathA = container.querySelector("#math-a");
                    const mathB = container.querySelector("#math-b");
                    const resRatio = container.querySelector("#res-ratio");

                    const update = () => {
                        topVal = parseInt(container.querySelector("#range-a").value);
                        bottomVal = parseInt(container.querySelector("#range-b").value);

                        barA.style.width = `${topVal * 9}%`; // Scale visuals
                        barB.style.width = `${bottomVal * 9}%`;

                        txtA.innerText = `${topVal}`;
                        txtB.innerText = `${bottomVal}`;
                        mathA.innerText = topVal;
                        mathB.innerText = bottomVal;

                        const ratio = topVal / bottomVal;
                        // Mostra decimal ou inteiro
                        resRatio.innerText = Number.isInteger(ratio)
                            ? ratio
                            : ratio.toFixed(2);
                    };

                    container
                        .querySelectorAll("input")
                        .forEach((i) => (i.oninput = update));
                },

                interactive_tales_theorem(container) {
                    // Configura√ß√£o inicial
                    let topRatio = 50; // slider position (percentage)

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-4">Teorema de Tales Interativo</h3>
        
        <div class="relative w-full max-w-md h-64 bg-gray-50 border border-gray-200 rounded-xl mb-6 overflow-hidden">
            <svg width="100%" height="100%" class="absolute inset-0">
                <line x1="0" y1="20%" x2="100%" y2="20%" stroke="#4B4B4B" stroke-width="2" />
                <line x1="0" y1="50%" x2="100%" y2="50%" stroke="#4B4B4B" stroke-width="2" id="mid-line" />
                <line x1="0" y1="80%" x2="100%" y2="80%" stroke="#4B4B4B" stroke-width="2" />

                <line x1="20%" y1="10%" x2="40%" y2="90%" stroke="#1CB0F6" stroke-width="3" stroke-linecap="round" />
                <line x1="60%" y1="10%" x2="80%" y2="90%" stroke="#FF4B4B" stroke-width="3" stroke-linecap="round" />

                <text x="25%" y="35%" fill="#1CB0F6" font-weight="bold" id="lbl-a">A</text>
                <text x="35%" y="65%" fill="#1CB0F6" font-weight="bold" id="lbl-b">B</text>
                
                <text x="65%" y="35%" fill="#FF4B4B" font-weight="bold" id="lbl-c">C</text>
                <text x="75%" y="65%" fill="#FF4B4B" font-weight="bold" id="lbl-d">D</text>
            </svg>

            <div class="absolute right-2 top-1/2 -translate-y-1/2 flex flex-col items-center">
                <input type="range" id="tales-slider" min="25" max="75" value="50" orient="vertical" class="h-40 w-2 appearance-none bg-gray-300 rounded cursor-pointer accent-brand-purple">
            </div>
        </div>

        <div class="flex gap-8 w-full justify-center text-xl font-mono font-bold bg-gray-100 p-4 rounded-xl">
            <div class="flex flex-col items-center">
                <span class="text-brand-blue border-b-2 border-gray-400 px-2" id="val-a">3.0</span>
                <span class="text-brand-blue px-2" id="val-b">3.0</span>
            </div>
            <div class="flex items-center text-gray-400">=</div>
            <div class="flex flex-col items-center">
                <span class="text-brand-red border-b-2 border-gray-400 px-2" id="val-c">3.0</span>
                <span class="text-brand-red px-2" id="val-d">3.0</span>
            </div>
        </div>
        
        <p class="text-center text-xs text-gray-500 mt-2 font-bold uppercase">Mova o slider lateral para mudar a reta do meio!</p>

    </div>
    `;

                    const slider = container.querySelector("#tales-slider");
                    const midLine = container.querySelector("#mid-line");

                    // Values
                    const vA = container.querySelector("#val-a");
                    const vB = container.querySelector("#val-b");
                    const vC = container.querySelector("#val-c");
                    const vD = container.querySelector("#val-d");

                    // Labels position updater
                    const lblA = container.querySelector("#lbl-a");
                    const lblB = container.querySelector("#lbl-b");
                    const lblC = container.querySelector("#lbl-c");
                    const lblD = container.querySelector("#lbl-d");

                    const update = () => {
                        const val = parseInt(slider.value); // 25 to 75 (Percentage of height)
                        midLine.setAttribute("y1", `${val}%`);
                        midLine.setAttribute("y2", `${val}%`);

                        // Calculate visual segments (Total height between top(20%) and bottom(80%) is 60 units)
                        // Segment A = val - 20
                        // Segment B = 80 - val

                        const segTop = val - 20;
                        const segBot = 80 - val;

                        // Normalize for display (e.g., total 10cm)
                        const displayA = (segTop / 10).toFixed(1);
                        const displayB = (segBot / 10).toFixed(1);

                        // Transversal 2 has different lengths but SAME ratio. Let's simulate that visually
                        // by applying a multiplier (e.g. transversal 2 is longer)
                        // Visually in SVG x coords change, so lengths change.
                        // T1 length approx: sqrt(20^2 + 60^2) -> 63.2
                        // T2 length approx: sqrt(20^2 + 60^2) -> 63.2
                        // In this simple SVG setup, they are parallel transversals actually?
                        // No, x1=20 x2=40 vs x1=60 x2=80. They have same slope.
                        // Let's fake it slightly for pedagogical "different numbers, same ratio".

                        vA.innerText = displayA;
                        vB.innerText = displayB;
                        vC.innerText = (displayA * 1.5).toFixed(1); // Scale factor 1.5
                        vD.innerText = (displayB * 1.5).toFixed(1);

                        // Update Label Y positions
                        const midY = val;
                        lblA.setAttribute("y", `${20 + (midY - 20) / 2}%`);
                        lblB.setAttribute("y", `${midY + (80 - midY) / 2}%`);
                        lblC.setAttribute("y", `${20 + (midY - 20) / 2}%`);
                        lblD.setAttribute("y", `${midY + (80 - midY) / 2}%`);
                    };

                    slider.addEventListener("input", update);
                    update();
                },

                interactive_angle_bisector(container) {
                    // Triangle coordinates (fixed base)
                    const Ax = 150,
                        Ay = 50; // Top vertex
                    const Bx = 50,
                        By = 250; // Left vertex
                    const Cx = 250,
                        Cy = 250; // Right vertex

                    // We will move A horizontally to change shape but keep bisector logic visually
                    let topX = 150;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-2">
            <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest">Teorema da Bissetriz</h3>
        </div>

        <div class="relative w-[300px] h-[300px] bg-gray-50 border border-gray-200 rounded-xl mb-6 cursor-crosshair touch-none">
            <svg width="100%" height="100%" class="absolute inset-0">
                <path id="tri-path" fill="rgba(206, 130, 255, 0.1)" stroke="#4B4B4B" stroke-width="2" />
                
                <line id="bisector-line" stroke="#CE82FF" stroke-width="3" stroke-dasharray="4" />
                
                <circle id="point-d" r="4" fill="#CE82FF" />

                <circle id="point-a" r="8" fill="#4B4B4B" class="cursor-pointer hover:fill-brand-blue" />
                
                <text x="10" y="150" class="text-xs font-bold fill-blue-500" id="lbl-c">c</text>
                <text x="280" y="150" class="text-xs font-bold fill-orange-500" id="lbl-b">b</text>
                <text x="80" y="270" class="text-xs font-bold fill-blue-500" id="lbl-m">m</text>
                <text x="200" y="270" class="text-xs font-bold fill-orange-500" id="lbl-n">n</text>

                <text x="40" y="250" font-size="12" font-weight="bold">B</text>
                <text x="250" y="250" font-size="12" font-weight="bold">C</text>
                <text id="txt-a" font-size="12" font-weight="bold">A</text>
            </svg>
        </div>

        <div class="bg-gray-100 p-4 rounded-xl text-center w-full max-w-xs shadow-inner">
            <p class="text-xs font-bold text-gray-400 uppercase mb-2">A Propor√ß√£o M√°gica</p>
            <div class="flex items-center justify-center gap-4 text-lg font-mono font-bold">
                <div class="flex flex-col items-center">
                    <span class="text-blue-500">Lado Esq (c)</span>
                    <div class="w-full h-0.5 bg-gray-400"></div>
                    <span class="text-blue-500">Base Esq (m)</span>
                </div>
                <span>=</span>
                <div class="flex flex-col items-center">
                    <span class="text-orange-500">Lado Dir (b)</span>
                    <div class="w-full h-0.5 bg-gray-400"></div>
                    <span class="text-orange-500">Base Dir (n)</span>
                </div>
            </div>
            <div class="mt-2 text-brand-green font-black text-xl" id="ratio-val">1.00</div>
        </div>

        <p class="text-[10px] text-gray-400 mt-2">Arraste o ponto A (Topo) para os lados!</p>
    </div>
    `;

                    const svg = container.querySelector("svg");
                    const path = container.querySelector("#tri-path");
                    const line = container.querySelector("#bisector-line");
                    const ptA = container.querySelector("#point-a");
                    const ptD = container.querySelector("#point-d");
                    const txtA = container.querySelector("#txt-a");
                    const ratioVal = container.querySelector("#ratio-val");

                    // Labels
                    const lC = container.querySelector("#lbl-c");
                    const lB = container.querySelector("#lbl-b");

                    // Math Helpers
                    const dist = (x1, y1, x2, y2) =>
                        Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);

                    const update = () => {
                        // 1. Calculate side lengths
                        const c = dist(topX, Ay, Bx, By); // Left side
                        const b = dist(topX, Ay, Cx, Cy); // Right side

                        // 2. Bisector Theorem: m/n = c/b.
                        // Total base = BC_dist. m = (c / (c+b)) * total.
                        const totalBase = Cx - Bx; // 200
                        const m = (c / (c + b)) * totalBase;
                        const Dx = Bx + m;
                        const Dy = By; // Base is horizontal

                        // 3. Draw
                        ptA.setAttribute("cx", topX);
                        ptA.setAttribute("cy", Ay);
                        txtA.setAttribute("x", topX - 5);
                        txtA.setAttribute("y", Ay - 10);

                        path.setAttribute(
                            "d",
                            `M ${topX} ${Ay} L ${Bx} ${By} L ${Cx} ${Cy} Z`
                        );

                        line.setAttribute("x1", topX);
                        line.setAttribute("y1", Ay);
                        line.setAttribute("x2", Dx);
                        line.setAttribute("y2", Dy);

                        ptD.setAttribute("cx", Dx);
                        ptD.setAttribute("cy", Dy);

                        // Update labels positions roughly
                        lC.setAttribute("x", (topX + Bx) / 2 - 20);
                        lC.setAttribute("y", (Ay + By) / 2);

                        lB.setAttribute("x", (topX + Cx) / 2 + 10);
                        lB.setAttribute("y", (Ay + Cy) / 2);

                        // Update Values
                        const ratio = c / m; // Should equal b / n
                        ratioVal.innerText = ratio.toFixed(2);
                    };

                    // Drag Logic
                    let isDragging = false;

                    const drag = (e) => {
                        if (!isDragging) return;
                        const rect = svg.getBoundingClientRect();
                        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                        let x = clientX - rect.left;

                        // Limits
                        x = Math.max(50, Math.min(250, x));
                        topX = x;
                        update();
                    };

                    ptA.addEventListener("mousedown", () => (isDragging = true));
                    ptA.addEventListener("touchstart", () => (isDragging = true));
                    window.addEventListener("mouseup", () => (isDragging = false));
                    window.addEventListener("touchend", () => (isDragging = false));
                    window.addEventListener("mousemove", drag);
                    window.addEventListener("touchmove", drag);

                    update();
                },

                interactive_polygon_scaler(container) {
                    let k = 2; // Scale factor

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-green font-bold uppercase text-xs tracking-widest mb-4">Amplia√ß√£o e Redu√ß√£o (Homotetia)</h3>

        <div class="relative w-full h-64 bg-gray-50 border border-gray-200 rounded-xl mb-6 overflow-hidden flex items-center justify-center">
            <div class="absolute inset-0" style="background-image: radial-gradient(#cbd5e1 1px, transparent 1px); background-size: 20px 20px; opacity: 0.5;"></div>
            
            <svg width="100%" height="100%" class="absolute overflow-visible">
                <path d="M -20 -20 L 20 -20 L 20 20 L -20 20 Z" fill="rgba(75, 85, 99, 0.2)" stroke="#4B5563" stroke-width="2" stroke-dasharray="4,2" transform="translate(150, 150)" />
                <text x="150" y="155" text-anchor="middle" font-size="10" fill="#6B7280" font-weight="bold">ORIGINAL (1x)</text>

                <path id="poly-scaled" d="M -20 -20 L 20 -20 L 20 20 L -20 20 Z" fill="rgba(34, 197, 94, 0.3)" stroke="#22C55E" stroke-width="3" transform="translate(150, 150) scale(1)" class="transition-transform duration-300" />
            </svg>
        </div>

        <div class="w-full max-w-xs flex flex-col items-center gap-2">
            <div class="flex justify-between w-full text-xs font-bold text-gray-500 uppercase">
                <span>Redu√ß√£o</span>
                <span>k = <span id="k-val" class="text-brand-green text-lg">1.0</span></span>
                <span>Amplia√ß√£o</span>
            </div>
            <input type="range" id="scale-slider" min="0.5" max="3" step="0.5" value="1" class="w-full h-2 bg-gray-200 rounded-lg accent-brand-green cursor-pointer">
        </div>

        <div class="mt-4 grid grid-cols-2 gap-4 text-center w-full max-w-sm">
            <div class="bg-gray-100 p-2 rounded">
                <span class="text-[10px] uppercase font-bold text-gray-400">Per√≠metro</span>
                <div class="text-gray-700 font-bold" id="res-perim">1x</div>
            </div>
            <div class="bg-green-100 p-2 rounded">
                <span class="text-[10px] uppercase font-bold text-green-700">√Årea</span>
                <div class="text-green-800 font-bold" id="res-area">1x</div>
            </div>
        </div>

    </div>
    `;

                    const slider = container.querySelector("#scale-slider");
                    const poly = container.querySelector("#poly-scaled");
                    const kVal = container.querySelector("#k-val");
                    const rPerim = container.querySelector("#res-perim");
                    const rArea = container.querySelector("#res-area");

                    const update = () => {
                        k = parseFloat(slider.value);

                        // SVG Scale Transform
                        poly.setAttribute("transform", `translate(150, 150) scale(${k})`);

                        kVal.innerText = k.toFixed(1);

                        // Math Update
                        rPerim.innerText = `${k}x`;
                        rArea.innerText = `${(k * k).toFixed(2).replace(".00", "")}x`; // k squared
                    };

                    slider.oninput = update;
                },

                interactive_area_ratio_visualizer(container) {
                    let k = 1;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-red font-bold uppercase text-xs tracking-widest mb-6">A Lei do Quadrado</h3>

        <div class="flex gap-4 items-end mb-8 h-32">
            <div class="flex flex-col items-center gap-1">
                <div class="w-8 h-8 bg-gray-300 border border-gray-500 flex items-center justify-center text-xs font-bold text-gray-700">1</div>
                <span class="text-[10px] uppercase font-bold text-gray-400">Lado 1</span>
            </div>

            <div class="text-2xl text-gray-300 pb-8">‚ûú</div>

            <div class="flex flex-col items-center gap-1">
                <div id="scaled-box" class="grid bg-red-100 border-2 border-brand-red transition-all duration-500 overflow-hidden" style="width: 32px; height: 32px; grid-template-columns: repeat(1, 1fr);">
                    </div>
                <span class="text-[10px] uppercase font-bold text-brand-red">Lado <span id="side-disp">1</span></span>
            </div>
        </div>

        <div class="w-full max-w-xs flex flex-col gap-2">
            <div class="flex justify-between w-full text-xs font-bold text-gray-500">
                <span>k = 1</span>
                <span>k = 4</span>
            </div>
            <input type="range" id="k-slider" min="1" max="4" step="1" value="1" class="w-full h-2 bg-gray-200 rounded-lg accent-brand-red cursor-pointer">
        </div>

        <div class="mt-6 text-center">
            <p class="text-sm text-gray-600">
                Lado aumentou <strong><span id="k-txt">1</span>x</strong>.
            </p>
            <p class="text-xl font-black text-brand-red mt-1 animate-pop-in">
                √Årea aumentou <span id="area-txt">1</span>x!
            </p>
            <p class="text-xs text-gray-400 mt-1">($k^2$)</p>
        </div>

    </div>
    `;

                    const slider = container.querySelector("#k-slider");
                    const box = container.querySelector("#scaled-box");
                    const sideDisp = container.querySelector("#side-disp");
                    const kTxt = container.querySelector("#k-txt");
                    const areaTxt = container.querySelector("#area-txt");

                    const update = () => {
                        k = parseInt(slider.value);

                        // Update Box Size
                        const size = k * 32;
                        box.style.width = `${size}px`;
                        box.style.height = `${size}px`;
                        box.style.gridTemplateColumns = `repeat(${k}, 1fr)`;

                        // Generate internal blocks
                        let html = "";
                        for (let i = 0; i < k * k; i++) {
                            html += `<div class="border border-red-200 bg-red-50 text-[8px] flex items-center justify-center text-red-300">1</div>`;
                        }
                        box.innerHTML = html;

                        // Text
                        sideDisp.innerText = k;
                        kTxt.innerText = k;
                        areaTxt.innerText = k * k;
                    };

                    slider.oninput = update;
                    update();
                },

                interactive_metric_relations(container) {
                    // Configura√ß√£o inicial (Tri√¢ngulo 3-4-5 escalado)
                    let a = 10; // Hipotenusa
                    let b = 8; // Cateto maior
                    let c = 6; // Cateto menor
                    // Proje√ß√µes
                    let m = (b * b) / a; // 6.4
                    let n = (c * c) / a; // 3.6
                    let h = (b * c) / a; // 4.8

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Raio-X do Tri√¢ngulo</h3>

        <div class="relative w-full h-48 bg-gray-50 border border-gray-200 rounded-xl mb-6 flex items-end justify-center overflow-hidden">
            <svg width="100%" height="100%" viewBox="0 0 300 150" class="absolute bottom-0">
                <path d="M 50 130 L 250 130 L 122 34 Z" fill="none" stroke="#4B4B4B" stroke-width="2" />
                
                <line x1="122" y1="34" x2="122" y2="130" stroke="#EF4444" stroke-width="2" stroke-dasharray="4" />
                <text x="126" y="80" fill="#EF4444" font-size="12" font-weight="bold">h</text>

                <line x1="50" y1="135" x2="122" y2="135" stroke="#1CB0F6" stroke-width="3" />
                <text x="80" y="148" fill="#1CB0F6" font-size="12" font-weight="bold">n (proje√ß√£o c)</text>

                <line x1="122" y1="135" x2="250" y2="135" stroke="#FF9600" stroke-width="3" />
                <text x="180" y="148" fill="#FF9600" font-size="12" font-weight="bold">m (proje√ß√£o b)</text>

                <text x="70" y="70" fill="#4B4B4B" font-size="12" font-weight="bold">c</text>
                <text x="200" y="70" fill="#4B4B4B" font-size="12" font-weight="bold">b</text>

                <rect x="116" y="34" width="10" height="10" transform="rotate(53.13 122 34)" fill="rgba(0,0,0,0.1)" />
            </svg>
        </div>

        <div class="grid grid-cols-2 gap-4 w-full text-center">
            <div class="bg-blue-50 p-2 rounded border border-blue-200">
                <span class="text-[10px] uppercase font-bold text-blue-500">Rela√ß√£o Altura</span>
                <div class="font-mono font-bold text-brand-text">
                    <span class="text-brand-red">h</span>¬≤ = <span class="text-brand-blue">n</span> ¬∑ <span class="text-brand-orange">m</span>
                </div>
                <div class="text-xs mt-1 text-gray-500">4.8¬≤ = 3.6 ¬∑ 6.4</div>
            </div>
            <div class="bg-orange-50 p-2 rounded border border-orange-200">
                <span class="text-[10px] uppercase font-bold text-orange-500">Rela√ß√£o Cateto</span>
                <div class="font-mono font-bold text-brand-text">
                    b¬≤ = a ¬∑ <span class="text-brand-orange">m</span>
                </div>
                <div class="text-xs mt-1 text-gray-500">8¬≤ = 10 ¬∑ 6.4</div>
            </div>
        </div>

    </div>
    `;
                },

                interactive_pythagoras_proof(container) {
                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-green font-bold uppercase text-xs tracking-widest mb-6">Prova Visual</h3>

        <div class="relative w-64 h-64 mb-6">
            <svg viewBox="0 0 200 200" class="w-full h-full overflow-visible">
                <polygon points="80,80 80,140 160,140" fill="#e2e8f0" stroke="#475569" stroke-width="1" />
                
                <g id="sq-a" class="transition-all duration-1000">
                    <rect x="20" y="80" width="60" height="60" fill="#1CB0F6" opacity="0.8" />
                    <text x="50" y="110" text-anchor="middle" fill="white" font-weight="bold" font-size="12">a¬≤</text>
                </g>

                <g id="sq-b" class="transition-all duration-1000">
                    <rect x="80" y="140" width="80" height="80" fill="#FF9600" opacity="0.8" />
                    <text x="120" y="180" text-anchor="middle" fill="white" font-weight="bold" font-size="12">b¬≤</text>
                </g>

                <g id="sq-c-container" transform="rotate(-36.87 80 80)">
                    <rect x="80" y="0" width="100" height="100" fill="none" stroke="#58CC02" stroke-width="2" stroke-dasharray="4,4" />
                    <text x="130" y="50" text-anchor="middle" fill="#58CC02" font-weight="bold" font-size="12" transform="rotate(36.87 130 50)">c¬≤</text>
                </g>
            </svg>
        </div>

        <button id="btn-prove" class="bg-brand-purple text-white font-bold py-3 px-8 rounded-xl shadow-btn active:scale-95 transition-all">
            Mover √Åreas
        </button>

        <p id="proof-text" class="text-xs text-gray-400 mt-4 text-center h-8">
            As √°reas azul e laranja somadas preenchem o quadrado verde.
        </p>

    </div>
    `;

                    const btn = container.querySelector("#btn-prove");
                    const sqA = container.querySelector("#sq-a");
                    const sqB = container.querySelector("#sq-b");
                    const txt = container.querySelector("#proof-text");
                    let moved = false;

                    btn.onclick = () => {
                        if (!moved) {
                            // Anima√ß√£o complexa simplificada: Mover para o centro do quadrado C
                            // Hipotenusa Square Center (aprox visualmente): (130, 90) em coord global
                            // Vamos apenas fazer um fade/transform para indicar que "foram para l√°"

                            // Para fazer bonito, ter√≠amos que quebrar o quadrado B em pe√ßas (Perigal's Dissection).
                            // Como √© CSS simples, vamos mover para dentro da √°rea C e mudar a cor.

                            // Coordenadas alvo (dentro do quadrado verde)
                            // Quadrado A vai para um canto, B para o resto.

                            // Hack visual: Mover e Scalonar para "entrar"
                            sqA.style.transform =
                                "translate(60px, -20px) rotate(-36.87deg)";
                            sqB.style.transform =
                                "translate(20px, -60px) rotate(-36.87deg)";
                            // Na pr√°tica, sem dissec√ß√£o, eles v√£o sobrepor feio se n√£o cortarmos.
                            // Vamos mudar a abordagem para "Preencher"

                            sqA.style.opacity = "0";
                            sqB.style.opacity = "0";

                            setTimeout(() => {
                                const cContainer = container.querySelector("#sq-c-container");
                                cContainer.innerHTML += `
                    <rect x="80" y="0" width="100" height="100" fill="#58CC02" opacity="0.5" class="animate-pop-in" />
                    <text x="130" y="50" text-anchor="middle" fill="white" font-weight="bold" font-size="12">a¬≤ + b¬≤</text>
                `;
                                txt.innerHTML =
                                    "<span class='text-brand-green font-bold'>PROVADO!</span> A √°rea verde (c¬≤) √© a soma das outras duas.";
                            }, 500);

                            btn.innerText = "Reiniciar";
                            btn.classList.replace("bg-brand-purple", "bg-gray-500");
                            moved = true;
                        } else {
                            // Reset (rebuild widget cheaply)
                            app.widgets.interactive_pythagoras_proof(container);
                        }
                    };
                },

                interactive_diagonal_height_demo(container) {
                    let mode = "square"; // or 'triangle'

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex bg-gray-100 p-1 rounded-lg mb-6 w-full max-w-xs">
            <button class="mode-btn flex-1 py-2 rounded text-xs font-bold uppercase transition-colors bg-white text-brand-blue shadow-sm" data-m="square">Quadrado</button>
            <button class="mode-btn flex-1 py-2 rounded text-xs font-bold uppercase transition-colors text-gray-400 hover:bg-white" data-m="triangle">Tri√¢ngulo</button>
        </div>

        <div class="relative w-48 h-48 flex items-center justify-center mb-6">
            <svg id="app-svg" width="200" height="200" viewBox="0 0 200 200" class="overflow-visible transition-all duration-500">
                <g id="g-square">
                    <rect x="50" y="50" width="100" height="100" fill="none" stroke="#4B4B4B" stroke-width="2" />
                    <line x1="50" y1="150" x2="150" y2="50" stroke="#1CB0F6" stroke-width="3" stroke-dasharray="4" />
                    <text x="100" y="165" font-size="12" font-weight="bold" fill="#4B4B4B">l</text>
                    <text x="160" y="100" font-size="12" font-weight="bold" fill="#4B4B4B">l</text>
                    <text x="90" y="90" font-size="14" font-weight="bold" fill="#1CB0F6">d</text>
                </g>
                
                <g id="g-triangle" class="opacity-0" style="display:none">
                    <polygon points="50,150 150,150 100,63.4" fill="none" stroke="#4B4B4B" stroke-width="2" />
                    <line x1="100" y1="63.4" x2="100" y2="150" stroke="#FF9600" stroke-width="3" stroke-dasharray="4" />
                    <text x="100" y="165" font-size="12" font-weight="bold" fill="#4B4B4B">l</text>
                    <text x="105" y="110" font-size="14" font-weight="bold" fill="#FF9600">h</text>
                </g>
            </svg>
        </div>

        <div class="bg-gray-50 border border-gray-200 rounded-xl p-4 w-full text-center">
            <p class="text-xs text-gray-500 font-bold uppercase mb-2">Aplica√ß√£o de Pit√°goras</p>
            <div id="formula-step" class="font-mono text-sm text-gray-600 mb-2">
                $d^2 = l^2 + l^2$
            </div>
            <div id="formula-final" class="font-black text-2xl text-brand-blue">
                d = l$\\sqrt{2}$
            </div>
        </div>

    </div>
    `;

                    const gSq = container.querySelector("#g-square");
                    const gTri = container.querySelector("#g-triangle");
                    const step = container.querySelector("#formula-step");
                    const final = container.querySelector("#formula-final");
                    const btns = container.querySelectorAll(".mode-btn");

                    const update = () => {
                        if (mode === "square") {
                            gSq.style.display = "block";
                            gSq.style.opacity = "1";
                            gTri.style.display = "none";
                            gTri.style.opacity = "0";

                            step.innerHTML = "d¬≤ = l¬≤ + l¬≤ &rightarrow; d¬≤ = 2l¬≤";
                            final.innerHTML = "d = l$\\sqrt{2}$";
                            final.className = "font-black text-2xl text-brand-blue";
                        } else {
                            gSq.style.display = "none";
                            gSq.style.opacity = "0";
                            gTri.style.display = "block";
                            gTri.style.opacity = "1";

                            // Altura divide base ao meio (l/2)
                            step.innerHTML = "l¬≤ = h¬≤ + (l/2)¬≤ &rightarrow; h¬≤ = l¬≤ - l¬≤/4";
                            final.innerHTML = "h = $\\frac{l\\sqrt{3}}{2}$";
                            final.className = "font-black text-2xl text-brand-orange";
                        }

                        // Render latex
                        if (window.renderMathInElement) renderMathInElement(final);
                    };

                    btns.forEach((b) => {
                        b.onclick = () => {
                            mode = b.dataset.m;
                            btns.forEach(
                                (x) =>
                                (x.className =
                                    "mode-btn flex-1 py-2 rounded text-xs font-bold uppercase transition-colors text-gray-400 hover:bg-white")
                            );
                            b.className = `mode-btn flex-1 py-2 rounded text-xs font-bold uppercase transition-colors bg-white ${mode === "square" ? "text-brand-blue" : "text-brand-orange"
                                } shadow-sm`;
                            update();
                        };
                    });
                },

                interactive_trig_eye(container) {
                    let activePart = null;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">O Olhar Trigonom√©trico</h3>

        <div class="relative w-[300px] h-[200px] mb-4 cursor-pointer">
            <svg viewBox="0 0 300 200" class="w-full h-full">
                <path d="M 50 150 L 250 150 L 250 50 Z" fill="none" stroke="#4B4B4B" stroke-width="2" />
                <rect x="240" y="140" width="10" height="10" fill="none" stroke="#4B4B4B" />

                <g id="eye-group" transform="translate(50, 150)">
                    <path d="M 30 0 A 30 30 0 0 0 27 -13" fill="none" stroke="#F59E0B" stroke-width="2" />
                    <text x="40" y="-10" fill="#F59E0B" font-weight="bold" font-size="16">Œ∏</text>
                    <text x="-10" y="10" font-size="20">üëÅÔ∏è</text>
                </g>

                <g class="hover:opacity-100 opacity-0 transition-opacity" id="hl-opp">
                    <line x1="250" y1="150" x2="250" y2="50" stroke="#EF4444" stroke-width="6" />
                </g>
                <g class="hover:opacity-100 opacity-0 transition-opacity" id="hl-adj">
                    <line x1="50" y1="150" x2="250" y2="150" stroke="#1CB0F6" stroke-width="6" />
                </g>
                <g class="hover:opacity-100 opacity-0 transition-opacity" id="hl-hyp">
                    <line x1="50" y1="150" x2="250" y2="50" stroke="#58CC02" stroke-width="6" />
                </g>

                <text x="260" y="100" fill="#EF4444" font-weight="bold" font-size="12" class="opacity-50" id="txt-opp">Oposto</text>
                <text x="150" y="170" fill="#1CB0F6" font-weight="bold" font-size="12" text-anchor="middle" class="opacity-50" id="txt-adj">Adjacente</text>
                <text x="140" y="90" fill="#58CC02" font-weight="bold" font-size="12" text-anchor="middle" class="opacity-50" id="txt-hyp">Hipotenusa</text>
            </svg>
        </div>

        <div class="flex gap-2 justify-center w-full">
            <button class="trig-btn bg-red-100 text-red-700 px-3 py-1 rounded-lg text-xs font-bold border border-red-200" onmouseover="app.widgets.hlTrig('opp')" onmouseout="app.widgets.hlTrig(null)">Oposto</button>
            <button class="trig-btn bg-blue-100 text-blue-700 px-3 py-1 rounded-lg text-xs font-bold border border-blue-200" onmouseover="app.widgets.hlTrig('adj')" onmouseout="app.widgets.hlTrig(null)">Adjacente</button>
            <button class="trig-btn bg-green-100 text-green-700 px-3 py-1 rounded-lg text-xs font-bold border border-green-200" onmouseover="app.widgets.hlTrig('hyp')" onmouseout="app.widgets.hlTrig(null)">Hipotenusa</button>
        </div>

        <div id="trig-explainer" class="mt-4 h-12 text-center text-sm font-medium text-gray-500">
            Passe o mouse nos bot√µes para identificar os lados.
        </div>

    </div>
    `;

                    const labels = {
                        opp: container.querySelector("#txt-opp"),
                        adj: container.querySelector("#txt-adj"),
                        hyp: container.querySelector("#txt-hyp"),
                    };
                    const lines = {
                        opp: container.querySelector("#hl-opp"),
                        adj: container.querySelector("#hl-adj"),
                        hyp: container.querySelector("#hl-hyp"),
                    };
                    const explain = container.querySelector("#trig-explainer");

                    app.widgets.hlTrig = (part) => {
                        // Reset
                        Object.values(labels).forEach((l) =>
                            l.classList.add("opacity-50")
                        );
                        Object.values(lines).forEach((l) =>
                            l.classList.remove("opacity-100")
                        );

                        if (part) {
                            labels[part].classList.remove("opacity-50");
                            lines[part].classList.add("opacity-100");

                            if (part === "opp")
                                explain.innerHTML =
                                    "Oposto: Est√° <strong>l√° longe</strong>, do outro lado do olho.";
                            if (part === "adj")
                                explain.innerHTML =
                                    "Adjacente: Est√° <strong>junto</strong>, ajudando a formar o √¢ngulo.";
                            if (part === "hyp")
                                explain.innerHTML =
                                    "Hipotenusa: O maior lado, sempre oposto ao √¢ngulo reto.";
                        } else {
                            explain.innerText =
                                "Passe o mouse nos bot√µes para identificar os lados.";
                        }
                    };
                },

                interactive_trig_table_builder(container) {
                    const values = [
                        { ang: 30, sin: "1/2", cos: "‚àö3/2", tan: "‚àö3/3" },
                        { ang: 45, sin: "‚àö2/2", cos: "‚àö2/2", tan: "1" },
                        { ang: 60, sin: "‚àö3/2", cos: "1/2", tan: "‚àö3" },
                    ];

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-4 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-x-auto">
        <h3 class="text-brand-text font-bold uppercase text-xs tracking-widest mb-4">Construtor da Tabela</h3>

        <div class="grid grid-cols-4 gap-1 min-w-[300px] text-center mb-4">
            <div class="bg-gray-100 p-2 rounded font-bold text-xs text-gray-500">√Çngulo</div>
            <div class="bg-purple-100 p-2 rounded font-bold text-xs text-brand-purple">30¬∞</div>
            <div class="bg-purple-100 p-2 rounded font-bold text-xs text-brand-purple">45¬∞</div>
            <div class="bg-purple-100 p-2 rounded font-bold text-xs text-brand-purple">60¬∞</div>

            <div class="bg-blue-100 p-2 rounded font-bold text-xs text-brand-blue flex items-center justify-center">SEN</div>
            <div class="cell bg-white border p-2 rounded text-sm cursor-pointer hover:bg-blue-50" data-r="0" data-c="0">?</div>
            <div class="cell bg-white border p-2 rounded text-sm cursor-pointer hover:bg-blue-50" data-r="0" data-c="1">?</div>
            <div class="cell bg-white border p-2 rounded text-sm cursor-pointer hover:bg-blue-50" data-r="0" data-c="2">?</div>

            <div class="bg-orange-100 p-2 rounded font-bold text-xs text-brand-orange flex items-center justify-center">COS</div>
            <div class="cell bg-white border p-2 rounded text-sm cursor-pointer hover:bg-orange-50" data-r="1" data-c="0">?</div>
            <div class="cell bg-white border p-2 rounded text-sm cursor-pointer hover:bg-orange-50" data-r="1" data-c="1">?</div>
            <div class="cell bg-white border p-2 rounded text-sm cursor-pointer hover:bg-orange-50" data-r="1" data-c="2">?</div>

            <div class="bg-green-100 p-2 rounded font-bold text-xs text-brand-green flex items-center justify-center">TAN</div>
            <div class="cell bg-white border p-2 rounded text-sm cursor-pointer hover:bg-green-50" data-r="2" data-c="0">?</div>
            <div class="cell bg-white border p-2 rounded text-sm cursor-pointer hover:bg-green-50" data-r="2" data-c="1">?</div>
            <div class="cell bg-white border p-2 rounded text-sm cursor-pointer hover:bg-green-50" data-r="2" data-c="2">?</div>
        </div>

        <p class="text-xs text-center text-gray-400 font-medium">
            Dica: 1, 2, 3... 3, 2, 1... Tudo sobre 2!
        </p>

        <button id="btn-fill-table" class="mt-4 bg-brand-blue text-white font-bold py-2 px-6 rounded-xl shadow-btn active:scale-95 transition-all text-xs">
            Revelar Tabela
        </button>

    </div>
    `;

                    const cells = container.querySelectorAll(".cell");
                    const btn = container.querySelector("#btn-fill-table");

                    btn.onclick = () => {
                        cells.forEach((c) => {
                            const r = parseInt(c.dataset.r); // 0=sin, 1=cos, 2=tan
                            const col = parseInt(c.dataset.c); // 0=30, 1=45, 2=60

                            let val = "";
                            if (r === 0) val = values[col].sin;
                            else if (r === 1) val = values[col].cos;
                            else val = values[col].tan;

                            // Animate reveal
                            c.innerText = val;
                            c.classList.add("bg-gray-50", "font-black");
                            c.classList.remove("text-gray-400");
                        });

                        btn.innerText = "Limpar";
                        btn.onclick = () => {
                            container.innerHTML = ""; // Cheap reset
                            app.widgets.interactive_trig_table_builder(container);
                        };
                    };
                },

                interactive_metric_relations(container) {
                    let mode = "chord"; // chord, secant, tangent

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex gap-2 mb-6 bg-gray-100 p-1 rounded-lg w-full max-w-sm">
            <button class="mode-btn flex-1 py-2 text-xs font-bold uppercase rounded shadow-sm bg-white text-brand-blue" data-m="chord">Cordas</button>
            <button class="mode-btn flex-1 py-2 text-xs font-bold uppercase rounded text-gray-500 hover:bg-white" data-m="secant">Secantes</button>
            <button class="mode-btn flex-1 py-2 text-xs font-bold uppercase rounded text-gray-500 hover:bg-white" data-m="tangent">Tangente</button>
        </div>

        <div class="relative w-64 h-64 mb-6 bg-gray-50 rounded-full border border-gray-200 shadow-inner flex items-center justify-center">
            <svg width="256" height="256" viewBox="0 0 256 256" class="absolute overflow-visible">
                <circle cx="128" cy="128" r="80" fill="white" stroke="#94a3b8" stroke-width="2" />
                <circle cx="128" cy="128" r="3" fill="#cbd5e1" />
                
                <g id="lines-group"></g>
                <g id="labels-group"></g>
            </svg>
        </div>

        <div class="bg-gray-800 text-white p-4 rounded-xl text-center shadow-lg w-full max-w-xs">
            <p class="text-[10px] font-bold text-gray-400 uppercase mb-2">Rela√ß√£o M√©trica</p>
            <div class="font-mono text-lg" id="formula-display"></div>
            <div class="font-black text-xl text-brand-green mt-1" id="calc-display"></div>
        </div>

    </div>
    `;

                    const groupLines = container.querySelector("#lines-group");
                    const groupLabels = container.querySelector("#labels-group");
                    const formulaDisp = container.querySelector("#formula-display");
                    const calcDisp = container.querySelector("#calc-display");
                    const btns = container.querySelectorAll(".mode-btn");

                    const render = () => {
                        groupLines.innerHTML = "";
                        groupLabels.innerHTML = "";

                        if (mode === "chord") {
                            // Cordas Cruzadas
                            // P √© o cruzamento interno
                            // A-P-B e C-P-D

                            // Desenho est√°tico com valores did√°ticos
                            // Corda 1: Vertical. A(128, 48), B(128, 208). P(128, 140).
                            // PA = 140-48 = 92 (px). PB = 208-140 = 68.
                            // Corda 2: Horizontal. C(48, 140), D(208, 140).

                            // Vamos usar valores matem√°ticos simples para o exemplo: 3*8 = 4*6 = 24.
                            // PA=3, PB=8. PC=4, PD=6.

                            // Visualiza√ß√£o Esquem√°tica
                            groupLines.innerHTML = `
                <line x1="80" y1="60" x2="180" y2="180" stroke="#1CB0F6" stroke-width="4" stroke-linecap="round" />
                <line x1="60" y1="160" x2="200" y2="80" stroke="#FF9600" stroke-width="4" stroke-linecap="round" />
                <circle cx="130" cy="120" r="4" fill="black" /> `;

                            // Labels com valores
                            groupLabels.innerHTML = `
                <text x="95" y="80" font-weight="bold" fill="#1CB0F6">3</text>
                <text x="160" y="160" font-weight="bold" fill="#1CB0F6">8</text>
                
                <text x="80" y="150" font-weight="bold" fill="#FF9600">4</text>
                <text x="170" y="90" font-weight="bold" fill="#FF9600">6</text>
                <text x="130" y="110" font-size="10" font-weight="bold" fill="#666">P</text>
            `;

                            formulaDisp.innerHTML = `<span class="text-blue-400">3</span>¬∑<span class="text-blue-400">8</span> = <span class="text-orange-400">4</span>¬∑<span class="text-orange-400">6</span>`;
                            calcDisp.innerText = "24 = 24";
                        } else if (mode === "secant") {
                            // Secantes (P externo)
                            // Total * Externo = Total * Externo
                            // Ex: (3+5)*3 = (2+10)*2 -> 24 = 24.
                            // Linha 1: Ext=3, Int=5. Total=8.
                            // Linha 2: Ext=2, Int=10. Total=12.

                            groupLines.innerHTML = `
                <line x1="128" y1="250" x2="80" y2="80" stroke="#1CB0F6" stroke-width="4" />
                <line x1="128" y1="250" x2="180" y2="60" stroke="#FF9600" stroke-width="4" />
                
                <circle cx="128" cy="250" r="4" fill="black" /> <text x="128" y="270" font-size="12" font-weight="bold" text-anchor="middle">P</text>
            `;
                            // Ajuste visual para parecer que cortam o c√≠rculo
                            // O SVG viewbox √© 256x256. P(128, 250) est√° bem abaixo.

                            groupLabels.innerHTML = `
                <text x="120" y="220" font-weight="bold" fill="#1CB0F6" font-size="12">Ext: 3</text>
                <text x="90" y="120" font-weight="bold" fill="#1CB0F6" font-size="12">Int: 5</text>
                
                <text x="145" y="220" font-weight="bold" fill="#FF9600" font-size="12">Ext: 2</text>
                <text x="170" y="120" font-weight="bold" fill="#FF9600" font-size="12">Int: 10</text>
            `;

                            formulaDisp.innerHTML = `8¬∑<span class="text-blue-400">3</span> = 12¬∑<span class="text-orange-400">2</span>`;
                            calcDisp.innerText = "24 = 24";
                        } else {
                            // Tangente (P externo)
                            // Tan¬≤ = Total * Externo
                            // Tan = 6. Secante: Ext=4, Int=5. Total=9. 6^2 = 9*4 = 36.

                            groupLines.innerHTML = `
                <line x1="10" y1="128" x2="128" y2="128" stroke="#1CB0F6" stroke-width="4" /> <line x1="10" y1="128" x2="80" y2="200" stroke="#CE82FF" stroke-width="4" /> <circle cx="10" cy="128" r="4" fill="black" /> <text x="5" y="145" font-size="12" font-weight="bold">P</text>
            `;

                            groupLabels.innerHTML = `
                <text x="30" y="120" font-weight="bold" fill="#1CB0F6" font-size="12">Ext: 4</text>
                <text x="90" y="120" font-weight="bold" fill="#1CB0F6" font-size="12">Int: 5</text>
                <text x="20" y="180" font-weight="bold" fill="#CE82FF" font-size="12">Tan: 6</text>
            `;

                            formulaDisp.innerHTML = `<span class="text-purple-400">6</span>¬≤ = 9¬∑<span class="text-blue-400">4</span>`;
                            calcDisp.innerText = "36 = 36";
                        }
                    };

                    btns.forEach((btn) => {
                        btn.onclick = () => {
                            mode = btn.dataset.m;
                            btns.forEach(
                                (b) =>
                                (b.className =
                                    "mode-btn flex-1 py-2 text-xs font-bold uppercase rounded text-gray-500 hover:bg-white")
                            );
                            btn.className =
                                "mode-btn flex-1 py-2 text-xs font-bold uppercase rounded shadow-sm bg-white text-brand-blue";
                            render();
                        };
                    });

                    render();
                },

                interactive_inscribed_circumscribed(container) {
                    let mode = "ins"; // ins, circ
                    let shape = "square"; // tri, square, hex

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex gap-2 w-full max-w-sm mb-4">
            <button class="s-btn flex-1 bg-white border border-gray-200 text-gray-500 py-1 rounded text-xl" data-s="tri">‚ñ≤</button>
            <button class="s-btn flex-1 bg-blue-100 border border-brand-blue text-brand-blue py-1 rounded text-xl shadow-sm" data-s="square">‚ñ†</button>
            <button class="s-btn flex-1 bg-white border border-gray-200 text-gray-500 py-1 rounded text-xl" data-s="hex">‚¨°</button>
        </div>

        <div class="relative w-64 h-64 bg-gray-50 rounded-xl border border-gray-200 flex items-center justify-center mb-6 overflow-hidden">
            <svg width="200" height="200" viewBox="0 0 200 200" class="transition-all duration-500" id="main-svg">
                <circle cx="100" cy="100" r="80" fill="none" stroke="#4B4B4B" stroke-width="2" id="ref-circle" />
                
                <path id="poly-path" d="" fill="rgba(28, 176, 246, 0.2)" stroke="#1CB0F6" stroke-width="3" />
                
                <g id="helpers"></g>
            </svg>
        </div>

        <div class="flex gap-4 w-full max-w-xs">
            <button class="m-btn flex-1 bg-brand-green text-white font-bold py-2 rounded-lg shadow-sm active:scale-95 transition-all" data-m="ins">Inscrito (Dentro)</button>
            <button class="m-btn flex-1 bg-white border-2 border-brand-orange text-brand-orange font-bold py-2 rounded-lg active:scale-95 transition-all" data-m="circ">Circunscrito (Fora)</button>
        </div>

    </div>
    `;

                    const svgPath = container.querySelector("#poly-path");
                    const svgHelpers = container.querySelector("#helpers");
                    const sBtns = container.querySelectorAll(".s-btn");
                    const mBtns = container.querySelectorAll(".m-btn");

                    const update = () => {
                        const cx = 100,
                            cy = 100;
                        let r_poly;
                        let sides = shape === "tri" ? 3 : shape === "square" ? 4 : 6;
                        const r_circle = 80;

                        // Logic:
                        // Inscrito: V√©rtices do pol√≠gono tocam o c√≠rculo (Raio Pol√≠gono = Raio C√≠rculo)
                        // Circunscrito: Lados do pol√≠gono tangenciam o c√≠rculo (Ap√≥tema Pol√≠gono = Raio C√≠rculo)

                        if (mode === "ins") {
                            r_poly = r_circle;
                        } else {
                            // Apothem = r_circle.
                            // a = R * cos(PI/n) -> R = a / cos(PI/n)
                            r_poly = r_circle / Math.cos(Math.PI / sides);
                        }

                        // Draw Polygon
                        let d = "";
                        for (let i = 0; i < sides; i++) {
                            // Start at -90 deg (top)
                            const angle = (i * 2 * Math.PI) / sides - Math.PI / 2;
                            const x = cx + r_poly * Math.cos(angle);
                            const y = cy + r_poly * Math.sin(angle);
                            d += (i === 0 ? "M " : "L ") + `${x} ${y} `;
                        }
                        d += "Z";
                        svgPath.setAttribute("d", d);

                        // Helpers (Radius and Apothem line)
                        // Draw line to first vertex (Radius) and midpoint of side (Apothem)
                        const angle0 = -Math.PI / 2;
                        const vX = cx + r_poly * Math.cos(angle0);
                        const vY = cy + r_poly * Math.sin(angle0);

                        const angleMid = angle0 + Math.PI / sides;
                        // Midpoint of side
                        const a_len = r_poly * Math.cos(Math.PI / sides);
                        const aX = cx + a_len * Math.cos(angleMid);
                        const aY = cy + a_len * Math.sin(angleMid);

                        // Visual lines
                        let helpersHTML = "";
                        // Line Center -> Vertex (Radius of Polygon)
                        helpersHTML += `<line x1="${cx}" y1="${cy}" x2="${vX}" y2="${vY}" stroke="#CE82FF" stroke-width="2" stroke-dasharray="4,2" />`;
                        // Line Center -> Side (Apothem)
                        helpersHTML += `<line x1="${cx}" y1="${cy}" x2="${aX}" y2="${aY}" stroke="#FF9600" stroke-width="2" />`;

                        svgHelpers.innerHTML = helpersHTML;

                        // Toggle Buttons Style
                        mBtns.forEach((b) => {
                            if (b.dataset.m === mode) {
                                b.className =
                                    "m-btn flex-1 bg-brand-green text-white font-bold py-2 rounded-lg shadow-sm active:scale-95 transition-all";
                            } else {
                                b.className =
                                    "m-btn flex-1 bg-white border-2 border-brand-green text-brand-green font-bold py-2 rounded-lg active:scale-95 transition-all";
                            }
                        });
                    };

                    sBtns.forEach(
                        (b) =>
                        (b.onclick = () => {
                            shape = b.dataset.s;
                            sBtns.forEach((btn) => {
                                if (btn === b)
                                    btn.className =
                                        "s-btn flex-1 bg-blue-100 border border-brand-blue text-brand-blue py-1 rounded text-xl shadow-sm";
                                else
                                    btn.className =
                                        "s-btn flex-1 bg-white border border-gray-200 text-gray-500 py-1 rounded text-xl";
                            });
                            update();
                        })
                    );

                    mBtns.forEach(
                        (b) =>
                        (b.onclick = () => {
                            mode = b.dataset.m;
                            update();
                        })
                    );

                    update();
                },

                interactive_apothem_finder(container) {
                    let sideCount = 6; // Hexagon default

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-yellow font-bold uppercase text-xs tracking-widest mb-4">O Tri√¢ngulo Sagrado</h3>
        
        <div class="relative w-64 h-64 bg-gray-900 rounded-full border-4 border-gray-700 flex items-center justify-center mb-6 overflow-hidden">
            <svg width="250" height="250" viewBox="0 0 250 250" class="absolute">
                <path id="poly-wire" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="1" />
                
                <path id="tri-main" fill="rgba(234, 179, 8, 0.2)" stroke="#EAB308" stroke-width="2" />
                
                <text x="125" y="125" id="lbl-R" fill="#A855F7" font-size="12" font-weight="bold">R</text>
                <text x="125" y="125" id="lbl-a" fill="#F97316" font-size="12" font-weight="bold">a</text>
                <text x="125" y="125" id="lbl-L" fill="#1CB0F6" font-size="12" font-weight="bold">L/2</text>
            </svg>
        </div>

        <div class="flex gap-2 w-full justify-center mb-4">
            <button class="poly-sel bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded text-xs font-bold" data-n="3">Tri√¢ngulo</button>
            <button class="poly-sel bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded text-xs font-bold" data-n="4">Quadrado</button>
            <button class="poly-sel bg-yellow-100 text-yellow-700 ring-2 ring-yellow-400 px-3 py-1 rounded text-xs font-bold" data-n="6">Hex√°gono</button>
        </div>

        <div class="bg-gray-100 p-3 rounded-lg text-center w-full">
            <p class="font-mono text-sm text-gray-700">Pit√°goras nele!</p>
            <p class="font-black text-xl text-brand-text mt-1">R¬≤ = a¬≤ + (L/2)¬≤</p>
        </div>

    </div>
    `;

                    const polyWire = container.querySelector("#poly-wire");
                    const triMain = container.querySelector("#tri-main");
                    const lblR = container.querySelector("#lbl-R");
                    const lblA = container.querySelector("#lbl-a");
                    const lblL = container.querySelector("#lbl-L");
                    const btns = container.querySelectorAll(".poly-sel");

                    const update = () => {
                        const cx = 125,
                            cy = 125,
                            r = 100;

                        // Draw Full Polygon
                        let d = "";
                        for (let i = 0; i < sideCount; i++) {
                            const angle = (i * 2 * Math.PI) / sideCount - Math.PI / 2;
                            const x = cx + r * Math.cos(angle);
                            const y = cy + r * Math.sin(angle);
                            d += (i === 0 ? "M " : "L ") + `${x} ${y} `;
                        }
                        d += "Z";
                        polyWire.setAttribute("d", d);

                        // Draw Right Triangle (Center -> Top Vertex -> Midpoint of next side? No.)
                        // Right triangle is: Center -> Vertex -> Midpoint of side connected to that vertex.
                        // Vertex 0 (Top): -PI/2.
                        // Vertex 1: -PI/2 + 2PI/n.
                        // Midpoint of side 0-1: Angle is -PI/2 + PI/n.

                        const angleV = -Math.PI / 2;
                        const angleM = -Math.PI / 2 + Math.PI / sideCount;

                        const Vx = cx + r * Math.cos(angleV);
                        const Vy = cy + r * Math.sin(angleV);

                        const aLen = r * Math.cos(Math.PI / sideCount); // Apothem length
                        const Mx = cx + aLen * Math.cos(angleM);
                        const My = cy + aLen * Math.sin(angleM);

                        // Triangle Path: Center -> V -> M -> Center
                        // Wait, right triangle is Center -> M -> V
                        // Radius is Center-V. Apothem is Center-M. L/2 is V-M.
                        triMain.setAttribute(
                            "d",
                            `M ${cx} ${cy} L ${Mx} ${My} L ${Vx} ${Vy} Z`
                        );

                        // Labels Positions
                        // R (Hypotenuse): Midpoint of Center-V
                        lblR.setAttribute("x", (cx + Vx) / 2 - 10);
                        lblR.setAttribute("y", (cy + Vy) / 2);

                        // a (Cathetus): Midpoint of Center-M
                        lblA.setAttribute("x", (cx + Mx) / 2 + 5);
                        lblA.setAttribute("y", (cy + My) / 2 + 10);

                        // L/2 (Cathetus): Midpoint of M-V
                        lblL.setAttribute("x", (Mx + Vx) / 2 + 10);
                        lblL.setAttribute("y", (My + Vy) / 2 - 5);
                    };

                    btns.forEach((b) => {
                        b.onclick = () => {
                            sideCount = parseInt(b.dataset.n);
                            btns.forEach(
                                (x) =>
                                (x.className =
                                    "poly-sel bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded text-xs font-bold text-gray-600")
                            );
                            b.className =
                                "poly-sel bg-yellow-100 text-yellow-700 ring-2 ring-yellow-400 px-3 py-1 rounded text-xs font-bold";
                            update();
                        };
                    });

                    update();
                },

                interactive_sector_slice(container) {
                    let angle = 90;
                    const r = 4; // visual radius, fixed math radius for calc

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Cortador de Pizza (Setor)</h3>

        <div class="flex gap-8 items-center w-full justify-center mb-6">
            <div class="relative w-40 h-40">
                <svg width="160" height="160" viewBox="0 0 200 200">
                    <circle cx="100" cy="100" r="90" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1" />
                    <path id="sector-path" d="" fill="#1CB0F6" stroke="#0ea5e9" stroke-width="2" fill-opacity="0.5" />
                    <line x1="100" y1="100" x2="190" y2="100" stroke="#475569" stroke-width="2" stroke-dasharray="4" /> </svg>
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 font-bold text-gray-500 text-xs pointer-events-none">r = 10cm</div>
            </div>

            <div class="text-center">
                <p class="text-xs font-bold text-gray-400 uppercase">Fra√ß√£o</p>
                <div class="text-xl font-mono font-bold text-brand-blue" id="ratio-display">1/4</div>
                <div class="h-px bg-gray-300 w-12 mx-auto my-1"></div>
                <div class="text-xs text-gray-400">do c√≠rculo</div>
            </div>
        </div>

        <input type="range" id="angle-input" min="1" max="360" value="90" class="w-full max-w-xs h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer accent-brand-blue mb-2">
        <p class="text-center font-bold text-brand-blue mb-4">√Çngulo: <span id="angle-val">90</span>¬∞</p>

        <div class="bg-gray-100 p-3 rounded-lg text-center w-full max-w-sm">
            <p class="text-[10px] text-gray-500 uppercase font-bold">√Årea do Setor</p>
            <p class="font-mono text-lg text-gray-800">
                <span id="math-angle">90</span>/360 ¬∑ œÄ¬∑10¬≤ ‚âà <strong class="text-brand-green" id="math-res">78.5</strong> cm¬≤
            </p>
        </div>

    </div>
    `;

                    const slider = container.querySelector("#angle-input");
                    const path = container.querySelector("#sector-path");
                    const angleDisplay = container.querySelector("#angle-val");
                    const ratioDisplay = container.querySelector("#ratio-display");
                    const mathAngle = container.querySelector("#math-angle");
                    const mathRes = container.querySelector("#math-res");

                    const update = () => {
                        angle = parseInt(slider.value);
                        angleDisplay.innerText = angle;
                        mathAngle.innerText = angle;

                        // SVG Path
                        // Center 100,100. Radius 90.
                        // Start angle 0 (Right, 190, 100).
                        // End angle 'angle' (Clockwise? SVG y is down, so positive angle is clockwise from X axis).
                        // Let's use negative angle for intuitive Counter-Clockwise "Math" feel?
                        // Pizza usually cuts clockwise. Let's stick to SVG standard (clockwise from 3 o'clock).

                        const rad = angle * (Math.PI / 180);
                        const x = 100 + 90 * Math.cos(rad);
                        const y = 100 + 90 * Math.sin(rad); // y grows down

                        // Large arc flag
                        const large = angle > 180 ? 1 : 0;

                        // Invert Y to make it open Upwards (Counter-Clockwise)?
                        // Math standard: 0 is Right. 90 is Up.
                        // SVG: 0 is Right. 90 is Down.
                        // Let's negate the sin component to make it go UP (CCW).
                        const yCCW = 100 - 90 * Math.sin(rad);

                        // Path: M center L start A ... L center
                        const d = `M 100 100 L 190 100 A 90 90 0 ${large} 0 ${x} ${yCCW} Z`;
                        // Sweep flag 0 for CCW arc

                        path.setAttribute("d", d);

                        // Calc
                        const totalArea = Math.PI * 100; // r=10
                        const sectorArea = (angle / 360) * totalArea;
                        mathRes.innerText = sectorArea.toFixed(1);

                        // Ratio text
                        const gcd = (a, b) => (b ? gcd(b, a % b) : a);
                        const div = gcd(angle, 360);
                        ratioDisplay.innerText = `${angle / div}/${360 / div}`;
                    };

                    slider.addEventListener("input", update);
                    update();
                },

                interactive_annulus_calc(container) {
                    let R = 10;
                    let r = 5;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-4">Calculadora de Coroa (Donut)</h3>

        <div class="relative w-64 h-64 mb-6 flex items-center justify-center">
            <svg width="240" height="240" viewBox="0 0 240 240">
                <circle cx="120" cy="120" r="${R * 10
                        }" fill="#FFedd5" stroke="#f97316" stroke-width="2" id="circle-R" />
                <circle cx="120" cy="120" r="${r * 10
                        }" fill="white" stroke="#94a3b8" stroke-width="2" stroke-dasharray="4" id="circle-r" />
                
                <line x1="120" y1="120" x2="220" y2="120" stroke="#f97316" stroke-width="2" id="line-R" />
                <text x="170" y="115" font-size="12" fill="#f97316" font-weight="bold">R</text>

                <line x1="120" y1="120" x2="120" y2="70" stroke="#64748b" stroke-width="2" id="line-r" />
                <text x="125" y="95" font-size="12" fill="#64748b" font-weight="bold">r</text>
            </svg>
        </div>

        <div class="flex gap-8 w-full max-w-sm mb-6">
            <div class="flex-1">
                <label class="text-[10px] uppercase font-bold text-gray-400">Raio Maior (R)</label>
                <input type="range" id="slider-R" min="6" max="11" value="10" class="w-full h-2 bg-orange-100 rounded-lg accent-brand-orange">
                <div class="text-center font-bold text-brand-orange" id="val-R">10</div>
            </div>
            <div class="flex-1">
                <label class="text-[10px] uppercase font-bold text-gray-400">Raio Menor (r)</label>
                <input type="range" id="slider-r" min="1" max="9" value="5" class="w-full h-2 bg-gray-200 rounded-lg accent-gray-500">
                <div class="text-center font-bold text-gray-500" id="val-r">5</div>
            </div>
        </div>

        <div class="bg-gray-800 text-white p-4 rounded-xl text-center shadow w-full max-w-sm">
            <p class="font-mono text-sm mb-1">A = œÄ(R¬≤ - r¬≤)</p>
            <p class="font-mono">œÄ(<span id="calc-R2">100</span> - <span id="calc-r2">25</span>)</p>
            <p class="text-2xl font-black text-brand-yellow mt-2">A ‚âà <span id="res-area">235.6</span></p>
        </div>
    </div>
    `;

                    const sR = container.querySelector("#slider-R");
                    const sr = container.querySelector("#slider-r");
                    const cR = container.querySelector("#circle-R");
                    const cr = container.querySelector("#circle-r");
                    const lR = container.querySelector("#line-R");
                    const lr = container.querySelector("#line-r");
                    const vR = container.querySelector("#val-R");
                    const vr = container.querySelector("#val-r");

                    const cR2 = container.querySelector("#calc-R2");
                    const cr2 = container.querySelector("#calc-r2");
                    const res = container.querySelector("#res-area");

                    const update = () => {
                        R = parseInt(sR.value);
                        r = parseInt(sr.value);

                        // Constraint: r < R
                        if (r >= R) {
                            r = R - 1;
                            sr.value = r;
                        }

                        vR.innerText = R;
                        vr.innerText = r;

                        // Visual (Scale 10x)
                        cR.setAttribute("r", R * 10);
                        cr.setAttribute("r", r * 10);
                        lR.setAttribute("x2", 120 + R * 10);
                        lr.setAttribute("y2", 120 - r * 10);

                        // Calc
                        cR2.innerText = R * R;
                        cr2.innerText = r * r;
                        res.innerText = (Math.PI * (R * R - r * r)).toFixed(1);
                    };

                    sR.oninput = update;
                    sr.oninput = update;
                },

                interactive_segment_visualizer(container) {
                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Decompondo o Segmento</h3>

        <div class="flex gap-4 items-center justify-center mb-6">
            
            <div class="flex flex-col items-center opacity-50 hover:opacity-100 transition-opacity cursor-pointer" id="step-sector">
                <svg width="80" height="80" viewBox="0 0 100 100">
                    <path d="M 50 50 L 90 50 A 40 40 0 0 0 50 10 Z" fill="#1CB0F6" />
                </svg>
                <span class="text-xs font-bold text-brand-blue">1. Setor</span>
            </div>

            <span class="text-xl font-black text-gray-300">-</span>

            <div class="flex flex-col items-center opacity-50 hover:opacity-100 transition-opacity cursor-pointer" id="step-tri">
                <svg width="80" height="80" viewBox="0 0 100 100">
                    <polygon points="50,50 90,50 50,10" fill="#FF9600" />
                </svg>
                <span class="text-xs font-bold text-brand-orange">2. Tri√¢ngulo</span>
            </div>

            <span class="text-xl font-black text-gray-300">=</span>

            <div class="flex flex-col items-center scale-110">
                <svg width="80" height="80" viewBox="0 0 100 100">
                    <path d="M 50 10 L 90 50 A 40 40 0 0 0 50 10 Z" fill="#CE82FF" />
                </svg>
                <span class="text-xs font-bold text-brand-purple">3. Segmento</span>
            </div>

        </div>

        <div class="relative w-64 h-64 bg-gray-50 border border-gray-200 rounded-xl flex items-center justify-center">
            <svg width="200" height="200" viewBox="0 0 200 200">
                <path d="M 100 100 L 180 100 A 80 80 0 0 0 100 20 Z" fill="#e0f2fe" stroke="#1CB0F6" id="main-sector" />
                
                <polygon points="100,100 180,100 100,20" fill="#ffedd5" stroke="#f97316" stroke-width="0" id="main-tri" class="opacity-0 transition-opacity duration-500" />
                
                <path d="M 100 20 L 180 100 A 80 80 0 0 0 100 20 Z" fill="#f3e8ff" stroke="#a855f7" stroke-width="2" id="main-seg" class="opacity-0 transition-opacity duration-500" />
            </svg>
        </div>

        <div class="flex gap-2 mt-4 w-full">
            <button class="flex-1 bg-brand-blue text-white font-bold py-2 rounded shadow-sm" onclick="app.widgets.animSeg('sector')">Ver Setor</button>
            <button class="flex-1 bg-brand-orange text-white font-bold py-2 rounded shadow-sm" onclick="app.widgets.animSeg('sub')">Subtrair</button>
            <button class="flex-1 bg-brand-purple text-white font-bold py-2 rounded shadow-sm" onclick="app.widgets.animSeg('res')">Resultado</button>
        </div>

    </div>
    `;

                    const sector = container.querySelector("#main-sector");
                    const tri = container.querySelector("#main-tri");
                    const seg = container.querySelector("#main-seg");

                    app.widgets.animSeg = (action) => {
                        if (action === "sector") {
                            sector.style.opacity = 1;
                            tri.style.opacity = 0;
                            seg.style.opacity = 0;
                        } else if (action === "sub") {
                            sector.style.opacity = 0.3;
                            tri.style.opacity = 1;
                            seg.style.opacity = 0;
                        } else {
                            sector.style.opacity = 0.1;
                            tri.style.opacity = 0.1;
                            seg.style.opacity = 1;
                        }
                    };
                },

                interactive_tree_path(container) {
                    // Configura√ß√£o: Menu de Restaurante
                    // Prato Principal (3) x Bebida (2) x Sobremesa (2)
                    const options = {
                        main: [
                            { name: "Hamb√∫rguer", icon: "üçî", color: "bg-orange-100 border-orange-300" },
                            { name: "Pizza", icon: "üçï", color: "bg-yellow-100 border-yellow-300" },
                            { name: "Salada", icon: "ü•ó", color: "bg-green-100 border-green-300" }
                        ],
                        drink: [
                            { name: "Suco", icon: "üßÉ", color: "bg-purple-100 border-purple-300" },
                            { name: "Refri", icon: "ü•§", color: "bg-red-100 border-red-300" }
                        ],
                        dessert: [
                            { name: "Sorvete", icon: "üç¶", color: "bg-blue-100 border-blue-300" },
                            { name: "Bolo", icon: "üç∞", color: "bg-pink-100 border-pink-300" }
                        ]
                    };

                    let step = 0; // 0: Start, 1: Main Selected, 2: Drink Selected, 3: Finished
                    let selections = [];

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex justify-between w-full items-center mb-4 border-b-2 border-gray-100 pb-2">
            <h3 class="text-brand-blue font-black uppercase text-xs tracking-widest">Montando o Combo</h3>
            <div class="text-xs font-bold text-gray-500">Possibilidades Totais: <span class="text-brand-blue text-lg">12</span></div>
        </div>

        <div class="w-full min-h-[200px] flex flex-col items-center justify-center gap-4 mb-6 relative" id="tree-stage">
            <div class="text-center animate-fade-in" id="stage-content">
                <p class="text-sm text-gray-500 font-bold mb-4">Escolha o Prato Principal:</p>
                <div class="flex gap-2 justify-center">
                    ${options.main.map((o, i) => `
                        <button class="tree-opt flex flex-col items-center p-3 rounded-xl border-2 ${o.color} hover:scale-105 transition-transform shadow-sm" onclick="app.widgets.treeSelect(0, ${i})">
                            <span class="text-3xl mb-1">${o.icon}</span>
                            <span class="text-[10px] font-bold uppercase text-gray-700">${o.name}</span>
                        </button>
                    `).join('')}
                </div>
            </div>
        </div>

        <div class="w-full bg-gray-50 rounded-xl p-3 flex items-center justify-center gap-2 font-mono text-sm border border-gray-200">
            <span id="crumb-1" class="opacity-30">Prato (3)</span>
            <span class="text-gray-300">√ó</span>
            <span id="crumb-2" class="opacity-30">Bebida (2)</span>
            <span class="text-gray-300">√ó</span>
            <span id="crumb-3" class="opacity-30">Sobremesa (2)</span>
            <span class="text-gray-300">=</span>
            <span class="font-bold text-brand-blue">12 Combos</span>
        </div>

        <button id="btn-reset-tree" class="mt-4 text-xs font-bold text-brand-blue hover:underline hidden">Reiniciar √Årvore</button>

    </div>
    `;

                    const stage = container.querySelector('#stage-content');
                    const crumb1 = container.querySelector('#crumb-1');
                    const crumb2 = container.querySelector('#crumb-2');
                    const crumb3 = container.querySelector('#crumb-3');
                    const btnReset = container.querySelector('#btn-reset-tree');

                    app.widgets.treeSelect = (level, idx) => {
                        if (level === 0) {
                            selections[0] = options.main[idx];
                            crumb1.className = "text-brand-orange font-bold";
                            crumb1.innerHTML = `${selections[0].icon}`;

                            // Render Level 2 (Drinks)
                            stage.innerHTML = `
                <div class="flex flex-col items-center animate-slide-up">
                    <div class="text-2xl mb-2 opacity-50">${selections[0].icon}</div>
                    <div class="w-0.5 h-8 bg-gray-300 mb-2"></div>
                    <p class="text-sm text-gray-500 font-bold mb-4">Escolha a Bebida:</p>
                    <div class="flex gap-2 justify-center">
                        ${options.drink.map((o, i) => `
                            <button class="tree-opt flex flex-col items-center p-3 rounded-xl border-2 ${o.color} hover:scale-105 transition-transform shadow-sm" onclick="app.widgets.treeSelect(1, ${i})">
                                <span class="text-3xl mb-1">${o.icon}</span>
                                <span class="text-[10px] font-bold uppercase text-gray-700">${o.name}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
                        } else if (level === 1) {
                            selections[1] = options.drink[idx];
                            crumb2.className = "text-brand-purple font-bold";
                            crumb2.innerHTML = `${selections[1].icon}`;

                            // Render Level 3 (Dessert)
                            stage.innerHTML = `
                <div class="flex flex-col items-center animate-slide-up">
                    <div class="flex gap-2 opacity-50 text-xl mb-2">${selections[0].icon} + ${selections[1].icon}</div>
                    <div class="w-0.5 h-8 bg-gray-300 mb-2"></div>
                    <p class="text-sm text-gray-500 font-bold mb-4">Escolha a Sobremesa:</p>
                    <div class="flex gap-2 justify-center">
                        ${options.dessert.map((o, i) => `
                            <button class="tree-opt flex flex-col items-center p-3 rounded-xl border-2 ${o.color} hover:scale-105 transition-transform shadow-sm" onclick="app.widgets.treeSelect(2, ${i})">
                                <span class="text-3xl mb-1">${o.icon}</span>
                                <span class="text-[10px] font-bold uppercase text-gray-700">${o.name}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
                        } else if (level === 2) {
                            selections[2] = options.dessert[idx];
                            crumb3.className = "text-brand-blue font-bold";
                            crumb3.innerHTML = `${selections[2].icon}`;

                            // Final Result
                            stage.innerHTML = `
                <div class="flex flex-col items-center animate-pop-in">
                    <div class="text-6xl mb-4">‚ú®</div>
                    <h4 class="text-xl font-black text-brand-green uppercase mb-2">Combo Pronto!</h4>
                    <div class="flex items-center gap-4 bg-gray-100 p-4 rounded-2xl border-2 border-gray-200">
                        <span class="text-4xl">${selections[0].icon}</span>
                        <span class="text-2xl text-gray-300">+</span>
                        <span class="text-4xl">${selections[1].icon}</span>
                        <span class="text-2xl text-gray-300">+</span>
                        <span class="text-4xl">${selections[2].icon}</span>
                    </div>
                    <p class="text-xs text-gray-400 mt-4 max-w-xs text-center">Este √© apenas 1 dos 12 caminhos poss√≠veis na √°rvore.</p>
                </div>
            `;
                            btnReset.classList.remove('hidden');
                        }
                    };

                    btnReset.onclick = () => {
                        app.widgets.interactive_tree_path(container);
                    };
                },

                interactive_urn_events(container) {
                    let mode = 'independent'; // 'independent' (com reposi√ß√£o) ou 'dependent' (sem)
                    let balls = { red: 5, blue: 3 };
                    let total = 8;
                    let history = [];

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex bg-gray-100 p-1 rounded-lg mb-6 w-full max-w-xs relative">
            <div id="mode-bg-urn" class="absolute top-1 bottom-1 w-[calc(50%-4px)] bg-white rounded-md shadow-sm transition-all duration-300 left-1"></div>
            <button class="mode-urn flex-1 py-2 z-10 text-[10px] font-bold uppercase transition-colors text-brand-blue" data-m="independent">Com Reposi√ß√£o</button>
            <button class="mode-urn flex-1 py-2 z-10 text-[10px] font-bold uppercase transition-colors text-gray-400" data-m="dependent">Sem Reposi√ß√£o</button>
        </div>

        <div class="relative w-48 h-48 bg-white border-4 border-gray-300 rounded-full flex items-center justify-center mb-6 overflow-hidden shadow-inner" id="urn-container">
            <div class="absolute inset-x-0 top-0 h-1/2 bg-gray-50 opacity-50 pointer-events-none"></div>
            
            <div id="balls-area" class="w-full h-full relative">
                </div>

            <div id="hand-draw" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 pointer-events-none z-20"></div>
        </div>

        <div class="w-full max-w-sm bg-blue-50 border border-blue-200 rounded-xl p-3 mb-4 text-center">
            <p class="text-xs font-bold text-blue-800 uppercase mb-1">Probabilidade da Pr√≥xima Bola Vermelha</p>
            <div class="text-2xl font-mono font-black text-brand-blue">
                <span id="n-fav">5</span> / <span id="n-total">8</span>
            </div>
            <p class="text-[10px] text-blue-600 mt-1" id="prob-desc">Total inicial.</p>
        </div>

        <button id="btn-draw" class="w-full max-w-xs bg-brand-green text-white font-bold py-3 rounded-xl shadow-btn active:scale-95 transition-all">
            SORTEAR BOLA
        </button>

        <button id="btn-reset-urn" class="mt-4 text-xs font-bold text-gray-400 underline hover:text-brand-red">Resetar Urna</button>
    </div>
    `;

                    const ballsArea = container.querySelector('#balls-area');
                    const nFav = container.querySelector('#n-fav');
                    const nTotal = container.querySelector('#n-total');
                    const probDesc = container.querySelector('#prob-desc');
                    const btnDraw = container.querySelector('#btn-draw');
                    const btnReset = container.querySelector('#btn-reset-urn');
                    const modeBtns = container.querySelectorAll('.mode-urn');
                    const modeBg = container.querySelector('#mode-bg-urn');

                    const renderBalls = () => {
                        ballsArea.innerHTML = '';
                        const allBalls = [];
                        for (let i = 0; i < balls.red; i++) allBalls.push('red');
                        for (let i = 0; i < balls.blue; i++) allBalls.push('blue');

                        allBalls.forEach((color, i) => {
                            const b = document.createElement('div');
                            // Random position inside circle
                            // Simple approach: random left/top within 20-80%
                            const top = 20 + Math.random() * 60;
                            const left = 20 + Math.random() * 60;

                            b.className = `absolute w-8 h-8 rounded-full border-2 border-white shadow-md transition-all duration-500 ${color === 'red' ? 'bg-red-500' : 'bg-blue-500'}`;
                            b.style.top = `${top}%`;
                            b.style.left = `${left}%`;
                            b.style.transform = `rotate(${Math.random() * 360}deg)`;

                            ballsArea.appendChild(b);
                        });
                    };

                    const updateStats = () => {
                        nFav.innerText = balls.red;
                        nTotal.innerText = total;

                        if (total === 0) {
                            probDesc.innerText = "Urna vazia!";
                            btnDraw.disabled = true;
                            btnDraw.classList.add('opacity-50', 'cursor-not-allowed');
                            return;
                        }

                        if (mode === 'independent') {
                            probDesc.innerText = "Sempre igual (A bola volta).";
                        } else {
                            probDesc.innerText = "Muda a cada retirada!";
                        }
                    };

                    const draw = () => {
                        if (total === 0) return;

                        btnDraw.disabled = true;

                        // Logic
                        const isRed = Math.random() < (balls.red / total);
                        const drawnColor = isRed ? 'red' : 'blue';

                        // Animation Placeholder
                        const animBall = document.createElement('div');
                        animBall.className = `absolute left-1/2 top-1/2 w-12 h-12 rounded-full border-4 border-white shadow-xl z-30 transition-all duration-700 ${drawnColor === 'red' ? 'bg-red-500' : 'bg-blue-500'}`;
                        animBall.style.transform = "translate(-50%, -50%) scale(0)";
                        ballsArea.appendChild(animBall);

                        // Pop up animation
                        setTimeout(() => {
                            animBall.style.transform = "translate(-50%, -150%) scale(1.2)"; // Moves up out of urn
                        }, 50);

                        setTimeout(() => {
                            // Result logic
                            if (mode === 'dependent') {
                                if (isRed) balls.red--; else balls.blue--;
                                total--;
                                // Remove one ball from visual urn randomly
                                const existing = ballsArea.querySelectorAll(`.${drawnColor === 'red' ? 'bg-red-500' : 'bg-blue-500'}:not(.z-30)`);
                                if (existing.length > 0) existing[0].remove();
                            } else {
                                // Independent: Ball goes back
                                animBall.style.transform = "translate(-50%, -50%) scale(0.5)";
                                animBall.style.opacity = "0";
                            }

                            if (mode === 'independent') {
                                setTimeout(() => animBall.remove(), 500);
                            } else {
                                animBall.remove();
                            }

                            updateStats();
                            btnDraw.disabled = false;
                        }, 1000);
                    };

                    const reset = () => {
                        balls = { red: 5, blue: 3 };
                        total = 8;
                        btnDraw.disabled = false;
                        btnDraw.classList.remove('opacity-50', 'cursor-not-allowed');
                        renderBalls();
                        updateStats();
                    };

                    // Mode Switching
                    modeBtns.forEach((btn, i) => {
                        btn.onclick = () => {
                            mode = btn.dataset.m;
                            modeBg.style.left = i === 0 ? '4px' : 'calc(50% + 0px)';

                            modeBtns.forEach(b => {
                                b.className = "mode-urn flex-1 py-2 z-10 text-[10px] font-bold uppercase transition-colors text-gray-400";
                            });
                            btn.className = "mode-urn flex-1 py-2 z-10 text-[10px] font-bold uppercase transition-colors text-brand-blue";

                            reset();
                        };
                    });

                    btnDraw.onclick = draw;
                    btnReset.onclick = reset;

                    renderBalls();
                },

                interactive_venn_union(container) {
                    // Estado: 0=A, 1=B, 2=Intersect
                    let counts = { a: 10, b: 10, inter: 5 };
                    // Total Population fixed visual size?
                    // Let's just calculate Probability based on a fixed Universe of e.g. 50.

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Uni√£o de Conjuntos (A U B)</h3>

        <div class="relative w-64 h-48 flex items-center justify-center mb-6">
            <svg width="100%" height="100%" viewBox="0 0 300 200" class="overflow-visible">
                <circle cx="100" cy="100" r="80" fill="rgba(28, 176, 246, 0.5)" stroke="#1CB0F6" stroke-width="2" class="cursor-pointer hover:stroke-4" onclick="app.widgets.toggleVenn('a')" id="circle-a" />
                
                <circle cx="200" cy="100" r="80" fill="rgba(255, 150, 0, 0.5)" stroke="#FF9600" stroke-width="2" class="cursor-pointer hover:stroke-4" onclick="app.widgets.toggleVenn('b')" id="circle-b" />
                
                <text x="60" y="100" text-anchor="middle" font-weight="bold" fill="white" font-size="20">A</text>
                <text x="240" y="100" text-anchor="middle" font-weight="bold" fill="white" font-size="20">B</text>
                <text x="150" y="100" text-anchor="middle" font-weight="bold" fill="white" font-size="14" id="lbl-inter">A‚à©B</text>
            </svg>
        </div>

        <div class="flex gap-4 w-full max-w-sm mb-6 text-center">
            <div class="flex-1 bg-blue-50 border border-blue-200 rounded p-2">
                <p class="text-[10px] uppercase font-bold text-blue-700">P(A)</p>
                <p class="text-xl font-black text-brand-blue">30%</p>
            </div>
            <div class="flex-1 bg-purple-50 border border-purple-200 rounded p-2">
                <p class="text-[10px] uppercase font-bold text-purple-700">P(A ‚à© B)</p>
                <p class="text-xl font-black text-brand-purple">10%</p>
            </div>
            <div class="flex-1 bg-orange-50 border border-orange-200 rounded p-2">
                <p class="text-[10px] uppercase font-bold text-orange-700">P(B)</p>
                <p class="text-xl font-black text-brand-orange">30%</p>
            </div>
        </div>

        <div class="bg-gray-800 text-white p-4 rounded-xl w-full text-center shadow-lg">
            <p class="text-xs text-gray-400 uppercase font-bold mb-2">Probabilidade da Uni√£o P(A U B)</p>
            <div class="font-mono text-lg">
                <span class="text-blue-400">30</span> + <span class="text-orange-400">30</span> - <span class="text-purple-400">10</span> = <span class="text-green-400 font-black text-2xl">50%</span>
            </div>
            <p class="text-[10px] text-gray-400 mt-2 italic">Se n√£o subtrair a interse√ß√£o, o 10 seria contado duas vezes!</p>
        </div>

    </div>
    `;

                    // Static for this demo, focusing on the visual formula explanation.
                    // Making it fully dynamic with drag requires complex SVG logic.
                    // We keep it static but visually clear for "Concept of Subtraction".

                    // Adding highlight interaction
                    const cA = container.querySelector('#circle-a');
                    const cB = container.querySelector('#circle-b');
                    const lInter = container.querySelector('#lbl-inter');

                    app.widgets.toggleVenn = (target) => {
                        // Simple opacity toggle to show "selection"
                        if (target === 'a') {
                            cA.setAttribute('fill', 'rgba(28, 176, 246, 0.8)');
                            setTimeout(() => cA.setAttribute('fill', 'rgba(28, 176, 246, 0.5)'), 500);
                        } else {
                            cB.setAttribute('fill', 'rgba(255, 150, 0, 0.8)');
                            setTimeout(() => cB.setAttribute('fill', 'rgba(255, 150, 0, 0.5)'), 500);
                        }
                    };
                },

                interactive_conditional_filters(container) {
                    // Dataset: Shapes with Colors
                    // 12 Items total
                    // 4 Red Squares, 2 Red Circles
                    // 2 Blue Squares, 4 Blue Circles
                    const items = [
                        { c: 'red', s: 'square' }, { c: 'red', s: 'square' }, { c: 'red', s: 'square' }, { c: 'red', s: 'square' },
                        { c: 'red', s: 'circle' }, { c: 'red', s: 'circle' },
                        { c: 'blue', s: 'square' }, { c: 'blue', s: 'square' },
                        { c: 'blue', s: 'circle' }, { c: 'blue', s: 'circle' }, { c: 'blue', s: 'circle' }, { c: 'blue', s: 'circle' }
                    ];

                    let filter = 'none'; // none, red, blue, square, circle

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none relative overflow-hidden">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-4">Probabilidade Condicional</h3>

        <div class="flex gap-2 mb-4 w-full justify-center">
            <button class="filter-btn text-[10px] font-bold uppercase px-3 py-1 rounded-full border bg-gray-100 text-gray-500 hover:bg-gray-200" onclick="app.widgets.setFilter('none')">Todos</button>
            <button class="filter-btn text-[10px] font-bold uppercase px-3 py-1 rounded-full border border-red-200 bg-red-50 text-red-500 hover:bg-red-100" onclick="app.widgets.setFilter('red')">Dado que √© Vermelho</button>
            <button class="filter-btn text-[10px] font-bold uppercase px-3 py-1 rounded-full border border-blue-200 bg-blue-50 text-blue-500 hover:bg-blue-100" onclick="app.widgets.setFilter('blue')">Dado que √© Azul</button>
        </div>

        <div class="w-full bg-gray-50 border-2 border-gray-200 border-dashed rounded-xl p-4 min-h-[150px] flex flex-wrap justify-center content-center gap-2 transition-all duration-500" id="universe-box">
            </div>

        <div class="mt-4 bg-gray-800 text-white p-4 rounded-xl w-full text-center">
            <p class="text-xs text-gray-400 uppercase font-bold mb-2" id="question-text">Qual a chance de ser Quadrado?</p>
            <div class="font-mono text-2xl font-bold">
                <span id="f-num" class="text-brand-green">6</span> / <span id="f-den" class="text-brand-orange">12</span>
                = <span id="f-pct">50%</span>
            </div>
            <p class="text-[10px] text-gray-400 mt-2" id="filter-desc">Universo completo.</p>
        </div>

    </div>
    `;

                    const box = container.querySelector('#universe-box');
                    const fNum = container.querySelector('#f-num');
                    const fDen = container.querySelector('#f-den');
                    const fPct = container.querySelector('#f-pct');
                    const qText = container.querySelector('#question-text');
                    const desc = container.querySelector('#filter-desc');

                    app.widgets.setFilter = (f) => {
                        filter = f;
                        render();
                    };

                    const render = () => {
                        box.innerHTML = '';

                        let validItems = 0;
                        let squares = 0;

                        items.forEach((item, i) => {
                            const el = document.createElement('div');
                            const isMatch = filter === 'none' || item.c === filter || item.s === filter;

                            // Visual Style
                            let shapeClass = item.s === 'circle' ? 'rounded-full' : 'rounded-md';
                            let colorClass = item.c === 'red' ? 'bg-red-500' : 'bg-blue-500';

                            if (isMatch) {
                                el.className = `w-8 h-8 ${shapeClass} ${colorClass} shadow-md transform scale-100 transition-all duration-500`;
                                validItems++;
                                if (item.s === 'square') squares++;
                            } else {
                                el.className = `w-8 h-8 ${shapeClass} bg-gray-200 opacity-20 transform scale-75 grayscale transition-all duration-500`;
                            }

                            box.appendChild(el);
                        });

                        // Update Math
                        fNum.innerText = squares;
                        fDen.innerText = validItems;
                        const pct = validItems > 0 ? ((squares / validItems) * 100).toFixed(0) : 0;
                        fPct.innerText = `${pct}%`;

                        // Update Text
                        if (filter === 'none') {
                            qText.innerText = "Qual a chance de ser Quadrado?";
                            desc.innerText = "Olhando para todos (12 itens).";
                            fDen.className = "text-gray-400";
                        } else {
                            qText.innerText = `Dado que √© ${filter === 'red' ? 'Vermelho' : 'Azul'}, qual a chance de ser Quadrado?`;
                            desc.innerText = `O universo diminuiu! Agora s√≥ existem ${validItems} itens.`;
                            fDen.className = "text-brand-orange scale-110 font-black"; // Highlight denominator change
                        }
                    };

                    render();
                },

                interactive_logic_gates(container) {
                    let inputs = { A: false, B: false };

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">
        
        <h3 class="font-black uppercase text-xs tracking-widest text-gray-400 mb-6">Simulador de L√≥gica</h3>

        <div class="flex justify-between w-full max-w-xs mb-8">
            <button class="w-16 h-16 rounded-xl border-4 transition-all flex items-center justify-center font-bold text-2xl input-btn" id="btn-logic-a">A: 0</button>
            <button class="w-16 h-16 rounded-xl border-4 transition-all flex items-center justify-center font-bold text-2xl input-btn" id="btn-logic-b">B: 0</button>
        </div>

        <div class="grid grid-cols-1 w-full gap-4 max-w-sm">
            
            <div class="bg-gray-800 p-3 rounded-lg border border-gray-600 flex items-center justify-between">
                <div class="font-mono text-brand-blue font-bold text-lg">A ‚àß B (E)</div>
                <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold transition-all" id="led-and">0</div>
            </div>

            <div class="bg-gray-800 p-3 rounded-lg border border-gray-600 flex items-center justify-between">
                <div class="font-mono text-brand-orange font-bold text-lg">A ‚à® B (OU)</div>
                <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold transition-all" id="led-or">0</div>
            </div>

            <div class="bg-gray-800 p-3 rounded-lg border border-gray-600 flex items-center justify-between">
                <div class="font-mono text-brand-purple font-bold text-lg">¬¨A (N√ÉO A)</div>
                <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold transition-all" id="led-not">1</div>
            </div>

        </div>
    </div>
    `;

                    const btnA = container.querySelector('#btn-logic-a');
                    const btnB = container.querySelector('#btn-logic-b');
                    const ledAnd = container.querySelector('#led-and');
                    const ledOr = container.querySelector('#led-or');
                    const ledNot = container.querySelector('#led-not');

                    const updateVisual = (el, state, colorClass) => {
                        if (state) {
                            el.innerText = "1";
                            el.className = `w-16 h-16 rounded-xl border-4 transition-all flex items-center justify-center font-bold text-2xl bg-${colorClass}-600 border-${colorClass}-400 text-white shadow-[0_0_15px_rgba(255,255,255,0.3)] input-btn`;
                        } else {
                            el.innerText = "0";
                            el.className = `w-16 h-16 rounded-xl border-4 transition-all flex items-center justify-center font-bold text-2xl bg-gray-800 border-gray-600 text-gray-500 input-btn`;
                        }
                    };

                    const updateLed = (el, state) => {
                        if (state) {
                            el.innerText = "V";
                            el.className = "w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold transition-all bg-green-500 border-green-300 text-white shadow-[0_0_10px_#22c55e]";
                        } else {
                            el.innerText = "F";
                            el.className = "w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold transition-all bg-gray-700 border-gray-500 text-gray-500";
                        }
                    };

                    const logic = () => {
                        // Update Buttons
                        updateVisual(btnA, inputs.A, 'blue');
                        updateVisual(btnB, inputs.B, 'orange');

                        // Logic
                        updateLed(ledAnd, inputs.A && inputs.B);
                        updateLed(ledOr, inputs.A || inputs.B);
                        updateLed(ledNot, !inputs.A);
                    };

                    btnA.onclick = () => { inputs.A = !inputs.A; logic(); };
                    btnB.onclick = () => { inputs.B = !inputs.B; logic(); };

                    logic(); // Init
                },

                interactive_venn_painter(container) {
                    let mode = 'union'; // union, inter, diff

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <div class="flex gap-2 mb-6 bg-gray-100 p-1 rounded-lg">
            <button class="mode-btn px-4 py-2 rounded font-bold text-xs uppercase bg-white shadow-sm text-brand-blue" data-m="union">A ‚à™ B</button>
            <button class="mode-btn px-4 py-2 rounded font-bold text-xs uppercase text-gray-400 hover:bg-white" data-m="inter">A ‚à© B</button>
            <button class="mode-btn px-4 py-2 rounded font-bold text-xs uppercase text-gray-400 hover:bg-white" data-m="diff">A - B</button>
        </div>

        <div class="relative w-64 h-48 flex items-center justify-center">
            <div id="circle-a" class="absolute left-4 w-32 h-32 rounded-full border-4 border-brand-blue transition-all duration-300 flex items-center justify-center opacity-80 mix-blend-multiply z-10">
                <span class="font-black text-brand-blue text-xl -translate-x-4 -translate-y-4">A</span>
            </div>
            
            <div id="circle-b" class="absolute right-4 w-32 h-32 rounded-full border-4 border-brand-orange transition-all duration-300 flex items-center justify-center opacity-80 mix-blend-multiply z-10">
                <span class="font-black text-brand-orange text-xl translate-x-4 translate-y-4">B</span>
            </div>

            </div>

        <p id="venn-desc" class="text-center font-bold text-sm text-gray-600 mt-4 min-h-[40px]">
            Uni√£o: Tudo que est√° em A ou em B.
        </p>

    </div>
    `;

                    const cA = container.querySelector('#circle-a');
                    const cB = container.querySelector('#circle-b');
                    const desc = container.querySelector('#venn-desc');
                    const btns = container.querySelectorAll('.mode-btn');

                    const update = () => {
                        // Reset
                        cA.className = "absolute left-4 w-32 h-32 rounded-full border-4 border-brand-blue transition-all duration-300 flex items-center justify-center opacity-80 mix-blend-multiply z-10";
                        cB.className = "absolute right-4 w-32 h-32 rounded-full border-4 border-brand-orange transition-all duration-300 flex items-center justify-center opacity-80 mix-blend-multiply z-10";

                        if (mode === 'union') {
                            cA.classList.add('bg-blue-300');
                            cB.classList.add('bg-orange-300');
                            desc.innerText = "Uni√£o: Pinta tudo de A e tudo de B.";
                        } else if (mode === 'inter') {
                            // CSS trick for intersection: We can't easily clip just the intersection in simple DIVs without SVG masking.
                            // Let's use a visual approximation: Change opacity/color to highlight overlap visually.
                            // Or better: Use SVG. Let's swap to SVG for precision.
                            // Re-rendering container with SVG for this mode? No, let's keep it simple.
                            // In 'Multiply' blend mode, overlapping colors get darker.
                            cA.classList.add('bg-purple-300'); // Fake color
                            cB.classList.add('bg-purple-300');
                            // This is hard to do purely with divs. Let's use SVG inside instead.
                            renderSVG();
                            return;
                        } else {
                            // A - B
                            renderSVG();
                            return;
                        }

                        // Cleanup SVG if exists
                        const svg = container.querySelector('svg');
                        if (svg) svg.remove();
                    };

                    const renderSVG = () => {
                        // Replace circles with SVG logic
                        const wrapper = container.querySelector('.relative');
                        wrapper.innerHTML = `
        <svg viewBox="0 0 200 150" class="w-full h-full">
            <defs>
                <clipPath id="cut-a">
                    <circle cx="70" cy="75" r="50" />
                </clipPath>
                <clipPath id="cut-b">
                    <circle cx="130" cy="75" r="50" />
                </clipPath>
            </defs>

            <circle cx="70" cy="75" r="50" fill="none" stroke="#1CB0F6" stroke-width="3" />
            <circle cx="130" cy="75" r="50" fill="none" stroke="#FF9600" stroke-width="3" />
            
            <text x="50" y="75" font-weight="bold" fill="#1CB0F6">A</text>
            <text x="140" y="75" font-weight="bold" fill="#FF9600">B</text>

            ${getPath()}
        </svg>
        `;
                    };

                    const getPath = () => {
                        if (mode === 'inter') {
                            desc.innerText = "Intersec√ß√£o: Apenas onde eles se cruzam.";
                            // Intersection Path
                            return `<path d="M 105,40 A 50,50 0 0,0 105,110 A 50,50 0 0,0 105,40 Z" fill="#A855F7" fill-opacity="0.5" />`;
                            // Note: Calculating exact path for intersection of two circles radius 50 dist 60 is complex for string.
                            // Visual cheat: use ClipPath
                            return `<circle cx="70" cy="75" r="50" fill="#A855F7" clip-path="url(#cut-b)" />`;
                        } else if (mode === 'diff') {
                            desc.innerText = "Diferen√ßa (A - B): Apenas a parte de A que n√£o toca em B.";
                            // A masked by B
                            return `
                <mask id="mask-b">
                    <rect x="0" y="0" width="200" height="150" fill="white" />
                    <circle cx="130" cy="75" r="50" fill="black" />
                </mask>
                <circle cx="70" cy="75" r="50" fill="#EF4444" mask="url(#mask-b)" />
            `;
                        }
                        return '';
                    };

                    btns.forEach(btn => {
                        btn.onclick = () => {
                            mode = btn.dataset.m;
                            btns.forEach(b => b.className = "mode-btn px-4 py-2 rounded font-bold text-xs uppercase text-gray-400 hover:bg-white");
                            btn.className = "mode-btn px-4 py-2 rounded font-bold text-xs uppercase bg-white shadow-sm text-brand-blue";
                            if (mode === 'union') {
                                // Revert to simple DIVs for union animation or redraw SVG union
                                // SVG Union is just both circles filled
                                const wrapper = container.querySelector('.relative');
                                wrapper.innerHTML = `
                    <svg viewBox="0 0 200 150" class="w-full h-full">
                        <circle cx="70" cy="75" r="50" fill="#93C5FD" stroke="#1CB0F6" stroke-width="3" />
                        <circle cx="130" cy="75" r="50" fill="#FDBA74" stroke="#FF9600" stroke-width="3" />
                        <text x="50" y="75" font-weight="bold" fill="white">A</text>
                        <text x="140" y="75" font-weight="bold" fill="white">B</text>
                    </svg>
                 `;
                                desc.innerText = "Uni√£o: Tudo que est√° em A ou em B.";
                            } else {
                                update();
                            }
                        };
                    });

                    // Init with SVG Union
                    btns[0].click();
                },

                interactive_function_machine_concept(container) {
                    let inputVal = 2;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">A M√°quina de Fun√ß√£o: f(x) = 2x + 1</h3>

        <div class="flex items-center w-full justify-center gap-0 md:gap-4 relative">
            
            <div class="flex flex-col items-center z-10">
                <span class="text-xs font-bold text-gray-400 uppercase mb-1">Entrada (x)</span>
                <div class="relative">
                    <input type="number" id="func-in" value="2" class="w-16 h-12 bg-blue-50 border-2 border-brand-blue rounded-lg text-center font-black text-xl text-brand-blue outline-none z-10 relative">
                    <div class="absolute top-1/2 left-full w-8 h-2 bg-gray-300 -translate-y-1/2 -z-0"></div>
                </div>
            </div>

            <div class="w-32 h-32 bg-gray-800 rounded-2xl flex flex-col items-center justify-center text-white shadow-xl relative z-20 border-b-8 border-gray-900 mx-4">
                <i class="fas fa-cog text-4xl animate-spin-slow opacity-20 absolute"></i>
                <div class="font-mono text-xl font-bold z-10">2x + 1</div>
                <div class="mt-2 w-full h-1 bg-green-500 animate-pulse"></div>
            </div>

            <div class="flex flex-col items-center z-10">
                <span class="text-xs font-bold text-gray-400 uppercase mb-1">Sa√≠da f(x)</span>
                <div class="relative">
                    <div class="absolute top-1/2 right-full w-8 h-2 bg-gray-300 -translate-y-1/2 -z-0"></div>
                    <div id="func-out" class="w-16 h-12 bg-green-50 border-2 border-brand-green rounded-lg flex items-center justify-center font-black text-xl text-brand-green shadow-sm transition-all transform scale-100">
                        5
                    </div>
                </div>
            </div>

        </div>

        <button id="btn-process" class="mt-8 bg-brand-purple hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-full shadow-btn active:scale-95 transition-all">
            PROCESSAR
        </button>

    </div>
    `;

                    const inp = container.querySelector('#func-in');
                    const out = container.querySelector('#func-out');
                    const btn = container.querySelector('#btn-process');

                    btn.onclick = () => {
                        const x = parseFloat(inp.value);
                        if (isNaN(x)) return;

                        // Animation state
                        btn.disabled = true;
                        btn.classList.add('opacity-50');
                        out.innerText = "";
                        out.classList.remove('scale-100');
                        out.classList.add('scale-0');

                        // Delay simulating processing
                        setTimeout(() => {
                            const y = 2 * x + 1;
                            out.innerText = y;
                            out.classList.remove('scale-0');
                            out.classList.add('scale-110'); // Pop effect

                            setTimeout(() => {
                                out.classList.remove('scale-110');
                                out.classList.add('scale-100');
                                btn.disabled = false;
                                btn.classList.remove('opacity-50');
                            }, 300);
                        }, 600);
                    };
                },

                interactive_linear_slope_lab(container) {
                    let a = 1;
                    let b = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-2">Laborat√≥rio da Reta</h3>
        <div class="bg-gray-100 px-4 py-2 rounded-lg font-mono font-bold text-gray-700 mb-6 border border-gray-300">
            f(x) = <span id="val-a" class="text-brand-blue">1</span>x + <span id="val-b" class="text-brand-green">0</span>
        </div>

        <div class="relative w-64 h-64 bg-white border border-gray-300 rounded shadow-inner overflow-hidden mb-6">
            <div class="absolute inset-0" style="background-image: linear-gradient(#e5e7eb 1px, transparent 1px), linear-gradient(90deg, #e5e7eb 1px, transparent 1px); background-size: 20px 20px;"></div>
            
            <div class="absolute top-1/2 w-full h-0.5 bg-gray-400"></div>
            <div class="absolute left-1/2 h-full w-0.5 bg-gray-400"></div>

            <svg width="256" height="256" viewBox="-10 -10 20 20" class="absolute inset-0 pointer-events-none transform scale-y-[-1]">
                <line id="graph-line" x1="-10" y1="-10" x2="10" y2="10" stroke="#1CB0F6" stroke-width="0.5" />
            </svg>
        </div>

        <div class="w-full max-w-xs space-y-4">
            <div>
                <div class="flex justify-between text-xs font-bold uppercase text-brand-blue mb-1">
                    <span>Inclina√ß√£o (a)</span>
                    <span id="txt-a">1</span>
                </div>
                <input type="range" id="slider-a" min="-5" max="5" step="0.5" value="1" class="w-full h-2 bg-blue-100 rounded-lg accent-brand-blue">
            </div>

            <div>
                <div class="flex justify-between text-xs font-bold uppercase text-brand-green mb-1">
                    <span>Altura Inicial (b)</span>
                    <span id="txt-b">0</span>
                </div>
                <input type="range" id="slider-b" min="-5" max="5" step="1" value="0" class="w-full h-2 bg-green-100 rounded-lg accent-brand-green">
            </div>
        </div>

    </div>
    `;

                    const line = container.querySelector('#graph-line');
                    const sA = container.querySelector('#slider-a');
                    const sB = container.querySelector('#slider-b');

                    const vA = container.querySelector('#val-a');
                    const vB = container.querySelector('#val-b');
                    const tA = container.querySelector('#txt-a');
                    const tB = container.querySelector('#txt-b');

                    const update = () => {
                        a = parseFloat(sA.value);
                        b = parseFloat(sB.value);

                        vA.innerText = a;
                        vB.innerText = b >= 0 ? b : `(${b})`; // Parentheses for negative
                        tA.innerText = a;
                        tB.innerText = b;

                        // Calculate line coordinates for viewbox -10 to 10
                        // y = ax + b
                        // x1 = -10 -> y1 = a(-10) + b
                        // x2 = 10  -> y2 = a(10) + b

                        const y1 = a * (-10) + b;
                        const y2 = a * (10) + b;

                        line.setAttribute('x1', -10);
                        line.setAttribute('y1', y1);
                        line.setAttribute('x2', 10);
                        line.setAttribute('y2', y2);

                        // Color logic based on increasing/decreasing
                        if (a > 0) line.setAttribute('stroke', '#1CB0F6'); // Blue (Rising)
                        else if (a < 0) line.setAttribute('stroke', '#EF4444'); // Red (Falling)
                        else line.setAttribute('stroke', '#4B4B4B'); // Gray (Constant)
                    };

                    sA.oninput = update;
                    sB.oninput = update;
                    update();
                },

                interactive_parabola_smiley(container) {
                    let a = 1;

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-300 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative h-[300px] overflow-hidden">
        
        <div class="absolute top-4 left-4 text-xs font-bold text-gray-500 uppercase tracking-widest">Concavidade</div>

        <div id="face" class="relative w-40 h-40 bg-yellow-400 rounded-full border-4 border-black shadow-xl flex justify-center items-center mt-8 transition-transform duration-300">
            <div class="absolute top-10 left-8 w-4 h-6 bg-black rounded-full"></div>
            <div class="absolute top-10 right-8 w-4 h-6 bg-black rounded-full"></div>
            
            <div class="absolute bottom-4 w-24 h-12 overflow-visible flex items-center justify-center">
                <svg width="100" height="60" viewBox="-50 0 100 60" class="overflow-visible">
                    <path id="mouth-path" d="M -40 10 Q 0 60 40 10" fill="none" stroke="black" stroke-width="5" stroke-linecap="round" />
                </svg>
            </div>
        </div>

        <div class="absolute bottom-6 w-full max-w-xs px-8">
            <div class="flex justify-between text-xs font-black uppercase mb-2">
                <span class="text-red-500">Negativo (a < 0)</span>
                <span class="text-green-600">Positivo (a > 0)</span>
            </div>
            <input type="range" id="smile-slider" min="-10" max="10" value="10" class="w-full h-4 bg-gray-300 rounded-full appearance-none cursor-pointer accent-black">
        </div>

    </div>
    `;

                    const mouth = container.querySelector('#mouth-path');
                    const slider = container.querySelector('#smile-slider');
                    const face = container.querySelector('#face');

                    const update = () => {
                        const val = parseInt(slider.value);
                        // Map -10 to 10 to SVG Path Curve
                        // Q control point Y changes.
                        // Happy: Q 0 60. Sad: Q 0 -40.

                        // Linear map: 
                        // 10 -> 60 (Happy)
                        // -10 -> -40 (Sad)
                        // 0 -> 10 (Straight)

                        const yControl = 10 + (val * 5);

                        mouth.setAttribute('d', `M -40 30 Q 0 ${yControl + 20} 40 30`);

                        // Change Face Color slightly?
                        if (val > 0) face.className = "relative w-40 h-40 bg-yellow-400 rounded-full border-4 border-black shadow-xl flex justify-center items-center mt-8 transition-all duration-300";
                        else if (val < 0) face.className = "relative w-40 h-40 bg-blue-300 rounded-full border-4 border-black shadow-xl flex justify-center items-center mt-8 transition-all duration-300";
                        else face.className = "relative w-40 h-40 bg-gray-300 rounded-full border-4 border-black shadow-xl flex justify-center items-center mt-8 transition-all duration-300";
                    };

                    slider.oninput = update;
                    update();
                },

                interactive_log_definition_wheel(container) {
                    let base = 2;
                    let exp = 3;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">O Ciclo do Logaritmo</h3>

        <div class="flex flex-col md:flex-row items-center gap-12 text-3xl md:text-5xl font-black font-mono relative">
            
            <div class="flex items-baseline relative p-4 bg-purple-50 rounded-xl border-2 border-purple-100">
                <span class="text-gray-400 text-2xl mr-1">log</span>
                <div class="relative">
                    <span class="text-xs absolute -bottom-2 -right-2 text-brand-blue" id="log-base">2</span>
                </div>
                <span class="text-brand-green ml-2" id="log-res">8</span>
                <span class="text-gray-300 mx-2">=</span>
                <span class="text-brand-orange" id="log-exp">3</span>

                <svg class="absolute inset-0 w-full h-full pointer-events-none overflow-visible" style="left: -20px; top: -20px; width: 150%; height: 150%;">
                    <path id="arrow-cycle" d="M 40 60 Q 60 90 100 60" fill="none" stroke="#EAB308" stroke-width="2" marker-end="url(#arrowhead-yellow)" class="opacity-0 transition-opacity duration-500" />
                    <defs>
                        <marker id="arrowhead-yellow" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                            <path d="M 0 0 L 6 3 L 0 6 Z" fill="#EAB308" />
                        </marker>
                    </defs>
                </svg>
            </div>

            <i class="fas fa-exchange-alt text-gray-300 text-2xl"></i>

            <div class="flex items-baseline p-4 bg-blue-50 rounded-xl border-2 border-blue-100">
                <span class="text-brand-blue" id="exp-base">2</span>
                <sup class="text-brand-orange" id="exp-pow">3</sup>
                <span class="text-gray-300 mx-2">=</span>
                <span class="text-brand-green" id="exp-res">8</span>
            </div>

        </div>

        <div class="flex gap-4 mt-8 w-full max-w-xs">
            <div class="flex-1">
                <label class="text-[10px] uppercase font-bold text-gray-400">Base</label>
                <input type="range" id="sl-base" min="2" max="5" value="2" class="w-full h-2 bg-blue-100 rounded-lg accent-brand-blue">
            </div>
            <div class="flex-1">
                <label class="text-[10px] uppercase font-bold text-gray-400">Expoente</label>
                <input type="range" id="sl-exp" min="1" max="4" value="3" class="w-full h-2 bg-orange-100 rounded-lg accent-brand-orange">
            </div>
        </div>

    </div>
    `;

                    // Selectors
                    const lBase = container.querySelector('#log-base');
                    const lRes = container.querySelector('#log-res');
                    const lExp = container.querySelector('#log-exp');

                    const eBase = container.querySelector('#exp-base');
                    const ePow = container.querySelector('#exp-pow');
                    const eRes = container.querySelector('#exp-res');

                    const sBase = container.querySelector('#sl-base');
                    const sExp = container.querySelector('#sl-exp');
                    const arrow = container.querySelector('#arrow-cycle');

                    const update = () => {
                        base = parseInt(sBase.value);
                        exp = parseInt(sExp.value);
                        const res = Math.pow(base, exp);

                        lBase.innerText = base;
                        lRes.innerText = res;
                        lExp.innerText = exp;

                        eBase.innerText = base;
                        ePow.innerText = exp;
                        eRes.innerText = res;

                        // Animate Arrow hint
                        arrow.classList.remove('opacity-0');
                        setTimeout(() => arrow.classList.add('opacity-0'), 1000);
                    };

                    sBase.oninput = update;
                    sExp.oninput = update;
                },

                interactive_unit_circle(container) {
                    let angle = 45;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Ciclo Trigonom√©trico</h3>

        <div class="relative w-64 h-64 mb-6">
            <svg viewBox="-1.2 -1.2 2.4 2.4" class="w-full h-full overflow-visible">
                <line x1="-1.2" y1="0" x2="1.2" y2="0" stroke="#cbd5e1" stroke-width="0.02" />
                <line x1="0" y1="-1.2" x2="0" y2="1.2" stroke="#cbd5e1" stroke-width="0.02" />
                
                <circle cx="0" cy="0" r="1" fill="none" stroke="#475569" stroke-width="0.02" />

                <line id="cos-line" x1="0" y1="0" x2="0.707" y2="0" stroke="#1CB0F6" stroke-width="0.05" />
                
                <line id="sin-line" x1="0.707" y1="0" x2="0.707" y2="-0.707" stroke="#FF9600" stroke-width="0.05" />

                <line id="rad-line" x1="0" y1="0" x2="0.707" y2="-0.707" stroke="#4B4B4B" stroke-width="0.02" />

                <circle id="point-p" cx="0.707" cy="-0.707" r="0.08" fill="#CE82FF" stroke="white" stroke-width="0.02" class="cursor-pointer hover:scale-125 transition-transform" />
            </svg>
        </div>

        <div class="w-full max-w-xs space-y-4">
            <input type="range" id="angle-slider" min="0" max="360" value="45" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-purple">
            
            <div class="grid grid-cols-3 gap-2 text-center">
                <div class="bg-gray-100 p-2 rounded">
                    <span class="text-[10px] uppercase font-bold text-gray-400">√Çngulo</span>
                    <div id="disp-angle" class="font-bold text-gray-700">45¬∞</div>
                </div>
                <div class="bg-blue-50 p-2 rounded border border-blue-200">
                    <span class="text-[10px] uppercase font-bold text-brand-blue">Cos (X)</span>
                    <div id="disp-cos" class="font-bold text-brand-blue">0.71</div>
                </div>
                <div class="bg-orange-50 p-2 rounded border border-orange-200">
                    <span class="text-[10px] uppercase font-bold text-brand-orange">Sen (Y)</span>
                    <div id="disp-sin" class="font-bold text-brand-orange">0.71</div>
                </div>
            </div>
        </div>
    </div>
    `;

                    const slider = container.querySelector('#angle-slider');
                    const point = container.querySelector('#point-p');
                    const cosLine = container.querySelector('#cos-line');
                    const sinLine = container.querySelector('#sin-line');
                    const radLine = container.querySelector('#rad-line');
                    const dispA = container.querySelector('#disp-angle');
                    const dispC = container.querySelector('#disp-cos');
                    const dispS = container.querySelector('#disp-sin');

                    const update = () => {
                        const deg = parseInt(slider.value);
                        const rad = deg * (Math.PI / 180);

                        // SVG Y is inverted (down is positive), but math Y up is positive.
                        // We need to invert Y calculation for SVG rendering: y = -sin(rad)
                        const x = Math.cos(rad);
                        const y = -Math.sin(rad);

                        point.setAttribute('cx', x);
                        point.setAttribute('cy', y);

                        radLine.setAttribute('x2', x);
                        radLine.setAttribute('y2', y);

                        cosLine.setAttribute('x2', x);

                        sinLine.setAttribute('x1', x);
                        sinLine.setAttribute('x2', x);
                        sinLine.setAttribute('y2', y);

                        dispA.innerText = `${deg}¬∞`;
                        dispC.innerText = x.toFixed(2);
                        dispS.innerText = (-y).toFixed(2); // Display true math Y
                    };

                    slider.addEventListener('input', update);
                    update();
                },

                interactive_permutation_slots(container) {
                    const items = ['A', 'B', 'C'];
                    let slots = [null, null, null];

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-6">Permuta√ß√£o Simples</h3>

        <div class="flex gap-2 mb-8 bg-gray-100 p-4 rounded-xl w-full justify-center min-h-[80px]" id="slot-container">
            ${[0, 1, 2].map(i => `<div class="w-16 h-16 border-2 border-dashed border-gray-400 rounded-xl flex items-center justify-center text-2xl font-black text-gray-300 slot-target" data-idx="${i}">?</div>`).join('')}
        </div>

        <p class="text-xs font-bold text-gray-400 uppercase mb-2">Arraste as letras:</p>
        <div class="flex gap-4 mb-6">
            ${items.map(l => `<div class="w-12 h-12 bg-brand-orange text-white rounded-lg flex items-center justify-center font-black text-xl cursor-pointer shadow-md hover:-translate-y-1 transition-transform draggable-item" draggable="true" data-val="${l}">${l}</div>`).join('')}
        </div>

        <button id="btn-reset-perm" class="text-xs font-bold text-brand-blue underline">Reiniciar</button>
        <div id="perm-feedback" class="mt-4 h-6 text-sm font-bold text-brand-green"></div>
    </div>
    `;

                    // Simple click-to-fill logic for mobile compatibility (easier than drag-drop API)
                    const slotEls = container.querySelectorAll('.slot-target');
                    const itemEls = container.querySelectorAll('.draggable-item');
                    const feedback = container.querySelector('#perm-feedback');

                    itemEls.forEach(item => {
                        item.onclick = () => {
                            if (item.classList.contains('opacity-20')) return;

                            // Find first empty slot
                            const emptyIdx = slots.indexOf(null);
                            if (emptyIdx > -1) {
                                const val = item.dataset.val;
                                slots[emptyIdx] = val;

                                slotEls[emptyIdx].innerText = val;
                                slotEls[emptyIdx].classList.remove('text-gray-300', 'border-dashed');
                                slotEls[emptyIdx].classList.add('bg-orange-50', 'text-brand-orange', 'border-brand-orange');

                                item.classList.add('opacity-20', 'cursor-not-allowed');

                                if (!slots.includes(null)) {
                                    feedback.innerText = `Combina√ß√£o: ${slots.join('')}`;
                                }
                            }
                        };
                    });

                    container.querySelector('#btn-reset-perm').onclick = () => {
                        slots = [null, null, null];
                        slotEls.forEach(s => {
                            s.innerText = "?";
                            s.className = "w-16 h-16 border-2 border-dashed border-gray-400 rounded-xl flex items-center justify-center text-2xl font-black text-gray-300 slot-target";
                        });
                        itemEls.forEach(i => i.classList.remove('opacity-20', 'cursor-not-allowed'));
                        feedback.innerText = "";
                    };
                },

                interactive_monty_hall(container) {
                    let prizeDoor = Math.floor(Math.random() * 3);
                    let selectedDoor = -1;
                    let state = 'pick'; // pick, reveal, final

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none text-white">
        <h3 class="text-brand-yellow font-bold uppercase text-xs tracking-widest mb-6">O Paradoxo de Monty Hall</h3>

        <div class="flex gap-4 justify-center w-full mb-6">
            ${[0, 1, 2].map(i => `
                <div class="door-container relative w-20 h-32 cursor-pointer group" data-door="${i}">
                    <div class="door absolute inset-0 bg-brand-blue border-4 border-blue-800 rounded-lg z-10 transition-transform duration-700 origin-left flex items-center justify-center text-2xl font-black shadow-lg group-hover:bg-blue-500">
                        ${i + 1}
                    </div>
                    <div class="prize absolute inset-0 bg-gray-800 rounded-lg flex items-center justify-center text-4xl border-4 border-gray-700">
                        ‚ùì
                    </div>
                </div>
            `).join('')}
        </div>

        <p id="mh-msg" class="text-center font-bold text-lg h-12">Escolha uma porta!</p>

        <button id="btn-mh-reset" class="mt-2 bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg text-xs font-bold uppercase hidden">Jogar Novamente</button>
    </div>
    `;

                    const doors = container.querySelectorAll('.door-container');
                    const msg = container.querySelector('#mh-msg');
                    const btnReset = container.querySelector('#btn-mh-reset');

                    const revealContent = (doorIdx) => {
                        const content = doorIdx === prizeDoor ? 'üöó' : 'üêê';
                        doors[doorIdx].querySelector('.prize').innerHTML = content;
                    };

                    doors.forEach(d => {
                        d.onclick = () => {
                            const idx = parseInt(d.dataset.door);

                            if (state === 'pick') {
                                selectedDoor = idx;
                                d.querySelector('.door').classList.add('ring-4', 'ring-brand-yellow');

                                // Monty opens a goat door
                                let goatDoor = [0, 1, 2].find(i => i !== idx && i !== prizeDoor);

                                setTimeout(() => {
                                    revealContent(goatDoor);
                                    doors[goatDoor].querySelector('.door').style.transform = "rotateY(-110deg)";
                                    state = 'swap';
                                    msg.innerHTML = `Abri a porta ${goatDoor + 1} e tem um Bode!<br><span class="text-brand-yellow">Deseja trocar de porta?</span>`;
                                }, 500);

                            } else if (state === 'swap') {
                                // If clicked opened door, ignore
                                if (d.querySelector('.door').style.transform) return;

                                state = 'final';

                                // If clicked new door, update selection visually
                                doors.forEach(el => el.querySelector('.door').classList.remove('ring-4', 'ring-brand-yellow'));
                                d.querySelector('.door').classList.add('ring-4', 'ring-brand-yellow');

                                setTimeout(() => {
                                    // Reveal all
                                    [0, 1, 2].forEach(i => {
                                        revealContent(i);
                                        doors[i].querySelector('.door').style.transform = "rotateY(-110deg)";
                                    });

                                    if (idx === prizeDoor) {
                                        msg.innerHTML = "<span class='text-green-400'>VOC√ä GANHOU O CARRO! üéâ</span>";
                                    } else {
                                        msg.innerHTML = "<span class='text-red-400'>Bode! (Trocar dobra as chances)</span>";
                                    }
                                    btnReset.classList.remove('hidden');
                                }, 500);
                            }
                        };
                    });

                    btnReset.onclick = () => {
                        // Simple re-render
                        app.widgets.interactive_monty_hall(container);
                    };
                },

                interactive_matrix_transform(container) {
                    // 2D Matrix Transformation Visualizer
                    // Represents unit square transformation
                    let a = 1, b = 0, c = 0, d = 1; // Identity matrix

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Transforma√ß√£o Matricial</h3>

        <div class="flex gap-2 items-center mb-6 font-mono text-xl font-bold bg-gray-100 p-4 rounded-xl">
            <div class="grid grid-cols-2 gap-2 w-24">
                <input type="number" id="m-a" class="w-10 text-center bg-white border rounded" value="1">
                <input type="number" id="m-b" class="w-10 text-center bg-white border rounded" value="0">
                <input type="number" id="m-c" class="w-10 text-center bg-white border rounded" value="0">
                <input type="number" id="m-d" class="w-10 text-center bg-white border rounded" value="1">
            </div>
            <div class="text-6xl text-gray-300 font-light">]</div>
        </div>

        <div class="relative w-48 h-48 border border-gray-300 bg-white overflow-hidden mb-4">
            <svg viewBox="-5 -5 10 10" class="w-full h-full">
                <line x1="-5" y1="0" x2="5" y2="0" stroke="#ccc" stroke-width="0.1" />
                <line x1="0" y1="-5" x2="0" y2="5" stroke="#ccc" stroke-width="0.1" />
                
                <polygon id="unit-square" points="0,0 1,0 1,-1 0,-1" fill="rgba(28,176,246,0.3)" stroke="#1CB0F6" stroke-width="0.1" />
                
                <line id="vec-i" x1="0" y1="0" x2="1" y2="0" stroke="#FF4B4B" stroke-width="0.2" />
                <line id="vec-j" x1="0" y1="0" x2="0" y2="-1" stroke="#58CC02" stroke-width="0.2" />
            </svg>
        </div>

        <div class="flex gap-2 text-xs font-bold uppercase">
            <button class="px-3 py-1 bg-gray-100 rounded hover:bg-gray-200" onclick="app.widgets.setMat(2,0,0,1)">Esticar X</button>
            <button class="px-3 py-1 bg-gray-100 rounded hover:bg-gray-200" onclick="app.widgets.setMat(1,1,0,1)">Cisalhar</button>
            <button class="px-3 py-1 bg-gray-100 rounded hover:bg-gray-200" onclick="app.widgets.setMat(0,-1,1,0)">Girar 90¬∞</button>
        </div>
    </div>
    `;

                    const square = container.querySelector('#unit-square');
                    const vecI = container.querySelector('#vec-i');
                    const vecJ = container.querySelector('#vec-j');
                    const inps = [
                        container.querySelector('#m-a'),
                        container.querySelector('#m-b'),
                        container.querySelector('#m-c'),
                        container.querySelector('#m-d')
                    ];

                    const update = () => {
                        a = parseFloat(inps[0].value) || 0;
                        b = parseFloat(inps[1].value) || 0;
                        c = parseFloat(inps[2].value) || 0;
                        d = parseFloat(inps[3].value) || 0;

                        // Apply matrix | a b |
                        //              | c d |
                        // to vectors i(1,0) and j(0,1)
                        // i_new = (a, c)
                        // j_new = (b, d)

                        // Remember SVG Y invert: y_svg = -y_math

                        // P0 (0,0) -> (0,0)
                        // P1 (1,0) -> (a, -c)
                        // P2 (0,1) -> (b, -d)
                        // P3 (1,1) -> (a+b, -(c+d))

                        const p0 = "0,0";
                        const p1 = `${a},${-c}`;
                        const p2 = `${a + b},${-(c + d)}`;
                        const p3 = `${b},${-d}`;

                        square.setAttribute('points', `${p0} ${p1} ${p2} ${p3}`);

                        vecI.setAttribute('x2', a);
                        vecI.setAttribute('y2', -c);

                        vecJ.setAttribute('x2', b);
                        vecJ.setAttribute('y2', -d);
                    };

                    app.widgets.setMat = (v1, v2, v3, v4) => {
                        inps[0].value = v1; inps[1].value = v2;
                        inps[2].value = v3; inps[3].value = v4;
                        update();
                    };

                    inps.forEach(i => i.oninput = update);
                    update();
                },

                interactive_3d_lines(container) {
                    // Simulates checking relative positions on a cube
                    let selectedEdges = [];

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-2">Retas no Espa√ßo</h3>
        <p class="text-xs text-gray-400 mb-6">Selecione duas arestas do cubo.</p>

        <div class="relative w-48 h-48">
            <svg viewBox="0 0 200 200" class="w-full h-full overflow-visible">
                <line x1="50" y1="50" x2="150" y2="50" stroke="#cbd5e1" stroke-width="4" class="edge-btn cursor-pointer hover:stroke-brand-purple" data-id="1" />
                <line x1="50" y1="50" x2="50" y2="150" stroke="#cbd5e1" stroke-width="4" class="edge-btn cursor-pointer hover:stroke-brand-purple" data-id="2" />
                <line x1="50" y1="150" x2="150" y2="150" stroke="#cbd5e1" stroke-width="4" stroke-dasharray="4" class="edge-btn cursor-pointer hover:stroke-brand-purple" data-id="3" />
                <line x1="150" y1="50" x2="150" y2="150" stroke="#cbd5e1" stroke-width="4" stroke-dasharray="4" class="edge-btn cursor-pointer hover:stroke-brand-purple" data-id="4" />
                
                <line x1="50" y1="50" x2="20" y2="80" stroke="#94a3b8" stroke-width="2" />
                <line x1="150" y1="50" x2="120" y2="80" stroke="#94a3b8" stroke-width="2" />
                <line x1="50" y1="150" x2="20" y2="180" stroke="#94a3b8" stroke-width="2" />
                <line x1="150" y1="150" x2="120" y2="180" stroke="#94a3b8" stroke-width="2" />

                <line x1="20" y1="80" x2="120" y2="80" stroke="#64748b" stroke-width="4" class="edge-btn cursor-pointer hover:stroke-brand-purple" data-id="5" />
                <line x1="20" y1="80" x2="20" y2="180" stroke="#64748b" stroke-width="4" class="edge-btn cursor-pointer hover:stroke-brand-purple" data-id="6" />
                <line x1="20" y1="180" x2="120" y2="180" stroke="#64748b" stroke-width="4" class="edge-btn cursor-pointer hover:stroke-brand-purple" data-id="7" />
                <line x1="120" y1="80" x2="120" y2="180" stroke="#64748b" stroke-width="4" class="edge-btn cursor-pointer hover:stroke-brand-purple" data-id="8" />
            </svg>
        </div>

        <div id="lines-feedback" class="mt-6 text-center font-bold text-brand-blue min-h-[24px]"></div>
    </div>
    `;

                    const edges = container.querySelectorAll('.edge-btn');
                    const fb = container.querySelector('#lines-feedback');

                    // Hardcoded relationships for simplicity (based on IDs)
                    // 1-TopBack, 2-LeftBack, 3-BottomBack, 4-RightBack
                    // 5-TopFront, 6-LeftFront, 7-BottomFront, 8-RightFront

                    // Example: 1 and 3 are Parallel. 1 and 2 are Concurrent. 1 and 7 are Skew (Reversas).
                    const checkRel = (id1, id2) => {
                        // Simplification logic
                        const diff = Math.abs(id1 - id2);

                        // Same face parallel? (e.g. 1 & 3)
                        if (diff === 2 && ((id1 <= 4 && id2 <= 4) || (id1 > 4))) return "Paralelas";
                        if (diff === 4) return "Paralelas"; // Front vs Back corresponding

                        // Concurrent (Touch at vertex)
                        // Too many combos to hardcode cleanly in short snippet, let's fake a bit for demo or use simple rules
                        // For pedagogical visual, randomize logical feedback if complex geometry engine isn't present,
                        // OR focus on the main ones:

                        if ((id1 == 1 && id2 == 7) || (id1 == 5 && id2 == 3)) return "Reversas (N√£o se tocam, n√£o paralelas)";
                        if ((id1 == 1 && id2 == 2) || (id1 == 5 && id2 == 6)) return "Concorrentes (Perpendiculares)";

                        return "Concorrentes ou Paralelas";
                    };

                    edges.forEach(e => {
                        e.onclick = () => {
                            const id = parseInt(e.dataset.id);

                            if (selectedEdges.includes(id)) {
                                // Deselect
                                selectedEdges = selectedEdges.filter(i => i !== id);
                                e.setAttribute('stroke', e.classList.contains('hover:stroke-brand-purple') ? '#cbd5e1' : '#64748b'); // Revert color logic simplified
                                e.style.stroke = "";
                            } else {
                                if (selectedEdges.length < 2) {
                                    selectedEdges.push(id);
                                    e.style.stroke = "#CE82FF";
                                }
                            }

                            if (selectedEdges.length === 2) {
                                const rel = checkRel(selectedEdges[0], selectedEdges[1]);
                                fb.innerText = rel;
                            } else {
                                fb.innerText = "";
                            }
                        };
                    });
                },

                interactive_euler_checker(container) {
                    let shape = 'tetra'; // tetra, cube, octa

                    const shapes = {
                        tetra: { n: "Tetraedro", v: 4, f: 4, a: 6 },
                        cube: { n: "Cubo", v: 8, f: 6, a: 12 },
                        octa: { n: "Octaedro", v: 6, f: 8, a: 12 }
                    };

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Verificador de Euler</h3>

        <div class="flex gap-2 mb-6">
            <button class="shape-btn bg-blue-100 text-blue-700 px-3 py-1 rounded font-bold text-xs" data-s="tetra">Tetraedro</button>
            <button class="shape-btn bg-gray-100 text-gray-500 px-3 py-1 rounded font-bold text-xs hover:bg-gray-200" data-s="cube">Cubo</button>
            <button class="shape-btn bg-gray-100 text-gray-500 px-3 py-1 rounded font-bold text-xs hover:bg-gray-200" data-s="octa">Octaedro</button>
        </div>

        <div class="grid grid-cols-3 gap-4 text-center mb-6 w-full max-w-sm">
            <div class="bg-gray-50 p-2 rounded-lg border border-gray-200">
                <div class="text-xs font-bold text-gray-400">V√©rtices (V)</div>
                <div class="text-2xl font-black text-brand-purple" id="val-v">4</div>
            </div>
            <div class="bg-gray-50 p-2 rounded-lg border border-gray-200">
                <div class="text-xs font-bold text-gray-400">Faces (F)</div>
                <div class="text-2xl font-black text-brand-orange" id="val-f">4</div>
            </div>
            <div class="bg-gray-50 p-2 rounded-lg border border-gray-200">
                <div class="text-xs font-bold text-gray-400">Arestas (A)</div>
                <div class="text-2xl font-black text-brand-blue" id="val-a">6</div>
            </div>
        </div>

        <div class="bg-gray-800 text-white p-4 rounded-xl text-center w-full max-w-sm shadow-lg">
            <p class="text-xs font-bold text-gray-400 mb-2 uppercase">A Conta M√°gica (V + F = A + 2)</p>
            <div class="font-mono text-lg flex items-center justify-center gap-2">
                <span class="text-brand-purple" id="calc-v">4</span> + 
                <span class="text-brand-orange" id="calc-f">4</span> = 
                <span class="text-brand-blue" id="calc-a">6</span> + 2
            </div>
            <div class="mt-2 text-2xl font-black text-green-400" id="calc-res">8 = 8 ‚úÖ</div>
        </div>

    </div>
    `;

                    const vVal = container.querySelector('#val-v');
                    const fVal = container.querySelector('#val-f');
                    const aVal = container.querySelector('#val-a');

                    const cV = container.querySelector('#calc-v');
                    const cF = container.querySelector('#calc-f');
                    const cA = container.querySelector('#calc-a');
                    const cRes = container.querySelector('#calc-res');
                    const btns = container.querySelectorAll('.shape-btn');

                    const update = () => {
                        const s = shapes[shape];

                        // Animate numbers
                        vVal.innerText = s.v;
                        fVal.innerText = s.f;
                        aVal.innerText = s.a;

                        cV.innerText = s.v;
                        cF.innerText = s.f;
                        cA.innerText = s.a;

                        const sumL = s.v + s.f;
                        const sumR = s.a + 2;
                        cRes.innerText = `${sumL} = ${sumR} ‚úÖ`;

                        // Update buttons
                        btns.forEach(b => {
                            if (b.dataset.s === shape) {
                                b.className = "shape-btn bg-blue-100 text-blue-700 px-3 py-1 rounded font-bold text-xs shadow-sm ring-1 ring-blue-300";
                            } else {
                                b.className = "shape-btn bg-gray-100 text-gray-500 px-3 py-1 rounded font-bold text-xs hover:bg-gray-200";
                            }
                        });
                    };

                    btns.forEach(b => b.onclick = () => { shape = b.dataset.s; update(); });
                },

                interactive_prism_volume_builder(container) {
                    let layers = 1;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Empilhando Fatias (Volume)</h3>

        <div class="flex items-end justify-center mb-6 relative h-40 w-full">
            <div id="stack-container" class="flex flex-col-reverse items-center gap-1 transition-all">
                </div>
            
            <div class="absolute right-4 bottom-0 flex flex-col text-xs font-bold text-gray-400">
                <span class="mb-1">Altura (h): <span id="h-val" class="text-brand-purple text-lg">1</span></span>
                <span>√Årea Base (Ab): <span class="text-brand-blue text-lg">10</span></span>
            </div>
        </div>

        <div class="flex gap-4 mb-4">
            <button id="btn-add" class="bg-brand-green text-white w-12 h-12 rounded-full font-black text-xl shadow-btn active:scale-95 transition-all">+</button>
            <button id="btn-rem" class="bg-gray-200 text-gray-600 w-12 h-12 rounded-full font-black text-xl shadow-sm hover:bg-red-100 hover:text-red-500 transition-all">-</button>
        </div>

        <div class="bg-gray-100 p-3 rounded-xl border border-gray-200 text-center w-full max-w-xs">
            <p class="text-xs uppercase font-bold text-gray-500">Volume Total</p>
            <p class="font-mono text-xl font-bold">
                <span class="text-brand-blue">10</span> √ó <span class="text-brand-purple" id="calc-h">1</span> = <span class="text-brand-green text-2xl" id="vol-res">10</span>
            </p>
        </div>

    </div>
    `;

                    const stack = container.querySelector('#stack-container');
                    const hVal = container.querySelector('#h-val');
                    const cH = container.querySelector('#calc-h');
                    const volRes = container.querySelector('#vol-res');

                    const render = () => {
                        stack.innerHTML = '';
                        for (let i = 0; i < layers; i++) {
                            const layer = document.createElement('div');
                            layer.className = "w-32 h-6 bg-blue-200 border-2 border-brand-blue rounded-md shadow-sm animate-pop-in";
                            // Visual stacking effect
                            layer.style.width = "120px";
                            stack.appendChild(layer);
                        }

                        hVal.innerText = layers;
                        cH.innerText = layers;
                        volRes.innerText = 10 * layers;
                    };

                    container.querySelector('#btn-add').onclick = () => { if (layers < 6) { layers++; render(); } };
                    container.querySelector('#btn-rem').onclick = () => { if (layers > 1) { layers--; render(); } };

                    render();
                },

                interactive_cone_cylinder_relation(container) {
                    let filled = false;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-6">A Regra do 1/3</h3>

        <div class="flex items-end gap-8 mb-8 h-40">
            
            <div class="relative flex flex-col items-center group cursor-pointer" id="cone-container">
                <div class="w-0 h-0 border-l-[40px] border-l-transparent border-r-[40px] border-r-transparent border-t-[80px] border-t-orange-200 relative z-10 opacity-80 transition-all"></div>
                <div class="absolute top-0 w-20 h-20 bg-orange-300 rounded-full scale-y-25 opacity-50 -z-0"></div> <div class="text-xs font-bold text-brand-orange mt-2">Cone (V)</div>
                
                <div id="cone-water" class="absolute top-0 w-0 h-0 border-l-[40px] border-l-transparent border-r-[40px] border-r-transparent border-t-[80px] border-t-blue-400 z-20 opacity-0 transition-opacity duration-500 pointer-events-none"></div>
            </div>

            <div class="text-2xl text-gray-300 pb-8">‚ûú</div>

            <div class="relative flex flex-col items-center">
                <div class="w-20 h-20 bg-gray-100 border-x-2 border-b-2 border-gray-300 relative overflow-hidden rounded-b-lg">
                    <div id="cyl-water" class="absolute bottom-0 w-full bg-blue-400 transition-all duration-1000 ease-out" style="height: 0%"></div>
                    <div class="absolute bottom-[33%] w-full h-px bg-red-400 border-t border-dashed opacity-50"></div>
                </div>
                <div class="text-xs font-bold text-gray-500 mt-2">Cilindro (3V)</div>
            </div>

        </div>

        <button id="btn-pour" class="bg-brand-blue text-white font-bold py-2 px-6 rounded-full shadow-btn active:scale-95 transition-all">
            <i class="fas fa-fill-drip"></i> Despejar Cone
        </button>

        <p id="res-text" class="mt-4 text-sm font-bold text-center text-gray-500 h-6"></p>

    </div>
    `;

                    const btn = container.querySelector('#btn-pour');
                    const cylWater = container.querySelector('#cyl-water');
                    const coneWater = container.querySelector('#cone-water');
                    const txt = container.querySelector('#res-text');

                    btn.onclick = () => {
                        filled = !filled;

                        if (filled) {
                            // Animation sequence
                            btn.disabled = true;
                            coneWater.classList.remove('opacity-0'); // Show water in cone

                            setTimeout(() => {
                                coneWater.classList.add('opacity-0'); // Empty cone
                                cylWater.style.height = "33%"; // Fill cylinder
                                txt.innerHTML = "O cone enche exatamente <span class='text-brand-red'>1/3</span> do cilindro!";
                                btn.innerText = "Esvaziar";
                                btn.classList.replace('bg-brand-blue', 'bg-red-500');
                                btn.disabled = false;
                            }, 800);
                        } else {
                            cylWater.style.height = "0%";
                            txt.innerText = "";
                            btn.innerText = "Despejar Cone";
                            btn.classList.replace('bg-red-500', 'bg-brand-blue');
                        }
                    };
                },

                interactive_distance_points(container) {
                    let p1 = { x: 1, y: 1 };
                    let p2 = { x: 4, y: 5 };
                    const scale = 30; // px per unit

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Dist√¢ncia entre Pontos</h3>

        <div class="relative w-[200px] h-[200px] bg-gray-50 border border-gray-200 rounded-xl mb-6 shadow-inner overflow-hidden" id="grid-bg">
            <div class="absolute inset-0" style="background-image: linear-gradient(#e5e7eb 1px, transparent 1px), linear-gradient(90deg, #e5e7eb 1px, transparent 1px); background-size: 30px 30px;"></div>
            
            <svg width="100%" height="100%" class="absolute inset-0 overflow-visible">
                <line id="line-h" stroke="#94a3b8" stroke-width="2" stroke-dasharray="4" />
                <line id="line-v" stroke="#94a3b8" stroke-width="2" stroke-dasharray="4" />
                <line id="line-d" stroke="#1CB0F6" stroke-width="3" />
                
                <circle id="pt-1" r="6" fill="#1CB0F6" stroke="white" stroke-width="2" />
                <circle id="pt-2" r="6" fill="#FF4B4B" stroke="white" stroke-width="2" />
            </svg>
        </div>

        <div class="flex gap-8 w-full justify-center text-sm font-mono font-bold bg-gray-100 p-3 rounded-xl mb-4">
            <div class="text-gray-500">Œîx = <span id="val-dx" class="text-black">3</span></div>
            <div class="text-gray-500">Œîy = <span id="val-dy" class="text-black">4</span></div>
        </div>

        <div class="text-center">
            <p class="text-xs font-bold text-gray-400 uppercase mb-1">Teorema de Pit√°goras</p>
            <p class="text-xl font-black text-brand-blue">d = <span id="val-d">5.0</span></p>
        </div>
        
        <div class="flex gap-2 mt-4">
            <button class="bg-gray-200 rounded px-3 py-1 text-xs font-bold hover:bg-gray-300" onclick="app.widgets.randPoints(this)">Novos Pontos</button>
        </div>

    </div>
    `;

                    const lH = container.querySelector('#line-h');
                    const lV = container.querySelector('#line-v');
                    const lD = container.querySelector('#line-d');
                    const c1 = container.querySelector('#pt-1');
                    const c2 = container.querySelector('#pt-2');
                    const vDx = container.querySelector('#val-dx');
                    const vDy = container.querySelector('#val-dy');
                    const vD = container.querySelector('#val-d');

                    const update = () => {
                        // Map logical to pixels (Origin bottom-left 10,190 visually approx)
                        const ox = 20;
                        const oy = 180;

                        const x1 = ox + p1.x * scale;
                        const y1 = oy - p1.y * scale;
                        const x2 = ox + p2.x * scale;
                        const y2 = oy - p2.y * scale;

                        // Update SVG
                        c1.setAttribute('cx', x1); c1.setAttribute('cy', y1);
                        c2.setAttribute('cx', x2); c2.setAttribute('cy', y2);

                        // Hypotenuse
                        lD.setAttribute('x1', x1); lD.setAttribute('y1', y1);
                        lD.setAttribute('x2', x2); lD.setAttribute('y2', y2);

                        // Legs
                        lH.setAttribute('x1', x1); lH.setAttribute('y1', y1);
                        lH.setAttribute('x2', x2); lH.setAttribute('y2', y1); // Horizontal to x2

                        lV.setAttribute('x1', x2); lV.setAttribute('y1', y1);
                        lV.setAttribute('x2', x2); lV.setAttribute('y2', y2); // Vertical to y2

                        // Maths
                        const dx = Math.abs(p2.x - p1.x);
                        const dy = Math.abs(p2.y - p1.y);
                        const d = Math.sqrt(dx * dx + dy * dy);

                        vDx.innerText = dx;
                        vDy.innerText = dy;
                        vD.innerText = d.toFixed(1);
                    };

                    app.widgets.randPoints = () => {
                        p1 = { x: Math.floor(Math.random() * 3), y: Math.floor(Math.random() * 3) };
                        p2 = { x: Math.floor(Math.random() * 3) + 3, y: Math.floor(Math.random() * 3) + 3 };
                        update();
                    };

                    update();
                },

                interactive_circle_equation_builder(container) {
                    let r = 2;
                    let cx = 0;
                    let cy = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-6">Equa√ß√£o da Circunfer√™ncia</h3>

        <div class="flex items-center gap-2 mb-6 font-mono text-lg md:text-xl font-bold bg-gray-100 p-3 rounded-xl border border-gray-300 shadow-inner">
            <span>(x - <span id="val-cx" class="text-brand-blue">0</span>)¬≤ + (y - <span id="val-cy" class="text-brand-orange">0</span>)¬≤ = <span id="val-r2" class="text-brand-green">4</span></span>
        </div>

        <div class="grid grid-cols-2 gap-6 w-full max-w-xs">
            <div class="col-span-2">
                <label class="text-[10px] font-bold text-gray-400 uppercase">Raio (R)</label>
                <input type="range" id="sl-r" min="1" max="5" value="2" class="w-full h-2 bg-green-100 rounded-lg accent-brand-green">
                <div class="text-center font-bold text-brand-green" id="disp-r">2</div>
            </div>
            
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase">Centro X</label>
                <input type="range" id="sl-cx" min="-3" max="3" value="0" class="w-full h-2 bg-blue-100 rounded-lg accent-brand-blue">
                <div class="text-center font-bold text-brand-blue" id="disp-cx">0</div>
            </div>
            
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase">Centro Y</label>
                <input type="range" id="sl-cy" min="-3" max="3" value="0" class="w-full h-2 bg-orange-100 rounded-lg accent-brand-orange">
                <div class="text-center font-bold text-brand-orange" id="disp-cy">0</div>
            </div>
        </div>

    </div>
    `;

                    const slR = container.querySelector('#sl-r');
                    const slCX = container.querySelector('#sl-cx');
                    const slCY = container.querySelector('#sl-cy');

                    const vCX = container.querySelector('#val-cx');
                    const vCY = container.querySelector('#val-cy');
                    const vR2 = container.querySelector('#val-r2');

                    const dR = container.querySelector('#disp-r');
                    const dCX = container.querySelector('#disp-cx');
                    const dCY = container.querySelector('#disp-cy');

                    const update = () => {
                        r = parseInt(slR.value);
                        cx = parseInt(slCX.value);
                        cy = parseInt(slCY.value);

                        // Update Equation Displays
                        vCX.innerText = cx;
                        vCY.innerText = cy;
                        vR2.innerText = r * r;

                        // Update Labels
                        dR.innerText = r;
                        dCX.innerText = cx;
                        dCY.innerText = cy;
                    };

                    slR.oninput = update;
                    slCX.oninput = update;
                    slCY.oninput = update;
                    update();
                },

                interactive_complex_rotation(container) {
                    let angle = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-purple font-bold uppercase text-xs tracking-widest mb-4">Multiplica√ß√£o por i</h3>

        <div class="relative w-64 h-64 bg-gray-50 border border-gray-300 rounded-full mb-6 flex items-center justify-center shadow-inner">
            <div class="absolute w-full h-px bg-gray-400"></div>
            <div class="absolute h-full w-px bg-gray-400"></div>
            
            <div id="vector-z" class="absolute h-1 bg-brand-purple origin-left w-24 rounded-full transition-transform duration-500" style="left: 50%; top: 50%; transform: rotate(0deg);">
                <div class="absolute -right-2 -top-1.5 w-0 h-0 border-l-[10px] border-l-brand-purple border-y-[6px] border-y-transparent"></div>
                <div class="absolute -right-2 -top-6 font-bold text-brand-purple text-lg transition-transform" id="lbl-z">z</div>
            </div>
        </div>

        <button id="btn-mult-i" class="bg-brand-blue text-white font-bold py-3 px-8 rounded-full shadow-btn active:scale-95 transition-all mb-4">
            √ó i (Girar 90¬∞)
        </button>

        <div class="text-center font-mono text-sm bg-gray-100 p-2 rounded w-full">
            Estado Atual: <span id="state-z" class="font-bold text-brand-purple">1 (Real)</span>
        </div>

    </div>
    `;

                    const vec = container.querySelector('#vector-z');
                    const lbl = container.querySelector('#lbl-z');
                    const btn = container.querySelector('#btn-mult-i');
                    const stateDisplay = container.querySelector('#state-z');

                    const states = ["1", "i", "-1", "-i"];

                    btn.onclick = () => {
                        angle -= 90; // Rotate Counter-Clockwise (CSS rotate is clockwise positive, Math standard is CCW.
                        // Wait, standard math angle 0 is Right. 90 is Up.
                        // CSS: 0 is Right (if div is horizontal). rotate(-90) points Up. 
                        // Yes, rotate(-90) is CCW 90deg visually.

                        vec.style.transform = `rotate(${angle}deg)`;

                        // Correct label rotation so it stays upright
                        lbl.style.transform = `rotate(${-angle}deg)`;

                        // Update Text
                        const idx = (Math.abs(angle / 90)) % 4;
                        stateDisplay.innerText = states[idx];
                    };
                },

                interactive_briot_ruffini(container) {
                    // Polynomial: x¬≥ - 4x¬≤ + 5x - 2 divided by (x - 1)
                    // Root: 1
                    // Coeffs: 1, -4, 5, -2

                    let step = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        
        <h3 class="text-brand-orange font-bold uppercase text-xs tracking-widest mb-4">Briot-Ruffini Passo a Passo</h3>
        <p class="text-xs text-gray-500 mb-6 font-mono">(x¬≥ - 4x¬≤ + 5x - 2) √∑ (x - 1)</p>

        <div class="grid grid-cols-[auto_1fr] gap-0 border-2 border-gray-300 rounded-lg bg-gray-50 p-2 text-xl font-mono w-full max-w-sm">
            
            <div class="border-r-2 border-gray-400 pr-4 py-2 font-bold text-brand-red flex items-center justify-center">1</div>
            
            <div class="grid grid-cols-4 gap-4 px-4 py-2 border-b-2 border-gray-400">
                <span>1</span><span>-4</span><span>5</span><span>-2</span>
            </div>

            <div class="border-r-2 border-gray-400"></div>

            <div class="grid grid-cols-4 gap-4 px-4 py-2 font-bold text-brand-blue" id="res-row">
                <span class="opacity-0 transition-opacity" id="r0">1</span>
                <span class="opacity-0 transition-opacity" id="r1">-3</span>
                <span class="opacity-0 transition-opacity" id="r2">2</span>
                <span class="opacity-0 transition-opacity text-brand-green bg-green-100 rounded px-1" id="r3">0</span>
            </div>
        </div>

        <div id="br-feedback" class="h-10 mt-4 text-center text-sm font-medium text-gray-600">
            Clique para come√ßar.
        </div>

        <button id="btn-br-next" class="mt-2 bg-brand-orange text-white font-bold py-2 px-8 rounded-full shadow-md active:scale-95">Pr√≥ximo Passo</button>

    </div>
    `;

                    const feedbacks = [
                        "Baixa o primeiro coeficiente (1).",
                        "Multiplica pela raiz (1x1=1) e soma com o pr√≥ximo (-4+1 = -3).",
                        "Multiplica (-3x1=-3) e soma com o pr√≥ximo (5-3 = 2).",
                        "Multiplica (2x1=2) e soma com o √∫ltimo (-2+2 = 0). Resto Zero!"
                    ];

                    const els = [
                        container.querySelector('#r0'),
                        container.querySelector('#r1'),
                        container.querySelector('#r2'),
                        container.querySelector('#r3')
                    ];
                    const fb = container.querySelector('#br-feedback');
                    const btn = container.querySelector('#btn-br-next');

                    btn.onclick = () => {
                        if (step < 4) {
                            els[step].classList.remove('opacity-0');
                            fb.innerText = feedbacks[step];
                            step++;
                        } else {
                            // Reset
                            step = 0;
                            els.forEach(e => e.classList.add('opacity-0'));
                            fb.innerText = "Reiniciando...";
                        }
                    };
                },

                interactive_normal_distribution(container) {
                    let sigma = 1;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-6 flex flex-col items-center w-full shadow-sm font-sans select-none">
        <h3 class="text-brand-blue font-bold uppercase text-xs tracking-widest mb-4">Curva Normal (Desvio Padr√£o)</h3>

        <div class="relative w-full h-40 border-b-2 border-gray-300 mb-6 flex items-end justify-center overflow-hidden">
            <svg viewBox="0 0 200 100" class="w-full h-full" preserveAspectRatio="none">
                <path id="bell-curve" d="" fill="rgba(28, 176, 246, 0.2)" stroke="#1CB0F6" stroke-width="3" />
            </svg>
            <div class="absolute bottom-0 h-full w-px bg-gray-400 border-l border-dashed"></div> </div>

        <div class="w-full max-w-xs">
            <div class="flex justify-between text-xs font-bold text-gray-500 uppercase mb-2">
                <span>Baixo Desvio (Fino)</span>
                <span>Alto Desvio (Largo)</span>
            </div>
            <input type="range" id="sigma-slider" min="10" max="60" value="30" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue">
        </div>
        
        <p id="sigma-desc" class="text-center text-sm font-bold text-brand-blue mt-4">Dados Homog√™neos</p>
    </div>
    `;

                    const path = container.querySelector('#bell-curve');
                    const slider = container.querySelector('#sigma-slider');
                    const desc = container.querySelector('#sigma-desc');

                    const update = () => {
                        const s = parseInt(slider.value);
                        // Generate Path
                        // Simple bell shape using quadratic bezier or generated points
                        // Peak at 100, 10. Width controlled by s.

                        // Let's generate points for y = e^(-(x-mu)^2 / 2sigma^2)
                        let d = "M 0 100 ";
                        for (let x = 0; x <= 200; x += 5) {
                            const mu = 100;
                            // Scale sigma visual
                            const sig = s;
                            const yNorm = Math.exp(-Math.pow(x - mu, 2) / (2 * sig * sig));
                            const yPlot = 100 - (yNorm * 90); // Height 90px
                            d += `L ${x} ${yPlot} `;
                        }
                        d += "L 200 100 Z";

                        path.setAttribute('d', d);

                        if (s < 25) desc.innerText = "Dados Homog√™neos (Todos parecidos)";
                        else if (s > 45) desc.innerText = "Dados Heterog√™neos (Muito diferentes)";
                        else desc.innerText = "Dispers√£o M√©dia";
                    };

                    slider.oninput = update;
                    update();
                },











                // Insira um novo WIDGET: na linha acima desta

                game_circle_elements_quiz(container) {
                    const questions = [
                        { q: "Qual linha liga o centro √† borda?", ans: "Raio" },
                        { q: "Qual √© a maior corda poss√≠vel?", ans: "Di√¢metro" },
                        { q: "Linha que toca o c√≠rculo em 1 ponto?", ans: "Tangente" },
                        { q: "Regi√£o interna do c√≠rculo?", ans: "√Årea" },
                        { q: "Peda√ßo da curva da borda?", ans: "Arco" },
                    ];

                    let current = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">
        
        <div class="flex justify-between w-full mb-6 z-10">
            <h3 class="font-black text-brand-blue uppercase text-xs tracking-widest">Quiz R√°pido</h3>
            <div class="bg-gray-800 px-3 py-1 rounded text-xs font-bold">PTS: <span id="quiz-score">0</span></div>
        </div>

        <div class="w-full text-center mb-8 h-20 flex items-center justify-center">
            <p class="text-2xl font-bold" id="q-text">...</p>
        </div>

        <div class="grid grid-cols-2 gap-3 w-full z-10" id="opts-grid">
            <button class="quiz-opt bg-gray-700 hover:bg-gray-600 py-4 rounded-xl font-bold border-b-4 border-gray-900 active:border-b-0 active:translate-y-1 transition-all">Raio</button>
            <button class="quiz-opt bg-gray-700 hover:bg-gray-600 py-4 rounded-xl font-bold border-b-4 border-gray-900 active:border-b-0 active:translate-y-1 transition-all">Di√¢metro</button>
            <button class="quiz-opt bg-gray-700 hover:bg-gray-600 py-4 rounded-xl font-bold border-b-4 border-gray-900 active:border-b-0 active:translate-y-1 transition-all">Corda</button>
            <button class="quiz-opt bg-gray-700 hover:bg-gray-600 py-4 rounded-xl font-bold border-b-4 border-gray-900 active:border-b-0 active:translate-y-1 transition-all">Tangente</button>
        </div>
        
        <div id="quiz-end" class="absolute inset-0 bg-gray-900 flex flex-col items-center justify-center hidden z-20">
            <div class="text-5xl mb-4">üèÅ</div>
            <h3 class="text-2xl font-black mb-2">Fim de Jogo!</h3>
            <p class="text-gray-400 mb-6">Acertos: <span id="final-pts"></span></p>
            <button id="btn-restart-quiz" class="bg-brand-blue text-white font-bold py-2 px-8 rounded-full">Jogar Novamente</button>
        </div>

    </div>
    `;

                    const qText = container.querySelector("#q-text");
                    const scoreEl = container.querySelector("#quiz-score");
                    const finalPts = container.querySelector("#final-pts");
                    const endScreen = container.querySelector("#quiz-end");
                    const optsDiv = container.querySelector("#opts-grid");

                    const allOptions = [
                        "Raio",
                        "Di√¢metro",
                        "Corda",
                        "Tangente",
                        "Secante",
                        "Arco",
                        "√Årea",
                        "Per√≠metro",
                    ];

                    const loadQ = () => {
                        if (current >= questions.length) {
                            finalPts.innerText = score;
                            endScreen.classList.remove("hidden");
                            return;
                        }

                        const q = questions[current];
                        qText.innerText = q.q;

                        // Generate options (1 correct + 3 wrong)
                        let opts = [q.ans];
                        while (opts.length < 4) {
                            const r =
                                allOptions[Math.floor(Math.random() * allOptions.length)];
                            if (!opts.includes(r)) opts.push(r);
                        }
                        opts.sort(() => Math.random() - 0.5);

                        optsDiv.innerHTML = "";
                        opts.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-gray-700 hover:bg-gray-600 py-4 rounded-xl font-bold border-b-4 border-gray-900 active:border-b-0 active:translate-y-1 transition-all";
                            btn.innerText = opt;
                            btn.onclick = () => check(opt, btn);
                            optsDiv.appendChild(btn);
                        });
                    };

                    const check = (ans, btn) => {
                        const correct = questions[current].ans;
                        if (ans === correct) {
                            score += 10;
                            scoreEl.innerText = score;
                            btn.classList.add("bg-green-600", "border-green-800");
                        } else {
                            btn.classList.add("bg-red-600", "border-red-800");
                        }

                        // Disable all
                        Array.from(optsDiv.children).forEach((b) => (b.disabled = true));

                        setTimeout(() => {
                            current++;
                            loadQ();
                        }, 800);
                    };

                    container.querySelector("#btn-restart-quiz").onclick = () => {
                        current = 0;
                        score = 0;
                        scoreEl.innerText = 0;
                        endScreen.classList.add("hidden");
                        loadQ();
                    };

                    loadQ();
                },

                game_angle_archery(container) {
                    let targetAngle = 60;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-4 flex flex-col items-center w-full shadow-sm font-sans select-none overflow-hidden relative">
        
        <div class="flex justify-between w-full mb-4">
            <h3 class="text-brand-red font-black uppercase text-xs tracking-widest">Arqueiro Angular</h3>
            <div class="text-xs font-bold text-gray-500">Score: <span id="archery-score" class="text-brand-red">0</span></div>
        </div>

        <p class="text-center text-sm font-bold text-gray-600 mb-2">
            Acerte o alvo em: <span id="target-val" class="text-2xl font-black text-brand-red">60¬∞</span>
        </p>

        <div class="relative w-64 h-40 bg-blue-50 border-b-4 border-gray-400 rounded-t-full flex items-end justify-center mb-6 overflow-hidden">
            
            <div class="absolute bottom-0 w-2 h-2 bg-black rounded-full z-20"></div>
            
            <div id="aim-line" class="absolute bottom-0 left-1/2 w-1 h-[140px] bg-red-500 origin-bottom transition-transform duration-75 z-10" style="transform: rotate(-90deg);"></div>

            <div id="target-zone" class="absolute w-[280px] h-[280px] rounded-full border-4 border-dashed border-red-300 opacity-50 pointer-events-none" style="bottom: -140px;"></div>

        </div>

        <div class="w-full max-w-xs flex gap-4">
            <input type="range" id="bow-slider" min="0" max="180" value="0" class="flex-1 h-4 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-red">
            <button id="btn-shoot" class="bg-brand-red text-white font-bold w-16 rounded-lg shadow-btn active:scale-95">TIRO</button>
        </div>

        <div id="archery-fb" class="h-8 mt-2 font-bold text-center text-sm"></div>

    </div>
    `;

                    const slider = container.querySelector("#bow-slider");
                    const aim = container.querySelector("#aim-line");
                    const btn = container.querySelector("#btn-shoot");
                    const targetDisp = container.querySelector("#target-val");
                    const feedback = container.querySelector("#archery-fb");
                    const scoreEl = container.querySelector("#archery-score");

                    const newRound = () => {
                        targetAngle = Math.floor(Math.random() * 160) + 10;
                        targetDisp.innerText = targetAngle + "¬∞";
                        slider.value = 90; // Reset center
                        updateAim();
                        feedback.innerText = "";
                        btn.disabled = false;
                        btn.classList.remove("opacity-50");
                    };

                    const updateAim = () => {
                        const val = slider.value;
                        // 0 on slider = Left (180 deg math). 180 on slider = Right (0 deg math).
                        // Let's make 0 left (lay flat left) and 180 right (lay flat right).
                        // Vertical is 90.
                        // CSS Rotation: 0 points up? No, div is vertical line.
                        // rotate(0) points UP.
                        // If slider is 0 (left), rotate should be -90.
                        // If slider is 180 (right), rotate should be 90.
                        // Map 0..180 to -90..90
                        const rot = parseInt(val) - 90;
                        aim.style.transform = `rotate(${rot}deg)`;
                    };

                    slider.oninput = updateAim;

                    btn.onclick = () => {
                        const shot = parseInt(slider.value);
                        // Math angle convention: Right=0, Left=180.
                        // Our target is given in standard protractor (0 right, 180 left).
                        // Slider 0 is left (180), Slider 180 is right (0).
                        // Let's simplify: Target is 0-180 scale where 0 is Right, 90 Up, 180 Left.
                        // Slider matches this logic: 0..180.
                        // But visually slider 0 is left.

                        // Let's assume standard Protractor:
                        // Left = 180, Top = 90, Right = 0.
                        // Slider: Left(0) -> Right(100%).
                        // We need to invert slider value to match protractor?
                        // Let's just make the game match the slider value visually.
                        // Slider 0 -> Angle 0 (Right? No, usually Left in UI sliders).
                        // Let's define: 0 degrees is Right (East). 180 is Left (West).
                        // Slider: 0 (Left) to 180 (Right).
                        // So Shot Angle = 180 - SliderValue.

                        const angleShot = 180 - shot;

                        const diff = Math.abs(angleShot - targetAngle);

                        if (diff < 5) {
                            score += 50;
                            feedback.innerHTML = `<span class="text-green-500">NA MOSCA! (${angleShot}¬∞)</span>`;
                            setTimeout(newRound, 1000);
                        } else if (diff < 15) {
                            score += 10;
                            feedback.innerHTML = `<span class="text-orange-500">Perto! (${angleShot}¬∞)</span>`;
                            setTimeout(newRound, 1000);
                        } else {
                            feedback.innerHTML = `<span class="text-red-500">Errou feio! (${angleShot}¬∞)</span>`;
                            // Penalty?
                        }
                        scoreEl.innerText = score;
                    };

                    newRound();
                },

                game_stats_quiz(container) {
                    const questions = [
                        {
                            q: "Lan√ßar uma moeda tem 2 resultados. Lan√ßar 2 moedas tem...",
                            ans: "4",
                            opts: ["2", "3", "4", "5"],
                        },
                        {
                            q: "Qual a m√©dia de: 2, 4, 6?",
                            ans: "4",
                            opts: ["2", "4", "6", "12"],
                        },
                        {
                            q: "A chance de cair '6' no dado √©...",
                            ans: "1/6",
                            opts: ["1/2", "1/6", "50%", "1/5"],
                        },
                        {
                            q: "O valor que mais se repete √© a...",
                            ans: "Moda",
                            opts: ["M√©dia", "Moda", "Mediana", "Amplitude"],
                        },
                        {
                            q: "Max - Min chama-se...",
                            ans: "Amplitude",
                            opts: ["Desvio", "Amplitude", "Varia√ß√£o", "M√©dia"],
                        },
                    ];

                    let current = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">
        
        <div class="flex justify-between w-full mb-6 z-10">
            <h3 class="font-black text-brand-blue uppercase text-xs tracking-widest">Estat√≠stica R√°pida</h3>
            <div class="bg-gray-800 px-3 py-1 rounded text-xs font-bold">PTS: <span id="quiz-st-score">0</span></div>
        </div>

        <div class="w-full text-center mb-8 min-h-[60px] flex items-center justify-center bg-gray-800 rounded-xl p-4 border border-gray-600">
            <p class="text-xl font-bold text-green-400" id="q-st-text">...</p>
        </div>

        <div class="grid grid-cols-2 gap-3 w-full z-10" id="opts-st-grid">
        </div>
        
        <div id="quiz-st-end" class="absolute inset-0 bg-gray-900 flex flex-col items-center justify-center hidden z-20">
            <div class="text-5xl mb-4">üìä</div>
            <h3 class="text-2xl font-black mb-2">An√°lise Completa!</h3>
            <p class="text-gray-400 mb-6">Resultado: <span id="final-st-pts"></span>/5</p>
            <button id="btn-restart-st" class="bg-brand-blue text-white font-bold py-2 px-8 rounded-full">Reiniciar</button>
        </div>

    </div>
    `;

                    const qText = container.querySelector("#q-st-text");
                    const scoreEl = container.querySelector("#quiz-st-score");
                    const finalPts = container.querySelector("#final-st-pts");
                    const endScreen = container.querySelector("#quiz-st-end");
                    const optsDiv = container.querySelector("#opts-st-grid");

                    const loadQ = () => {
                        if (current >= questions.length) {
                            finalPts.innerText = score;
                            endScreen.classList.remove("hidden");
                            return;
                        }

                        const q = questions[current];
                        qText.innerText = q.q;
                        optsDiv.innerHTML = "";

                        q.opts.forEach((opt) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-gray-700 hover:bg-gray-600 py-4 rounded-xl font-bold border-b-4 border-gray-900 active:border-b-0 active:translate-y-1 transition-all text-sm";
                            btn.innerText = opt;
                            btn.onclick = () => check(opt, btn);
                            optsDiv.appendChild(btn);
                        });
                    };

                    const check = (ans, btn) => {
                        const correct = questions[current].ans;
                        // Disable all
                        Array.from(optsDiv.children).forEach((b) => (b.disabled = true));

                        if (ans === correct) {
                            score++;
                            scoreEl.innerText = score;
                            btn.classList.add("bg-green-600", "border-green-800");
                        } else {
                            btn.classList.add("bg-red-600", "border-red-800");
                            // Show correct
                            Array.from(optsDiv.children).forEach((b) => {
                                if (b.innerText === correct)
                                    b.classList.add("bg-green-600", "border-green-800");
                            });
                        }

                        setTimeout(() => {
                            current++;
                            loadQ();
                        }, 1000);
                    };

                    container.querySelector("#btn-restart-st").onclick = () => {
                        current = 0;
                        score = 0;
                        scoreEl.innerText = 0;
                        endScreen.classList.add("hidden");
                        loadQ();
                    };

                    loadQ();
                },

                game_radical_memory(container) {
                    // Pairs: [Latex display, Matching ID]
                    // Pair 1: ‚àö4 , 2
                    // Pair 2: ‚àö9 , 3
                    // Pair 3: 2¬≥, 8
                    // Pair 4: 5‚Å∞, 1

                    const cardsData = [
                        { content: "‚àö4", matchId: 1 },
                        { content: "2", matchId: 1 },
                        { content: "‚àö9", matchId: 2 },
                        { content: "3", matchId: 2 },
                        { content: "2¬≥", matchId: 3 },
                        { content: "8", matchId: 3 },
                        { content: "5‚Å∞", matchId: 4 },
                        { content: "1", matchId: 4 },
                    ];

                    let flipped = [];
                    let matched = [];
                    let isLocked = false;

                    // Shuffle
                    cardsData.sort(() => Math.random() - 0.5);

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full mb-6 z-10">
            <h3 class="font-black text-brand-green uppercase text-xs tracking-widest">Mem√≥ria Radical</h3>
            <div class="text-white text-xs font-bold bg-gray-800 px-3 py-1 rounded">Pares: <span id="pairs-found">0</span>/4</div>
        </div>

        <div class="grid grid-cols-4 gap-2 w-full z-10" id="memory-grid">
            ${cardsData
                            .map(
                                (c, i) => `
                <div class="mem-card bg-gray-700 h-20 rounded-lg cursor-pointer flex items-center justify-center text-white font-bold text-xl border-b-4 border-gray-900 active:border-b-0 active:translate-y-1 transition-all" data-idx="${i}">
                    <span class="content hidden pointer-events-none">${c.content}</span>
                    <span class="icon text-gray-500 text-2xl">?</span>
                </div>
            `
                            )
                            .join("")}
        </div>

        <div id="mem-win" class="absolute inset-0 bg-gray-900/95 hidden flex-col items-center justify-center z-20">
            <div class="text-6xl mb-4">üß†</div>
            <h3 class="text-2xl font-black text-white">Mem√≥ria de Elefante!</h3>
            <button onclick="app.widgets.game_radical_memory(this.parentElement.parentElement.parentElement)" class="mt-6 bg-brand-green text-white font-bold py-2 px-6 rounded-full">Jogar Novamente</button>
        </div>

    </div>
    `;

                    const grid = container.querySelector("#memory-grid");
                    const scoreEl = container.querySelector("#pairs-found");
                    const winScreen = container.querySelector("#mem-win");
                    const cardEls = container.querySelectorAll(".mem-card");

                    const checkMatch = () => {
                        const c1 = cardsData[flipped[0]];
                        const c2 = cardsData[flipped[1]];

                        if (c1.matchId === c2.matchId) {
                            // Match
                            matched.push(flipped[0], flipped[1]);
                            flipped.forEach((idx) => {
                                cardEls[idx].classList.remove(
                                    "bg-gray-700",
                                    "border-gray-900"
                                );
                                cardEls[idx].classList.add(
                                    "bg-green-600",
                                    "border-green-800"
                                );
                            });
                            flipped = [];
                            isLocked = false;
                            scoreEl.innerText = matched.length / 2;

                            if (matched.length === cardsData.length) {
                                setTimeout(() => winScreen.classList.remove("hidden"), 500);
                            }
                        } else {
                            // No Match
                            setTimeout(() => {
                                flipped.forEach((idx) => {
                                    const card = cardEls[idx];
                                    card.querySelector(".content").classList.add("hidden");
                                    card.querySelector(".icon").classList.remove("hidden");
                                    card.classList.remove("bg-blue-600", "border-blue-800");
                                    card.classList.add("bg-gray-700", "border-gray-900");
                                });
                                flipped = [];
                                isLocked = false;
                            }, 1000);
                        }
                    };

                    cardEls.forEach((card) => {
                        card.onclick = () => {
                            const idx = parseInt(card.dataset.idx);

                            if (isLocked || flipped.includes(idx) || matched.includes(idx))
                                return;

                            // Flip
                            card.querySelector(".content").classList.remove("hidden");
                            card.querySelector(".icon").classList.add("hidden");
                            card.classList.remove("bg-gray-700", "border-gray-900");
                            card.classList.add("bg-blue-600", "border-blue-800");

                            flipped.push(idx);

                            if (flipped.length === 2) {
                                isLocked = true;
                                checkMatch();
                            }
                        };
                    });
                },

                game_sum_product_puzzle(container) {
                    const levels = [
                        { s: 5, p: 6, ans: [2, 3] },
                        { s: 7, p: 12, ans: [3, 4] },
                        { s: 2, p: -15, ans: [5, -3] }, // Soma 2, Prod -15 -> 5 e -3
                        { s: -6, p: 8, ans: [-2, -4] },
                    ];
                    let currentLvl = 0;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full text-white mb-6 z-10">
            <h3 class="font-black uppercase text-xs tracking-widest text-brand-purple">Desafio Girard</h3>
            <div class="bg-gray-800 px-3 py-1 rounded-full text-xs font-bold text-gray-400">N√≠vel <span id="girard-lvl">1</span></div>
        </div>

        <div class="bg-black border-2 border-gray-600 p-4 rounded-xl w-full text-center mb-6 z-10 shadow-[0_0_15px_rgba(168,85,247,0.2)]">
            <p class="text-gray-400 text-xs uppercase font-bold mb-2">Encontre dois n√∫meros que:</p>
            <div class="flex justify-around text-xl md:text-2xl font-mono font-bold text-white">
                <div>
                    <span class="text-brand-red">Soma</span> = <span id="val-s">5</span>
                </div>
                <div>
                    <span class="text-brand-blue">Produto</span> = <span id="val-p">6</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 w-full max-w-xs z-10 mb-4">
            <input type="number" id="ans-x1" class="bg-gray-800 border-2 border-gray-600 rounded-lg p-3 text-center text-white font-bold text-xl outline-none focus:border-brand-purple" placeholder="x'">
            <input type="number" id="ans-x2" class="bg-gray-800 border-2 border-gray-600 rounded-lg p-3 text-center text-white font-bold text-xl outline-none focus:border-brand-purple" placeholder="x''">
        </div>

        <button id="btn-check-girard" class="bg-brand-purple text-white font-bold py-3 px-10 rounded-full shadow-lg active:scale-95 transition-all z-10 w-full max-w-xs">
            Verificar
        </button>

        <div id="girard-feedback" class="h-8 mt-4 font-bold text-sm text-center text-white z-10"></div>

        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20 z-0"></div>
    </div>
    `;

                    const sDisp = container.querySelector("#val-s");
                    const pDisp = container.querySelector("#val-p");
                    const in1 = container.querySelector("#ans-x1");
                    const in2 = container.querySelector("#ans-x2");
                    const btn = container.querySelector("#btn-check-girard");
                    const fb = container.querySelector("#girard-feedback");
                    const lvlDisp = container.querySelector("#girard-lvl");

                    const load = () => {
                        if (currentLvl >= levels.length) {
                            container.innerHTML = `
                <div class="bg-brand-green border-4 border-green-800 rounded-xl p-8 text-center w-full text-white animate-pop-in">
                    <div class="text-6xl mb-4">üß†</div>
                    <h3 class="text-2xl font-black">Mente Brilhante!</h3>
                    <p class="mt-2">Voc√™ dominou a Soma e Produto.</p>
                </div>
            `;
                            return;
                        }

                        const l = levels[currentLvl];
                        sDisp.innerText = l.s;
                        pDisp.innerText = l.p;
                        lvlDisp.innerText = currentLvl + 1;
                        in1.value = "";
                        in2.value = "";
                        fb.innerText = "";
                        btn.innerText = "Verificar";
                        btn.classList.remove("bg-gray-600", "cursor-not-allowed");
                        btn.disabled = false;
                    };

                    btn.onclick = () => {
                        const v1 = parseInt(in1.value);
                        const v2 = parseInt(in2.value);
                        const l = levels[currentLvl];

                        // Ordem n√£o importa
                        const userSet = [v1, v2].sort((a, b) => a - b).join(",");
                        const ansSet = [...l.ans].sort((a, b) => a - b).join(",");

                        if (userSet === ansSet) {
                            fb.innerHTML =
                                "<span class='text-green-400'>Correto! Pr√≥ximo...</span>";
                            btn.disabled = true;
                            setTimeout(() => {
                                currentLvl++;
                                load();
                            }, 1000);
                        } else {
                            fb.innerHTML =
                                "<span class='text-red-400'>Ops! Tente novamente.</span>";
                            container
                                .querySelector(".bg-gray-900")
                                .classList.add("animate-shake");
                            setTimeout(
                                () =>
                                    container
                                        .querySelector(".bg-gray-900")
                                        .classList.remove("animate-shake"),
                                500
                            );
                        }
                    };

                    load();
                },

                game_projectile_parabola(container) {
                    // Configura√ß√£o
                    let a = -0.5; // Concavidade fixa ou semi-fixa para facilitar
                    let b = 2; // Controle do jogador
                    let c = 0; // Altura inicial fixa

                    let score = 0;
                    let target = { x: 8, width: 2 }; // Alvo em x=8

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[450px]">
        
        <div class="flex justify-between w-full items-center mb-2 z-20">
            <h3 class="text-white font-black uppercase text-xs tracking-widest"><i class="fas fa-meteor"></i> Mestre da Par√°bola</h3>
            <div class="bg-gray-800 px-3 py-1 rounded text-xs font-bold text-yellow-400">PTS: <span id="proj-score">0</span></div>
        </div>

        <div class="relative w-full flex-1 bg-gray-800 rounded-lg border border-gray-600 mb-4 overflow-hidden" id="sky-canvas">
            <div class="absolute inset-0 opacity-10" style="background-image: linear-gradient(white 1px, transparent 1px), linear-gradient(90deg, white 1px, transparent 1px); background-size: 20px 20px;"></div>
            
            <div class="absolute bottom-4 left-4 w-8 h-8 bg-blue-500 rounded-full z-10 flex items-center justify-center font-bold text-white text-xs">0</div>

            <div id="target-box" class="absolute bottom-4 h-2 bg-red-500 z-10 transition-all duration-300" style="left: 200px; width: 40px;">
                <div class="absolute -top-6 left-1/2 -translate-x-1/2 text-xl">üéØ</div>
            </div>

            <svg width="100%" height="100%" class="absolute inset-0 pointer-events-none z-0" id="traj-svg" viewBox="0 0 100 100" preserveAspectRatio="none">
                <path id="traj-path" d="" fill="none" stroke="#FBBF24" stroke-width="1" stroke-dasharray="2,2" class="opacity-50" />
            </svg>

            <div id="ball" class="absolute w-4 h-4 bg-yellow-400 rounded-full shadow-[0_0_10px_#fbbf24] hidden z-20"></div>
        </div>

        <div class="w-full max-w-sm bg-gray-800 p-3 rounded-xl border-t-2 border-gray-600 z-20">
            <div class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-2">
                <span>Ajuste o √¢ngulo (b)</span>
                <span id="val-b" class="text-white">2.0</span>
            </div>
            <input type="range" id="ctrl-b" min="0" max="5" step="0.1" value="2" class="w-full h-4 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-500">
            
            <button id="btn-fire" class="w-full mt-3 bg-red-600 hover:bg-red-500 text-white font-black py-3 rounded-lg shadow-lg active:scale-95 transition-all uppercase tracking-widest">
                FOGO!
            </button>
        </div>

        <div id="feedback-overlay" class="absolute inset-0 bg-black/80 flex flex-col items-center justify-center hidden z-30">
            <div class="text-6xl mb-2" id="fb-icon">üéâ</div>
            <h3 class="text-2xl font-black text-white" id="fb-text">ACERTOU!</h3>
            <button id="btn-retry" class="mt-4 bg-white text-gray-900 font-bold py-2 px-6 rounded-full">Pr√≥ximo</button>
        </div>

    </div>
    `;

                    const svg = container.querySelector("#traj-svg");
                    const path = container.querySelector("#traj-path");
                    const ball = container.querySelector("#ball");
                    const targetBox = container.querySelector("#target-box");
                    const slider = container.querySelector("#ctrl-b");
                    const valB = container.querySelector("#val-b");
                    const btnFire = container.querySelector("#btn-fire");
                    const feedback = container.querySelector("#feedback-overlay");
                    const fbIcon = container.querySelector("#fb-icon");
                    const fbText = container.querySelector("#fb-text");
                    const scoreEl = container.querySelector("#proj-score");
                    const canvas = container.querySelector("#sky-canvas");

                    const newRound = () => {
                        feedback.classList.add("hidden");
                        // Random target position (percent 20% to 90%)
                        const pos = 20 + Math.random() * 70;
                        targetBox.style.left = `${pos}%`;

                        // Reset controls
                        slider.value = 1;
                        updatePreview();
                    };

                    const updatePreview = () => {
                        b = parseFloat(slider.value);
                        valB.innerText = b.toFixed(1);

                        // Visualize Path (Preview)
                        // Equation: y = ax^2 + bx (inverted Y for SVG)
                        // Normalized coordinates 0-100
                        // Let's assume x goes 0-10 (time/distance).

                        let d = "M 0 100 ";
                        for (let x = 0; x <= 100; x += 2) {
                            // Scale X: 0-100% maps to mathematical X 0-10
                            const mathX = x / 10;
                            const mathY = a * mathX * mathX + b * mathX;

                            // Map math Y to SVG Y (100 is bottom, 0 is top)
                            // Scale Y: mathY 0-10 maps to 0-100% height?
                            const svgY = 100 - mathY * 10;

                            d += `L ${x} ${svgY} `;
                        }
                        path.setAttribute("d", d);
                    };

                    const fire = () => {
                        ball.classList.remove("hidden");
                        btnFire.disabled = true;
                        btnFire.classList.add("opacity-50");

                        let x = 0;
                        const interval = setInterval(() => {
                            x += 0.5; // Speed

                            const mathX = x / 10;
                            const mathY = a * mathX * mathX + b * mathX;
                            const svgY = 100 - mathY * 10;

                            ball.style.left = `calc(${x}% - 8px)`; // Center anchor
                            ball.style.top = `calc(${svgY}% - 8px)`;

                            // Check Collision with Ground
                            if (svgY >= 100) {
                                clearInterval(interval);
                                checkHit(x);
                            }
                            // Out of bounds
                            if (x > 100) {
                                clearInterval(interval);
                                checkHit(x);
                            }
                        }, 16);
                    };

                    const checkHit = (landingX) => {
                        // Target position in %
                        const targetLeft = parseFloat(targetBox.style.left);
                        const targetWidth = 10; // Approx width in % (40px/containerWidth) -> dynamic calculation needed for precision but let's approximate 10% for simplicity of logic visual game
                        // Actually let's get real rects

                        const ballRect = ball.getBoundingClientRect();
                        const targetRect = targetBox.getBoundingClientRect();

                        // Simple collision
                        const hit = !(
                            ballRect.right < targetRect.left ||
                            ballRect.left > targetRect.right ||
                            ballRect.bottom < targetRect.top ||
                            ballRect.top > targetRect.bottom
                        );

                        if (hit) {
                            score += 100;
                            scoreEl.innerText = score;
                            fbIcon.innerText = "üéØ";
                            fbText.innerText = "NA MOSCA!";
                            fbText.className = "text-2xl font-black text-green-400";
                        } else {
                            fbIcon.innerText = "üí•";
                            fbText.innerText = "ERROU!";
                            fbText.className = "text-2xl font-black text-red-500";
                        }

                        feedback.classList.remove("hidden");
                        btnFire.disabled = false;
                        btnFire.classList.remove("opacity-50");
                    };

                    slider.oninput = updatePreview;
                    btnFire.onclick = fire;
                    container.querySelector("#btn-retry").onclick = newRound;

                    // Init
                    setTimeout(newRound, 100);
                },

                game_tales_bridge(container) {
                    // Game State
                    const levels = [
                        { top: 10, bot: 5, rightTop: 20, ans: 10 }, // 10/5 = 2 -> 20/x = 2 -> x=10
                        { top: 8, bot: 12, rightTop: 6, ans: 9 }, // 8/12 = 2/3 -> 6/x = 2/3 -> 18=2x -> x=9
                        { top: 15, bot: 15, rightTop: 7, ans: 7 }, // 1:1 -> 7:7
                    ];
                    let currentLvl = 0;

                    container.innerHTML = `
    <div class="bg-blue-50 border-4 border-blue-200 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[400px]">
        
        <div class="flex justify-between w-full mb-4 z-10">
            <h3 class="font-black text-blue-800 uppercase text-xs tracking-widest"><i class="fas fa-bridge"></i> Engenheiro de Pontes</h3>
            <div class="bg-white px-3 py-1 rounded-full text-xs font-bold text-blue-600">N√≠vel <span id="bridge-lvl">1</span></div>
        </div>

        <div class="relative w-full flex-1 flex justify-center items-center">
            <div class="absolute inset-x-0 top-1/2 -translate-y-1/2 h-24 bg-blue-300 opacity-50 w-full transform -skew-y-6"></div>

            <svg width="100%" height="100%" class="relative z-10 overflow-visible">
                <line x1="20%" y1="20%" x2="20%" y2="80%" stroke="#64748B" stroke-width="4" />
                <line x1="80%" y1="20%" x2="80%" y2="80%" stroke="#64748B" stroke-width="4" />
                
                <line x1="10%" y1="30%" x2="90%" y2="40%" stroke="#1E293B" stroke-width="6" />
                <line x1="10%" y1="60%" x2="90%" y2="70%" stroke="#1E293B" stroke-width="6" />

                <rect x="45%" y="28%" width="40" height="20" fill="white" rx="4" />
                <text x="50%" y="33%" text-anchor="middle" font-weight="bold" fill="#1E293B" id="val-lt">10</text>
                
                <rect x="45%" y="63%" width="40" height="20" fill="white" rx="4" />
                <text x="50%" y="68%" text-anchor="middle" font-weight="bold" fill="#1E293B" id="val-lb">5</text>

                <rect x="82%" y="30%" width="40" height="20" fill="white" rx="4" />
                <text x="87%" y="35%" text-anchor="middle" font-weight="bold" fill="#1E293B" id="val-rt">20</text>

                <rect x="82%" y="65%" width="40" height="24" fill="#FFC800" rx="4" stroke="#F59E0B" stroke-width="2" />
                <text x="87%" y="71%" text-anchor="middle" font-weight="black" fill="#78350F" font-size="16">?</text>
            </svg>
        </div>

        <div class="w-full max-w-xs flex gap-2 z-20">
            <input type="number" id="bridge-input" class="flex-1 rounded-xl border-4 border-blue-200 p-3 text-center text-2xl font-black text-blue-900 outline-none focus:border-blue-400" placeholder="?">
            <button id="btn-build" class="bg-blue-600 text-white font-bold px-6 rounded-xl shadow-[0_4px_0_#1e3a8a] active:shadow-none active:translate-y-1 transition-all">CONSTRUIR</button>
        </div>

        <div id="bridge-feedback" class="absolute inset-0 bg-white/90 z-30 hidden flex-col items-center justify-center text-center p-6">
            <div class="text-6xl mb-4" id="fb-icon">üéâ</div>
            <h3 class="text-2xl font-black text-brand-blue mb-2" id="fb-title">Ponte Segura!</h3>
            <button id="btn-next-bridge" class="bg-brand-green text-white font-bold py-3 px-8 rounded-full shadow-lg">Pr√≥xima Obra</button>
        </div>

    </div>
    `;

                    const valLT = container.querySelector("#val-lt");
                    const valLB = container.querySelector("#val-lb");
                    const valRT = container.querySelector("#val-rt");
                    const input = container.querySelector("#bridge-input");
                    const btn = container.querySelector("#btn-build");
                    const feedback = container.querySelector("#bridge-feedback");
                    const fbTitle = container.querySelector("#fb-title");
                    const fbIcon = container.querySelector("#fb-icon");
                    const btnNext = container.querySelector("#btn-next-bridge");
                    const lvlDisp = container.querySelector("#bridge-lvl");

                    const loadLevel = () => {
                        if (currentLvl >= levels.length) {
                            fbIcon.innerText = "üë∑‚Äç‚ôÇÔ∏è";
                            fbTitle.innerText = "Mestre de Obras!";
                            btnNext.innerText = "Reiniciar";
                            btnNext.onclick = () => {
                                currentLvl = 0;
                                loadLevel();
                                feedback.classList.add("hidden");
                            };
                            feedback.classList.remove("hidden");
                            return;
                        }

                        const l = levels[currentLvl];
                        valLT.innerText = l.top;
                        valLB.innerText = l.bot;
                        valRT.innerText = l.rightTop;
                        input.value = "";
                        lvlDisp.innerText = currentLvl + 1;
                        feedback.classList.add("hidden");
                    };

                    btn.onclick = () => {
                        const userAns = parseFloat(input.value);
                        if (isNaN(userAns)) return;

                        const correct = levels[currentLvl].ans;

                        feedback.classList.remove("hidden");

                        if (Math.abs(userAns - correct) < 0.1) {
                            fbIcon.innerText = "üåâ";
                            fbTitle.innerText = "Ponte Est√°vel!";
                            fbTitle.className = "text-2xl font-black text-brand-green mb-2";
                            btnNext.innerText = "Pr√≥ximo N√≠vel";
                            btnNext.onclick = () => {
                                currentLvl++;
                                loadLevel();
                            };
                        } else {
                            fbIcon.innerText = "üí•";
                            fbTitle.innerText = "A Ponte Caiu!";
                            fbTitle.className = "text-2xl font-black text-brand-red mb-2";
                            btnNext.innerText = "Tentar de Novo";
                            btnNext.onclick = () => {
                                feedback.classList.add("hidden");
                            };
                        }
                    };

                    loadLevel();
                },

                game_shadow_ruler(container) {
                    // Config
                    const treeHeight = 12; // Altura real
                    let dist = 12; // Dist√¢ncia do observador (m)
                    // Se dist=12 e alt=12, angulo=45. Tan=1.
                    // Se dist=20.7 e alt=12, angulo=30. Tan=0.57.

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden h-[400px]">
        
        <div class="absolute top-4 left-4 text-white text-xs font-bold bg-gray-800 px-2 py-1 rounded">
            Miss√£o: Descubra a Altura da √Årvore
        </div>

        <div class="relative w-full flex-1 mt-8">
            <div class="absolute inset-0 bg-gradient-to-b from-blue-900 to-blue-600 opacity-50"></div>
            
            <div class="absolute bottom-0 w-full h-10 bg-green-800"></div>

            <div class="absolute bottom-10 left-[70%] w-2 h-32 bg-yellow-900"></div>
            <div class="absolute bottom-40 left-[70%] w-16 h-16 bg-green-700 rounded-full transform -translate-x-7"></div>

            <div class="absolute bottom-10 left-[20%] text-2xl">üßç</div>
            
            <svg class="absolute inset-0 w-full h-full pointer-events-none">
                <line id="sight-line" x1="22%" y1="85%" x2="70%" y2="20%" stroke="#F59E0B" stroke-width="2" stroke-dasharray="4" />
                <text x="40%" y="80%" fill="white" font-size="12" font-weight="bold" id="angle-val">45¬∞</text>
            </svg>
            
            <div class="absolute bottom-2 left-1/2 -translate-x-1/2 text-white font-mono text-xs">Dist√¢ncia: <span id="dist-val">12</span>m</div>
        </div>

        <div class="w-full bg-gray-800 p-4 z-10 border-t border-gray-600">
            <div class="flex justify-between items-center mb-2">
                <span class="text-xs text-gray-400 font-bold uppercase">Teodolito (√Çngulo)</span>
                <span class="text-brand-yellow font-black text-xl" id="slider-ang-val">45¬∞</span>
            </div>
            <input type="range" id="theodolite" min="10" max="80" value="45" class="w-full h-4 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-brand-yellow">
            
            <button id="btn-calc-height" class="w-full mt-4 bg-brand-green text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-all">
                CALCULAR ALTURA
            </button>
        </div>

        <div id="shadow-feedback" class="absolute inset-0 bg-gray-900/95 z-20 hidden flex-col items-center justify-center text-center p-6">
            <div class="text-6xl mb-4">üå≥</div>
            <h3 class="text-2xl font-black text-white mb-2" id="fb-title"></h3>
            <p class="text-gray-400 text-sm mb-6" id="fb-msg"></p>
            <button id="btn-retry-shadow" class="bg-white text-gray-900 font-bold py-2 px-8 rounded-full">Tentar Novamente</button>
        </div>

    </div>
    `;

                    const slider = container.querySelector("#theodolite");
                    const angVal = container.querySelector("#slider-ang-val");
                    const distVal = container.querySelector("#dist-val");
                    const svgLine = container.querySelector("#sight-line");
                    const svgText = container.querySelector("#angle-val");
                    const btn = container.querySelector("#btn-calc-height");
                    const feedback = container.querySelector("#shadow-feedback");
                    const fbTitle = container.querySelector("#fb-title");
                    const fbMsg = container.querySelector("#fb-msg");
                    const btnRetry = container.querySelector("#btn-retry-shadow");

                    // New game setup
                    let angle = 45;
                    let correctAngle = 0;

                    const init = () => {
                        // Random distance: 10 to 30m
                        dist = Math.floor(Math.random() * 20) + 10;
                        distVal.innerText = dist;

                        // Calculate correct angle for height = 12m (approx)
                        // tan(ang) = 12 / dist
                        // ang = atan(12/dist)
                        const rad = Math.atan(treeHeight / dist);
                        correctAngle = Math.round(rad * (180 / Math.PI));

                        feedback.classList.add("hidden");
                    };

                    const updateVisuals = () => {
                        angle = parseInt(slider.value);
                        angVal.innerText = angle + "¬∞";
                        svgText.innerText = angle + "¬∞";

                        // Update Line (Visual approximation)
                        // Start: 22% X, 85% Y (Observer eye)
                        // End: Target X is 70%. Y depends on angle.
                        // dx (visual) = 48%. dy = dx * tan(angle).
                        // Since aspect ratio varies, this is just a visual cue line rotating.

                        // Simple rotation based on pivot (22%, 85%)
                        // We'll just change y2 based on angle to look cool
                        const y2 = 85 - Math.tan((angle * Math.PI) / 180) * 48;
                        // Clamp to not go off screen too wild
                        svgLine.setAttribute("y2", `${Math.max(0, y2)}%`);
                    };

                    slider.oninput = updateVisuals;

                    btn.onclick = () => {
                        // Allow margin of error +/- 3 degrees
                        if (Math.abs(angle - correctAngle) <= 3) {
                            fbTitle.innerText = "C√°lculo Preciso!";
                            fbTitle.className = "text-2xl font-black text-brand-green mb-2";
                            fbMsg.innerText = `Com ${angle}¬∞, a altura calculada √© ~${treeHeight}m.`;
                        } else {
                            fbTitle.innerText = "Errou a Mira!";
                            fbTitle.className = "text-2xl font-black text-brand-red mb-2";
                            fbMsg.innerText = `O √¢ngulo correto seria ${correctAngle}¬∞. Sua conta deu outra altura.`;
                        }
                        feedback.classList.remove("hidden");
                    };

                    btnRetry.onclick = init;

                    init();
                    updateVisuals();
                },

                game_circle_calc_challenge(container) {
                    const problems = [
                        { type: "Circunfer√™ncia", r: 5, ans: 31.4, hint: "2 ¬∑ 3,14 ¬∑ 5" },
                        { type: "√Årea", r: 3, ans: 28.26, hint: "3,14 ¬∑ 3¬≤" },
                        { type: "Di√¢metro", r: 4, ans: 8, hint: "2 ¬∑ raio" }, // 4 radius = 8 diam
                        { type: "√Årea", r: 10, ans: 314, hint: "3,14 ¬∑ 100" },
                    ];

                    let current = 0;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full text-white mb-6 z-10">
            <h3 class="font-black uppercase text-xs tracking-widest text-brand-green">Arqueiro Matem√°tico</h3>
            <div class="bg-gray-700 px-3 py-1 rounded-full text-xs font-black">Score: <span id="gm-score">0</span></div>
        </div>

        <div class="relative w-40 h-40 bg-white rounded-full flex items-center justify-center border-8 border-red-500 shadow-xl mb-6 z-10">
            <div class="w-24 h-24 rounded-full border-8 border-white bg-red-500 flex items-center justify-center">
                <div class="w-8 h-8 rounded-full bg-white"></div>
            </div>
            <div class="absolute -top-12 bg-yellow-400 text-yellow-900 font-black px-3 py-1 rounded shadow-sm border border-yellow-600 animate-bounce">
                r = <span id="target-r">5</span>
            </div>
        </div>

        <p class="text-gray-300 text-sm mb-4 font-bold text-center z-10">
            Calcule: <span id="target-type" class="text-brand-blue text-xl">Circunfer√™ncia</span>
        </p>

        <div class="grid grid-cols-2 gap-3 w-full z-10" id="opts-area">
        </div>

        <div id="gm-feedback" class="h-8 mt-2 font-bold text-center z-10 text-white"></div>

        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20 z-0"></div>
    </div>
    `;

                    const rDisp = container.querySelector("#target-r");
                    const typeDisp = container.querySelector("#target-type");
                    const optsArea = container.querySelector("#opts-area");
                    const feedback = container.querySelector("#gm-feedback");
                    const scoreEl = container.querySelector("#gm-score");

                    const loadLevel = () => {
                        if (current >= problems.length) {
                            container.innerHTML = `
                <div class="bg-green-600 text-white p-8 rounded-xl text-center">
                    <h2 class="text-3xl font-black mb-2">Vit√≥ria!</h2>
                    <p>Voc√™ √© o mestre dos c√≠rculos.</p>
                </div>
            `;
                            return;
                        }

                        const p = problems[current];
                        rDisp.innerText = p.r;
                        typeDisp.innerText = p.type;
                        feedback.innerText = "";

                        // Generate Options
                        let opts = [p.ans];
                        while (opts.length < 4) {
                            // Fake answers logic
                            let fake = p.ans + (Math.floor(Math.random() * 10) - 5);
                            if (fake !== p.ans && fake > 0)
                                opts.push(parseFloat(fake.toFixed(2)));
                        }
                        opts.sort(() => Math.random() - 0.5);

                        optsArea.innerHTML = "";
                        opts.forEach((val) => {
                            const btn = document.createElement("button");
                            btn.className =
                                "bg-gray-700 hover:bg-gray-600 border-b-4 border-gray-900 text-white font-bold py-3 rounded-lg active:border-b-0 active:translate-y-1 transition-all";
                            btn.innerText = val;
                            btn.onclick = () => check(val, btn);
                            optsArea.appendChild(btn);
                        });
                    };

                    const check = (val, btn) => {
                        const p = problems[current];
                        if (Math.abs(val - p.ans) < 0.1) {
                            score += 100;
                            scoreEl.innerText = score;
                            btn.classList.add("bg-green-500", "border-green-700");
                            feedback.innerHTML =
                                "<span class='text-green-400'>NA MOSCA! üéØ</span>";
                            setTimeout(() => {
                                current++;
                                loadLevel();
                            }, 800);
                        } else {
                            btn.classList.add(
                                "bg-red-500",
                                "border-red-700",
                                "animate-shake"
                            );
                            feedback.innerHTML = `<span class='text-red-400'>ERROU! Dica: ${p.hint}</span>`;
                        }
                    };

                    loadLevel();
                },

                game_card_shark(container) {
                    // Jogo de adivinhar se a pr√≥xima carta √© maior ou menor
                    // Ensina intui√ß√£o de probabilidade dependente

                    // Deck simplificado: 1 a 10
                    let deck = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
                    let currentCard = 0;
                    let score = 0;
                    let gameOver = false;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden text-white">
        
        <div class="flex justify-between w-full mb-6 z-10">
            <h3 class="font-black text-brand-green uppercase text-xs tracking-widest">Card Shark</h3>
            <div class="bg-gray-800 px-3 py-1 rounded text-xs font-bold">Score: <span id="shark-score" class="text-brand-yellow">0</span></div>
        </div>

        <div class="flex gap-4 items-center justify-center mb-8 relative z-10">
            <div class="w-24 h-36 bg-white rounded-xl text-gray-900 flex flex-col items-center justify-center shadow-2xl transform transition-transform" id="current-card-ui">
                <span class="text-4xl font-black" id="card-val">?</span>
            </div>
            
            <div class="w-24 h-36 bg-blue-800 rounded-xl border-4 border-white flex items-center justify-center shadow-lg bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')]">
                <span class="text-xs font-bold opacity-50" id="cards-left">10 left</span>
            </div>
        </div>

        <p class="text-center text-sm font-bold text-gray-400 mb-4 z-10" id="shark-msg">A pr√≥xima ser√° Maior ou Menor?</p>

        <div class="flex gap-4 w-full max-w-xs z-10">
            <button id="btn-lower" class="flex-1 bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-all">
                ‚ñº MENOR
            </button>
            <button id="btn-higher" class="flex-1 bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-all">
                MAIOR ‚ñ≤
            </button>
        </div>

        <div id="shark-overlay" class="absolute inset-0 bg-gray-900/95 z-20 hidden flex-col items-center justify-center text-center p-6">
            <div class="text-6xl mb-4">üÉè</div>
            <h3 class="text-2xl font-black mb-2" id="end-title">Fim de Jogo!</h3>
            <p class="text-gray-400 mb-6">Voc√™ acertou <span id="end-score">0</span> vezes.</p>
            <button id="btn-restart-shark" class="bg-brand-blue text-white font-bold py-2 px-8 rounded-full">Jogar Novamente</button>
        </div>

    </div>
    `;

                    const cardVal = container.querySelector('#card-val');
                    const cardsLeft = container.querySelector('#cards-left');
                    const scoreEl = container.querySelector('#shark-score');
                    const msg = container.querySelector('#shark-msg');
                    const overlay = container.querySelector('#shark-overlay');
                    const btnHigh = container.querySelector('#btn-higher');
                    const btnLow = container.querySelector('#btn-lower');

                    const initGame = () => {
                        deck = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10].sort(() => Math.random() - 0.5);
                        score = 0;
                        scoreEl.innerText = 0;
                        gameOver = false;
                        overlay.classList.add('hidden');

                        // Draw first card
                        drawCard();
                    };

                    const drawCard = () => {
                        if (deck.length === 0) {
                            endGame(true);
                            return;
                        }
                        currentCard = deck.pop();
                        cardVal.innerText = currentCard;
                        cardsLeft.innerText = `${deck.length} left`;

                        // Show probability hint text based on what's left? 
                        // No, let the user intuit based on the number 5 (middle).
                    };

                    const guess = (direction) => {
                        if (deck.length === 0) return;

                        const nextCard = deck[deck.length - 1]; // Peek

                        const isHigher = nextCard > currentCard;
                        const isLower = nextCard < currentCard;

                        const correct = (direction === 'high' && isHigher) || (direction === 'low' && isLower);

                        if (correct) {
                            score++;
                            scoreEl.innerText = score;
                            msg.innerHTML = "<span class='text-green-400'>Boa! Acertou.</span>";
                            drawCard(); // Move to next
                        } else {
                            msg.innerHTML = `<span class='text-red-500'>Errou! Era ${nextCard}.</span>`;
                            endGame(false);
                        }
                    };

                    const endGame = (win) => {
                        overlay.classList.remove('hidden');
                        container.querySelector('#end-score').innerText = score;
                        container.querySelector('#end-title').innerText = win ? "Zerou o Baralho!" : "Fim de Jogo!";
                    };

                    btnHigh.onclick = () => guess('high');
                    btnLow.onclick = () => guess('low');
                    container.querySelector('#btn-restart-shark').onclick = initGame;

                    initGame();
                },

                game_log_memory(container) {
                    // Memory Game: Match Log to Result or Exponential Form
                    const pairs = [
                        { id: 1, val: "log‚ÇÇ8", type: "q" }, { id: 1, val: "3", type: "a" },
                        { id: 2, val: "log‚ÇÅ‚ÇÄ100", type: "q" }, { id: 2, val: "2", type: "a" },
                        { id: 3, val: "log‚ÇÉ27", type: "q" }, { id: 3, val: "3", type: "a" },
                        { id: 4, val: "log‚ÇÖ1", type: "q" }, { id: 4, val: "0", type: "a" },
                        { id: 5, val: "log‚ÇÇ0.5", type: "q" }, { id: 5, val: "-1", type: "a" },
                        { id: 6, val: "log‚Çá7", type: "q" }, { id: 6, val: "1", type: "a" }
                    ];

                    let flipped = [];
                    let matched = [];
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-800 border-4 border-gray-600 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative">
        
        <div class="flex justify-between w-full mb-4 z-10">
            <h3 class="font-black text-brand-purple uppercase text-xs tracking-widest">Memory Log</h3>
            <div class="bg-gray-700 px-3 py-1 rounded text-xs font-bold text-white">Matches: <span id="mem-score">0</span>/6</div>
        </div>

        <div class="grid grid-cols-3 md:grid-cols-4 gap-3 w-full" id="mem-grid">
        </div>

        <div id="mem-win" class="absolute inset-0 bg-gray-900/95 z-20 hidden flex-col items-center justify-center">
            <div class="text-6xl mb-2">üß†</div>
            <h3 class="text-2xl font-black text-white">Mem√≥ria Logar√≠tmica!</h3>
            <button class="mt-4 bg-brand-purple text-white font-bold py-2 px-6 rounded-full" onclick="app.widgets.game_log_memory(this.parentElement.parentElement.parentElement)">Jogar Novamente</button>
        </div>

    </div>
    `;

                    const grid = container.querySelector('#mem-grid');
                    const scoreEl = container.querySelector('#mem-score');
                    const winScreen = container.querySelector('#mem-win');

                    // Shuffle
                    const cards = [...pairs].sort(() => Math.random() - 0.5);

                    const checkMatch = () => {
                        const [c1, c2] = flipped;
                        if (c1.dataset.id === c2.dataset.id) {
                            // Match
                            c1.classList.add('bg-green-600', 'border-green-400');
                            c2.classList.add('bg-green-600', 'border-green-400');
                            matched.push(c1, c2);
                            score++;
                            scoreEl.innerText = score;
                            if (score === 6) setTimeout(() => winScreen.classList.remove('hidden'), 500);
                        } else {
                            // No Match
                            c1.classList.add('bg-red-600');
                            c2.classList.add('bg-red-600');
                            setTimeout(() => {
                                c1.classList.remove('bg-red-600', 'text-white', 'border-white');
                                c1.classList.add('bg-gray-700', 'text-transparent', 'border-gray-600');
                                c2.classList.remove('bg-red-600', 'text-white', 'border-white');
                                c2.classList.add('bg-gray-700', 'text-transparent', 'border-gray-600');
                            }, 800);
                        }
                        flipped = [];
                    };

                    cards.forEach((card, i) => {
                        const btn = document.createElement('button');
                        btn.className = "aspect-square bg-gray-700 border-2 border-gray-600 rounded-lg flex items-center justify-center text-transparent font-bold text-lg md:text-xl transition-all duration-300 transform active:scale-95";
                        btn.innerText = card.val; // Hidden visually by text-transparent
                        btn.dataset.id = card.id;

                        btn.onclick = () => {
                            if (flipped.length < 2 && !matched.includes(btn) && !flipped.includes(btn)) {
                                // Flip
                                btn.classList.remove('bg-gray-700', 'text-transparent', 'border-gray-600');
                                btn.classList.add('bg-brand-purple', 'text-white', 'border-white');
                                flipped.push(btn);

                                if (flipped.length === 2) {
                                    checkMatch();
                                }
                            }
                        };

                        grid.appendChild(btn);
                    });
                },

                game_trig_shooter(container) {
                    let score = 0;
                    let targetDeg = 90;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative overflow-hidden">
        
        <div class="flex justify-between w-full text-white mb-2 z-10">
            <div class="text-xs font-bold uppercase">Sniper Trigonom√©trico</div>
            <div class="text-brand-green font-black">Pts: <span id="trig-score">0</span></div>
        </div>

        <div class="relative w-64 h-64 bg-black rounded-full border-2 border-gray-600 flex items-center justify-center mb-4">
            <div id="target-dot" class="absolute w-6 h-6 bg-red-500 rounded-full shadow-[0_0_15px_red] animate-pulse" style="top: 10px; left: 50%; transform: translateX(-50%);"></div>
            
            <div id="cannon" class="w-1 h-32 bg-brand-blue origin-bottom transition-transform duration-100 absolute bottom-1/2 left-1/2 -translate-x-1/2" style="transform: rotate(0deg)"></div>
            <div class="absolute w-4 h-4 bg-white rounded-full"></div>
        </div>

        <div class="flex gap-4 items-center w-full max-w-xs z-10">
            <input type="range" id="aim-slider" min="0" max="360" value="0" class="flex-1 h-4 bg-gray-700 rounded-full appearance-none cursor-pointer accent-brand-blue">
            <button id="btn-fire-trig" class="w-16 h-16 rounded-full bg-red-600 border-4 border-red-800 text-white font-black shadow-lg active:scale-95">FIRE</button>
        </div>
        
        <div id="angle-readout" class="mt-2 text-white font-mono text-xl font-bold">0¬∞</div>
        <div id="trig-fb" class="absolute inset-0 flex items-center justify-center bg-black/80 text-4xl font-black text-white hidden z-20">NA MOSCA!</div>

    </div>
    `;

                    const slider = container.querySelector('#aim-slider');
                    const cannon = container.querySelector('#cannon');
                    const target = container.querySelector('#target-dot');
                    const readout = container.querySelector('#angle-readout');
                    const btn = container.querySelector('#btn-fire-trig');
                    const fb = container.querySelector('#trig-fb');
                    const scoreEl = container.querySelector('#trig-score');

                    const spawnTarget = () => {
                        targetDeg = Math.floor(Math.random() * 360);
                        // Position target on circle edge
                        // CSS rotation logic: 0 is UP (top). 90 is RIGHT? No.
                        // Standard CSS rotate(0) is UP if element is vertical line.
                        // Let's align math: 0 deg = UP.
                        const r = 110; // radius px
                        const rad = (targetDeg - 90) * (Math.PI / 180); // Adjust for math 0 at Right

                        // Actually simplest is just rotate a container
                        // But let's calculate x,y relative to center (128,128)
                        // 0 deg (slider) = Up.
                        // Target deg relative to UP.

                        // Simply rotate the target container? No, absolute pos.
                        // Let's use simple trig:
                        // x = r * sin(deg)
                        // y = -r * cos(deg) (up is negative y)

                        const tRad = targetDeg * (Math.PI / 180);
                        const tx = 128 + 110 * Math.sin(tRad);
                        const ty = 128 - 110 * Math.cos(tRad);

                        target.style.left = `${tx}px`;
                        target.style.top = `${ty}px`;
                        target.style.transform = `translate(-50%, -50%)`;
                    };

                    slider.oninput = () => {
                        const val = slider.value;
                        cannon.style.transform = `rotate(${val}deg)`;
                        readout.innerText = `${val}¬∞`;
                    };

                    btn.onclick = () => {
                        const aim = parseInt(slider.value);
                        const diff = Math.abs(aim - targetDeg); // Simple circular diff needed (359 vs 1)
                        const circDiff = Math.min(diff, 360 - diff);

                        if (circDiff < 10) {
                            score += 100;
                            scoreEl.innerText = score;
                            fb.innerText = "ACERTOU!";
                            fb.classList.remove('hidden');
                            setTimeout(() => {
                                fb.classList.add('hidden');
                                spawnTarget();
                            }, 1000);
                        } else {
                            score = Math.max(0, score - 10);
                            scoreEl.innerText = score;
                        }
                    };

                    spawnTarget();
                },

                game_matrix_code(container) {
                    // Decrypt a message using determinant logic (simplified)
                    const code = [1, 0, 0, 1]; // Identity
                    const msg = "OLA";

                    container.innerHTML = `
    <div class="bg-black border-2 border-green-500 rounded-xl p-6 flex flex-col items-center w-full shadow-[0_0_20px_rgba(0,255,0,0.2)] font-mono select-none">
        
        <h3 class="text-green-500 font-bold uppercase text-xs tracking-widest mb-6">MATRIX DECODER</h3>

        <div class="text-green-400 text-sm mb-4 w-full text-left">
            > ENCRYPTED_MSG: [ 15, 12, 1 ]<br>
            > KEY_MATRIX: Identity (I)<br>
            > STATUS: LOCKED
        </div>

        <div class="grid grid-cols-2 gap-2 mb-6">
            <input type="number" class="mat-in bg-gray-900 border border-green-700 text-green-400 text-center w-12 h-12 text-xl" value="1">
            <input type="number" class="mat-in bg-gray-900 border border-green-700 text-green-400 text-center w-12 h-12 text-xl" value="0">
            <input type="number" class="mat-in bg-gray-900 border border-green-700 text-green-400 text-center w-12 h-12 text-xl" value="0">
            <input type="number" class="mat-in bg-gray-900 border border-green-700 text-green-400 text-center w-12 h-12 text-xl" value="1">
        </div>

        <button id="btn-decode" class="w-full bg-green-700 text-black font-bold py-2 hover:bg-green-600 transition-colors uppercase tracking-widest">
            DECODE
        </button>

        <div id="matrix-out" class="mt-4 h-8 text-green-400 font-bold"></div>
    </div>
    `;

                    const btn = container.querySelector('#btn-decode');
                    const out = container.querySelector('#matrix-out');
                    const inputs = container.querySelectorAll('.mat-in');

                    btn.onclick = () => {
                        // Calculate Determinant
                        const a = inputs[0].value;
                        const b = inputs[1].value;
                        const c = inputs[2].value;
                        const d = inputs[3].value;

                        const det = a * d - b * c;

                        if (det === 1) {
                            out.innerText = "ACCESS GRANTED: 'OLA'";
                            out.classList.add('animate-pulse');
                        } else {
                            out.innerText = "ERROR: DET != 1";
                        }
                    };
                },

                game_polyhedron_ninja(container) {
                    const solids = [
                        { name: "Tetraedro", v: 4, f: 4 },
                        { name: "Cubo", v: 8, f: 6 },
                        { name: "Octaedro", v: 6, f: 8 },
                        { name: "Dodecaedro", v: 20, f: 12 },
                        { name: "Icosaedro", v: 12, f: 20 }
                    ];

                    let current = null;
                    let score = 0;

                    container.innerHTML = `
    <div class="bg-gray-900 border-4 border-gray-700 rounded-xl p-6 flex flex-col items-center w-full shadow-lg font-sans select-none text-white relative">
        
        <div class="flex justify-between w-full mb-6">
            <h3 class="font-black text-brand-yellow uppercase text-xs tracking-widest">Polyhedron Ninja</h3>
            <div class="bg-gray-800 px-3 py-1 rounded text-xs font-bold">Score: <span id="poly-score">0</span></div>
        </div>

        <div class="w-full bg-gray-800 p-6 rounded-xl text-center mb-6 border border-gray-600 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-brand-yellow animate-pulse"></div>
            <p class="text-xs text-gray-400 uppercase font-bold mb-2">Pistas:</p>
            <div class="flex justify-center gap-8 font-mono text-2xl font-bold">
                <div class="flex flex-col"><span class="text-brand-blue" id="hint-v">?</span> <span class="text-[10px] text-gray-500">V√©rtices</span></div>
                <div class="flex flex-col"><span class="text-brand-orange" id="hint-f">?</span> <span class="text-[10px] text-gray-500">Faces</span></div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3 w-full" id="poly-opts">
            </div>
        
        <div id="poly-fb" class="absolute inset-0 bg-gray-900/95 flex items-center justify-center hidden z-20 flex-col">
            <div class="text-6xl mb-2" id="fb-icon"></div>
            <button id="btn-poly-next" class="mt-4 bg-brand-blue font-bold py-2 px-6 rounded-full">Pr√≥ximo</button>
        </div>

    </div>
    `;

                    const hintV = container.querySelector('#hint-v');
                    const hintF = container.querySelector('#hint-f');
                    const optsDiv = container.querySelector('#poly-opts');
                    const fb = container.querySelector('#poly-fb');
                    const fbIcon = container.querySelector('#fb-icon');
                    const scoreEl = container.querySelector('#poly-score');
                    const btnNext = container.querySelector('#btn-poly-next');

                    const loadRound = () => {
                        current = solids[Math.floor(Math.random() * solids.length)];

                        hintV.innerText = current.v;
                        hintF.innerText = current.f;
                        fb.classList.add('hidden');

                        // Generate options (1 correct + 3 wrong)
                        let opts = [current.name];
                        while (opts.length < 4) {
                            const r = solids[Math.floor(Math.random() * solids.length)].name;
                            if (!opts.includes(r)) opts.push(r);
                        }
                        opts.sort(() => Math.random() - 0.5);

                        optsDiv.innerHTML = '';
                        opts.forEach(name => {
                            const btn = document.createElement('button');
                            btn.className = "bg-gray-700 hover:bg-gray-600 py-3 rounded-lg font-bold border-b-4 border-gray-800 active:border-b-0 active:translate-y-1 transition-all";
                            btn.innerText = name;
                            btn.onclick = () => check(name);
                            optsDiv.appendChild(btn);
                        });
                    };

                    const check = (name) => {
                        if (name === current.name) {
                            score += 50;
                            fbIcon.innerText = "‚öîÔ∏è Acertou!";
                            fbIcon.className = "text-4xl font-black text-brand-green";
                        } else {
                            fbIcon.innerText = "ü§ï Errou";
                            fbIcon.className = "text-4xl font-black text-brand-red";
                        }
                        scoreEl.innerText = score;
                        fb.classList.remove('hidden');
                    };

                    btnNext.onclick = loadRound;
                    loadRound();
                },

                game_complex_maze(container) {
                    // A simple logic puzzle: 1 -> x i -> ? -> x i -> ?
                    // Start at 1. Operation sequence provided. Final answer?

                    let currentVal = { r: 1, i: 0 }; // Start at 1
                    let steps = [];
                    const ops = ["√ó i", "√ó -1", "√ó -i"];

                    container.innerHTML = `
    <div class="bg-gray-100 border-4 border-gray-300 rounded-xl p-4 flex flex-col items-center w-full shadow-lg font-sans select-none relative">
        
        <div class="flex justify-between w-full mb-4">
            <h3 class="font-black text-brand-purple uppercase text-xs tracking-widest">Labirinto Complexo</h3>
            <div class="bg-white px-3 py-1 rounded-full text-xs font-bold text-gray-500">Inicio: 1</div>
        </div>

        <div class="flex gap-2 mb-6 overflow-x-auto w-full py-2 justify-center" id="steps-row">
            </div>

        <p class="text-center font-bold text-gray-600 mb-4">Onde paramos?</p>

        <div class="grid grid-cols-2 gap-4 w-full max-w-xs">
            <button class="maze-btn bg-white border-2 border-brand-purple text-brand-purple py-3 rounded-xl font-bold hover:bg-purple-50" data-val="1">1</button>
            <button class="maze-btn bg-white border-2 border-brand-purple text-brand-purple py-3 rounded-xl font-bold hover:bg-purple-50" data-val="i">i</button>
            <button class="maze-btn bg-white border-2 border-brand-purple text-brand-purple py-3 rounded-xl font-bold hover:bg-purple-50" data-val="-1">-1</button>
            <button class="maze-btn bg-white border-2 border-brand-purple text-brand-purple py-3 rounded-xl font-bold hover:bg-purple-50" data-val="-i">-i</button>
        </div>

        <div id="maze-feedback" class="absolute inset-0 bg-white/90 hidden flex-col items-center justify-center z-10">
            <div class="text-4xl font-black mb-2" id="mf-icon"></div>
            <button class="bg-brand-purple text-white font-bold py-2 px-6 rounded-full" onclick="app.widgets.game_complex_maze(this.parentElement.parentElement)">Pr√≥ximo</button>
        </div>

    </div>
    `;

                    const stepsRow = container.querySelector('#steps-row');
                    const feedback = container.querySelector('#maze-feedback');
                    const mfIcon = container.querySelector('#mf-icon');

                    // Generate Path (3 steps)
                    // Logic: 1 -> i -> -1 -> -i -> 1 (Clockwise logic for x i)
                    // Indexes: 1=0, i=1, -1=2, -i=3.
                    // x i = +1 index
                    // x -1 = +2 index
                    // x -i = +3 index (or -1)

                    let currentIdx = 0; // Starts at 1
                    const idxToVal = ["1", "i", "-1", "-i"];

                    for (let k = 0; k < 3; k++) {
                        const opIdx = Math.floor(Math.random() * 3); // 0, 1, 2
                        const opName = ops[opIdx];

                        // Update logic
                        if (opIdx === 0) currentIdx = (currentIdx + 1) % 4; // x i
                        if (opIdx === 1) currentIdx = (currentIdx + 2) % 4; // x -1
                        if (opIdx === 2) currentIdx = (currentIdx + 3) % 4; // x -i

                        const el = document.createElement('div');
                        el.className = "bg-purple-100 text-purple-800 px-3 py-1 rounded font-mono font-bold shadow-sm whitespace-nowrap";
                        el.innerText = opName;
                        stepsRow.appendChild(el);

                        if (k < 2) {
                            const arrow = document.createElement('span');
                            arrow.className = "text-gray-400 self-center";
                            arrow.innerText = "‚ûú";
                            stepsRow.appendChild(arrow);
                        }
                    }

                    const correct = idxToVal[currentIdx];

                    container.querySelectorAll('.maze-btn').forEach(btn => {
                        btn.onclick = () => {
                            if (btn.dataset.val === correct) {
                                mfIcon.innerText = "üéâ Certo!";
                                mfIcon.className = "text-3xl font-black text-green-500 mb-2";
                            } else {
                                mfIcon.innerText = "‚ùå Era " + correct;
                                mfIcon.className = "text-3xl font-black text-red-500 mb-2";
                            }
                            feedback.classList.remove('hidden');
                        };
                    });
                },









                // Insira Widgets de tipo game acima desta linha

                createStepSolver(container, steps) {
                    let current = 0;
                    container.innerHTML = `<div class="bg-brand-bg border-2 border-brand-gray rounded-3xl p-6 w-full"><div class="step-list space-y-3 font-mono text-lg mb-6 min-h-[60px]"></div><button class="btn-step w-full bg-brand-yellow hover:bg-brand-yellowDark text-brand-text font-extrabold px-8 py-4 rounded-2xl shadow-btn btn-game flex items-center justify-center gap-2 text-lg"><span>Iniciar</span> <i class="fas fa-play"></i></button></div>`;
                    const list = container.querySelector(".step-list"),
                        btn = container.querySelector(".btn-step");
                    const renderNext = () => {
                        if (current === 0) {
                            list.innerHTML = "";
                            btn.innerHTML = `<span>Pr√≥ximo Passo</span> <i class="fas fa-arrow-down"></i>`;
                            addStepHTML(0);
                            current = 1;
                        } else if (current < steps.length) {
                            addStepHTML(current);
                            current++;
                            if (current === steps.length) {
                                btn.innerHTML = `<span>Reiniciar</span> <i class="fas fa-rotate-right"></i>`;
                                btn.classList.replace("bg-brand-yellow", "bg-brand-green");
                                btn.classList.replace("text-brand-text", "text-white");
                            }
                        } else {
                            current = 0;
                            btn.classList.replace("bg-brand-green", "bg-brand-yellow");
                            btn.classList.replace("text-white", "text-brand-text");
                            renderNext();
                        }
                    };
                    const addStepHTML = (index) => {
                        const step = steps[index];
                        const div = document.createElement("div");
                        div.className = `flex flex-col md:flex-row md:items-center justify-between p-4 bg-white rounded-xl border-l-4 ${index === 0 ? "border-gray-300" : "border-brand-green"
                            } shadow-sm fade-in`;
                        div.innerHTML = `<div class="text-brand-text font-black text-xl">$$${step.latex}$$</div><div class="text-xs font-bold text-brand-green uppercase tracking-wide mt-2 md:mt-0 bg-gray-50 px-2 py-1 rounded">${step.text}</div>`;
                        list.appendChild(div);
                        renderMathInElement(div, {
                            delimiters: [{ left: "$$", right: "$$", display: false }],
                        });
                    };
                    btn.onclick = renderNext;
                    list.innerHTML = `<div class="p-4 text-center text-gray-400 font-bold italic">Clique em Iniciar</div>`;
                },

                // leaderboard

                interactive_leaderboard(container) {
                    // Estrutura inicial do Widget
                    container.innerHTML = `
    <div class="bg-white border-2 border-brand-gray rounded-xl p-4 flex flex-col w-full shadow-sm font-sans">
        
        <div class="flex items-center justify-between mb-4 border-b pb-2">
            <h3 class="text-brand-yellow font-black uppercase text-xs tracking-widest"><i class="fas fa-trophy"></i> Rankings</h3>
            
            <div class="flex bg-gray-100 p-1 rounded-lg">
                <button class="rank-tab px-3 py-1 text-[10px] font-bold uppercase rounded bg-white shadow text-brand-blue" data-mode="geral">Geral</button>
                <button class="rank-tab px-3 py-1 text-[10px] font-bold uppercase rounded text-gray-400 hover:bg-white" data-mode="serie">S√©rie</button>
                <button class="rank-tab px-3 py-1 text-[10px] font-bold uppercase rounded text-gray-400 hover:bg-white" data-mode="turma">Turma</button>
            </div>
        </div>

        <div id="filter-controls" class="hidden flex gap-2 mb-4 animate-fade-in">
            <select id="filter-grade" class="flex-1 bg-gray-50 border border-gray-200 text-xs font-bold rounded p-2 outline-none">
                <option value="6">6¬∫ Ano</option>
                <option value="7">7¬∫ Ano</option>
                <option value="8">8¬∫ Ano</option>
                <option value="9">9¬∫ Ano</option>
                <option value="1EM">1¬∫ EM</option>
                <option value="2EM">2¬∫ EM</option>
                <option value="3EM">3¬∫ EM</option>
            </select>
            <select id="filter-class" class="hidden flex-1 bg-gray-50 border border-gray-200 text-xs font-bold rounded p-2 outline-none">
                <option value="A">Turma A</option>
                <option value="B">Turma B</option>
                <option value="C">Turma C</option>
                <option value="D">Turma D</option>
                <option value="TREINEIRO">Treineiro</option>
            </select>
            <button id="btn-refresh-rank" class="bg-brand-blue text-white px-3 rounded text-xs"><i class="fas fa-search"></i></button>
        </div>

        <div id="rank-list" class="flex flex-col gap-2 min-h-[150px]">
            <div class="text-center text-gray-400 text-xs py-8">Carregando dados...</div>
        </div>

    </div>
    `;

                    const tabs = container.querySelectorAll('.rank-tab');
                    const controls = container.getElementById('filter-controls');
                    const selGrade = container.getElementById('filter-grade');
                    const selClass = container.getElementById('filter-class');
                    const btnRefresh = container.getElementById('btn-refresh-rank');
                    const list = container.getElementById('rank-list');

                    let currentMode = 'geral'; // geral, serie, turma

                    // Fun√ß√£o para buscar dados
                    const fetchRanking = async () => {
                        list.innerHTML = `<div class="text-center text-gray-400 text-xs py-8"><i class="fas fa-circle-notch animate-spin"></i> Buscando campe√µes...</div>`;

                        const db = window.firebase.firestore();
                        let query = db.collection("users").orderBy("xp", "desc").limit(5);

                        // Aplicar Filtros
                        if (currentMode === 'serie' || currentMode === 'turma') {
                            const grade = selGrade.value;
                            query = db.collection("users").where("grade", "==", grade);

                            if (currentMode === 'turma') {
                                const turma = selClass.value;
                                query = query.where("schoolClass", "==", turma);
                            }

                            // Nota Importante: Firestore exige √≠ndice composto para where() + orderBy()
                            // Se der erro no console, clique no link fornecido pelo Firebase para criar o √≠ndice.
                            query = query.orderBy("xp", "desc").limit(5);
                        }

                        try {
                            const snapshot = await query.get();

                            if (snapshot.empty) {
                                list.innerHTML = `<div class="text-center text-gray-400 text-xs py-4">Ningu√©m pontuou aqui ainda!</div>`;
                                return;
                            }

                            let html = '';
                            let pos = 1;
                            snapshot.forEach(doc => {
                                const u = doc.data();
                                const medals = ["ü•á", "ü•à", "ü•â"];
                                const badge = pos <= 3 ? medals[pos - 1] : `<span class="font-bold text-gray-500">#${pos}</span>`;

                                // Estilo diferente para o usu√°rio atual
                                const isMe = app.auth.currentUser && app.auth.currentUser.uid === doc.id;
                                const bgClass = isMe ? "bg-blue-50 border-brand-blue" : "bg-gray-50 border-gray-100";

                                html += `
                <div class="flex items-center justify-between p-2 rounded-lg border ${bgClass} animate-pop-in" style="animation-delay: ${pos * 0.1}s">
                    <div class="flex items-center gap-3">
                        <div class="text-lg w-6 text-center">${badge}</div>
                        <div class="flex flex-col">
                            <span class="text-xs font-bold text-gray-700 truncate max-w-[120px]">${u.displayName || "An√¥nimo"}</span>
                            <span class="text-[10px] text-gray-400">${u.grade || "?"}¬∫ Ano ${u.schoolClass || ""}</span>
                        </div>
                    </div>
                    <div class="font-black text-brand-orange text-sm">${u.xp} XP</div>
                </div>
                `;
                                pos++;
                            });
                            list.innerHTML = html;

                        } catch (error) {
                            console.error("Erro ranking:", error);
                            list.innerHTML = `
                <div class="text-center text-red-400 text-xs py-2">
                    Precisa criar √≠ndice no Firebase.<br>
                    (Verifique o Console do navegador)
                </div>
            `;
                        }
                    };

                    // L√≥gica das Abas
                    tabs.forEach(tab => {
                        tab.onclick = () => {
                            // Visual
                            tabs.forEach(t => {
                                t.className = "rank-tab px-3 py-1 text-[10px] font-bold uppercase rounded text-gray-400 hover:bg-white";
                            });
                            tab.className = "rank-tab px-3 py-1 text-[10px] font-bold uppercase rounded bg-white shadow text-brand-blue";

                            currentMode = tab.dataset.mode;

                            // Mostrar/Esconder controles
                            if (currentMode === 'geral') {
                                controls.classList.add('hidden');
                            } else {
                                controls.classList.remove('hidden');
                                if (currentMode === 'serie') {
                                    selClass.classList.add('hidden');
                                } else {
                                    selClass.classList.remove('hidden');
                                }
                            }

                            fetchRanking();
                        };
                    });

                    btnRefresh.onclick = fetchRanking;

                    // Carregar inicial
                    fetchRanking();
                }




            },
        };

        app.init();
    </script>
</body>

</html>
